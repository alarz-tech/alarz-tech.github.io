(()=>{var uy=Object.create;var Ch=Object.defineProperty;var dy=Object.getOwnPropertyDescriptor;var py=Object.getOwnPropertyNames;var fy=Object.getPrototypeOf,my=Object.prototype.hasOwnProperty;var yt=(r,t)=>()=>(t||r((t={exports:{}}).exports,t),t.exports),gy=(r,t)=>{for(var e in t)Ch(r,e,{get:t[e],enumerable:!0})},xy=(r,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of py(t))!my.call(r,s)&&s!==e&&Ch(r,s,{get:()=>t[s],enumerable:!(i=dy(t,s))||i.enumerable});return r};var Sh=(r,t,e)=>(e=r!=null?uy(fy(r)):{},xy(t||!r||!r.__esModule?Ch(e,"default",{value:r,enumerable:!0}):e,r));var yp=yt((vA,Mh)=>{"use strict";var _y=Object.prototype.hasOwnProperty,ce="~";function yo(){}Object.create&&(yo.prototype=Object.create(null),new yo().__proto__||(ce=!1));function by(r,t,e){this.fn=r,this.context=t,this.once=e||!1}function xp(r,t,e,i,s){if(typeof e!="function")throw new TypeError("The listener must be a function");var o=new by(e,i||r,s),n=ce?ce+t:t;return r._events[n]?r._events[n].fn?r._events[n]=[r._events[n],o]:r._events[n].push(o):(r._events[n]=o,r._eventsCount++),r}function na(r,t){--r._eventsCount===0?r._events=new yo:delete r._events[t]}function Jt(){this._events=new yo,this._eventsCount=0}Jt.prototype.eventNames=function(){var t=[],e,i;if(this._eventsCount===0)return t;for(i in e=this._events)_y.call(e,i)&&t.push(ce?i.slice(1):i);return Object.getOwnPropertySymbols?t.concat(Object.getOwnPropertySymbols(e)):t};Jt.prototype.listeners=function(t){var e=ce?ce+t:t,i=this._events[e];if(!i)return[];if(i.fn)return[i.fn];for(var s=0,o=i.length,n=new Array(o);s<o;s++)n[s]=i[s].fn;return n};Jt.prototype.listenerCount=function(t){var e=ce?ce+t:t,i=this._events[e];return i?i.fn?1:i.length:0};Jt.prototype.emit=function(t,e,i,s,o,n){var a=ce?ce+t:t;if(!this._events[a])return!1;var l=this._events[a],h=arguments.length,c,u;if(l.fn){switch(l.once&&this.removeListener(t,l.fn,void 0,!0),h){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,e),!0;case 3:return l.fn.call(l.context,e,i),!0;case 4:return l.fn.call(l.context,e,i,s),!0;case 5:return l.fn.call(l.context,e,i,s,o),!0;case 6:return l.fn.call(l.context,e,i,s,o,n),!0}for(u=1,c=new Array(h-1);u<h;u++)c[u-1]=arguments[u];l.fn.apply(l.context,c)}else{var d=l.length,p;for(u=0;u<d;u++)switch(l[u].once&&this.removeListener(t,l[u].fn,void 0,!0),h){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,e);break;case 3:l[u].fn.call(l[u].context,e,i);break;case 4:l[u].fn.call(l[u].context,e,i,s);break;default:if(!c)for(p=1,c=new Array(h-1);p<h;p++)c[p-1]=arguments[p];l[u].fn.apply(l[u].context,c)}}return!0};Jt.prototype.on=function(t,e,i){return xp(this,t,e,i,!1)};Jt.prototype.once=function(t,e,i){return xp(this,t,e,i,!0)};Jt.prototype.removeListener=function(t,e,i,s){var o=ce?ce+t:t;if(!this._events[o])return this;if(!e)return na(this,o),this;var n=this._events[o];if(n.fn)n.fn===e&&(!s||n.once)&&(!i||n.context===i)&&na(this,o);else{for(var a=0,l=[],h=n.length;a<h;a++)(n[a].fn!==e||s&&!n[a].once||i&&n[a].context!==i)&&l.push(n[a]);l.length?this._events[o]=l.length===1?l[0]:l:na(this,o)}return this};Jt.prototype.removeAllListeners=function(t){var e;return t?(e=ce?ce+t:t,this._events[e]&&na(this,e)):(this._events=new yo,this._eventsCount=0),this};Jt.prototype.off=Jt.prototype.removeListener;Jt.prototype.addListener=Jt.prototype.on;Jt.prefixed=ce;Jt.EventEmitter=Jt;typeof Mh<"u"&&(Mh.exports=Jt)});var wp=yt((_A,Bh)=>{"use strict";Bh.exports=ha;Bh.exports.default=ha;function ha(r,t,e){e=e||2;var i=t&&t.length,s=i?t[0]*e:r.length,o=_p(r,0,s,e,!0),n=[];if(!o||o.next===o.prev)return n;var a,l,h,c,u,d,p;if(i&&(o=Ey(r,t,o,e)),r.length>80*e){a=h=r[0],l=c=r[1];for(var f=e;f<s;f+=e)u=r[f],d=r[f+1],u<a&&(a=u),d<l&&(l=d),u>h&&(h=u),d>c&&(c=d);p=Math.max(h-a,c-l),p=p!==0?32767/p:0}return vo(o,n,e,a,l,p,0),n}function _p(r,t,e,i,s){var o,n;if(s===Dh(r,t,e,i)>0)for(o=t;o<e;o+=i)n=vp(o,r[o],r[o+1],n);else for(o=e-i;o>=t;o-=i)n=vp(o,r[o],r[o+1],n);return n&&ca(n,n.next)&&(bo(n),n=n.next),n}function mi(r,t){if(!r)return r;t||(t=r);var e=r,i;do if(i=!1,!e.steiner&&(ca(e,e.next)||Et(e.prev,e,e.next)===0)){if(bo(e),e=t=e.prev,e===e.next)break;i=!0}else e=e.next;while(i||e!==t);return t}function vo(r,t,e,i,s,o,n){if(r){!n&&o&&Ry(r,i,s,o);for(var a=r,l,h;r.prev!==r.next;){if(l=r.prev,h=r.next,o?wy(r,i,s,o):Ty(r)){t.push(l.i/e|0),t.push(r.i/e|0),t.push(h.i/e|0),bo(r),r=h.next,a=h.next;continue}if(r=h,r===a){n?n===1?(r=Cy(mi(r),t,e),vo(r,t,e,i,s,o,2)):n===2&&Sy(r,t,e,i,s,o):vo(mi(r),t,e,i,s,o,1);break}}}}function Ty(r){var t=r.prev,e=r,i=r.next;if(Et(t,e,i)>=0)return!1;for(var s=t.x,o=e.x,n=i.x,a=t.y,l=e.y,h=i.y,c=s<o?s<n?s:n:o<n?o:n,u=a<l?a<h?a:h:l<h?l:h,d=s>o?s>n?s:n:o>n?o:n,p=a>l?a>h?a:h:l>h?l:h,f=i.next;f!==t;){if(f.x>=c&&f.x<=d&&f.y>=u&&f.y<=p&&es(s,a,o,l,n,h,f.x,f.y)&&Et(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function wy(r,t,e,i){var s=r.prev,o=r,n=r.next;if(Et(s,o,n)>=0)return!1;for(var a=s.x,l=o.x,h=n.x,c=s.y,u=o.y,d=n.y,p=a<l?a<h?a:h:l<h?l:h,f=c<u?c<d?c:d:u<d?u:d,m=a>l?a>h?a:h:l>h?l:h,g=c>u?c>d?c:d:u>d?u:d,x=Rh(p,f,t,e,i),b=Rh(m,g,t,e,i),y=r.prevZ,_=r.nextZ;y&&y.z>=x&&_&&_.z<=b;){if(y.x>=p&&y.x<=m&&y.y>=f&&y.y<=g&&y!==s&&y!==n&&es(a,c,l,u,h,d,y.x,y.y)&&Et(y.prev,y,y.next)>=0||(y=y.prevZ,_.x>=p&&_.x<=m&&_.y>=f&&_.y<=g&&_!==s&&_!==n&&es(a,c,l,u,h,d,_.x,_.y)&&Et(_.prev,_,_.next)>=0))return!1;_=_.nextZ}for(;y&&y.z>=x;){if(y.x>=p&&y.x<=m&&y.y>=f&&y.y<=g&&y!==s&&y!==n&&es(a,c,l,u,h,d,y.x,y.y)&&Et(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;_&&_.z<=b;){if(_.x>=p&&_.x<=m&&_.y>=f&&_.y<=g&&_!==s&&_!==n&&es(a,c,l,u,h,d,_.x,_.y)&&Et(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function Cy(r,t,e){var i=r;do{var s=i.prev,o=i.next.next;!ca(s,o)&&bp(s,i,i.next,o)&&_o(s,o)&&_o(o,s)&&(t.push(s.i/e|0),t.push(i.i/e|0),t.push(o.i/e|0),bo(i),bo(i.next),i=r=o),i=i.next}while(i!==r);return mi(i)}function Sy(r,t,e,i,s,o){var n=r;do{for(var a=n.next.next;a!==n.prev;){if(n.i!==a.i&&By(n,a)){var l=Tp(n,a);n=mi(n,n.next),l=mi(l,l.next),vo(n,t,e,i,s,o,0),vo(l,t,e,i,s,o,0);return}a=a.next}n=n.next}while(n!==r)}function Ey(r,t,e,i){var s=[],o,n,a,l,h;for(o=0,n=t.length;o<n;o++)a=t[o]*i,l=o<n-1?t[o+1]*i:r.length,h=_p(r,a,l,i,!1),h===h.next&&(h.steiner=!0),s.push(Dy(h));for(s.sort(Ay),o=0;o<s.length;o++)e=Py(s[o],e);return e}function Ay(r,t){return r.x-t.x}function Py(r,t){var e=Iy(r,t);if(!e)return t;var i=Tp(e,r);return mi(i,i.next),mi(e,e.next)}function Iy(r,t){var e=t,i=r.x,s=r.y,o=-1/0,n;do{if(s<=e.y&&s>=e.next.y&&e.next.y!==e.y){var a=e.x+(s-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(a<=i&&a>o&&(o=a,n=e.x<e.next.x?e:e.next,a===i))return n}e=e.next}while(e!==t);if(!n)return null;var l=n,h=n.x,c=n.y,u=1/0,d;e=n;do i>=e.x&&e.x>=h&&i!==e.x&&es(s<c?i:o,s,h,c,s<c?o:i,s,e.x,e.y)&&(d=Math.abs(s-e.y)/(i-e.x),_o(e,r)&&(d<u||d===u&&(e.x>n.x||e.x===n.x&&My(n,e)))&&(n=e,u=d)),e=e.next;while(e!==l);return n}function My(r,t){return Et(r.prev,r,t.prev)<0&&Et(t.next,r,r.next)<0}function Ry(r,t,e,i){var s=r;do s.z===0&&(s.z=Rh(s.x,s.y,t,e,i)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==r);s.prevZ.nextZ=null,s.prevZ=null,Fy(s)}function Fy(r){var t,e,i,s,o,n,a,l,h=1;do{for(e=r,r=null,o=null,n=0;e;){for(n++,i=e,a=0,t=0;t<h&&(a++,i=i.nextZ,!!i);t++);for(l=h;a>0||l>0&&i;)a!==0&&(l===0||!i||e.z<=i.z)?(s=e,e=e.nextZ,a--):(s=i,i=i.nextZ,l--),o?o.nextZ=s:r=s,s.prevZ=o,o=s;e=i}o.nextZ=null,h*=2}while(n>1);return r}function Rh(r,t,e,i,s){return r=(r-e)*s|0,t=(t-i)*s|0,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,r|t<<1}function Dy(r){var t=r,e=r;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==r);return e}function es(r,t,e,i,s,o,n,a){return(s-n)*(t-a)>=(r-n)*(o-a)&&(r-n)*(i-a)>=(e-n)*(t-a)&&(e-n)*(o-a)>=(s-n)*(i-a)}function By(r,t){return r.next.i!==t.i&&r.prev.i!==t.i&&!Ly(r,t)&&(_o(r,t)&&_o(t,r)&&Oy(r,t)&&(Et(r.prev,r,t.prev)||Et(r,t.prev,t))||ca(r,t)&&Et(r.prev,r,r.next)>0&&Et(t.prev,t,t.next)>0)}function Et(r,t,e){return(t.y-r.y)*(e.x-t.x)-(t.x-r.x)*(e.y-t.y)}function ca(r,t){return r.x===t.x&&r.y===t.y}function bp(r,t,e,i){var s=la(Et(r,t,e)),o=la(Et(r,t,i)),n=la(Et(e,i,r)),a=la(Et(e,i,t));return!!(s!==o&&n!==a||s===0&&aa(r,e,t)||o===0&&aa(r,i,t)||n===0&&aa(e,r,i)||a===0&&aa(e,t,i))}function aa(r,t,e){return t.x<=Math.max(r.x,e.x)&&t.x>=Math.min(r.x,e.x)&&t.y<=Math.max(r.y,e.y)&&t.y>=Math.min(r.y,e.y)}function la(r){return r>0?1:r<0?-1:0}function Ly(r,t){var e=r;do{if(e.i!==r.i&&e.next.i!==r.i&&e.i!==t.i&&e.next.i!==t.i&&bp(e,e.next,r,t))return!0;e=e.next}while(e!==r);return!1}function _o(r,t){return Et(r.prev,r,r.next)<0?Et(r,t,r.next)>=0&&Et(r,r.prev,t)>=0:Et(r,t,r.prev)<0||Et(r,r.next,t)<0}function Oy(r,t){var e=r,i=!1,s=(r.x+t.x)/2,o=(r.y+t.y)/2;do e.y>o!=e.next.y>o&&e.next.y!==e.y&&s<(e.next.x-e.x)*(o-e.y)/(e.next.y-e.y)+e.x&&(i=!i),e=e.next;while(e!==r);return i}function Tp(r,t){var e=new Fh(r.i,r.x,r.y),i=new Fh(t.i,t.x,t.y),s=r.next,o=t.prev;return r.next=t,t.prev=r,e.next=s,s.prev=e,i.next=e,e.prev=i,o.next=i,i.prev=o,i}function vp(r,t,e,i){var s=new Fh(r,t,e);return i?(s.next=i.next,s.prev=i,i.next.prev=s,i.next=s):(s.prev=s,s.next=s),s}function bo(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Fh(r,t,e){this.i=r,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}ha.deviation=function(r,t,e,i){var s=t&&t.length,o=s?t[0]*e:r.length,n=Math.abs(Dh(r,0,o,e));if(s)for(var a=0,l=t.length;a<l;a++){var h=t[a]*e,c=a<l-1?t[a+1]*e:r.length;n-=Math.abs(Dh(r,h,c,e))}var u=0;for(a=0;a<i.length;a+=3){var d=i[a]*e,p=i[a+1]*e,f=i[a+2]*e;u+=Math.abs((r[d]-r[f])*(r[p+1]-r[d+1])-(r[d]-r[p])*(r[f+1]-r[d+1]))}return n===0&&u===0?0:Math.abs((u-n)/n)};function Dh(r,t,e,i){for(var s=0,o=t,n=e-i;o<e;o+=i)s+=(r[n]-r[o])*(r[o+1]+r[n+1]),n=o;return s}ha.flatten=function(r){for(var t=r[0][0].length,e={vertices:[],holes:[],dimensions:t},i=0,s=0;s<r.length;s++){for(var o=0;o<r[s].length;o++)for(var n=0;n<t;n++)e.vertices.push(r[s][o][n]);s>0&&(i+=r[s-1].length,e.holes.push(i))}return e}});var Cp=yt((rs,is)=>{(function(r){var t=typeof rs=="object"&&rs&&!rs.nodeType&&rs,e=typeof is=="object"&&is&&!is.nodeType&&is,i=typeof global=="object"&&global;(i.global===i||i.window===i||i.self===i)&&(r=i);var s,o=2147483647,n=36,a=1,l=26,h=38,c=700,u=72,d=128,p="-",f=/^xn--/,m=/[^\x20-\x7E]/,g=/[\x2E\u3002\uFF0E\uFF61]/g,x={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},b=n-a,y=Math.floor,_=String.fromCharCode,L;function W(M){throw new RangeError(x[M])}function F(M,k){for(var V=M.length,ht=[];V--;)ht[V]=k(M[V]);return ht}function B(M,k){var V=M.split("@"),ht="";V.length>1&&(ht=V[0]+"@",M=V[1]),M=M.replace(g,".");var wt=M.split("."),Mt=F(wt,k).join(".");return ht+Mt}function H(M){for(var k=[],V=0,ht=M.length,wt,Mt;V<ht;)wt=M.charCodeAt(V++),wt>=55296&&wt<=56319&&V<ht?(Mt=M.charCodeAt(V++),(Mt&64512)==56320?k.push(((wt&1023)<<10)+(Mt&1023)+65536):(k.push(wt),V--)):k.push(wt);return k}function Z(M){return F(M,function(k){var V="";return k>65535&&(k-=65536,V+=_(k>>>10&1023|55296),k=56320|k&1023),V+=_(k),V}).join("")}function O(M){return M-48<10?M-22:M-65<26?M-65:M-97<26?M-97:n}function G(M,k){return M+22+75*(M<26)-((k!=0)<<5)}function E(M,k,V){var ht=0;for(M=V?y(M/c):M>>1,M+=y(M/k);M>b*l>>1;ht+=n)M=y(M/b);return y(ht+(b+1)*M/(M+h))}function P(M){var k=[],V=M.length,ht,wt=0,Mt=d,Ct=u,Zt,me,ae,ge,Dt,Rt,Bt,Qt,le;for(Zt=M.lastIndexOf(p),Zt<0&&(Zt=0),me=0;me<Zt;++me)M.charCodeAt(me)>=128&&W("not-basic"),k.push(M.charCodeAt(me));for(ae=Zt>0?Zt+1:0;ae<V;){for(ge=wt,Dt=1,Rt=n;ae>=V&&W("invalid-input"),Bt=O(M.charCodeAt(ae++)),(Bt>=n||Bt>y((o-wt)/Dt))&&W("overflow"),wt+=Bt*Dt,Qt=Rt<=Ct?a:Rt>=Ct+l?l:Rt-Ct,!(Bt<Qt);Rt+=n)le=n-Qt,Dt>y(o/le)&&W("overflow"),Dt*=le;ht=k.length+1,Ct=E(wt-ge,ht,ge==0),y(wt/ht)>o-Mt&&W("overflow"),Mt+=y(wt/ht),wt%=ht,k.splice(wt++,0,Mt)}return Z(k)}function J(M){var k,V,ht,wt,Mt,Ct,Zt,me,ae,ge,Dt,Rt=[],Bt,Qt,le,go;for(M=H(M),Bt=M.length,k=d,V=0,Mt=u,Ct=0;Ct<Bt;++Ct)Dt=M[Ct],Dt<128&&Rt.push(_(Dt));for(ht=wt=Rt.length,wt&&Rt.push(p);ht<Bt;){for(Zt=o,Ct=0;Ct<Bt;++Ct)Dt=M[Ct],Dt>=k&&Dt<Zt&&(Zt=Dt);for(Qt=ht+1,Zt-k>y((o-V)/Qt)&&W("overflow"),V+=(Zt-k)*Qt,k=Zt,Ct=0;Ct<Bt;++Ct)if(Dt=M[Ct],Dt<k&&++V>o&&W("overflow"),Dt==k){for(me=V,ae=n;ge=ae<=Mt?a:ae>=Mt+l?l:ae-Mt,!(me<ge);ae+=n)go=me-ge,le=n-ge,Rt.push(_(G(ge+go%le,0))),me=y(go/le);Rt.push(_(G(me,0))),Mt=E(V,Qt,ht==wt),V=0,++ht}++V,++k}return Rt.join("")}function it(M){return B(M,function(k){return f.test(k)?P(k.slice(4).toLowerCase()):k})}function A(M){return B(M,function(k){return m.test(k)?"xn--"+J(k):k})}if(s={version:"1.4.1",ucs2:{decode:H,encode:Z},decode:P,encode:J,toASCII:A,toUnicode:it},typeof define=="function"&&typeof define.amd=="object"&&define.amd)define("punycode",function(){return s});else if(t&&e)if(is.exports==t)e.exports=s;else for(L in s)s.hasOwnProperty(L)&&(t[L]=s[L]);else r.punycode=s})(rs)});var Ep=yt((bA,Sp)=>{"use strict";Sp.exports=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var t={},e=Symbol("test"),i=Object(e);if(typeof e=="string"||Object.prototype.toString.call(e)!=="[object Symbol]"||Object.prototype.toString.call(i)!=="[object Symbol]")return!1;var s=42;t[e]=s;for(e in t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var o=Object.getOwnPropertySymbols(t);if(o.length!==1||o[0]!==e||!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var n=Object.getOwnPropertyDescriptor(t,e);if(n.value!==s||n.enumerable!==!0)return!1}return!0}});var Ip=yt((TA,Pp)=>{"use strict";var Ap=typeof Symbol<"u"&&Symbol,ky=Ep();Pp.exports=function(){return typeof Ap!="function"||typeof Symbol!="function"||typeof Ap("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:ky()}});var Fp=yt((wA,Rp)=>{"use strict";var Mp={foo:{}},Ny=Object;Rp.exports=function(){return{__proto__:Mp}.foo===Mp.foo&&!({__proto__:null}instanceof Ny)}});var Lp=yt((CA,Bp)=>{"use strict";var Uy="Function.prototype.bind called on incompatible ",Gy=Object.prototype.toString,zy=Math.max,Hy="[object Function]",Dp=function(t,e){for(var i=[],s=0;s<t.length;s+=1)i[s]=t[s];for(var o=0;o<e.length;o+=1)i[o+t.length]=e[o];return i},Vy=function(t,e){for(var i=[],s=e||0,o=0;s<t.length;s+=1,o+=1)i[o]=t[s];return i},jy=function(r,t){for(var e="",i=0;i<r.length;i+=1)e+=r[i],i+1<r.length&&(e+=t);return e};Bp.exports=function(t){var e=this;if(typeof e!="function"||Gy.apply(e)!==Hy)throw new TypeError(Uy+e);for(var i=Vy(arguments,1),s,o=function(){if(this instanceof s){var c=e.apply(this,Dp(i,arguments));return Object(c)===c?c:this}return e.apply(t,Dp(i,arguments))},n=zy(0,e.length-i.length),a=[],l=0;l<n;l++)a[l]="$"+l;if(s=Function("binder","return function ("+jy(a,",")+"){ return binder.apply(this,arguments); }")(o),e.prototype){var h=function(){};h.prototype=e.prototype,s.prototype=new h,h.prototype=null}return s}});var ua=yt((SA,Op)=>{"use strict";var Wy=Lp();Op.exports=Function.prototype.bind||Wy});var Np=yt((EA,kp)=>{"use strict";var Xy=Function.prototype.call,$y=Object.prototype.hasOwnProperty,Yy=ua();kp.exports=Yy.call(Xy,$y)});var Gr=yt((AA,Vp)=>{"use strict";var nt,as=SyntaxError,Hp=Function,ns=TypeError,Lh=function(r){try{return Hp('"use strict"; return ('+r+").constructor;")()}catch{}},gi=Object.getOwnPropertyDescriptor;if(gi)try{gi({},"")}catch{gi=null}var Oh=function(){throw new ns},Ky=gi?function(){try{return arguments.callee,Oh}catch{try{return gi(arguments,"callee").get}catch{return Oh}}}():Oh,ss=Ip()(),qy=Fp()(),Ot=Object.getPrototypeOf||(qy?function(r){return r.__proto__}:null),os={},Zy=typeof Uint8Array>"u"||!Ot?nt:Ot(Uint8Array),xi={"%AggregateError%":typeof AggregateError>"u"?nt:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?nt:ArrayBuffer,"%ArrayIteratorPrototype%":ss&&Ot?Ot([][Symbol.iterator]()):nt,"%AsyncFromSyncIteratorPrototype%":nt,"%AsyncFunction%":os,"%AsyncGenerator%":os,"%AsyncGeneratorFunction%":os,"%AsyncIteratorPrototype%":os,"%Atomics%":typeof Atomics>"u"?nt:Atomics,"%BigInt%":typeof BigInt>"u"?nt:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?nt:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?nt:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?nt:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":typeof Float32Array>"u"?nt:Float32Array,"%Float64Array%":typeof Float64Array>"u"?nt:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?nt:FinalizationRegistry,"%Function%":Hp,"%GeneratorFunction%":os,"%Int8Array%":typeof Int8Array>"u"?nt:Int8Array,"%Int16Array%":typeof Int16Array>"u"?nt:Int16Array,"%Int32Array%":typeof Int32Array>"u"?nt:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":ss&&Ot?Ot(Ot([][Symbol.iterator]())):nt,"%JSON%":typeof JSON=="object"?JSON:nt,"%Map%":typeof Map>"u"?nt:Map,"%MapIteratorPrototype%":typeof Map>"u"||!ss||!Ot?nt:Ot(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?nt:Promise,"%Proxy%":typeof Proxy>"u"?nt:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":typeof Reflect>"u"?nt:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?nt:Set,"%SetIteratorPrototype%":typeof Set>"u"||!ss||!Ot?nt:Ot(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?nt:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":ss&&Ot?Ot(""[Symbol.iterator]()):nt,"%Symbol%":ss?Symbol:nt,"%SyntaxError%":as,"%ThrowTypeError%":Ky,"%TypedArray%":Zy,"%TypeError%":ns,"%Uint8Array%":typeof Uint8Array>"u"?nt:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?nt:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?nt:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?nt:Uint32Array,"%URIError%":URIError,"%WeakMap%":typeof WeakMap>"u"?nt:WeakMap,"%WeakRef%":typeof WeakRef>"u"?nt:WeakRef,"%WeakSet%":typeof WeakSet>"u"?nt:WeakSet};if(Ot)try{null.error}catch(r){Up=Ot(Ot(r)),xi["%Error.prototype%"]=Up}var Up,Qy=function r(t){var e;if(t==="%AsyncFunction%")e=Lh("async function () {}");else if(t==="%GeneratorFunction%")e=Lh("function* () {}");else if(t==="%AsyncGeneratorFunction%")e=Lh("async function* () {}");else if(t==="%AsyncGenerator%"){var i=r("%AsyncGeneratorFunction%");i&&(e=i.prototype)}else if(t==="%AsyncIteratorPrototype%"){var s=r("%AsyncGenerator%");s&&Ot&&(e=Ot(s.prototype))}return xi[t]=e,e},Gp={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},To=ua(),da=Np(),Jy=To.call(Function.call,Array.prototype.concat),tv=To.call(Function.apply,Array.prototype.splice),zp=To.call(Function.call,String.prototype.replace),pa=To.call(Function.call,String.prototype.slice),ev=To.call(Function.call,RegExp.prototype.exec),rv=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,iv=/\\(\\)?/g,sv=function(t){var e=pa(t,0,1),i=pa(t,-1);if(e==="%"&&i!=="%")throw new as("invalid intrinsic syntax, expected closing `%`");if(i==="%"&&e!=="%")throw new as("invalid intrinsic syntax, expected opening `%`");var s=[];return zp(t,rv,function(o,n,a,l){s[s.length]=a?zp(l,iv,"$1"):n||o}),s},ov=function(t,e){var i=t,s;if(da(Gp,i)&&(s=Gp[i],i="%"+s[0]+"%"),da(xi,i)){var o=xi[i];if(o===os&&(o=Qy(i)),typeof o>"u"&&!e)throw new ns("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:s,name:i,value:o}}throw new as("intrinsic "+t+" does not exist!")};Vp.exports=function(t,e){if(typeof t!="string"||t.length===0)throw new ns("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof e!="boolean")throw new ns('"allowMissing" argument must be a boolean');if(ev(/^%?[^%]*%?$/,t)===null)throw new as("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var i=sv(t),s=i.length>0?i[0]:"",o=ov("%"+s+"%",e),n=o.name,a=o.value,l=!1,h=o.alias;h&&(s=h[0],tv(i,Jy([0,1],h)));for(var c=1,u=!0;c<i.length;c+=1){var d=i[c],p=pa(d,0,1),f=pa(d,-1);if((p==='"'||p==="'"||p==="`"||f==='"'||f==="'"||f==="`")&&p!==f)throw new as("property names with quotes must have matching quotes");if((d==="constructor"||!u)&&(l=!0),s+="."+d,n="%"+s+"%",da(xi,n))a=xi[n];else if(a!=null){if(!(d in a)){if(!e)throw new ns("base intrinsic for "+t+" exists, but the property is not available.");return}if(gi&&c+1>=i.length){var m=gi(a,d);u=!!m,u&&"get"in m&&!("originalValue"in m.get)?a=m.get:a=a[d]}else u=da(a,d),a=a[d];u&&!l&&(xi[n]=a)}}return a}});var Uh=yt((PA,jp)=>{"use strict";var nv=Gr(),kh=nv("%Object.defineProperty%",!0),Nh=function(){if(kh)try{return kh({},"a",{value:1}),!0}catch{return!1}return!1};Nh.hasArrayLengthDefineBug=function(){if(!Nh())return null;try{return kh([],"length",{value:1}).length!==1}catch{return!0}};jp.exports=Nh});var Gh=yt((IA,Wp)=>{"use strict";var av=Gr(),fa=av("%Object.getOwnPropertyDescriptor%",!0);if(fa)try{fa([],"length")}catch{fa=null}Wp.exports=fa});var Yp=yt((MA,$p)=>{"use strict";var lv=Uh()(),zh=Gr(),wo=lv&&zh("%Object.defineProperty%",!0);if(wo)try{wo({},"a",{value:1})}catch{wo=!1}var hv=zh("%SyntaxError%"),ls=zh("%TypeError%"),Xp=Gh();$p.exports=function(t,e,i){if(!t||typeof t!="object"&&typeof t!="function")throw new ls("`obj` must be an object or a function`");if(typeof e!="string"&&typeof e!="symbol")throw new ls("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new ls("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new ls("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new ls("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new ls("`loose`, if provided, must be a boolean");var s=arguments.length>3?arguments[3]:null,o=arguments.length>4?arguments[4]:null,n=arguments.length>5?arguments[5]:null,a=arguments.length>6?arguments[6]:!1,l=!!Xp&&Xp(t,e);if(wo)wo(t,e,{configurable:n===null&&l?l.configurable:!n,enumerable:s===null&&l?l.enumerable:!s,value:i,writable:o===null&&l?l.writable:!o});else if(a||!s&&!o&&!n)t[e]=i;else throw new hv("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")}});var tf=yt((RA,Jp)=>{"use strict";var Qp=Gr(),Kp=Yp(),cv=Uh()(),qp=Gh(),Zp=Qp("%TypeError%"),uv=Qp("%Math.floor%");Jp.exports=function(t,e){if(typeof t!="function")throw new Zp("`fn` is not a function");if(typeof e!="number"||e<0||e>4294967295||uv(e)!==e)throw new Zp("`length` must be a positive 32-bit integer");var i=arguments.length>2&&!!arguments[2],s=!0,o=!0;if("length"in t&&qp){var n=qp(t,"length");n&&!n.configurable&&(s=!1),n&&!n.writable&&(o=!1)}return(s||o||!i)&&(cv?Kp(t,"length",e,!0,!0):Kp(t,"length",e)),t}});var nf=yt((FA,ma)=>{"use strict";var Hh=ua(),hs=Gr(),dv=tf(),pv=hs("%TypeError%"),rf=hs("%Function.prototype.apply%"),sf=hs("%Function.prototype.call%"),of=hs("%Reflect.apply%",!0)||Hh.call(sf,rf),Co=hs("%Object.defineProperty%",!0),fv=hs("%Math.max%");if(Co)try{Co({},"a",{value:1})}catch{Co=null}ma.exports=function(t){if(typeof t!="function")throw new pv("a function is required");var e=of(Hh,sf,arguments);return dv(e,1+fv(0,t.length-(arguments.length-1)),!0)};var ef=function(){return of(Hh,rf,arguments)};Co?Co(ma.exports,"apply",{value:ef}):ma.exports.apply=ef});var cf=yt((DA,hf)=>{"use strict";var af=Gr(),lf=nf(),mv=lf(af("String.prototype.indexOf"));hf.exports=function(t,e){var i=af(t,!!e);return typeof i=="function"&&mv(t,".prototype.")>-1?lf(i):i}});var uf=yt(()=>{});var Rf=yt((OA,Mf)=>{var Qh=typeof Map=="function"&&Map.prototype,Vh=Object.getOwnPropertyDescriptor&&Qh?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,xa=Qh&&Vh&&typeof Vh.get=="function"?Vh.get:null,df=Qh&&Map.prototype.forEach,Jh=typeof Set=="function"&&Set.prototype,jh=Object.getOwnPropertyDescriptor&&Jh?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,ya=Jh&&jh&&typeof jh.get=="function"?jh.get:null,pf=Jh&&Set.prototype.forEach,gv=typeof WeakMap=="function"&&WeakMap.prototype,Eo=gv?WeakMap.prototype.has:null,xv=typeof WeakSet=="function"&&WeakSet.prototype,Ao=xv?WeakSet.prototype.has:null,yv=typeof WeakRef=="function"&&WeakRef.prototype,ff=yv?WeakRef.prototype.deref:null,vv=Boolean.prototype.valueOf,_v=Object.prototype.toString,bv=Function.prototype.toString,Tv=String.prototype.match,tc=String.prototype.slice,Hr=String.prototype.replace,wv=String.prototype.toUpperCase,mf=String.prototype.toLowerCase,Cf=RegExp.prototype.test,gf=Array.prototype.concat,ir=Array.prototype.join,Cv=Array.prototype.slice,xf=Math.floor,$h=typeof BigInt=="function"?BigInt.prototype.valueOf:null,Wh=Object.getOwnPropertySymbols,Yh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,cs=typeof Symbol=="function"&&typeof Symbol.iterator=="object",te=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===cs||!0)?Symbol.toStringTag:null,Sf=Object.prototype.propertyIsEnumerable,yf=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(r){return r.__proto__}:null);function vf(r,t){if(r===1/0||r===-1/0||r!==r||r&&r>-1e3&&r<1e3||Cf.call(/e/,t))return t;var e=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof r=="number"){var i=r<0?-xf(-r):xf(r);if(i!==r){var s=String(i),o=tc.call(t,s.length+1);return Hr.call(s,e,"$&_")+"."+Hr.call(Hr.call(o,/([0-9]{3})/g,"$&_"),/_$/,"")}}return Hr.call(t,e,"$&_")}var Kh=uf(),_f=Kh.custom,bf=Af(_f)?_f:null;Mf.exports=function r(t,e,i,s){var o=e||{};if(zr(o,"quoteStyle")&&o.quoteStyle!=="single"&&o.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(zr(o,"maxStringLength")&&(typeof o.maxStringLength=="number"?o.maxStringLength<0&&o.maxStringLength!==1/0:o.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var n=zr(o,"customInspect")?o.customInspect:!0;if(typeof n!="boolean"&&n!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(zr(o,"indent")&&o.indent!==null&&o.indent!=="	"&&!(parseInt(o.indent,10)===o.indent&&o.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(zr(o,"numericSeparator")&&typeof o.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var a=o.numericSeparator;if(typeof t>"u")return"undefined";if(t===null)return"null";if(typeof t=="boolean")return t?"true":"false";if(typeof t=="string")return If(t,o);if(typeof t=="number"){if(t===0)return 1/0/t>0?"0":"-0";var l=String(t);return a?vf(t,l):l}if(typeof t=="bigint"){var h=String(t)+"n";return a?vf(t,h):h}var c=typeof o.depth>"u"?5:o.depth;if(typeof i>"u"&&(i=0),i>=c&&c>0&&typeof t=="object")return qh(t)?"[Array]":"[Object]";var u=Hv(o,i);if(typeof s>"u")s=[];else if(Pf(s,t)>=0)return"[Circular]";function d(E,P,J){if(P&&(s=Cv.call(s),s.push(P)),J){var it={depth:o.depth};return zr(o,"quoteStyle")&&(it.quoteStyle=o.quoteStyle),r(E,it,i+1,s)}return r(E,o,i+1,s)}if(typeof t=="function"&&!Tf(t)){var p=Dv(t),f=ga(t,d);return"[Function"+(p?": "+p:" (anonymous)")+"]"+(f.length>0?" { "+ir.call(f,", ")+" }":"")}if(Af(t)){var m=cs?Hr.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):Yh.call(t);return typeof t=="object"&&!cs?So(m):m}if(Uv(t)){for(var g="<"+mf.call(String(t.nodeName)),x=t.attributes||[],b=0;b<x.length;b++)g+=" "+x[b].name+"="+Ef(Sv(x[b].value),"double",o);return g+=">",t.childNodes&&t.childNodes.length&&(g+="..."),g+="</"+mf.call(String(t.nodeName))+">",g}if(qh(t)){if(t.length===0)return"[]";var y=ga(t,d);return u&&!zv(y)?"["+Zh(y,u)+"]":"[ "+ir.call(y,", ")+" ]"}if(Av(t)){var _=ga(t,d);return!("cause"in Error.prototype)&&"cause"in t&&!Sf.call(t,"cause")?"{ ["+String(t)+"] "+ir.call(gf.call("[cause]: "+d(t.cause),_),", ")+" }":_.length===0?"["+String(t)+"]":"{ ["+String(t)+"] "+ir.call(_,", ")+" }"}if(typeof t=="object"&&n){if(bf&&typeof t[bf]=="function"&&Kh)return Kh(t,{depth:c-i});if(n!=="symbol"&&typeof t.inspect=="function")return t.inspect()}if(Bv(t)){var L=[];return df&&df.call(t,function(E,P){L.push(d(P,t,!0)+" => "+d(E,t))}),wf("Map",xa.call(t),L,u)}if(kv(t)){var W=[];return pf&&pf.call(t,function(E){W.push(d(E,t))}),wf("Set",ya.call(t),W,u)}if(Lv(t))return Xh("WeakMap");if(Nv(t))return Xh("WeakSet");if(Ov(t))return Xh("WeakRef");if(Iv(t))return So(d(Number(t)));if(Rv(t))return So(d($h.call(t)));if(Mv(t))return So(vv.call(t));if(Pv(t))return So(d(String(t)));if(typeof window<"u"&&t===window)return"{ [object Window] }";if(t===global)return"{ [object globalThis] }";if(!Ev(t)&&!Tf(t)){var F=ga(t,d),B=yf?yf(t)===Object.prototype:t instanceof Object||t.constructor===Object,H=t instanceof Object?"":"null prototype",Z=!B&&te&&Object(t)===t&&te in t?tc.call(Vr(t),8,-1):H?"Object":"",O=B||typeof t.constructor!="function"?"":t.constructor.name?t.constructor.name+" ":"",G=O+(Z||H?"["+ir.call(gf.call([],Z||[],H||[]),": ")+"] ":"");return F.length===0?G+"{}":u?G+"{"+Zh(F,u)+"}":G+"{ "+ir.call(F,", ")+" }"}return String(t)};function Ef(r,t,e){var i=(e.quoteStyle||t)==="double"?'"':"'";return i+r+i}function Sv(r){return Hr.call(String(r),/"/g,"&quot;")}function qh(r){return Vr(r)==="[object Array]"&&(!te||!(typeof r=="object"&&te in r))}function Ev(r){return Vr(r)==="[object Date]"&&(!te||!(typeof r=="object"&&te in r))}function Tf(r){return Vr(r)==="[object RegExp]"&&(!te||!(typeof r=="object"&&te in r))}function Av(r){return Vr(r)==="[object Error]"&&(!te||!(typeof r=="object"&&te in r))}function Pv(r){return Vr(r)==="[object String]"&&(!te||!(typeof r=="object"&&te in r))}function Iv(r){return Vr(r)==="[object Number]"&&(!te||!(typeof r=="object"&&te in r))}function Mv(r){return Vr(r)==="[object Boolean]"&&(!te||!(typeof r=="object"&&te in r))}function Af(r){if(cs)return r&&typeof r=="object"&&r instanceof Symbol;if(typeof r=="symbol")return!0;if(!r||typeof r!="object"||!Yh)return!1;try{return Yh.call(r),!0}catch{}return!1}function Rv(r){if(!r||typeof r!="object"||!$h)return!1;try{return $h.call(r),!0}catch{}return!1}var Fv=Object.prototype.hasOwnProperty||function(r){return r in this};function zr(r,t){return Fv.call(r,t)}function Vr(r){return _v.call(r)}function Dv(r){if(r.name)return r.name;var t=Tv.call(bv.call(r),/^function\s*([\w$]+)/);return t?t[1]:null}function Pf(r,t){if(r.indexOf)return r.indexOf(t);for(var e=0,i=r.length;e<i;e++)if(r[e]===t)return e;return-1}function Bv(r){if(!xa||!r||typeof r!="object")return!1;try{xa.call(r);try{ya.call(r)}catch{return!0}return r instanceof Map}catch{}return!1}function Lv(r){if(!Eo||!r||typeof r!="object")return!1;try{Eo.call(r,Eo);try{Ao.call(r,Ao)}catch{return!0}return r instanceof WeakMap}catch{}return!1}function Ov(r){if(!ff||!r||typeof r!="object")return!1;try{return ff.call(r),!0}catch{}return!1}function kv(r){if(!ya||!r||typeof r!="object")return!1;try{ya.call(r);try{xa.call(r)}catch{return!0}return r instanceof Set}catch{}return!1}function Nv(r){if(!Ao||!r||typeof r!="object")return!1;try{Ao.call(r,Ao);try{Eo.call(r,Eo)}catch{return!0}return r instanceof WeakSet}catch{}return!1}function Uv(r){return!r||typeof r!="object"?!1:typeof HTMLElement<"u"&&r instanceof HTMLElement?!0:typeof r.nodeName=="string"&&typeof r.getAttribute=="function"}function If(r,t){if(r.length>t.maxStringLength){var e=r.length-t.maxStringLength,i="... "+e+" more character"+(e>1?"s":"");return If(tc.call(r,0,t.maxStringLength),t)+i}var s=Hr.call(Hr.call(r,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,Gv);return Ef(s,"single",t)}function Gv(r){var t=r.charCodeAt(0),e={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return e?"\\"+e:"\\x"+(t<16?"0":"")+wv.call(t.toString(16))}function So(r){return"Object("+r+")"}function Xh(r){return r+" { ? }"}function wf(r,t,e,i){var s=i?Zh(e,i):ir.call(e,", ");return r+" ("+t+") {"+s+"}"}function zv(r){for(var t=0;t<r.length;t++)if(Pf(r[t],`
`)>=0)return!1;return!0}function Hv(r,t){var e;if(r.indent==="	")e="	";else if(typeof r.indent=="number"&&r.indent>0)e=ir.call(Array(r.indent+1)," ");else return null;return{base:e,prev:ir.call(Array(t+1),e)}}function Zh(r,t){if(r.length===0)return"";var e=`
`+t.prev+t.base;return e+ir.call(r,","+e)+`
`+t.prev}function ga(r,t){var e=qh(r),i=[];if(e){i.length=r.length;for(var s=0;s<r.length;s++)i[s]=zr(r,s)?t(r[s],r):""}var o=typeof Wh=="function"?Wh(r):[],n;if(cs){n={};for(var a=0;a<o.length;a++)n["$"+o[a]]=o[a]}for(var l in r)zr(r,l)&&(e&&String(Number(l))===l&&l<r.length||cs&&n["$"+l]instanceof Symbol||(Cf.call(/[^\w$]/,l)?i.push(t(l,r)+": "+t(r[l],r)):i.push(l+": "+t(r[l],r))));if(typeof Wh=="function")for(var h=0;h<o.length;h++)Sf.call(r,o[h])&&i.push("["+t(o[h])+"]: "+t(r[o[h]],r));return i}});var Df=yt((kA,Ff)=>{"use strict";var ec=Gr(),us=cf(),Vv=Rf(),jv=ec("%TypeError%"),va=ec("%WeakMap%",!0),_a=ec("%Map%",!0),Wv=us("WeakMap.prototype.get",!0),Xv=us("WeakMap.prototype.set",!0),$v=us("WeakMap.prototype.has",!0),Yv=us("Map.prototype.get",!0),Kv=us("Map.prototype.set",!0),qv=us("Map.prototype.has",!0),rc=function(r,t){for(var e=r,i;(i=e.next)!==null;e=i)if(i.key===t)return e.next=i.next,i.next=r.next,r.next=i,i},Zv=function(r,t){var e=rc(r,t);return e&&e.value},Qv=function(r,t,e){var i=rc(r,t);i?i.value=e:r.next={key:t,next:r.next,value:e}},Jv=function(r,t){return!!rc(r,t)};Ff.exports=function(){var t,e,i,s={assert:function(o){if(!s.has(o))throw new jv("Side channel does not contain "+Vv(o))},get:function(o){if(va&&o&&(typeof o=="object"||typeof o=="function")){if(t)return Wv(t,o)}else if(_a){if(e)return Yv(e,o)}else if(i)return Zv(i,o)},has:function(o){if(va&&o&&(typeof o=="object"||typeof o=="function")){if(t)return $v(t,o)}else if(_a){if(e)return qv(e,o)}else if(i)return Jv(i,o);return!1},set:function(o,n){va&&o&&(typeof o=="object"||typeof o=="function")?(t||(t=new va),Xv(t,o,n)):_a?(e||(e=new _a),Kv(e,o,n)):(i||(i={key:{},next:null}),Qv(i,o,n))}};return s}});var ba=yt((NA,Bf)=>{"use strict";var t_=String.prototype.replace,e_=/%20/g,ic={RFC1738:"RFC1738",RFC3986:"RFC3986"};Bf.exports={default:ic.RFC3986,formatters:{RFC1738:function(r){return t_.call(r,e_,"+")},RFC3986:function(r){return String(r)}},RFC1738:ic.RFC1738,RFC3986:ic.RFC3986}});var oc=yt((UA,Of)=>{"use strict";var r_=ba(),sc=Object.prototype.hasOwnProperty,yi=Array.isArray,sr=function(){for(var r=[],t=0;t<256;++t)r.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return r}(),i_=function(t){for(;t.length>1;){var e=t.pop(),i=e.obj[e.prop];if(yi(i)){for(var s=[],o=0;o<i.length;++o)typeof i[o]<"u"&&s.push(i[o]);e.obj[e.prop]=s}}},Lf=function(t,e){for(var i=e&&e.plainObjects?Object.create(null):{},s=0;s<t.length;++s)typeof t[s]<"u"&&(i[s]=t[s]);return i},s_=function r(t,e,i){if(!e)return t;if(typeof e!="object"){if(yi(t))t.push(e);else if(t&&typeof t=="object")(i&&(i.plainObjects||i.allowPrototypes)||!sc.call(Object.prototype,e))&&(t[e]=!0);else return[t,e];return t}if(!t||typeof t!="object")return[t].concat(e);var s=t;return yi(t)&&!yi(e)&&(s=Lf(t,i)),yi(t)&&yi(e)?(e.forEach(function(o,n){if(sc.call(t,n)){var a=t[n];a&&typeof a=="object"&&o&&typeof o=="object"?t[n]=r(a,o,i):t.push(o)}else t[n]=o}),t):Object.keys(e).reduce(function(o,n){var a=e[n];return sc.call(o,n)?o[n]=r(o[n],a,i):o[n]=a,o},s)},o_=function(t,e){return Object.keys(e).reduce(function(i,s){return i[s]=e[s],i},t)},n_=function(r,t,e){var i=r.replace(/\+/g," ");if(e==="iso-8859-1")return i.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(i)}catch{return i}},a_=function(t,e,i,s,o){if(t.length===0)return t;var n=t;if(typeof t=="symbol"?n=Symbol.prototype.toString.call(t):typeof t!="string"&&(n=String(t)),i==="iso-8859-1")return escape(n).replace(/%u[0-9a-f]{4}/gi,function(c){return"%26%23"+parseInt(c.slice(2),16)+"%3B"});for(var a="",l=0;l<n.length;++l){var h=n.charCodeAt(l);if(h===45||h===46||h===95||h===126||h>=48&&h<=57||h>=65&&h<=90||h>=97&&h<=122||o===r_.RFC1738&&(h===40||h===41)){a+=n.charAt(l);continue}if(h<128){a=a+sr[h];continue}if(h<2048){a=a+(sr[192|h>>6]+sr[128|h&63]);continue}if(h<55296||h>=57344){a=a+(sr[224|h>>12]+sr[128|h>>6&63]+sr[128|h&63]);continue}l+=1,h=65536+((h&1023)<<10|n.charCodeAt(l)&1023),a+=sr[240|h>>18]+sr[128|h>>12&63]+sr[128|h>>6&63]+sr[128|h&63]}return a},l_=function(t){for(var e=[{obj:{o:t},prop:"o"}],i=[],s=0;s<e.length;++s)for(var o=e[s],n=o.obj[o.prop],a=Object.keys(n),l=0;l<a.length;++l){var h=a[l],c=n[h];typeof c=="object"&&c!==null&&i.indexOf(c)===-1&&(e.push({obj:n,prop:h}),i.push(c))}return i_(e),t},h_=function(t){return Object.prototype.toString.call(t)==="[object RegExp]"},c_=function(t){return!t||typeof t!="object"?!1:!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))},u_=function(t,e){return[].concat(t,e)},d_=function(t,e){if(yi(t)){for(var i=[],s=0;s<t.length;s+=1)i.push(e(t[s]));return i}return e(t)};Of.exports={arrayToObject:Lf,assign:o_,combine:u_,compact:l_,decode:n_,encode:a_,isBuffer:c_,isRegExp:h_,maybeMap:d_,merge:s_}});var Hf=yt((GA,zf)=>{"use strict";var Uf=Df(),Ta=oc(),Po=ba(),p_=Object.prototype.hasOwnProperty,kf={brackets:function(t){return t+"[]"},comma:"comma",indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},wr=Array.isArray,f_=Array.prototype.push,Gf=function(r,t){f_.apply(r,wr(t)?t:[t])},m_=Date.prototype.toISOString,Nf=Po.default,ee={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:Ta.encode,encodeValuesOnly:!1,format:Nf,formatter:Po.formatters[Nf],indices:!1,serializeDate:function(t){return m_.call(t)},skipNulls:!1,strictNullHandling:!1},g_=function(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||typeof t=="symbol"||typeof t=="bigint"},nc={},x_=function r(t,e,i,s,o,n,a,l,h,c,u,d,p,f,m,g){for(var x=t,b=g,y=0,_=!1;(b=b.get(nc))!==void 0&&!_;){var L=b.get(t);if(y+=1,typeof L<"u"){if(L===y)throw new RangeError("Cyclic object value");_=!0}typeof b.get(nc)>"u"&&(y=0)}if(typeof l=="function"?x=l(e,x):x instanceof Date?x=u(x):i==="comma"&&wr(x)&&(x=Ta.maybeMap(x,function(it){return it instanceof Date?u(it):it})),x===null){if(o)return a&&!f?a(e,ee.encoder,m,"key",d):e;x=""}if(g_(x)||Ta.isBuffer(x)){if(a){var W=f?e:a(e,ee.encoder,m,"key",d);return[p(W)+"="+p(a(x,ee.encoder,m,"value",d))]}return[p(e)+"="+p(String(x))]}var F=[];if(typeof x>"u")return F;var B;if(i==="comma"&&wr(x))f&&a&&(x=Ta.maybeMap(x,a)),B=[{value:x.length>0?x.join(",")||null:void 0}];else if(wr(l))B=l;else{var H=Object.keys(x);B=h?H.sort(h):H}for(var Z=s&&wr(x)&&x.length===1?e+"[]":e,O=0;O<B.length;++O){var G=B[O],E=typeof G=="object"&&typeof G.value<"u"?G.value:x[G];if(!(n&&E===null)){var P=wr(x)?typeof i=="function"?i(Z,G):Z:Z+(c?"."+G:"["+G+"]");g.set(t,y);var J=Uf();J.set(nc,g),Gf(F,r(E,P,i,s,o,n,i==="comma"&&f&&wr(x)?null:a,l,h,c,u,d,p,f,m,J))}}return F},y_=function(t){if(!t)return ee;if(t.encoder!==null&&typeof t.encoder<"u"&&typeof t.encoder!="function")throw new TypeError("Encoder has to be a function.");var e=t.charset||ee.charset;if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var i=Po.default;if(typeof t.format<"u"){if(!p_.call(Po.formatters,t.format))throw new TypeError("Unknown format option provided.");i=t.format}var s=Po.formatters[i],o=ee.filter;return(typeof t.filter=="function"||wr(t.filter))&&(o=t.filter),{addQueryPrefix:typeof t.addQueryPrefix=="boolean"?t.addQueryPrefix:ee.addQueryPrefix,allowDots:typeof t.allowDots>"u"?ee.allowDots:!!t.allowDots,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:ee.charsetSentinel,delimiter:typeof t.delimiter>"u"?ee.delimiter:t.delimiter,encode:typeof t.encode=="boolean"?t.encode:ee.encode,encoder:typeof t.encoder=="function"?t.encoder:ee.encoder,encodeValuesOnly:typeof t.encodeValuesOnly=="boolean"?t.encodeValuesOnly:ee.encodeValuesOnly,filter:o,format:i,formatter:s,serializeDate:typeof t.serializeDate=="function"?t.serializeDate:ee.serializeDate,skipNulls:typeof t.skipNulls=="boolean"?t.skipNulls:ee.skipNulls,sort:typeof t.sort=="function"?t.sort:null,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:ee.strictNullHandling}};zf.exports=function(r,t){var e=r,i=y_(t),s,o;typeof i.filter=="function"?(o=i.filter,e=o("",e)):wr(i.filter)&&(o=i.filter,s=o);var n=[];if(typeof e!="object"||e===null)return"";var a;t&&t.arrayFormat in kf?a=t.arrayFormat:t&&"indices"in t?a=t.indices?"indices":"repeat":a="indices";var l=kf[a];if(t&&"commaRoundTrip"in t&&typeof t.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var h=l==="comma"&&t&&t.commaRoundTrip;s||(s=Object.keys(e)),i.sort&&s.sort(i.sort);for(var c=Uf(),u=0;u<s.length;++u){var d=s[u];i.skipNulls&&e[d]===null||Gf(n,x_(e[d],d,l,h,i.strictNullHandling,i.skipNulls,i.encode?i.encoder:null,i.filter,i.sort,i.allowDots,i.serializeDate,i.format,i.formatter,i.encodeValuesOnly,i.charset,c))}var p=n.join(i.delimiter),f=i.addQueryPrefix===!0?"?":"";return i.charsetSentinel&&(i.charset==="iso-8859-1"?f+="utf8=%26%2310003%3B&":f+="utf8=%E2%9C%93&"),p.length>0?f+p:""}});var Wf=yt((zA,jf)=>{"use strict";var ds=oc(),ac=Object.prototype.hasOwnProperty,v_=Array.isArray,kt={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:ds.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},__=function(r){return r.replace(/&#(\d+);/g,function(t,e){return String.fromCharCode(parseInt(e,10))})},Vf=function(r,t){return r&&typeof r=="string"&&t.comma&&r.indexOf(",")>-1?r.split(","):r},b_="utf8=%26%2310003%3B",T_="utf8=%E2%9C%93",w_=function(t,e){var i={__proto__:null},s=e.ignoreQueryPrefix?t.replace(/^\?/,""):t,o=e.parameterLimit===1/0?void 0:e.parameterLimit,n=s.split(e.delimiter,o),a=-1,l,h=e.charset;if(e.charsetSentinel)for(l=0;l<n.length;++l)n[l].indexOf("utf8=")===0&&(n[l]===T_?h="utf-8":n[l]===b_&&(h="iso-8859-1"),a=l,l=n.length);for(l=0;l<n.length;++l)if(l!==a){var c=n[l],u=c.indexOf("]="),d=u===-1?c.indexOf("="):u+1,p,f;d===-1?(p=e.decoder(c,kt.decoder,h,"key"),f=e.strictNullHandling?null:""):(p=e.decoder(c.slice(0,d),kt.decoder,h,"key"),f=ds.maybeMap(Vf(c.slice(d+1),e),function(m){return e.decoder(m,kt.decoder,h,"value")})),f&&e.interpretNumericEntities&&h==="iso-8859-1"&&(f=__(f)),c.indexOf("[]=")>-1&&(f=v_(f)?[f]:f),ac.call(i,p)?i[p]=ds.combine(i[p],f):i[p]=f}return i},C_=function(r,t,e,i){for(var s=i?t:Vf(t,e),o=r.length-1;o>=0;--o){var n,a=r[o];if(a==="[]"&&e.parseArrays)n=[].concat(s);else{n=e.plainObjects?Object.create(null):{};var l=a.charAt(0)==="["&&a.charAt(a.length-1)==="]"?a.slice(1,-1):a,h=parseInt(l,10);!e.parseArrays&&l===""?n={0:s}:!isNaN(h)&&a!==l&&String(h)===l&&h>=0&&e.parseArrays&&h<=e.arrayLimit?(n=[],n[h]=s):l!=="__proto__"&&(n[l]=s)}s=n}return s},S_=function(t,e,i,s){if(t){var o=i.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,n=/(\[[^[\]]*])/,a=/(\[[^[\]]*])/g,l=i.depth>0&&n.exec(o),h=l?o.slice(0,l.index):o,c=[];if(h){if(!i.plainObjects&&ac.call(Object.prototype,h)&&!i.allowPrototypes)return;c.push(h)}for(var u=0;i.depth>0&&(l=a.exec(o))!==null&&u<i.depth;){if(u+=1,!i.plainObjects&&ac.call(Object.prototype,l[1].slice(1,-1))&&!i.allowPrototypes)return;c.push(l[1])}return l&&c.push("["+o.slice(l.index)+"]"),C_(c,e,i,s)}},E_=function(t){if(!t)return kt;if(t.decoder!==null&&t.decoder!==void 0&&typeof t.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var e=typeof t.charset>"u"?kt.charset:t.charset;return{allowDots:typeof t.allowDots>"u"?kt.allowDots:!!t.allowDots,allowPrototypes:typeof t.allowPrototypes=="boolean"?t.allowPrototypes:kt.allowPrototypes,allowSparse:typeof t.allowSparse=="boolean"?t.allowSparse:kt.allowSparse,arrayLimit:typeof t.arrayLimit=="number"?t.arrayLimit:kt.arrayLimit,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:kt.charsetSentinel,comma:typeof t.comma=="boolean"?t.comma:kt.comma,decoder:typeof t.decoder=="function"?t.decoder:kt.decoder,delimiter:typeof t.delimiter=="string"||ds.isRegExp(t.delimiter)?t.delimiter:kt.delimiter,depth:typeof t.depth=="number"||t.depth===!1?+t.depth:kt.depth,ignoreQueryPrefix:t.ignoreQueryPrefix===!0,interpretNumericEntities:typeof t.interpretNumericEntities=="boolean"?t.interpretNumericEntities:kt.interpretNumericEntities,parameterLimit:typeof t.parameterLimit=="number"?t.parameterLimit:kt.parameterLimit,parseArrays:t.parseArrays!==!1,plainObjects:typeof t.plainObjects=="boolean"?t.plainObjects:kt.plainObjects,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:kt.strictNullHandling}};jf.exports=function(r,t){var e=E_(t);if(r===""||r===null||typeof r>"u")return e.plainObjects?Object.create(null):{};for(var i=typeof r=="string"?w_(r,e):r,s=e.plainObjects?Object.create(null):{},o=Object.keys(i),n=0;n<o.length;++n){var a=o[n],l=S_(a,i[a],e,typeof r=="string");s=ds.merge(s,l,e)}return e.allowSparse===!0?s:ds.compact(s)}});var $f=yt((HA,Xf)=>{"use strict";var A_=Hf(),P_=Wf(),I_=ba();Xf.exports={formats:I_,parse:P_,stringify:A_}});var Zf=yt(fs=>{"use strict";var M_=Cp();function Be(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var R_=/^([a-z0-9.+-]+:)/i,F_=/:[0-9]*$/,D_=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,B_=["<",">",'"',"`"," ","\r",`
`,"	"],L_=["{","}","|","\\","^","`"].concat(B_),lc=["'"].concat(L_),Yf=["%","/","?",";","#"].concat(lc),Kf=["/","?","#"],O_=255,qf=/^[+a-z0-9A-Z_-]{0,63}$/,k_=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,N_={javascript:!0,"javascript:":!0},hc={javascript:!0,"javascript:":!0},ps={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},cc=$f();function Io(r,t,e){if(r&&typeof r=="object"&&r instanceof Be)return r;var i=new Be;return i.parse(r,t,e),i}Be.prototype.parse=function(r,t,e){if(typeof r!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof r);var i=r.indexOf("?"),s=i!==-1&&i<r.indexOf("#")?"?":"#",o=r.split(s),n=/\\/g;o[0]=o[0].replace(n,"/"),r=o.join(s);var a=r;if(a=a.trim(),!e&&r.split("#").length===1){var l=D_.exec(a);if(l)return this.path=a,this.href=a,this.pathname=l[1],l[2]?(this.search=l[2],t?this.query=cc.parse(this.search.substr(1)):this.query=this.search.substr(1)):t&&(this.search="",this.query={}),this}var h=R_.exec(a);if(h){h=h[0];var c=h.toLowerCase();this.protocol=c,a=a.substr(h.length)}if(e||h||a.match(/^\/\/[^@/]+@[^@/]+/)){var u=a.substr(0,2)==="//";u&&!(h&&hc[h])&&(a=a.substr(2),this.slashes=!0)}if(!hc[h]&&(u||h&&!ps[h])){for(var d=-1,p=0;p<Kf.length;p++){var f=a.indexOf(Kf[p]);f!==-1&&(d===-1||f<d)&&(d=f)}var m,g;d===-1?g=a.lastIndexOf("@"):g=a.lastIndexOf("@",d),g!==-1&&(m=a.slice(0,g),a=a.slice(g+1),this.auth=decodeURIComponent(m)),d=-1;for(var p=0;p<Yf.length;p++){var f=a.indexOf(Yf[p]);f!==-1&&(d===-1||f<d)&&(d=f)}d===-1&&(d=a.length),this.host=a.slice(0,d),a=a.slice(d),this.parseHost(),this.hostname=this.hostname||"";var x=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!x)for(var b=this.hostname.split(/\./),p=0,y=b.length;p<y;p++){var _=b[p];if(_&&!_.match(qf)){for(var L="",W=0,F=_.length;W<F;W++)_.charCodeAt(W)>127?L+="x":L+=_[W];if(!L.match(qf)){var B=b.slice(0,p),H=b.slice(p+1),Z=_.match(k_);Z&&(B.push(Z[1]),H.unshift(Z[2])),H.length&&(a="/"+H.join(".")+a),this.hostname=B.join(".");break}}}this.hostname.length>O_?this.hostname="":this.hostname=this.hostname.toLowerCase(),x||(this.hostname=M_.toASCII(this.hostname));var O=this.port?":"+this.port:"",G=this.hostname||"";this.host=G+O,this.href+=this.host,x&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),a[0]!=="/"&&(a="/"+a))}if(!N_[c])for(var p=0,y=lc.length;p<y;p++){var E=lc[p];if(a.indexOf(E)!==-1){var P=encodeURIComponent(E);P===E&&(P=escape(E)),a=a.split(E).join(P)}}var J=a.indexOf("#");J!==-1&&(this.hash=a.substr(J),a=a.slice(0,J));var it=a.indexOf("?");if(it!==-1?(this.search=a.substr(it),this.query=a.substr(it+1),t&&(this.query=cc.parse(this.query)),a=a.slice(0,it)):t&&(this.search="",this.query={}),a&&(this.pathname=a),ps[c]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var O=this.pathname||"",A=this.search||"";this.path=O+A}return this.href=this.format(),this};function U_(r){return typeof r=="string"&&(r=Io(r)),r instanceof Be?r.format():Be.prototype.format.call(r)}Be.prototype.format=function(){var r=this.auth||"";r&&(r=encodeURIComponent(r),r=r.replace(/%3A/i,":"),r+="@");var t=this.protocol||"",e=this.pathname||"",i=this.hash||"",s=!1,o="";this.host?s=r+this.host:this.hostname&&(s=r+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(s+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(o=cc.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var n=this.search||o&&"?"+o||"";return t&&t.substr(-1)!==":"&&(t+=":"),this.slashes||(!t||ps[t])&&s!==!1?(s="//"+(s||""),e&&e.charAt(0)!=="/"&&(e="/"+e)):s||(s=""),i&&i.charAt(0)!=="#"&&(i="#"+i),n&&n.charAt(0)!=="?"&&(n="?"+n),e=e.replace(/[?#]/g,function(a){return encodeURIComponent(a)}),n=n.replace("#","%23"),t+s+e+n+i};function G_(r,t){return Io(r,!1,!0).resolve(t)}Be.prototype.resolve=function(r){return this.resolveObject(Io(r,!1,!0)).format()};function z_(r,t){return r?Io(r,!1,!0).resolveObject(t):t}Be.prototype.resolveObject=function(r){if(typeof r=="string"){var t=new Be;t.parse(r,!1,!0),r=t}for(var e=new Be,i=Object.keys(this),s=0;s<i.length;s++){var o=i[s];e[o]=this[o]}if(e.hash=r.hash,r.href==="")return e.href=e.format(),e;if(r.slashes&&!r.protocol){for(var n=Object.keys(r),a=0;a<n.length;a++){var l=n[a];l!=="protocol"&&(e[l]=r[l])}return ps[e.protocol]&&e.hostname&&!e.pathname&&(e.pathname="/",e.path=e.pathname),e.href=e.format(),e}if(r.protocol&&r.protocol!==e.protocol){if(!ps[r.protocol]){for(var h=Object.keys(r),c=0;c<h.length;c++){var u=h[c];e[u]=r[u]}return e.href=e.format(),e}if(e.protocol=r.protocol,!r.host&&!hc[r.protocol]){for(var y=(r.pathname||"").split("/");y.length&&!(r.host=y.shift()););r.host||(r.host=""),r.hostname||(r.hostname=""),y[0]!==""&&y.unshift(""),y.length<2&&y.unshift(""),e.pathname=y.join("/")}else e.pathname=r.pathname;if(e.search=r.search,e.query=r.query,e.host=r.host||"",e.auth=r.auth,e.hostname=r.hostname||r.host,e.port=r.port,e.pathname||e.search){var d=e.pathname||"",p=e.search||"";e.path=d+p}return e.slashes=e.slashes||r.slashes,e.href=e.format(),e}var f=e.pathname&&e.pathname.charAt(0)==="/",m=r.host||r.pathname&&r.pathname.charAt(0)==="/",g=m||f||e.host&&r.pathname,x=g,b=e.pathname&&e.pathname.split("/")||[],y=r.pathname&&r.pathname.split("/")||[],_=e.protocol&&!ps[e.protocol];if(_&&(e.hostname="",e.port=null,e.host&&(b[0]===""?b[0]=e.host:b.unshift(e.host)),e.host="",r.protocol&&(r.hostname=null,r.port=null,r.host&&(y[0]===""?y[0]=r.host:y.unshift(r.host)),r.host=null),g=g&&(y[0]===""||b[0]==="")),m)e.host=r.host||r.host===""?r.host:e.host,e.hostname=r.hostname||r.hostname===""?r.hostname:e.hostname,e.search=r.search,e.query=r.query,b=y;else if(y.length)b||(b=[]),b.pop(),b=b.concat(y),e.search=r.search,e.query=r.query;else if(r.search!=null){if(_){e.host=b.shift(),e.hostname=e.host;var L=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;L&&(e.auth=L.shift(),e.hostname=L.shift(),e.host=e.hostname)}return e.search=r.search,e.query=r.query,(e.pathname!==null||e.search!==null)&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.href=e.format(),e}if(!b.length)return e.pathname=null,e.search?e.path="/"+e.search:e.path=null,e.href=e.format(),e;for(var W=b.slice(-1)[0],F=(e.host||r.host||b.length>1)&&(W==="."||W==="..")||W==="",B=0,H=b.length;H>=0;H--)W=b[H],W==="."?b.splice(H,1):W===".."?(b.splice(H,1),B++):B&&(b.splice(H,1),B--);if(!g&&!x)for(;B--;B)b.unshift("..");g&&b[0]!==""&&(!b[0]||b[0].charAt(0)!=="/")&&b.unshift(""),F&&b.join("/").substr(-1)!=="/"&&b.push("");var Z=b[0]===""||b[0]&&b[0].charAt(0)==="/";if(_){e.hostname=Z?"":b.length?b.shift():"",e.host=e.hostname;var L=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;L&&(e.auth=L.shift(),e.hostname=L.shift(),e.host=e.hostname)}return g=g||e.host&&b.length,g&&!Z&&b.unshift(""),b.length>0?e.pathname=b.join("/"):(e.pathname=null,e.path=null),(e.pathname!==null||e.search!==null)&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.auth=r.auth||e.auth,e.slashes=e.slashes||r.slashes,e.href=e.format(),e};Be.prototype.parseHost=function(){var r=this.host,t=F_.exec(r);t&&(t=t[0],t!==":"&&(this.port=t.substr(1)),r=r.substr(0,r.length-t.length)),r&&(this.hostname=r)};fs.parse=Io;fs.resolve=G_;fs.resolveObject=z_;fs.format=U_;fs.Url=Be});var Se=(r=>(r[r.WEBGL_LEGACY=0]="WEBGL_LEGACY",r[r.WEBGL=1]="WEBGL",r[r.WEBGL2=2]="WEBGL2",r))(Se||{}),Eh=(r=>(r[r.UNKNOWN=0]="UNKNOWN",r[r.WEBGL=1]="WEBGL",r[r.CANVAS=2]="CANVAS",r))(Eh||{}),ia=(r=>(r[r.COLOR=16384]="COLOR",r[r.DEPTH=256]="DEPTH",r[r.STENCIL=1024]="STENCIL",r))(ia||{}),q=(r=>(r[r.NORMAL=0]="NORMAL",r[r.ADD=1]="ADD",r[r.MULTIPLY=2]="MULTIPLY",r[r.SCREEN=3]="SCREEN",r[r.OVERLAY=4]="OVERLAY",r[r.DARKEN=5]="DARKEN",r[r.LIGHTEN=6]="LIGHTEN",r[r.COLOR_DODGE=7]="COLOR_DODGE",r[r.COLOR_BURN=8]="COLOR_BURN",r[r.HARD_LIGHT=9]="HARD_LIGHT",r[r.SOFT_LIGHT=10]="SOFT_LIGHT",r[r.DIFFERENCE=11]="DIFFERENCE",r[r.EXCLUSION=12]="EXCLUSION",r[r.HUE=13]="HUE",r[r.SATURATION=14]="SATURATION",r[r.COLOR=15]="COLOR",r[r.LUMINOSITY=16]="LUMINOSITY",r[r.NORMAL_NPM=17]="NORMAL_NPM",r[r.ADD_NPM=18]="ADD_NPM",r[r.SCREEN_NPM=19]="SCREEN_NPM",r[r.NONE=20]="NONE",r[r.SRC_OVER=0]="SRC_OVER",r[r.SRC_IN=21]="SRC_IN",r[r.SRC_OUT=22]="SRC_OUT",r[r.SRC_ATOP=23]="SRC_ATOP",r[r.DST_OVER=24]="DST_OVER",r[r.DST_IN=25]="DST_IN",r[r.DST_OUT=26]="DST_OUT",r[r.DST_ATOP=27]="DST_ATOP",r[r.ERASE=26]="ERASE",r[r.SUBTRACT=28]="SUBTRACT",r[r.XOR=29]="XOR",r))(q||{}),xe=(r=>(r[r.POINTS=0]="POINTS",r[r.LINES=1]="LINES",r[r.LINE_LOOP=2]="LINE_LOOP",r[r.LINE_STRIP=3]="LINE_STRIP",r[r.TRIANGLES=4]="TRIANGLES",r[r.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",r[r.TRIANGLE_FAN=6]="TRIANGLE_FAN",r))(xe||{}),R=(r=>(r[r.RGBA=6408]="RGBA",r[r.RGB=6407]="RGB",r[r.RG=33319]="RG",r[r.RED=6403]="RED",r[r.RGBA_INTEGER=36249]="RGBA_INTEGER",r[r.RGB_INTEGER=36248]="RGB_INTEGER",r[r.RG_INTEGER=33320]="RG_INTEGER",r[r.RED_INTEGER=36244]="RED_INTEGER",r[r.ALPHA=6406]="ALPHA",r[r.LUMINANCE=6409]="LUMINANCE",r[r.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",r[r.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",r[r.DEPTH_STENCIL=34041]="DEPTH_STENCIL",r))(R||{}),br=(r=>(r[r.TEXTURE_2D=3553]="TEXTURE_2D",r[r.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",r[r.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",r[r.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",r[r.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",r[r.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",r[r.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",r))(br||{}),X=(r=>(r[r.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",r[r.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",r[r.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",r[r.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",r[r.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",r[r.UNSIGNED_INT=5125]="UNSIGNED_INT",r[r.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",r[r.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",r[r.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",r[r.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",r[r.BYTE=5120]="BYTE",r[r.SHORT=5122]="SHORT",r[r.INT=5124]="INT",r[r.FLOAT=5126]="FLOAT",r[r.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",r[r.HALF_FLOAT=36193]="HALF_FLOAT",r))(X||{}),j=(r=>(r[r.FLOAT=0]="FLOAT",r[r.INT=1]="INT",r[r.UINT=2]="UINT",r))(j||{}),Wt=(r=>(r[r.NEAREST=0]="NEAREST",r[r.LINEAR=1]="LINEAR",r))(Wt||{}),Ee=(r=>(r[r.CLAMP=33071]="CLAMP",r[r.REPEAT=10497]="REPEAT",r[r.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",r))(Ee||{}),Lt=(r=>(r[r.OFF=0]="OFF",r[r.POW2=1]="POW2",r[r.ON=2]="ON",r[r.ON_MANUAL=3]="ON_MANUAL",r))(Lt||{}),St=(r=>(r[r.NPM=0]="NPM",r[r.UNPACK=1]="UNPACK",r[r.PMA=2]="PMA",r[r.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",r[r.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",r[r.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",r))(St||{}),Ae=(r=>(r[r.NO=0]="NO",r[r.YES=1]="YES",r[r.AUTO=2]="AUTO",r[r.BLEND=0]="BLEND",r[r.CLEAR=1]="CLEAR",r[r.BLIT=2]="BLIT",r))(Ae||{}),sa=(r=>(r[r.AUTO=0]="AUTO",r[r.MANUAL=1]="MANUAL",r))(sa||{}),he=(r=>(r.LOW="lowp",r.MEDIUM="mediump",r.HIGH="highp",r))(he||{}),At=(r=>(r[r.NONE=0]="NONE",r[r.SCISSOR=1]="SCISSOR",r[r.STENCIL=2]="STENCIL",r[r.SPRITE=3]="SPRITE",r[r.COLOR=4]="COLOR",r))(At||{});var ft=(r=>(r[r.NONE=0]="NONE",r[r.LOW=2]="LOW",r[r.MEDIUM=4]="MEDIUM",r[r.HIGH=8]="HIGH",r))(ft||{}),ye=(r=>(r[r.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",r[r.ARRAY_BUFFER=34962]="ARRAY_BUFFER",r[r.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",r))(ye||{});var Ah={createCanvas:(r,t)=>{let e=document.createElement("canvas");return e.width=r,e.height=t,e},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(r,t)=>fetch(r,t),parseXML:r=>new DOMParser().parseFromString(r,"text/xml")};var C={ADAPTER:Ah,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var Ph=/iPhone/i,np=/iPod/i,ap=/iPad/i,lp=/\biOS-universal(?:.+)Mac\b/i,Ih=/\bAndroid(?:.+)Mobile\b/i,hp=/Android/i,ts=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,oa=/Silk/i,Tr=/Windows Phone/i,cp=/\bWindows(?:.+)ARM\b/i,up=/BlackBerry/i,dp=/BB10/i,pp=/Opera Mini/i,fp=/\b(CriOS|Chrome)(?:.+)Mobile/i,mp=/Mobile(?:.+)Firefox\b/i,gp=function(r){return typeof r<"u"&&r.platform==="MacIntel"&&typeof r.maxTouchPoints=="number"&&r.maxTouchPoints>1&&typeof MSStream>"u"};function yy(r){return function(t){return t.test(r)}}function xo(r){var t={userAgent:"",platform:"",maxTouchPoints:0};!r&&typeof navigator<"u"?t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof r=="string"?t.userAgent=r:r&&r.userAgent&&(t={userAgent:r.userAgent,platform:r.platform,maxTouchPoints:r.maxTouchPoints||0});var e=t.userAgent,i=e.split("[FBAN");typeof i[1]<"u"&&(e=i[0]),i=e.split("Twitter"),typeof i[1]<"u"&&(e=i[0]);var s=yy(e),o={apple:{phone:s(Ph)&&!s(Tr),ipod:s(np),tablet:!s(Ph)&&(s(ap)||gp(t))&&!s(Tr),universal:s(lp),device:(s(Ph)||s(np)||s(ap)||s(lp)||gp(t))&&!s(Tr)},amazon:{phone:s(ts),tablet:!s(ts)&&s(oa),device:s(ts)||s(oa)},android:{phone:!s(Tr)&&s(ts)||!s(Tr)&&s(Ih),tablet:!s(Tr)&&!s(ts)&&!s(Ih)&&(s(oa)||s(hp)),device:!s(Tr)&&(s(ts)||s(oa)||s(Ih)||s(hp))||s(/\bokhttp\b/i)},windows:{phone:s(Tr),tablet:s(cp),device:s(Tr)||s(cp)},other:{blackberry:s(up),blackberry10:s(dp),opera:s(pp),firefox:s(mp),chrome:s(fp),device:s(up)||s(dp)||s(pp)||s(mp)||s(fp)},any:!1,phone:!1,tablet:!1};return o.any=o.apple.device||o.android.device||o.windows.device||o.other.device,o.phone=o.apple.phone||o.android.phone||o.windows.phone,o.tablet=o.apple.tablet||o.android.tablet||o.windows.tablet,o}var vy=xo.default??xo,De=vy(globalThis.navigator);var w={};gy(w,{BaseTextureCache:()=>ue,BoundingBox:()=>Lo,CanvasRenderTarget:()=>Pa,DATA_URI:()=>Ea,EventEmitter:()=>nr.default,ProgramCache:()=>Oo,TextureCache:()=>Ut,clearTextureCache:()=>Am,correctBlendMode:()=>vm,createIndicesForQuads:()=>wm,decomposeDataUri:()=>Rm,deprecation:()=>et,destroyTextureCache:()=>Em,detectVideoAlphaMode:()=>tm,determineCrossOrigin:()=>Ma,earcut:()=>Fm.default,getBufferType:()=>jr,getCanvasBoundingBox:()=>Ia,getResolutionOfUrl:()=>ko,hex2rgb:()=>mm,hex2string:()=>gm,interleaveTypedArrays:()=>Cm,isMobile:()=>De,isPow2:()=>Do,isWebGLSupported:()=>wa,log2:()=>Bo,nextPow2:()=>Wr,path:()=>uc,premultiplyBlendMode:()=>Fo,premultiplyRgba:()=>_m,premultiplyTint:()=>bm,premultiplyTintToRgba:()=>Tm,removeItems:()=>Aa,rgb2hex:()=>ym,sayHello:()=>rm,sign:()=>Sm,skipHello:()=>em,string2hex:()=>xm,trimCanvas:()=>Mm,uid:()=>or,url:()=>Jf});C.RETINA_PREFIX=/@([0-9\.]+)x/;C.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var nr=Sh(yp(),1),Fm=Sh(wp(),1);var ms=Sh(Zf(),1);var Qf={};function et(r,t,e=3){if(Qf[t])return;let i=new Error().stack;typeof i>"u"?console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${r}`):(i=i.split(`
`).splice(e).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${t}
Deprecated since v${r}`),console.warn(i),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${r}`),console.warn(i))),Qf[t]=!0}var Jf={get parse(){return et("7.3.0","utils.url.parse is deprecated, use native URL API instead."),ms.parse},get format(){return et("7.3.0","utils.url.format is deprecated, use native URL API instead."),ms.format},get resolve(){return et("7.3.0","utils.url.resolve is deprecated, use native URL API instead."),ms.resolve}};function je(r){if(typeof r!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(r)}`)}function Mo(r){return r.split("?")[0].split("#")[0]}function H_(r){return r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function V_(r,t,e){return r.replace(new RegExp(H_(t),"g"),e)}function j_(r,t){let e="",i=0,s=-1,o=0,n=-1;for(let a=0;a<=r.length;++a){if(a<r.length)n=r.charCodeAt(a);else{if(n===47)break;n=47}if(n===47){if(!(s===a-1||o===1))if(s!==a-1&&o===2){if(e.length<2||i!==2||e.charCodeAt(e.length-1)!==46||e.charCodeAt(e.length-2)!==46){if(e.length>2){let l=e.lastIndexOf("/");if(l!==e.length-1){l===-1?(e="",i=0):(e=e.slice(0,l),i=e.length-1-e.lastIndexOf("/")),s=a,o=0;continue}}else if(e.length===2||e.length===1){e="",i=0,s=a,o=0;continue}}t&&(e.length>0?e+="/..":e="..",i=2)}else e.length>0?e+=`/${r.slice(s+1,a)}`:e=r.slice(s+1,a),i=a-s-1;s=a,o=0}else n===46&&o!==-1?++o:o=-1}return e}var uc={toPosix(r){return V_(r,"\\","/")},isUrl(r){return/^https?:/.test(this.toPosix(r))},isDataUrl(r){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(r)},isBlobUrl(r){return r.startsWith("blob:")},hasProtocol(r){return/^[^/:]+:/.test(this.toPosix(r))},getProtocol(r){je(r),r=this.toPosix(r);let t=/^file:\/\/\//.exec(r);if(t)return t[0];let e=/^[^/:]+:\/{0,2}/.exec(r);return e?e[0]:""},toAbsolute(r,t,e){if(je(r),this.isDataUrl(r)||this.isBlobUrl(r))return r;let i=Mo(this.toPosix(t??C.ADAPTER.getBaseUrl())),s=Mo(this.toPosix(e??this.rootname(i)));return r=this.toPosix(r),r.startsWith("/")?uc.join(s,r.slice(1)):this.isAbsolute(r)?r:this.join(i,r)},normalize(r){if(je(r),r.length===0)return".";if(this.isDataUrl(r)||this.isBlobUrl(r))return r;r=this.toPosix(r);let t="",e=r.startsWith("/");this.hasProtocol(r)&&(t=this.rootname(r),r=r.slice(t.length));let i=r.endsWith("/");return r=j_(r,!1),r.length>0&&i&&(r+="/"),e?`/${r}`:t+r},isAbsolute(r){return je(r),r=this.toPosix(r),this.hasProtocol(r)?!0:r.startsWith("/")},join(...r){if(r.length===0)return".";let t;for(let e=0;e<r.length;++e){let i=r[e];if(je(i),i.length>0)if(t===void 0)t=i;else{let s=r[e-1]??"";this.extname(s)?t+=`/../${i}`:t+=`/${i}`}}return t===void 0?".":this.normalize(t)},dirname(r){if(je(r),r.length===0)return".";r=this.toPosix(r);let t=r.charCodeAt(0),e=t===47,i=-1,s=!0,o=this.getProtocol(r),n=r;r=r.slice(o.length);for(let a=r.length-1;a>=1;--a)if(t=r.charCodeAt(a),t===47){if(!s){i=a;break}}else s=!1;return i===-1?e?"/":this.isUrl(n)?o+r:o:e&&i===1?"//":o+r.slice(0,i)},rootname(r){je(r),r=this.toPosix(r);let t="";if(r.startsWith("/")?t="/":t=this.getProtocol(r),this.isUrl(r)){let e=r.indexOf("/",t.length);e!==-1?t=r.slice(0,e):t=r,t.endsWith("/")||(t+="/")}return t},basename(r,t){je(r),t&&je(t),r=Mo(this.toPosix(r));let e=0,i=-1,s=!0,o;if(t!==void 0&&t.length>0&&t.length<=r.length){if(t.length===r.length&&t===r)return"";let n=t.length-1,a=-1;for(o=r.length-1;o>=0;--o){let l=r.charCodeAt(o);if(l===47){if(!s){e=o+1;break}}else a===-1&&(s=!1,a=o+1),n>=0&&(l===t.charCodeAt(n)?--n===-1&&(i=o):(n=-1,i=a))}return e===i?i=a:i===-1&&(i=r.length),r.slice(e,i)}for(o=r.length-1;o>=0;--o)if(r.charCodeAt(o)===47){if(!s){e=o+1;break}}else i===-1&&(s=!1,i=o+1);return i===-1?"":r.slice(e,i)},extname(r){je(r),r=Mo(this.toPosix(r));let t=-1,e=0,i=-1,s=!0,o=0;for(let n=r.length-1;n>=0;--n){let a=r.charCodeAt(n);if(a===47){if(!s){e=n+1;break}continue}i===-1&&(s=!1,i=n+1),a===46?t===-1?t=n:o!==1&&(o=1):t!==-1&&(o=-1)}return t===-1||i===-1||o===0||o===1&&t===i-1&&t===e+1?"":r.slice(t,i)},parse(r){je(r);let t={root:"",dir:"",base:"",ext:"",name:""};if(r.length===0)return t;r=Mo(this.toPosix(r));let e=r.charCodeAt(0),i=this.isAbsolute(r),s,o="";t.root=this.rootname(r),i||this.hasProtocol(r)?s=1:s=0;let n=-1,a=0,l=-1,h=!0,c=r.length-1,u=0;for(;c>=s;--c){if(e=r.charCodeAt(c),e===47){if(!h){a=c+1;break}continue}l===-1&&(h=!1,l=c+1),e===46?n===-1?n=c:u!==1&&(u=1):n!==-1&&(u=-1)}return n===-1||l===-1||u===0||u===1&&n===l-1&&n===a+1?l!==-1&&(a===0&&i?t.base=t.name=r.slice(1,l):t.base=t.name=r.slice(a,l)):(a===0&&i?(t.name=r.slice(1,n),t.base=r.slice(1,l)):(t.name=r.slice(a,n),t.base=r.slice(a,l)),t.ext=r.slice(n,l)),t.dir=this.dirname(r),o&&(t.dir=o+t.dir),t},sep:"/",delimiter:":"};var dc;async function tm(){return dc??(dc=(async()=>{let r=document.createElement("canvas").getContext("webgl");if(!r)return St.UNPACK;let t=await new Promise(o=>{let n=document.createElement("video");n.onloadeddata=()=>o(n),n.onerror=()=>o(null),n.autoplay=!1,n.crossOrigin="anonymous",n.preload="auto",n.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",n.load()});if(!t)return St.UNPACK;let e=r.createTexture();r.bindTexture(r.TEXTURE_2D,e);let i=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,i),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,r.NONE),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t);let s=new Uint8Array(4);return r.readPixels(0,0,1,1,r.RGBA,r.UNSIGNED_BYTE,s),r.deleteFramebuffer(i),r.deleteTexture(e),r.getExtension("WEBGL_lose_context")?.loseContext(),s[0]<=s[3]?St.PMA:St.UNPACK})()),dc}function em(){et("7.0.0","skipHello is deprecated, please use settings.RENDER_OPTIONS.hello")}function rm(){et("7.0.0",`sayHello is deprecated, please use Renderer's "hello" option`)}var pc;function wa(){return typeof pc>"u"&&(pc=function(){let r={stencil:!0,failIfMajorPerformanceCaveat:C.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!C.ADAPTER.getWebGLRenderingContext())return!1;let t=C.ADAPTER.createCanvas(),e=t.getContext("webgl",r)||t.getContext("experimental-webgl",r),i=!!e?.getContextAttributes()?.stencil;if(e){let s=e.getExtension("WEBGL_lose_context");s&&s.loseContext()}return e=null,i}catch{return!1}}()),pc}var W_={grad:.9,turn:360,rad:360/(2*Math.PI)},Cr=function(r){return typeof r=="string"?r.length>0:typeof r=="number"},Nt=function(r,t,e){return t===void 0&&(t=0),e===void 0&&(e=Math.pow(10,t)),Math.round(e*r)/e+0},Le=function(r,t,e){return t===void 0&&(t=0),e===void 0&&(e=1),r>e?e:r>t?r:t},cm=function(r){return(r=isFinite(r)?r%360:0)>0?r:r+360},im=function(r){return{r:Le(r.r,0,255),g:Le(r.g,0,255),b:Le(r.b,0,255),a:Le(r.a)}},fc=function(r){return{r:Nt(r.r),g:Nt(r.g),b:Nt(r.b),a:Nt(r.a,3)}},X_=/^#([0-9a-f]{3,8})$/i,Ca=function(r){var t=r.toString(16);return t.length<2?"0"+t:t},um=function(r){var t=r.r,e=r.g,i=r.b,s=r.a,o=Math.max(t,e,i),n=o-Math.min(t,e,i),a=n?o===t?(e-i)/n:o===e?2+(i-t)/n:4+(t-e)/n:0;return{h:60*(a<0?a+6:a),s:o?n/o*100:0,v:o/255*100,a:s}},dm=function(r){var t=r.h,e=r.s,i=r.v,s=r.a;t=t/360*6,e/=100,i/=100;var o=Math.floor(t),n=i*(1-e),a=i*(1-(t-o)*e),l=i*(1-(1-t+o)*e),h=o%6;return{r:255*[i,a,n,n,l,i][h],g:255*[l,i,i,a,n,n][h],b:255*[n,n,l,i,i,a][h],a:s}},sm=function(r){return{h:cm(r.h),s:Le(r.s,0,100),l:Le(r.l,0,100),a:Le(r.a)}},om=function(r){return{h:Nt(r.h),s:Nt(r.s),l:Nt(r.l),a:Nt(r.a,3)}},nm=function(r){return dm((e=(t=r).s,{h:t.h,s:(e*=((i=t.l)<50?i:100-i)/100)>0?2*e/(i+e)*100:0,v:i+e,a:t.a}));var t,e,i},Ro=function(r){return{h:(t=um(r)).h,s:(s=(200-(e=t.s))*(i=t.v)/100)>0&&s<200?e*i/100/(s<=100?s:200-s)*100:0,l:s/2,a:t.a};var t,e,i,s},$_=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Y_=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,K_=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,q_=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,xc={string:[[function(r){var t=X_.exec(r);return t?(r=t[1]).length<=4?{r:parseInt(r[0]+r[0],16),g:parseInt(r[1]+r[1],16),b:parseInt(r[2]+r[2],16),a:r.length===4?Nt(parseInt(r[3]+r[3],16)/255,2):1}:r.length===6||r.length===8?{r:parseInt(r.substr(0,2),16),g:parseInt(r.substr(2,2),16),b:parseInt(r.substr(4,2),16),a:r.length===8?Nt(parseInt(r.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(r){var t=K_.exec(r)||q_.exec(r);return t?t[2]!==t[4]||t[4]!==t[6]?null:im({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:t[7]===void 0?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(r){var t=$_.exec(r)||Y_.exec(r);if(!t)return null;var e,i,s=sm({h:(e=t[1],i=t[2],i===void 0&&(i="deg"),Number(e)*(W_[i]||1)),s:Number(t[3]),l:Number(t[4]),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)});return nm(s)},"hsl"]],object:[[function(r){var t=r.r,e=r.g,i=r.b,s=r.a,o=s===void 0?1:s;return Cr(t)&&Cr(e)&&Cr(i)?im({r:Number(t),g:Number(e),b:Number(i),a:Number(o)}):null},"rgb"],[function(r){var t=r.h,e=r.s,i=r.l,s=r.a,o=s===void 0?1:s;if(!Cr(t)||!Cr(e)||!Cr(i))return null;var n=sm({h:Number(t),s:Number(e),l:Number(i),a:Number(o)});return nm(n)},"hsl"],[function(r){var t=r.h,e=r.s,i=r.v,s=r.a,o=s===void 0?1:s;if(!Cr(t)||!Cr(e)||!Cr(i))return null;var n=function(a){return{h:cm(a.h),s:Le(a.s,0,100),v:Le(a.v,0,100),a:Le(a.a)}}({h:Number(t),s:Number(e),v:Number(i),a:Number(o)});return dm(n)},"hsv"]]},am=function(r,t){for(var e=0;e<t.length;e++){var i=t[e][0](r);if(i)return[i,t[e][1]]}return[null,void 0]},Z_=function(r){return typeof r=="string"?am(r.trim(),xc.string):typeof r=="object"&&r!==null?am(r,xc.object):[null,void 0]};var mc=function(r,t){var e=Ro(r);return{h:e.h,s:Le(e.s+100*t,0,100),l:e.l,a:e.a}},gc=function(r){return(299*r.r+587*r.g+114*r.b)/1e3/255},lm=function(r,t){var e=Ro(r);return{h:e.h,s:e.s,l:Le(e.l+100*t,0,100),a:e.a}},yc=function(){function r(t){this.parsed=Z_(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return r.prototype.isValid=function(){return this.parsed!==null},r.prototype.brightness=function(){return Nt(gc(this.rgba),2)},r.prototype.isDark=function(){return gc(this.rgba)<.5},r.prototype.isLight=function(){return gc(this.rgba)>=.5},r.prototype.toHex=function(){return t=fc(this.rgba),e=t.r,i=t.g,s=t.b,n=(o=t.a)<1?Ca(Nt(255*o)):"","#"+Ca(e)+Ca(i)+Ca(s)+n;var t,e,i,s,o,n},r.prototype.toRgb=function(){return fc(this.rgba)},r.prototype.toRgbString=function(){return t=fc(this.rgba),e=t.r,i=t.g,s=t.b,(o=t.a)<1?"rgba("+e+", "+i+", "+s+", "+o+")":"rgb("+e+", "+i+", "+s+")";var t,e,i,s,o},r.prototype.toHsl=function(){return om(Ro(this.rgba))},r.prototype.toHslString=function(){return t=om(Ro(this.rgba)),e=t.h,i=t.s,s=t.l,(o=t.a)<1?"hsla("+e+", "+i+"%, "+s+"%, "+o+")":"hsl("+e+", "+i+"%, "+s+"%)";var t,e,i,s,o},r.prototype.toHsv=function(){return t=um(this.rgba),{h:Nt(t.h),s:Nt(t.s),v:Nt(t.v),a:Nt(t.a,3)};var t},r.prototype.invert=function(){return We({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},r.prototype.saturate=function(t){return t===void 0&&(t=.1),We(mc(this.rgba,t))},r.prototype.desaturate=function(t){return t===void 0&&(t=.1),We(mc(this.rgba,-t))},r.prototype.grayscale=function(){return We(mc(this.rgba,-1))},r.prototype.lighten=function(t){return t===void 0&&(t=.1),We(lm(this.rgba,t))},r.prototype.darken=function(t){return t===void 0&&(t=.1),We(lm(this.rgba,-t))},r.prototype.rotate=function(t){return t===void 0&&(t=15),this.hue(this.hue()+t)},r.prototype.alpha=function(t){return typeof t=="number"?We({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):Nt(this.rgba.a,3);var e},r.prototype.hue=function(t){var e=Ro(this.rgba);return typeof t=="number"?We({h:t,s:e.s,l:e.l,a:e.a}):Nt(e.h)},r.prototype.isEqual=function(t){return this.toHex()===We(t).toHex()},r}(),We=function(r){return r instanceof yc?r:new yc(r)},hm=[],pm=function(r){r.forEach(function(t){hm.indexOf(t)<0&&(t(yc,xc),hm.push(t))})};function fm(r,t){var e={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},i={};for(var s in e)i[e[s]]=s;var o={};r.prototype.toName=function(n){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var a,l,h=i[this.toHex()];if(h)return h;if(n?.closest){var c=this.toRgb(),u=1/0,d="black";if(!o.length)for(var p in e)o[p]=new r(e[p]).toRgb();for(var f in e){var m=(a=c,l=o[f],Math.pow(a.r-l.r,2)+Math.pow(a.g-l.g,2)+Math.pow(a.b-l.b,2));m<u&&(u=m,d=f)}return d}},t.string.push([function(n){var a=n.toLowerCase(),l=a==="transparent"?"#0000":e[a];return l?new r(l).toRgb():null},"name"])}pm([fm]);var gs=class Sa{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(t){if(t instanceof Sa)this._value=this.cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(t===null)throw new Error("Cannot set PIXI.Color#value to null");(this._value===null||!this.isSourceEqual(this._value,t))&&(this.normalize(t),this._value=this.cloneSource(t))}}get value(){return this._value}cloneSource(t){return typeof t=="string"||typeof t=="number"||t instanceof Number||t===null?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):typeof t=="object"&&t!==null?{...t}:t}isSourceEqual(t,e){let i=typeof t;if(i!==typeof e)return!1;if(i==="number"||i==="string"||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length!==e.length?!1:t.every((s,o)=>s===e[o]);if(t!==null&&e!==null){let s=Object.keys(t),o=Object.keys(e);return s.length!==o.length?!1:s.every(n=>t[n]===e[n])}return t===e}toRgba(){let[t,e,i,s]=this._components;return{r:t,g:e,b:i,a:s}}toRgb(){let[t,e,i]=this._components;return{r:t,g:e,b:i}}toRgbaString(){let[t,e,i]=this.toUint8RgbArray();return`rgba(${t},${e},${i},${this.alpha})`}toUint8RgbArray(t){let[e,i,s]=this._components;return t=t??[],t[0]=Math.round(e*255),t[1]=Math.round(i*255),t[2]=Math.round(s*255),t}toRgbArray(t){t=t??[];let[e,i,s]=this._components;return t[0]=e,t[1]=i,t[2]=s,t}toNumber(){return this._int}toLittleEndianNumber(){let t=this._int;return(t>>16)+(t&65280)+((t&255)<<16)}multiply(t){let[e,i,s,o]=Sa.temp.setValue(t)._components;return this._components[0]*=e,this._components[1]*=i,this._components[2]*=s,this._components[3]*=o,this.refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this.refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(t===1)return(255<<24)+this._int;if(t===0)return e?0:this._int;let i=this._int>>16&255,s=this._int>>8&255,o=this._int&255;return e&&(i=i*t+.5|0,s=s*t+.5|0,o=o*t+.5|0),(t*255<<24)+(i<<16)+(s<<8)+o}toHex(){let t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){let t=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-t.length)+t}setAlpha(t){return this._components[3]=this._clamp(t),this}round(t){let[e,i,s]=this._components;return this._components[0]=Math.round(e*t)/t,this._components[1]=Math.round(i*t)/t,this._components[2]=Math.round(s*t)/t,this.refreshInt(),this._value=null,this}toArray(t){t=t??[];let[e,i,s,o]=this._components;return t[0]=e,t[1]=i,t[2]=s,t[3]=o,t}normalize(t){let e,i,s,o;if((typeof t=="number"||t instanceof Number)&&t>=0&&t<=16777215){let n=t;e=(n>>16&255)/255,i=(n>>8&255)/255,s=(n&255)/255,o=1}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[e,i,s,o=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[e,i,s,o=255]=t,e/=255,i/=255,s/=255,o/=255;else if(typeof t=="string"||typeof t=="object"){if(typeof t=="string"){let a=Sa.HEX_PATTERN.exec(t);a&&(t=`#${a[2]}`)}let n=We(t);n.isValid()&&({r:e,g:i,b:s,a:o}=n.rgba,e/=255,i/=255,s/=255)}if(e!==void 0)this._components[0]=e,this._components[1]=i,this._components[2]=s,this._components[3]=o,this.refreshInt();else throw new Error(`Unable to convert color ${t}`)}refreshInt(){this._clamp(this._components);let[t,e,i]=this._components;this._int=(t*255<<16)+(e*255<<8)+(i*255|0)}_clamp(t,e=0,i=1){return typeof t=="number"?Math.min(Math.max(t,e),i):(t.forEach((s,o)=>{t[o]=Math.min(Math.max(s,e),i)}),t)}};gs.shared=new gs,gs.temp=new gs,gs.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;var tt=gs;function mm(r,t=[]){return et("7.2.0","utils.hex2rgb is deprecated, use Color#toRgbArray instead"),tt.shared.setValue(r).toRgbArray(t)}function gm(r){return et("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),tt.shared.setValue(r).toHex()}function xm(r){return et("7.2.0","utils.string2hex is deprecated, use Color#toNumber instead"),tt.shared.setValue(r).toNumber()}function ym(r){return et("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),tt.shared.setValue(r).toNumber()}function Q_(){let r=[],t=[];for(let i=0;i<32;i++)r[i]=i,t[i]=i;r[q.NORMAL_NPM]=q.NORMAL,r[q.ADD_NPM]=q.ADD,r[q.SCREEN_NPM]=q.SCREEN,t[q.NORMAL]=q.NORMAL_NPM,t[q.ADD]=q.ADD_NPM,t[q.SCREEN]=q.SCREEN_NPM;let e=[];return e.push(t),e.push(r),e}var Fo=Q_();function vm(r,t){return Fo[t?1:0][r]}function _m(r,t,e,i=!0){return et("7.2.0","utils.premultiplyRgba has moved to Color.premultiply"),tt.shared.setValue(r).premultiply(t,i).toArray(e??new Float32Array(4))}function bm(r,t){return et("7.2.0","utils.premultiplyTint has moved to Color.toPremultiplied"),tt.shared.setValue(r).toPremultiplied(t)}function Tm(r,t,e,i=!0){return et("7.2.0","utils.premultiplyTintToRgba has moved to Color.premultiply"),tt.shared.setValue(r).premultiply(t,i).toArray(e??new Float32Array(4))}var Ea=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i;function wm(r,t=null){let e=r*6;if(t=t||new Uint16Array(e),t.length!==e)throw new Error(`Out buffer length is incorrect, got ${t.length} and expected ${e}`);for(let i=0,s=0;i<e;i+=6,s+=4)t[i+0]=s+0,t[i+1]=s+1,t[i+2]=s+2,t[i+3]=s+0,t[i+4]=s+2,t[i+5]=s+3;return t}function jr(r){if(r.BYTES_PER_ELEMENT===4)return r instanceof Float32Array?"Float32Array":r instanceof Uint32Array?"Uint32Array":"Int32Array";if(r.BYTES_PER_ELEMENT===2){if(r instanceof Uint16Array)return"Uint16Array"}else if(r.BYTES_PER_ELEMENT===1&&r instanceof Uint8Array)return"Uint8Array";return null}var J_={Float32Array,Uint32Array,Int32Array,Uint8Array};function Cm(r,t){let e=0,i=0,s={};for(let l=0;l<r.length;l++)i+=t[l],e+=r[l].length;let o=new ArrayBuffer(e*4),n=null,a=0;for(let l=0;l<r.length;l++){let h=t[l],c=r[l],u=jr(c);s[u]||(s[u]=new J_[u](o)),n=s[u];for(let d=0;d<c.length;d++){let p=(d/h|0)*i+a,f=d%h;n[p+f]=c[d]}a+=h}return new Float32Array(o)}function Wr(r){return r+=r===0?1:0,--r,r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,r|=r>>>16,r+1}function Do(r){return!(r&r-1)&&!!r}function Bo(r){let t=(r>65535?1:0)<<4;r>>>=t;let e=(r>255?1:0)<<3;return r>>>=e,t|=e,e=(r>15?1:0)<<2,r>>>=e,t|=e,e=(r>3?1:0)<<1,r>>>=e,t|=e,t|r>>1}function Aa(r,t,e){let i=r.length,s;if(t>=i||e===0)return;e=t+e>i?i-t:e;let o=i-e;for(s=t;s<o;++s)r[s]=r[s+e];r.length=o}function Sm(r){return r===0?0:r<0?-1:1}var tb=0;function or(){return++tb}var vc=class{constructor(r,t,e,i){this.left=r,this.top=t,this.right=e,this.bottom=i}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};vc.EMPTY=new vc(0,0,0,0);var Lo=vc;var Oo={},Ut=Object.create(null),ue=Object.create(null);function Em(){let r;for(r in Ut)Ut[r].destroy();for(r in ue)ue[r].destroy()}function Am(){let r;for(r in Ut)delete Ut[r];for(r in ue)delete ue[r]}var Pa=class{constructor(t,e,i){this._canvas=C.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=i||C.RESOLUTION,this.resize(t,e)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(t,e){this._checkDestroyed(),this._canvas.width=Math.round(t*this.resolution),this._canvas.height=Math.round(e*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(t){this._checkDestroyed(),this._canvas.width=Math.round(t)}get height(){return this._checkDestroyed(),this._canvas.height}set height(t){this._checkDestroyed(),this._canvas.height=Math.round(t)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(this._canvas===null)throw new TypeError("The CanvasRenderTarget has already been destroyed")}};function Pm(r,t,e){for(let i=0,s=4*e*t;i<t;++i,s+=4)if(r[s+3]!==0)return!1;return!0}function Im(r,t,e,i,s){let o=4*t;for(let n=i,a=i*o+4*e;n<=s;++n,a+=o)if(r[a+3]!==0)return!1;return!0}function Ia(r){let{width:t,height:e}=r,i=r.getContext("2d",{willReadFrequently:!0});if(i===null)throw new TypeError("Failed to get canvas 2D context");let s=i.getImageData(0,0,t,e).data,o=0,n=0,a=t-1,l=e-1;for(;n<e&&Pm(s,t,n);)++n;if(n===e)return Lo.EMPTY;for(;Pm(s,t,l);)--l;for(;Im(s,t,o,n,l);)++o;for(;Im(s,t,a,n,l);)--a;return++a,++l,new Lo(o,n,a,l)}function Mm(r){let t=Ia(r),{width:e,height:i}=t,s=null;if(!t.isEmpty()){let o=r.getContext("2d");if(o===null)throw new TypeError("Failed to get canvas 2D context");s=o.getImageData(t.left,t.top,e,i)}return{width:e,height:i,data:s}}function Rm(r){let t=Ea.exec(r);if(t)return{mediaType:t[1]?t[1].toLowerCase():void 0,subType:t[2]?t[2].toLowerCase():void 0,charset:t[3]?t[3].toLowerCase():void 0,encoding:t[4]?t[4].toLowerCase():void 0,data:t[5]}}function Ma(r,t=globalThis.location){if(r.startsWith("data:"))return"";t=t||globalThis.location;let e=new URL(r,document.baseURI);return e.hostname!==t.hostname||e.port!==t.port||e.protocol!==t.protocol?"anonymous":""}function ko(r,t=1){let e=C.RETINA_PREFIX?.exec(r);return e?parseFloat(e[1]):t}var T=(r=>(r.Renderer="renderer",r.Application="application",r.RendererSystem="renderer-webgl-system",r.RendererPlugin="renderer-webgl-plugin",r.CanvasRendererSystem="renderer-canvas-system",r.CanvasRendererPlugin="renderer-canvas-plugin",r.Asset="asset",r.LoadParser="load-parser",r.ResolveParser="resolve-parser",r.CacheParser="cache-parser",r.DetectionParser="detection-parser",r))(T||{}),_c=r=>{if(typeof r=="function"||typeof r=="object"&&r.extension){if(!r.extension)throw new Error("Extension class must have an extension object");r={...typeof r.extension!="object"?{type:r.extension}:r.extension,ref:r}}if(typeof r=="object")r={...r};else throw new Error("Invalid extension type");return typeof r.type=="string"&&(r.type=[r.type]),r},Dm=(r,t)=>_c(r).priority??t,S={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...r){return r.map(_c).forEach(t=>{t.type.forEach(e=>this._removeHandlers[e]?.(t))}),this},add(...r){return r.map(_c).forEach(t=>{t.type.forEach(e=>{let i=this._addHandlers,s=this._queue;i[e]?i[e](t):(s[e]=s[e]||[],s[e].push(t))})}),this},handle(r,t,e){let i=this._addHandlers,s=this._removeHandlers;if(i[r]||s[r])throw new Error(`Extension type ${r} already has a handler`);i[r]=t,s[r]=e;let o=this._queue;return o[r]&&(o[r].forEach(n=>t(n)),delete o[r]),this},handleByMap(r,t){return this.handle(r,e=>{t[e.name]=e.ref},e=>{delete t[e.name]})},handleByList(r,t,e=-1){return this.handle(r,i=>{t.includes(i.ref)||(t.push(i.ref),t.sort((s,o)=>Dm(o,e)-Dm(s,e)))},i=>{let s=t.indexOf(i.ref);s!==-1&&t.splice(s,1)})}};var Xr=class{constructor(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}};var eb=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function rb(r){let t="";for(let e=0;e<r;++e)e>0&&(t+=`
else `),e<r-1&&(t+=`if(test == ${e}.0){}`);return t}function Ra(r,t){if(r===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");let e=t.createShader(t.FRAGMENT_SHADER);for(;;){let i=eb.replace(/%forloop%/gi,rb(r));if(t.shaderSource(e,i),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))r=r/2|0;else break}return r}var bc=0,Tc=1,wc=2,Cc=3,Sc=4,Ec=5,Gt=class r{constructor(){this.data=0,this.blendMode=q.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<bc)}set blend(t){!!(this.data&1<<bc)!==t&&(this.data^=1<<bc)}get offsets(){return!!(this.data&1<<Tc)}set offsets(t){!!(this.data&1<<Tc)!==t&&(this.data^=1<<Tc)}get culling(){return!!(this.data&1<<wc)}set culling(t){!!(this.data&1<<wc)!==t&&(this.data^=1<<wc)}get depthTest(){return!!(this.data&1<<Cc)}set depthTest(t){!!(this.data&1<<Cc)!==t&&(this.data^=1<<Cc)}get depthMask(){return!!(this.data&1<<Ec)}set depthMask(t){!!(this.data&1<<Ec)!==t&&(this.data^=1<<Ec)}get clockwiseFrontFace(){return!!(this.data&1<<Sc)}set clockwiseFrontFace(t){!!(this.data&1<<Sc)!==t&&(this.data^=1<<Sc)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==q.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}static for2d(){let t=new r;return t.depthTest=!1,t.blend=!0,t}};Gt.prototype.toString=function(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`};var No=[];function xs(r,t){if(!r)return null;let e="";if(typeof r=="string"){let i=/\.(\w{3,4})(?:$|\?|#)/i.exec(r);i&&(e=i[1].toLowerCase())}for(let i=No.length-1;i>=0;--i){let s=No[i];if(s.test&&s.test(r,e))return new s(r,t)}throw new Error("Unrecognized source type to auto-detect Resource")}var It=class{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,e,i,s,o,n,a,l){if(arguments.length>8)throw new Error("max arguments reached");let{name:h,items:c}=this;this._aliasCount++;for(let u=0,d=c.length;u<d;u++)c[u][h](t,e,i,s,o,n,a,l);return c===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){let e=this.items.indexOf(t);return e!==-1&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}};Object.defineProperties(It.prototype,{dispatch:{value:It.prototype.emit},run:{value:It.prototype.emit}});var Pe=class{constructor(t=0,e=0){this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new It("setRealSize"),this.onUpdate=new It("update"),this.onError=new It("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,e){(t!==this._width||e!==this._height)&&(this._width=t,this._height=e,this.onResize.emit(t,e))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,e,i){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,e){return!1}};var Xe=class extends Pe{constructor(t,e){let{width:i,height:s}=e||{};if(!i||!s)throw new Error("BufferResource width or height invalid");super(i,s),this.data=t,this.unpackAlignment=e.unpackAlignment??4}upload(t,e,i){let s=t.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,this.unpackAlignment),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===St.UNPACK);let o=e.realWidth,n=e.realHeight;return i.width===o&&i.height===n?s.texSubImage2D(e.target,0,0,0,o,n,e.format,i.type,this.data):(i.width=o,i.height=n,s.texImage2D(e.target,0,i.internalFormat,o,n,0,e.format,i.type,this.data)),!0}dispose(){this.data=null}static test(t){return t===null||t instanceof Int8Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array}};var ib={scaleMode:Wt.NEAREST,alphaMode:St.NPM},Ac=class ys extends nr.default{constructor(t=null,e=null){super(),e=Object.assign({},ys.defaultOptions,e);let{alphaMode:i,mipmap:s,anisotropicLevel:o,scaleMode:n,width:a,height:l,wrapMode:h,format:c,type:u,target:d,resolution:p,resourceOptions:f}=e;t&&!(t instanceof Pe)&&(t=xs(t,f),t.internal=!0),this.resolution=p||C.RESOLUTION,this.width=Math.round((a||0)*this.resolution)/this.resolution,this.height=Math.round((l||0)*this.resolution)/this.resolution,this._mipmap=s,this.anisotropicLevel=o,this._wrapMode=h,this._scaleMode=n,this.format=c,this.type=u,this.target=d,this.alphaMode=i,this.uid=or(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=a>0&&l>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(t)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(t){this._mipmap!==t&&(this._mipmap=t,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(t){this._scaleMode!==t&&(this._scaleMode=t,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(t){this._wrapMode!==t&&(this._wrapMode=t,this.dirtyStyleId++)}setStyle(t,e){let i;return t!==void 0&&t!==this.scaleMode&&(this.scaleMode=t,i=!0),e!==void 0&&e!==this.mipmap&&(this.mipmap=e,i=!0),i&&this.dirtyStyleId++,this}setSize(t,e,i){return i=i||this.resolution,this.setRealSize(t*i,e*i,i)}setRealSize(t,e,i){return this.resolution=i||this.resolution,this.width=Math.round(t)/this.resolution,this.height=Math.round(e)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=Do(this.realWidth)&&Do(this.realHeight)}setResolution(t){let e=this.resolution;return e===t?this:(this.resolution=t,this.valid&&(this.width=Math.round(this.width*e)/t,this.height=Math.round(this.height*e)/t,this.emit("update",this)),this._refreshPOT(),this)}setResource(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(t){this.emit("error",this,t)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete ue[this.cacheId],delete Ut[this.cacheId],this.cacheId=null),this.valid=!1,this.dispose(),ys.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(t,e,i=C.STRICT_TEXTURE_CACHE){let s=typeof t=="string",o=null;if(s)o=t;else{if(!t._pixiId){let a=e?.pixiIdPrefix||"pixiid";t._pixiId=`${a}_${or()}`}o=t._pixiId}let n=ue[o];if(s&&i&&!n)throw new Error(`The cacheId "${o}" does not exist in BaseTextureCache.`);return n||(n=new ys(t,e),n.cacheId=o,ys.addToCache(n,o)),n}static fromBuffer(t,e,i,s){t=t||new Float32Array(e*i*4);let o=new Xe(t,{width:e,height:i,...s?.resourceOptions}),n,a;return t instanceof Float32Array?(n=R.RGBA,a=X.FLOAT):t instanceof Int32Array?(n=R.RGBA_INTEGER,a=X.INT):t instanceof Uint32Array?(n=R.RGBA_INTEGER,a=X.UNSIGNED_INT):t instanceof Int16Array?(n=R.RGBA_INTEGER,a=X.SHORT):t instanceof Uint16Array?(n=R.RGBA_INTEGER,a=X.UNSIGNED_SHORT):t instanceof Int8Array?(n=R.RGBA,a=X.BYTE):(n=R.RGBA,a=X.UNSIGNED_BYTE),o.internal=!0,new ys(o,Object.assign({},ib,{type:a,format:n},s))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),ue[e]&&ue[e]!==t&&console.warn(`BaseTexture added to the cache with an id [${e}] that already had an entry`),ue[e]=t)}static removeFromCache(t){if(typeof t=="string"){let e=ue[t];if(e){let i=e.textureCacheIds.indexOf(t);return i>-1&&e.textureCacheIds.splice(i,1),delete ue[t],e}}else if(t?.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)delete ue[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}};Ac.defaultOptions={mipmap:Lt.POW2,anisotropicLevel:0,scaleMode:Wt.LINEAR,wrapMode:Ee.CLAMP,alphaMode:St.UNPACK,target:br.TEXTURE_2D,format:R.RGBA,type:X.UNSIGNED_BYTE},Ac._globalBatch=0;var K=Ac;var $r=class{constructor(){this.texArray=null,this.blend=0,this.type=xe.TRIANGLES,this.start=0,this.size=0,this.data=null}};var sb=0,mt=class r{constructor(t,e=!0,i=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=i,this.static=e,this.id=sb++,this.disposeRunner=new It("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?ye.ELEMENT_ARRAY_BUFFER:ye.ARRAY_BUFFER}get index(){return this.type===ye.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new r(t)}};var vs=class r{constructor(t,e=0,i=!1,s=X.FLOAT,o,n,a,l=1){this.buffer=t,this.size=e,this.normalized=i,this.type=s,this.stride=o,this.start=n,this.instance=a,this.divisor=l}destroy(){this.buffer=null}static from(t,e,i,s,o){return new r(t,e,i,s,o)}};var ob={Float32Array,Uint32Array,Int32Array,Uint8Array};function Bm(r,t){let e=0,i=0,s={};for(let l=0;l<r.length;l++)i+=t[l],e+=r[l].length;let o=new ArrayBuffer(e*4),n=null,a=0;for(let l=0;l<r.length;l++){let h=t[l],c=r[l],u=jr(c);s[u]||(s[u]=new ob[u](o)),n=s[u];for(let d=0;d<c.length;d++){let p=(d/h|0)*i+a,f=d%h;n[p+f]=c[d]}a+=h}return new Float32Array(o)}var Lm={5126:4,5123:2,5121:1},nb=0,ab={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array},Ie=class r{constructor(t=[],e={}){this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=nb++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new It("disposeGeometry"),this.refCount=0}addAttribute(t,e,i=0,s=!1,o,n,a,l=!1){if(!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof mt||(e instanceof Array&&(e=new Float32Array(e)),e=new mt(e));let h=t.split("|");if(h.length>1){for(let u=0;u<h.length;u++)this.addAttribute(h[u],e,i,s,o);return this}let c=this.buffers.indexOf(e);return c===-1&&(this.buffers.push(e),c=this.buffers.length-1),this.attributes[t]=new vs(c,i,s,o,n,a,l),this.instanced=this.instanced||l,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof mt||(t instanceof Array&&(t=new Uint16Array(t)),t=new mt(t)),t.type=ye.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;let t=[],e=[],i=new mt,s;for(s in this.attributes){let o=this.attributes[s],n=this.buffers[o.buffer];t.push(n.data),e.push(o.size*Lm[o.type]/4),o.buffer=0}for(i.data=Bm(t,e),s=0;s<this.buffers.length;s++)this.buffers[s]!==this.indexBuffer&&this.buffers[s].destroy();return this.buffers=[i],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(let t in this.attributes){let e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){let t=new r;for(let e=0;e<this.buffers.length;e++)t.buffers[e]=new mt(this.buffers[e].data.slice(0));for(let e in this.attributes){let i=this.attributes[e];t.attributes[e]=new vs(i.buffer,i.size,i.normalized,i.type,i.stride,i.start,i.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=ye.ELEMENT_ARRAY_BUFFER),t}static merge(t){let e=new r,i=[],s=[],o=[],n;for(let a=0;a<t.length;a++){n=t[a];for(let l=0;l<n.buffers.length;l++)s[l]=s[l]||0,s[l]+=n.buffers[l].data.length,o[l]=0}for(let a=0;a<n.buffers.length;a++)i[a]=new ab[jr(n.buffers[a].data)](s[a]),e.buffers[a]=new mt(i[a]);for(let a=0;a<t.length;a++){n=t[a];for(let l=0;l<n.buffers.length;l++)i[l].set(n.buffers[l].data,o[l]),o[l]+=n.buffers[l].data.length}if(e.attributes=n.attributes,n.indexBuffer){e.indexBuffer=e.buffers[n.buffers.indexOf(n.indexBuffer)],e.indexBuffer.type=ye.ELEMENT_ARRAY_BUFFER;let a=0,l=0,h=0,c=0;for(let u=0;u<n.buffers.length;u++)if(n.buffers[u]!==n.indexBuffer){c=u;break}for(let u in n.attributes){let d=n.attributes[u];(d.buffer|0)===c&&(l+=d.size*Lm[d.type]/4)}for(let u=0;u<t.length;u++){let d=t[u].indexBuffer.data;for(let p=0;p<d.length;p++)e.indexBuffer.data[p+h]+=a;a+=t[u].buffers[c].data.length/l,h+=d.length}}return e}};var vi=class extends Ie{constructor(t=!1){super(),this._buffer=new mt(null,t,!1),this._indexBuffer=new mt(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,X.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,X.FLOAT).addAttribute("aColor",this._buffer,4,!0,X.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,X.FLOAT).addIndex(this._indexBuffer)}};var Yr=Math.PI*2,Pc=180/Math.PI,$e=Math.PI/180,gt=(r=>(r[r.POLY=0]="POLY",r[r.RECT=1]="RECT",r[r.CIRC=2]="CIRC",r[r.ELIP=3]="ELIP",r[r.RREC=4]="RREC",r))(gt||{});var $=class r{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new r(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}};$.prototype.toString=function(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`};var Fa=[new $,new $,new $,new $],Y=class r{constructor(t=0,e=0,i=0,s=0){this.x=Number(t),this.y=Number(e),this.width=Number(i),this.height=Number(s),this.type=gt.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new r(0,0,0,0)}clone(){return new r(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}intersects(t,e){if(!e){let B=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=B)return!1;let H=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>H}let i=this.left,s=this.right,o=this.top,n=this.bottom;if(s<=i||n<=o)return!1;let a=Fa[0].set(t.left,t.top),l=Fa[1].set(t.left,t.bottom),h=Fa[2].set(t.right,t.top),c=Fa[3].set(t.right,t.bottom);if(h.x<=a.x||l.y<=a.y)return!1;let u=Math.sign(e.a*e.d-e.b*e.c);if(u===0||(e.apply(a,a),e.apply(l,l),e.apply(h,h),e.apply(c,c),Math.max(a.x,l.x,h.x,c.x)<=i||Math.min(a.x,l.x,h.x,c.x)>=s||Math.max(a.y,l.y,h.y,c.y)<=o||Math.min(a.y,l.y,h.y,c.y)>=n))return!1;let d=u*(l.y-a.y),p=u*(a.x-l.x),f=d*i+p*o,m=d*s+p*o,g=d*i+p*n,x=d*s+p*n;if(Math.max(f,m,g,x)<=d*a.x+p*a.y||Math.min(f,m,g,x)>=d*c.x+p*c.y)return!1;let b=u*(a.y-h.y),y=u*(h.x-a.x),_=b*i+y*o,L=b*s+y*o,W=b*i+y*n,F=b*s+y*n;return!(Math.max(_,L,W,F)<=b*a.x+y*a.y||Math.min(_,L,W,F)>=b*c.x+y*c.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2,this}fit(t){let e=Math.max(this.x,t.x),i=Math.min(this.x+this.width,t.x+t.width),s=Math.max(this.y,t.y),o=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(i-e,0),this.y=s,this.height=Math.max(o-s,0),this}ceil(t=1,e=.001){let i=Math.ceil((this.x+this.width-e)*t)/t,s=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=i-this.x,this.height=s-this.y,this}enlarge(t){let e=Math.min(this.x,t.x),i=Math.max(this.x+this.width,t.x+t.width),s=Math.min(this.y,t.y),o=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=i-e,this.y=s,this.height=o-s,this}};Y.prototype.toString=function(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};var _s=class r{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.radius=i,this.type=gt.CIRC}clone(){return new r(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;let i=this.radius*this.radius,s=this.x-t,o=this.y-e;return s*=s,o*=o,s+o<=i}getBounds(){return new Y(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)}};_s.prototype.toString=function(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`};var bs=class r{constructor(t=0,e=0,i=0,s=0){this.x=t,this.y=e,this.width=i,this.height=s,this.type=gt.ELIP}clone(){return new r(this.x,this.y,this.width,this.height)}contains(t,e){if(this.width<=0||this.height<=0)return!1;let i=(t-this.x)/this.width,s=(e-this.y)/this.height;return i*=i,s*=s,i+s<=1}getBounds(){return new Y(this.x-this.width,this.y-this.height,this.width,this.height)}};bs.prototype.toString=function(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};var ar=class r{constructor(...t){let e=Array.isArray(t[0])?t[0]:t;if(typeof e[0]!="number"){let i=[];for(let s=0,o=e.length;s<o;s++)i.push(e[s].x,e[s].y);e=i}this.points=e,this.type=gt.POLY,this.closeStroke=!0}clone(){let t=this.points.slice(),e=new r(t);return e.closeStroke=this.closeStroke,e}contains(t,e){let i=!1,s=this.points.length/2;for(let o=0,n=s-1;o<s;n=o++){let a=this.points[o*2],l=this.points[o*2+1],h=this.points[n*2],c=this.points[n*2+1];l>e!=c>e&&t<(h-a)*((e-l)/(c-l))+a&&(i=!i)}return i}};ar.prototype.toString=function(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce((r,t)=>`${r}, ${t}`,"")}]`};var Ts=class r{constructor(t=0,e=0,i=0,s=0,o=20){this.x=t,this.y=e,this.width=i,this.height=s,this.radius=o,this.type=gt.RREC}clone(){return new r(this.x,this.y,this.width,this.height,this.radius)}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){let i=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+i&&e<=this.y+this.height-i||t>=this.x+i&&t<=this.x+this.width-i)return!0;let s=t-(this.x+i),o=e-(this.y+i),n=i*i;if(s*s+o*o<=n||(s=t-(this.x+this.width-i),s*s+o*o<=n)||(o=e-(this.y+this.height-i),s*s+o*o<=n)||(s=t-(this.x+i),s*s+o*o<=n))return!0}return!1}};Ts.prototype.toString=function(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`};var ot=class r{constructor(t=1,e=0,i=0,s=1,o=0,n=0){this.array=null,this.a=t,this.b=e,this.c=i,this.d=s,this.tx=o,this.ty=n}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,i,s,o,n){return this.a=t,this.b=e,this.c=i,this.d=s,this.tx=o,this.ty=n,this}toArray(t,e){this.array||(this.array=new Float32Array(9));let i=e||this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i}apply(t,e){e=e||new $;let i=t.x,s=t.y;return e.x=this.a*i+this.c*s+this.tx,e.y=this.b*i+this.d*s+this.ty,e}applyInverse(t,e){e=e||new $;let i=1/(this.a*this.d+this.c*-this.b),s=t.x,o=t.y;return e.x=this.d*i*s+-this.c*i*o+(this.ty*this.c-this.tx*this.d)*i,e.y=this.a*i*o+-this.b*i*s+(-this.ty*this.a+this.tx*this.b)*i,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){let e=Math.cos(t),i=Math.sin(t),s=this.a,o=this.c,n=this.tx;return this.a=s*e-this.b*i,this.b=s*i+this.b*e,this.c=o*e-this.d*i,this.d=o*i+this.d*e,this.tx=n*e-this.ty*i,this.ty=n*i+this.ty*e,this}append(t){let e=this.a,i=this.b,s=this.c,o=this.d;return this.a=t.a*e+t.b*s,this.b=t.a*i+t.b*o,this.c=t.c*e+t.d*s,this.d=t.c*i+t.d*o,this.tx=t.tx*e+t.ty*s+this.tx,this.ty=t.tx*i+t.ty*o+this.ty,this}setTransform(t,e,i,s,o,n,a,l,h){return this.a=Math.cos(a+h)*o,this.b=Math.sin(a+h)*o,this.c=-Math.sin(a-l)*n,this.d=Math.cos(a-l)*n,this.tx=t-(i*this.a+s*this.c),this.ty=e-(i*this.b+s*this.d),this}prepend(t){let e=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){let i=this.a,s=this.c;this.a=i*t.a+this.b*t.c,this.b=i*t.b+this.b*t.d,this.c=s*t.a+this.d*t.c,this.d=s*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){let e=this.a,i=this.b,s=this.c,o=this.d,n=t.pivot,a=-Math.atan2(-s,o),l=Math.atan2(i,e),h=Math.abs(a+l);return h<1e-5||Math.abs(Yr-h)<1e-5?(t.rotation=l,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=a,t.skew.y=l),t.scale.x=Math.sqrt(e*e+i*i),t.scale.y=Math.sqrt(s*s+o*o),t.position.x=this.tx+(n.x*e+n.y*s),t.position.y=this.ty+(n.x*i+n.y*o),t}invert(){let t=this.a,e=this.b,i=this.c,s=this.d,o=this.tx,n=t*s-e*i;return this.a=s/n,this.b=-e/n,this.c=-i/n,this.d=t/n,this.tx=(i*this.ty-s*o)/n,this.ty=-(t*this.ty-e*o)/n,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){let t=new r;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}static get IDENTITY(){return new r}static get TEMP_MATRIX(){return new r}};ot.prototype.toString=function(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`};var _i=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],bi=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],Ti=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],wi=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Ic=[],Om=[],Da=Math.sign;function lb(){for(let r=0;r<16;r++){let t=[];Ic.push(t);for(let e=0;e<16;e++){let i=Da(_i[r]*_i[e]+Ti[r]*bi[e]),s=Da(bi[r]*_i[e]+wi[r]*bi[e]),o=Da(_i[r]*Ti[e]+Ti[r]*wi[e]),n=Da(bi[r]*Ti[e]+wi[r]*wi[e]);for(let a=0;a<16;a++)if(_i[a]===i&&bi[a]===s&&Ti[a]===o&&wi[a]===n){t.push(a);break}}}for(let r=0;r<16;r++){let t=new ot;t.set(_i[r],bi[r],Ti[r],wi[r],0,0),Om.push(t)}}lb();var vt={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:r=>_i[r],uY:r=>bi[r],vX:r=>Ti[r],vY:r=>wi[r],inv:r=>r&8?r&15:-r&7,add:(r,t)=>Ic[r][t],sub:(r,t)=>Ic[r][vt.inv(t)],rotate180:r=>r^4,isVertical:r=>(r&3)===2,byDirection:(r,t)=>Math.abs(r)*2<=Math.abs(t)?t>=0?vt.S:vt.N:Math.abs(t)*2<=Math.abs(r)?r>0?vt.E:vt.W:t>0?r>0?vt.SE:vt.SW:r>0?vt.NE:vt.NW,matrixAppendRotationInv:(r,t,e=0,i=0)=>{let s=Om[vt.inv(t)];s.tx=e,s.ty=i,r.append(s)}};var re=class r{constructor(t,e,i=0,s=0){this._x=i,this._y=s,this.cb=t,this.scope=e}clone(t=this.cb,e=this.scope){return new r(t,e,this._x,this._y)}set(t=0,e=t){return(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this.cb.call(this.scope)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}};re.prototype.toString=function(){return`[@pixi/math:ObservablePoint x=${this.x} y=${this.y} scope=${this.scope}]`};var Mc=class{constructor(){this.worldTransform=new ot,this.localTransform=new ot,this.position=new re(this.onChange,this,0,0),this.scale=new re(this.onChange,this,1,1),this.pivot=new re(this.onChange,this,0,0),this.skew=new re(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){let r=this.localTransform;this._localID!==this._currentLocalID&&(r.a=this._cx*this.scale.x,r.b=this._sx*this.scale.x,r.c=this._cy*this.scale.y,r.d=this._sy*this.scale.y,r.tx=this.position.x-(this.pivot.x*r.a+this.pivot.y*r.c),r.ty=this.position.y-(this.pivot.x*r.b+this.pivot.y*r.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(r){let t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==r._worldID){let e=r.worldTransform,i=this.worldTransform;i.a=t.a*e.a+t.b*e.c,i.b=t.a*e.b+t.b*e.d,i.c=t.c*e.a+t.d*e.c,i.d=t.c*e.b+t.d*e.d,i.tx=t.tx*e.a+t.ty*e.c+e.tx,i.ty=t.tx*e.b+t.ty*e.d+e.ty,this._parentID=r._worldID,this._worldID++}}setFromMatrix(r){r.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(r){this._rotation!==r&&(this._rotation=r,this.updateSkew())}};Mc.IDENTITY=new Mc;var Ci=Mc;Ci.prototype.toString=function(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`};var km=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`;var Nm=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function Ba(r,t,e){let i=r.createShader(t);return r.shaderSource(i,e),r.compileShader(i),i}function Rc(r){let t=new Array(r);for(let e=0;e<t.length;e++)t[e]=!1;return t}function Uo(r,t){switch(r){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return Rc(2*t);case"bvec3":return Rc(3*t);case"bvec4":return Rc(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}var lr=[{test:r=>r.type==="float"&&r.size===1&&!r.isArray,code:r=>`
            if(uv["${r}"] !== ud["${r}"].value)
            {
                ud["${r}"].value = uv["${r}"]
                gl.uniform1f(ud["${r}"].location, uv["${r}"])
            }
            `},{test:(r,t)=>(r.type==="sampler2D"||r.type==="samplerCube"||r.type==="sampler2DArray")&&r.size===1&&!r.isArray&&(t==null||t.castToBaseTexture!==void 0),code:r=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${r}"], t);

            if(ud["${r}"].value !== t)
            {
                ud["${r}"].value = t;
                gl.uniform1i(ud["${r}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(r,t)=>r.type==="mat3"&&r.size===1&&!r.isArray&&t.a!==void 0,code:r=>`
            gl.uniformMatrix3fv(ud["${r}"].location, false, uv["${r}"].toArray(true));
            `,codeUbo:r=>`
                var ${r}_matrix = uv.${r}.toArray(true);

                data[offset] = ${r}_matrix[0];
                data[offset+1] = ${r}_matrix[1];
                data[offset+2] = ${r}_matrix[2];
        
                data[offset + 4] = ${r}_matrix[3];
                data[offset + 5] = ${r}_matrix[4];
                data[offset + 6] = ${r}_matrix[5];
        
                data[offset + 8] = ${r}_matrix[6];
                data[offset + 9] = ${r}_matrix[7];
                data[offset + 10] = ${r}_matrix[8];
            `},{test:(r,t)=>r.type==="vec2"&&r.size===1&&!r.isArray&&t.x!==void 0,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${r}"].location, v.x, v.y);
                }`,codeUbo:r=>`
                v = uv.${r};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:r=>r.type==="vec2"&&r.size===1&&!r.isArray,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${r}"].location, v[0], v[1]);
                }
            `},{test:(r,t)=>r.type==="vec4"&&r.size===1&&!r.isArray&&t.width!==void 0,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${r}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:r=>`
                    v = uv.${r};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:(r,t)=>r.type==="vec4"&&r.size===1&&!r.isArray&&t.red!==void 0,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
                    cv[3] = v.alpha;
                    gl.uniform4f(ud["${r}"].location, v.red, v.green, v.blue, v.alpha)
                }`,codeUbo:r=>`
                    v = uv.${r};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                    data[offset+3] = v.alpha;
                `},{test:(r,t)=>r.type==="vec3"&&r.size===1&&!r.isArray&&t.red!==void 0,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
    
                    gl.uniform3f(ud["${r}"].location, v.red, v.green, v.blue)
                }`,codeUbo:r=>`
                    v = uv.${r};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                `},{test:r=>r.type==="vec4"&&r.size===1&&!r.isArray,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${r}"].location, v[0], v[1], v[2], v[3])
                }`}];var hb={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},cb={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function Fc(r,t){let e=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(let i in r.uniforms){let s=t[i];if(!s){r.uniforms[i]?.group===!0&&(r.uniforms[i].ubo?e.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${i}, '${i}');
                    `):e.push(`
                        renderer.shader.syncUniformGroup(uv.${i}, syncData);
                    `));continue}let o=r.uniforms[i],n=!1;for(let a=0;a<lr.length;a++)if(lr[a].test(s,o)){e.push(lr[a].code(i,o)),n=!0;break}if(!n){let a=(s.size===1&&!s.isArray?hb:cb)[s.type].replace("location",`ud["${i}"].location`);e.push(`
            cu = ud["${i}"];
            cv = cu.value;
            v = uv["${i}"];
            ${a};`)}}return new Function("ud","uv","renderer","syncData",e.join(`
`))}var Um={},La=Um;function Oa(){if(La===Um||La?.isContextLost()){let r=C.ADAPTER.createCanvas(),t;C.PREFER_ENV>=Se.WEBGL2&&(t=r.getContext("webgl2",{})),t||(t=r.getContext("webgl",{})||r.getContext("experimental-webgl",{}),t?t.getExtension("WEBGL_draw_buffers"):t=null),La=t}return La}var ka;function Dc(){if(!ka){ka=he.MEDIUM;let r=Oa();if(r&&r.getShaderPrecisionFormat){let t=r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT);t&&(ka=t.precision?he.HIGH:he.MEDIUM)}}return ka}function Gm(r,t){let e=r.getShaderSource(t).split(`
`).map((h,c)=>`${c}: ${h}`),i=r.getShaderInfoLog(t),s=i.split(`
`),o={},n=s.map(h=>parseFloat(h.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(h=>h&&!o[h]?(o[h]=!0,!0):!1),a=[""];n.forEach(h=>{e[h-1]=`%c${e[h-1]}%c`,a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});let l=e.join(`
`);a[0]=l,console.error(i),console.groupCollapsed("click to view full shader code"),console.warn(...a),console.groupEnd()}function Bc(r,t,e,i){r.getProgramParameter(t,r.LINK_STATUS)||(r.getShaderParameter(e,r.COMPILE_STATUS)||Gm(r,e),r.getShaderParameter(i,r.COMPILE_STATUS)||Gm(r,i),console.error("PixiJS Error: Could not initialize shader."),r.getProgramInfoLog(t)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",r.getProgramInfoLog(t)))}var ub={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function Go(r){return ub[r]}var Na=null,zm={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function zo(r,t){if(!Na){let e=Object.keys(zm);Na={};for(let i=0;i<e.length;++i){let s=e[i];Na[r[s]]=zm[s]}}return Na[t]}function Ua(r,t,e){if(r.substring(0,9)!=="precision"){let i=t;return t===he.HIGH&&e!==he.HIGH&&(i=he.MEDIUM),`precision ${i} float;
${r}`}else if(e!==he.HIGH&&r.substring(0,15)==="precision highp")return r.replace("precision highp","precision mediump");return r}var Ho;function Ga(){if(typeof Ho=="boolean")return Ho;try{Ho=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{Ho=!1}return Ho}var db=0,za={},Lc=class ws{constructor(t,e,i="pixi-shader",s={}){this.extra={},this.id=db++,this.vertexSrc=t||ws.defaultVertexSrc,this.fragmentSrc=e||ws.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=s,this.vertexSrc.substring(0,8)!=="#version"&&(i=i.replace(/\s+/g,"-"),za[i]?(za[i]++,i+=`-${za[i]}`):za[i]=1,this.vertexSrc=`#define SHADER_NAME ${i}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${i}
${this.fragmentSrc}`,this.vertexSrc=Ua(this.vertexSrc,ws.defaultVertexPrecision,he.HIGH),this.fragmentSrc=Ua(this.fragmentSrc,ws.defaultFragmentPrecision,Dc())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return Nm}static get defaultFragmentSrc(){return km}static from(t,e,i){let s=t+e,o=Oo[s];return o||(Oo[s]=o=new ws(t,e,i)),o}};Lc.defaultVertexPrecision=he.HIGH,Lc.defaultFragmentPrecision=De.apple.device?he.HIGH:he.MEDIUM;var ie=Lc;var pb=0,de=class r{constructor(t,e,i){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=pb++,this.static=!!e,this.ubo=!!i,t instanceof mt?(this.buffer=t,this.buffer.type=ye.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new mt(new Float32Array(1)),this.buffer.type=ye.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,e,i){if(!this.ubo)this.uniforms[t]=new r(e,i);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(t,e,i){return new r(t,e,i)}static uboFrom(t,e){return new r(t,e??!0,!0)}};var Xt=class r{constructor(t,e){this.uniformBindCount=0,this.program=t,e?e instanceof de?this.uniformGroup=e:this.uniformGroup=new de(e):this.uniformGroup=new de({}),this.disposeRunner=new It("disposeShader")}checkUniformExists(t,e){if(e.uniforms[t])return!0;for(let i in e.uniforms){let s=e.uniforms[i];if(s.group===!0&&this.checkUniformExists(t,s))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,e,i){let s=ie.from(t,e);return new r(s,i)}};var Vo=class{constructor(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},!e.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!e.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){let i=new Int32Array(t);for(let o=0;o<t;o++)i[o]=o;this.defaultGroupCache[t]=de.from({uSamplers:i},!0);let s=this.fragTemplate;s=s.replace(/%count%/gi,`${t}`),s=s.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new ie(this.vertexSrc,s)}let e={tint:new Float32Array([1,1,1,1]),translationMatrix:new ot,default:this.defaultGroupCache[t]};return new Xt(this.programCache[t],e)}generateSampleSrc(t){let e="";e+=`
`,e+=`
`;for(let i=0;i<t;i++)i>0&&(e+=`
else `),i<t-1&&(e+=`if(vTextureId < ${i}.5)`),e+=`
{`,e+=`
	color = texture2D(uSamplers[${i}], vTextureCoord);`,e+=`
}`;return e+=`
`,e+=`
`,e}};var Kr=class{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}};function Hm(){return!De.apple.device}function Vm(r){let t=!0,e=C.ADAPTER.getNavigator();if(De.tablet||De.phone){if(De.apple.device){let i=e.userAgent.match(/OS (\d+)_(\d+)?/);i&&parseInt(i[1],10)<11&&(t=!1)}if(De.android.device){let i=e.userAgent.match(/Android\s([0-9.]*)/);i&&parseInt(i[1],10)<7&&(t=!1)}}return t?r:4}var Ye=class{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}};var jm=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`;var Wm=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;var jo=class Ke extends Ye{constructor(t){super(t),this.setShaderGenerator(),this.geometryClass=vi,this.vertexSize=6,this.state=Gt.for2d(),this.size=Ke.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),t.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??Vm(32),this._defaultMaxTextures}static set defaultMaxTextures(t){this._defaultMaxTextures=t}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??Hm(),this._canUploadSameBuffer}static set canUploadSameBuffer(t){this._canUploadSameBuffer=t}get MAX_TEXTURES(){return et("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return Wm}static get defaultFragmentTemplate(){return jm}setShaderGenerator({vertex:t=Ke.defaultVertexSrc,fragment:e=Ke.defaultFragmentTemplate}={}){this.shaderGenerator=new Vo(t,e)}contextChange(){let t=this.renderer.gl;C.PREFER_ENV===Se.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),Ke.defaultMaxTextures),this.maxTextures=Ra(this.maxTextures,t)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){let{_drawCallPool:t,_textureArrayPool:e}=Ke,i=this.size/4,s=Math.floor(i/this.maxTextures)+1;for(;t.length<i;)t.push(new $r);for(;e.length<s;)e.push(new Kr);for(let o=0;o<this.maxTextures;o++)this._tempBoundTextures[o]=null}onPrerender(){this._flushId=0}render(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)}buildTexturesAndDrawCalls(){let{_bufferedTextures:t,maxTextures:e}=this,i=Ke._textureArrayPool,s=this.renderer.batch,o=this._tempBoundTextures,n=this.renderer.textureGC.count,a=++K._globalBatch,l=0,h=i[0],c=0;s.copyBoundTextures(o,e);for(let u=0;u<this._bufferSize;++u){let d=t[u];t[u]=null,d._batchEnabled!==a&&(h.count>=e&&(s.boundArray(h,o,a,e),this.buildDrawCalls(h,c,u),c=u,h=i[++l],++a),d._batchEnabled=a,d.touched=n,h.elements[h.count++]=d)}h.count>0&&(s.boundArray(h,o,a,e),this.buildDrawCalls(h,c,this._bufferSize),++l,++a);for(let u=0;u<o.length;u++)o[u]=null;K._globalBatch=a}buildDrawCalls(t,e,i){let{_bufferedElements:s,_attributeBuffer:o,_indexBuffer:n,vertexSize:a}=this,l=Ke._drawCallPool,h=this._dcIndex,c=this._aIndex,u=this._iIndex,d=l[h];d.start=this._iIndex,d.texArray=t;for(let p=e;p<i;++p){let f=s[p],m=f._texture.baseTexture,g=Fo[m.alphaMode?1:0][f.blendMode];s[p]=null,e<p&&d.blend!==g&&(d.size=u-d.start,e=p,d=l[++h],d.texArray=t,d.start=u),this.packInterleavedGeometry(f,o,n,c,u),c+=f.vertexData.length/2*a,u+=f.indices.length,d.blend=g}e<i&&(d.size=u-d.start,++h),this._dcIndex=h,this._aIndex=c,this._iIndex=u}bindAndClearTexArray(t){let e=this.renderer.texture;for(let i=0;i<t.count;i++)e.bind(t.elements[i],t.ids[i]),t.elements[i]=null;t.count=0}updateGeometry(){let{_packedGeometries:t,_attributeBuffer:e,_indexBuffer:i}=this;Ke.canUploadSameBuffer?(t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(i),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,t[this._flushId]=new this.geometryClass),t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(i),this.renderer.geometry.bind(t[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){let t=this._dcIndex,{gl:e,state:i}=this.renderer,s=Ke._drawCallPool,o=null;for(let n=0;n<t;n++){let{texArray:a,type:l,size:h,start:c,blend:u}=s[n];o!==a&&(o=a,this.bindAndClearTexArray(a)),this.state.blendMode=u,i.set(this.state),e.drawElements(l,h,e.UNSIGNED_SHORT,c*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),Ke.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(t){let e=Wr(Math.ceil(t/8)),i=Bo(e),s=e*8;this._aBuffers.length<=i&&(this._iBuffers.length=i+1);let o=this._aBuffers[s];return o||(this._aBuffers[s]=o=new Xr(s*this.vertexSize*4)),o}getIndexBuffer(t){let e=Wr(Math.ceil(t/12)),i=Bo(e),s=e*12;this._iBuffers.length<=i&&(this._iBuffers.length=i+1);let o=this._iBuffers[i];return o||(this._iBuffers[i]=o=new Uint16Array(s)),o}packInterleavedGeometry(t,e,i,s,o){let{uint32View:n,float32View:a}=e,l=s/this.vertexSize,h=t.uvs,c=t.indices,u=t.vertexData,d=t._texture.baseTexture._batchLocation,p=Math.min(t.worldAlpha,1),f=tt.shared.setValue(t._tintRGB).toPremultiplied(p,t._texture.baseTexture.alphaMode>0);for(let m=0;m<u.length;m+=2)a[s++]=u[m],a[s++]=u[m+1],a[s++]=h[m],a[s++]=h[m+1],n[s++]=f,a[s++]=d;for(let m=0;m<c.length;m++)i[o++]=l+c[m]}};jo.defaultBatchSize=4096,jo.extension={name:"batch",type:T.RendererPlugin},jo._drawCallPool=[],jo._textureArrayPool=[];var Sr=jo;S.add(Sr);var Xm=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`;var $m=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;var Oc=class Wo extends Xt{constructor(t,e,i){let s=ie.from(t||Wo.defaultVertexSrc,e||Wo.defaultFragmentSrc);super(s,i),this.padding=0,this.resolution=Wo.defaultResolution,this.multisample=Wo.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new Gt}apply(t,e,i,s,o){t.applyFilter(this,e,i,s)}get blendMode(){return this.state.blendMode}set blendMode(t){this.state.blendMode=t}get resolution(){return this._resolution}set resolution(t){this._resolution=t}static get defaultVertexSrc(){return $m}static get defaultFragmentSrc(){return Xm}};Oc.defaultResolution=1,Oc.defaultMultisample=ft.NONE;var z=Oc;var Er=class{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new tt(0),this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender;let{backgroundColor:e,background:i,backgroundAlpha:s}=t,o=i??e;o!==void 0&&(this.color=o),this.alpha=s}get color(){return this._backgroundColor.value}set color(t){this._backgroundColor.setValue(t)}get alpha(){return this._backgroundColor.alpha}set alpha(t){this._backgroundColor.setAlpha(t)}get backgroundColor(){return this._backgroundColor}destroy(){}};Er.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},Er.extension={type:[T.RendererSystem,T.CanvasRendererSystem],name:"background"};S.add(Er);var Cs=class{constructor(t){this.renderer=t,this.emptyRenderer=new Ye(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,e){let{boundTextures:i}=this.renderer.texture;for(let s=e-1;s>=0;--s)t[s]=i[s]||null,t[s]&&(t[s]._batchLocation=s)}boundArray(t,e,i,s){let{elements:o,ids:n,count:a}=t,l=0;for(let h=0;h<a;h++){let c=o[h],u=c._batchLocation;if(u>=0&&u<s&&e[u]===c){n[h]=u;continue}for(;l<s;){let d=e[l];if(d&&d._batchEnabled===i&&d._batchLocation===l){l++;continue}n[h]=l,c._batchLocation=l,e[l]=c;break}}}destroy(){this.renderer=null}};Cs.extension={type:T.RendererSystem,name:"batch"};S.add(Cs);var Ym=0,Ar=class{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=Ym++}init(t){if(t.context)this.initFromContext(t.context);else{let e=this.renderer.background.alpha<1,i=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:e,premultipliedAlpha:i,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=Ym++,this.renderer.runners.contextChange.emit(t);let e=this.renderer.view;e.addEventListener!==void 0&&(e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){let e=this.createContext(this.renderer.view,t);this.initFromContext(e)}createContext(t,e){let i;if(C.PREFER_ENV>=Se.WEBGL2&&(i=t.getContext("webgl2",e)),i)this.webGLVersion=2;else if(this.webGLVersion=1,i=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),!i)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=i,this.getExtensions(),this.gl}getExtensions(){let{gl:t}=this,e={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};this.webGLVersion===1?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){let t=this.renderer.view;this.renderer=null,t.removeEventListener!==void 0&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){let e=t.getContextAttributes(),i="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;i&&(this.webGLVersion=2),e&&!e.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");let s=i||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=s,s||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}};Ar.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},Ar.extension={type:T.RendererSystem,name:"context"};S.add(Ar);var qr=class{constructor(t,e){if(this.width=Math.round(t),this.height=Math.round(e),!this.width||!this.height)throw new Error("Framebuffer width or height is zero");this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new It("disposeFramebuffer"),this.multisample=ft.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,e){return this.colorTextures[t]=e||new K(null,{scaleMode:Wt.NEAREST,resolution:1,mipmap:Lt.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new K(null,{scaleMode:Wt.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:Lt.OFF,format:R.DEPTH_COMPONENT,type:X.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,e){if(t=Math.round(t),e=Math.round(e),!t||!e)throw new Error("Framebuffer width and height must not be zero");if(!(t===this.width&&e===this.height)){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(let i=0;i<this.colorTextures.length;i++){let s=this.colorTextures[i],o=s.resolution;s.setSize(t/o,e/o)}if(this.depthTexture){let i=this.depthTexture.resolution;this.depthTexture.setSize(t/i,e/i)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}};var Si=class extends K{constructor(t={}){if(typeof t=="number"){let e=arguments[0],i=arguments[1],s=arguments[2],o=arguments[3];t={width:e,height:i,scaleMode:s,resolution:o}}t.width=t.width??100,t.height=t.height??100,t.multisample??(t.multisample=ft.NONE),super(null,t),this.mipmap=Lt.OFF,this.valid=!0,this._clear=new tt([0,0,0,0]),this.framebuffer=new qr(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(t){this._clear.setValue(t)}get clearColor(){return this._clear.value}get clear(){return this._clear}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}};var $t=class extends Pe{constructor(t){let e=t,i=e.naturalWidth||e.videoWidth||e.width,s=e.naturalHeight||e.videoHeight||e.height;super(i,s),this.source=t,this.noSubImage=!1}static crossOrigin(t,e,i){i===void 0&&!e.startsWith("data:")?t.crossOrigin=Ma(e):i!==!1&&(t.crossOrigin=typeof i=="string"?i:"anonymous")}upload(t,e,i,s){let o=t.gl,n=e.realWidth,a=e.realHeight;if(s=s||this.source,typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement){if(!s.complete||s.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&s instanceof HTMLVideoElement&&s.readyState<=1)return!1;return o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===St.UNPACK),!this.noSubImage&&e.target===o.TEXTURE_2D&&i.width===n&&i.height===a?o.texSubImage2D(o.TEXTURE_2D,0,0,0,e.format,i.type,s):(i.width=n,i.height=a,o.texImage2D(e.target,0,i.internalFormat,e.format,i.type,s)),!0}update(){if(this.destroyed)return;let t=this.source,e=t.naturalWidth||t.videoWidth||t.width,i=t.naturalHeight||t.videoHeight||t.height;this.resize(e,i),super.update()}dispose(){this.source=null}};var Ei=class extends $t{constructor(t,e){if(e=e||{},typeof t=="string"){let i=new Image;$t.crossOrigin(i,t,e.crossorigin),i.src=t,t=i}super(t),!t.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(e.createBitmap??C.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this.bitmap=null,this._load=null,e.autoLoad!==!1&&this.load()}load(t){return this._load?this._load:(t!==void 0&&(this.createBitmap=t),this._load=new Promise((e,i)=>{let s=this.source;this.url=s.src;let o=()=>{this.destroyed||(s.onload=null,s.onerror=null,this.update(),this._load=null,this.createBitmap?e(this.process()):e(this))};s.complete&&s.src?o():(s.onload=o,s.onerror=n=>{i(n),this.onError.emit(n)})}),this._load)}process(){let t=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);let e=globalThis.createImageBitmap,i=!t.crossOrigin||t.crossOrigin==="anonymous";return this._process=fetch(t.src,{mode:i?"cors":"no-cors"}).then(s=>s.blob()).then(s=>e(s,0,0,t.width,t.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===St.UNPACK?"premultiply":"none"})).then(s=>this.destroyed?Promise.reject():(this.bitmap=s,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(t,e,i){if(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,e,i);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,e,i,this.bitmap),!this.preserveBitmap){let s=!0,o=e._glTextures;for(let n in o){let a=o[n];if(a!==i&&a.dirtyId!==e.dirtyId){s=!1;break}}s&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return typeof HTMLImageElement<"u"&&(typeof t=="string"||t instanceof HTMLImageElement)}};var Ai=class{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,e,i){let s=e.width,o=e.height;if(i){let n=t.width/2/s,a=t.height/2/o,l=t.x/s+n,h=t.y/o+a;i=vt.add(i,vt.NW),this.x0=l+n*vt.uX(i),this.y0=h+a*vt.uY(i),i=vt.add(i,2),this.x1=l+n*vt.uX(i),this.y1=h+a*vt.uY(i),i=vt.add(i,2),this.x2=l+n*vt.uX(i),this.y2=h+a*vt.uY(i),i=vt.add(i,2),this.x3=l+n*vt.uX(i),this.y3=h+a*vt.uY(i)}else this.x0=t.x/s,this.y0=t.y/o,this.x1=(t.x+t.width)/s,this.y1=t.y/o,this.x2=(t.x+t.width)/s,this.y2=(t.y+t.height)/o,this.x3=t.x/s,this.y3=(t.y+t.height)/o;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}};Ai.prototype.toString=function(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`};var Km=new Ai;function Ha(r){r.destroy=function(){},r.on=function(){},r.once=function(){},r.emit=function(){}}var v=class r extends nr.default{constructor(t,e,i,s,o,n,a){if(super(),this.noFrame=!1,e||(this.noFrame=!0,e=new Y(0,0,1,1)),t instanceof r&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.trim=s,this.valid=!1,this.destroyed=!1,this._uvs=Km,this.uvMatrix=null,this.orig=i||e,this._rotate=Number(o||0),o===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=n?new $(n.x,n.y):new $(0,0),this.defaultBorders=a,this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=e:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){let{resource:e}=this.baseTexture;e?.url&&Ut[e.url]&&r.removeFromCache(e.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,r.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}clone(){let t=this._frame.clone(),e=this._frame===this.orig?t:this.orig.clone(),i=new r(this.baseTexture,!this.noFrame&&t,e,this.trim?.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(i._frame=t),i}updateUvs(){this._uvs===Km&&(this._uvs=new Ai),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,e={},i=C.STRICT_TEXTURE_CACHE){let s=typeof t=="string",o=null;if(s)o=t;else if(t instanceof K){if(!t.cacheId){let a=e?.pixiIdPrefix||"pixiid";t.cacheId=`${a}-${or()}`,K.addToCache(t,t.cacheId)}o=t.cacheId}else{if(!t._pixiId){let a=e?.pixiIdPrefix||"pixiid";t._pixiId=`${a}_${or()}`}o=t._pixiId}let n=Ut[o];if(s&&i&&!n)throw new Error(`The cacheId "${o}" does not exist in TextureCache.`);return!n&&!(t instanceof K)?(e.resolution||(e.resolution=ko(t)),n=new r(new K(t,e)),n.baseTexture.cacheId=o,K.addToCache(n.baseTexture,o),r.addToCache(n,o)):!n&&t instanceof K&&(n=new r(t),r.addToCache(n,o)),n}static fromURL(t,e){let i=Object.assign({autoLoad:!1},e?.resourceOptions),s=r.from(t,Object.assign({resourceOptions:i},e),!1),o=s.baseTexture.resource;return s.baseTexture.valid?Promise.resolve(s):o.load().then(()=>Promise.resolve(s))}static fromBuffer(t,e,i,s){return new r(K.fromBuffer(t,e,i,s))}static fromLoader(t,e,i,s){let o=new K(t,Object.assign({scaleMode:K.defaultOptions.scaleMode,resolution:ko(e)},s)),{resource:n}=o;n instanceof Ei&&(n.url=e);let a=new r(o);return i||(i=e),K.addToCache(a.baseTexture,i),r.addToCache(a,i),i!==e&&(K.addToCache(a.baseTexture,e),r.addToCache(a,e)),a.baseTexture.valid?Promise.resolve(a):new Promise(l=>{a.baseTexture.once("loaded",()=>l(a))})}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),Ut[e]&&Ut[e]!==t&&console.warn(`Texture added to the cache with an id [${e}] that already had an entry`),Ut[e]=t)}static removeFromCache(t){if(typeof t=="string"){let e=Ut[t];if(e){let i=e.textureCacheIds.indexOf(t);return i>-1&&e.textureCacheIds.splice(i,1),delete Ut[t],e}}else if(t?.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)Ut[t.textureCacheIds[e]]===t&&delete Ut[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;let{x:e,y:i,width:s,height:o}=t,n=e+s>this.baseTexture.width,a=i+o>this.baseTexture.height;if(n||a){let l=n&&a?"and":"or",h=`X: ${e} + ${s} = ${e+s} > ${this.baseTexture.width}`,c=`Y: ${i} + ${o} = ${i+o} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${h} ${l} ${c}`)}this.valid=s&&o&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return r._EMPTY||(r._EMPTY=new r(new K),Ha(r._EMPTY),Ha(r._EMPTY.baseTexture)),r._EMPTY}static get WHITE(){if(!r._WHITE){let t=C.ADAPTER.createCanvas(16,16),e=t.getContext("2d");t.width=16,t.height=16,e.fillStyle="white",e.fillRect(0,0,16,16),r._WHITE=new r(K.from(t)),Ha(r._WHITE),Ha(r._WHITE.baseTexture)}return r._WHITE}};var Oe=class r extends v{constructor(t,e){super(t,e),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e,i=!0){let s=this.baseTexture.resolution,o=Math.round(t*s)/s,n=Math.round(e*s)/s;this.valid=o>0&&n>0,this._frame.width=this.orig.width=o,this._frame.height=this.orig.height=n,i&&this.baseTexture.resize(o,n),this.updateUvs()}setResolution(t){let{baseTexture:e}=this;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))}static create(t){return new r(new Si(t))}};var Ss=class{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,e,i=ft.NONE){let s=new Si(Object.assign({width:t,height:e,resolution:1,multisample:i},this.textureOptions));return new Oe(s)}getOptimalTexture(t,e,i=1,s=ft.NONE){let o;t=Math.max(Math.ceil(t*i-1e-6),1),e=Math.max(Math.ceil(e*i-1e-6),1),!this.enableFullScreen||t!==this._pixelsWidth||e!==this._pixelsHeight?(t=Wr(t),e=Wr(e),o=((t&65535)<<16|e&65535)>>>0,s>1&&(o+=s*4294967296)):o=s>1?-s:-1,this.texturePool[o]||(this.texturePool[o]=[]);let n=this.texturePool[o].pop();return n||(n=this.createTexture(t,e,s)),n.filterPoolKey=o,n.setResolution(i),n}getFilterTexture(t,e,i){let s=this.getOptimalTexture(t.width,t.height,e||t.resolution,i||ft.NONE);return s.filterFrame=t.filterFrame,s}returnTexture(t){let e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=t!==!1,t)for(let e in this.texturePool){let i=this.texturePool[e];if(i)for(let s=0;s<i.length;s++)i[s].destroy(!0)}this.texturePool={}}setScreenSize(t){if(!(t.width===this._pixelsWidth&&t.height===this._pixelsHeight)){this.enableFullScreen=t.width>0&&t.height>0;for(let e in this.texturePool){if(!(Number(e)<0))continue;let i=this.texturePool[e];if(i)for(let s=0;s<i.length;s++)i[s].destroy(!0);this.texturePool[e]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}};Ss.SCREEN_KEY=-1;var Xo=class extends Ie{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}};var Pi=class extends Ie{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new mt(this.vertices),this.uvBuffer=new mt(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,e){let i=0,s=0;return this.uvs[0]=i,this.uvs[1]=s,this.uvs[2]=i+e.width/t.width,this.uvs[3]=s,this.uvs[4]=i+e.width/t.width,this.uvs[5]=s+e.height/t.height,this.uvs[6]=i,this.uvs[7]=s+e.height/t.height,i=e.x,s=e.y,this.vertices[0]=i,this.vertices[1]=s,this.vertices[2]=i+e.width,this.vertices[3]=s,this.vertices[4]=i+e.width,this.vertices[5]=s+e.height,this.vertices[6]=i,this.vertices[7]=s+e.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}};var $o=class{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=ft.NONE,this.sourceFrame=new Y,this.destinationFrame=new Y,this.bindingSourceFrame=new Y,this.bindingDestinationFrame=new Y,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}};var Va=[new $,new $,new $,new $],kc=new ot,Es=class{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new Ss,this.statePool=[],this.quad=new Xo,this.quadUv=new Pi,this.tempRect=new Y,this.activeState={},this.globalUniforms=new de({outputFrame:new Y,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,e){let i=this.renderer,s=this.defaultFilterStack,o=this.statePool.pop()||new $o,n=i.renderTexture,a,l;if(n.current){let g=n.current;a=g.resolution,l=g.multisample}else a=i.resolution,l=i.multisample;let h=e[0].resolution||a,c=e[0].multisample??l,u=e[0].padding,d=e[0].autoFit,p=e[0].legacy??!0;for(let g=1;g<e.length;g++){let x=e[g];h=Math.min(h,x.resolution||a),c=Math.min(c,x.multisample??l),u=this.useMaxPadding?Math.max(u,x.padding):u+x.padding,d=d&&x.autoFit,p=p||(x.legacy??!0)}s.length===1&&(this.defaultFilterStack[0].renderTexture=n.current),s.push(o),o.resolution=h,o.multisample=c,o.legacy=p,o.target=t,o.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),o.sourceFrame.pad(u);let f=this.tempRect.copyFrom(n.sourceFrame);i.projection.transform&&this.transformAABB(kc.copyFrom(i.projection.transform).invert(),f),d?(o.sourceFrame.fit(f),(o.sourceFrame.width<=0||o.sourceFrame.height<=0)&&(o.sourceFrame.width=0,o.sourceFrame.height=0)):o.sourceFrame.intersects(f)||(o.sourceFrame.width=0,o.sourceFrame.height=0),this.roundFrame(o.sourceFrame,n.current?n.current.resolution:i.resolution,n.sourceFrame,n.destinationFrame,i.projection.transform),o.renderTexture=this.getOptimalFilterTexture(o.sourceFrame.width,o.sourceFrame.height,h,c),o.filters=e,o.destinationFrame.width=o.renderTexture.width,o.destinationFrame.height=o.renderTexture.height;let m=this.tempRect;m.x=0,m.y=0,m.width=o.sourceFrame.width,m.height=o.sourceFrame.height,o.renderTexture.filterFrame=o.sourceFrame,o.bindingSourceFrame.copyFrom(n.sourceFrame),o.bindingDestinationFrame.copyFrom(n.destinationFrame),o.transform=i.projection.transform,i.projection.transform=null,n.bind(o.renderTexture,o.sourceFrame,m),i.framebuffer.clear(0,0,0,0)}pop(){let t=this.defaultFilterStack,e=t.pop(),i=e.filters;this.activeState=e;let s=this.globalUniforms.uniforms;s.outputFrame=e.sourceFrame,s.resolution=e.resolution;let o=s.inputSize,n=s.inputPixel,a=s.inputClamp;if(o[0]=e.destinationFrame.width,o[1]=e.destinationFrame.height,o[2]=1/o[0],o[3]=1/o[1],n[0]=Math.round(o[0]*e.resolution),n[1]=Math.round(o[1]*e.resolution),n[2]=1/n[0],n[3]=1/n[1],a[0]=.5*n[2],a[1]=.5*n[3],a[2]=e.sourceFrame.width*o[2]-.5*n[2],a[3]=e.sourceFrame.height*o[3]-.5*n[3],e.legacy){let h=s.filterArea;h[0]=e.destinationFrame.width,h[1]=e.destinationFrame.height,h[2]=e.sourceFrame.x,h[3]=e.sourceFrame.y,s.filterClamp=s.inputClamp}this.globalUniforms.update();let l=t[t.length-1];if(this.renderer.framebuffer.blit(),i.length===1)i[0].apply(this,e.renderTexture,l.renderTexture,Ae.BLEND,e),this.returnFilterTexture(e.renderTexture);else{let h=e.renderTexture,c=this.getOptimalFilterTexture(h.width,h.height,e.resolution);c.filterFrame=h.filterFrame;let u=0;for(u=0;u<i.length-1;++u){u===1&&e.multisample>1&&(c=this.getOptimalFilterTexture(h.width,h.height,e.resolution),c.filterFrame=h.filterFrame),i[u].apply(this,h,c,Ae.CLEAR,e);let d=h;h=c,c=d}i[u].apply(this,h,l.renderTexture,Ae.BLEND,e),u>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(h),this.returnFilterTexture(c)}e.clear(),this.statePool.push(e)}bindAndClear(t,e=Ae.CLEAR){let{renderTexture:i,state:s}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t?.filterFrame){let n=this.tempRect;n.x=0,n.y=0,n.width=t.filterFrame.width,n.height=t.filterFrame.height,i.bind(t,t.filterFrame,n)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?i.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);let o=s.stateId&1||this.forceClear;(e===Ae.CLEAR||e===Ae.BLIT&&o)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,e,i,s){let o=this.renderer;o.state.set(t.state),this.bindAndClear(i,s),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,o.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),o.geometry.bind(this.quadUv),o.geometry.draw(xe.TRIANGLES)):(o.geometry.bind(this.quad),o.geometry.draw(xe.TRIANGLE_STRIP))}calculateSpriteMatrix(t,e){let{sourceFrame:i,destinationFrame:s}=this.activeState,{orig:o}=e._texture,n=t.set(s.width,0,0,s.height,i.x,i.y),a=e.worldTransform.copyTo(ot.TEMP_MATRIX);return a.invert(),n.prepend(a),n.scale(1/o.width,1/o.height),n.translate(e.anchor.x,e.anchor.y),n}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,e,i=1,s=ft.NONE){return this.texturePool.getOptimalTexture(t,e,i,s)}getFilterTexture(t,e,i){if(typeof t=="number"){let o=t;t=e,e=o}t=t||this.activeState.renderTexture;let s=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,i||ft.NONE);return s.filterFrame=t.filterFrame,s}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,e){let i=Va[0],s=Va[1],o=Va[2],n=Va[3];i.set(e.left,e.top),s.set(e.left,e.bottom),o.set(e.right,e.top),n.set(e.right,e.bottom),t.apply(i,i),t.apply(s,s),t.apply(o,o),t.apply(n,n);let a=Math.min(i.x,s.x,o.x,n.x),l=Math.min(i.y,s.y,o.y,n.y),h=Math.max(i.x,s.x,o.x,n.x),c=Math.max(i.y,s.y,o.y,n.y);e.x=a,e.y=l,e.width=h-a,e.height=c-l}roundFrame(t,e,i,s,o){if(!(t.width<=0||t.height<=0||i.width<=0||i.height<=0)){if(o){let{a:n,b:a,c:l,d:h}=o;if((Math.abs(a)>1e-4||Math.abs(l)>1e-4)&&(Math.abs(n)>1e-4||Math.abs(h)>1e-4))return}o=o?kc.copyFrom(o):kc.identity(),o.translate(-i.x,-i.y).scale(s.width/i.width,s.height/i.height).translate(s.x,s.y),this.transformAABB(o,t),t.ceil(e),this.transformAABB(o.invert(),t)}}};Es.extension={type:T.RendererSystem,name:"filter"};S.add(Es);var Yo=class{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=ft.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}};var fb=new Y,As=class{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new qr(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);let t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Y,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let e=this.renderer.context.extensions.drawBuffers,i=this.renderer.context.extensions.depthTexture;C.PREFER_ENV===Se.WEBGL_LEGACY&&(e=null,i=null),e?t.drawBuffers=s=>e.drawBuffersWEBGL(s):(this.hasMRT=!1,t.drawBuffers=()=>{}),i||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,e,i=0){let{gl:s}=this;if(t){let o=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,s.bindFramebuffer(s.FRAMEBUFFER,o.framebuffer)),o.mipLevel!==i&&(t.dirtyId++,t.dirtyFormat++,o.mipLevel=i),o.dirtyId!==t.dirtyId&&(o.dirtyId=t.dirtyId,o.dirtyFormat!==t.dirtyFormat?(o.dirtyFormat=t.dirtyFormat,o.dirtySize=t.dirtySize,this.updateFramebuffer(t,i)):o.dirtySize!==t.dirtySize&&(o.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let n=0;n<t.colorTextures.length;n++){let a=t.colorTextures[n];this.renderer.texture.unbind(a.parentTextureArray||a)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){let n=e.width>>i,a=e.height>>i,l=n/e.width;this.setViewport(e.x*l,e.y*l,n,a)}else{let n=t.width>>i,a=t.height>>i;this.setViewport(0,0,n,a)}}else this.current&&(this.current=null,s.bindFramebuffer(s.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,e,i,s){let o=this.viewport;t=Math.round(t),e=Math.round(e),i=Math.round(i),s=Math.round(s),(o.width!==i||o.height!==s||o.x!==t||o.y!==e)&&(o.x=t,o.y=e,o.width=i,o.height=s,this.gl.viewport(t,e,i,s))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,e,i,s,o=ia.COLOR|ia.DEPTH){let{gl:n}=this;n.clearColor(t,e,i,s),n.clear(o)}initFramebuffer(t){let{gl:e}=this,i=new Yo(e.createFramebuffer());return i.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=i,this.managedFramebuffers.push(t),t.disposeRunner.add(this),i}resizeFramebuffer(t){let{gl:e}=this,i=t.glFramebuffers[this.CONTEXT_UID];if(i.stencil){e.bindRenderbuffer(e.RENDERBUFFER,i.stencil);let n;this.renderer.context.webGLVersion===1?n=e.DEPTH_STENCIL:t.depth&&t.stencil?n=e.DEPTH24_STENCIL8:t.depth?n=e.DEPTH_COMPONENT24:n=e.STENCIL_INDEX8,i.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,n,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,n,t.width,t.height)}let s=t.colorTextures,o=s.length;e.drawBuffers||(o=Math.min(o,1));for(let n=0;n<o;n++){let a=s[n],l=a.parentTextureArray||a;this.renderer.texture.bind(l,0),n===0&&i.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,i.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,l._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,e){let{gl:i}=this,s=t.glFramebuffers[this.CONTEXT_UID],o=t.colorTextures,n=o.length;i.drawBuffers||(n=Math.min(n,1)),s.multisample>1&&this.canMultisampleFramebuffer(t)?s.msaaBuffer=s.msaaBuffer||i.createRenderbuffer():s.msaaBuffer&&(i.deleteRenderbuffer(s.msaaBuffer),s.msaaBuffer=null,s.blitFramebuffer&&(s.blitFramebuffer.dispose(),s.blitFramebuffer=null));let a=[];for(let l=0;l<n;l++){let h=o[l],c=h.parentTextureArray||h;this.renderer.texture.bind(c,0),l===0&&s.msaaBuffer?(i.bindRenderbuffer(i.RENDERBUFFER,s.msaaBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,s.multisample,c._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,s.msaaBuffer)):(i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+l,h.target,c._glTextures[this.CONTEXT_UID].texture,e),a.push(i.COLOR_ATTACHMENT0+l))}if(a.length>1&&i.drawBuffers(a),t.depthTexture&&this.writeDepthTexture){let l=t.depthTexture;this.renderer.texture.bind(l,0),i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,l._glTextures[this.CONTEXT_UID].texture,e)}if((t.stencil||t.depth)&&!(t.depthTexture&&this.writeDepthTexture)){s.stencil=s.stencil||i.createRenderbuffer();let l,h;this.renderer.context.webGLVersion===1?(l=i.DEPTH_STENCIL_ATTACHMENT,h=i.DEPTH_STENCIL):t.depth&&t.stencil?(l=i.DEPTH_STENCIL_ATTACHMENT,h=i.DEPTH24_STENCIL8):t.depth?(l=i.DEPTH_ATTACHMENT,h=i.DEPTH_COMPONENT24):(l=i.STENCIL_ATTACHMENT,h=i.STENCIL_INDEX8),i.bindRenderbuffer(i.RENDERBUFFER,s.stencil),s.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,s.multisample,h,t.width,t.height):i.renderbufferStorage(i.RENDERBUFFER,h,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,l,i.RENDERBUFFER,s.stencil)}else s.stencil&&(i.deleteRenderbuffer(s.stencil),s.stencil=null)}canMultisampleFramebuffer(t){return this.renderer.context.webGLVersion!==1&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){let{msaaSamples:e}=this,i=ft.NONE;if(t<=1||e===null)return i;for(let s=0;s<e.length;s++)if(e[s]<=t){i=e[s];break}return i===1&&(i=ft.NONE),i}blit(t,e,i){let{current:s,renderer:o,gl:n,CONTEXT_UID:a}=this;if(o.context.webGLVersion!==2||!s)return;let l=s.glFramebuffers[a];if(!l)return;if(!t){if(!l.msaaBuffer)return;let c=s.colorTextures[0];if(!c)return;l.blitFramebuffer||(l.blitFramebuffer=new qr(s.width,s.height),l.blitFramebuffer.addColorTexture(0,c)),t=l.blitFramebuffer,t.colorTextures[0]!==c&&(t.colorTextures[0]=c,t.dirtyId++,t.dirtyFormat++),(t.width!==s.width||t.height!==s.height)&&(t.width=s.width,t.height=s.height,t.dirtyId++,t.dirtySize++)}e||(e=fb,e.width=s.width,e.height=s.height),i||(i=e);let h=e.width===i.width&&e.height===i.height;this.bind(t),n.bindFramebuffer(n.READ_FRAMEBUFFER,l.framebuffer),n.blitFramebuffer(e.left,e.top,e.right,e.bottom,i.left,i.top,i.right,i.bottom,n.COLOR_BUFFER_BIT,h?n.NEAREST:n.LINEAR),n.bindFramebuffer(n.READ_FRAMEBUFFER,t.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(t,e){let i=t.glFramebuffers[this.CONTEXT_UID],s=this.gl;if(!i)return;delete t.glFramebuffers[this.CONTEXT_UID];let o=this.managedFramebuffers.indexOf(t);o>=0&&this.managedFramebuffers.splice(o,1),t.disposeRunner.remove(this),e||(s.deleteFramebuffer(i.framebuffer),i.msaaBuffer&&s.deleteRenderbuffer(i.msaaBuffer),i.stencil&&s.deleteRenderbuffer(i.stencil)),i.blitFramebuffer&&this.disposeFramebuffer(i.blitFramebuffer,e)}disposeAll(t){let e=this.managedFramebuffers;this.managedFramebuffers=[];for(let i=0;i<e.length;i++)this.disposeFramebuffer(e[i],t)}forceStencil(){let t=this.current;if(!t)return;let e=t.glFramebuffers[this.CONTEXT_UID];if(!e||e.stencil&&t.stencil)return;t.stencil=!0;let i=t.width,s=t.height,o=this.gl,n=e.stencil=o.createRenderbuffer();o.bindRenderbuffer(o.RENDERBUFFER,n);let a,l;this.renderer.context.webGLVersion===1?(a=o.DEPTH_STENCIL_ATTACHMENT,l=o.DEPTH_STENCIL):t.depth?(a=o.DEPTH_STENCIL_ATTACHMENT,l=o.DEPTH24_STENCIL8):(a=o.STENCIL_ATTACHMENT,l=o.STENCIL_INDEX8),e.msaaBuffer?o.renderbufferStorageMultisample(o.RENDERBUFFER,e.multisample,l,i,s):o.renderbufferStorage(o.RENDERBUFFER,l,i,s),o.framebufferRenderbuffer(o.FRAMEBUFFER,a,o.RENDERBUFFER,n)}reset(){this.current=this.unknownFramebuffer,this.viewport=new Y}destroy(){this.renderer=null}};As.extension={type:T.RendererSystem,name:"framebuffer"};S.add(As);var Nc={5126:4,5123:2,5121:1},Ps=class{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);let t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,e.webGLVersion!==2){let i=this.renderer.context.extensions.vertexArrayObject;C.PREFER_ENV===Se.WEBGL_LEGACY&&(i=null),i?(t.createVertexArray=()=>i.createVertexArrayOES(),t.bindVertexArray=s=>i.bindVertexArrayOES(s),t.deleteVertexArray=s=>i.deleteVertexArrayOES(s)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(e.webGLVersion!==2){let i=t.getExtension("ANGLE_instanced_arrays");i?(t.vertexAttribDivisor=(s,o)=>i.vertexAttribDivisorANGLE(s,o),t.drawElementsInstanced=(s,o,n,a,l)=>i.drawElementsInstancedANGLE(s,o,n,a,l),t.drawArraysInstanced=(s,o,n,a)=>i.drawArraysInstancedANGLE(s,o,n,a)):this.hasInstance=!1}this.canUseUInt32ElementIndex=e.webGLVersion===2||!!e.extensions.uint32ElementIndex}bind(t,e){e=e||this.renderer.shader.shader;let{gl:i}=this,s=t.glVertexArrayObjects[this.CONTEXT_UID],o=!1;s||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=s={},o=!0);let n=s[e.program.id]||this.initGeometryVao(t,e,o);this._activeGeometry=t,this._activeVao!==n&&(this._activeVao=n,this.hasVao?i.bindVertexArray(n):this.activateVao(t,e.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){let t=this._activeGeometry,e=this.renderer.buffer;for(let i=0;i<t.buffers.length;i++){let s=t.buffers[i];e.update(s)}}checkCompatibility(t,e){let i=t.attributes,s=e.attributeData;for(let o in s)if(!i[o])throw new Error(`shader and geometry incompatible, geometry missing the "${o}" attribute`)}getSignature(t,e){let i=t.attributes,s=e.attributeData,o=["g",t.id];for(let n in i)s[n]&&o.push(n,s[n].location);return o.join("-")}initGeometryVao(t,e,i=!0){let s=this.gl,o=this.CONTEXT_UID,n=this.renderer.buffer,a=e.program;a.glPrograms[o]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,a);let l=this.getSignature(t,a),h=t.glVertexArrayObjects[this.CONTEXT_UID],c=h[l];if(c)return h[a.id]=c,c;let u=t.buffers,d=t.attributes,p={},f={};for(let m in u)p[m]=0,f[m]=0;for(let m in d)!d[m].size&&a.attributeData[m]?d[m].size=a.attributeData[m].size:d[m].size||console.warn(`PIXI Geometry attribute '${m}' size cannot be determined (likely the bound shader does not have the attribute)`),p[d[m].buffer]+=d[m].size*Nc[d[m].type];for(let m in d){let g=d[m],x=g.size;g.stride===void 0&&(p[g.buffer]===x*Nc[g.type]?g.stride=0:g.stride=p[g.buffer]),g.start===void 0&&(g.start=f[g.buffer],f[g.buffer]+=x*Nc[g.type])}c=s.createVertexArray(),s.bindVertexArray(c);for(let m=0;m<u.length;m++){let g=u[m];n.bind(g),i&&g._glBuffers[o].refCount++}return this.activateVao(t,a),h[a.id]=c,h[l]=c,s.bindVertexArray(null),n.unbind(ye.ARRAY_BUFFER),c}disposeGeometry(t,e){if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];let i=t.glVertexArrayObjects[this.CONTEXT_UID],s=this.gl,o=t.buffers,n=this.renderer?.buffer;if(t.disposeRunner.remove(this),!!i){if(n)for(let a=0;a<o.length;a++){let l=o[a]._glBuffers[this.CONTEXT_UID];l&&(l.refCount--,l.refCount===0&&!e&&n.dispose(o[a],e))}if(!e){for(let a in i)if(a[0]==="g"){let l=i[a];this._activeVao===l&&this.unbind(),s.deleteVertexArray(l)}}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){let e=Object.keys(this.managedGeometries);for(let i=0;i<e.length;i++)this.disposeGeometry(this.managedGeometries[e[i]],t)}activateVao(t,e){let i=this.gl,s=this.CONTEXT_UID,o=this.renderer.buffer,n=t.buffers,a=t.attributes;t.indexBuffer&&o.bind(t.indexBuffer);let l=null;for(let h in a){let c=a[h],u=n[c.buffer],d=u._glBuffers[s];if(e.attributeData[h]){l!==d&&(o.bind(u),l=d);let p=e.attributeData[h].location;if(i.enableVertexAttribArray(p),i.vertexAttribPointer(p,c.size,c.type||i.FLOAT,c.normalized,c.stride,c.start),c.instance)if(this.hasInstance)i.vertexAttribDivisor(p,c.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(t,e,i,s){let{gl:o}=this,n=this._activeGeometry;if(n.indexBuffer){let a=n.indexBuffer.data.BYTES_PER_ELEMENT,l=a===2?o.UNSIGNED_SHORT:o.UNSIGNED_INT;a===2||a===4&&this.canUseUInt32ElementIndex?n.instanced?o.drawElementsInstanced(t,e||n.indexBuffer.data.length,l,(i||0)*a,s||1):o.drawElements(t,e||n.indexBuffer.data.length,l,(i||0)*a):console.warn("unsupported index buffer type: uint32")}else n.instanced?o.drawArraysInstanced(t,i,e||n.getSize(),s||1):o.drawArrays(t,i,e||n.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}};Ps.extension={type:T.RendererSystem,name:"geometry"};S.add(Ps);var qm=new ot,Zr=class{constructor(t,e){this._texture=t,this.mapCoord=new ot,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof e>"u"?.5:e,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,e){e===void 0&&(e=t);let i=this.mapCoord;for(let s=0;s<t.length;s+=2){let o=t[s],n=t[s+1];e[s]=o*i.a+n*i.c+i.tx,e[s+1]=o*i.b+n*i.d+i.ty}return e}update(t){let e=this._texture;if(!e||!e.valid||!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;let i=e._uvs;this.mapCoord.set(i.x1-i.x0,i.y1-i.y0,i.x3-i.x0,i.y3-i.y0,i.x0,i.y0);let s=e.orig,o=e.trim;o&&(qm.set(s.width/o.width,0,0,s.height/o.height,-o.x/o.width,-o.y/o.height),this.mapCoord.append(qm));let n=e.baseTexture,a=this.uClampFrame,l=this.clampMargin/n.resolution,h=this.clampOffset;return a[0]=(e._frame.x+l+h)/n.width,a[1]=(e._frame.y+l+h)/n.height,a[2]=(e._frame.x+e._frame.width-l+h)/n.width,a[3]=(e._frame.y+e._frame.height-l+h)/n.height,this.uClampOffset[0]=h/n.realWidth,this.uClampOffset[1]=h/n.realHeight,this.isSimple=e._frame.width===n.width&&e._frame.height===n.height&&e.rotate===0,!0}};var Zm=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`;var Qm=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;var Ko=class extends z{constructor(t,e,i){let s=null;typeof t!="string"&&e===void 0&&i===void 0&&(s=t,t=void 0,e=void 0,i=void 0),super(t||Qm,e||Zm,i),this.maskSprite=s,this.maskMatrix=new ot}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,e,i,s){let o=this._maskSprite,n=o._texture;n.valid&&(n.uvMatrix||(n.uvMatrix=new Zr(n,0)),n.uvMatrix.update(),this.uniforms.npmAlpha=n.baseTexture.alphaMode?0:1,this.uniforms.mask=n,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,o).prepend(n.uvMatrix.mapCoord),this.uniforms.alpha=o.worldAlpha,this.uniforms.maskClamp=n.uvMatrix.uClampFrame,t.applyFilter(this,e,i,s))}};var qo=class{constructor(t=null){this.type=At.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=z.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=At.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}};var Is=class{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,e){let i=e;if(!i.isMaskData){let o=this.maskDataPool.pop()||new qo;o.pooled=!0,o.maskObject=e,i=o}let s=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(i.copyCountersOrReset(s),i._colorMask=s?s._colorMask:15,i.autoDetect&&this.detect(i),i._target=t,i.type!==At.SPRITE&&this.maskStack.push(i),i.enabled)switch(i.type){case At.SCISSOR:this.renderer.scissor.push(i);break;case At.STENCIL:this.renderer.stencil.push(i);break;case At.SPRITE:i.copyCountersOrReset(null),this.pushSpriteMask(i);break;case At.COLOR:this.pushColorMask(i);break;default:break}i.type===At.SPRITE&&this.maskStack.push(i)}pop(t){let e=this.maskStack.pop();if(!(!e||e._target!==t)){if(e.enabled)switch(e.type){case At.SCISSOR:this.renderer.scissor.pop(e);break;case At.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case At.SPRITE:this.popSpriteMask(e);break;case At.COLOR:this.popColorMask(e);break;default:break}if(e.reset(),e.pooled&&this.maskDataPool.push(e),this.maskStack.length!==0){let i=this.maskStack[this.maskStack.length-1];i.type===At.SPRITE&&i._filters&&(i._filters[0].maskSprite=i.maskObject)}}}detect(t){let e=t.maskObject;e?e.isSprite?t.type=At.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=At.SCISSOR:t.type=At.STENCIL:t.type=At.COLOR}pushSpriteMask(t){let{maskObject:e}=t,i=t._target,s=t._filters;s||(s=this.alphaMaskPool[this.alphaMaskIndex],s||(s=this.alphaMaskPool[this.alphaMaskIndex]=[new Ko])),s[0].resolution=t.resolution,s[0].multisample=t.multisample,s[0].maskSprite=e;let o=i.filterArea;i.filterArea=e.getBounds(!0),this.renderer.filter.push(i,s),i.filterArea=o,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){let e=t._colorMask,i=t._colorMask=e&t.colorMask;i!==e&&this.renderer.gl.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)}popColorMask(t){let e=t._colorMask,i=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;i!==e&&this.renderer.gl.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)}destroy(){this.renderer=null}};Is.extension={type:T.RendererSystem,name:"mask"};S.add(Is);var Ms=class{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){let{gl:e}=this.renderer,i=this.getStackLength();this.maskStack=t;let s=this.getStackLength();s!==i&&(s===0?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}};var Jm=new ot,tg=[],eg=class ja extends Ms{constructor(t){super(t),this.glConst=C.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){let t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0}calcScissorRect(t){if(t._scissorRectLocal)return;let e=t._scissorRect,{maskObject:i}=t,{renderer:s}=this,o=s.renderTexture,n=i.getBounds(!0,tg.pop()??new Y);this.roundFrameToPixels(n,o.current?o.current.resolution:s.resolution,o.sourceFrame,o.destinationFrame,s.projection.transform),e&&n.fit(e),t._scissorRectLocal=n}static isMatrixRotated(t){if(!t)return!1;let{a:e,b:i,c:s,d:o}=t;return(Math.abs(i)>1e-4||Math.abs(s)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(o)>1e-4)}testScissor(t){let{maskObject:e}=t;if(!e.isFastRect||!e.isFastRect()||ja.isMatrixRotated(e.worldTransform)||ja.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(t);let i=t._scissorRectLocal;return i.width>0&&i.height>0}roundFrameToPixels(t,e,i,s,o){ja.isMatrixRotated(o)||(o=o?Jm.copyFrom(o):Jm.identity(),o.translate(-i.x,-i.y).scale(s.width/i.width,s.height/i.height).translate(s.x,s.y),this.renderer.filter.transformAABB(o,t),t.fit(s),t.x=Math.round(t.x*e),t.y=Math.round(t.y*e),t.width=Math.round(t.width*e),t.height=Math.round(t.height*e))}push(t){t._scissorRectLocal||this.calcScissorRect(t);let{gl:e}=this.renderer;t._scissorRect||e.enable(e.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=t._scissorRectLocal,this._useCurrent()}pop(t){let{gl:e}=this.renderer;t&&tg.push(t._scissorRectLocal),this.getStackLength()>0?this._useCurrent():e.disable(e.SCISSOR_TEST)}_useCurrent(){let t=this.maskStack[this.maskStack.length-1]._scissorRect,e;this.renderer.renderTexture.current?e=t.y:e=this.renderer.height-t.height-t.y,this.renderer.gl.scissor(t.x,e,t.width,t.height)}};eg.extension={type:T.RendererSystem,name:"scissor"};var Uc=eg;S.add(Uc);var Rs=class extends Ms{constructor(t){super(t),this.glConst=C.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){let t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){let e=t.maskObject,{gl:i}=this.renderer,s=t._stencilCounter;s===0&&(this.renderer.framebuffer.forceStencil(),i.clearStencil(0),i.clear(i.STENCIL_BUFFER_BIT),i.enable(i.STENCIL_TEST)),t._stencilCounter++;let o=t._colorMask;o!==0&&(t._colorMask=0,i.colorMask(!1,!1,!1,!1)),i.stencilFunc(i.EQUAL,s,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,o!==0&&(t._colorMask=o,i.colorMask((o&1)!==0,(o&2)!==0,(o&4)!==0,(o&8)!==0)),this._useCurrent()}pop(t){let e=this.renderer.gl;if(this.getStackLength()===0)e.disable(e.STENCIL_TEST);else{let i=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,s=i?i._colorMask:15;s!==0&&(i._colorMask=0,e.colorMask(!1,!1,!1,!1)),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,s!==0&&(i._colorMask=s,e.colorMask((s&1)!==0,(s&2)!==0,(s&4)!==0,(s&8)!==0)),this._useCurrent()}}_useCurrent(){let t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}};Rs.extension={type:T.RendererSystem,name:"stencil"};S.add(Rs);var Fs=class{constructor(t){this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return et("7.0.0","renderer.plugins.extract has moved to renderer.extract"),t.extract}},prepare:{enumerable:!1,get(){return et("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),t.prepare}},interaction:{enumerable:!1,get(){return et("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),t.events}}})}init(){let t=this.rendererPlugins;for(let e in t)this.plugins[e]=new t[e](this.renderer)}destroy(){for(let t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}};Fs.extension={type:[T.RendererSystem,T.CanvasRendererSystem],name:"_plugin"};S.add(Fs);var Ds=class{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new ot,this.transform=null}update(t,e,i,s){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,i,s),this.transform&&this.projectionMatrix.append(this.transform);let o=this.renderer;o.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,o.globalUniforms.update(),o.shader.shader&&o.shader.syncUniformGroup(o.shader.shader.uniforms.globals)}calculateProjection(t,e,i,s){let o=this.projectionMatrix,n=s?-1:1;o.identity(),o.a=1/e.width*2,o.d=n*(1/e.height*2),o.tx=-1-e.x*o.a,o.ty=-n-e.y*o.d}setTransform(t){}destroy(){this.renderer=null}};Ds.extension={type:T.RendererSystem,name:"projection"};S.add(Ds);var mb=new Ci,rg=new Y,Bs=class{constructor(t){this.renderer=t,this._tempMatrix=new ot}generateTexture(t,e){let{region:i,...s}=e||{},o=i?.copyTo(rg)||t.getLocalBounds(rg,!0),n=s.resolution||this.renderer.resolution;o.width=Math.max(o.width,1/n),o.height=Math.max(o.height,1/n),s.width=o.width,s.height=o.height,s.resolution=n,s.multisample??(s.multisample=this.renderer.multisample);let a=Oe.create(s);this._tempMatrix.tx=-o.x,this._tempMatrix.ty=-o.y;let l=t.transform;return t.transform=mb,this.renderer.render(t,{renderTexture:a,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=l,a}destroy(){}};Bs.extension={type:[T.RendererSystem,T.CanvasRendererSystem],name:"textureGenerator"};S.add(Bs);var Ii=new Y,Zo=new Y,Ls=class{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Y,this.destinationFrame=new Y,this.viewportFrame=new Y}contextChange(){let t=this.renderer?.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}bind(t=null,e,i){let s=this.renderer;this.current=t;let o,n,a;t?(o=t.baseTexture,a=o.resolution,e||(Ii.width=t.frame.width,Ii.height=t.frame.height,e=Ii),i||(Zo.x=t.frame.x,Zo.y=t.frame.y,Zo.width=e.width,Zo.height=e.height,i=Zo),n=o.framebuffer):(a=s.resolution,e||(Ii.width=s._view.screen.width,Ii.height=s._view.screen.height,e=Ii),i||(i=Ii,i.width=e.width,i.height=e.height));let l=this.viewportFrame;l.x=i.x*a,l.y=i.y*a,l.width=i.width*a,l.height=i.height*a,t||(l.y=s.view.height-(l.y+l.height)),l.ceil(),this.renderer.framebuffer.bind(n,l),this.renderer.projection.update(i,e,a,!n),t?this.renderer.mask.setMaskStack(o.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(i)}clear(t,e){let i=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,s=tt.shared.setValue(t||i);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&s.premultiply(s.alpha);let o=this.destinationFrame,n=this.current?this.current.baseTexture:this.renderer._view.screen,a=o.width!==n.width||o.height!==n.height;if(a){let{x:l,y:h,width:c,height:u}=this.viewportFrame;l=Math.round(l),h=Math.round(h),c=Math.round(c),u=Math.round(u),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(l,h,c,u)}this.renderer.framebuffer.clear(s.red,s.green,s.blue,s.alpha,e),a&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}};Ls.extension={type:T.RendererSystem,name:"renderTexture"};S.add(Ls);var Qo=class{constructor(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}};function ig(r,t){let e={},i=t.getProgramParameter(r,t.ACTIVE_ATTRIBUTES);for(let s=0;s<i;s++){let o=t.getActiveAttrib(r,s);if(o.name.startsWith("gl_"))continue;let n=zo(t,o.type),a={type:n,name:o.name,size:Go(n),location:t.getAttribLocation(r,o.name)};e[o.name]=a}return e}function sg(r,t){let e={},i=t.getProgramParameter(r,t.ACTIVE_UNIFORMS);for(let s=0;s<i;s++){let o=t.getActiveUniform(r,s),n=o.name.replace(/\[.*?\]$/,""),a=!!o.name.match(/\[.*?\]$/),l=zo(t,o.type);e[n]={name:n,index:s,type:l,size:o.size,isArray:a,value:Uo(l,o.size)}}return e}function Gc(r,t){let e=Ba(r,r.VERTEX_SHADER,t.vertexSrc),i=Ba(r,r.FRAGMENT_SHADER,t.fragmentSrc),s=r.createProgram();r.attachShader(s,e),r.attachShader(s,i);let o=t.extra?.transformFeedbackVaryings;if(o&&(typeof r.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):r.transformFeedbackVaryings(s,o.names,o.bufferMode==="separate"?r.SEPARATE_ATTRIBS:r.INTERLEAVED_ATTRIBS)),r.linkProgram(s),r.getProgramParameter(s,r.LINK_STATUS)||Bc(r,s,e,i),t.attributeData=ig(s,r),t.uniformData=sg(s,r),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){let a=Object.keys(t.attributeData);a.sort((l,h)=>l>h?1:-1);for(let l=0;l<a.length;l++)t.attributeData[a[l]].location=l,r.bindAttribLocation(s,l,a[l]);r.linkProgram(s)}r.deleteShader(e),r.deleteShader(i);let n={};for(let a in t.uniformData){let l=t.uniformData[a];n[a]={location:r.getUniformLocation(s,a),value:Uo(l.type,l.size)}}return new Qo(s,n)}function gb(r,t,e,i,s){e.buffer.update(s)}var xb={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},og={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function ng(r){let t=r.map(o=>({data:o,offset:0,dataLen:0,dirty:0})),e=0,i=0,s=0;for(let o=0;o<t.length;o++){let n=t[o];if(e=og[n.data.type],n.data.size>1&&(e=Math.max(e,16)*n.data.size),n.dataLen=e,i%e!==0&&i<16){let a=i%e%16;i+=a,s+=a}i+e>16?(s=Math.ceil(s/16)*16,n.offset=s,s+=e,i=e):(n.offset=s,i+=e,s+=e)}return s=Math.ceil(s/16)*16,{uboElements:t,size:s}}function ag(r,t){let e=[];for(let i in r)t[i]&&e.push(t[i]);return e.sort((i,s)=>i.index-s.index),e}function zc(r,t){if(!r.autoManage)return{size:0,syncFunc:gb};let e=ag(r.uniforms,t),{uboElements:i,size:s}=ng(e),o=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let n=0;n<i.length;n++){let a=i[n],l=r.uniforms[a.data.name],h=a.data.name,c=!1;for(let u=0;u<lr.length;u++){let d=lr[u];if(d.codeUbo&&d.test(a.data,l)){o.push(`offset = ${a.offset/4};`,lr[u].codeUbo(a.data.name,l)),c=!0;break}}if(!c)if(a.data.size>1){let u=Go(a.data.type),d=Math.max(og[a.data.type]/16,1),p=u/d,f=(4-p%4)%4;o.push(`
                cv = ud.${h}.value;
                v = uv.${h};
                offset = ${a.offset/4};

                t = 0;

                for(var i=0; i < ${a.data.size*d}; i++)
                {
                    for(var j = 0; j < ${p}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${f};
                }

                `)}else{let u=xb[a.data.type];o.push(`
                cv = ud.${h}.value;
                v = uv.${h};
                offset = ${a.offset/4};
                ${u};
                `)}}return o.push(`
       renderer.buffer.update(buffer);
    `),{size:s,syncFunc:new Function("ud","uv","renderer","syncData","buffer",o.join(`
`))}}var yb=0,Wa={textureCount:0,uboCount:0},Os=class{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=yb++}systemCheck(){if(!Ga())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;let i=t.program,s=i.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==i&&(this.program=i,this.gl.useProgram(s.program)),e||(Wa.textureCount=0,Wa.uboCount=0,this.syncUniformGroup(t.uniformGroup,Wa)),s}setUniforms(t){let e=this.shader.program,i=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(i.uniformData,t,this.renderer)}syncUniformGroup(t,e){let i=this.getGlProgram();(!t.static||t.dirtyId!==i.uniformDirtyGroups[t.id])&&(i.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,i,e))}syncUniforms(t,e,i){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,i)}createSyncGroups(t){let e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=Fc(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,e){let i=this.getGlProgram();if(!t.static||t.dirtyId!==0||!i.uniformGroups[t.id]){t.dirtyId=0;let s=i.uniformGroups[t.id]||this.createSyncBufferGroup(t,i,e);t.buffer.update(),s(i.uniformData,t.uniforms,this.renderer,Wa,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,i.uniformBufferBindings[e])}createSyncBufferGroup(t,e,i){let{gl:s}=this.renderer;this.renderer.buffer.bind(t.buffer);let o=this.gl.getUniformBlockIndex(e.program,i);e.uniformBufferBindings[i]=this.shader.uniformBindCount,s.uniformBlockBinding(e.program,o,this.shader.uniformBindCount),this.shader.uniformBindCount++;let n=this.getSignature(t,this.shader.program.uniformData,"ubo"),a=this._uboCache[n];if(a||(a=this._uboCache[n]=zc(t,this.shader.program.uniformData)),t.autoManage){let l=new Float32Array(a.size/4);t.buffer.update(l)}return e.uniformGroups[t.id]=a.syncFunc,e.uniformGroups[t.id]}getSignature(t,e,i){let s=t.uniforms,o=[`${i}-`];for(let n in s)o.push(n),e[n]&&o.push(e[n].type);return o.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){let e=this.gl,i=t.program,s=Gc(e,i);return i.glPrograms[this.renderer.CONTEXT_UID]=s,s}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}};Os.extension={type:T.RendererSystem,name:"shader"};S.add(Os);var Pr=class{constructor(t){this.renderer=t}run(t){let{renderer:e}=this;e.runners.init.emit(e.options),t.hello&&console.log(`PixiJS 7.3.2 - ${e.rendererLogId} - https://pixijs.com`),e.resize(e.screen.width,e.screen.height)}destroy(){}};Pr.defaultOptions={hello:!1},Pr.extension={type:[T.RendererSystem,T.CanvasRendererSystem],name:"startup"};S.add(Pr);function lg(r,t=[]){return t[q.NORMAL]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[q.ADD]=[r.ONE,r.ONE],t[q.MULTIPLY]=[r.DST_COLOR,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA],t[q.SCREEN]=[r.ONE,r.ONE_MINUS_SRC_COLOR,r.ONE,r.ONE_MINUS_SRC_ALPHA],t[q.OVERLAY]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[q.DARKEN]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[q.LIGHTEN]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[q.COLOR_DODGE]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[q.COLOR_BURN]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[q.HARD_LIGHT]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[q.SOFT_LIGHT]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[q.DIFFERENCE]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[q.EXCLUSION]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[q.HUE]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[q.SATURATION]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[q.COLOR]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[q.LUMINOSITY]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[q.NONE]=[0,0],t[q.NORMAL_NPM]=[r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA],t[q.ADD_NPM]=[r.SRC_ALPHA,r.ONE,r.ONE,r.ONE],t[q.SCREEN_NPM]=[r.SRC_ALPHA,r.ONE_MINUS_SRC_COLOR,r.ONE,r.ONE_MINUS_SRC_ALPHA],t[q.SRC_IN]=[r.DST_ALPHA,r.ZERO],t[q.SRC_OUT]=[r.ONE_MINUS_DST_ALPHA,r.ZERO],t[q.SRC_ATOP]=[r.DST_ALPHA,r.ONE_MINUS_SRC_ALPHA],t[q.DST_OVER]=[r.ONE_MINUS_DST_ALPHA,r.ONE],t[q.DST_IN]=[r.ZERO,r.SRC_ALPHA],t[q.DST_OUT]=[r.ZERO,r.ONE_MINUS_SRC_ALPHA],t[q.DST_ATOP]=[r.ONE_MINUS_DST_ALPHA,r.SRC_ALPHA],t[q.XOR]=[r.ONE_MINUS_DST_ALPHA,r.ONE_MINUS_SRC_ALPHA],t[q.SUBTRACT]=[r.ONE,r.ONE,r.ONE,r.ONE,r.FUNC_REVERSE_SUBTRACT,r.FUNC_ADD],t}var vb=0,_b=1,bb=2,Tb=3,wb=4,Cb=5,hg=class Hc{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=q.NONE,this._blendEq=!1,this.map=[],this.map[vb]=this.setBlend,this.map[_b]=this.setOffset,this.map[bb]=this.setCullFace,this.map[Tb]=this.setDepthTest,this.map[wb]=this.setFrontFace,this.map[Cb]=this.setDepthMask,this.checks=[],this.defaultState=new Gt,this.defaultState.blend=!0}contextChange(t){this.gl=t,this.blendModes=lg(t),this.set(this.defaultState),this.reset()}set(t){if(t=t||this.defaultState,this.stateId!==t.data){let e=this.stateId^t.data,i=0;for(;e;)e&1&&this.map[i].call(this,!!(t.data&1<<i)),e=e>>1,i++;this.stateId=t.data}for(let e=0;e<this.checks.length;e++)this.checks[e](this,t)}forceState(t){t=t||this.defaultState;for(let e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(let e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data}setBlend(t){this.updateCheck(Hc.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)}setOffset(t){this.updateCheck(Hc.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(t){this.gl.depthMask(t)}setCullFace(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])}setBlendMode(t){if(t===this.blendMode)return;this.blendMode=t;let e=this.blendModes[t],i=this.gl;e.length===2?i.blendFunc(e[0],e[1]):i.blendFuncSeparate(e[0],e[1],e[2],e[3]),e.length===6?(this._blendEq=!0,i.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD))}setPolygonOffset(t,e){this.gl.polygonOffset(t,e)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(t,e){let i=this.checks.indexOf(t);e&&i===-1?this.checks.push(t):!e&&i!==-1&&this.checks.splice(i,1)}static checkBlendMode(t,e){t.setBlendMode(e.blendMode)}static checkPolygonOffset(t,e){t.setPolygonOffset(1,e.polygonOffset)}destroy(){this.gl=null}};hg.extension={type:T.RendererSystem,name:"state"};var Vc=hg;S.add(Vc);var ks=class extends nr.default{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){this.addRunners(...t.runners);let e=(t.priority??[]).filter(s=>t.systems[s]),i=[...e,...Object.keys(t.systems).filter(s=>!e.includes(s))];for(let s of i)this.addSystem(t.systems[s],s)}addRunners(...t){t.forEach(e=>{this.runners[e]=new It(e)})}addSystem(t,e){let i=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=i,this._systemsHash[e]=i;for(let s in this.runners)this.runners[s].add(i);return this}emitWithCustomOptions(t,e){let i=Object.keys(this._systemsHash);t.items.forEach(s=>{let o=i.find(n=>this._systemsHash[n]===s);s[t.name](e[o])})}destroy(){Object.values(this.runners).forEach(t=>{t.destroy()}),this._systemsHash={}}};var Jo=class Xa{constructor(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=Xa.defaultMaxIdle,this.checkCountMax=Xa.defaultCheckCountMax,this.mode=Xa.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==sa.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){let t=this.renderer.texture,e=t.managedTextures,i=!1;for(let s=0;s<e.length;s++){let o=e[s];o.resource&&this.count-o.touched>this.maxIdle&&(t.destroyTexture(o,!0),e[s]=null,i=!0)}if(i){let s=0;for(let o=0;o<e.length;o++)e[o]!==null&&(e[s++]=e[o]);e.length=s}}unload(t){let e=this.renderer.texture,i=t._texture;i&&!i.framebuffer&&e.destroyTexture(i);for(let s=t.children.length-1;s>=0;s--)this.unload(t.children[s])}destroy(){this.renderer=null}};Jo.defaultMode=sa.AUTO,Jo.defaultMaxIdle=60*60,Jo.defaultCheckCountMax=60*10,Jo.extension={type:T.RendererSystem,name:"textureGC"};var hr=Jo;S.add(hr);var Mi=class{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=X.UNSIGNED_BYTE,this.internalFormat=R.RGBA,this.samplerType=0}};function cg(r){let t;return"WebGL2RenderingContext"in globalThis&&r instanceof globalThis.WebGL2RenderingContext?t={[r.RGB]:j.FLOAT,[r.RGBA]:j.FLOAT,[r.ALPHA]:j.FLOAT,[r.LUMINANCE]:j.FLOAT,[r.LUMINANCE_ALPHA]:j.FLOAT,[r.R8]:j.FLOAT,[r.R8_SNORM]:j.FLOAT,[r.RG8]:j.FLOAT,[r.RG8_SNORM]:j.FLOAT,[r.RGB8]:j.FLOAT,[r.RGB8_SNORM]:j.FLOAT,[r.RGB565]:j.FLOAT,[r.RGBA4]:j.FLOAT,[r.RGB5_A1]:j.FLOAT,[r.RGBA8]:j.FLOAT,[r.RGBA8_SNORM]:j.FLOAT,[r.RGB10_A2]:j.FLOAT,[r.RGB10_A2UI]:j.FLOAT,[r.SRGB8]:j.FLOAT,[r.SRGB8_ALPHA8]:j.FLOAT,[r.R16F]:j.FLOAT,[r.RG16F]:j.FLOAT,[r.RGB16F]:j.FLOAT,[r.RGBA16F]:j.FLOAT,[r.R32F]:j.FLOAT,[r.RG32F]:j.FLOAT,[r.RGB32F]:j.FLOAT,[r.RGBA32F]:j.FLOAT,[r.R11F_G11F_B10F]:j.FLOAT,[r.RGB9_E5]:j.FLOAT,[r.R8I]:j.INT,[r.R8UI]:j.UINT,[r.R16I]:j.INT,[r.R16UI]:j.UINT,[r.R32I]:j.INT,[r.R32UI]:j.UINT,[r.RG8I]:j.INT,[r.RG8UI]:j.UINT,[r.RG16I]:j.INT,[r.RG16UI]:j.UINT,[r.RG32I]:j.INT,[r.RG32UI]:j.UINT,[r.RGB8I]:j.INT,[r.RGB8UI]:j.UINT,[r.RGB16I]:j.INT,[r.RGB16UI]:j.UINT,[r.RGB32I]:j.INT,[r.RGB32UI]:j.UINT,[r.RGBA8I]:j.INT,[r.RGBA8UI]:j.UINT,[r.RGBA16I]:j.INT,[r.RGBA16UI]:j.UINT,[r.RGBA32I]:j.INT,[r.RGBA32UI]:j.UINT,[r.DEPTH_COMPONENT16]:j.FLOAT,[r.DEPTH_COMPONENT24]:j.FLOAT,[r.DEPTH_COMPONENT32F]:j.FLOAT,[r.DEPTH_STENCIL]:j.FLOAT,[r.DEPTH24_STENCIL8]:j.FLOAT,[r.DEPTH32F_STENCIL8]:j.FLOAT}:t={[r.RGB]:j.FLOAT,[r.RGBA]:j.FLOAT,[r.ALPHA]:j.FLOAT,[r.LUMINANCE]:j.FLOAT,[r.LUMINANCE_ALPHA]:j.FLOAT,[r.DEPTH_STENCIL]:j.FLOAT},t}function ug(r){let t;return"WebGL2RenderingContext"in globalThis&&r instanceof globalThis.WebGL2RenderingContext?t={[X.UNSIGNED_BYTE]:{[R.RGBA]:r.RGBA8,[R.RGB]:r.RGB8,[R.RG]:r.RG8,[R.RED]:r.R8,[R.RGBA_INTEGER]:r.RGBA8UI,[R.RGB_INTEGER]:r.RGB8UI,[R.RG_INTEGER]:r.RG8UI,[R.RED_INTEGER]:r.R8UI,[R.ALPHA]:r.ALPHA,[R.LUMINANCE]:r.LUMINANCE,[R.LUMINANCE_ALPHA]:r.LUMINANCE_ALPHA},[X.BYTE]:{[R.RGBA]:r.RGBA8_SNORM,[R.RGB]:r.RGB8_SNORM,[R.RG]:r.RG8_SNORM,[R.RED]:r.R8_SNORM,[R.RGBA_INTEGER]:r.RGBA8I,[R.RGB_INTEGER]:r.RGB8I,[R.RG_INTEGER]:r.RG8I,[R.RED_INTEGER]:r.R8I},[X.UNSIGNED_SHORT]:{[R.RGBA_INTEGER]:r.RGBA16UI,[R.RGB_INTEGER]:r.RGB16UI,[R.RG_INTEGER]:r.RG16UI,[R.RED_INTEGER]:r.R16UI,[R.DEPTH_COMPONENT]:r.DEPTH_COMPONENT16},[X.SHORT]:{[R.RGBA_INTEGER]:r.RGBA16I,[R.RGB_INTEGER]:r.RGB16I,[R.RG_INTEGER]:r.RG16I,[R.RED_INTEGER]:r.R16I},[X.UNSIGNED_INT]:{[R.RGBA_INTEGER]:r.RGBA32UI,[R.RGB_INTEGER]:r.RGB32UI,[R.RG_INTEGER]:r.RG32UI,[R.RED_INTEGER]:r.R32UI,[R.DEPTH_COMPONENT]:r.DEPTH_COMPONENT24},[X.INT]:{[R.RGBA_INTEGER]:r.RGBA32I,[R.RGB_INTEGER]:r.RGB32I,[R.RG_INTEGER]:r.RG32I,[R.RED_INTEGER]:r.R32I},[X.FLOAT]:{[R.RGBA]:r.RGBA32F,[R.RGB]:r.RGB32F,[R.RG]:r.RG32F,[R.RED]:r.R32F,[R.DEPTH_COMPONENT]:r.DEPTH_COMPONENT32F},[X.HALF_FLOAT]:{[R.RGBA]:r.RGBA16F,[R.RGB]:r.RGB16F,[R.RG]:r.RG16F,[R.RED]:r.R16F},[X.UNSIGNED_SHORT_5_6_5]:{[R.RGB]:r.RGB565},[X.UNSIGNED_SHORT_4_4_4_4]:{[R.RGBA]:r.RGBA4},[X.UNSIGNED_SHORT_5_5_5_1]:{[R.RGBA]:r.RGB5_A1},[X.UNSIGNED_INT_2_10_10_10_REV]:{[R.RGBA]:r.RGB10_A2,[R.RGBA_INTEGER]:r.RGB10_A2UI},[X.UNSIGNED_INT_10F_11F_11F_REV]:{[R.RGB]:r.R11F_G11F_B10F},[X.UNSIGNED_INT_5_9_9_9_REV]:{[R.RGB]:r.RGB9_E5},[X.UNSIGNED_INT_24_8]:{[R.DEPTH_STENCIL]:r.DEPTH24_STENCIL8},[X.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[R.DEPTH_STENCIL]:r.DEPTH32F_STENCIL8}}:t={[X.UNSIGNED_BYTE]:{[R.RGBA]:r.RGBA,[R.RGB]:r.RGB,[R.ALPHA]:r.ALPHA,[R.LUMINANCE]:r.LUMINANCE,[R.LUMINANCE_ALPHA]:r.LUMINANCE_ALPHA},[X.UNSIGNED_SHORT_5_6_5]:{[R.RGB]:r.RGB},[X.UNSIGNED_SHORT_4_4_4_4]:{[R.RGBA]:r.RGBA},[X.UNSIGNED_SHORT_5_5_5_1]:{[R.RGBA]:r.RGBA}},t}var Ns=class{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new K,this.hasIntegerTextures=!1}contextChange(){let t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=ug(t),this.samplerTypes=cg(t);let e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(let s=0;s<e;s++)this.boundTextures[s]=null;this.emptyTextures={};let i=new Mi(t.createTexture());t.bindTexture(t.TEXTURE_2D,i.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=i,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new Mi(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let s=0;s<6;s++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let s=0;s<this.boundTextures.length;s++)this.bind(null,s)}bind(t,e=0){let{gl:i}=this;if(t=t?.castToBaseTexture(),t?.valid&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;let s=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(t.target,s.texture)),s.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),this.updateTexture(t)):s.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(i.TEXTURE_2D,this.emptyTextures[i.TEXTURE_2D].texture),this.boundTextures[e]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){let{gl:e,boundTextures:i}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let s=0;s<i.length;s++)i[s]===this.unknownTexture&&this.bind(null,s)}for(let s=0;s<i.length;s++)i[s]===t&&(this.currentLocation!==s&&(e.activeTexture(e.TEXTURE0+s),this.currentLocation=s),e.bindTexture(t.target,this.emptyTextures[t.target].texture),i[s]=null)}ensureSamplerType(t){let{boundTextures:e,hasIntegerTextures:i,CONTEXT_UID:s}=this;if(i)for(let o=t-1;o>=0;--o){let n=e[o];n&&n._glTextures[s].samplerType!==j.FLOAT&&this.renderer.texture.unbind(n)}}initTexture(t){let e=new Mi(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e}initTextureType(t,e){e.internalFormat=this.internalFormats[t.type]?.[t.format]??t.format,e.samplerType=this.samplerTypes[e.internalFormat]??j.FLOAT,this.webGLVersion===2&&t.type===X.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type}updateTexture(t){let e=t._glTextures[this.CONTEXT_UID];if(!e)return;let i=this.renderer;if(this.initTextureType(t,e),t.resource?.upload(i,t,e))e.samplerType!==j.FLOAT&&(this.hasIntegerTextures=!0);else{let s=t.realWidth,o=t.realHeight,n=i.gl;(e.width!==s||e.height!==o||e.dirtyId<0)&&(e.width=s,e.height=o,n.texImage2D(t.target,0,e.internalFormat,s,o,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}destroyTexture(t,e){let{gl:i}=this;if(t=t.castToBaseTexture(),t._glTextures[this.CONTEXT_UID]&&(this.unbind(t),i.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){let s=this.managedTextures.indexOf(t);s!==-1&&Aa(this.managedTextures,s,1)}}updateTextureStyle(t){let e=t._glTextures[this.CONTEXT_UID];e&&((t.mipmap===Lt.POW2||this.webGLVersion!==2)&&!t.isPowerOfTwo?e.mipmap=!1:e.mipmap=t.mipmap>=1,this.webGLVersion!==2&&!t.isPowerOfTwo?e.wrapMode=Ee.CLAMP:e.wrapMode=t.wrapMode,t.resource?.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)}setStyle(t,e){let i=this.gl;if(e.mipmap&&t.mipmap!==Lt.ON_MANUAL&&i.generateMipmap(t.target),i.texParameteri(t.target,i.TEXTURE_WRAP_S,e.wrapMode),i.texParameteri(t.target,i.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===Wt.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST);let s=this.renderer.context.extensions.anisotropicFiltering;if(s&&t.anisotropicLevel>0&&t.scaleMode===Wt.LINEAR){let o=Math.min(t.anisotropicLevel,i.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY_EXT));i.texParameterf(t.target,s.TEXTURE_MAX_ANISOTROPY_EXT,o)}}else i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===Wt.LINEAR?i.LINEAR:i.NEAREST);i.texParameteri(t.target,i.TEXTURE_MAG_FILTER,t.scaleMode===Wt.LINEAR?i.LINEAR:i.NEAREST)}destroy(){this.renderer=null}};Ns.extension={type:T.RendererSystem,name:"texture"};S.add(Ns);var Us=class{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){let{gl:e,CONTEXT_UID:i}=this,s=t._glTransformFeedbacks[i]||this.createGLTransformFeedback(t);e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,s)}unbind(){let{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,e){let{gl:i,renderer:s}=this;e&&s.shader.bind(e),i.beginTransformFeedback(t)}endTransformFeedback(){let{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){let{gl:e,renderer:i,CONTEXT_UID:s}=this,o=e.createTransformFeedback();t._glTransformFeedbacks[s]=o,e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,o);for(let n=0;n<t.buffers.length;n++){let a=t.buffers[n];a&&(i.buffer.update(a),a._glBuffers[s].refCount++,e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,n,a._glBuffers[s].buffer||null))}return e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),o}disposeTransformFeedback(t,e){let i=t._glTransformFeedbacks[this.CONTEXT_UID],s=this.gl;t.disposeRunner.remove(this);let o=this.renderer.buffer;if(o)for(let n=0;n<t.buffers.length;n++){let a=t.buffers[n];if(!a)continue;let l=a._glBuffers[this.CONTEXT_UID];l&&(l.refCount--,l.refCount===0&&!e&&o.dispose(a,e))}i&&(e||s.deleteTransformFeedback(i),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}};Us.extension={type:T.RendererSystem,name:"transformFeedback"};S.add(Us);var Ir=class{constructor(t){this.renderer=t}init(t){this.screen=new Y(0,0,t.width,t.height),this.element=t.view||C.ADAPTER.createCanvas(),this.resolution=t.resolution||C.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,e){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(e*this.resolution);let i=this.element.width/this.resolution,s=this.element.height/this.resolution;this.screen.width=i,this.screen.height=s,this.autoDensity&&(this.element.style.width=`${i}px`,this.element.style.height=`${s}px`),this.renderer.emit("resize",i,s),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){t&&this.element.parentNode?.removeChild(this.element),this.renderer=null,this.element=null,this.screen=null}};Ir.defaultOptions={width:800,height:600,resolution:void 0,autoDensity:!1},Ir.extension={type:[T.RendererSystem,T.CanvasRendererSystem],name:"_view"};S.add(Ir);C.PREFER_ENV=Se.WEBGL2;C.STRICT_TEXTURE_CACHE=!1;C.RENDER_OPTIONS={...Ar.defaultOptions,...Er.defaultOptions,...Ir.defaultOptions,...Pr.defaultOptions};Object.defineProperties(C,{WRAP_MODE:{get(){return K.defaultOptions.wrapMode},set(r){et("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),K.defaultOptions.wrapMode=r}},SCALE_MODE:{get(){return K.defaultOptions.scaleMode},set(r){et("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),K.defaultOptions.scaleMode=r}},MIPMAP_TEXTURES:{get(){return K.defaultOptions.mipmap},set(r){et("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),K.defaultOptions.mipmap=r}},ANISOTROPIC_LEVEL:{get(){return K.defaultOptions.anisotropicLevel},set(r){et("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),K.defaultOptions.anisotropicLevel=r}},FILTER_RESOLUTION:{get(){return et("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),z.defaultResolution},set(r){z.defaultResolution=r}},FILTER_MULTISAMPLE:{get(){return et("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),z.defaultMultisample},set(r){z.defaultMultisample=r}},SPRITE_MAX_TEXTURES:{get(){return Sr.defaultMaxTextures},set(r){et("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),Sr.defaultMaxTextures=r}},SPRITE_BATCH_SIZE:{get(){return Sr.defaultBatchSize},set(r){et("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),Sr.defaultBatchSize=r}},CAN_UPLOAD_SAME_BUFFER:{get(){return Sr.canUploadSameBuffer},set(r){et("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),Sr.canUploadSameBuffer=r}},GC_MODE:{get(){return hr.defaultMode},set(r){et("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),hr.defaultMode=r}},GC_MAX_IDLE:{get(){return hr.defaultMaxIdle},set(r){et("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),hr.defaultMaxIdle=r}},GC_MAX_CHECK_COUNT:{get(){return hr.defaultCheckCountMax},set(r){et("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),hr.defaultCheckCountMax=r}},PRECISION_VERTEX:{get(){return ie.defaultVertexPrecision},set(r){et("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),ie.defaultVertexPrecision=r}},PRECISION_FRAGMENT:{get(){return ie.defaultFragmentPrecision},set(r){et("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),ie.defaultFragmentPrecision=r}}});var ve=(r=>(r[r.INTERACTION=50]="INTERACTION",r[r.HIGH=25]="HIGH",r[r.NORMAL=0]="NORMAL",r[r.LOW=-25]="LOW",r[r.UTILITY=-50]="UTILITY",r))(ve||{});var Gs=class{constructor(t,e=null,i=0,s=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=i,this.once=s}match(t,e=null){return this.fn===t&&this.context===e}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));let e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);let e=this.next;return this.next=t?null:e,this.previous=null,e}};var dg=class Me{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new Gs(null,null,1/0),this.deltaMS=1/Me.targetFPMS,this.elapsedMS=1/Me.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,i=ve.NORMAL){return this._addListener(new Gs(t,e,i))}addOnce(t,e,i=ve.NORMAL){return this._addListener(new Gs(t,e,i,!0))}_addListener(t){let e=this._head.next,i=this._head;if(!e)t.connect(i);else{for(;e;){if(t.priority>e.priority){t.connect(i);break}i=e,e=e.next}t.previous||t.connect(i)}return this._startIfPossible(),this}remove(t,e){let i=this._head.next;for(;i;)i.match(t,e)?i=i.destroy():i=i.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){let o=t-this._lastFrame|0;if(o<this._minElapsedMS)return;this._lastFrame=t-o%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*Me.targetFPMS;let i=this._head,s=i.next;for(;s;)s=s.emit(this.deltaTime);i.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){let e=Math.min(this.maxFPS,t),i=Math.min(Math.max(0,e)/1e3,Me.targetFPMS);this._maxElapsedMS=1/i}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(t===0)this._minElapsedMS=0;else{let e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!Me._shared){let t=Me._shared=new Me;t.autoStart=!0,t._protected=!0}return Me._shared}static get system(){if(!Me._system){let t=Me._system=new Me;t.autoStart=!0,t._protected=!0}return Me._system}};dg.targetFPMS=.06;var ut=dg;Object.defineProperties(C,{TARGET_FPMS:{get(){return ut.targetFPMS},set(r){et("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),ut.targetFPMS=r}}});var tn=class{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,ve.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?ut.shared:new ut,t.autoStart&&this.start()}static destroy(){if(this._ticker){let t=this._ticker;this.ticker=null,t.destroy()}}};tn.extension=T.Application;S.add(tn);var pg=[];S.handleByList(T.Renderer,pg);function jc(r){for(let t of pg)if(t.test(r))return new t(r);throw new Error("Unable to auto-detect a suitable renderer.")}var fg=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`;var mg=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;var Wc=fg,en=mg;var rn=class{constructor(t){this.renderer=t}contextChange(t){let e;if(this.renderer.context.webGLVersion===1){let i=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,i)}else{let i=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,i)}e>=ft.HIGH?this.multisample=ft.HIGH:e>=ft.MEDIUM?this.multisample=ft.MEDIUM:e>=ft.LOW?this.multisample=ft.LOW:this.multisample=ft.NONE}destroy(){}};rn.extension={type:T.RendererSystem,name:"_multisample"};S.add(rn);var $a=class{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}};var sn=class{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){let{gl:e,CONTEXT_UID:i}=this,s=t._glBuffers[i]||this.createGLBuffer(t);e.bindBuffer(t.type,s.buffer)}unbind(t){let{gl:e}=this;e.bindBuffer(t,null)}bindBufferBase(t,e){let{gl:i,CONTEXT_UID:s}=this;if(this.boundBufferBases[e]!==t){let o=t._glBuffers[s]||this.createGLBuffer(t);this.boundBufferBases[e]=t,i.bindBufferBase(i.UNIFORM_BUFFER,e,o.buffer)}}bindBufferRange(t,e,i){let{gl:s,CONTEXT_UID:o}=this;i=i||0;let n=t._glBuffers[o]||this.createGLBuffer(t);s.bindBufferRange(s.UNIFORM_BUFFER,e||0,n.buffer,i*256,256)}update(t){let{gl:e,CONTEXT_UID:i}=this,s=t._glBuffers[i]||this.createGLBuffer(t);if(t._updateID!==s.updateID)if(s.updateID=t._updateID,e.bindBuffer(t.type,s.buffer),s.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{let o=t.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;s.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,o)}}dispose(t,e){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];let i=t._glBuffers[this.CONTEXT_UID],s=this.gl;t.disposeRunner.remove(this),i&&(e||s.deleteBuffer(i.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){let e=Object.keys(this.managedBuffers);for(let i=0;i<e.length;i++)this.dispose(this.managedBuffers[e[i]],t)}createGLBuffer(t){let{CONTEXT_UID:e,gl:i}=this;return t._glBuffers[e]=new $a(i.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e]}};sn.extension={type:T.RendererSystem,name:"buffer"};S.add(sn);var on=class{constructor(t){this.renderer=t}render(t,e){let i=this.renderer,s,o,n,a;if(e&&(s=e.renderTexture,o=e.clear,n=e.transform,a=e.skipUpdateTransform),this.renderingToScreen=!s,i.runners.prerender.emit(),i.emit("prerender"),i.projection.transform=n,!i.context.isLost){if(s||(this.lastObjectRendered=t),!a){let l=t.enableTempParent();t.updateTransform(),t.disableTempParent(l)}i.renderTexture.bind(s),i.batch.currentRenderer.start(),(o??i.background.clearBeforeRender)&&i.renderTexture.clear(),t.render(i),i.batch.currentRenderer.flush(),s&&(e.blit&&i.framebuffer.blit(),s.baseTexture.update()),i.runners.postrender.emit(),i.projection.transform=null,i.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}};on.extension={type:T.RendererSystem,name:"objectRenderer"};S.add(on);var Ya=class Xc extends ks{constructor(t){super(),this.type=Eh.WEBGL,t=Object.assign({},C.RENDER_OPTIONS,t),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new de({projectionMatrix:new ot},!0);let e={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:Xc.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(e),"useContextAlpha"in t&&(et("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),t.premultipliedAlpha=t.useContextAlpha&&t.useContextAlpha!=="notMultiplied",t.backgroundAlpha=t.useContextAlpha===!1?1:t.backgroundAlpha),this._plugin.rendererPlugins=Xc.__plugins,this.options=t,this.startup.run(this.options)}static test(t){return t?.forceCanvas?!1:wa()}render(t,e){this.objectRenderer.render(t,e)}resize(t,e){this._view.resizeView(t,e)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(t=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:t}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(t){this._view.resolution=t,this.runners.resolutionChange.emit(t)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return et("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return et("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return et("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return et("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(t){et("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=t}get backgroundAlpha(){return et("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(t){et("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=t}get powerPreference(){return et("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(t,e){return this.textureGenerator.generateTexture(t,e)}};Ya.extension={type:T.Renderer,priority:1},Ya.__plugins={},Ya.__systems={};var Ka=Ya;S.handleByMap(T.RendererPlugin,Ka.__plugins);S.handleByMap(T.RendererSystem,Ka.__systems);S.add(Ka);var Qr=class extends Pe{constructor(t,e){let{width:i,height:s}=e||{};super(i,s),this.items=[],this.itemDirtyIds=[];for(let o=0;o<t;o++){let n=new K;this.items.push(n),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,e){for(let i=0;i<this.length;i++)t[i]&&(t[i].castToBaseTexture?this.addBaseTextureAt(t[i].castToBaseTexture(),i):t[i]instanceof Pe?this.addResourceAt(t[i],i):this.addResourceAt(xs(t[i],e),i))}dispose(){for(let t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,e){if(!this.items[e])throw new Error(`Index ${e} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this}bind(t){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=t,this.items[e].on("update",t.update,t)}unbind(t){super.unbind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=null,this.items[e].off("update",t.update,t)}load(){if(this._load)return this._load;let t=this.items.map(e=>e.resource).filter(e=>e).map(e=>e.load());return this._load=Promise.all(t).then(()=>{let{realWidth:e,realHeight:i}=this.items[0];return this.resize(e,i),this.update(),Promise.resolve(this)}),this._load}};var nn=class extends Qr{constructor(t,e){let{width:i,height:s}=e||{},o,n;Array.isArray(t)?(o=t,n=t.length):n=t,super(n,{width:i,height:s}),o&&this.initFromArray(o,e)}addBaseTextureAt(t,e){if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(t){super.bind(t),t.target=br.TEXTURE_2D_ARRAY}upload(t,e,i){let{length:s,itemDirtyIds:o,items:n}=this,{gl:a}=t;i.dirtyId<0&&a.texImage3D(a.TEXTURE_2D_ARRAY,0,i.internalFormat,this._width,this._height,s,0,e.format,i.type,null);for(let l=0;l<s;l++){let h=n[l];o[l]<h.dirtyId&&(o[l]=h.dirtyId,h.valid&&a.texSubImage3D(a.TEXTURE_2D_ARRAY,0,0,0,l,h.resource.width,h.resource.height,1,e.format,i.type,h.resource.source))}return!0}};var an=class extends $t{constructor(t){super(t)}static test(t){let{OffscreenCanvas:e}=globalThis;return e&&t instanceof e?!0:globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}};var gg=class ln extends Qr{constructor(t,e){let{width:i,height:s,autoLoad:o,linkBaseTexture:n}=e||{};if(t&&t.length!==ln.SIDES)throw new Error(`Invalid length. Got ${t.length}, expected 6`);super(6,{width:i,height:s});for(let a=0;a<ln.SIDES;a++)this.items[a].target=br.TEXTURE_CUBE_MAP_POSITIVE_X+a;this.linkBaseTexture=n!==!1,t&&this.initFromArray(t,e),o!==!1&&this.load()}bind(t){super.bind(t),t.target=br.TEXTURE_CUBE_MAP}addBaseTextureAt(t,e,i){if(i===void 0&&(i=this.linkBaseTexture),!this.items[e])throw new Error(`Index ${e} is out of bounds`);if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0)if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("CubeResource does not support copying of renderTexture.");else t.target=br.TEXTURE_CUBE_MAP_POSITIVE_X+e,t.parentTextureArray=this.baseTexture,this.items[e]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[e]=t,this}upload(t,e,i){let s=this.itemDirtyIds;for(let o=0;o<ln.SIDES;o++){let n=this.items[o];(s[o]<n.dirtyId||i.dirtyId<e.dirtyId)&&(n.valid&&n.resource?(n.resource.upload(t,n,i),s[o]=n.dirtyId):s[o]<-1&&(t.gl.texImage2D(n.target,0,i.internalFormat,e.realWidth,e.realHeight,0,e.format,i.type,null),s[o]=-1))}return!0}static test(t){return Array.isArray(t)&&t.length===ln.SIDES}};gg.SIDES=6;var $c=gg;var hn=class r extends $t{constructor(t,e){e=e||{};let i,s,o;typeof t=="string"?(i=r.EMPTY,s=t,o=!0):(i=t,s=null,o=!1),super(i),this.url=s,this.crossOrigin=e.crossOrigin??!0,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this.ownsImageBitmap=e.ownsImageBitmap??o,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(t,e)=>{if(this.url===null){t(this);return}try{let i=await C.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;let s=await i.blob();if(this.destroyed)return;let o=await createImageBitmap(s,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===St.UNPACK?"premultiply":"none"});if(this.destroyed){o.close();return}this.source=o,this.update(),t(this)}catch(i){if(this.destroyed)return;e(i),this.onError.emit(i)}}),this._load)}upload(t,e,i){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),super.upload(t,e,i)):(this.load(),!1)}dispose(){this.ownsImageBitmap&&this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof t=="string"||t instanceof ImageBitmap)}static get EMPTY(){return r._EMPTY=r._EMPTY??C.ADAPTER.createCanvas(0,0),r._EMPTY}};var Yc=class qa extends $t{constructor(t,e){e=e||{},super(C.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=t,this.scale=e.scale||1,this._overrideWidth=e.width,this._overrideHeight=e.height,this._resolve=null,this._crossorigin=e.crossorigin,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(t=>{if(this._resolve=()=>{this.update(),t(this)},qa.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){let t=new Image;$t.crossOrigin(t,this.svg,this._crossorigin),t.src=this.svg,t.onerror=e=>{this._resolve&&(t.onerror=null,this.onError.emit(e))},t.onload=()=>{if(!this._resolve)return;let e=t.width,i=t.height;if(!e||!i)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let s=e*this.scale,o=i*this.scale;(this._overrideWidth||this._overrideHeight)&&(s=this._overrideWidth||this._overrideHeight/i*e,o=this._overrideHeight||this._overrideWidth/e*i),s=Math.round(s),o=Math.round(o);let n=this.source;n.width=s,n.height=o,n._pixiId=`canvas_${or()}`,n.getContext("2d").drawImage(t,0,0,e,i,0,0,s,o),this._resolve(),this._resolve=null}}static getSize(t){let e=qa.SVG_SIZE.exec(t),i={};return e&&(i[e[1]]=Math.round(parseFloat(e[3])),i[e[5]]=Math.round(parseFloat(e[7]))),i}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(t,e){return e==="svg"||typeof t=="string"&&t.startsWith("data:image/svg+xml")||typeof t=="string"&&qa.SVG_XML.test(t)}};Yc.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,Yc.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;var zs=Yc;var Kc=class qc extends $t{constructor(t,e){if(e=e||{},!(t instanceof HTMLVideoElement)){let i=document.createElement("video");e.autoLoad!==!1&&i.setAttribute("preload","auto"),e.playsinline!==!1&&(i.setAttribute("webkit-playsinline",""),i.setAttribute("playsinline","")),e.muted===!0&&(i.setAttribute("muted",""),i.muted=!0),e.loop===!0&&i.setAttribute("loop",""),e.autoPlay!==!1&&i.setAttribute("autoplay",""),typeof t=="string"&&(t=[t]);let s=t[0].src||t[0];$t.crossOrigin(i,s,e.crossorigin);for(let o=0;o<t.length;++o){let n=document.createElement("source"),{src:a,mime:l}=t[o];if(a=a||t[o],a.startsWith("data:"))l=a.slice(5,a.indexOf(";"));else if(!a.startsWith("blob:")){let h=a.split("?").shift().toLowerCase(),c=h.slice(h.lastIndexOf(".")+1);l=l||qc.MIME_TYPES[c]||`video/${c}`}n.src=a,l&&(n.type=l),i.appendChild(n)}t=i}super(t),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=e.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=e.autoPlay!==!1,this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),e.autoLoad!==!1&&this.load()}update(t=0){if(!this.destroyed){if(this._updateFPS){let e=ut.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-e)}(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}_videoFrameRequestCallback(){this.update(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback)}load(){if(this._load)return this._load;let t=this.source;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart),t.addEventListener("pause",this._onPlayStop),t.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._onCanPlay():(t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("error",this._onError,!0)),this._load=new Promise((e,i)=>{this.valid?e(this):(this._resolve=e,this._reject=i,t.load())}),this._load}_onError(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t),this._reject&&(this._reject(t),this._reject=null,this._resolve=null)}_isSourcePlaying(){let t=this.source;return!t.paused&&!t.ended}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0)}_onCanPlay(){let t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);let e=this.valid;this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0,!e&&this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()}dispose(){this._configureAutoUpdate();let t=this.source;t&&(t.removeEventListener("play",this._onPlayStart),t.removeEventListener("pause",this._onPlayStop),t.removeEventListener("seeked",this._onSeeked),t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay),t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.source.requestVideoFrameCallback?(this._isConnectedToTicker&&(ut.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(ut.shared.add(this.update,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(ut.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(t,e){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement||qc.TYPES.includes(e)}};Kc.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],Kc.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};var cn=Kc;No.push(hn,Ei,an,cn,zs,Xe,$c,nn);var cr=class{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?Y.EMPTY:(t=t||new Y(0,0,1,1),t.x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,e){let{a:i,b:s,c:o,d:n,tx:a,ty:l}=t,h=i*e.x+o*e.y+a,c=s*e.x+n*e.y+l;this.minX=Math.min(this.minX,h),this.maxX=Math.max(this.maxX,h),this.minY=Math.min(this.minY,c),this.maxY=Math.max(this.maxY,c)}addQuad(t){let e=this.minX,i=this.minY,s=this.maxX,o=this.maxY,n=t[0],a=t[1];e=n<e?n:e,i=a<i?a:i,s=n>s?n:s,o=a>o?a:o,n=t[2],a=t[3],e=n<e?n:e,i=a<i?a:i,s=n>s?n:s,o=a>o?a:o,n=t[4],a=t[5],e=n<e?n:e,i=a<i?a:i,s=n>s?n:s,o=a>o?a:o,n=t[6],a=t[7],e=n<e?n:e,i=a<i?a:i,s=n>s?n:s,o=a>o?a:o,this.minX=e,this.minY=i,this.maxX=s,this.maxY=o}addFrame(t,e,i,s,o){this.addFrameMatrix(t.worldTransform,e,i,s,o)}addFrameMatrix(t,e,i,s,o){let n=t.a,a=t.b,l=t.c,h=t.d,c=t.tx,u=t.ty,d=this.minX,p=this.minY,f=this.maxX,m=this.maxY,g=n*e+l*i+c,x=a*e+h*i+u;d=g<d?g:d,p=x<p?x:p,f=g>f?g:f,m=x>m?x:m,g=n*s+l*i+c,x=a*s+h*i+u,d=g<d?g:d,p=x<p?x:p,f=g>f?g:f,m=x>m?x:m,g=n*e+l*o+c,x=a*e+h*o+u,d=g<d?g:d,p=x<p?x:p,f=g>f?g:f,m=x>m?x:m,g=n*s+l*o+c,x=a*s+h*o+u,d=g<d?g:d,p=x<p?x:p,f=g>f?g:f,m=x>m?x:m,this.minX=d,this.minY=p,this.maxX=f,this.maxY=m}addVertexData(t,e,i){let s=this.minX,o=this.minY,n=this.maxX,a=this.maxY;for(let l=e;l<i;l+=2){let h=t[l],c=t[l+1];s=h<s?h:s,o=c<o?c:o,n=h>n?h:n,a=c>a?c:a}this.minX=s,this.minY=o,this.maxX=n,this.maxY=a}addVertices(t,e,i,s){this.addVerticesMatrix(t.worldTransform,e,i,s)}addVerticesMatrix(t,e,i,s,o=0,n=o){let a=t.a,l=t.b,h=t.c,c=t.d,u=t.tx,d=t.ty,p=this.minX,f=this.minY,m=this.maxX,g=this.maxY;for(let x=i;x<s;x+=2){let b=e[x],y=e[x+1],_=a*b+h*y+u,L=c*y+l*b+d;p=Math.min(p,_-o),m=Math.max(m,_+o),f=Math.min(f,L-n),g=Math.max(g,L+n)}this.minX=p,this.minY=f,this.maxX=m,this.maxY=g}addBounds(t){let e=this.minX,i=this.minY,s=this.maxX,o=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<i?t.minY:i,this.maxX=t.maxX>s?t.maxX:s,this.maxY=t.maxY>o?t.maxY:o}addBoundsMask(t,e){let i=t.minX>e.minX?t.minX:e.minX,s=t.minY>e.minY?t.minY:e.minY,o=t.maxX<e.maxX?t.maxX:e.maxX,n=t.maxY<e.maxY?t.maxY:e.maxY;if(i<=o&&s<=n){let a=this.minX,l=this.minY,h=this.maxX,c=this.maxY;this.minX=i<a?i:a,this.minY=s<l?s:l,this.maxX=o>h?o:h,this.maxY=n>c?n:c}}addBoundsMatrix(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,e){let i=t.minX>e.x?t.minX:e.x,s=t.minY>e.y?t.minY:e.y,o=t.maxX<e.x+e.width?t.maxX:e.x+e.width,n=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(i<=o&&s<=n){let a=this.minX,l=this.minY,h=this.maxX,c=this.maxY;this.minX=i<a?i:a,this.minY=s<l?s:l,this.maxX=o>h?o:h,this.maxY=n>c?n:c}}pad(t=0,e=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)}addFramePad(t,e,i,s,o,n){t-=o,e-=n,i+=o,s+=n,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>i?this.maxX:i,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>s?this.maxY:s}};var pt=class r extends w.EventEmitter{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new Ci,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new cr,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){let e=Object.keys(t);for(let i=0;i<e.length;++i){let s=e[i];Object.defineProperty(r.prototype,s,Object.getOwnPropertyDescriptor(t,s))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new Y),e=this._boundsRect),this._bounds.getRectangle(e)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new Y),t=this._localBoundsRect),this._localBounds||(this._localBounds=new cr);let e=this.transform,i=this.parent;this.parent=null,this._tempDisplayObjectParent.worldAlpha=i?.worldAlpha??1,this.transform=this._tempDisplayObjectParent.transform;let s=this._bounds,o=this._boundsID;this._bounds=this._localBounds;let n=this.getBounds(!1,t);return this.parent=i,this.transform=e,this._bounds=s,this._bounds.updateID+=this._boundsID-o,n}toGlobal(t,e,i=!1){return i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)}toLocal(t,e,i,s){return e&&(t=e.toGlobal(t,i,s)),s||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,i)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){this.parent?.removeChild(this)}setTransform(t=0,e=0,i=1,s=1,o=0,n=0,a=0,l=0,h=0){return this.position.x=t,this.position.y=e,this.scale.x=i||1,this.scale.y=s||1,this.rotation=o,this.skew.x=n,this.skew.y=a,this.pivot.x=l,this.pivot.y=h,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new Za),this.tempDisplayObjectParent}enableTempParent(){let t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*Pc}set angle(t){this.transform.rotation=t*$e}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){let e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount--,e._maskRefCount===0&&(e.renderable=!0,e.isMask=!1))}if(this._mask=t,this._mask){let e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount===0&&(e.renderable=!1,e.isMask=!0),e._maskRefCount++)}}}},Za=class extends pt{constructor(){super(...arguments),this.sortDirty=null}};pt.prototype.displayObjectUpdateTransform=pt.prototype.updateTransform;var Sb=new ot;function Eb(r,t){return r.zIndex===t.zIndex?r._lastSortedIndex-t._lastSortedIndex:r.zIndex-t.zIndex}var xg=class Zc extends pt{constructor(){super(),this.children=[],this.sortableChildren=Zc.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(t){}addChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.addChild(t[e]);else{let e=t[0];e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.push(e),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this)}return t[0]}addChildAt(t,e){if(e<0||e>this.children.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${this.children.length}`);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t}swapChildren(t,e){if(t===e)return;let i=this.getChildIndex(t),s=this.getChildIndex(e);this.children[i]=e,this.children[s]=t,this.onChildrenChange(i<s?i:s)}getChildIndex(t){let e=this.children.indexOf(t);if(e===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return e}setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);let i=this.getChildIndex(t);w.removeItems(this.children,i,1),this.children.splice(e,0,t),this.onChildrenChange(e)}getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]}removeChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.removeChild(t[e]);else{let e=t[0],i=this.children.indexOf(e);if(i===-1)return null;e.parent=null,e.transform._parentID=-1,w.removeItems(this.children,i,1),this._boundsID++,this.onChildrenChange(i),e.emit("removed",this),this.emit("childRemoved",e,this,i)}return t[0]}removeChildAt(t){let e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,w.removeItems(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e}removeChildren(t=0,e=this.children.length){let i=t,s=e,o=s-i,n;if(o>0&&o<=s){n=this.children.splice(i,o);for(let a=0;a<n.length;++a)n[a].parent=null,n[a].transform&&(n[a].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(let a=0;a<n.length;++a)n[a].emit("removed",this),this.emit("childRemoved",n[a],this,a);return n}else if(o===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let t=!1;for(let e=0,i=this.children.length;e<i;++e){let s=this.children[e];s._lastSortedIndex=e,!t&&s.zIndex!==0&&(t=!0)}t&&this.children.length>1&&this.children.sort(Eb),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let t=0,e=this.children.length;t<e;++t){let i=this.children[t];i.visible&&i.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let t=0;t<this.children.length;t++){let e=this.children[t];if(!(!e.visible||!e.renderable))if(e.calculateBounds(),e._mask){let i=e._mask.isMaskData?e._mask.maskObject:e._mask;i?(i.calculateBounds(),this._bounds.addBoundsMask(e._bounds,i._bounds)):this._bounds.addBounds(e._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(t,e=!1){let i=super.getLocalBounds(t);if(!e)for(let s=0,o=this.children.length;s<o;++s){let n=this.children[s];n.visible&&n.updateTransform()}return i}_calculateBounds(){}_renderWithCulling(t){let e=t.renderTexture.sourceFrame;if(!(e.width>0&&e.height>0))return;let i,s;this.cullArea?(i=this.cullArea,s=this.worldTransform):this._render!==Zc.prototype._render&&(i=this.getBounds(!0));let o=t.projection.transform;if(o&&(s?(s=Sb.copyFrom(s),s.prepend(o)):s=o),i&&e.intersects(i,s))this._render(t);else if(this.cullArea)return;for(let n=0,a=this.children.length;n<a;++n){let l=this.children[n],h=l.cullable;l.cullable=h||!this.cullArea,l.render(t),l.cullable=h}}render(t){if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||this.filters?.length)this.renderAdvanced(t);else if(this.cullable)this._renderWithCulling(t);else{this._render(t);for(let e=0,i=this.children.length;e<i;++e)this.children[e].render(t)}}renderAdvanced(t){let e=this.filters,i=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let o=0;o<e.length;o++)e[o].enabled&&this._enabledFilters.push(e[o])}let s=e&&this._enabledFilters?.length||i&&(!i.isMaskData||i.enabled&&(i.autoDetect||i.type!==At.NONE));if(s&&t.batch.flush(),e&&this._enabledFilters?.length&&t.filter.push(this,this._enabledFilters),i&&t.mask.push(this,this._mask),this.cullable)this._renderWithCulling(t);else{this._render(t);for(let o=0,n=this.children.length;o<n;++o)this.children[o].render(t)}s&&t.batch.flush(),i&&t.mask.pop(this),e&&this._enabledFilters?.length&&t.filter.pop()}_render(t){}destroy(t){super.destroy(),this.sortDirty=!1;let e=typeof t=="boolean"?t:t?.children,i=this.removeChildren(0,this.children.length);if(e)for(let s=0;s<i.length;++s)i[s].destroy(t)}get width(){return this.scale.x*this.getLocalBounds().width}set width(t){let e=this.getLocalBounds().width;e!==0?this.scale.x=t/e:this.scale.x=1,this._width=t}get height(){return this.scale.y*this.getLocalBounds().height}set height(t){let e=this.getLocalBounds().height;e!==0?this.scale.y=t/e:this.scale.y=1,this._height=t}};xg.defaultSortableChildren=!1;var D=xg;D.prototype.containerUpdateTransform=D.prototype.updateTransform;Object.defineProperties(C,{SORTABLE_CHILDREN:{get(){return D.defaultSortableChildren},set(r){w.deprecation("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),D.defaultSortableChildren=r}}});var yg=class Qc{constructor(t){this.stage=new D,t=Object.assign({forceCanvas:!1},t),this.renderer=jc(t),Qc._plugins.forEach(e=>{e.init.call(this,t)})}render(){this.renderer.render(this.stage)}get view(){return this.renderer?.view}get screen(){return this.renderer?.screen}destroy(t,e){let i=Qc._plugins.slice(0);i.reverse(),i.forEach(s=>{s.destroy.call(this)}),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null}};yg._plugins=[];var Qa=yg;S.handleByList(T.Application,Qa._plugins);var un=class{static init(t){Object.defineProperty(this,"resizeTo",{set(e){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=e,e&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let e,i;if(this._resizeTo===globalThis.window)e=globalThis.innerWidth,i=globalThis.innerHeight;else{let{clientWidth:s,clientHeight:o}=this._resizeTo;e=s,i=o}this.renderer.resize(e,i),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}};un.extension=T.Application;S.add(un);var dn;typeof self>"u"&&typeof process<"u"&&process.hrtime?dn=function(){let r=process.hrtime();return r[0]*1e3+r[1]/1e6}:typeof self<"u"&&self.performance!==void 0&&self.performance.now!==void 0?dn=self.performance.now.bind(self.performance):Date.now!==void 0?dn=Date.now:dn=function(){return new Date().getTime()};var Ri=class r{constructor(){r.prototype.__init.call(this),r.prototype.__init2.call(this),r.prototype.__init3.call(this),r.prototype.__init4.call(this)}__init(){this._tweens={}}static get shared(){return r._shared||(r._shared=new r),r._shared}__init2(){this._paused=!1}isPaused(){return this._paused}pause(){this._paused=!0}resume(){this._paused=!1}__init3(){this._lastUpdateTime=void 0}__init4(){this.now=dn}getAll(){return Object.keys(this._tweens).map(t=>this._tweens[t])}removeAll(){this._tweens={}}add(t){this._tweens[t.getId()]=t}remove(t){delete this._tweens[t.getId()]}update(t,e=!1){if(t==null&&(this._lastUpdateTime==null?(this._lastUpdateTime=this.now(),t=0):t=this.now()-this._lastUpdateTime),this._lastUpdateTime=this.now(),this._paused)return!1;let i=Object.keys(this._tweens);if(i.length==0)return!1;for(let s=0;s<i.length;s++){let o=this._tweens[i[s]];o&&o.update(t,!0)==!1&&!e&&delete this._tweens[i[s]]}return!0}},at={Step:{None(r){return r<.5?0:1}},Linear:{None(r){return r}},Quadratic:{In(r){return r*r},Out(r){return r*(2-r)},InOut(r){return(r*=2)<1?.5*r*r:-.5*(--r*(r-2)-1)}},Cubic:{In(r){return r*r*r},Out(r){return--r*r*r+1},InOut(r){return(r*=2)<1?.5*r*r*r:.5*((r-=2)*r*r+2)}},Quartic:{In(r){return r*r*r*r},Out(r){return 1- --r*r*r*r},InOut(r){return(r*=2)<1?.5*r*r*r*r:-.5*((r-=2)*r*r*r-2)}},Quintic:{In(r){return r*r*r*r*r},Out(r){return--r*r*r*r*r+1},InOut(r){return(r*=2)<1?.5*r*r*r*r*r:.5*((r-=2)*r*r*r*r+2)}},Sinusoidal:{In(r){return 1-Math.cos(r*Math.PI/2)},Out(r){return Math.sin(r*Math.PI/2)},InOut(r){return .5*(1-Math.cos(Math.PI*r))}},Exponential:{In(r){return r==0?0:Math.pow(1024,r-1)},Out(r){return r==1?1:1-Math.pow(2,-10*r)},InOut(r){return r==0?0:r==1?1:(r*=2)<1?.5*Math.pow(1024,r-1):.5*(-Math.pow(2,-10*(r-1))+2)}},Circular:{In(r){return 1-Math.sqrt(1-r*r)},Out(r){return Math.sqrt(1- --r*r)},InOut(r){return(r*=2)<1?-.5*(Math.sqrt(1-r*r)-1):.5*(Math.sqrt(1-(r-=2)*r)+1)}},Elastic:{In(r){return r==0?0:r==1?1:-Math.pow(2,10*(r-1))*Math.sin((r-1.1)*5*Math.PI)},Out(r){return r==0?0:r==1?1:Math.pow(2,-10*r)*Math.sin((r-.1)*5*Math.PI)+1},InOut(r){return r==0?0:r==1?1:(r*=2,r<1?-.5*Math.pow(2,10*(r-1))*Math.sin((r-1.1)*5*Math.PI):.5*Math.pow(2,-10*(r-1))*Math.sin((r-1.1)*5*Math.PI)+1)}},Back:{In(r){return r*r*((1.70158+1)*r-1.70158)},Out(r){return--r*r*((1.70158+1)*r+1.70158)+1},InOut(r){let t=2.5949095;return(r*=2)<1?.5*(r*r*((t+1)*r-t)):.5*((r-=2)*r*((t+1)*r+t)+2)}},Bounce:{In(r){return 1-at.Bounce.Out(1-r)},Out(r){return r<1/2.75?7.5625*r*r:r<2/2.75?7.5625*(r-=1.5/2.75)*r+.75:r<2.5/2.75?7.5625*(r-=2.25/2.75)*r+.9375:7.5625*(r-=2.625/2.75)*r+.984375},InOut(r){return r<.5?at.Bounce.In(r*2)*.5:at.Bounce.Out(r*2-1)*.5+.5}}},st={Geom:{Linear(r,t){let e=r.length-1,i=e*t,s=Math.floor(i),o=st.Utils.Linear;return t<0?o(r[0],r[1],i):t>1?o(r[e],r[e-1],e-i):o(r[s],r[s+1>e?e:s+1],i-s)},Bezier(r,t){let e=0,i=r.length-1,s=Math.pow,o=st.Utils.Bernstein;for(let n=0;n<=i;n++)e+=o(i,n)*s(1-t,i-n)*s(t,n)*r[n];return e},QuadraticBezier(r,t){let e=0,i=r.length-1;if(t==1)return r[i];let s=Math.pow,o=st.Utils.Bernstein,n=i*t,a=Math.floor(n),l=(n-a)*.5+.5*(a%2),h=a-a%2,c=h+1,u=h+2;return e+=o(2,0)*s(1-l,2)*s(l,0)*r[h],e+=o(2,1)*s(1-l,1)*s(l,1)*r[c],e+=o(2,2)*s(1-l,0)*s(l,2)*r[u],e},CubicBezier(r,t){let e=0,i=r.length-1;if(t==1)return r[i];let s=Math.pow,o=st.Utils.Bernstein,n=i*t,a=Math.floor(n),l=(n-a)*(1/3)+1/3*(a%3),h=a-a%3,c=h+1,u=h+2,d=h+3;return e+=o(3,0)*s(1-l,3)*s(l,0)*r[h],e+=o(3,1)*s(1-l,2)*s(l,1)*r[c],e+=o(3,2)*s(1-l,1)*s(l,2)*r[u],e+=o(3,3)*s(1-l,0)*s(l,3)*r[d],e},CatmullRom(r,t){let e=r.length-1,i=e*t,s=Math.floor(i),o=st.Utils.CatmullRom;return r[0]==r[e]?(t<0&&(s=Math.floor(i=e*(1+t))),o(r[(s-1+e)%e],r[s],r[(s+1)%e],r[(s+2)%e],i-s)):t<0?r[0]-(o(r[0],r[0],r[1],r[1],-i)-r[0]):t>1?r[e]-(o(r[e],r[e],r[e-1],r[e-1],i-e)-r[e]):o(r[s?s-1:0],r[s],r[e<s+1?e:s+1],r[e<s+2?e:s+2],i-s)}},Angle:{Radians(r,t){let e=r.length-1,i=e*t,s=Math.floor(i),o=st.Utils.WrapLinear;return t<0?o(r[0],r[1],i,2*Math.PI):t>1?o(r[e],r[e-1],e-i,2*Math.PI):o(r[s],r[s+1>e?e:s+1],i-s,2*Math.PI)},Degrees(r,t){let e=r.length-1,i=e*t,s=Math.floor(i),o=st.Utils.WrapLinear;return t<0?o(r[0],r[1],i,360):t>1?o(r[e],r[e-1],e-i,360):o(r[s],r[s+1>e?e:s+1],i-s,360)}},Color:{RGB(r,t){let e=r.length-1,i=e*t,s=Math.floor(i),o=st.Utils.RGBLinear;return t<0?o(r[0],r[1],i):t>1?o(r[e],r[e-1],e-i):o(r[s],r[s+1>e?e:s+1],i-s)},HSV(r,t){let e=r.length-1,i=e*t,s=Math.floor(i),o=st.Utils.HSVLinear;return t<0?o(r[0],r[1],i):t>1?o(r[e],r[e-1],e-i):o(r[s],r[s+1>e?e:s+1],i-s)},HCL(r,t){let e=r.length-1,i=e*t,s=Math.floor(i),o=st.Utils.HCLLinear;return t<0?o(r[0],r[1],i):t>1?o(r[e],r[e-1],e-i):o(r[s],r[s+1>e?e:s+1],i-s)}},Utils:{RGBsplit(r){let t=r>>24&255,e=r>>16&255,i=r>>8&255,s=r&255;return{a:t,r:e,g:i,b:s}},HSVsplit(r){let t=st.Utils.RGBsplit(r);t.r/=255,t.g/=255,t.b/=255;let e=Math.max(t.r,t.g,t.b),i=Math.min(t.r,t.g,t.b),s,o=e,n=e-i,a=e==0?0:n/e;if(e==i)s=0;else{switch(e){case t.r:s=(t.g-t.b)/n+(t.g<t.b?6:0);break;case t.g:s=(t.b-t.r)/n+2;break;case t.b:s=(t.r-t.g)/n+4;break}s/=6}return{a:t.a,h:s,s:a,v:o}},HSVJoin(r){let t,e,i,s=Math.floor(r.h*6),o=r.h*6-s,n=r.v*(1-r.s),a=r.v*(1-o*r.s),l=r.v*(1-(1-o)*r.s);switch(s%6){case 0:t=r.v,e=l,i=n;break;case 1:t=a,e=r.v,i=n;break;case 2:t=n,e=r.v,i=l;break;case 3:t=n,e=a,i=r.v;break;case 4:t=l,e=n,i=r.v;break;case 5:t=r.v,e=n,i=a;break}return r.a<<24|t<<16|e<<8|i},HCLSplit(r){let i=.530454533953517,s=st.Utils.RGBsplit(r),o={a:s.a,h:0,c:0,l:0},n=0,a=Math.min(s.r,Math.min(s.g,s.b)),l=Math.max(s.r,Math.max(s.g,s.b)),h=3/100;return o.c=l-a,o.c!=0&&(n=Math.atan2(s.g-s.b,s.r-s.g)/Math.PI,h*=a/l),h=Math.exp(h),o.h=(n/2-Math.min(n%1,-n%1)/6)%1,o.c*=h,o.l=st.Utils.Linear(-a,l,h)/(i*2),o},HCLJoin(r){let i=.530454533953517,s={a:r.a,r:0,g:0,b:0};if(r.l!=0){let o=r.h,n=r.c,a=r.l*i,l=Math.exp((1-n/(2*a))*(3/100)),h=(2*a-n)/(2*l-1),c=n/l,u=(o+Math.min(2*o%1/4,-2*o%1/8))*Math.PI*2,d;o*=6,o<=.999?(d=Math.tan(u),s.r=1,s.g=d/(1+d)):o<=1.001?(s.r=1,s.g=1):o<=2?(d=Math.tan(u),s.r=(1+d)/d,s.g=1):o<=3?(d=Math.tan(u),s.g=1,s.b=1+d):o<=3.999?(d=Math.tan(u),s.g=1/(1+d),s.b=1):o<=4.001?(s.g=0,s.b=1):o<=5?(d=Math.tan(u),s.r=-1/d,s.b=1):(d=Math.tan(u),s.r=1,s.b=-d),s.r=s.r*c+h,s.g=s.g*c+h,s.b=s.b*c+h}return s.a<<24|s.r<<16|s.g<<8|s.b},WrapLinear(r,t,e,i){let s;return r=(r+i*Math.trunc(Math.abs(r/i)))%i,t=(t+i*Math.trunc(Math.abs(t/i)))%i,Math.abs(r-t)<=.5*i?s=st.Utils.Linear(r,t,e):(r<t?s=st.Utils.Linear(r+i,t,e):s=st.Utils.Linear(r,t+i,e),s=s%i),s},RGBLinear(r,t,e){let i=st.Utils.RGBsplit(r),s=st.Utils.RGBsplit(t),o=st.Utils.Linear(i.a,s.a,e),n=st.Utils.Linear(i.r,s.r,e),a=st.Utils.Linear(i.g,s.g,e),l=st.Utils.Linear(i.b,s.b,e);return o<<24|n<<16|a<<8|l},HSVLinear(r,t,e){let i=st.Utils.HSVsplit(r),s=st.Utils.HSVsplit(t),o;Math.abs(i.h-s.h)<=.5?o=st.Utils.Linear(i.h,s.h,e):(i.h<s.h?o=st.Utils.Linear(i.h+1,s.h,e):o=st.Utils.Linear(i.h,s.h+1,e),o=o%1);let n=st.Utils.Linear(i.s,s.s,e),a=st.Utils.Linear(i.v,s.v,e),l=st.Utils.Linear(i.a,s.a,e);return st.Utils.HSVJoin({a:l,h:o,s:n,v:a})},HCLLinear(r,t,e){let i=st.Utils.HCLSplit(r),s=st.Utils.HCLSplit(t),o;Math.abs(i.h-s.h)<=.5?o=st.Utils.Linear(i.h,s.h,e):(i.h<s.h?o=st.Utils.Linear(i.h+1,s.h,e):o=st.Utils.Linear(i.h,s.h+1,e),o=o%1);let n=st.Utils.Linear(i.c,s.c,e),a=st.Utils.Linear(i.l,s.l,e),l=st.Utils.Linear(i.a,s.a,e);return st.Utils.HSVJoin({a:l,h:o,s:n,v:a})},Linear(r,t,e){return(t-r)*e+r},Bernstein(r,t){let e=st.Utils.Factorial;return e(r)/e(t)/e(r-t)},Factorial:function(){let r=[1];return function(t){let e=1;if(r[t])return r[t];for(let i=t;i>1;i--)e*=i;return r[t]=e,e}}(),CatmullRom(r,t,e,i,s){let o=(e-r)*.5,n=(i-t)*.5,a=s*s,l=s*a;return(2*t-2*e+o+n)*l+(-3*t+3*e-2*o-n)*a+o*s+t}}},tl=class r{static __initStatic(){this._nextId=0}static nextId(){return r._nextId++}};tl.__initStatic();var Ja={safetyCheckFunction:r=>!0,easingFunction:at.Linear.None,yoyoEasingFunction:void 0,interpolationFunction:st.Geom.Linear},lt=class r{__init(){this._isPaused=!1}__init2(){this._valuesStart={}}__init3(){this._valuesEnd={}}__init4(){this._valuesStartRepeat={}}__init5(){this._duration=0}__init6(){this._repeatCount=0}__init7(){this._repeat=0}__init8(){this._yoyo=!1}__init9(){this._isPlaying=!1}get _reversed(){return this.yoyo&&this._repeatCount%2!==0}__init10(){this._delayTime=0}__init11(){this._startTime=0}__init12(){this._elapsedTime=0}__init13(){this._timescale=1}__init14(){this._safetyCheckFunction=Ja.safetyCheckFunction}__init15(){this._easingFunction=Ja.easingFunction}__init16(){this._yoyoEasingFunction=Ja.yoyoEasingFunction}__init17(){this._interpolationFunction=Ja.interpolationFunction}__init18(){this._chainedTweens=[]}__init19(){this._onStartCallbackFired=!1}__init20(){this._onAfterDelayCallbackFired=!1}__init21(){this._id=tl.nextId()}__init22(){this._isChainStopped=!1}get _group(){return this._groupRef?this._groupRef:Ri.shared}set _group(t){this._groupRef=t}constructor(t,e){r.prototype.__init.call(this),r.prototype.__init2.call(this),r.prototype.__init3.call(this),r.prototype.__init4.call(this),r.prototype.__init5.call(this),r.prototype.__init6.call(this),r.prototype.__init7.call(this),r.prototype.__init8.call(this),r.prototype.__init9.call(this),r.prototype.__init10.call(this),r.prototype.__init11.call(this),r.prototype.__init12.call(this),r.prototype.__init13.call(this),r.prototype.__init14.call(this),r.prototype.__init15.call(this),r.prototype.__init16.call(this),r.prototype.__init17.call(this),r.prototype.__init18.call(this),r.prototype.__init19.call(this),r.prototype.__init20.call(this),r.prototype.__init21.call(this),r.prototype.__init22.call(this),this._object=t,this._group=e}getId(){return this._id}getGroup(){return this._group}getTimescale(){return this._timescale}isPlaying(){return this._isPlaying}isPaused(){return this._isPaused}from(t){try{JSON.stringify(t)}catch{throw new Error("The object you provided to the from() method has a circular reference!")}return this._setupProperties(t,this._valuesStart,t,this._valuesStartRepeat,!0),this}to(t,e){try{this._valuesEnd=JSON.parse(JSON.stringify(t))}catch{return console.warn("The object you provided to the to() method has a circular reference!. It can't be cloned. Falling back to dynamic targeting"),this.dynamicTo(t,e)}return e!==void 0&&(this._duration=e),this}dynamicTo(t,e){return this._valuesEnd=t,e!==void 0&&(this._duration=e),this}duration(t){return this._duration=t,this}start(t){return this._isPlaying?this:(t!=null&&(this._delayTime=t),this._group.add(this),this._reversed&&(this._swapEndStartRepeatValues(this._valuesStartRepeat,this._valuesEnd),this._valuesStart=JSON.parse(JSON.stringify(this._valuesStartRepeat))),this._repeatCount=0,this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onAfterDelayCallbackFired=!1,this._isChainStopped=!1,this._startTime=-this._delayTime,this._elapsedTime=0,this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,!1),this)}restart(t){return this.reset(),this.start(t)}reset(){return this._isPlaying&&this.stop(),this._valuesStart={},this._valuesStartRepeat={},this}rewind(){this._isPlaying&&this.stop(),this._reversed&&this._swapEndStartRepeatValues(this._valuesStartRepeat,this._valuesEnd);let t=this._easingFunction(0);return this._updateProperties(this._object,this._valuesStart,this._valuesEnd,t),this}_setupProperties(t,e,i,s,o){for(let n in i){let a=t[n],l=Array.isArray(a),h=!Number.isNaN(Number(a)),c=l?"array":typeof a,u=c=="object",d=typeof i[n]=="object",p=!l&&Array.isArray(i[n]);c=="undefined"||c=="function"||i[n]==null||!l&&!h&&!u||((u||l||d)&&a&&!p?(typeof e[n]>"u"&&(e[n]=l?[]:{}),typeof s[n]>"u"&&(s[n]=l?[]:{}),this._setupProperties(a,e[n],i[n],s[n],o)):((typeof e[n]>"u"||o)&&(e[n]=a),(typeof s[n]>"u"||o)&&(p?s[n]=i[n].slice().reverse()[0]:s[n]=e[n]||0)))}}stop(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object,this),this):this}end(t=!1){let e=[];if(t||(e=this._chainedTweens,this._chainedTweens=[]),this.resume(),this.update(1/0),!t){this._chainedTweens=e;for(let i=0,s=this._chainedTweens.length;i<s;i++)this._chainedTweens[i].start()}return this}skip(t,e=!1){return this.resume(),this.update(t*this._duration-(e?this._elapsedTime:0)),this}pause(){return this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._group.remove(this),this)}resume(){return!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._group.add(this),this)}stopChainedTweens(){for(let t=0,e=this._chainedTweens.length;t<e;t++)this._chainedTweens[t].stop();return this}startChainedTweens(t=!1){t&&this.stop();for(let e=0,i=this._chainedTweens.length;e<i;e++)this._chainedTweens[e].start();return this}group(t){return this._group=t,this}delay(t){return this._delayTime=t,this}timescale(t){return this._timescale=t,this}repeat(t=1/0){return this._repeat=t,this}repeatDelay(t){return this._repeatDelayTime=t,this}yoyo(t=!0){return this._yoyo=t,this}easing(t){return this._easingFunction=t,this}safetyCheck(t){return this._safetyCheckFunction=t,this}yoyoEasing(t){return this._yoyoEasingFunction=t,this}interpolation(t){return this._interpolationFunction=t,this}chain(...t){return this._chainedTweens=t,this}onStart(t){return this._onStartCallback=t,this}onAfterDelay(t){return this._onAfterDelayCallback=t,this}onUpdate(t){return this._onUpdateCallback=t,this}onRepeat(t){return this._onRepeatCallback=t,this}onComplete(t){return this._onCompleteCallback=t,this}onStop(t){return this._onStopCallback=t,this}update(t,e=!1){let i=this._internalUpdate(t);return!i&&!e&&this._group.remove(this),i}_internalUpdate(t){if(!this._safetyCheckFunction(this._object)||this._isPaused)return!1;t*=this._timescale;let e;this._elapsedTime+=t;let i=this._duration,s=this._startTime+this._elapsedTime;if(s>i&&!this._isPlaying)return!1;this.isPlaying||this.start(),this._onStartCallbackFired==!1&&(this._onStartCallback&&this._onStartCallback(this._object,this),this._onStartCallbackFired=!0),this._onAfterDelayCallbackFired==!1&&s>=0&&(this._onAfterDelayCallback&&this._onAfterDelayCallback(this._object,this),this._onAfterDelayCallbackFired=!0),e=s/this._duration,this._duration==0&&(s>=0?e=1:e=0),e=Math.min(1,e),e=Math.max(0,e);let o=Number.isFinite(s)?s%this._duration:s;Number.isNaN(o)&&(o=0);let n=Math.floor(s/this._duration),a;if(this._reversed&&this._yoyoEasingFunction?a=this._yoyoEasingFunction(e):a=this._easingFunction(e),this._updateProperties(this._object,this._valuesStart,this._valuesEnd,a),this._onUpdateCallback&&(e!=1||this._repeat-this._repeatCount<=0)&&this._onUpdateCallback(this._object,e,this),e==1){if(this._repeat-this._repeatCount>0){let l=this._repeatCount;if(this._repeatCount=Math.min(this._repeat+1,this._repeatCount+n),this._onUpdateCallback&&(this._repeat-this._repeatCount<0||o<=0)&&this._onUpdateCallback(this._object,e,this),this._yoyo?this._swapEndStartRepeatValues(this._valuesStartRepeat,this._valuesEnd):this._moveForwardStartRepeatValues(this._valuesStartRepeat,this._valuesEnd),this._valuesStart=JSON.parse(JSON.stringify(this._valuesStartRepeat)),this._repeatDelayTime!==void 0?this._startTime=-this._repeatDelayTime:this._startTime=0,this._onRepeatCallback){let h=1;Number.isFinite(n)?h=this._repeatCount-l:Number.isFinite(this._repeat)&&(h=this._repeat-l);for(let c=0;c<h;c++)this._onRepeatCallback(this._object,l+1+c,this)}if(this._elapsedTime=0,this._repeat-this._repeatCount>=0)return o>0&&Number.isFinite(this._repeat)&&this._internalUpdate(o),!0}this._onCompleteCallback&&this._onCompleteCallback(this._object,this);for(let l=0,h=this._chainedTweens.length;l<h;l++)this._chainedTweens[l].start(),o>0&&this._chainedTweens[l].update(o);return this._isPlaying=!1,!1}return!0}_updateProperties(t,e,i,s){for(let o in i){if(e[o]==null)continue;let n=e[o],a=i[o],l=Array.isArray(t[o]),h=Array.isArray(a);!l&&h?this._reversed?t[o]=this._interpolationFunction(a.concat([n]),s):t[o]=this._interpolationFunction([n].concat(a),s):typeof a=="object"&&a?this._updateProperties(t[o],n,a,s):(a=this._handleRelativeValue(n,a),typeof a=="number"&&(typeof n=="number"||typeof n=="string")&&(t[o]=Number(n)+(a-Number(n))*s,typeof n=="string"&&(t[o]=String(t[o]))))}}_handleRelativeValue(t,e){return typeof e!="string"?e:e.charAt(0)=="+"||e.charAt(0)=="-"?t+Number(e):Number(e)}_swapEndStartRepeatValues(t,e){for(let i in t){let s=!Array.isArray(t[i])&&Array.isArray(e[i]);if(typeof t[i]=="object")this._swapEndStartRepeatValues(t[i],e[i]);else{let o=t[i];if(typeof e[i]=="string")t[i]=Number(t[i])+Number(e[i]),e[i]=o;else if(s){let n=e[i].slice().reverse();t[i]=n[0],e[i]=n}else t[i]=e[i],e[i]=o}}}_moveForwardStartRepeatValues(t,e){for(let i in t)typeof e[i]=="object"?this._moveForwardStartRepeatValues(t[i],e[i]):typeof e[i]=="string"&&(t[i]=Number(t[i])+Number(e[i]))}};var ct=new nr.default;var el=class{ysdk;constructor(t){this.ysdk=t}showInterstitial(){this.ysdk.adv.showFullscreenAdv({callbacks:{onOpen:()=>{ct.emit("AD_STARTED")},onClose:()=>{ct.emit("AD_FINISHED")},onError:()=>{},onOffline:()=>{}}})}showRewarded(t,e){this.ysdk.adv.showRewardedVideo({callbacks:{onOpen:()=>{ct.emit("AD_STARTED")},onClose:()=>{ct.emit("AD_FINISHED"),t()},onRewarded:e,onError:()=>{}}})}};var vg;function _g(r){return vg=r,r}function zt(){return vg}var Ab=0,Jc=class extends w.EventEmitter{constructor(r){super(),this.id=Ab++,this.init(r)}set(r,t){if(this[r]===void 0)throw new Error(`Property with name ${r} does not exist.`);switch(r){case"speed":this.speed=t;break;case"volume":this.volume=t;break;case"paused":this.paused=t;break;case"loop":this.loop=t;break;case"muted":this.muted=t;break}return this}get progress(){let{currentTime:r}=this._source;return r/this._duration}get paused(){return this._paused}set paused(r){this._paused=r,this.refreshPaused()}_onPlay(){this._playing=!0}_onPause(){this._playing=!1}init(r){this._playing=!1,this._duration=r.source.duration;let t=this._source=r.source.cloneNode(!1);t.src=r.parent.url,t.onplay=this._onPlay.bind(this),t.onpause=this._onPause.bind(this),r.context.on("refresh",this.refresh,this),r.context.on("refreshPaused",this.refreshPaused,this),this._media=r}_internalStop(){this._source&&this._playing&&(this._source.onended=null,this._source.pause())}stop(){this._internalStop(),this._source&&this.emit("stop")}get speed(){return this._speed}set speed(r){this._speed=r,this.refresh()}get volume(){return this._volume}set volume(r){this._volume=r,this.refresh()}get loop(){return this._loop}set loop(r){this._loop=r,this.refresh()}get muted(){return this._muted}set muted(r){this._muted=r,this.refresh()}get filters(){return console.warn("HTML Audio does not support filters"),null}set filters(r){console.warn("HTML Audio does not support filters")}refresh(){let r=this._media.context,t=this._media.parent;this._source.loop=this._loop||t.loop;let e=r.volume*(r.muted?0:1),i=t.volume*(t.muted?0:1),s=this._volume*(this._muted?0:1);this._source.volume=s*e*i,this._source.playbackRate=this._speed*r.speed*t.speed}refreshPaused(){let r=this._media.context,t=this._media.parent,e=this._paused||t.paused||r.paused;e!==this._pausedReal&&(this._pausedReal=e,e?(this._internalStop(),this.emit("paused")):(this.emit("resumed"),this.play({start:this._source.currentTime,end:this._end,volume:this._volume,speed:this._speed,loop:this._loop})),this.emit("pause",e))}play(r){let{start:t,end:e,speed:i,loop:s,volume:o,muted:n}=r;e&&console.assert(e>t,"End time is before start time"),this._speed=i,this._volume=o,this._loop=!!s,this._muted=n,this.refresh(),this.loop&&e!==null&&(console.warn('Looping not support when specifying an "end" time'),this.loop=!1),this._start=t,this._end=e||this._duration,this._start=Math.max(0,this._start-Jc.PADDING),this._end=Math.min(this._end+Jc.PADDING,this._duration),this._source.onloadedmetadata=()=>{this._source&&(this._source.currentTime=t,this._source.onloadedmetadata=null,this.emit("progress",t,this._duration),ut.shared.add(this._onUpdate,this))},this._source.onended=this._onComplete.bind(this),this._source.play(),this.emit("start")}_onUpdate(){this.emit("progress",this.progress,this._duration),this._source.currentTime>=this._end&&!this._source.loop&&this._onComplete()}_onComplete(){ut.shared.remove(this._onUpdate,this),this._internalStop(),this.emit("progress",1,this._duration),this.emit("end",this)}destroy(){ut.shared.remove(this._onUpdate,this),this.removeAllListeners();let r=this._source;r&&(r.onended=null,r.onplay=null,r.onpause=null,this._internalStop()),this._source=null,this._speed=1,this._volume=1,this._loop=!1,this._end=null,this._start=0,this._duration=0,this._playing=!1,this._pausedReal=!1,this._paused=!1,this._muted=!1,this._media&&(this._media.context.off("refresh",this.refresh,this),this._media.context.off("refreshPaused",this.refreshPaused,this),this._media=null)}toString(){return`[HTMLAudioInstance id=${this.id}]`}},rl=Jc;rl.PADDING=.1;var pn=class extends w.EventEmitter{init(t){this.parent=t,this._source=t.options.source||new Audio,t.url&&(this._source.src=t.url)}create(){return new rl(this)}get isPlayable(){return!!this._source&&this._source.readyState===4}get duration(){return this._source.duration}get context(){return this.parent.context}get filters(){return null}set filters(t){console.warn("HTML Audio does not support filters")}destroy(){this.removeAllListeners(),this.parent=null,this._source&&(this._source.src="",this._source.load(),this._source=null)}get source(){return this._source}load(t){let e=this._source,i=this.parent;if(e.readyState===4){i.isLoaded=!0;let l=i.autoPlayStart();t&&setTimeout(()=>{t(null,i,l)},0);return}if(!i.url){t(new Error("sound.url or sound.source must be set"));return}e.src=i.url;let s=()=>{a(),i.isLoaded=!0;let l=i.autoPlayStart();t&&t(null,i,l)},o=()=>{a(),t&&t(new Error("Sound loading has been aborted"))},n=()=>{a();let l=`Failed to load audio element (code: ${e.error.code})`;t?t(new Error(l)):console.error(l)},a=()=>{e.removeEventListener("canplaythrough",s),e.removeEventListener("load",s),e.removeEventListener("abort",o),e.removeEventListener("error",n)};e.addEventListener("canplaythrough",s,!1),e.addEventListener("load",s,!1),e.addEventListener("abort",o,!1),e.addEventListener("error",n,!1),e.load()}};var fn=class{constructor(t,e){this.parent=t,Object.assign(this,e),this.duration=this.end-this.start,console.assert(this.duration>0,"End time must be after start time")}play(t){return this.parent.play({complete:t,speed:this.speed||this.parent.speed,end:this.end,start:this.start,loop:this.loop})}destroy(){this.parent=null}};var Fi=["ogg","oga","opus","m4a","mp3","mpeg","wav","aiff","wma","mid","caf"],tu=["audio/mpeg","audio/ogg"],Di={};function bg(r){let t={m4a:"audio/mp4",oga:"audio/ogg",opus:'audio/ogg; codecs="opus"',caf:'audio/x-caf; codecs="opus"',...r||{}},e=document.createElement("audio"),i={},s=/^no$/;Fi.forEach(o=>{let n=e.canPlayType(`audio/${o}`).replace(s,""),a=t[o]?e.canPlayType(t[o]).replace(s,""):"";i[o]=!!n||!!a}),Object.assign(Di,i)}bg();var pe=class{static setParamValue(t,e){if(t.setValueAtTime){let i=zt().context;t.setValueAtTime(e,i.audioContext.currentTime)}else t.value=e;return e}};var Pb=0,mn=class extends w.EventEmitter{constructor(t){super(),this.id=Pb++,this._media=null,this._paused=!1,this._muted=!1,this._elapsed=0,this.init(t)}set(t,e){if(this[t]===void 0)throw new Error(`Property with name ${t} does not exist.`);switch(t){case"speed":this.speed=e;break;case"volume":this.volume=e;break;case"muted":this.muted=e;break;case"loop":this.loop=e;break;case"paused":this.paused=e;break}return this}stop(){this._source&&(this._internalStop(),this.emit("stop"))}get speed(){return this._speed}set speed(t){this._speed=t,this.refresh(),this._update(!0)}get volume(){return this._volume}set volume(t){this._volume=t,this.refresh()}get muted(){return this._muted}set muted(t){this._muted=t,this.refresh()}get loop(){return this._loop}set loop(t){this._loop=t,this.refresh()}get filters(){return this._filters}set filters(t){this._filters&&(this._filters?.filter(e=>e).forEach(e=>e.disconnect()),this._filters=null,this._source.connect(this._gain)),this._filters=t?.length?t.slice(0):null,this.refresh()}refresh(){if(!this._source)return;let t=this._media.context,e=this._media.parent;this._source.loop=this._loop||e.loop;let i=t.volume*(t.muted?0:1),s=e.volume*(e.muted?0:1),o=this._volume*(this._muted?0:1);pe.setParamValue(this._gain.gain,o*s*i),pe.setParamValue(this._source.playbackRate,this._speed*e.speed*t.speed),this.applyFilters()}applyFilters(){if(this._filters?.length){this._source.disconnect();let t=this._source;this._filters.forEach(e=>{t.connect(e.destination),t=e}),t.connect(this._gain)}}refreshPaused(){let t=this._media.context,e=this._media.parent,i=this._paused||e.paused||t.paused;i!==this._pausedReal&&(this._pausedReal=i,i?(this._internalStop(),this.emit("paused")):(this.emit("resumed"),this.play({start:this._elapsed%this._duration,end:this._end,speed:this._speed,loop:this._loop,volume:this._volume})),this.emit("pause",i))}play(t){let{start:e,end:i,speed:s,loop:o,volume:n,muted:a,filters:l}=t;i&&console.assert(i>e,"End time is before start time"),this._paused=!1;let{source:h,gain:c}=this._media.nodes.cloneBufferSource();this._source=h,this._gain=c,this._speed=s,this._volume=n,this._loop=!!o,this._muted=a,this._filters=l,this.refresh();let u=this._source.buffer.duration;this._duration=u,this._end=i,this._lastUpdate=this._now(),this._elapsed=e,this._source.onended=this._onComplete.bind(this),this._loop?(this._source.loopEnd=i,this._source.loopStart=e,this._source.start(0,e)):i?this._source.start(0,e,i-e):this._source.start(0,e),this.emit("start"),this._update(!0),this.enableTicker(!0)}enableTicker(t){ut.shared.remove(this._updateListener,this),t&&ut.shared.add(this._updateListener,this)}get progress(){return this._progress}get paused(){return this._paused}set paused(t){this._paused=t,this.refreshPaused()}destroy(){this.removeAllListeners(),this._internalStop(),this._gain&&(this._gain.disconnect(),this._gain=null),this._media&&(this._media.context.events.off("refresh",this.refresh,this),this._media.context.events.off("refreshPaused",this.refreshPaused,this),this._media=null),this._filters?.forEach(t=>t.disconnect()),this._filters=null,this._end=null,this._speed=1,this._volume=1,this._loop=!1,this._elapsed=0,this._duration=0,this._paused=!1,this._muted=!1,this._pausedReal=!1}toString(){return`[WebAudioInstance id=${this.id}]`}_now(){return this._media.context.audioContext.currentTime}_updateListener(){this._update()}_update(t=!1){if(this._source){let e=this._now(),i=e-this._lastUpdate;if(i>0||t){let s=this._source.playbackRate.value;this._elapsed+=i*s,this._lastUpdate=e;let o=this._duration,n;if(this._source.loopStart){let a=this._source.loopEnd-this._source.loopStart;n=(this._source.loopStart+this._elapsed%a)/o}else n=this._elapsed%o/o;this._progress=n,this.emit("progress",this._progress,o)}}}init(t){this._media=t,t.context.events.on("refresh",this.refresh,this),t.context.events.on("refreshPaused",this.refreshPaused,this)}_internalStop(){if(this._source){this.enableTicker(!1),this._source.onended=null,this._source.stop(0),this._source.disconnect();try{this._source.buffer=null}catch(t){console.warn("Failed to set AudioBufferSourceNode.buffer to null:",t)}this._source=null}}_onComplete(){if(this._source){this.enableTicker(!1),this._source.onended=null,this._source.disconnect();try{this._source.buffer=null}catch(t){console.warn("Failed to set AudioBufferSourceNode.buffer to null:",t)}}this._source=null,this._progress=1,this.emit("progress",1,this._duration),this.emit("end",this)}};var Bi=class{constructor(t,e){this._output=e,this._input=t}get destination(){return this._input}get filters(){return this._filters}set filters(t){if(this._filters&&(this._filters.forEach(e=>{e&&e.disconnect()}),this._filters=null,this._input.connect(this._output)),t&&t.length){this._filters=t.slice(0),this._input.disconnect();let e=null;t.forEach(i=>{e===null?this._input.connect(i.destination):e.connect(i.destination),e=i}),e.connect(this._output)}}destroy(){this.filters=null,this._input=null,this._output=null}};var Tg=class extends Bi{constructor(r){let t=r.audioContext,e=t.createBufferSource(),i=t.createGain(),s=t.createAnalyser();e.connect(s),s.connect(i),i.connect(r.destination),super(s,i),this.context=r,this.bufferSource=e,this.gain=i,this.analyser=s}get script(){return this._script||(this._script=this.context.audioContext.createScriptProcessor(Tg.BUFFER_SIZE),this._script.connect(this.context.destination)),this._script}destroy(){super.destroy(),this.bufferSource.disconnect(),this._script&&this._script.disconnect(),this.gain.disconnect(),this.analyser.disconnect(),this.bufferSource=null,this._script=null,this.gain=null,this.analyser=null,this.context=null}cloneBufferSource(){let r=this.bufferSource,t=this.context.audioContext.createBufferSource();t.buffer=r.buffer,pe.setParamValue(t.playbackRate,r.playbackRate.value),t.loop=r.loop;let e=this.context.audioContext.createGain();return t.connect(e),e.connect(this.destination),{source:t,gain:e}}get bufferSize(){return this.script.bufferSize}},il=Tg;il.BUFFER_SIZE=0;var Li=class{init(t){this.parent=t,this._nodes=new il(this.context),this._source=this._nodes.bufferSource,this.source=t.options.source}destroy(){this.parent=null,this._nodes.destroy(),this._nodes=null;try{this._source.buffer=null}catch(t){console.warn("Failed to set AudioBufferSourceNode.buffer to null:",t)}this._source=null,this.source=null}create(){return new mn(this)}get context(){return this.parent.context}get isPlayable(){return!!this._source&&!!this._source.buffer}get filters(){return this._nodes.filters}set filters(t){this._nodes.filters=t}get duration(){return console.assert(this.isPlayable,"Sound not yet playable, no duration"),this._source.buffer.duration}get buffer(){return this._source.buffer}set buffer(t){this._source.buffer=t}get nodes(){return this._nodes}load(t){this.source?this._decode(this.source,t):this.parent.url?this._loadUrl(t):t?t(new Error("sound.url or sound.source must be set")):console.error("sound.url or sound.source must be set")}async _loadUrl(t){let e=this.parent.url,i=await C.ADAPTER.fetch(e);this._decode(await i.arrayBuffer(),t)}_decode(t,e){let i=(s,o)=>{if(s)e&&e(s);else{this.parent.isLoaded=!0,this.buffer=o;let n=this.parent.autoPlayStart();e&&e(null,this.parent,n)}};t instanceof AudioBuffer?i(null,t):this.parent.context.decode(t,i)}};var Hs=class{static from(r){let t={};typeof r=="string"?t.url=r:r instanceof ArrayBuffer||r instanceof AudioBuffer||r instanceof HTMLAudioElement?t.source=r:Array.isArray(r)?t.url=r:t=r,t={autoPlay:!1,singleInstance:!1,url:null,source:null,preload:!1,volume:1,speed:1,complete:null,loaded:null,loop:!1,...t},Object.freeze(t);let e=zt().useLegacy?new pn:new Li;return new Hs(e,t)}constructor(r,t){this.media=r,this.options=t,this._instances=[],this._sprites={},this.media.init(this);let e=t.complete;this._autoPlayOptions=e?{complete:e}:null,this.isLoaded=!1,this._preloadQueue=null,this.isPlaying=!1,this.autoPlay=t.autoPlay,this.singleInstance=t.singleInstance,this.preload=t.preload||this.autoPlay,this.url=Array.isArray(t.url)?this.preferUrl(t.url):t.url,this.speed=t.speed,this.volume=t.volume,this.loop=t.loop,t.sprites&&this.addSprites(t.sprites),this.preload&&this._preload(t.loaded)}preferUrl(r){let[t]=r.map(e=>({url:e,ext:w.path.extname(e).slice(1)})).filter(({ext:e})=>Di[e]).sort((e,i)=>Fi.indexOf(e.ext)-Fi.indexOf(i.ext));if(!t)throw new Error("No supported file type found");return t.url}get context(){return zt().context}pause(){return this.isPlaying=!1,this.paused=!0,this}resume(){return this.isPlaying=this._instances.length>0,this.paused=!1,this}get paused(){return this._paused}set paused(r){this._paused=r,this.refreshPaused()}get speed(){return this._speed}set speed(r){this._speed=r,this.refresh()}get filters(){return this.media.filters}set filters(r){this.media.filters=r}addSprites(r,t){if(typeof r=="object"){let i={};for(let s in r)i[s]=this.addSprites(s,r[s]);return i}console.assert(!this._sprites[r],`Alias ${r} is already taken`);let e=new fn(this,t);return this._sprites[r]=e,e}destroy(){this._removeInstances(),this.removeSprites(),this.media.destroy(),this.media=null,this._sprites=null,this._instances=null}removeSprites(r){if(r){let t=this._sprites[r];t!==void 0&&(t.destroy(),delete this._sprites[r])}else for(let t in this._sprites)this.removeSprites(t);return this}get isPlayable(){return this.isLoaded&&this.media&&this.media.isPlayable}stop(){if(!this.isPlayable)return this.autoPlay=!1,this._autoPlayOptions=null,this;this.isPlaying=!1;for(let r=this._instances.length-1;r>=0;r--)this._instances[r].stop();return this}play(r,t){let e;if(typeof r=="string"?e={sprite:r,loop:this.loop,complete:t}:typeof r=="function"?(e={},e.complete=r):e=r,e={complete:null,loaded:null,sprite:null,end:null,start:0,volume:1,speed:1,muted:!1,loop:!1,...e||{}},e.sprite){let s=e.sprite;console.assert(!!this._sprites[s],`Alias ${s} is not available`);let o=this._sprites[s];e.start=o.start+(e.start||0),e.end=o.end,e.speed=o.speed||1,e.loop=o.loop||e.loop,delete e.sprite}if(e.offset&&(e.start=e.offset),!this.isLoaded)return this._preloadQueue?new Promise(s=>{this._preloadQueue.push(()=>{s(this.play(e))})}):(this._preloadQueue=[],this.autoPlay=!0,this._autoPlayOptions=e,new Promise((s,o)=>{this._preload((n,a,l)=>{this._preloadQueue.forEach(h=>h()),this._preloadQueue=null,n?o(n):(e.loaded&&e.loaded(n,a,l),s(l))})}));(this.singleInstance||e.singleInstance)&&this._removeInstances();let i=this._createInstance();return this._instances.push(i),this.isPlaying=!0,i.once("end",()=>{e.complete&&e.complete(this),this._onComplete(i)}),i.once("stop",()=>{this._onComplete(i)}),i.play(e),i}refresh(){let r=this._instances.length;for(let t=0;t<r;t++)this._instances[t].refresh()}refreshPaused(){let r=this._instances.length;for(let t=0;t<r;t++)this._instances[t].refreshPaused()}get volume(){return this._volume}set volume(r){this._volume=r,this.refresh()}get muted(){return this._muted}set muted(r){this._muted=r,this.refresh()}get loop(){return this._loop}set loop(r){this._loop=r,this.refresh()}_preload(r){this.media.load(r)}get instances(){return this._instances}get sprites(){return this._sprites}get duration(){return this.media.duration}autoPlayStart(){let r;return this.autoPlay&&(r=this.play(this._autoPlayOptions)),r}_removeInstances(){for(let r=this._instances.length-1;r>=0;r--)this._poolInstance(this._instances[r]);this._instances.length=0}_onComplete(r){if(this._instances){let t=this._instances.indexOf(r);t>-1&&this._instances.splice(t,1),this.isPlaying=this._instances.length>0}this._poolInstance(r)}_createInstance(){if(Hs._pool.length>0){let r=Hs._pool.pop();return r.init(this.media),r}return this.media.create()}_poolInstance(r){r.destroy(),Hs._pool.indexOf(r)<0&&Hs._pool.push(r)}},ke=Hs;ke._pool=[];var gn=class extends w.EventEmitter{constructor(){super(...arguments),this.speed=1,this.muted=!1,this.volume=1,this.paused=!1}refresh(){this.emit("refresh")}refreshPaused(){this.emit("refreshPaused")}get filters(){return console.warn("HTML Audio does not support filters"),null}set filters(t){console.warn("HTML Audio does not support filters")}get audioContext(){return console.warn("HTML Audio does not support audioContext"),null}toggleMute(){return this.muted=!this.muted,this.refresh(),this.muted}togglePause(){return this.paused=!this.paused,this.refreshPaused(),this.paused}destroy(){this.removeAllListeners()}};var Vs=class r extends Bi{constructor(){let t=window,e=new r.AudioContext,i=e.createDynamicsCompressor(),s=e.createAnalyser();s.connect(i),i.connect(e.destination),super(s,i),this.autoPause=!0,this._ctx=e,this._offlineCtx=new r.OfflineAudioContext(1,2,t.OfflineAudioContext?Math.max(8e3,Math.min(96e3,e.sampleRate)):44100),this.compressor=i,this.analyser=s,this.events=new w.EventEmitter,this.volume=1,this.speed=1,this.muted=!1,this.paused=!1,this._locked=e.state==="suspended"&&("ontouchstart"in globalThis||"onclick"in globalThis),this._locked&&(this._unlock(),this._unlock=this._unlock.bind(this),document.addEventListener("mousedown",this._unlock,!0),document.addEventListener("touchstart",this._unlock,!0),document.addEventListener("touchend",this._unlock,!0)),this.onFocus=this.onFocus.bind(this),this.onBlur=this.onBlur.bind(this),globalThis.addEventListener("focus",this.onFocus),globalThis.addEventListener("blur",this.onBlur)}onFocus(){if(!this.autoPause)return;let t=this._ctx.state;(t==="suspended"||t==="interrupted"||!this._locked)&&(this.paused=this._pausedOnBlur,this.refreshPaused())}onBlur(){this.autoPause&&(this._locked||(this._pausedOnBlur=this._paused,this.paused=!0,this.refreshPaused()))}_unlock(){this._locked&&(this.playEmptySound(),this._ctx.state==="running"&&(document.removeEventListener("mousedown",this._unlock,!0),document.removeEventListener("touchend",this._unlock,!0),document.removeEventListener("touchstart",this._unlock,!0),this._locked=!1))}playEmptySound(){let t=this._ctx.createBufferSource();t.buffer=this._ctx.createBuffer(1,1,22050),t.connect(this._ctx.destination),t.start(0,0,0),t.context.state==="suspended"&&t.context.resume()}static get AudioContext(){let t=window;return t.AudioContext||t.webkitAudioContext||null}static get OfflineAudioContext(){let t=window;return t.OfflineAudioContext||t.webkitOfflineAudioContext||null}destroy(){super.destroy();let t=this._ctx;typeof t.close<"u"&&t.close(),globalThis.removeEventListener("focus",this.onFocus),globalThis.removeEventListener("blur",this.onBlur),this.events.removeAllListeners(),this.analyser.disconnect(),this.compressor.disconnect(),this.analyser=null,this.compressor=null,this.events=null,this._offlineCtx=null,this._ctx=null}get audioContext(){return this._ctx}get offlineContext(){return this._offlineCtx}set paused(t){t&&this._ctx.state==="running"?this._ctx.suspend():!t&&this._ctx.state==="suspended"&&this._ctx.resume(),this._paused=t}get paused(){return this._paused}refresh(){this.events.emit("refresh")}refreshPaused(){this.events.emit("refreshPaused")}toggleMute(){return this.muted=!this.muted,this.refresh(),this.muted}togglePause(){return this.paused=!this.paused,this.refreshPaused(),this._paused}decode(t,e){let i=o=>{e(new Error(o?.message||"Unable to decode file"))},s=this._offlineCtx.decodeAudioData(t,o=>{e(null,o)},i);s&&s.catch(i)}};var sl=class{constructor(){this.init()}init(){return this.supported&&(this._webAudioContext=new Vs),this._htmlAudioContext=new gn,this._sounds={},this.useLegacy=!this.supported,this}get context(){return this._context}get filtersAll(){return this.useLegacy?[]:this._context.filters}set filtersAll(t){this.useLegacy||(this._context.filters=t)}get supported(){return Vs.AudioContext!==null}add(t,e){if(typeof t=="object"){let o={};for(let n in t){let a=this._getOptions(t[n],e);o[n]=this.add(n,a)}return o}if(console.assert(!this._sounds[t],`Sound with alias ${t} already exists.`),e instanceof ke)return this._sounds[t]=e,e;let i=this._getOptions(e),s=ke.from(i);return this._sounds[t]=s,s}_getOptions(t,e){let i;return typeof t=="string"?i={url:t}:Array.isArray(t)?i={url:t}:t instanceof ArrayBuffer||t instanceof AudioBuffer||t instanceof HTMLAudioElement?i={source:t}:i=t,i={...i,...e||{}},i}get useLegacy(){return this._useLegacy}set useLegacy(t){this._useLegacy=t,this._context=!t&&this.supported?this._webAudioContext:this._htmlAudioContext}get disableAutoPause(){return!this._webAudioContext.autoPause}set disableAutoPause(t){this._webAudioContext.autoPause=!t}remove(t){return this.exists(t,!0),this._sounds[t].destroy(),delete this._sounds[t],this}get volumeAll(){return this._context.volume}set volumeAll(t){this._context.volume=t,this._context.refresh()}get speedAll(){return this._context.speed}set speedAll(t){this._context.speed=t,this._context.refresh()}togglePauseAll(){return this._context.togglePause()}pauseAll(){return this._context.paused=!0,this._context.refreshPaused(),this}resumeAll(){return this._context.paused=!1,this._context.refreshPaused(),this}toggleMuteAll(){return this._context.toggleMute()}muteAll(){return this._context.muted=!0,this._context.refresh(),this}unmuteAll(){return this._context.muted=!1,this._context.refresh(),this}removeAll(){for(let t in this._sounds)this._sounds[t].destroy(),delete this._sounds[t];return this}stopAll(){for(let t in this._sounds)this._sounds[t].stop();return this}exists(t,e=!1){let i=!!this._sounds[t];return e&&console.assert(i,`No sound matching alias '${t}'.`),i}isPlaying(){for(let t in this._sounds)if(this._sounds[t].isPlaying)return!0;return!1}find(t){return this.exists(t,!0),this._sounds[t]}play(t,e){return this.find(t).play(e)}stop(t){return this.find(t).stop()}pause(t){return this.find(t).pause()}resume(t){return this.find(t).resume()}volume(t,e){let i=this.find(t);return e!==void 0&&(i.volume=e),i.volume}speed(t,e){let i=this.find(t);return e!==void 0&&(i.speed=e),i.speed}duration(t){return this.find(t).duration}close(){return this.removeAll(),this._sounds=null,this._webAudioContext&&(this._webAudioContext.destroy(),this._webAudioContext=null),this._htmlAudioContext&&(this._htmlAudioContext.destroy(),this._htmlAudioContext=null),this._context=null,this}};var Ne=class{constructor(t,e){this.init(t,e)}init(t,e){this.destination=t,this.source=e||t}connect(t){this.source?.connect(t)}disconnect(){this.source?.disconnect()}destroy(){this.disconnect(),this.destination=null,this.source=null}};var dt=class extends Ne{constructor(r=0,t=0,e=0,i=0,s=0,o=0,n=0,a=0,l=0,h=0){let c=[],u=[{f:dt.F32,type:"lowshelf",gain:r},{f:dt.F64,type:"peaking",gain:t},{f:dt.F125,type:"peaking",gain:e},{f:dt.F250,type:"peaking",gain:i},{f:dt.F500,type:"peaking",gain:s},{f:dt.F1K,type:"peaking",gain:o},{f:dt.F2K,type:"peaking",gain:n},{f:dt.F4K,type:"peaking",gain:a},{f:dt.F8K,type:"peaking",gain:l},{f:dt.F16K,type:"highshelf",gain:h}];zt().useLegacy||(c=u.map(d=>{let p=zt().context.audioContext.createBiquadFilter();return p.type=d.type,pe.setParamValue(p.Q,1),p.frequency.value=d.f,pe.setParamValue(p.gain,d.gain),p})),super(c[0],c[c.length-1]),this.bands=c,this.bandsMap={};for(let d=0;d<this.bands.length;d++){let p=this.bands[d];d>0&&this.bands[d-1].connect(p),this.bandsMap[p.frequency.value]=p}}setGain(r,t=0){if(!this.bandsMap[r])throw new Error(`No band found for frequency ${r}`);pe.setParamValue(this.bandsMap[r].gain,t)}getGain(r){if(!this.bandsMap[r])throw new Error(`No band found for frequency ${r}`);return this.bandsMap[r].gain.value}set f32(r){this.setGain(dt.F32,r)}get f32(){return this.getGain(dt.F32)}set f64(r){this.setGain(dt.F64,r)}get f64(){return this.getGain(dt.F64)}set f125(r){this.setGain(dt.F125,r)}get f125(){return this.getGain(dt.F125)}set f250(r){this.setGain(dt.F250,r)}get f250(){return this.getGain(dt.F250)}set f500(r){this.setGain(dt.F500,r)}get f500(){return this.getGain(dt.F500)}set f1k(r){this.setGain(dt.F1K,r)}get f1k(){return this.getGain(dt.F1K)}set f2k(r){this.setGain(dt.F2K,r)}get f2k(){return this.getGain(dt.F2K)}set f4k(r){this.setGain(dt.F4K,r)}get f4k(){return this.getGain(dt.F4K)}set f8k(r){this.setGain(dt.F8K,r)}get f8k(){return this.getGain(dt.F8K)}set f16k(r){this.setGain(dt.F16K,r)}get f16k(){return this.getGain(dt.F16K)}reset(){this.bands.forEach(r=>{pe.setParamValue(r.gain,0)})}destroy(){this.bands.forEach(r=>{r.disconnect()}),this.bands=null,this.bandsMap=null}},qe=dt;qe.F32=32;qe.F64=64;qe.F125=125;qe.F250=250;qe.F500=500;qe.F1K=1e3;qe.F2K=2e3;qe.F4K=4e3;qe.F8K=8e3;qe.F16K=16e3;var wg={loader:T.LoadParser,resolver:T.ResolveParser,cache:T.CacheParser,detection:T.DetectionParser};S.handle(T.Asset,r=>{let t=r.ref;Object.entries(wg).filter(([e])=>!!t[e]).forEach(([e,i])=>S.add(Object.assign(t[e],{extension:t[e].extension??i})))},r=>{let t=r.ref;Object.keys(wg).filter(e=>!!t[e]).forEach(e=>S.remove(t[e]))});var ol=class{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach(e=>{this._assetList.push(e)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;let t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let i=0;i<e;i++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}};function _e(r,t){if(Array.isArray(t)){for(let e of t)if(r.startsWith(`data:${e}`))return!0;return!1}return r.startsWith(`data:${t}`)}function Ht(r,t){let e=r.split("?")[0],i=w.path.extname(e).toLowerCase();return Array.isArray(t)?t.includes(i):i===t}var Yt=(r,t,e=!1)=>(Array.isArray(r)||(r=[r]),t?r.map(i=>typeof i=="string"||e?t(i):i):r);var Oi=(r,t)=>{let e=t.split("?")[1];return e&&(r+=`?${e}`),r};function Cg(r,t,e,i,s){let o=t[e];for(let n=0;n<o.length;n++){let a=o[n];e<t.length-1?Cg(r.replace(i[e],a),t,e+1,i,s):s.push(r.replace(i[e],a))}}function nl(r){let t=/\{(.*?)\}/g,e=r.match(t),i=[];if(e){let s=[];e.forEach(o=>{let n=o.substring(1,o.length-1).split(",");s.push(n)}),Cg(r,s,0,e,i)}else i.push(r);return i}var Mr=r=>!Array.isArray(r);var eu=class{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){let e=this._cache.get(t);return e||console.warn(`[Assets] Asset id ${t} was not found in the Cache`),e}set(t,e){let i=Yt(t),s;for(let a=0;a<this.parsers.length;a++){let l=this.parsers[a];if(l.test(e)){s=l.getCacheableAssets(i,e);break}}s||(s={},i.forEach(a=>{s[a]=e}));let o=Object.keys(s),n={cacheKeys:o,keys:i};if(i.forEach(a=>{this._cacheMap.set(a,n)}),o.forEach(a=>{this._cache.has(a)&&this._cache.get(a)!==e&&console.warn("[Cache] already has key:",a),this._cache.set(a,s[a])}),e instanceof v){let a=e;i.forEach(l=>{a.baseTexture!==v.EMPTY.baseTexture&&K.addToCache(a.baseTexture,l),v.addToCache(a,l)})}}remove(t){if(!this._cacheMap.has(t)){console.warn(`[Assets] Asset id ${t} was not found in the Cache`);return}let e=this._cacheMap.get(t);e.cacheKeys.forEach(i=>{this._cache.delete(i)}),e.keys.forEach(i=>{this._cacheMap.delete(i)})}get parsers(){return this._parsers}},Ze=new eu;var al=class{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(t,e,i)=>(this._parsersValidated=!1,t[e]=i,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(t,e){let i={promise:null,parser:null};return i.promise=(async()=>{let s=null,o=null;if(e.loadParser&&(o=this._parserHash[e.loadParser],o||console.warn(`[Assets] specified load parser "${e.loadParser}" not found while loading ${t}`)),!o){for(let n=0;n<this.parsers.length;n++){let a=this.parsers[n];if(a.load&&a.test?.(t,e,this)){o=a;break}}if(!o)return console.warn(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}s=await o.load(t,e,this),i.parser=o;for(let n=0;n<this.parsers.length;n++){let a=this.parsers[n];a.parse&&a.parse&&await a.testParse?.(s,e,this)&&(s=await a.parse(s,e,this)||s,i.parser=a)}return s})(),i}async load(t,e){this._parsersValidated||this._validateParsers();let i=0,s={},o=Mr(t),n=Yt(t,h=>({alias:[h],src:h})),a=n.length,l=n.map(async h=>{let c=w.path.toAbsolute(h.src);if(!s[h.src])try{this.promiseCache[c]||(this.promiseCache[c]=this._getLoadPromiseAndParser(c,h)),s[h.src]=await this.promiseCache[c].promise,e&&e(++i/a)}catch(u){throw delete this.promiseCache[c],delete s[h.src],new Error(`[Loader.load] Failed to load ${c}.
${u}`)}});return await Promise.all(l),o?s[n[0].src]:s}async unload(t){let e=Yt(t,i=>({alias:[i],src:i})).map(async i=>{let s=w.path.toAbsolute(i.src),o=this.promiseCache[s];if(o){let n=await o.promise;delete this.promiseCache[s],o.parser?.unload?.(n,i,this)}});await Promise.all(e)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(t=>t.name).reduce((t,e)=>(t[e.name]&&console.warn(`[Assets] loadParser name conflict "${e.name}"`),{...t,[e.name]:e}),{})}};var _t=(r=>(r[r.Low=0]="Low",r[r.Normal=1]="Normal",r[r.High=2]="High",r))(_t||{});var Db=".json",Bb="application/json",ru={extension:{type:T.LoadParser,priority:_t.Low},name:"loadJson",test(r){return _e(r,Bb)||Ht(r,Db)},async load(r){return await(await C.ADAPTER.fetch(r)).json()}};S.add(ru);var Lb=".txt",Ob="text/plain",iu={name:"loadTxt",extension:{type:T.LoadParser,priority:_t.Low},test(r){return _e(r,Ob)||Ht(r,Lb)},async load(r){return await(await C.ADAPTER.fetch(r)).text()}};S.add(iu);var kb=["normal","bold","100","200","300","400","500","600","700","800","900"],Nb=[".ttf",".otf",".woff",".woff2"],Ub=["font/ttf","font/otf","font/woff","font/woff2"],Gb=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function su(r){let t=w.path.extname(r),e=w.path.basename(r,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(o=>o.charAt(0).toUpperCase()+o.slice(1)),i=e.length>0;for(let o of e)if(!o.match(Gb)){i=!1;break}let s=e.join(" ");return i||(s=`"${s.replace(/[\\"]/g,"\\$&")}"`),s}var zb=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function Hb(r){return zb.test(r)?r:encodeURI(r)}var ou={extension:{type:T.LoadParser,priority:_t.Low},name:"loadWebFont",test(r){return _e(r,Ub)||Ht(r,Nb)},async load(r,t){let e=C.ADAPTER.getFontFaceSet();if(e){let i=[],s=t.data?.family??su(r),o=t.data?.weights?.filter(a=>kb.includes(a))??["normal"],n=t.data??{};for(let a=0;a<o.length;a++){let l=o[a],h=new FontFace(s,`url(${Hb(r)})`,{...n,weight:l});await h.load(),e.add(h),i.push(h)}return i.length===1?i[0]:i}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(r){(Array.isArray(r)?r:[r]).forEach(t=>C.ADAPTER.getFontFaceSet().delete(t))}};S.add(ou);var Sg=0,nu,Vb="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=",jb={id:"checkImageBitmap",code:`
    async function checkImageBitmap()
    {
        try
        {
            if (typeof createImageBitmap !== 'function') return false;

            const response = await fetch('${Vb}');
            const imageBlob =  await response.blob();
            const imageBitmap = await createImageBitmap(imageBlob);

            return imageBitmap.width === 1 && imageBitmap.height === 1;
        }
        catch (e)
        {
            return false;
        }
    }
    checkImageBitmap().then((result) => { self.postMessage(result); });
    `},Wb={id:"loadImageBitmap",code:`
    async function loadImageBitmap(url)
    {
        const response = await fetch(url);

        if (!response.ok)
        {
            throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \`
                + \`\${response.status} \${response.statusText}\`);
        }

        const imageBlob =  await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);

        return imageBitmap;
    }
    self.onmessage = async (event) =>
    {
        try
        {
            const imageBitmap = await loadImageBitmap(event.data.data[0]);

            self.postMessage({
                data: imageBitmap,
                uuid: event.data.uuid,
                id: event.data.id,
            }, [imageBitmap]);
        }
        catch(e)
        {
            self.postMessage({
                error: e,
                uuid: event.data.uuid,
                id: event.data.id,
            });
        }
    };`},au,lu=class{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(t=>{let e=URL.createObjectURL(new Blob([jb.code],{type:"application/javascript"})),i=new Worker(e);i.addEventListener("message",s=>{i.terminate(),URL.revokeObjectURL(e),t(s.data)})}),this._isImageBitmapSupported)}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){nu===void 0&&(nu=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<nu&&(au||(au=URL.createObjectURL(new Blob([Wb.code],{type:"application/javascript"}))),this._createdWorkers++,t=new Worker(au),t.addEventListener("message",e=>{this.complete(e.data),this.returnWorker(e.target),this.next()})),t}returnWorker(t){this.workerPool.push(t)}complete(t){t.error!==void 0?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}async _run(t,e){await this._initWorkers();let i=new Promise((s,o)=>{this.queue.push({id:t,arguments:e,resolve:s,reject:o})});return this.next(),i}next(){if(!this.queue.length)return;let t=this.getWorker();if(!t)return;let e=this.queue.pop(),i=e.id;this.resolveHash[Sg]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:Sg++,id:i})}},hu=new lu;function Ue(r,t,e){r.resource.internal=!0;let i=new v(r),s=()=>{delete t.promiseCache[e],Ze.has(e)&&Ze.remove(e)};return i.baseTexture.once("destroyed",()=>{e in t.promiseCache&&(console.warn("[Assets] A BaseTexture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the BaseTexture."),s())}),i.once("destroyed",()=>{r.destroyed||(console.warn("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),s())}),i}var Xb=[".jpeg",".jpg",".png",".webp",".avif"],$b=["image/jpeg","image/png","image/webp","image/avif"];async function cu(r){let t=await C.ADAPTER.fetch(r);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${r}: ${t.status} ${t.statusText}`);let e=await t.blob();return await createImageBitmap(e)}var Rr={name:"loadTextures",extension:{type:T.LoadParser,priority:_t.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(r){return _e(r,$b)||Ht(r,Xb)},async load(r,t,e){let i=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap,s;i?this.config.preferWorkers&&await hu.isImageBitmapSupported()?s=await hu.loadImageBitmap(r):s=await cu(r):s=await new Promise((a,l)=>{let h=new Image;h.crossOrigin=this.config.crossOrigin,h.src=r,h.complete?a(h):(h.onload=()=>a(h),h.onerror=c=>l(c))});let o={...t.data};o.resolution??(o.resolution=w.getResolutionOfUrl(r)),i&&o.resourceOptions?.ownsImageBitmap===void 0&&(o.resourceOptions={...o.resourceOptions},o.resourceOptions.ownsImageBitmap=!0);let n=new K(s,o);return n.resource.src=r,Ue(n,e,r)},unload(r){r.destroy(!0)}};S.add(Rr);var Yb=".svg",Kb="image/svg+xml",uu={extension:{type:T.LoadParser,priority:_t.High},name:"loadSVG",test(r){return _e(r,Kb)||Ht(r,Yb)},async testParse(r){return zs.test(r)},async parse(r,t,e){let i=new zs(r,t?.data?.resourceOptions);await i.load();let s=new K(i,{resolution:w.getResolutionOfUrl(r),...t?.data});return s.resource.src=t.src,Ue(s,e,t.src)},async load(r,t){return(await C.ADAPTER.fetch(r)).text()},unload:Rr.unload};S.add(uu);var qb=[".mp4",".m4v",".webm",".ogv"],Zb=["video/mp4","video/webm","video/ogg"],du={name:"loadVideo",extension:{type:T.LoadParser,priority:_t.High},config:{defaultAutoPlay:!0},test(r){return _e(r,Zb)||Ht(r,qb)},async load(r,t,e){let i,s=await(await C.ADAPTER.fetch(r)).blob(),o=URL.createObjectURL(s);try{let n={autoPlay:this.config.defaultAutoPlay,...t?.data?.resourceOptions},a=new cn(o,n);await a.load();let l=new K(a,{alphaMode:await w.detectVideoAlphaMode(),resolution:w.getResolutionOfUrl(r),...t?.data});l.resource.src=r,i=Ue(l,e,r),i.baseTexture.once("destroyed",()=>{URL.revokeObjectURL(o)})}catch(n){throw URL.revokeObjectURL(o),n}return i},unload(r){r.destroy(!0)}};S.add(du);var ll=class{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,e)=>`${t}${this._bundleIdConnector}${e}`,extractAssetIdFromBundle:(t,e)=>e.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach(e=>{this._preferredOrder.push(e),e.priority||(e.priority=Object.keys(e.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if(typeof t=="string")this._defaultSearchParams=t;else{let e=t;this._defaultSearchParams=Object.keys(e).map(i=>`${encodeURIComponent(i)}=${encodeURIComponent(e[i])}`).join("&")}}getAlias(t){let{alias:e,name:i,src:s,srcs:o}=t;return Yt(e||i||s||o,n=>typeof n=="string"?n:Array.isArray(n)?n.map(a=>a?.src??a?.srcs??a):n?.src||n?.srcs?n.src??n.srcs:n,!0)}addManifest(t){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach(e=>{this.addBundle(e.name,e.assets)})}addBundle(t,e){let i=[];Array.isArray(e)?e.forEach(s=>{let o=s.src??s.srcs,n=s.alias??s.name,a;if(typeof n=="string"){let l=this._createBundleAssetId(t,n);i.push(l),a=[n,l]}else{let l=n.map(h=>this._createBundleAssetId(t,h));i.push(...l),a=[...n,...l]}this.add({...s,alias:a,src:o})}):Object.keys(e).forEach(s=>{let o=[s,this._createBundleAssetId(t,s)];if(typeof e[s]=="string")this.add({alias:o,src:e[s]});else if(Array.isArray(e[s]))this.add({alias:o,src:e[s]});else{let n=e[s],a=n.src??n.srcs;this.add({...n,alias:o,src:Array.isArray(a)?a:[a]})}i.push(...o)}),this._bundles[t]=i}add(t,e,i,s,o){let n=[];typeof t=="string"||Array.isArray(t)&&typeof t[0]=="string"?(w.deprecation("7.2.0",`Assets.add now uses an object instead of individual parameters.
Please use Assets.add({ alias, src, data, format, loadParser }) instead.`),n.push({alias:t,src:e,data:i,format:s,loadParser:o})):Array.isArray(t)?n.push(...t):n.push(t);let a;a=l=>{this.hasKey(l)&&console.warn(`[Resolver] already has key: ${l} overwriting`)},Yt(n).forEach(l=>{let{src:h,srcs:c}=l,{data:u,format:d,loadParser:p}=l,f=Yt(h||c).map(x=>typeof x=="string"?nl(x):Array.isArray(x)?x:[x]),m=this.getAlias(l);Array.isArray(m)?m.forEach(a):a(m);let g=[];f.forEach(x=>{x.forEach(b=>{let y={};if(typeof b!="object"){y.src=b;for(let _=0;_<this._parsers.length;_++){let L=this._parsers[_];if(L.test(b)){y=L.parse(b);break}}}else u=b.data??u,d=b.format??d,p=b.loadParser??p,y={...y,...b};if(!m)throw new Error(`[Resolver] alias is undefined for this asset: ${y.src}`);y=this.buildResolvedAsset(y,{aliases:m,data:u,format:d,loadParser:p}),g.push(y)})}),m.forEach(x=>{this._assetMap[x]=g})})}resolveBundle(t){let e=Mr(t);t=Yt(t);let i={};return t.forEach(s=>{let o=this._bundles[s];if(o){let n=this.resolve(o),a={};for(let l in n){let h=n[l];a[this._extractAssetIdFromBundle(s,l)]=h}i[s]=a}}),e?i[t[0]]:i}resolveUrl(t){let e=this.resolve(t);if(typeof t!="string"){let i={};for(let s in e)i[s]=e[s].src;return i}return e.src}resolve(t){let e=Mr(t);t=Yt(t);let i={};return t.forEach(s=>{if(!this._resolverHash[s])if(this._assetMap[s]){let o=this._assetMap[s],n=o[0],a=this._getPreferredOrder(o);a?.priority.forEach(l=>{a.params[l].forEach(h=>{let c=o.filter(u=>u[l]?u[l]===h:!1);c.length&&(o=c)})}),this._resolverHash[s]=o[0]??n}else this._resolverHash[s]=this.buildResolvedAsset({alias:[s],src:s},{});i[s]=this._resolverHash[s]}),e?i[t[0]]:i}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let e=0;e<t.length;e++){let i=t[0],s=this._preferredOrder.find(o=>o.params.format.includes(i.format));if(s)return s}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;let e=/\?/.test(t)?"&":"?";return`${t}${e}${this._defaultSearchParams}`}buildResolvedAsset(t,e){let{aliases:i,data:s,loadParser:o,format:n}=e;return(this._basePath||this._rootPath)&&(t.src=w.path.toAbsolute(t.src,this._basePath,this._rootPath)),t.alias=i??t.alias??[t.src],t.src=this._appendDefaultSearchParams(t.src),t.data={...s||{},...t.data},t.loadParser=o??t.loadParser,t.format=n??w.path.extname(t.src).slice(1),t.srcs=t.src,t.name=t.alias,t}};var hl=class{constructor(){this._detections=[],this._initialized=!1,this.resolver=new ll,this.loader=new al,this.cache=Ze,this._backgroundLoader=new ol(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){if(this._initialized){console.warn("[Assets]AssetManager already initialized, did you load before calling this Asset.init()?");return}if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let o=t.manifest;typeof o=="string"&&(o=await this.load(o)),this.resolver.addManifest(o)}let e=t.texturePreference?.resolution??1,i=typeof e=="number"?[e]:e,s=await this._detectFormats({preferredFormats:t.texturePreference?.format,skipDetections:t.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:s,resolution:i}}),t.preferences&&this.setPreferences(t.preferences)}add(t,e,i,s,o){this.resolver.add(t,e,i,s,o)}async load(t,e){this._initialized||await this.init();let i=Mr(t),s=Yt(t).map(a=>{if(typeof a!="string"){let l=this.resolver.getAlias(a);return l.some(h=>!this.resolver.hasKey(h))&&this.add(a),Array.isArray(l)?l[0]:l}return this.resolver.hasKey(a)||this.add({alias:a,src:a}),a}),o=this.resolver.resolve(s),n=await this._mapLoadToResolve(o,e);return i?n[s[0]]:n}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let i=!1;typeof t=="string"&&(i=!0,t=[t]);let s=this.resolver.resolveBundle(t),o={},n=Object.keys(s),a=0,l=0,h=()=>{e?.(++a/l)},c=n.map(u=>{let d=s[u];return l+=Object.keys(d).length,this._mapLoadToResolve(d,h).then(p=>{o[u]=p})});return await Promise.all(c),i?o[t[0]]:o}async backgroundLoad(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);let e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);let e=this.resolver.resolveBundle(t);Object.values(e).forEach(i=>{this._backgroundLoader.add(Object.values(i))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if(typeof t=="string")return Ze.get(t);let e={};for(let i=0;i<t.length;i++)e[i]=Ze.get(t[i]);return e}async _mapLoadToResolve(t,e){let i=Object.values(t),s=Object.keys(t);this._backgroundLoader.active=!1;let o=await this.loader.load(i,e);this._backgroundLoader.active=!0;let n={};return i.forEach((a,l)=>{let h=o[a.src],c=[a.src];a.alias&&c.push(...a.alias),n[s[l]]=h,Ze.set(c,h)}),n}async unload(t){this._initialized||await this.init();let e=Yt(t).map(s=>typeof s!="string"?s.src:s),i=this.resolver.resolve(e);await this._unloadFromResolved(i)}async unloadBundle(t){this._initialized||await this.init(),t=Yt(t);let e=this.resolver.resolveBundle(t),i=Object.keys(e).map(s=>this._unloadFromResolved(e[s]));await Promise.all(i)}async _unloadFromResolved(t){let e=Object.values(t);e.forEach(i=>{Ze.remove(i.src)}),await this.loader.unload(e)}async _detectFormats(t){let e=[];t.preferredFormats&&(e=Array.isArray(t.preferredFormats)?t.preferredFormats:[t.preferredFormats]);for(let i of t.detections)t.skipDetections||await i.test()?e=await i.add(e):t.skipDetections||(e=await i.remove(e));return e=e.filter((i,s)=>e.indexOf(i)===s),e}get detections(){return this._detections}get preferWorkers(){return Rr.config.preferWorkers}set preferWorkers(t){w.deprecation("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:t})}setPreferences(t){this.loader.parsers.forEach(e=>{e.config&&Object.keys(e.config).filter(i=>i in t).forEach(i=>{e.config[i]=t[i]})})}},be=new hl;S.handleByList(T.LoadParser,be.loader.parsers).handleByList(T.ResolveParser,be.resolver.parsers).handleByList(T.CacheParser,be.cache.parsers).handleByList(T.DetectionParser,be.detections);var pu={extension:T.CacheParser,test:r=>Array.isArray(r)&&r.every(t=>t instanceof v),getCacheableAssets:(r,t)=>{let e={};return r.forEach(i=>{t.forEach((s,o)=>{e[i+(o===0?"":o+1)]=s})}),e}};S.add(pu);async function cl(r){if("Image"in globalThis)return new Promise(t=>{let e=new Image;e.onload=()=>{t(!0)},e.onerror=()=>{t(!1)},e.src=r});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{let t=await(await fetch(r)).blob();await createImageBitmap(t)}catch{return!1}return!0}return!1}var fu={extension:{type:T.DetectionParser,priority:1},test:async()=>cl("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async r=>[...r,"avif"],remove:async r=>r.filter(t=>t!=="avif")};S.add(fu);var mu={extension:{type:T.DetectionParser,priority:0},test:async()=>cl("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async r=>[...r,"webp"],remove:async r=>r.filter(t=>t!=="webp")};S.add(mu);var Eg=["png","jpg","jpeg"],gu={extension:{type:T.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async r=>[...r,...Eg],remove:async r=>r.filter(t=>!Eg.includes(t))};S.add(gu);var Qb="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function js(r){return Qb?!1:document.createElement("video").canPlayType(r)!==""}var xu={extension:{type:T.DetectionParser,priority:0},test:async()=>js("video/webm"),add:async r=>[...r,"webm"],remove:async r=>r.filter(t=>t!=="webm")};S.add(xu);var yu={extension:{type:T.DetectionParser,priority:0},test:async()=>js("video/mp4"),add:async r=>[...r,"mp4","m4v"],remove:async r=>r.filter(t=>t!=="mp4"&&t!=="m4v")};S.add(yu);var vu={extension:{type:T.DetectionParser,priority:0},test:async()=>js("video/ogg"),add:async r=>[...r,"ogv"],remove:async r=>r.filter(t=>t!=="ogv")};S.add(vu);var _u={extension:T.ResolveParser,test:Rr.test,parse:r=>({resolution:parseFloat(C.RETINA_PREFIX.exec(r)?.[1]??"1"),format:w.path.extname(r).slice(1),src:r})};S.add(_u);var Ag=r=>{let t=r.src;return r?.alias?.[0]??w.path.basename(t,w.path.extname(t))},Pg={extension:T.Asset,detection:{test:async()=>!0,add:async r=>[...r,...Fi.filter(t=>Di[t])],remove:async r=>r.filter(t=>r.includes(t))},loader:{extension:{type:[T.LoadParser],priority:_t.High},test(r){let t=w.path.extname(r).slice(1);return!!Di[t]||tu.some(e=>r.startsWith(`data:${e}`))},async load(r,t){let e=await new Promise((i,s)=>ke.from({...t.data,url:r,preload:!0,loaded(o,n){o?s(o):i(n),t.data?.loaded?.(o,n)}}));return zt().add(Ag(t),e),e},async unload(r,t){zt().remove(Ag(t))}}};S.add(Pg);var oz=_g(new sl);var Ig={engine_start_1:{start:0,end:1.8995918367346938,loop:!1},engine_start_2:{start:3,end:5,loop:!1},engine_start_3:{start:6,end:8,loop:!1},explosion_1:{start:9,end:11,loop:!1},explosion_2:{start:12,end:13.5,loop:!1},explosion_3:{start:15,end:17,loop:!1},explosion_4:{start:18,end:19.5,loop:!1},money_collect_2:{start:21,end:21.5,loop:!1},money_collect_3:{start:23,end:23.82,loop:!1},money_collect_4:{start:25,end:25.82,loop:!1},player_car_crash:{start:27,end:31,loop:!1},power_up_4:{start:32,end:33.5,loop:!1},power_up_5:{start:35,end:36.5,loop:!1},projectile:{start:38,end:38.5,loop:!1},rocket_spawn_1:{start:40,end:41.08335600907029,loop:!1},rocket_spawn_2:{start:43,end:44.08335600907029,loop:!1},rocket_spawn_3:{start:46,end:47.5,loop:!1},ui_click_1:{start:49,end:49.51,loop:!1},ui_menu_whoosh:{start:51,end:51.5,loop:!1},upgrade_3:{start:53,end:55.5,loop:!1}};var Ge=class{active=!0;memorize=!1;bindings=[];prevParameters=[];dispatch(t){this.active&&(this.memorize&&this.prevParameters.push(t),this.bindings.slice().forEach(e=>e.execute(t)))}add(t,e){return this.addBinding(new ul(this,t,e,!1))}addOnce(t,e){return this.addBinding(new ul(this,t,e,!0))}addBinding(t){return this.bindings.push(t),this.memorize&&this.prevParameters.forEach(e=>t.execute(e)),t}remove(t){this.bindings=this.bindings.filter(e=>e!=t),t.destroy()}removeAll(){this.bindings.slice().forEach(t=>t.destroy()),this.bindings.length=0}},ul=class{active=!0;once=!1;callback;filter;signal;constructor(t,e,i=null,s=!1){this.signal=t,this.callback=e,this.filter=i,this.once=s}execute(t){if(!this.signal||!this.callback||!this.active||this.filter&&!this.filter(t))return;let e=this.callback;e(t),this.once&&this.detach()}detach(){this.signal&&this.signal.remove(this)}destroy(){this.signal=null,this.callback=null,this.filter=null}};var xn=class{onChange=new Ge;reasons=[];add(t){let e=this.isEmpty();this.reasons.push(t),e&&this.onChange.dispatch(!0)}remove(t){let e=this.isEmpty();this.reasons=this.reasons.filter(i=>i!==t),!e&&this.isEmpty()&&this.onChange.dispatch(!1)}isEmpty(){return this.reasons.length===0}};var dl=class{soundEnabled=!0;musicEnabled=!0;sound;music;musicTrack;musicContext;soundMuteReasons=new xn;musicMuteReasons=new xn;musicAvailable=!1;constructor(){this.sound=ke.from({url:"assets/sounds/sounds.mp3",sprites:Ig}),this.music={calm:ke.from("assets/music/calm.mp3"),active:ke.from("assets/music/active.mp3")},this.musicContext="calm",this.musicTrack=this.music.calm,this.soundMuteReasons.onChange.add(t=>{this.sound.volume=t?0:1,this.soundEnabled=!t}),this.musicMuteReasons.onChange.add(t=>{Object.values(this.music).forEach(e=>e.volume=t?0:1),this.musicEnabled=!t})}init(t,e){this.setSoundEnabled(t,"UserAction"),this.setMusicEnabled(e,"UserAction")}playSound(t){this.sound.play(t)}stopMusic(){this.musicTrack.stop()}setMusicContext(t){this.musicContext!=t&&(this.musicContext=t,this.playMusic(t))}playMusic(t){this.musicTrack.stop(),this.music[t].play({loop:!0}),this.musicTrack=this.music[t]}getSoundEnabled(){return this.soundEnabled}setSoundEnabled(t,e){t?this.soundMuteReasons.remove(e):this.soundMuteReasons.add(e)}getMusicEnabled(){return this.musicEnabled}setMusicEnabled(t,e){t?this.musicMuteReasons.remove(e):this.musicMuteReasons.add(e)}};var pl=class{ysdk;constructor(t){this.ysdk=t}async getLeaderboards(){return await this.ysdk.getLeaderboards()}async setPlayerEntry(t,e,i){if(!await this.ysdk.isAvailableMethod("leaderboards.setLeaderboardScore"))return;i&&await this.ysdk.getPlayer({scopes:!0});let n=(await this.ysdk.getLeaderboards()).setLeaderboardScore(t,e);return console.log("Score setting result",n),n}async getPlayerEntry(t){if(!await this.ysdk.isAvailableMethod("leaderboards.getLeaderboardPlayerEntry")){console.log("leaderboards.getLeaderboardPlayerEntry method not available");return}return await(await this.ysdk.getLeaderboards()).getLeaderboardPlayerEntry(t)}async getLeaderboardEntries(t,e){let i=await this.ysdk.getLeaderboards(),s=await this.ysdk.getPlayer(),o=!1;return s&&s.getMode()!=="lite"&&(o=!0),await i.getLeaderboardEntries(t,{quantityTop:e,includeUser:o,quantityAround:1})}};var Mg="car-shooter",Rg={music:!0,sounds:!0,money:0,reputation:0,selectedCar:0,firstTime:!0,cars:[{id:0,unlocked:!0,upgrades:{armor:0,damage:0,guns:0}},{id:1,unlocked:!1,upgrades:{armor:0,damage:0,guns:0}},{id:2,unlocked:!1,upgrades:{armor:0,damage:0,guns:0}}]},fl=class{data;constructor(){this.data=this.loadLocal()}loadLocal(){let t=localStorage.getItem(Mg);return t?JSON.parse(t):Object.assign({},Rg)}reset(){this.data=Object.assign({},Rg),this.saveLocal()}saveLocal(){localStorage.setItem(Mg,JSON.stringify(this.data))}upgradeCar(t,e){this.data.cars[t].upgrades[e]++,this.saveLocal()}getCarUpgrades(t){return this.data.cars[t||this.data.selectedCar].upgrades}getCarUpgrade(t,e){return this.data.cars[e||this.data.selectedCar].upgrades[t]}trackFTUE(){this.data.firstTime&&(this.data.firstTime=!1,this.saveLocal())}};var yn=new $,t1=new Uint16Array([0,1,2,0,2,3]),I=class r extends D{constructor(t){super(),this._anchor=new re(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new tt(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=q.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||v.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=t1,this.pluginName="batch",this.isSprite=!0,this._roundPixels=C.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=w.sign(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=w.sign(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){let t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;let e=this.transform.worldTransform,i=e.a,s=e.b,o=e.c,n=e.d,a=e.tx,l=e.ty,h=this.vertexData,c=t.trim,u=t.orig,d=this._anchor,p=0,f=0,m=0,g=0;if(c?(f=c.x-d._x*u.width,p=f+c.width,g=c.y-d._y*u.height,m=g+c.height):(f=-d._x*u.width,p=f+u.width,g=-d._y*u.height,m=g+u.height),h[0]=i*f+o*g+a,h[1]=n*g+s*f+l,h[2]=i*p+o*g+a,h[3]=n*g+s*p+l,h[4]=i*p+o*m+a,h[5]=n*m+s*p+l,h[6]=i*f+o*m+a,h[7]=n*m+s*f+l,this._roundPixels){let x=C.RESOLUTION;for(let b=0;b<h.length;++b)h[b]=Math.round(h[b]*x)/x}}calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;let t=this._texture,e=this.vertexTrimmedData,i=t.orig,s=this._anchor,o=this.transform.worldTransform,n=o.a,a=o.b,l=o.c,h=o.d,c=o.tx,u=o.ty,d=-s._x*i.width,p=d+i.width,f=-s._y*i.height,m=f+i.height;if(e[0]=n*d+l*f+c,e[1]=h*f+a*d+u,e[2]=n*p+l*f+c,e[3]=h*f+a*p+u,e[4]=n*p+l*m+c,e[5]=h*m+a*p+u,e[6]=n*d+l*m+c,e[7]=h*m+a*d+u,this._roundPixels){let g=C.RESOLUTION;for(let x=0;x<e.length;++x)e[x]=Math.round(e[x]*g)/g}}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){let t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return this.children.length===0?(this._localBounds||(this._localBounds=new cr),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new Y),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,yn);let e=this._texture.orig.width,i=this._texture.orig.height,s=-e*this.anchor.x,o=0;return yn.x>=s&&yn.x<s+e&&(o=-i*this.anchor.y,yn.y>=o&&yn.y<o+i)}destroy(t){if(super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof t=="boolean"?t:t?.texture){let e=typeof t=="boolean"?t:t?.baseTexture;this._texture.destroy(!!e)}this._texture=null}static from(t,e){let i=t instanceof v?t:v.from(t,e);return new r(i)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1,this._transformTrimmedID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){let e=w.sign(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){let e=w.sign(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||v.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}};var ki=class r extends I{constructor(t,e=!0){super(t[0]instanceof v?t[0]:t[0].texture),this._textures=null,this._durations=null,this._autoUpdate=e,this._isConnectedToTicker=!1,this.animationSpeed=1,this.loop=!0,this.updateAnchor=!1,this.onComplete=null,this.onFrameChange=null,this.onLoop=null,this._currentTime=0,this._playing=!1,this._previousFrame=null,this.textures=t}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(ut.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(ut.shared.add(this.update,this,ve.HIGH),this._isConnectedToTicker=!0))}gotoAndStop(t){this.stop(),this.currentFrame=t}gotoAndPlay(t){this.currentFrame=t,this.play()}update(t){if(!this._playing)return;let e=this.animationSpeed*t,i=this.currentFrame;if(this._durations!==null){let s=this._currentTime%1*this._durations[this.currentFrame];for(s+=e/60*1e3;s<0;)this._currentTime--,s+=this._durations[this.currentFrame];let o=Math.sign(this.animationSpeed*t);for(this._currentTime=Math.floor(this._currentTime);s>=this._durations[this.currentFrame];)s-=this._durations[this.currentFrame]*o,this._currentTime+=o;this._currentTime+=s/this._durations[this.currentFrame]}else this._currentTime+=e;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):i!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<i||this.animationSpeed<0&&this.currentFrame>i)&&this.onLoop(),this.updateTexture())}updateTexture(){let t=this.currentFrame;this._previousFrame!==t&&(this._previousFrame=t,this._texture=this._textures[t],this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this.uvs=this._texture._uvs.uvsFloat32,this.updateAnchor&&this._anchor.copyFrom(this._texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))}destroy(t){this.stop(),super.destroy(t),this.onComplete=null,this.onFrameChange=null,this.onLoop=null}static fromFrames(t){let e=[];for(let i=0;i<t.length;++i)e.push(v.from(t[i]));return new r(e)}static fromImages(t){let e=[];for(let i=0;i<t.length;++i)e.push(v.from(t[i]));return new r(e)}get totalFrames(){return this._textures.length}get textures(){return this._textures}set textures(t){if(t[0]instanceof v)this._textures=t,this._durations=null;else{this._textures=[],this._durations=[];for(let e=0;e<t.length;e++)this._textures.push(t[e].texture),this._durations.push(t[e].time)}this._previousFrame=null,this.gotoAndStop(0),this.updateTexture()}get currentFrame(){let t=Math.floor(this._currentTime)%this._textures.length;return t<0&&(t+=this._textures.length),t}set currentFrame(t){if(t<0||t>this.totalFrames-1)throw new Error(`[AnimatedSprite]: Invalid frame index value ${t}, expected to be between 0 and totalFrames ${this.totalFrames}.`);let e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this.updateTexture()}get playing(){return this._playing}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(ut.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(ut.shared.add(this.update,this),this._isConnectedToTicker=!0))}};var e1={scale:1,speed:1,alpha:1,loop:!1},vn=class extends ki{config;constructor(t,e){super(be.get(t).animations.main),this.config=Object.assign({},e1,e),this.anchor.set(.5),this.scale.set(this.config.scale),this.alpha=this.config.alpha,this.animationSpeed=this.config.speed,this.loop=this.config.loop,this.play()}static getSheetData(t,e,i,s,o){let n={frames:{},animations:{main:[]},meta:{image:`${t}.png`,format:"RGBA8888",size:{w:e,h:i},scale:"1"}},a=0,l=0,h=Math.floor(n.meta.size.w/s),c=Math.floor(n.meta.size.h/o);for(let u=0;u<o;u++)for(let d=0;d<s;d++){a=d*h,l=u*c;let p=`frame_${d+u*s}`;n.frames[p]={frame:{x:a,y:l,w:h,h:c}},n.animations.main.push(p)}return n}};var Ni={build(r){let t=r.points,e,i,s,o,n,a;if(r.type===gt.CIRC){let f=r.shape;e=f.x,i=f.y,n=a=f.radius,s=o=0}else if(r.type===gt.ELIP){let f=r.shape;e=f.x,i=f.y,n=f.width,a=f.height,s=o=0}else{let f=r.shape,m=f.width/2,g=f.height/2;e=f.x+m,i=f.y+g,n=a=Math.max(0,Math.min(f.radius,Math.min(m,g))),s=m-n,o=g-a}if(!(n>=0&&a>=0&&s>=0&&o>=0)){t.length=0;return}let l=Math.ceil(2.3*Math.sqrt(n+a)),h=l*8+(s?4:0)+(o?4:0);if(t.length=h,h===0)return;if(l===0){t.length=8,t[0]=t[6]=e+s,t[1]=t[3]=i+o,t[2]=t[4]=e-s,t[5]=t[7]=i-o;return}let c=0,u=l*4+(s?2:0)+2,d=u,p=h;{let f=s+n,m=o,g=e+f,x=e-f,b=i+m;if(t[c++]=g,t[c++]=b,t[--u]=b,t[--u]=x,o){let y=i-m;t[d++]=x,t[d++]=y,t[--p]=y,t[--p]=g}}for(let f=1;f<l;f++){let m=Math.PI/2*(f/l),g=s+Math.cos(m)*n,x=o+Math.sin(m)*a,b=e+g,y=e-g,_=i+x,L=i-x;t[c++]=b,t[c++]=_,t[--u]=_,t[--u]=y,t[d++]=y,t[d++]=L,t[--p]=L,t[--p]=b}{let f=s,m=o+a,g=e+f,x=e-f,b=i+m,y=i-m;t[c++]=g,t[c++]=b,t[--p]=y,t[--p]=g,s&&(t[c++]=x,t[c++]=b,t[--p]=y,t[--p]=x)}},triangulate(r,t){let e=r.points,i=t.points,s=t.indices;if(e.length===0)return;let o=i.length/2,n=o,a,l;if(r.type!==gt.RREC){let c=r.shape;a=c.x,l=c.y}else{let c=r.shape;a=c.x+c.width/2,l=c.y+c.height/2}let h=r.matrix;i.push(r.matrix?h.a*a+h.c*l+h.tx:a,r.matrix?h.b*a+h.d*l+h.ty:l),o++,i.push(e[0],e[1]);for(let c=2;c<e.length;c+=2)i.push(e[c],e[c+1]),s.push(o++,n,o);s.push(n+1,n,o)}};function Fg(r,t=!1){let e=r.length;if(e<6)return;let i=0;for(let s=0,o=r[e-2],n=r[e-1];s<e;s+=2){let a=r[s],l=r[s+1];i+=(a-o)*(l+n),o=a,n=l}if(!t&&i>0||t&&i<=0){let s=e/2;for(let o=s+s%2;o<e;o+=2){let n=e-o-2,a=e-o-1,l=o,h=o+1;[r[n],r[l]]=[r[l],r[n]],[r[a],r[h]]=[r[h],r[a]]}}}var _n={build(r){r.points=r.shape.points.slice()},triangulate(r,t){let e=r.points,i=r.holes,s=t.points,o=t.indices;if(e.length>=6){Fg(e,!1);let n=[];for(let h=0;h<i.length;h++){let c=i[h];Fg(c.points,!0),n.push(e.length/2),e=e.concat(c.points)}let a=w.earcut(e,n,2);if(!a)return;let l=s.length/2;for(let h=0;h<a.length;h+=3)o.push(a[h]+l),o.push(a[h+1]+l),o.push(a[h+2]+l);for(let h=0;h<e.length;h++)s.push(e[h])}}};var bu={build(r){let t=r.shape,e=t.x,i=t.y,s=t.width,o=t.height,n=r.points;n.length=0,s>=0&&o>=0&&n.push(e,i,e+s,i,e+s,i+o,e,i+o)},triangulate(r,t){let e=r.points,i=t.points;if(e.length===0)return;let s=i.length/2;i.push(e[0],e[1],e[2],e[3],e[6],e[7],e[4],e[5]),t.indices.push(s,s+1,s+2,s+1,s+2,s+3)}};var Tu={build(r){Ni.build(r)},triangulate(r,t){Ni.triangulate(r,t)}};var se=(r=>(r.MITER="miter",r.BEVEL="bevel",r.ROUND="round",r))(se||{}),ze=(r=>(r.BUTT="butt",r.ROUND="round",r.SQUARE="square",r))(ze||{}),He={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(r,t=20){if(!this.adaptive||!r||isNaN(r))return t;let e=Math.ceil(r/this.maxLength);return e<this.minSegments?e=this.minSegments:e>this.maxSegments&&(e=this.maxSegments),e}};var Ui=class{static curveTo(t,e,i,s,o,n){let a=n[n.length-2],l=n[n.length-1]-e,h=a-t,c=s-e,u=i-t,d=Math.abs(l*u-h*c);if(d<1e-8||o===0)return(n[n.length-2]!==t||n[n.length-1]!==e)&&n.push(t,e),null;let p=l*l+h*h,f=c*c+u*u,m=l*c+h*u,g=o*Math.sqrt(p)/d,x=o*Math.sqrt(f)/d,b=g*m/p,y=x*m/f,_=g*u+x*h,L=g*c+x*l,W=h*(x+b),F=l*(x+b),B=u*(g+y),H=c*(g+y),Z=Math.atan2(F-L,W-_),O=Math.atan2(H-L,B-_);return{cx:_+t,cy:L+e,radius:o,startAngle:Z,endAngle:O,anticlockwise:h*c>u*l}}static arc(t,e,i,s,o,n,a,l,h){let c=a-n,u=He._segmentsCount(Math.abs(c)*o,Math.ceil(Math.abs(c)/Yr)*40),d=c/(u*2),p=d*2,f=Math.cos(d),m=Math.sin(d),g=u-1,x=g%1/g;for(let b=0;b<=g;++b){let y=b+x*b,_=d+n+p*y,L=Math.cos(_),W=-Math.sin(_);h.push((f*L+m*W)*o+i,(f*-W+m*L)*o+s)}}};var Ws=class{constructor(){this.reset()}begin(t,e,i){this.reset(),this.style=t,this.start=e,this.attribStart=i}end(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}};var Xs=class r{static curveLength(t,e,i,s,o,n,a,l){let h=0,c=0,u=0,d=0,p=0,f=0,m=0,g=0,x=0,b=0,y=0,_=t,L=e;for(let W=1;W<=10;++W)c=W/10,u=c*c,d=u*c,p=1-c,f=p*p,m=f*p,g=m*t+3*f*c*i+3*p*u*o+d*a,x=m*e+3*f*c*s+3*p*u*n+d*l,b=_-g,y=L-x,_=g,L=x,h+=Math.sqrt(b*b+y*y);return h}static curveTo(t,e,i,s,o,n,a){let l=a[a.length-2],h=a[a.length-1];a.length-=2;let c=He._segmentsCount(r.curveLength(l,h,t,e,i,s,o,n)),u=0,d=0,p=0,f=0,m=0;a.push(l,h);for(let g=1,x=0;g<=c;++g)x=g/c,u=1-x,d=u*u,p=d*u,f=x*x,m=f*x,a.push(p*l+3*d*x*t+3*u*f*i+m*o,p*h+3*d*x*e+3*u*f*s+m*n)}};function Dg(r,t,e,i,s,o,n,a){let l=r-e*s,h=t-i*s,c=r+e*o,u=t+i*o,d,p;n?(d=i,p=-e):(d=-i,p=e);let f=l+d,m=h+p,g=c+d,x=u+p;return a.push(f,m,g,x),2}function Gi(r,t,e,i,s,o,n,a){let l=e-r,h=i-t,c=Math.atan2(l,h),u=Math.atan2(s-r,o-t);a&&c<u?c+=Math.PI*2:!a&&c>u&&(u+=Math.PI*2);let d=c,p=u-c,f=Math.abs(p),m=Math.sqrt(l*l+h*h),g=(15*f*Math.sqrt(m)/Math.PI>>0)+1,x=p/g;if(d+=x,a){n.push(r,t,e,i);for(let b=1,y=d;b<g;b++,y+=x)n.push(r,t,r+Math.sin(y)*m,t+Math.cos(y)*m);n.push(r,t,s,o)}else{n.push(e,i,r,t);for(let b=1,y=d;b<g;b++,y+=x)n.push(r+Math.sin(y)*m,t+Math.cos(y)*m,r,t);n.push(s,o,r,t)}return g*2}function r1(r,t){let e=r.shape,i=r.points||e.points.slice(),s=t.closePointEps;if(i.length===0)return;let o=r.lineStyle,n=new $(i[0],i[1]),a=new $(i[i.length-2],i[i.length-1]),l=e.type!==gt.POLY||e.closeStroke,h=Math.abs(n.x-a.x)<s&&Math.abs(n.y-a.y)<s;if(l){i=i.slice(),h&&(i.pop(),i.pop(),a.set(i[i.length-2],i[i.length-1]));let A=(n.x+a.x)*.5,M=(a.y+n.y)*.5;i.unshift(A,M),i.push(A,M)}let c=t.points,u=i.length/2,d=i.length,p=c.length/2,f=o.width/2,m=f*f,g=o.miterLimit*o.miterLimit,x=i[0],b=i[1],y=i[2],_=i[3],L=0,W=0,F=-(b-_),B=x-y,H=0,Z=0,O=Math.sqrt(F*F+B*B);F/=O,B/=O,F*=f,B*=f;let G=o.alignment,E=(1-G)*2,P=G*2;l||(o.cap===ze.ROUND?d+=Gi(x-F*(E-P)*.5,b-B*(E-P)*.5,x-F*E,b-B*E,x+F*P,b+B*P,c,!0)+2:o.cap===ze.SQUARE&&(d+=Dg(x,b,F,B,E,P,!0,c))),c.push(x-F*E,b-B*E,x+F*P,b+B*P);for(let A=1;A<u-1;++A){x=i[(A-1)*2],b=i[(A-1)*2+1],y=i[A*2],_=i[A*2+1],L=i[(A+1)*2],W=i[(A+1)*2+1],F=-(b-_),B=x-y,O=Math.sqrt(F*F+B*B),F/=O,B/=O,F*=f,B*=f,H=-(_-W),Z=y-L,O=Math.sqrt(H*H+Z*Z),H/=O,Z/=O,H*=f,Z*=f;let M=y-x,k=b-_,V=y-L,ht=W-_,wt=M*V+k*ht,Mt=k*V-ht*M,Ct=Mt<0;if(Math.abs(Mt)<.001*Math.abs(wt)){c.push(y-F*E,_-B*E,y+F*P,_+B*P),wt>=0&&(o.join===se.ROUND?d+=Gi(y,_,y-F*E,_-B*E,y-H*E,_-Z*E,c,!1)+4:d+=2,c.push(y-H*P,_-Z*P,y+H*E,_+Z*E));continue}let Zt=(-F+x)*(-B+_)-(-F+y)*(-B+b),me=(-H+L)*(-Z+_)-(-H+y)*(-Z+W),ae=(M*me-V*Zt)/Mt,ge=(ht*Zt-k*me)/Mt,Dt=(ae-y)*(ae-y)+(ge-_)*(ge-_),Rt=y+(ae-y)*E,Bt=_+(ge-_)*E,Qt=y-(ae-y)*P,le=_-(ge-_)*P,go=Math.min(M*M+k*k,V*V+ht*ht),op=Ct?E:P,hy=go+op*op*m,cy=Dt<=hy,ra=o.join;if(ra===se.MITER&&Dt/m>g&&(ra=se.BEVEL),cy)switch(ra){case se.MITER:{c.push(Rt,Bt,Qt,le);break}case se.BEVEL:{Ct?c.push(Rt,Bt,y+F*P,_+B*P,Rt,Bt,y+H*P,_+Z*P):c.push(y-F*E,_-B*E,Qt,le,y-H*E,_-Z*E,Qt,le),d+=2;break}case se.ROUND:{Ct?(c.push(Rt,Bt,y+F*P,_+B*P),d+=Gi(y,_,y+F*P,_+B*P,y+H*P,_+Z*P,c,!0)+4,c.push(Rt,Bt,y+H*P,_+Z*P)):(c.push(y-F*E,_-B*E,Qt,le),d+=Gi(y,_,y-F*E,_-B*E,y-H*E,_-Z*E,c,!1)+4,c.push(y-H*E,_-Z*E,Qt,le));break}}else{switch(c.push(y-F*E,_-B*E,y+F*P,_+B*P),ra){case se.MITER:{Ct?c.push(Qt,le,Qt,le):c.push(Rt,Bt,Rt,Bt),d+=2;break}case se.ROUND:{Ct?d+=Gi(y,_,y+F*P,_+B*P,y+H*P,_+Z*P,c,!0)+2:d+=Gi(y,_,y-F*E,_-B*E,y-H*E,_-Z*E,c,!1)+2;break}}c.push(y-H*E,_-Z*E,y+H*P,_+Z*P),d+=2}}x=i[(u-2)*2],b=i[(u-2)*2+1],y=i[(u-1)*2],_=i[(u-1)*2+1],F=-(b-_),B=x-y,O=Math.sqrt(F*F+B*B),F/=O,B/=O,F*=f,B*=f,c.push(y-F*E,_-B*E,y+F*P,_+B*P),l||(o.cap===ze.ROUND?d+=Gi(y-F*(E-P)*.5,_-B*(E-P)*.5,y-F*E,_-B*E,y+F*P,_+B*P,c,!1)+2:o.cap===ze.SQUARE&&(d+=Dg(y,_,F,B,E,P,!1,c)));let J=t.indices,it=He.epsilon*He.epsilon;for(let A=p;A<d+p-2;++A)x=c[A*2],b=c[A*2+1],y=c[(A+1)*2],_=c[(A+1)*2+1],L=c[(A+2)*2],W=c[(A+2)*2+1],!(Math.abs(x*(_-W)+y*(W-b)+L*(b-_))<it)&&J.push(A,A+1,A+2)}function i1(r,t){let e=0,i=r.shape,s=r.points||i.points,o=i.type!==gt.POLY||i.closeStroke;if(s.length===0)return;let n=t.points,a=t.indices,l=s.length/2,h=n.length/2,c=h;for(n.push(s[0],s[1]),e=1;e<l;e++)n.push(s[e*2],s[e*2+1]),a.push(c,c+1),c++;o&&a.push(c,h)}function bn(r,t){r.lineStyle.native?i1(r,t):r1(r,t)}var $s=class r{static curveLength(t,e,i,s,o,n){let a=t-2*i+o,l=e-2*s+n,h=2*i-2*t,c=2*s-2*e,u=4*(a*a+l*l),d=4*(a*h+l*c),p=h*h+c*c,f=2*Math.sqrt(u+d+p),m=Math.sqrt(u),g=2*u*m,x=2*Math.sqrt(p),b=d/m;return(g*f+m*d*(f-x)+(4*p*u-d*d)*Math.log((2*m+b+f)/(b+x)))/(4*g)}static curveTo(t,e,i,s,o){let n=o[o.length-2],a=o[o.length-1],l=He._segmentsCount(r.curveLength(n,a,t,e,i,s)),h=0,c=0;for(let u=1;u<=l;++u){let d=u/l;h=n+(t-n)*d,c=a+(e-a)*d,o.push(h+(t+(i-t)*d-h)*d,c+(e+(s-e)*d-c)*d)}}};var Tn={[gt.POLY]:_n,[gt.CIRC]:Ni,[gt.ELIP]:Ni,[gt.RECT]:bu,[gt.RREC]:Tu},ml=[],Ys=[];var Ks=class r{constructor(t,e=null,i=null,s=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=i,this.fillStyle=e,this.matrix=s,this.type=t.type}clone(){return new r(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}};var qs=new $,Bg=class Lg extends vi{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new cr,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),Ys.push(this.drawCalls[t]);this.drawCalls.length=0;for(let t=0;t<this.batches.length;t++){let e=this.batches[t];e.reset(),ml.push(e)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(t,e=null,i=null,s=null){let o=new Ks(t,e,i,s);return this.graphicsData.push(o),this.dirty++,this}drawHole(t,e=null){if(!this.graphicsData.length)return null;let i=new Ks(t,null,null,e),s=this.graphicsData[this.graphicsData.length-1];return i.lineStyle=s.lineStyle,s.holes.push(i),this.dirty++,this}destroy(){super.destroy();for(let t=0;t<this.graphicsData.length;++t)this.graphicsData[t].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(t){let e=this.graphicsData;for(let i=0;i<e.length;++i){let s=e[i];if(s.fillStyle.visible&&s.shape&&(s.matrix?s.matrix.applyInverse(t,qs):qs.copyFrom(t),s.shape.contains(qs.x,qs.y))){let o=!1;if(s.holes){for(let n=0;n<s.holes.length;n++)if(s.holes[n].shape.contains(qs.x,qs.y)){o=!0;break}}if(!o)return!0}}return!1}updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return}if(!this.validateBatching())return;this.cacheDirty=this.dirty;let t=this.uvs,e=this.graphicsData,i=null,s=null;this.batches.length>0&&(i=this.batches[this.batches.length-1],s=i.style);for(let l=this.shapeIndex;l<e.length;l++){this.shapeIndex++;let h=e[l],c=h.fillStyle,u=h.lineStyle;Tn[h.type].build(h),h.matrix&&this.transformPoints(h.points,h.matrix),(c.visible||u.visible)&&this.processHoles(h.holes);for(let d=0;d<2;d++){let p=d===0?c:u;if(!p.visible)continue;let f=p.texture.baseTexture,m=this.indices.length,g=this.points.length/2;f.wrapMode=Ee.REPEAT,d===0?this.processFill(h):this.processLine(h);let x=this.points.length/2-g;x!==0&&(i&&!this._compareStyles(s,p)&&(i.end(m,g),i=null),i||(i=ml.pop()||new Ws,i.begin(p,m,g),this.batches.push(i),s=p),this.addUvs(this.points,t,p.texture,g,x,p.matrix))}}let o=this.indices.length,n=this.points.length/2;if(i&&i.end(o,n),this.batches.length===0){this.batchable=!0;return}let a=n>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&a===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=a?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(t,e){return!(!t||!e||t.texture.baseTexture!==e.texture.baseTexture||t.color+t.alpha!==e.color+e.alpha||!!t.native!=!!e.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let t=0,e=this.graphicsData.length;t<e;t++){let i=this.graphicsData[t],s=i.fillStyle,o=i.lineStyle;if(s&&!s.texture.baseTexture.valid||o&&!o.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);let t=this.batches;for(let e=0,i=t.length;e<i;e++){let s=t[e];for(let o=0;o<s.size;o++){let n=s.start+o;this.indicesUint16[n]=this.indicesUint16[n]-s.attribStart}}}isBatchable(){if(this.points.length>65535*2)return!1;let t=this.batches;for(let e=0;e<t.length;e++)if(t[e].style.native)return!1;return this.points.length<Lg.BATCHABLE_SIZE*2}buildDrawCalls(){let t=++K._globalBatch;for(let u=0;u<this.drawCalls.length;u++)this.drawCalls[u].texArray.clear(),Ys.push(this.drawCalls[u]);this.drawCalls.length=0;let e=this.colors,i=this.textureIds,s=Ys.pop();s||(s=new $r,s.texArray=new Kr),s.texArray.count=0,s.start=0,s.size=0,s.type=xe.TRIANGLES;let o=0,n=null,a=0,l=!1,h=xe.TRIANGLES,c=0;this.drawCalls.push(s);for(let u=0;u<this.batches.length;u++){let d=this.batches[u],p=8,f=d.style,m=f.texture.baseTexture;l!==!!f.native&&(l=!!f.native,h=l?xe.LINES:xe.TRIANGLES,n=null,o=p,t++),n!==m&&(n=m,m._batchEnabled!==t&&(o===p&&(t++,o=0,s.size>0&&(s=Ys.pop(),s||(s=new $r,s.texArray=new Kr),this.drawCalls.push(s)),s.start=c,s.size=0,s.texArray.count=0,s.type=h),m.touched=1,m._batchEnabled=t,m._batchLocation=o,m.wrapMode=Ee.REPEAT,s.texArray.elements[s.texArray.count++]=m,o++)),s.size+=d.size,c+=d.size,a=m._batchLocation,this.addColors(e,f.color,f.alpha,d.attribSize,d.attribStart),this.addTextureIds(i,a,d.attribSize,d.attribStart)}K._globalBatch=t,this.packAttributes()}packAttributes(){let t=this.points,e=this.uvs,i=this.colors,s=this.textureIds,o=new ArrayBuffer(t.length*3*4),n=new Float32Array(o),a=new Uint32Array(o),l=0;for(let h=0;h<t.length/2;h++)n[l++]=t[h*2],n[l++]=t[h*2+1],n[l++]=e[h*2],n[l++]=e[h*2+1],a[l++]=i[h],n[l++]=s[h];this._buffer.update(o),this._indexBuffer.update(this.indicesUint16)}processFill(t){t.holes.length?_n.triangulate(t,this):Tn[t.type].triangulate(t,this)}processLine(t){bn(t,this);for(let e=0;e<t.holes.length;e++)bn(t.holes[e],this)}processHoles(t){for(let e=0;e<t.length;e++){let i=t[e];Tn[i.type].build(i),i.matrix&&this.transformPoints(i.points,i.matrix)}}calculateBounds(){let t=this._bounds;t.clear(),t.addVertexData(this.points,0,this.points.length),t.pad(this.boundsPadding,this.boundsPadding)}transformPoints(t,e){for(let i=0;i<t.length/2;i++){let s=t[i*2],o=t[i*2+1];t[i*2]=e.a*s+e.c*o+e.tx,t[i*2+1]=e.b*s+e.d*o+e.ty}}addColors(t,e,i,s,o=0){let n=tt.shared.setValue(e).toLittleEndianNumber(),a=tt.shared.setValue(n).toPremultiplied(i);t.length=Math.max(t.length,o+s);for(let l=0;l<s;l++)t[o+l]=a}addTextureIds(t,e,i,s=0){t.length=Math.max(t.length,s+i);for(let o=0;o<i;o++)t[s+o]=e}addUvs(t,e,i,s,o,n=null){let a=0,l=e.length,h=i.frame;for(;a<o;){let u=t[(s+a)*2],d=t[(s+a)*2+1];if(n){let p=n.a*u+n.c*d+n.tx;d=n.b*u+n.d*d+n.ty,u=p}a++,e.push(u/h.width,d/h.height)}let c=i.baseTexture;(h.width<c.width||h.height<c.height)&&this.adjustUvs(e,i,l,o)}adjustUvs(t,e,i,s){let o=e.baseTexture,n=1e-6,a=i+s*2,l=e.frame,h=l.width/o.width,c=l.height/o.height,u=l.x/l.width,d=l.y/l.height,p=Math.floor(t[i]+n),f=Math.floor(t[i+1]+n);for(let m=i+2;m<a;m+=2)p=Math.min(p,Math.floor(t[m]+n)),f=Math.min(f,Math.floor(t[m+1]+n));u-=p,d-=f;for(let m=i;m<a;m+=2)t[m]=(t[m]+u)*h,t[m+1]=(t[m+1]+d)*c}};Bg.BATCHABLE_SIZE=100;var wu=Bg;var zi=class r{constructor(){this.color=16777215,this.alpha=1,this.texture=v.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){let t=new r;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=v.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}};var wn=class r extends zi{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=ze.BUTT,this.join=se.MITER,this.miterLimit=10}clone(){let t=new r;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1,this.cap=ze.BUTT,this.join=se.MITER,this.miterLimit=10}};var Cu={},Su=class gl extends D{constructor(t=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new zi,this._lineStyle=new wn,this._matrix=null,this._holeMode=!1,this.state=Gt.for2d(),this._geometry=t||new wu,this._geometry.refCount++,this._transformID=-1,this._tintColor=new tt(16777215),this.blendMode=q.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new gl(this._geometry)}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(t=null,e=0,i,s=.5,o=!1){return typeof t=="number"&&(t={width:t,color:e,alpha:i,alignment:s,native:o}),this.lineTextureStyle(t)}lineTextureStyle(t){let e={width:0,texture:v.WHITE,color:t?.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:ze.BUTT,join:se.MITER,miterLimit:10};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();let i=t.width>0&&t.alpha>0;return i?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:i},t)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){let t=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new ar,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[e-2],t[e-1]))}else this.currentPath=new ar,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(t,e){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=e,this}lineTo(t,e){this.currentPath||this.moveTo(0,0);let i=this.currentPath.points,s=i[i.length-2],o=i[i.length-1];return(s!==t||o!==e)&&i.push(t,e),this}_initCurve(t=0,e=0){this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[t,e]):this.moveTo(t,e)}quadraticCurveTo(t,e,i,s){this._initCurve();let o=this.currentPath.points;return o.length===0&&this.moveTo(0,0),$s.curveTo(t,e,i,s,o),this}bezierCurveTo(t,e,i,s,o,n){return this._initCurve(),Xs.curveTo(t,e,i,s,o,n,this.currentPath.points),this}arcTo(t,e,i,s,o){this._initCurve(t,e);let n=this.currentPath.points,a=Ui.curveTo(t,e,i,s,o,n);if(a){let{cx:l,cy:h,radius:c,startAngle:u,endAngle:d,anticlockwise:p}=a;this.arc(l,h,c,u,d,p)}return this}arc(t,e,i,s,o,n=!1){if(s===o)return this;if(!n&&o<=s?o+=Yr:n&&s<=o&&(s+=Yr),o-s===0)return this;let a=t+Math.cos(s)*i,l=e+Math.sin(s)*i,h=this._geometry.closePointEps,c=this.currentPath?this.currentPath.points:null;if(c){let u=Math.abs(c[c.length-2]-a),d=Math.abs(c[c.length-1]-l);u<h&&d<h||c.push(a,l)}else this.moveTo(a,l),c=this.currentPath.points;return Ui.arc(a,l,t,e,i,s,o,n,c),this}beginFill(t=0,e){return this.beginTextureFill({texture:v.WHITE,color:t,alpha:e})}normalizeColor(t){let e=tt.shared.setValue(t.color??0);t.color=e.toNumber(),t.alpha??(t.alpha=e.alpha)}beginTextureFill(t){let e={texture:v.WHITE,color:16777215,matrix:null};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();let i=t.alpha>0;return i?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:i},t)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(t,e,i,s){return this.drawShape(new Y(t,e,i,s))}drawRoundedRect(t,e,i,s,o){return this.drawShape(new Ts(t,e,i,s,o))}drawCircle(t,e,i){return this.drawShape(new _s(t,e,i))}drawEllipse(t,e,i,s){return this.drawShape(new bs(t,e,i,s))}drawPolygon(...t){let e,i=!0,s=t[0];s.points?(i=s.closeStroke,e=s.points):Array.isArray(t[0])?e=t[0]:e=t;let o=new ar(e);return o.closeStroke=i,this.drawShape(o),this}drawShape(t){return this._holeMode?this._geometry.drawHole(t,this._matrix):this._geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){let t=this._geometry.graphicsData;return t.length===1&&t[0].shape.type===gt.RECT&&!t[0].matrix&&!t[0].holes.length&&!(t[0].lineStyle.visible&&t[0].lineStyle.width)}_render(t){this.finishPoly();let e=this._geometry;e.updateBatches(),e.batchable?(this.batchDirty!==e.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))}_populateBatches(){let t=this._geometry,e=this.blendMode,i=t.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.batches.length=i,this.vertexData=new Float32Array(t.points);for(let s=0;s<i;s++){let o=t.batches[s],n=o.style.color,a=new Float32Array(this.vertexData.buffer,o.attribStart*4*2,o.attribSize*2),l=new Float32Array(t.uvsFloat32.buffer,o.attribStart*4*2,o.attribSize*2),h=new Uint16Array(t.indicesUint16.buffer,o.start*2,o.size),c={vertexData:a,blendMode:e,indices:h,uvs:l,_batchRGB:tt.shared.setValue(n).toRgbArray(),_tintRGB:n,_texture:o.style.texture,alpha:o.style.alpha,worldAlpha:1};this.batches[s]=c}}_renderBatched(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let e=0,i=this.batches.length;e<i;e++){let s=this.batches[e];s.worldAlpha=this.worldAlpha*s.alpha,t.plugins[this.pluginName].render(s)}}}_renderDirect(t){let e=this._resolveDirectShader(t),i=this._geometry,s=this.worldAlpha,o=e.uniforms,n=i.drawCalls;o.translationMatrix=this.transform.worldTransform,tt.shared.setValue(this._tintColor).premultiply(s).toArray(o.tint),t.shader.bind(e),t.geometry.bind(i,e),t.state.set(this.state);for(let a=0,l=n.length;a<l;a++)this._renderDrawCallDirect(t,i.drawCalls[a])}_renderDrawCallDirect(t,e){let{texArray:i,type:s,size:o,start:n}=e,a=i.count;for(let l=0;l<a;l++)t.texture.bind(i.elements[l],l);t.geometry.draw(s,o,n)}_resolveDirectShader(t){let e=this.shader,i=this.pluginName;if(!e){if(!Cu[i]){let{maxTextures:s}=t.plugins[i],o=new Int32Array(s);for(let l=0;l<s;l++)o[l]=l;let n={tint:new Float32Array([1,1,1,1]),translationMatrix:new ot,default:de.from({uSamplers:o},!0)},a=t.plugins[i]._shader.program;Cu[i]=new Xt(a,n)}e=Cu[i]}return e}_calculateBounds(){this.finishPoly();let t=this._geometry;if(!t.graphicsData.length)return;let{minX:e,minY:i,maxX:s,maxY:o}=t.bounds;this._bounds.addFrame(this.transform,e,i,s,o)}containsPoint(t){return this.worldTransform.applyInverse(t,gl._TEMP_POINT),this._geometry.containsPoint(gl._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let t=0;t<this.batches.length;t++){let e=this.batches[t];e._tintRGB=tt.shared.setValue(this._tintColor).multiply(e._batchRGB).toLittleEndianNumber()}}}calculateVertices(){let t=this.transform._worldID;if(this._transformID===t)return;this._transformID=t;let e=this.transform.worldTransform,i=e.a,s=e.b,o=e.c,n=e.d,a=e.tx,l=e.ty,h=this._geometry.points,c=this.vertexData,u=0;for(let d=0;d<h.length;d+=2){let p=h[d],f=h[d+1];c[u++]=i*p+o*f+a,c[u++]=n*f+s*p+l}}closePath(){let t=this.currentPath;return t&&(t.closeStroke=!0,this.finishPoly()),this}setMatrix(t){return this._matrix=t,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(t){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(t)}};Su.curves=He,Su._TEMP_POINT=new $;var ur=Su;var s1=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,o1=`
varying vec2 vTextureCoord;
uniform sampler2D uSampler;

uniform vec2 uOffset;

void main(void)
{
    vec4 color = vec4(0.0);

    // Sample top left pixel
    color += texture2D(uSampler, vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y + uOffset.y));

    // Sample top right pixel
    color += texture2D(uSampler, vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y + uOffset.y));

    // Sample bottom right pixel
    color += texture2D(uSampler, vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y - uOffset.y));

    // Sample bottom left pixel
    color += texture2D(uSampler, vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y - uOffset.y));

    // Average
    color *= 0.25;

    gl_FragColor = color;
}`,n1=`
varying vec2 vTextureCoord;
uniform sampler2D uSampler;

uniform vec2 uOffset;
uniform vec4 filterClamp;

void main(void)
{
    vec4 color = vec4(0.0);

    // Sample top left pixel
    color += texture2D(uSampler, clamp(vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y + uOffset.y), filterClamp.xy, filterClamp.zw));

    // Sample top right pixel
    color += texture2D(uSampler, clamp(vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y + uOffset.y), filterClamp.xy, filterClamp.zw));

    // Sample bottom right pixel
    color += texture2D(uSampler, clamp(vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y - uOffset.y), filterClamp.xy, filterClamp.zw));

    // Sample bottom left pixel
    color += texture2D(uSampler, clamp(vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y - uOffset.y), filterClamp.xy, filterClamp.zw));

    // Average
    color *= 0.25;

    gl_FragColor = color;
}
`,Jr=class extends z{constructor(t=4,e=3,i=!1){super(s1,i?n1:o1),this._kernels=[],this._blur=4,this._quality=3,this.uniforms.uOffset=new Float32Array(2),this._pixelSize=new $,this.pixelSize=1,this._clamp=i,Array.isArray(t)?this.kernels=t:(this._blur=t,this.quality=e)}apply(t,e,i,s){let o=this._pixelSize.x/e._frame.width,n=this._pixelSize.y/e._frame.height,a;if(this._quality===1||this._blur===0)a=this._kernels[0]+.5,this.uniforms.uOffset[0]=a*o,this.uniforms.uOffset[1]=a*n,t.applyFilter(this,e,i,s);else{let l=t.getFilterTexture(),h=e,c=l,u,d=this._quality-1;for(let p=0;p<d;p++)a=this._kernels[p]+.5,this.uniforms.uOffset[0]=a*o,this.uniforms.uOffset[1]=a*n,t.applyFilter(this,h,c,1),u=h,h=c,c=u;a=this._kernels[d]+.5,this.uniforms.uOffset[0]=a*o,this.uniforms.uOffset[1]=a*n,t.applyFilter(this,h,i,s),t.returnFilterTexture(l)}}_updatePadding(){this.padding=Math.ceil(this._kernels.reduce((t,e)=>t+e+.5,0))}_generateKernels(){let t=this._blur,e=this._quality,i=[t];if(t>0){let s=t,o=t/e;for(let n=1;n<e;n++)s-=o,i.push(s)}this._kernels=i,this._updatePadding()}get kernels(){return this._kernels}set kernels(t){Array.isArray(t)&&t.length>0?(this._kernels=t,this._quality=t.length,this._blur=Math.max(...t)):(this._kernels=[0],this._quality=1)}get clamp(){return this._clamp}set pixelSize(t){typeof t=="number"?(this._pixelSize.x=t,this._pixelSize.y=t):Array.isArray(t)?(this._pixelSize.x=t[0],this._pixelSize.y=t[1]):t instanceof $?(this._pixelSize.x=t.x,this._pixelSize.y=t.y):(this._pixelSize.x=1,this._pixelSize.y=1)}get pixelSize(){return this._pixelSize}get quality(){return this._quality}set quality(t){this._quality=Math.max(1,Math.round(t)),this._generateKernels()}get blur(){return this._blur}set blur(t){this._blur=t,this._generateKernels()}};var Og=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,a1=`
uniform sampler2D uSampler;
varying vec2 vTextureCoord;

uniform float threshold;

void main() {
    vec4 color = texture2D(uSampler, vTextureCoord);

    // A simple & fast algorithm for getting brightness.
    // It's inaccuracy , but good enought for this feature.
    float _max = max(max(color.r, color.g), color.b);
    float _min = min(min(color.r, color.g), color.b);
    float brightness = (_max + _min) * 0.5;

    if(brightness > threshold) {
        gl_FragColor = color;
    } else {
        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
    }
}
`,Eu=class extends z{constructor(t=.5){super(Og,a1),this.threshold=t}get threshold(){return this.uniforms.threshold}set threshold(t){this.uniforms.threshold=t}},l1=`uniform sampler2D uSampler;
varying vec2 vTextureCoord;

uniform sampler2D bloomTexture;
uniform float bloomScale;
uniform float brightness;

void main() {
    vec4 color = texture2D(uSampler, vTextureCoord);
    color.rgb *= brightness;
    vec4 bloomColor = vec4(texture2D(bloomTexture, vTextureCoord).rgb, 0.0);
    bloomColor.rgb *= bloomScale;
    gl_FragColor = color + bloomColor;
}
`,kg=class extends z{constructor(r){super(Og,l1),this.bloomScale=1,this.brightness=1,this._resolution=C.FILTER_RESOLUTION,typeof r=="number"&&(r={threshold:r});let t=Object.assign(kg.defaults,r);this.bloomScale=t.bloomScale,this.brightness=t.brightness;let{kernels:e,blur:i,quality:s,pixelSize:o,resolution:n}=t;this._extractFilter=new Eu(t.threshold),this._extractFilter.resolution=n,this._blurFilter=e?new Jr(e):new Jr(i,s),this.pixelSize=o,this.resolution=n}apply(r,t,e,i,s){let o=r.getFilterTexture();this._extractFilter.apply(r,t,o,1,s);let n=r.getFilterTexture();this._blurFilter.apply(r,o,n,1),this.uniforms.bloomScale=this.bloomScale,this.uniforms.brightness=this.brightness,this.uniforms.bloomTexture=n,r.applyFilter(this,t,e,i),r.returnFilterTexture(n),r.returnFilterTexture(o)}get resolution(){return this._resolution}set resolution(r){this._resolution=r,this._extractFilter&&(this._extractFilter.resolution=r),this._blurFilter&&(this._blurFilter.resolution=r)}get threshold(){return this._extractFilter.threshold}set threshold(r){this._extractFilter.threshold=r}get kernels(){return this._blurFilter.kernels}set kernels(r){this._blurFilter.kernels=r}get blur(){return this._blurFilter.blur}set blur(r){this._blurFilter.blur=r}get quality(){return this._blurFilter.quality}set quality(r){this._blurFilter.quality=r}get pixelSize(){return this._blurFilter.pixelSize}set pixelSize(r){this._blurFilter.pixelSize=r}},h1=kg;h1.defaults={threshold:.5,bloomScale:1,brightness:1,kernels:null,blur:8,quality:4,pixelSize:1,resolution:C.FILTER_RESOLUTION};var Ng=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uAlpha;

void main(void)
{
   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;
}
`;var Zs=class extends z{constructor(t=1){super(Wc,Ng,{uAlpha:1}),this.alpha=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}};var c1={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},u1=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join(`
`);function Ug(r){let t=c1[r],e=t.length,i=u1,s="",o="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;",n;for(let a=0;a<r;a++){let l=o.replace("%index%",a.toString());n=a,a>=e&&(n=r-a-1),l=l.replace("%value%",t[n].toString()),s+=l,s+=`
`}return i=i.replace("%blur%",s),i=i.replace("%size%",r.toString()),i}var d1=`
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function Gg(r,t){let e=Math.ceil(r/2),i=d1,s="",o;t?o="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":o="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let n=0;n<r;n++){let a=o.replace("%index%",n.toString());a=a.replace("%sampleIndex%",`${n-(e-1)}.0`),s+=a,s+=`
`}return i=i.replace("%blur%",s),i=i.replace("%size%",r.toString()),i}var Fr=class extends z{constructor(t,e=8,i=4,s=z.defaultResolution,o=5){let n=Gg(o,t),a=Ug(o);super(n,a),this.horizontal=t,this.resolution=s,this._quality=0,this.quality=i,this.blur=e}apply(t,e,i,s){if(i?this.horizontal?this.uniforms.strength=1/i.width*(i.width/e.width):this.uniforms.strength=1/i.height*(i.height/e.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/e.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/e.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)t.applyFilter(this,e,i,s);else{let o=t.getFilterTexture(),n=t.renderer,a=e,l=o;this.state.blend=!1,t.applyFilter(this,a,l,Ae.CLEAR);for(let h=1;h<this.passes-1;h++){t.bindAndClear(a,Ae.BLIT),this.uniforms.uSampler=l;let c=l;l=a,a=c,n.shader.bind(this),n.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,l,i,s),t.returnFilterTexture(o)}}get blur(){return this.strength}set blur(t){this.padding=1+Math.abs(t)*2,this.strength=t}get quality(){return this._quality}set quality(t){this._quality=t,this.passes=t}};var Cn=class extends z{constructor(t=8,e=4,i=z.defaultResolution,s=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new Fr(!0,t,e,i,s),this.blurYFilter=new Fr(!1,t,e,i,s),this.resolution=i,this.quality=e,this.blur=t,this.repeatEdgePixels=!1}apply(t,e,i,s){let o=Math.abs(this.blurXFilter.strength),n=Math.abs(this.blurYFilter.strength);if(o&&n){let a=t.getFilterTexture();this.blurXFilter.apply(t,e,a,Ae.CLEAR),this.blurYFilter.apply(t,a,i,s),t.returnFilterTexture(a)}else n?this.blurYFilter.apply(t,e,i,s):this.blurXFilter.apply(t,e,i,s)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2}get blur(){return this.blurXFilter.blur}set blur(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(t){this.blurXFilter.quality=this.blurYFilter.quality=t}get blurX(){return this.blurXFilter.blur}set blurX(t){this.blurXFilter.blur=t,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(t){this.blurYFilter.blur=t,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(t){this.blurYFilter.blendMode=t}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(t){this._repeatEdgePixels=t,this.updatePadding()}};var p1=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,f1=`uniform float radius;
uniform float strength;
uniform vec2 center;
uniform sampler2D uSampler;
varying vec2 vTextureCoord;

uniform vec4 filterArea;
uniform vec4 filterClamp;
uniform vec2 dimensions;

void main()
{
    vec2 coord = vTextureCoord * filterArea.xy;
    coord -= center * dimensions.xy;
    float distance = length(coord);
    if (distance < radius) {
        float percent = distance / radius;
        if (strength > 0.0) {
            coord *= mix(1.0, smoothstep(0.0, radius / distance, percent), strength * 0.75);
        } else {
            coord *= mix(1.0, pow(percent, 1.0 + strength * 0.75) * radius / distance, 1.0 - percent);
        }
    }
    coord += center * dimensions.xy;
    coord /= filterArea.xy;
    vec2 clampedCoord = clamp(coord, filterClamp.xy, filterClamp.zw);
    vec4 color = texture2D(uSampler, clampedCoord);
    if (coord != clampedCoord) {
        color *= max(0.0, 1.0 - length(coord - clampedCoord));
    }

    gl_FragColor = color;
}
`,zg=class extends z{constructor(r){super(p1,f1),this.uniforms.dimensions=new Float32Array(2),Object.assign(this,zg.defaults,r)}apply(r,t,e,i){let{width:s,height:o}=t.filterFrame;this.uniforms.dimensions[0]=s,this.uniforms.dimensions[1]=o,r.applyFilter(this,t,e,i)}get radius(){return this.uniforms.radius}set radius(r){this.uniforms.radius=r}get strength(){return this.uniforms.strength}set strength(r){this.uniforms.strength=r}get center(){return this.uniforms.center}set center(r){this.uniforms.center=r}},m1=zg;m1.defaults={center:[.5,.5],radius:100,strength:1};var g1=`const float PI = 3.1415926538;
const float PI_2 = PI*2.;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;
uniform sampler2D uSampler;

const int TYPE_LINEAR = 0;
const int TYPE_RADIAL = 1;
const int TYPE_CONIC = 2;
const int MAX_STOPS = 32;

uniform int uNumStops;
uniform float uAlphas[3*MAX_STOPS];
uniform vec3 uColors[MAX_STOPS];
uniform float uOffsets[MAX_STOPS];
uniform int uType;
uniform float uAngle;
uniform float uAlpha;
uniform int uMaxColors;

struct ColorStop {
    float offset;
    vec3 color;
    float alpha;
};

mat2 rotate2d(float angle){
    return mat2(cos(angle), -sin(angle),
    sin(angle), cos(angle));
}

float projectLinearPosition(vec2 pos, float angle){
    vec2 center = vec2(0.5);
    vec2 result = pos - center;
    result = rotate2d(angle) * result;
    result = result + center;
    return clamp(result.x, 0., 1.);
}

float projectRadialPosition(vec2 pos) {
    float r = distance(vFilterCoord, vec2(0.5));
    return clamp(2.*r, 0., 1.);
}

float projectAnglePosition(vec2 pos, float angle) {
    vec2 center = pos - vec2(0.5);
    float polarAngle=atan(-center.y, center.x);
    return mod(polarAngle + angle, PI_2) / PI_2;
}

float projectPosition(vec2 pos, int type, float angle) {
    if (type == TYPE_LINEAR) {
        return projectLinearPosition(pos, angle);
    } else if (type == TYPE_RADIAL) {
        return projectRadialPosition(pos);
    } else if (type == TYPE_CONIC) {
        return projectAnglePosition(pos, angle);
    }

    return pos.y;
}

void main(void) {
    // current/original color
    vec4 currentColor = texture2D(uSampler, vTextureCoord);

    // skip calculations if gradient alpha is 0
    if (0.0 == uAlpha) {
        gl_FragColor = currentColor;
        return;
    }

    // project position
    float y = projectPosition(vFilterCoord, uType, radians(uAngle));

    // check gradient bounds
    float offsetMin = uOffsets[0];
    float offsetMax = 0.0;

    for (int i = 0; i < MAX_STOPS; i++) {
        if (i == uNumStops-1){ // last index
            offsetMax = uOffsets[i];
        }
    }

    if (y  < offsetMin || y > offsetMax) {
        gl_FragColor = currentColor;
        return;
    }

    // limit colors
    if (uMaxColors > 0) {
        float stepSize = 1./float(uMaxColors);
        float stepNumber = float(floor(y/stepSize));
        y = stepSize * (stepNumber + 0.5);// offset by 0.5 to use color from middle of segment
    }

    // find color stops
    ColorStop from;
    ColorStop to;

    for (int i = 0; i < MAX_STOPS; i++) {
        if (y >= uOffsets[i]) {
            from = ColorStop(uOffsets[i], uColors[i], uAlphas[i]);
            to = ColorStop(uOffsets[i+1], uColors[i+1], uAlphas[i+1]);
        }

        if (i == uNumStops-1){ // last index
            break;
        }
    }

    // mix colors from stops
    vec4 colorFrom = vec4(from.color * from.alpha, from.alpha);
    vec4 colorTo = vec4(to.color * to.alpha, to.alpha);

    float segmentHeight = to.offset - from.offset;
    float relativePos = y - from.offset;// position from 0 to [segmentHeight]
    float relativePercent = relativePos / segmentHeight;// position in percent between [from.offset] and [to.offset].

    float gradientAlpha = uAlpha * currentColor.a;
    vec4 gradientColor = mix(colorFrom, colorTo, relativePercent) * gradientAlpha;

    // mix resulting color with current color
    gl_FragColor = gradientColor + currentColor*(1.-gradientColor.a);
}
`,x1=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform vec4 inputSize;
uniform vec4 outputFrame;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
    vFilterCoord = vTextureCoord * inputSize.xy / outputFrame.zw;
}
`,Hi=Hi||{};Hi.stringify=function(){var r={"visit_linear-gradient":function(t){return r.visit_gradient(t)},"visit_repeating-linear-gradient":function(t){return r.visit_gradient(t)},"visit_radial-gradient":function(t){return r.visit_gradient(t)},"visit_repeating-radial-gradient":function(t){return r.visit_gradient(t)},visit_gradient:function(t){var e=r.visit(t.orientation);return e&&(e+=", "),t.type+"("+e+r.visit(t.colorStops)+")"},visit_shape:function(t){var e=t.value,i=r.visit(t.at),s=r.visit(t.style);return s&&(e+=" "+s),i&&(e+=" at "+i),e},"visit_default-radial":function(t){var e="",i=r.visit(t.at);return i&&(e+=i),e},"visit_extent-keyword":function(t){var e=t.value,i=r.visit(t.at);return i&&(e+=" at "+i),e},"visit_position-keyword":function(t){return t.value},visit_position:function(t){return r.visit(t.value.x)+" "+r.visit(t.value.y)},"visit_%":function(t){return t.value+"%"},visit_em:function(t){return t.value+"em"},visit_px:function(t){return t.value+"px"},visit_literal:function(t){return r.visit_color(t.value,t)},visit_hex:function(t){return r.visit_color("#"+t.value,t)},visit_rgb:function(t){return r.visit_color("rgb("+t.value.join(", ")+")",t)},visit_rgba:function(t){return r.visit_color("rgba("+t.value.join(", ")+")",t)},visit_color:function(t,e){var i=t,s=r.visit(e.length);return s&&(i+=" "+s),i},visit_angular:function(t){return t.value+"deg"},visit_directional:function(t){return"to "+t.value},visit_array:function(t){var e="",i=t.length;return t.forEach(function(s,o){e+=r.visit(s),o<i-1&&(e+=", ")}),e},visit:function(t){if(!t)return"";var e="";if(t instanceof Array)return r.visit_array(t,e);if(t.type){var i=r["visit_"+t.type];if(i)return i(t);throw Error("Missing visitor visit_"+t.type)}else throw Error("Invalid node.")}};return function(t){return r.visit(t)}}();var Hi=Hi||{};Hi.parse=function(){var r={linearGradient:/^(\-(webkit|o|ms|moz)\-)?(linear\-gradient)/i,repeatingLinearGradient:/^(\-(webkit|o|ms|moz)\-)?(repeating\-linear\-gradient)/i,radialGradient:/^(\-(webkit|o|ms|moz)\-)?(radial\-gradient)/i,repeatingRadialGradient:/^(\-(webkit|o|ms|moz)\-)?(repeating\-radial\-gradient)/i,sideOrCorner:/^to (left (top|bottom)|right (top|bottom)|left|right|top|bottom)/i,extentKeywords:/^(closest\-side|closest\-corner|farthest\-side|farthest\-corner|contain|cover)/,positionKeywords:/^(left|center|right|top|bottom)/i,pixelValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))px/,percentageValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))\%/,emValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))em/,angleValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,startCall:/^\(/,endCall:/^\)/,comma:/^,/,hexColor:/^\#([0-9a-fA-F]+)/,literalColor:/^([a-zA-Z]+)/,rgbColor:/^rgb/i,rgbaColor:/^rgba/i,number:/^(([0-9]*\.[0-9]+)|([0-9]+\.?))/},t="";function e(A){var M=new Error(t+": "+A);throw M.source=t,M}function i(){var A=s();return t.length>0&&e("Invalid input not EOF"),A}function s(){return y(o)}function o(){return n("linear-gradient",r.linearGradient,l)||n("repeating-linear-gradient",r.repeatingLinearGradient,l)||n("radial-gradient",r.radialGradient,u)||n("repeating-radial-gradient",r.repeatingRadialGradient,u)}function n(A,M,k){return a(M,function(V){var ht=k();return ht&&(J(r.comma)||e("Missing comma before color stops")),{type:A,orientation:ht,colorStops:y(_)}})}function a(A,M){var k=J(A);if(k){J(r.startCall)||e("Missing (");var V=M(k);return J(r.endCall)||e("Missing )"),V}}function l(){return h()||c()}function h(){return P("directional",r.sideOrCorner,1)}function c(){return P("angular",r.angleValue,1)}function u(){var A,M=d(),k;return M&&(A=[],A.push(M),k=t,J(r.comma)&&(M=d(),M?A.push(M):t=k)),A}function d(){var A=p()||f();if(A)A.at=g();else{var M=m();if(M){A=M;var k=g();k&&(A.at=k)}else{var V=x();V&&(A={type:"default-radial",at:V})}}return A}function p(){var A=P("shape",/^(circle)/i,0);return A&&(A.style=E()||m()),A}function f(){var A=P("shape",/^(ellipse)/i,0);return A&&(A.style=O()||m()),A}function m(){return P("extent-keyword",r.extentKeywords,1)}function g(){if(P("position",/^at/,0)){var A=x();return A||e("Missing positioning value"),A}}function x(){var A=b();if(A.x||A.y)return{type:"position",value:A}}function b(){return{x:O(),y:O()}}function y(A){var M=A(),k=[];if(M)for(k.push(M);J(r.comma);)M=A(),M?k.push(M):e("One extra comma");return k}function _(){var A=L();return A||e("Expected color definition"),A.length=O(),A}function L(){return F()||H()||B()||W()}function W(){return P("literal",r.literalColor,0)}function F(){return P("hex",r.hexColor,1)}function B(){return a(r.rgbColor,function(){return{type:"rgb",value:y(Z)}})}function H(){return a(r.rgbaColor,function(){return{type:"rgba",value:y(Z)}})}function Z(){return J(r.number)[1]}function O(){return P("%",r.percentageValue,1)||G()||E()}function G(){return P("position-keyword",r.positionKeywords,1)}function E(){return P("px",r.pixelValue,1)||P("em",r.emValue,1)}function P(A,M,k){var V=J(M);if(V)return{type:A,value:V[k]}}function J(A){var M,k;return k=/^[\n\r\t\s]+/.exec(t),k&&it(k[0].length),M=A.exec(t),M&&it(M[0].length),M}function it(A){t=t.substr(A)}return function(A){return t=A.toString(),i()}}();var y1=Hi.parse;Hi.stringify;var Hg={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},Vg={red:0,orange:60,yellow:120,green:180,blue:240,purple:300};function v1(r){var t,e=[],i=1,s;if(typeof r=="string")if(Hg[r])e=Hg[r].slice(),s="rgb";else if(r==="transparent")i=0,s="rgb",e=[0,0,0];else if(/^#[A-Fa-f0-9]+$/.test(r)){var o=r.slice(1),n=o.length,a=n<=4;i=1,a?(e=[parseInt(o[0]+o[0],16),parseInt(o[1]+o[1],16),parseInt(o[2]+o[2],16)],n===4&&(i=parseInt(o[3]+o[3],16)/255)):(e=[parseInt(o[0]+o[1],16),parseInt(o[2]+o[3],16),parseInt(o[4]+o[5],16)],n===8&&(i=parseInt(o[6]+o[7],16)/255)),e[0]||(e[0]=0),e[1]||(e[1]=0),e[2]||(e[2]=0),s="rgb"}else if(t=/^((?:rgb|hs[lvb]|hwb|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms)a?)\s*\(([^\)]*)\)/.exec(r)){var l=t[1],h=l==="rgb",o=l.replace(/a$/,"");s=o;var n=o==="cmyk"?4:o==="gray"?1:3;e=t[2].trim().split(/\s*[,\/]\s*|\s+/).map(function(d,p){if(/%$/.test(d))return p===n?parseFloat(d)/100:o==="rgb"?parseFloat(d)*255/100:parseFloat(d);if(o[p]==="h"){if(/deg$/.test(d))return parseFloat(d);if(Vg[d]!==void 0)return Vg[d]}return parseFloat(d)}),l===o&&e.push(1),i=h||e[n]===void 0?1:e[n],e=e.slice(0,n)}else r.length>10&&/[0-9](?:\s|\/)/.test(r)&&(e=r.match(/([0-9]+)/g).map(function(c){return parseFloat(c)}),s=r.match(/([a-z])/ig).join("").toLowerCase());else isNaN(r)?Array.isArray(r)||r.length?(e=[r[0],r[1],r[2]],s="rgb",i=r.length===4?r[3]:1):r instanceof Object&&(r.r!=null||r.red!=null||r.R!=null?(s="rgb",e=[r.r||r.red||r.R||0,r.g||r.green||r.G||0,r.b||r.blue||r.B||0]):(s="hsl",e=[r.h||r.hue||r.H||0,r.s||r.saturation||r.S||0,r.l||r.lightness||r.L||r.b||r.brightness]),i=r.a||r.alpha||r.opacity||1,r.opacity!=null&&(i/=100)):(s="rgb",e=[r>>>16,(r&65280)>>>8,r&255]);return{space:s,values:e,alpha:i}}var Iu={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]},Au={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(r){var t=r[0]/360,e=r[1]/100,i=r[2]/100,s,o,n,a,l;if(e===0)return l=i*255,[l,l,l];i<.5?o=i*(1+e):o=i+e-i*e,s=2*i-o,a=[0,0,0];for(var h=0;h<3;h++)n=t+1/3*-(h-1),n<0?n++:n>1&&n--,6*n<1?l=s+(o-s)*6*n:2*n<1?l=o:3*n<2?l=s+(o-s)*(2/3-n)*6:l=s,a[h]=l*255;return a}};Iu.hsl=function(r){var t=r[0]/255,e=r[1]/255,i=r[2]/255,s=Math.min(t,e,i),o=Math.max(t,e,i),n=o-s,a,l,h;return o===s?a=0:t===o?a=(e-i)/n:e===o?a=2+(i-t)/n:i===o&&(a=4+(t-e)/n),a=Math.min(a*60,360),a<0&&(a+=360),h=(s+o)/2,o===s?l=0:h<=.5?l=n/(o+s):l=n/(2-o-s),[a,l*100,h*100]};function _1(r){Array.isArray(r)&&r.raw&&(r=String.raw(...arguments));var t,e=v1(r);if(!e.space)return[];let i=e.space[0]==="h"?Au.min:Iu.min,s=e.space[0]==="h"?Au.max:Iu.max;return t=Array(3),t[0]=Math.min(Math.max(e.values[0],i[0]),s[0]),t[1]=Math.min(Math.max(e.values[1],i[1]),s[1]),t[2]=Math.min(Math.max(e.values[2],i[2]),s[2]),e.space[0]==="h"&&(t=Au.rgb(t)),t.push(Math.min(Math.max(e.alpha,0),1)),t}function $g(r){switch(typeof r){case"string":return b1(r);case"number":return w.hex2rgb(r);default:return r}}function b1(r){let t=_1(r);if(!t)throw new Error(`Unable to parse color "${r}" as RGBA.`);return[t[0]/255,t[1]/255,t[2]/255,t[3]]}function T1(r){let t=y1(R1(r));if(t.length===0)throw new Error("Invalid CSS gradient.");if(t.length!==1)throw new Error("Unsupported CSS gradient (multiple gradients is not supported).");let e=t[0],i=w1(e.type),s=C1(e.colorStops),o=I1(e.orientation);return{type:i,stops:s,angle:o}}function w1(r){let t={"linear-gradient":0,"radial-gradient":1};if(!(r in t))throw new Error(`Unsupported gradient type "${r}"`);return t[r]}function C1(r){let t=A1(r),e=[];for(let i=0;i<r.length;i++){let s=S1(r[i]);e.push({offset:t[i],color:s.slice(0,3),alpha:s[3]})}return e}function S1(r){return $g(E1(r))}function E1(r){switch(r.type){case"hex":return`#${r.value}`;case"literal":return r.value;default:return`${r.type}(${r.value.join(",")})`}}function A1(r){let t=[];for(let s=0;s<r.length;s++){let o=r[s],n=-1;o.type==="literal"&&o.length&&"type"in o.length&&o.length.type==="%"&&"value"in o.length&&(n=parseFloat(o.length.value)/100),t.push(n)}let e=s=>{for(let o=s;o<t.length;o++)if(t[o]!==-1)return{indexDelta:o-s,offset:t[o]};return{indexDelta:t.length-1-s,offset:1}},i=0;for(let s=0;s<t.length;s++){let o=t[s];if(o!==-1)i=o;else if(s===0)t[s]=0;else if(s+1===t.length)t[s]=1;else{let n=e(s),a=(n.offset-i)/(1+n.indexDelta);for(let l=0;l<=n.indexDelta;l++)t[s+l]=i+(l+1)*a;s+=n.indexDelta,i=t[s]}}return t.map(P1)}function P1(r){return r.toString().length>6?parseFloat(r.toString().substring(0,6)):r}function I1(r){if(typeof r>"u")return 0;if("type"in r&&"value"in r)switch(r.type){case"angular":return parseFloat(r.value);case"directional":return M1(r.value)}return 0}function M1(r){let t={left:270,top:0,bottom:180,right:90,"left top":315,"top left":315,"left bottom":225,"bottom left":225,"right top":45,"top right":45,"right bottom":135,"bottom right":135};if(!(r in t))throw new Error(`Unsupported directional value "${r}"`);return t[r]}function R1(r){let t=r.replace(/\s{2,}/gu," ");return t=t.replace(/;/g,""),t=t.replace(/ ,/g,","),t=t.replace(/\( /g,"("),t=t.replace(/ \)/g,")"),t.trim()}var F1=Object.defineProperty,D1=Object.defineProperties,B1=Object.getOwnPropertyDescriptors,jg=Object.getOwnPropertySymbols,L1=Object.prototype.hasOwnProperty,O1=Object.prototype.propertyIsEnumerable,Wg=(r,t,e)=>t in r?F1(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,Pu=(r,t)=>{for(var e in t||(t={}))L1.call(t,e)&&Wg(r,e,t[e]);if(jg)for(var e of jg(t))O1.call(t,e)&&Wg(r,e,t[e]);return r},k1=(r,t)=>D1(r,B1(t)),Xg=90;function N1(r){return[...r].sort((t,e)=>t.offset-e.offset)}var Mu=class extends z{constructor(r){r&&"css"in r&&(r=k1(Pu({},T1(r.css||"")),{alpha:r.alpha,maxColors:r.maxColors}));let t=Pu(Pu({},Mu.defaults),r);if(!t.stops||t.stops.length<2)throw new Error("ColorGradientFilter requires at least 2 color stops.");super(x1,g1),this._stops=[],this.autoFit=!1,Object.assign(this,t)}get stops(){return this._stops}set stops(r){let t=N1(r),e=new Float32Array(t.length*3),i=0,s=1,o=2;for(let n=0;n<t.length;n++){let a=$g(t[n].color),l=n*3;e[l+i]=a[i],e[l+s]=a[s],e[l+o]=a[o]}this.uniforms.uColors=e,this.uniforms.uOffsets=t.map(n=>n.offset),this.uniforms.uAlphas=t.map(n=>n.alpha),this.uniforms.uNumStops=t.length,this._stops=t}set type(r){this.uniforms.uType=r}get type(){return this.uniforms.uType}set angle(r){this.uniforms.uAngle=r-Xg}get angle(){return this.uniforms.uAngle+Xg}set alpha(r){this.uniforms.uAlpha=r}get alpha(){return this.uniforms.uAlpha}set maxColors(r){this.uniforms.uMaxColors=r}get maxColors(){return this.uniforms.uMaxColors}},xl=Mu;xl.LINEAR=0,xl.RADIAL=1,xl.CONIC=2,xl.defaults={type:Mu.LINEAR,stops:[{offset:0,color:16711680,alpha:1},{offset:1,color:255,alpha:1}],alpha:1,angle:90,maxColors:0};var U1=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,G1=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;

uniform vec4 filterArea;
uniform vec2 dimensions;

const float SQRT_2 = 1.414213;

const float light = 1.0;

uniform float curvature;
uniform float lineWidth;
uniform float lineContrast;
uniform bool verticalLine;
uniform float noise;
uniform float noiseSize;

uniform float vignetting;
uniform float vignettingAlpha;
uniform float vignettingBlur;

uniform float seed;
uniform float time;

float rand(vec2 co) {
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main(void)
{
    vec2 pixelCoord = vTextureCoord.xy * filterArea.xy;
    vec2 dir = vec2(vTextureCoord.xy * filterArea.xy / dimensions - vec2(0.5, 0.5));
    
    gl_FragColor = texture2D(uSampler, vTextureCoord);
    vec3 rgb = gl_FragColor.rgb;

    if (noise > 0.0 && noiseSize > 0.0)
    {
        pixelCoord.x = floor(pixelCoord.x / noiseSize);
        pixelCoord.y = floor(pixelCoord.y / noiseSize);
        float _noise = rand(pixelCoord * noiseSize * seed) - 0.5;
        rgb += _noise * noise;
    }

    if (lineWidth > 0.0)
    {
        float _c = curvature > 0. ? curvature : 1.;
        float k = curvature > 0. ?(length(dir * dir) * 0.25 * _c * _c + 0.935 * _c) : 1.;
        vec2 uv = dir * k;

        float v = (verticalLine ? uv.x * dimensions.x : uv.y * dimensions.y) * min(1.0, 2.0 / lineWidth ) / _c;
        float j = 1. + cos(v * 1.2 - time) * 0.5 * lineContrast;
        rgb *= j;
        float segment = verticalLine ? mod((dir.x + .5) * dimensions.x, 4.) : mod((dir.y + .5) * dimensions.y, 4.);
        rgb *= 0.99 + ceil(segment) * 0.015;
    }

    if (vignetting > 0.0)
    {
        float outter = SQRT_2 - vignetting * SQRT_2;
        float darker = clamp((outter - length(dir) * SQRT_2) / ( 0.00001 + vignettingBlur * SQRT_2), 0.0, 1.0);
        rgb *= darker + (1.0 - darker) * (1.0 - vignettingAlpha);
    }

    gl_FragColor.rgb = rgb;
}
`,Yg=class extends z{constructor(r){super(U1,G1),this.time=0,this.seed=0,this.uniforms.dimensions=new Float32Array(2),Object.assign(this,Yg.defaults,r)}apply(r,t,e,i){let{width:s,height:o}=t.filterFrame;this.uniforms.dimensions[0]=s,this.uniforms.dimensions[1]=o,this.uniforms.seed=this.seed,this.uniforms.time=this.time,r.applyFilter(this,t,e,i)}set curvature(r){this.uniforms.curvature=r}get curvature(){return this.uniforms.curvature}set lineWidth(r){this.uniforms.lineWidth=r}get lineWidth(){return this.uniforms.lineWidth}set lineContrast(r){this.uniforms.lineContrast=r}get lineContrast(){return this.uniforms.lineContrast}set verticalLine(r){this.uniforms.verticalLine=r}get verticalLine(){return this.uniforms.verticalLine}set noise(r){this.uniforms.noise=r}get noise(){return this.uniforms.noise}set noiseSize(r){this.uniforms.noiseSize=r}get noiseSize(){return this.uniforms.noiseSize}set vignetting(r){this.uniforms.vignetting=r}get vignetting(){return this.uniforms.vignetting}set vignettingAlpha(r){this.uniforms.vignettingAlpha=r}get vignettingAlpha(){return this.uniforms.vignettingAlpha}set vignettingBlur(r){this.uniforms.vignettingBlur=r}get vignettingBlur(){return this.uniforms.vignettingBlur}},z1=Yg;z1.defaults={curvature:1,lineWidth:1,lineContrast:.25,verticalLine:!1,noise:0,noiseSize:1,seed:0,vignetting:.3,vignettingAlpha:1,vignettingBlur:.3,time:0};var H1=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,V1=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float alpha;
uniform vec3 color;

uniform vec2 shift;
uniform vec4 inputSize;

void main(void){
    vec4 sample = texture2D(uSampler, vTextureCoord - shift * inputSize.zw);

    // Premultiply alpha
    sample.rgb = color.rgb * sample.a;

    // alpha user alpha
    sample *= alpha;

    gl_FragColor = sample;
}`,j1=Object.defineProperty,Kg=Object.getOwnPropertySymbols,W1=Object.prototype.hasOwnProperty,X1=Object.prototype.propertyIsEnumerable,qg=(r,t,e)=>t in r?j1(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,Zg=(r,t)=>{for(var e in t||(t={}))W1.call(t,e)&&qg(r,e,t[e]);if(Kg)for(var e of Kg(t))X1.call(t,e)&&qg(r,e,t[e]);return r},Ru=class extends z{constructor(r){super(),this.angle=45,this._distance=5,this._resolution=C.FILTER_RESOLUTION;let t=r?Zg(Zg({},Ru.defaults),r):Ru.defaults,{kernels:e,blur:i,quality:s,pixelSize:o,resolution:n}=t;this._offset=new re(this._updatePadding,this),this._tintFilter=new z(H1,V1),this._tintFilter.uniforms.color=new Float32Array(4),this._tintFilter.uniforms.shift=this._offset,this._tintFilter.resolution=n,this._blurFilter=e?new Jr(e):new Jr(i,s),this.pixelSize=o,this.resolution=n;let{shadowOnly:a,rotation:l,distance:h,offset:c,alpha:u,color:d}=t;this.shadowOnly=a,l!==void 0&&h!==void 0?(this.rotation=l,this.distance=h):this.offset=c,this.alpha=u,this.color=d}apply(r,t,e,i){let s=r.getFilterTexture();this._tintFilter.apply(r,t,s,1),this._blurFilter.apply(r,s,e,i),this.shadowOnly!==!0&&r.applyFilter(this,t,e,0),r.returnFilterTexture(s)}_updatePadding(){let r=Math.max(Math.abs(this._offset.x),Math.abs(this._offset.y));this.padding=r+this.blur*2}_updateShift(){this._tintFilter.uniforms.shift.set(this.distance*Math.cos(this.angle),this.distance*Math.sin(this.angle))}set offset(r){this._offset.copyFrom(r),this._updatePadding()}get offset(){return this._offset}get resolution(){return this._resolution}set resolution(r){this._resolution=r,this._tintFilter&&(this._tintFilter.resolution=r),this._blurFilter&&(this._blurFilter.resolution=r)}get distance(){return this._distance}set distance(r){w.deprecation("5.3.0","DropShadowFilter distance is deprecated, use offset"),this._distance=r,this._updatePadding(),this._updateShift()}get rotation(){return this.angle/$e}set rotation(r){w.deprecation("5.3.0","DropShadowFilter rotation is deprecated, use offset"),this.angle=r*$e,this._updateShift()}get alpha(){return this._tintFilter.uniforms.alpha}set alpha(r){this._tintFilter.uniforms.alpha=r}get color(){return w.rgb2hex(this._tintFilter.uniforms.color)}set color(r){w.hex2rgb(r,this._tintFilter.uniforms.color)}get kernels(){return this._blurFilter.kernels}set kernels(r){this._blurFilter.kernels=r}get blur(){return this._blurFilter.blur}set blur(r){this._blurFilter.blur=r,this._updatePadding()}get quality(){return this._blurFilter.quality}set quality(r){this._blurFilter.quality=r}get pixelSize(){return this._blurFilter.pixelSize}set pixelSize(r){this._blurFilter.pixelSize=r}},Vi=Ru;Vi.defaults={offset:{x:4,y:4},color:0,alpha:.5,shadowOnly:!1,kernels:null,blur:2,quality:3,pixelSize:1,resolution:C.FILTER_RESOLUTION};var $1=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,Y1=`// precision highp float;

varying vec2 vTextureCoord;
uniform sampler2D uSampler;

uniform vec4 filterArea;
uniform vec4 filterClamp;
uniform vec2 dimensions;
uniform float aspect;

uniform sampler2D displacementMap;
uniform float offset;
uniform float sinDir;
uniform float cosDir;
uniform int fillMode;

uniform float seed;
uniform vec2 red;
uniform vec2 green;
uniform vec2 blue;

const int TRANSPARENT = 0;
const int ORIGINAL = 1;
const int LOOP = 2;
const int CLAMP = 3;
const int MIRROR = 4;

void main(void)
{
    vec2 coord = (vTextureCoord * filterArea.xy) / dimensions;

    if (coord.x > 1.0 || coord.y > 1.0) {
        return;
    }

    float cx = coord.x - 0.5;
    float cy = (coord.y - 0.5) * aspect;
    float ny = (-sinDir * cx + cosDir * cy) / aspect + 0.5;

    // displacementMap: repeat
    // ny = ny > 1.0 ? ny - 1.0 : (ny < 0.0 ? 1.0 + ny : ny);

    // displacementMap: mirror
    ny = ny > 1.0 ? 2.0 - ny : (ny < 0.0 ? -ny : ny);

    vec4 dc = texture2D(displacementMap, vec2(0.5, ny));

    float displacement = (dc.r - dc.g) * (offset / filterArea.x);

    coord = vTextureCoord + vec2(cosDir * displacement, sinDir * displacement * aspect);

    if (fillMode == CLAMP) {
        coord = clamp(coord, filterClamp.xy, filterClamp.zw);
    } else {
        if( coord.x > filterClamp.z ) {
            if (fillMode == TRANSPARENT) {
                discard;
            } else if (fillMode == LOOP) {
                coord.x -= filterClamp.z;
            } else if (fillMode == MIRROR) {
                coord.x = filterClamp.z * 2.0 - coord.x;
            }
        } else if( coord.x < filterClamp.x ) {
            if (fillMode == TRANSPARENT) {
                discard;
            } else if (fillMode == LOOP) {
                coord.x += filterClamp.z;
            } else if (fillMode == MIRROR) {
                coord.x *= -filterClamp.z;
            }
        }

        if( coord.y > filterClamp.w ) {
            if (fillMode == TRANSPARENT) {
                discard;
            } else if (fillMode == LOOP) {
                coord.y -= filterClamp.w;
            } else if (fillMode == MIRROR) {
                coord.y = filterClamp.w * 2.0 - coord.y;
            }
        } else if( coord.y < filterClamp.y ) {
            if (fillMode == TRANSPARENT) {
                discard;
            } else if (fillMode == LOOP) {
                coord.y += filterClamp.w;
            } else if (fillMode == MIRROR) {
                coord.y *= -filterClamp.w;
            }
        }
    }

    gl_FragColor.r = texture2D(uSampler, coord + red * (1.0 - seed * 0.4) / filterArea.xy).r;
    gl_FragColor.g = texture2D(uSampler, coord + green * (1.0 - seed * 0.3) / filterArea.xy).g;
    gl_FragColor.b = texture2D(uSampler, coord + blue * (1.0 - seed * 0.2) / filterArea.xy).b;
    gl_FragColor.a = texture2D(uSampler, coord).a;
}
`,Fu=class extends z{constructor(r){super($1,Y1),this.offset=100,this.fillMode=Fu.TRANSPARENT,this.average=!1,this.seed=0,this.minSize=8,this.sampleSize=512,this._slices=0,this._offsets=new Float32Array(1),this._sizes=new Float32Array(1),this._direction=-1,this.uniforms.dimensions=new Float32Array(2),this._canvas=document.createElement("canvas"),this._canvas.width=4,this._canvas.height=this.sampleSize,this.texture=v.from(this._canvas,{scaleMode:Wt.NEAREST}),Object.assign(this,Fu.defaults,r)}apply(r,t,e,i){let{width:s,height:o}=t.filterFrame;this.uniforms.dimensions[0]=s,this.uniforms.dimensions[1]=o,this.uniforms.aspect=o/s,this.uniforms.seed=this.seed,this.uniforms.offset=this.offset,this.uniforms.fillMode=this.fillMode,r.applyFilter(this,t,e,i)}_randomizeSizes(){let r=this._sizes,t=this._slices-1,e=this.sampleSize,i=Math.min(this.minSize/e,.9/this._slices);if(this.average){let s=this._slices,o=1;for(let n=0;n<t;n++){let a=o/(s-n),l=Math.max(a*(1-Math.random()*.6),i);r[n]=l,o-=l}r[t]=o}else{let s=1,o=Math.sqrt(1/this._slices);for(let n=0;n<t;n++){let a=Math.max(o*s*Math.random(),i);r[n]=a,s-=a}r[t]=s}this.shuffle()}shuffle(){let r=this._sizes,t=this._slices-1;for(let e=t;e>0;e--){let i=Math.random()*e>>0,s=r[e];r[e]=r[i],r[i]=s}}_randomizeOffsets(){for(let r=0;r<this._slices;r++)this._offsets[r]=Math.random()*(Math.random()<.5?-1:1)}refresh(){this._randomizeSizes(),this._randomizeOffsets(),this.redraw()}redraw(){let r=this.sampleSize,t=this.texture,e=this._canvas.getContext("2d");e.clearRect(0,0,8,r);let i,s=0;for(let o=0;o<this._slices;o++){i=Math.floor(this._offsets[o]*256);let n=this._sizes[o]*r,a=i>0?i:0,l=i<0?-i:0;e.fillStyle=`rgba(${a}, ${l}, 0, 1)`,e.fillRect(0,s>>0,r,n+1>>0),s+=n}t.baseTexture.update(),this.uniforms.displacementMap=t}set sizes(r){let t=Math.min(this._slices,r.length);for(let e=0;e<t;e++)this._sizes[e]=r[e]}get sizes(){return this._sizes}set offsets(r){let t=Math.min(this._slices,r.length);for(let e=0;e<t;e++)this._offsets[e]=r[e]}get offsets(){return this._offsets}get slices(){return this._slices}set slices(r){this._slices!==r&&(this._slices=r,this.uniforms.slices=r,this._sizes=this.uniforms.slicesWidth=new Float32Array(r),this._offsets=this.uniforms.slicesOffset=new Float32Array(r),this.refresh())}get direction(){return this._direction}set direction(r){if(this._direction===r)return;this._direction=r;let t=r*$e;this.uniforms.sinDir=Math.sin(t),this.uniforms.cosDir=Math.cos(t)}get red(){return this.uniforms.red}set red(r){this.uniforms.red=r}get green(){return this.uniforms.green}set green(r){this.uniforms.green=r}get blue(){return this.uniforms.blue}set blue(r){this.uniforms.blue=r}destroy(){var r;(r=this.texture)==null||r.destroy(!0),this.texture=this._canvas=this.red=this.green=this.blue=this._sizes=this._offsets=null}},Qs=Fu;Qs.defaults={slices:5,offset:100,direction:0,fillMode:0,average:!1,seed:0,red:[0,0],green:[0,0],blue:[0,0],minSize:8,sampleSize:512},Qs.TRANSPARENT=0,Qs.ORIGINAL=1,Qs.LOOP=2,Qs.CLAMP=3,Qs.MIRROR=4;var K1=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,q1=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

uniform float outerStrength;
uniform float innerStrength;

uniform vec4 glowColor;

uniform vec4 filterArea;
uniform vec4 filterClamp;
uniform bool knockout;
uniform float alpha;

const float PI = 3.14159265358979323846264;

const float DIST = __DIST__;
const float ANGLE_STEP_SIZE = min(__ANGLE_STEP_SIZE__, PI * 2.0);
const float ANGLE_STEP_NUM = ceil(PI * 2.0 / ANGLE_STEP_SIZE);

const float MAX_TOTAL_ALPHA = ANGLE_STEP_NUM * DIST * (DIST + 1.0) / 2.0;

void main(void) {
    vec2 px = vec2(1.0 / filterArea.x, 1.0 / filterArea.y);

    float totalAlpha = 0.0;

    vec2 direction;
    vec2 displaced;
    vec4 curColor;

    for (float angle = 0.0; angle < PI * 2.0; angle += ANGLE_STEP_SIZE) {
       direction = vec2(cos(angle), sin(angle)) * px;

       for (float curDistance = 0.0; curDistance < DIST; curDistance++) {
           displaced = clamp(vTextureCoord + direction * 
                   (curDistance + 1.0), filterClamp.xy, filterClamp.zw);

           curColor = texture2D(uSampler, displaced);

           totalAlpha += (DIST - curDistance) * curColor.a;
       }
    }
    
    curColor = texture2D(uSampler, vTextureCoord);

    float alphaRatio = (totalAlpha / MAX_TOTAL_ALPHA);

    float innerGlowAlpha = (1.0 - alphaRatio) * innerStrength * curColor.a;
    float innerGlowStrength = min(1.0, innerGlowAlpha);
    
    vec4 innerColor = mix(curColor, glowColor, innerGlowStrength);

    float outerGlowAlpha = alphaRatio * outerStrength * (1. - curColor.a);
    float outerGlowStrength = min(1.0 - innerColor.a, outerGlowAlpha);

    if (knockout) {
      float resultAlpha = (outerGlowAlpha + innerGlowAlpha) * alpha;
      gl_FragColor = vec4(glowColor.rgb * resultAlpha, resultAlpha);
    }
    else {
      vec4 outerGlowColor = outerGlowStrength * glowColor.rgba * alpha;
      gl_FragColor = innerColor + outerGlowColor;
    }
}
`,Qg=class extends z{constructor(r){let t=Object.assign({},Qg.defaults,r),{outerStrength:e,innerStrength:i,color:s,knockout:o,quality:n,alpha:a}=t,l=Math.round(t.distance);super(K1,q1.replace(/__ANGLE_STEP_SIZE__/gi,`${(1/n/l).toFixed(7)}`).replace(/__DIST__/gi,`${l.toFixed(0)}.0`)),this.uniforms.glowColor=new Float32Array([0,0,0,1]),this.uniforms.alpha=1,Object.assign(this,{color:s,outerStrength:e,innerStrength:i,padding:l,knockout:o,alpha:a})}get color(){return w.rgb2hex(this.uniforms.glowColor)}set color(r){w.hex2rgb(r,this.uniforms.glowColor)}get outerStrength(){return this.uniforms.outerStrength}set outerStrength(r){this.uniforms.outerStrength=r}get innerStrength(){return this.uniforms.innerStrength}set innerStrength(r){this.uniforms.innerStrength=r}get knockout(){return this.uniforms.knockout}set knockout(r){this.uniforms.knockout=r}get alpha(){return this.uniforms.alpha}set alpha(r){this.uniforms.alpha=r}},Z1=Qg;Z1.defaults={distance:10,outerStrength:4,innerStrength:0,color:16777215,quality:.1,knockout:!1,alpha:1};var Q1=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,J1=`vec3 mod289(vec3 x)
{
    return x - floor(x * (1.0 / 289.0)) * 289.0;
}
vec4 mod289(vec4 x)
{
    return x - floor(x * (1.0 / 289.0)) * 289.0;
}
vec4 permute(vec4 x)
{
    return mod289(((x * 34.0) + 1.0) * x);
}
vec4 taylorInvSqrt(vec4 r)
{
    return 1.79284291400159 - 0.85373472095314 * r;
}
vec3 fade(vec3 t)
{
    return t * t * t * (t * (t * 6.0 - 15.0) + 10.0);
}
// Classic Perlin noise, periodic variant
float pnoise(vec3 P, vec3 rep)
{
    vec3 Pi0 = mod(floor(P), rep); // Integer part, modulo period
    vec3 Pi1 = mod(Pi0 + vec3(1.0), rep); // Integer part + 1, mod period
    Pi0 = mod289(Pi0);
    Pi1 = mod289(Pi1);
    vec3 Pf0 = fract(P); // Fractional part for interpolation
    vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0
    vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
    vec4 iy = vec4(Pi0.yy, Pi1.yy);
    vec4 iz0 = Pi0.zzzz;
    vec4 iz1 = Pi1.zzzz;
    vec4 ixy = permute(permute(ix) + iy);
    vec4 ixy0 = permute(ixy + iz0);
    vec4 ixy1 = permute(ixy + iz1);
    vec4 gx0 = ixy0 * (1.0 / 7.0);
    vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;
    gx0 = fract(gx0);
    vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
    vec4 sz0 = step(gz0, vec4(0.0));
    gx0 -= sz0 * (step(0.0, gx0) - 0.5);
    gy0 -= sz0 * (step(0.0, gy0) - 0.5);
    vec4 gx1 = ixy1 * (1.0 / 7.0);
    vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;
    gx1 = fract(gx1);
    vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
    vec4 sz1 = step(gz1, vec4(0.0));
    gx1 -= sz1 * (step(0.0, gx1) - 0.5);
    gy1 -= sz1 * (step(0.0, gy1) - 0.5);
    vec3 g000 = vec3(gx0.x, gy0.x, gz0.x);
    vec3 g100 = vec3(gx0.y, gy0.y, gz0.y);
    vec3 g010 = vec3(gx0.z, gy0.z, gz0.z);
    vec3 g110 = vec3(gx0.w, gy0.w, gz0.w);
    vec3 g001 = vec3(gx1.x, gy1.x, gz1.x);
    vec3 g101 = vec3(gx1.y, gy1.y, gz1.y);
    vec3 g011 = vec3(gx1.z, gy1.z, gz1.z);
    vec3 g111 = vec3(gx1.w, gy1.w, gz1.w);
    vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
    g000 *= norm0.x;
    g010 *= norm0.y;
    g100 *= norm0.z;
    g110 *= norm0.w;
    vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
    g001 *= norm1.x;
    g011 *= norm1.y;
    g101 *= norm1.z;
    g111 *= norm1.w;
    float n000 = dot(g000, Pf0);
    float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
    float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
    float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
    float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
    float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
    float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
    float n111 = dot(g111, Pf1);
    vec3 fade_xyz = fade(Pf0);
    vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
    vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
    float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);
    return 2.2 * n_xyz;
}
float turb(vec3 P, vec3 rep, float lacunarity, float gain)
{
    float sum = 0.0;
    float sc = 1.0;
    float totalgain = 1.0;
    for (float i = 0.0; i < 6.0; i++)
    {
        sum += totalgain * pnoise(P * sc, rep);
        sc *= lacunarity;
        totalgain *= gain;
    }
    return abs(sum);
}
`,tT=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform vec4 filterArea;
uniform vec2 dimensions;

uniform vec2 light;
uniform bool parallel;
uniform float aspect;

uniform float gain;
uniform float lacunarity;
uniform float time;
uniform float alpha;

\${perlin}

void main(void) {
    vec2 coord = vTextureCoord * filterArea.xy / dimensions.xy;

    float d;

    if (parallel) {
        float _cos = light.x;
        float _sin = light.y;
        d = (_cos * coord.x) + (_sin * coord.y * aspect);
    } else {
        float dx = coord.x - light.x / dimensions.x;
        float dy = (coord.y - light.y / dimensions.y) * aspect;
        float dis = sqrt(dx * dx + dy * dy) + 0.00001;
        d = dy / dis;
    }

    vec3 dir = vec3(d, d, 0.0);

    float noise = turb(dir + vec3(time, 0.0, 62.1 + time) * 0.05, vec3(480.0, 320.0, 480.0), lacunarity, gain);
    noise = mix(noise, 0.0, 0.3);
    //fade vertically.
    vec4 mist = vec4(noise, noise, noise, 1.0) * (1.0 - coord.y);
    mist.a = 1.0;
    // apply user alpha
    mist *= alpha;

    gl_FragColor = texture2D(uSampler, vTextureCoord) + mist;

}
`,Jg=class extends z{constructor(r){super(Q1,tT.replace("${perlin}",J1)),this.parallel=!0,this.time=0,this._angle=0,this.uniforms.dimensions=new Float32Array(2);let t=Object.assign(Jg.defaults,r);this._angleLight=new $,this.angle=t.angle,this.gain=t.gain,this.lacunarity=t.lacunarity,this.alpha=t.alpha,this.parallel=t.parallel,this.center=t.center,this.time=t.time}apply(r,t,e,i){let{width:s,height:o}=t.filterFrame;this.uniforms.light=this.parallel?this._angleLight:this.center,this.uniforms.parallel=this.parallel,this.uniforms.dimensions[0]=s,this.uniforms.dimensions[1]=o,this.uniforms.aspect=o/s,this.uniforms.time=this.time,this.uniforms.alpha=this.alpha,r.applyFilter(this,t,e,i)}get angle(){return this._angle}set angle(r){this._angle=r;let t=r*$e;this._angleLight.x=Math.cos(t),this._angleLight.y=Math.sin(t)}get gain(){return this.uniforms.gain}set gain(r){this.uniforms.gain=r}get lacunarity(){return this.uniforms.lacunarity}set lacunarity(r){this.uniforms.lacunarity=r}get alpha(){return this.uniforms.alpha}set alpha(r){this.uniforms.alpha=r}},eT=Jg;eT.defaults={angle:30,gain:.5,lacunarity:2.5,time:0,parallel:!0,center:[0,0],alpha:1};var rT=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,iT=`precision mediump float;

varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float uHue;
uniform float uAlpha;
uniform bool uColorize;
uniform float uSaturation;
uniform float uLightness;

// https://en.wikipedia.org/wiki/Luma_(video)
const vec3 weight = vec3(0.299, 0.587, 0.114);

float getWeightedAverage(vec3 rgb) {
    return rgb.r * weight.r + rgb.g * weight.g + rgb.b * weight.b;
}

// https://gist.github.com/mairod/a75e7b44f68110e1576d77419d608786?permalink_comment_id=3195243#gistcomment-3195243
const vec3 k = vec3(0.57735, 0.57735, 0.57735);

vec3 hueShift(vec3 color, float angle) {
    float cosAngle = cos(angle);
    return vec3(
    color * cosAngle +
    cross(k, color) * sin(angle) +
    k * dot(k, color) * (1.0 - cosAngle)
    );
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    vec4 result = color;

    // colorize
    if (uColorize) {
        result.rgb = vec3(getWeightedAverage(result.rgb), 0., 0.);
    }

    // hue
    result.rgb = hueShift(result.rgb, uHue);

    // saturation
    // https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/huesaturation.js
    float average = (result.r + result.g + result.b) / 3.0;

    if (uSaturation > 0.) {
        result.rgb += (average - result.rgb) * (1. - 1. / (1.001 - uSaturation));
    } else {
        result.rgb -= (average - result.rgb) * uSaturation;
    }

    // lightness
    result.rgb = mix(result.rgb, vec3(ceil(uLightness)) * color.a, abs(uLightness));

    // alpha
    gl_FragColor = mix(color, result, uAlpha);
}
`,tx=class extends z{constructor(r){super(rT,iT),this._hue=0;let t=Object.assign({},tx.defaults,r);Object.assign(this,t)}get hue(){return this._hue}set hue(r){this._hue=r,this.uniforms.uHue=this._hue*(Math.PI/180)}get alpha(){return this.uniforms.uAlpha}set alpha(r){this.uniforms.uAlpha=r}get colorize(){return this.uniforms.uColorize}set colorize(r){this.uniforms.uColorize=r}get lightness(){return this.uniforms.uLightness}set lightness(r){this.uniforms.uLightness=r}get saturation(){return this.uniforms.uSaturation}set saturation(r){this.uniforms.uSaturation=r}},sT=tx;sT.defaults={hue:0,saturation:0,lightness:0,colorize:!1,alpha:1};var oT=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,nT=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform vec4 filterArea;
uniform vec2 dimensions;

uniform float sepia;
uniform float noise;
uniform float noiseSize;
uniform float scratch;
uniform float scratchDensity;
uniform float scratchWidth;
uniform float vignetting;
uniform float vignettingAlpha;
uniform float vignettingBlur;
uniform float seed;

const float SQRT_2 = 1.414213;
const vec3 SEPIA_RGB = vec3(112.0 / 255.0, 66.0 / 255.0, 20.0 / 255.0);

float rand(vec2 co) {
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

vec3 Overlay(vec3 src, vec3 dst)
{
    // if (dst <= 0.5) then: 2 * src * dst
    // if (dst > 0.5) then: 1 - 2 * (1 - dst) * (1 - src)
    return vec3((dst.x <= 0.5) ? (2.0 * src.x * dst.x) : (1.0 - 2.0 * (1.0 - dst.x) * (1.0 - src.x)),
                (dst.y <= 0.5) ? (2.0 * src.y * dst.y) : (1.0 - 2.0 * (1.0 - dst.y) * (1.0 - src.y)),
                (dst.z <= 0.5) ? (2.0 * src.z * dst.z) : (1.0 - 2.0 * (1.0 - dst.z) * (1.0 - src.z)));
}


void main()
{
    gl_FragColor = texture2D(uSampler, vTextureCoord);
    vec3 color = gl_FragColor.rgb;

    if (sepia > 0.0)
    {
        float gray = (color.x + color.y + color.z) / 3.0;
        vec3 grayscale = vec3(gray);

        color = Overlay(SEPIA_RGB, grayscale);

        color = grayscale + sepia * (color - grayscale);
    }

    vec2 coord = vTextureCoord * filterArea.xy / dimensions.xy;

    if (vignetting > 0.0)
    {
        float outter = SQRT_2 - vignetting * SQRT_2;
        vec2 dir = vec2(vec2(0.5, 0.5) - coord);
        dir.y *= dimensions.y / dimensions.x;
        float darker = clamp((outter - length(dir) * SQRT_2) / ( 0.00001 + vignettingBlur * SQRT_2), 0.0, 1.0);
        color.rgb *= darker + (1.0 - darker) * (1.0 - vignettingAlpha);
    }

    if (scratchDensity > seed && scratch != 0.0)
    {
        float phase = seed * 256.0;
        float s = mod(floor(phase), 2.0);
        float dist = 1.0 / scratchDensity;
        float d = distance(coord, vec2(seed * dist, abs(s - seed * dist)));
        if (d < seed * 0.6 + 0.4)
        {
            highp float period = scratchDensity * 10.0;

            float xx = coord.x * period + phase;
            float aa = abs(mod(xx, 0.5) * 4.0);
            float bb = mod(floor(xx / 0.5), 2.0);
            float yy = (1.0 - bb) * aa + bb * (2.0 - aa);

            float kk = 2.0 * period;
            float dw = scratchWidth / dimensions.x * (0.75 + seed);
            float dh = dw * kk;

            float tine = (yy - (2.0 - dh));

            if (tine > 0.0) {
                float _sign = sign(scratch);

                tine = s * tine / period + scratch + 0.1;
                tine = clamp(tine + 1.0, 0.5 + _sign * 0.5, 1.5 + _sign * 0.5);

                color.rgb *= tine;
            }
        }
    }

    if (noise > 0.0 && noiseSize > 0.0)
    {
        vec2 pixelCoord = vTextureCoord.xy * filterArea.xy;
        pixelCoord.x = floor(pixelCoord.x / noiseSize);
        pixelCoord.y = floor(pixelCoord.y / noiseSize);
        // vec2 d = pixelCoord * noiseSize * vec2(1024.0 + seed * 512.0, 1024.0 - seed * 512.0);
        // float _noise = snoise(d) * 0.5;
        float _noise = rand(pixelCoord * noiseSize * seed) - 0.5;
        color += _noise * noise;
    }

    gl_FragColor.rgb = color;
}
`,ex=class extends z{constructor(r,t=0){super(oT,nT),this.seed=0,this.uniforms.dimensions=new Float32Array(2),typeof r=="number"?(this.seed=r,r=void 0):this.seed=t,Object.assign(this,ex.defaults,r)}apply(r,t,e,i){var s,o;this.uniforms.dimensions[0]=(s=t.filterFrame)==null?void 0:s.width,this.uniforms.dimensions[1]=(o=t.filterFrame)==null?void 0:o.height,this.uniforms.seed=this.seed,r.applyFilter(this,t,e,i)}set sepia(r){this.uniforms.sepia=r}get sepia(){return this.uniforms.sepia}set noise(r){this.uniforms.noise=r}get noise(){return this.uniforms.noise}set noiseSize(r){this.uniforms.noiseSize=r}get noiseSize(){return this.uniforms.noiseSize}set scratch(r){this.uniforms.scratch=r}get scratch(){return this.uniforms.scratch}set scratchDensity(r){this.uniforms.scratchDensity=r}get scratchDensity(){return this.uniforms.scratchDensity}set scratchWidth(r){this.uniforms.scratchWidth=r}get scratchWidth(){return this.uniforms.scratchWidth}set vignetting(r){this.uniforms.vignetting=r}get vignetting(){return this.uniforms.vignetting}set vignettingAlpha(r){this.uniforms.vignettingAlpha=r}get vignettingAlpha(){return this.uniforms.vignettingAlpha}set vignettingBlur(r){this.uniforms.vignettingBlur=r}get vignettingBlur(){return this.uniforms.vignettingBlur}},aT=ex;aT.defaults={sepia:.3,noise:.3,noiseSize:1,scratch:.5,scratchDensity:.3,scratchWidth:1,vignetting:.3,vignettingAlpha:1,vignettingBlur:.3};var lT=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,hT=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform vec4 filterClamp;

uniform float uAlpha;
uniform vec2 uThickness;
uniform vec4 uColor;
uniform bool uKnockout;

const float DOUBLE_PI = 2. * 3.14159265358979323846264;
const float ANGLE_STEP = \${angleStep};

float outlineMaxAlphaAtPos(vec2 pos) {
    if (uThickness.x == 0. || uThickness.y == 0.) {
        return 0.;
    }

    vec4 displacedColor;
    vec2 displacedPos;
    float maxAlpha = 0.;

    for (float angle = 0.; angle <= DOUBLE_PI; angle += ANGLE_STEP) {
        displacedPos.x = vTextureCoord.x + uThickness.x * cos(angle);
        displacedPos.y = vTextureCoord.y + uThickness.y * sin(angle);
        displacedColor = texture2D(uSampler, clamp(displacedPos, filterClamp.xy, filterClamp.zw));
        maxAlpha = max(maxAlpha, displacedColor.a);
    }

    return maxAlpha;
}

void main(void) {
    vec4 sourceColor = texture2D(uSampler, vTextureCoord);
    vec4 contentColor = sourceColor * float(!uKnockout);
    float outlineAlpha = uAlpha * outlineMaxAlphaAtPos(vTextureCoord.xy) * (1.-sourceColor.a);
    vec4 outlineColor = vec4(vec3(uColor) * outlineAlpha, outlineAlpha);
    gl_FragColor = contentColor + outlineColor;
}
`,yl=class extends z{constructor(r=1,t=0,e=.1,i=1,s=!1){super(lT,hT.replace(/\$\{angleStep\}/,yl.getAngleStep(e))),this._thickness=1,this._alpha=1,this._knockout=!1,this.uniforms.uThickness=new Float32Array([0,0]),this.uniforms.uColor=new Float32Array([0,0,0,1]),this.uniforms.uAlpha=i,this.uniforms.uKnockout=s,Object.assign(this,{thickness:r,color:t,quality:e,alpha:i,knockout:s})}static getAngleStep(r){let t=Math.max(r*yl.MAX_SAMPLES,yl.MIN_SAMPLES);return(Math.PI*2/t).toFixed(7)}apply(r,t,e,i){this.uniforms.uThickness[0]=this._thickness/t._frame.width,this.uniforms.uThickness[1]=this._thickness/t._frame.height,this.uniforms.uAlpha=this._alpha,this.uniforms.uKnockout=this._knockout,r.applyFilter(this,t,e,i)}get alpha(){return this._alpha}set alpha(r){this._alpha=r}get color(){return w.rgb2hex(this.uniforms.uColor)}set color(r){w.hex2rgb(r,this.uniforms.uColor)}get knockout(){return this._knockout}set knockout(r){this._knockout=r}get thickness(){return this._thickness}set thickness(r){this._thickness=r,this.padding=r}},rx=yl;rx.MIN_SAMPLES=1,rx.MAX_SAMPLES=100;var cT=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,uT=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;

uniform vec4 filterArea;
uniform vec4 filterClamp;
uniform vec2 dimensions;

uniform bool mirror;
uniform float boundary;
uniform vec2 amplitude;
uniform vec2 waveLength;
uniform vec2 alpha;
uniform float time;

float rand(vec2 co) {
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main(void)
{
    vec2 pixelCoord = vTextureCoord.xy * filterArea.xy;
    vec2 coord = pixelCoord / dimensions;

    if (coord.y < boundary) {
        gl_FragColor = texture2D(uSampler, vTextureCoord);
        return;
    }

    float k = (coord.y - boundary) / (1. - boundary + 0.0001);
    float areaY = boundary * dimensions.y / filterArea.y;
    float v = areaY + areaY - vTextureCoord.y;
    float y = mirror ? v : vTextureCoord.y;

    float _amplitude = ((amplitude.y - amplitude.x) * k + amplitude.x ) / filterArea.x;
    float _waveLength = ((waveLength.y - waveLength.x) * k + waveLength.x) / filterArea.y;
    float _alpha = (alpha.y - alpha.x) * k + alpha.x;

    float x = vTextureCoord.x + cos(v * 6.28 / _waveLength - time) * _amplitude;
    x = clamp(x, filterClamp.x, filterClamp.z);

    vec4 color = texture2D(uSampler, vec2(x, y));

    gl_FragColor = color * _alpha;
}
`,ix=class extends z{constructor(r){super(cT,uT),this.time=0,this.uniforms.amplitude=new Float32Array(2),this.uniforms.waveLength=new Float32Array(2),this.uniforms.alpha=new Float32Array(2),this.uniforms.dimensions=new Float32Array(2),Object.assign(this,ix.defaults,r)}apply(r,t,e,i){var s,o;this.uniforms.dimensions[0]=(s=t.filterFrame)==null?void 0:s.width,this.uniforms.dimensions[1]=(o=t.filterFrame)==null?void 0:o.height,this.uniforms.time=this.time,r.applyFilter(this,t,e,i)}set mirror(r){this.uniforms.mirror=r}get mirror(){return this.uniforms.mirror}set boundary(r){this.uniforms.boundary=r}get boundary(){return this.uniforms.boundary}set amplitude(r){this.uniforms.amplitude[0]=r[0],this.uniforms.amplitude[1]=r[1]}get amplitude(){return this.uniforms.amplitude}set waveLength(r){this.uniforms.waveLength[0]=r[0],this.uniforms.waveLength[1]=r[1]}get waveLength(){return this.uniforms.waveLength}set alpha(r){this.uniforms.alpha[0]=r[0],this.uniforms.alpha[1]=r[1]}get alpha(){return this.uniforms.alpha}},dT=ix;dT.defaults={mirror:!0,boundary:.5,amplitude:[0,20],waveLength:[30,100],alpha:[1,1],time:0};var pT=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,fT=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform vec4 filterArea;
uniform vec4 filterClamp;

uniform vec2 center;

uniform float amplitude;
uniform float wavelength;
// uniform float power;
uniform float brightness;
uniform float speed;
uniform float radius;

uniform float time;

const float PI = 3.14159;

void main()
{
    float halfWavelength = wavelength * 0.5 / filterArea.x;
    float maxRadius = radius / filterArea.x;
    float currentRadius = time * speed / filterArea.x;

    float fade = 1.0;

    if (maxRadius > 0.0) {
        if (currentRadius > maxRadius) {
            gl_FragColor = texture2D(uSampler, vTextureCoord);
            return;
        }
        fade = 1.0 - pow(currentRadius / maxRadius, 2.0);
    }

    vec2 dir = vec2(vTextureCoord - center / filterArea.xy);
    dir.y *= filterArea.y / filterArea.x;
    float dist = length(dir);

    if (dist <= 0.0 || dist < currentRadius - halfWavelength || dist > currentRadius + halfWavelength) {
        gl_FragColor = texture2D(uSampler, vTextureCoord);
        return;
    }

    vec2 diffUV = normalize(dir);

    float diff = (dist - currentRadius) / halfWavelength;

    float p = 1.0 - pow(abs(diff), 2.0);

    // float powDiff = diff * pow(p, 2.0) * ( amplitude * fade );
    float powDiff = 1.25 * sin(diff * PI) * p * ( amplitude * fade );

    vec2 offset = diffUV * powDiff / filterArea.xy;

    // Do clamp :
    vec2 coord = vTextureCoord + offset;
    vec2 clampedCoord = clamp(coord, filterClamp.xy, filterClamp.zw);
    vec4 color = texture2D(uSampler, clampedCoord);
    if (coord != clampedCoord) {
        color *= max(0.0, 1.0 - length(coord - clampedCoord));
    }

    // No clamp :
    // gl_FragColor = texture2D(uSampler, vTextureCoord + offset);

    color.rgb *= 1.0 + (brightness - 1.0) * p * fade;

    gl_FragColor = color;
}
`,sx=class extends z{constructor(r=[0,0],t,e=0){super(pT,fT),this.center=r,Object.assign(this,sx.defaults,t),this.time=e}apply(r,t,e,i){this.uniforms.time=this.time,r.applyFilter(this,t,e,i)}get center(){return this.uniforms.center}set center(r){this.uniforms.center=r}get amplitude(){return this.uniforms.amplitude}set amplitude(r){this.uniforms.amplitude=r}get wavelength(){return this.uniforms.wavelength}set wavelength(r){this.uniforms.wavelength=r}get brightness(){return this.uniforms.brightness}set brightness(r){this.uniforms.brightness=r}get speed(){return this.uniforms.speed}set speed(r){this.uniforms.speed=r}get radius(){return this.uniforms.radius}set radius(r){this.uniforms.radius=r}},mT=sx;mT.defaults={amplitude:30,wavelength:160,brightness:1,speed:500,radius:-1};var gT=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,xT=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float blur;
uniform float gradientBlur;
uniform vec2 start;
uniform vec2 end;
uniform vec2 delta;
uniform vec2 texSize;

float random(vec3 scale, float seed)
{
    return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);
}

void main(void)
{
    vec4 color = vec4(0.0);
    float total = 0.0;

    float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);
    vec2 normal = normalize(vec2(start.y - end.y, end.x - start.x));
    float radius = smoothstep(0.0, 1.0, abs(dot(vTextureCoord * texSize - start, normal)) / gradientBlur) * blur;

    for (float t = -30.0; t <= 30.0; t++)
    {
        float percent = (t + offset - 0.5) / 30.0;
        float weight = 1.0 - abs(percent);
        vec4 sample = texture2D(uSampler, vTextureCoord + delta / texSize * percent * radius);
        sample.rgb *= sample.a;
        color += sample * weight;
        total += weight;
    }

    color /= total;
    color.rgb /= color.a + 0.00001;

    gl_FragColor = color;
}
`,vl=class extends z{constructor(t){var e,i;super(gT,xT),this.uniforms.blur=t.blur,this.uniforms.gradientBlur=t.gradientBlur,this.uniforms.start=(e=t.start)!=null?e:new $(0,window.innerHeight/2),this.uniforms.end=(i=t.end)!=null?i:new $(600,window.innerHeight/2),this.uniforms.delta=new $(30,30),this.uniforms.texSize=new $(window.innerWidth,window.innerHeight),this.updateDelta()}updateDelta(){this.uniforms.delta.x=0,this.uniforms.delta.y=0}get blur(){return this.uniforms.blur}set blur(t){this.uniforms.blur=t}get gradientBlur(){return this.uniforms.gradientBlur}set gradientBlur(t){this.uniforms.gradientBlur=t}get start(){return this.uniforms.start}set start(t){this.uniforms.start=t,this.updateDelta()}get end(){return this.uniforms.end}set end(t){this.uniforms.end=t,this.updateDelta()}},Du=class extends vl{updateDelta(){let t=this.uniforms.end.x-this.uniforms.start.x,e=this.uniforms.end.y-this.uniforms.start.y,i=Math.sqrt(t*t+e*e);this.uniforms.delta.x=t/i,this.uniforms.delta.y=e/i}},Bu=class extends vl{updateDelta(){let t=this.uniforms.end.x-this.uniforms.start.x,e=this.uniforms.end.y-this.uniforms.start.y,i=Math.sqrt(t*t+e*e);this.uniforms.delta.x=-e/i,this.uniforms.delta.y=t/i}},ox=class extends z{constructor(r,t,e,i){super(),typeof r=="number"&&(w.deprecation("5.3.0","TiltShiftFilter constructor arguments is deprecated, use options."),r={blur:r,gradientBlur:t,start:e,end:i}),r=Object.assign({},ox.defaults,r),this.tiltShiftXFilter=new Du(r),this.tiltShiftYFilter=new Bu(r)}apply(r,t,e,i){let s=r.getFilterTexture();this.tiltShiftXFilter.apply(r,t,s,1),this.tiltShiftYFilter.apply(r,s,e,i),r.returnFilterTexture(s)}get blur(){return this.tiltShiftXFilter.blur}set blur(r){this.tiltShiftXFilter.blur=this.tiltShiftYFilter.blur=r}get gradientBlur(){return this.tiltShiftXFilter.gradientBlur}set gradientBlur(r){this.tiltShiftXFilter.gradientBlur=this.tiltShiftYFilter.gradientBlur=r}get start(){return this.tiltShiftXFilter.start}set start(r){this.tiltShiftXFilter.start=this.tiltShiftYFilter.start=r}get end(){return this.tiltShiftXFilter.end}set end(r){this.tiltShiftXFilter.end=this.tiltShiftYFilter.end=r}},yT=ox;yT.defaults={blur:100,gradientBlur:600,start:void 0,end:void 0};var vT=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,_T=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float radius;
uniform float angle;
uniform vec2 offset;
uniform vec4 filterArea;

vec2 mapCoord( vec2 coord )
{
    coord *= filterArea.xy;
    coord += filterArea.zw;

    return coord;
}

vec2 unmapCoord( vec2 coord )
{
    coord -= filterArea.zw;
    coord /= filterArea.xy;

    return coord;
}

vec2 twist(vec2 coord)
{
    coord -= offset;

    float dist = length(coord);

    if (dist < radius)
    {
        float ratioDist = (radius - dist) / radius;
        float angleMod = ratioDist * ratioDist * angle;
        float s = sin(angleMod);
        float c = cos(angleMod);
        coord = vec2(coord.x * c - coord.y * s, coord.x * s + coord.y * c);
    }

    coord += offset;

    return coord;
}

void main(void)
{

    vec2 coord = mapCoord(vTextureCoord);

    coord = twist(coord);

    coord = unmapCoord(coord);

    gl_FragColor = texture2D(uSampler, coord );

}
`,nx=class extends z{constructor(r){super(vT,_T),Object.assign(this,nx.defaults,r)}get offset(){return this.uniforms.offset}set offset(r){this.uniforms.offset=r}get radius(){return this.uniforms.radius}set radius(r){this.uniforms.radius=r}get angle(){return this.uniforms.angle}set angle(r){this.uniforms.angle=r}},bT=nx;bT.defaults={radius:200,angle:4,padding:20,offset:new $};var TT=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,wT=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform vec4 filterArea;

uniform vec2 uCenter;
uniform float uStrength;
uniform float uInnerRadius;
uniform float uRadius;

const float MAX_KERNEL_SIZE = \${maxKernelSize};

// author: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/
highp float rand(vec2 co, float seed) {
    const highp float a = 12.9898, b = 78.233, c = 43758.5453;
    highp float dt = dot(co + seed, vec2(a, b)), sn = mod(dt, 3.14159);
    return fract(sin(sn) * c + seed);
}

void main() {

    float minGradient = uInnerRadius * 0.3;
    float innerRadius = (uInnerRadius + minGradient * 0.5) / filterArea.x;

    float gradient = uRadius * 0.3;
    float radius = (uRadius - gradient * 0.5) / filterArea.x;

    float countLimit = MAX_KERNEL_SIZE;

    vec2 dir = vec2(uCenter.xy / filterArea.xy - vTextureCoord);
    float dist = length(vec2(dir.x, dir.y * filterArea.y / filterArea.x));

    float strength = uStrength;

    float delta = 0.0;
    float gap;
    if (dist < innerRadius) {
        delta = innerRadius - dist;
        gap = minGradient;
    } else if (radius >= 0.0 && dist > radius) { // radius < 0 means it's infinity
        delta = dist - radius;
        gap = gradient;
    }

    if (delta > 0.0) {
        float normalCount = gap / filterArea.x;
        delta = (normalCount - delta) / normalCount;
        countLimit *= delta;
        strength *= delta;
        if (countLimit < 1.0)
        {
            gl_FragColor = texture2D(uSampler, vTextureCoord);
            return;
        }
    }

    // randomize the lookup values to hide the fixed number of samples
    float offset = rand(vTextureCoord, 0.0);

    float total = 0.0;
    vec4 color = vec4(0.0);

    dir *= strength;

    for (float t = 0.0; t < MAX_KERNEL_SIZE; t++) {
        float percent = (t + offset) / MAX_KERNEL_SIZE;
        float weight = 4.0 * (percent - percent * percent);
        vec2 p = vTextureCoord + dir * percent;
        vec4 sample = texture2D(uSampler, p);

        // switch to pre-multiplied alpha to correctly blur transparent images
        // sample.rgb *= sample.a;

        color += sample * weight;
        total += weight;

        if (t > countLimit){
            break;
        }
    }

    color /= total;
    // switch back from pre-multiplied alpha
    // color.rgb /= color.a + 0.00001;

    gl_FragColor = color;
}
`,ax=Object.getOwnPropertySymbols,CT=Object.prototype.hasOwnProperty,ST=Object.prototype.propertyIsEnumerable,ET=(r,t)=>{var e={};for(var i in r)CT.call(r,i)&&t.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&ax)for(var i of ax(r))t.indexOf(i)<0&&ST.call(r,i)&&(e[i]=r[i]);return e},lx=class extends z{constructor(r){let t=Object.assign(lx.defaults,r),{maxKernelSize:e}=t,i=ET(t,["maxKernelSize"]);super(TT,wT.replace("${maxKernelSize}",e.toFixed(1))),Object.assign(this,i)}get center(){return this.uniforms.uCenter}set center(r){this.uniforms.uCenter=r}get strength(){return this.uniforms.uStrength}set strength(r){this.uniforms.uStrength=r}get innerRadius(){return this.uniforms.uInnerRadius}set innerRadius(r){this.uniforms.uInnerRadius=r}get radius(){return this.uniforms.uRadius}set radius(r){(r<0||r===1/0)&&(r=-1),this.uniforms.uRadius=r}},AT=lx;AT.defaults={strength:.1,center:[0,0],innerRadius:0,radius:-1,maxKernelSize:32};var ti=class extends D{halfWidth=.5;roadX=0;lane;body;hitbox;health=100;tintColor={r:255,g:255,b:255};tintTween;constructor(){super(),this.body=new I,this.body.anchor.set(.5),this.hitbox=new ur,this.hitbox.visible=!1,this.addChild(this.hitbox),Ft.disableShadows||(this.body.filters=[new Vi({blur:2,offset:{x:-6,y:6}})]),this.addChild(this.body),this.scale.set(.8),this.tintTween=new lt(this.tintColor).from({r:256,g:128,b:128}).to({r:256,g:256,b:256},200).yoyo().easing(at.Quadratic.In).yoyoEasing(at.Quadratic.Out).onUpdate(()=>{this.body.tint=tt.shared.setValue(this.tintColor).toHex()})}resizeHitbox(){this.hitbox.clear(),this.hitbox.beginFill(16777215,.5);let t=40,e=20;this.hitbox.drawRect(-this.body.width/2+e,-this.body.height/2+t,this.body.width-e*2,this.body.height-t),this.hitbox.endFill()}takeDamage(t){this.tintTween.isPlaying()||this.tintTween.start()}};var Vt=class{inactiveInstances=[];activeInstances=[];createFunction;resetFunction;destroyFunction;constructor(t,e,i){this.createFunction=t,this.resetFunction=e,this.destroyFunction=i}getInstance(){let t=this.inactiveInstances.pop()||this.createFunction();return this.activeInstances.push(t),this.resetFunction(t),t}release(t){t.parent&&t.parent.removeChild(t),this.activeInstances=this.activeInstances.filter(e=>e!=t),this.inactiveInstances.push(t)}destroy(){[...this.activeInstances,...this.inactiveInstances].forEach(t=>this.destroyFunction(t))}};var PT={firePeriodMS:300,projectileSpeed:1},hx=["Yellow","Green","Blue","Pink"],Re=class{lastFiredMS;config;onFire=new Ge;projectiles;body;flashes;flashTween;canFire=!1;constructor(t,e){this.config=Object.assign({},PT,t||{}),this.body=new I,this.projectiles=e,this.flashes=new D,this.lastFiredMS=this.config.firePeriodMS,this.flashTween=new lt(this.flashes),this.flashes.alpha=0}update(t){this.canFire&&(this.lastFiredMS+=t,this.lastFiredMS>this.config.firePeriodMS&&(this.lastFiredMS-=this.config.firePeriodMS,this.fire())),this.projectiles.activeInstances.forEach(e=>{this.updateProjectile(e,t)})}fire(){this.flashes.alpha=1,this.flashTween.to({alpha:0},200).easing(at.Sinusoidal.Out).start()}updateProjectile(t,e){t.y+=this.config.projectileSpeed*Math.sin(t.rotation-Math.PI/2)*e,t.x+=this.config.projectileSpeed*Math.cos(t.rotation-Math.PI/2)*e,(t.y>U.height||t.y<0)&&this.projectiles.release(t)}addMuzzleFlash(t,e){let i=new I(t);i.anchor.set(.5),this.flashes.addChild(i),i.position.copyFrom(e)}getColor(t){return hx[t%hx.length]}getProjectileDamage(){return 10}static resetProjectile(t){t.rotation=0}static destroyProjectile(t){t.destroy()}};var ei=[{gun:"Weapon-1-Yellow",flash:"Fire-Exit-1-Yellow",projectile:"Fire-1-Yellow",projectileCount:1},{gun:"Weapon-1-Green",flash:"Fire-Exit-1-Green",projectile:"Fire-1-Green",projectileCount:1},{gun:"Weapon-1-Blue",flash:"Fire-Exit-1-Blue",projectile:"Fire-1-Blue",projectileCount:1},{gun:"Weapon-2-Yellow",flash:"Fire-Exit-1-Yellow",projectile:"Fire-1-Yellow",projectileCount:2},{gun:"Weapon-2-Green",flash:"Fire-Exit-1-Green",projectile:"Fire-1-Green",projectileCount:2},{gun:"Weapon-2-Blue",flash:"Fire-Exit-1-Blue",projectile:"Fire-1-Blue",projectileCount:2},{gun:"Weapon-2-Pink",flash:"Fire-Exit-1-Pink",projectile:"Fire-1-Pink",projectileCount:2},{gun:"Weapon-3-Standart",flash:"Fire-Exit-3-Yellow",projectile:"Fire-1-Yellow",projectileCount:3},{gun:"Weapon-3-Standart",flash:"Fire-Exit-3-Green",projectile:"Fire-1-Green",projectileCount:3},{gun:"Weapon-3-Standart",flash:"Fire-Exit-3-Blue",projectile:"Fire-1-Blue",projectileCount:3},{gun:"Weapon-3-Standart",flash:"Fire-Exit-3-Pink",projectile:"Fire-1-Pink",projectileCount:3}],_l=class r extends Re{level;constructor(t,e=1){super(t||{},new Vt(()=>r.createProjectile(e),Re.resetProjectile,Re.destroyProjectile)),this.level=e,this.body.texture=v.from(ei[this.level].gun),this.body.anchor.set(.5,.85),this.body.scale.set(.5),this.upgrade(this.level)}fire(){if(super.fire(),this.level<3){let t=this.projectiles.getInstance();t.position.set(0,-65),this.onFire.dispatch([t])}else if(this.level<7){let t=this.projectiles.getInstance(),e=this.projectiles.getInstance();t.position.set(-14,-65),e.position.set(14,-65),this.onFire.dispatch([t,e])}else{let t=this.projectiles.getInstance(),e=this.projectiles.getInstance(),i=this.projectiles.getInstance();t.position.set(-14,-60),e.position.set(0,-65),i.position.set(14,-60),this.onFire.dispatch([t,e,i])}}setupMuzzleFlash(t){this.flashes.removeChildren(),t<3?this.addMuzzleFlash(v.from(ei[t].flash),{x:0,y:-125}):t<7?(this.addMuzzleFlash(v.from(ei[t].flash),{x:-16,y:-120}),this.addMuzzleFlash(v.from(ei[t].flash),{x:16,y:-120})):this.addMuzzleFlash(v.from(ei[t].flash),{x:1,y:-110})}upgrade(t){this.body.texture=v.from(ei[t].gun),this.setupMuzzleFlash(t)}getProjectileDamage(){return(this.level*2+20)/ei[this.level].projectileCount}static createProjectile(t){let e=new I(v.from(ei[t].projectile));return e.anchor.set(.5),e}};var Sn=class extends Re{side;level;constructor(t,e,i){super(t,new Vt(()=>{let s=new I(v.from(`Fire-1-${this.getColor(i)}`));return s.anchor.set(.5),s},Re.resetProjectile,Re.destroyProjectile)),this.level=i,this.side=e,this.body.texture=v.from("Weapon-Side"),this.body.anchor.set(.5),this.body.scale.set(.5),e=="Right"&&(this.body.scale.x*=-1),this.body.visible=this.level!=0,this.setupMuzzleFlash(this.level)}setupMuzzleFlash(t){if(this.flashes.removeChildren(),t>0){let e=this.getColor(t);this.addMuzzleFlash(v.from(`Fire-Exit-1-${e}`),{x:this.side=="Left"?-102:102,y:-72})}}fire(){if(this.level==0)return;super.fire();let t=this.projectiles.getInstance();t.position.set(this.side=="Left"?18:-18,-20),this.onFire.dispatch([t])}getProjectileDamage(){return(this.level*2+5)/2}upgrade(t){this.level=t,this.body.visible=this.level!=0}};var IT={maxHealth:100,baseHealth:45},Js=class extends ti{leftGun;mainGun;rightGun;magnetEffect;hpEffect;moneyEffect;guns=[];upgrades;constructor(t,e){super(),this.upgrades=e;let i=`Player-Car-${t+1}`;this.body.texture=v.from(i),this.resizeHitbox(),this.mainGun=new _l({firePeriodMS:150},e.damage),this.guns.push(this.mainGun),this.resetHP(e.armor),this.addChild(this.body),this.addChild(this.mainGun.flashes),this.addChild(this.mainGun.body),this.addSideGuns(e.guns),this.magnetEffect=new vn("shield_loop",{scale:2,speed:.2,loop:!0}),this.magnetEffect.tint=3386111,this.addChild(this.magnetEffect),this.magnetEffect.visible=!1,new lt(this.magnetEffect).from({alpha:.5}).to({alpha:.8},300).repeat(1/0).yoyo().easing(at.Sinusoidal.InOut).start(),this.hpEffect=new vn("hp_loop",{scale:2,speed:.3,loop:!1}),this.addChild(this.hpEffect),this.hpEffect.visible=!1,this.moneyEffect=new I(v.from("x2-effect")),this.moneyEffect.anchor.set(.5),this.moneyEffect.scale.set(2),this.moneyEffect.y+=10,new lt(this.moneyEffect.scale).to({x:1.8,y:1.8},600).repeat(1/0).yoyo().easing(at.Sinusoidal.InOut).start(),this.addChild(this.moneyEffect),this.moneyEffect.visible=!1}addSideGuns(t){this.leftGun=new Sn({},"Left",t),this.rightGun=new Sn({},"Right",t),this.leftGun.body.x=-this.body.width/2,this.rightGun.body.x=this.body.width/2,this.guns.push(this.leftGun),this.guns.push(this.rightGun),this.addChild(this.leftGun.flashes),this.addChild(this.leftGun.body),this.addChild(this.rightGun.flashes),this.addChild(this.rightGun.body)}isFullHealth(){return this.health===this.getMaxHealth(this.upgrades.armor)}resetHP(t){this.health=this.getMaxHealth(t)}getMaxHealth(t){return IT.baseHealth+t*4}updateGuns(t){this.guns.forEach(e=>e.update(t))}setFiringPermission(t){this.guns.forEach(e=>e.canFire=t)}};var ri=(r=>(r[r.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",r[r.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",r))(ri||{});var bl={willReadFrequently:!0},dr=class Q{static get experimentalLetterSpacingSupported(){let t=Q._experimentalLetterSpacingSupported;if(t!==void 0){let e=C.ADAPTER.getCanvasRenderingContext2D().prototype;t=Q._experimentalLetterSpacingSupported="letterSpacing"in e||"textLetterSpacing"in e}return t}constructor(t,e,i,s,o,n,a,l,h){this.text=t,this.style=e,this.width=i,this.height=s,this.lines=o,this.lineWidths=n,this.lineHeight=a,this.maxLineWidth=l,this.fontProperties=h}static measureText(t,e,i,s=Q._canvas){i=i??e.wordWrap;let o=e.toFontString(),n=Q.measureFont(o);n.fontSize===0&&(n.fontSize=e.fontSize,n.ascent=e.fontSize);let a=s.getContext("2d",bl);a.font=o;let l=(i?Q.wordWrap(t,e,s):t).split(/(?:\r\n|\r|\n)/),h=new Array(l.length),c=0;for(let f=0;f<l.length;f++){let m=Q._measureText(l[f],e.letterSpacing,a);h[f]=m,c=Math.max(c,m)}let u=c+e.strokeThickness;e.dropShadow&&(u+=e.dropShadowDistance);let d=e.lineHeight||n.fontSize+e.strokeThickness,p=Math.max(d,n.fontSize+e.strokeThickness*2)+e.leading+(l.length-1)*(d+e.leading);return e.dropShadow&&(p+=e.dropShadowDistance),new Q(t,e,u,p,l,h,d+e.leading,c,n)}static _measureText(t,e,i){let s=!1;Q.experimentalLetterSpacingSupported&&(Q.experimentalLetterSpacing?(i.letterSpacing=`${e}px`,i.textLetterSpacing=`${e}px`,s=!0):(i.letterSpacing="0px",i.textLetterSpacing="0px"));let o=i.measureText(t).width;return o>0&&(s?o-=e:o+=(Q.graphemeSegmenter(t).length-1)*e),o}static wordWrap(t,e,i=Q._canvas){let s=i.getContext("2d",bl),o=0,n="",a="",l=Object.create(null),{letterSpacing:h,whiteSpace:c}=e,u=Q.collapseSpaces(c),d=Q.collapseNewlines(c),p=!u,f=e.wordWrapWidth+h,m=Q.tokenize(t);for(let g=0;g<m.length;g++){let x=m[g];if(Q.isNewline(x)){if(!d){a+=Q.addLine(n),p=!u,n="",o=0;continue}x=" "}if(u){let y=Q.isBreakingSpace(x),_=Q.isBreakingSpace(n[n.length-1]);if(y&&_)continue}let b=Q.getFromCache(x,h,l,s);if(b>f)if(n!==""&&(a+=Q.addLine(n),n="",o=0),Q.canBreakWords(x,e.breakWords)){let y=Q.wordWrapSplit(x);for(let _=0;_<y.length;_++){let L=y[_],W=L,F=1;for(;y[_+F];){let H=y[_+F];if(!Q.canBreakChars(W,H,x,_,e.breakWords))L+=H;else break;W=H,F++}_+=F-1;let B=Q.getFromCache(L,h,l,s);B+o>f&&(a+=Q.addLine(n),p=!1,n="",o=0),n+=L,o+=B}}else{n.length>0&&(a+=Q.addLine(n),n="",o=0);let y=g===m.length-1;a+=Q.addLine(x,!y),p=!1,n="",o=0}else b+o>f&&(p=!1,a+=Q.addLine(n),n="",o=0),(n.length>0||!Q.isBreakingSpace(x)||p)&&(n+=x,o+=b)}return a+=Q.addLine(n,!1),a}static addLine(t,e=!0){return t=Q.trimRight(t),t=e?`${t}
`:t,t}static getFromCache(t,e,i,s){let o=i[t];return typeof o!="number"&&(o=Q._measureText(t,e,s)+e,i[t]=o),o}static collapseSpaces(t){return t==="normal"||t==="pre-line"}static collapseNewlines(t){return t==="normal"}static trimRight(t){if(typeof t!="string")return"";for(let e=t.length-1;e>=0;e--){let i=t[e];if(!Q.isBreakingSpace(i))break;t=t.slice(0,-1)}return t}static isNewline(t){return typeof t!="string"?!1:Q._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,e){return typeof t!="string"?!1:Q._breakingSpaces.includes(t.charCodeAt(0))}static tokenize(t){let e=[],i="";if(typeof t!="string")return e;for(let s=0;s<t.length;s++){let o=t[s],n=t[s+1];if(Q.isBreakingSpace(o,n)||Q.isNewline(o)){i!==""&&(e.push(i),i=""),e.push(o);continue}i+=o}return i!==""&&e.push(i),e}static canBreakWords(t,e){return e}static canBreakChars(t,e,i,s,o){return!0}static wordWrapSplit(t){return Q.graphemeSegmenter(t)}static measureFont(t){if(Q._fonts[t])return Q._fonts[t];let e={ascent:0,descent:0,fontSize:0},i=Q._canvas,s=Q._context;s.font=t;let o=Q.METRICS_STRING+Q.BASELINE_SYMBOL,n=Math.ceil(s.measureText(o).width),a=Math.ceil(s.measureText(Q.BASELINE_SYMBOL).width),l=Math.ceil(Q.HEIGHT_MULTIPLIER*a);if(a=a*Q.BASELINE_MULTIPLIER|0,n===0||l===0)return Q._fonts[t]=e,e;i.width=n,i.height=l,s.fillStyle="#f00",s.fillRect(0,0,n,l),s.font=t,s.textBaseline="alphabetic",s.fillStyle="#000",s.fillText(o,0,a);let h=s.getImageData(0,0,n,l).data,c=h.length,u=n*4,d=0,p=0,f=!1;for(d=0;d<a;++d){for(let m=0;m<u;m+=4)if(h[p+m]!==255){f=!0;break}if(!f)p+=u;else break}for(e.ascent=a-d,p=c-u,f=!1,d=l;d>a;--d){for(let m=0;m<u;m+=4)if(h[p+m]!==255){f=!0;break}if(!f)p-=u;else break}return e.descent=d-a,e.fontSize=e.ascent+e.descent,Q._fonts[t]=e,e}static clearMetrics(t=""){t?delete Q._fonts[t]:Q._fonts={}}static get _canvas(){if(!Q.__canvas){let t;try{let e=new OffscreenCanvas(0,0);if(e.getContext("2d",bl)?.measureText)return Q.__canvas=e,e;t=C.ADAPTER.createCanvas()}catch{t=C.ADAPTER.createCanvas()}t.width=t.height=10,Q.__canvas=t}return Q.__canvas}static get _context(){return Q.__context||(Q.__context=Q._canvas.getContext("2d",bl)),Q.__context}};dr.METRICS_STRING="|\xC9q\xC5",dr.BASELINE_SYMBOL="M",dr.BASELINE_MULTIPLIER=1.4,dr.HEIGHT_MULTIPLIER=2,dr.graphemeSegmenter=(()=>{if(typeof Intl?.Segmenter=="function"){let r=new Intl.Segmenter;return t=>[...r.segment(t)].map(e=>e.segment)}return r=>[...r]})(),dr.experimentalLetterSpacing=!1,dr._fonts={},dr._newlines=[10,13],dr._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];var Ve=dr;var MT=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],cx=class En{constructor(t){this.styleID=0,this.reset(),Ou(this,t,t)}clone(){let t={};return Ou(t,this,En.defaultStyle),new En(t)}reset(){Ou(this,En.defaultStyle,En.defaultStyle)}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(t){let e=Lu(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)}get fill(){return this._fill}set fill(t){let e=Lu(t);this._fill!==e&&(this._fill=e,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(t){RT(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)}get leading(){return this._leading}set leading(t){this._leading!==t&&(this._leading=t,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)}get padding(){return this._padding}set padding(t){this._padding!==t&&(this._padding=t,this.styleID++)}get stroke(){return this._stroke}set stroke(t){let e=Lu(t);this._stroke!==e&&(this._stroke=e,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)}get trim(){return this._trim}set trim(t){this._trim!==t&&(this._trim=t,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)}toFontString(){let t=typeof this.fontSize=="number"?`${this.fontSize}px`:this.fontSize,e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(let i=e.length-1;i>=0;i--){let s=e[i].trim();!/([\"\'])[^\'\"]+\1/.test(s)&&!MT.includes(s)&&(s=`"${s}"`),e[i]=s}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${t} ${e.join(",")}`}};cx.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:ri.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};var Te=cx;function Lu(r){let t=tt.shared,e=i=>{let s=t.setValue(i);return s.alpha===1?s.toHex():s.toRgbaString()};return Array.isArray(r)?r.map(e):e(r)}function RT(r,t){if(!Array.isArray(r)||!Array.isArray(t)||r.length!==t.length)return!1;for(let e=0;e<r.length;++e)if(r[e]!==t[e])return!1;return!0}function Ou(r,t,e){for(let i in e)Array.isArray(t[i])?r[i]=t[i].slice():r[i]=t[i]}var FT={texture:!0,children:!1,baseTexture:!0},ux=class ku extends I{constructor(t,e,i){let s=!1;i||(i=C.ADAPTER.createCanvas(),s=!0),i.width=3,i.height=3;let o=v.from(i);o.orig=new Y,o.trim=new Y,super(o),this._ownCanvas=s,this.canvas=i,this.context=i.getContext("2d",{willReadFrequently:!0}),this._resolution=ku.defaultResolution??C.RESOLUTION,this._autoResolution=ku.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=t,this.style=e,this.localStyleID=-1}static get experimentalLetterSpacing(){return Ve.experimentalLetterSpacing}static set experimentalLetterSpacing(t){w.deprecation("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),Ve.experimentalLetterSpacing=t}updateText(t){let e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;this._font=this._style.toFontString();let i=this.context,s=Ve.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),o=s.width,n=s.height,a=s.lines,l=s.lineHeight,h=s.lineWidths,c=s.maxLineWidth,u=s.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,o)+e.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,n)+e.padding*2)*this._resolution),i.scale(this._resolution,this._resolution),i.clearRect(0,0,this.canvas.width,this.canvas.height),i.font=this._font,i.lineWidth=e.strokeThickness,i.textBaseline=e.textBaseline,i.lineJoin=e.lineJoin,i.miterLimit=e.miterLimit;let d,p,f=e.dropShadow?2:1;for(let m=0;m<f;++m){let g=e.dropShadow&&m===0,x=g?Math.ceil(Math.max(1,n)+e.padding*2):0,b=x*this._resolution;if(g){i.fillStyle="black",i.strokeStyle="black";let _=e.dropShadowColor,L=e.dropShadowBlur*this._resolution,W=e.dropShadowDistance*this._resolution;i.shadowColor=tt.shared.setValue(_).setAlpha(e.dropShadowAlpha).toRgbaString(),i.shadowBlur=L,i.shadowOffsetX=Math.cos(e.dropShadowAngle)*W,i.shadowOffsetY=Math.sin(e.dropShadowAngle)*W+b}else i.fillStyle=this._generateFillStyle(e,a,s),i.strokeStyle=e.stroke,i.shadowColor="black",i.shadowBlur=0,i.shadowOffsetX=0,i.shadowOffsetY=0;let y=(l-u.fontSize)/2;l-u.fontSize<0&&(y=0);for(let _=0;_<a.length;_++)d=e.strokeThickness/2,p=e.strokeThickness/2+_*l+u.ascent+y,e.align==="right"?d+=c-h[_]:e.align==="center"&&(d+=(c-h[_])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(a[_],d+e.padding,p+e.padding-x,!0),e.fill&&this.drawLetterSpacing(a[_],d+e.padding,p+e.padding-x)}this.updateTexture()}drawLetterSpacing(t,e,i,s=!1){let o=this._style.letterSpacing,n=!1;if(Ve.experimentalLetterSpacingSupported&&(Ve.experimentalLetterSpacing?(this.context.letterSpacing=`${o}px`,this.context.textLetterSpacing=`${o}px`,n=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),o===0||n){s?this.context.strokeText(t,e,i):this.context.fillText(t,e,i);return}let a=e,l=Ve.graphemeSegmenter(t),h=this.context.measureText(t).width,c=0;for(let u=0;u<l.length;++u){let d=l[u];s?this.context.strokeText(d,a,i):this.context.fillText(d,a,i);let p="";for(let f=u+1;f<l.length;++f)p+=l[f];c=this.context.measureText(p).width,a+=h-c+o,h=c}}updateTexture(){let t=this.canvas;if(this._style.trim){let n=w.trimCanvas(t);n.data&&(t.width=n.width,t.height=n.height,this.context.putImageData(n.data,0,0))}let e=this._texture,i=this._style,s=i.trim?0:i.padding,o=e.baseTexture;e.trim.width=e._frame.width=t.width/this._resolution,e.trim.height=e._frame.height=t.height/this._resolution,e.trim.x=-s,e.trim.y=-s,e.orig.width=e._frame.width-s*2,e.orig.height=e._frame.height-s*2,this._onTextureUpdate(),o.setRealSize(t.width,t.height,this._resolution),e.updateUvs(),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(t,e){return this.updateText(!0),this._textureID===-1&&(t=!1),super.getBounds(t,e)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds.call(this,t)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(t,e,i){let s=t.fill;if(Array.isArray(s)){if(s.length===1)return s[0]}else return s;let o,n=t.dropShadow?t.dropShadowDistance:0,a=t.padding||0,l=this.canvas.width/this._resolution-n-a*2,h=this.canvas.height/this._resolution-n-a*2,c=s.slice(),u=t.fillGradientStops.slice();if(!u.length){let d=c.length+1;for(let p=1;p<d;++p)u.push(p/d)}if(c.unshift(s[0]),u.unshift(0),c.push(s[s.length-1]),u.push(1),t.fillGradientType===ri.LINEAR_VERTICAL){o=this.context.createLinearGradient(l/2,a,l/2,h+a);let d=i.fontProperties.fontSize+t.strokeThickness;for(let p=0;p<e.length;p++){let f=i.lineHeight*(p-1)+d,m=i.lineHeight*p,g=m;p>0&&f>m&&(g=(m+f)/2);let x=m+d,b=i.lineHeight*(p+1),y=x;p+1<e.length&&b<x&&(y=(x+b)/2);let _=(y-g)/h;for(let L=0;L<c.length;L++){let W=0;typeof u[L]=="number"?W=u[L]:W=L/c.length;let F=Math.min(1,Math.max(0,g/h+W*_));F=Number(F.toFixed(5)),o.addColorStop(F,c[L])}}}else{o=this.context.createLinearGradient(a,h/2,l+a,h/2);let d=c.length+1,p=1;for(let f=0;f<c.length;f++){let m;typeof u[f]=="number"?m=u[f]:m=p/d,o.addColorStop(m,c[f]),p++}}return o}destroy(t){typeof t=="boolean"&&(t={children:t}),t=Object.assign({},FT,t),super.destroy(t),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(t){this.updateText(!0);let e=w.sign(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(t){this.updateText(!0);let e=w.sign(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get style(){return this._style}set style(t){t=t||{},t instanceof Te?this._style=t:this._style=new Te(t),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(t){t=String(t??""),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}};ux.defaultAutoResolution=!0;var rt=ux;var Nu={en:{Race:"Race",Rank:"Rank",Name:"Name",Rep:"Rep","Rep:":"Rep:",Upgrade:"Upgrade","More games":"More games",Settings:"Settings",Music:"Music",Sounds:"Sounds",Armor:"Armor","Main gun":"Main gun","Extra guns":"Extra guns",Max:"Max","Tap to play":`Tap and hold
to play`,Restart:"Restart",Home:"Home",s:"s",Boss:"Boss!","Boss defeated":"Boss Defeated!",Bounty:"Bounty",Reward:"Reward",Continue:"Continue",Busted:"Busted!","Continue?":"Continue?",Yes:"Yes",Victory:"Victory!",Defeat:"Defeat!"},ru:{Race:"\u0413\u043E\u043D\u043A\u0430",Rank:"\u041C\u0435\u0441\u0442\u043E",Name:"\u0418\u043C\u044F",Rep:"\u0421\u0447\u0451\u0442","Rep:":"\u0421\u0447\u0451\u0442:",Upgrade:"\u0423\u043B\u0443\u0447\u0448\u0435\u043D\u0438\u044F","More games":"\u0411\u043E\u043B\u044C\u0448\u0435 \u0438\u0433\u0440",Settings:"\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438",Music:"\u041C\u0443\u0437\u044B\u043A\u0430",Sounds:"\u0417\u0432\u0443\u043A\u0438",Armor:"\u0411\u0440\u043E\u043D\u044F","Main gun":"\u041E\u0440\u0443\u0436\u0438\u0435","Extra guns":"\u0414\u043E\u043F. \u043F\u0443\u0448\u043A\u0438",Max:"\u041C\u0430\u043A\u0441.","Tap to play":`\u0423\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0439 \u0442\u0430\u043F,
\u0447\u0442\u043E\u0431\u044B \u0435\u0445\u0430\u0442\u044C`,Restart:"\u0417\u0430\u043D\u043E\u0432\u043E",Home:"\u041C\u0435\u043D\u044E",s:"\u0441.",Boss:"\u0411\u043E\u0441\u0441!","Boss defeated":"\u0411\u043E\u0441\u0441 \u043F\u043E\u0431\u0435\u0436\u0434\u0451\u043D!",Bounty:"\u041D\u0430\u0433\u0440\u0430\u0434\u0430",Reward:"\u041D\u0430\u0433\u0440\u0430\u0434\u0430",Continue:"\u0414\u0430\u043B\u0435\u0435",Busted:"\u0412 \u043B\u0435\u043F\u0451\u0448\u043A\u0443!","Continue?":"\u041F\u0440\u043E\u0434\u043E\u043B\u0436\u0438\u0442\u044C?",Yes:"\u0414\u0430",Victory:"\u041F\u043E\u0431\u0435\u0434\u0430!",Defeat:"\u041F\u043E\u0440\u0430\u0436\u0435\u043D\u0438\u0435!"}};var N=class r{static locale="en";static font="rajdhani";static setLocale(t){Object.keys(Nu).includes(t)&&(r.locale=t),r.locale=="ru"&&(r.font="rubik")}static getText(t){return Nu[r.locale][t]||t}};var Uu={evenRowColor:1323346,oddRowColor:1787253,playerRowColor:16774656},Tl=class extends D{bg;rankText;nameText;repIcon;repCountText;formatter;constructor(t){super(),this.bg=new I(v.from("panel-lb-entry")),this.bg.tint=this.getColor(t,!1),this.formatter=Intl.NumberFormat("en",{notation:"compact"});let e={fontFamily:N.font,fill:16777215,fontSize:54};this.rankText=new rt(t.toString(),e),this.nameText=new rt("",e),this.repIcon=new I(v.from("icon-rep")),this.repCountText=new rt("",e),this.bg.anchor.set(.5),this.rankText.anchor.set(.5,.5),this.nameText.anchor.set(0,.5),this.repIcon.anchor.set(.5,.5),this.repCountText.anchor.set(0,.5);let i=this.bg.getBounds().left,s=this.bg.getBounds().right;this.rankText.x=i+70,this.nameText.x=i+150,this.repCountText.x=s-200,this.repIcon.x=this.repCountText.x-80,this.addChild(this.bg),this.addChild(this.rankText),this.addChild(this.nameText),this.addChild(this.repIcon),this.addChild(this.repCountText)}fillData(t,e,i,s=!1){this.bg.tint=this.getColor(t,s),this.rankText.text=t.toString(),this.rankText.style.fill=s?65793:16777215,this.nameText.text=e.toString(),this.nameText.style.fill=s?65793:16777215,this.repCountText.text=this.formatter.format(i),this.repCountText.style.fill=s?65793:16777215}getColor(t,e){return e?Uu.playerRowColor:t%2==1?Uu.oddRowColor:Uu.evenRowColor}};var wl=class extends D{bg;rankLabel;nameLabel;repLabel;constructor(){super(),this.bg=new I(v.from("panel-lb-entry")),this.bg.scale.y=.8,this.bg.tint=926265;let t={fontFamily:N.font,fill:16777215,fontSize:40};this.rankLabel=new rt(N.getText("Rank").toUpperCase(),t),this.nameLabel=new rt(N.getText("Name").toUpperCase(),t),this.repLabel=new rt(N.getText("Rep").toUpperCase(),t),this.bg.anchor.set(.5),this.rankLabel.anchor.set(.5,.5),this.nameLabel.anchor.set(0,.5),this.repLabel.anchor.set(0,.5);let e=this.bg.getBounds().left,i=this.bg.getBounds().right;this.rankLabel.x=e+70,this.nameLabel.x=e+150,this.repLabel.x=i-200,this.addChild(this.bg),this.addChild(this.rankLabel),this.addChild(this.nameLabel),this.addChild(this.repLabel)}};var pr={name:"Reputation",rows:5,maxNameLength:15};var Cl=class extends D{header;entries;constructor(){super(),this.header=new wl,this.addChild(this.header),this.createEntries()}createEntries(){this.entries=[];for(let t=0;t<pr.rows;t++){let e=new Tl(t+1);e.y=this.header.getBounds().bottom+e.height/2+e.height*t,this.entries.push(e),this.addChild(e),e.visible=!1}}displayEntries(t,e){let i=e-1>4?4:e-1;for(let s=0;s<Math.min(pr.rows,t.length);s++){let o=s==i,n=o?e:s+1;this.entries[s].fillData(n,this.formatDisplayName(t[s].player.publicName),t[s].score,o),this.entries[s].visible=!0}}formatDisplayName(t){let e=0,i="";for(let s of t.split(" ")){if(e+=s.length+1,e>pr.maxNameLength)return i+=" "+s.substring(0,1)+".",i;i+=" "+s}return i}};var dx=["MoneyBill","MoneyStack","Health","Magnet","MoneyX2"],Qe={MoneyBill:{textureKey:"MoneyBill"},MoneyStack:{textureKey:"MoneyStack"},Health:{textureKey:"Heal"},Magnet:{textureKey:"Magnet",durationMS:5e3},MoneyX2:{textureKey:"X2",durationMS:3e3}},fr={maxVerticalVelocity:2,maxHorizVelocity:.6,spinVelocity:.1,gravity:.005,magnetPower:2},Sl=class extends I{kind;velocity;constructor(t){super(),this.velocity=new $,this.anchor.set(.5),this.reset(t)}reset(t){this.kind=t,this.texture=v.from(Qe[t].textureKey),this.velocity.set(Math.random()*fr.maxHorizVelocity*2-fr.maxHorizVelocity,-Math.random()*.5)}applyGravity(t){this.velocity.y=Math.min(fr.maxVerticalVelocity,this.velocity.y+fr.gravity*t)}applyMagnet(t,e){let i=t.x-this.x,s=t.y-this.y,o=i*i+s*s,n=fr.magnetPower/Math.sqrt(o);Math.abs(i)>50?this.velocity.x+=n*Math.sign(i)*e:this.velocity.x*=.95,this.velocity.x<-fr.maxHorizVelocity&&(this.velocity.x=-fr.maxHorizVelocity),this.velocity.x>fr.maxHorizVelocity&&(this.velocity.x=fr.maxHorizVelocity)}move(t){this.y+=this.velocity.y*t,this.x+=this.velocity.x*t}spin(t){this.angle+=fr.spinVelocity*t*Math.sign(this.velocity.x)}bounceOffRoadBorders(t,e){e.left<t.left&&(this.velocity.x=-this.velocity.x,this.x+=t.left-e.left),e.right>t.right&&(this.velocity.x=-this.velocity.x,this.x-=e.right-t.right)}};var px=new ot;pt.prototype._cacheAsBitmap=!1;pt.prototype._cacheData=null;pt.prototype._cacheAsBitmapResolution=null;pt.prototype._cacheAsBitmapMultisample=null;var Gu=class{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}};Object.defineProperties(pt.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(r){r!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=r,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(r){r!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=r,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(r){if(this._cacheAsBitmap===r)return;this._cacheAsBitmap=r;let t;r?(this._cacheData||(this._cacheData=new Gu),t=this._cacheData,t.originalRender=this.render,t.originalRenderCanvas=this.renderCanvas,t.originalUpdateTransform=this.updateTransform,t.originalCalculateBounds=this.calculateBounds,t.originalGetLocalBounds=this.getLocalBounds,t.originalDestroy=this.destroy,t.originalContainsPoint=this.containsPoint,t.originalMask=this._mask,t.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(t=this._cacheData,t.sprite&&this._destroyCachedDisplayObject(),this.render=t.originalRender,this.renderCanvas=t.originalRenderCanvas,this.calculateBounds=t.originalCalculateBounds,this.getLocalBounds=t.originalGetLocalBounds,this.destroy=t.originalDestroy,this.updateTransform=t.originalUpdateTransform,this.containsPoint=t.originalContainsPoint,this._mask=t.originalMask,this.filterArea=t.originalFilterArea)}}});pt.prototype._renderCached=function(r){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(r),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(r))};pt.prototype._initCachedDisplayObject=function(r){if(this._cacheData?.sprite)return;let t=this.alpha;this.alpha=1,r.batch.flush();let e=this.getLocalBounds(new Y,!0);if(this.filters?.length){let d=this.filters[0].padding;e.pad(d)}let i=this.cacheAsBitmapResolution||r.resolution;e.ceil(i),e.width=Math.max(e.width,1/i),e.height=Math.max(e.height,1/i);let s=r.renderTexture.current,o=r.renderTexture.sourceFrame.clone(),n=r.renderTexture.destinationFrame.clone(),a=r.projection.transform,l=Oe.create({width:e.width,height:e.height,resolution:i,multisample:this.cacheAsBitmapMultisample??r.multisample}),h=`cacheAsBitmap_${w.uid()}`;this._cacheData.textureCacheId=h,K.addToCache(l.baseTexture,h),v.addToCache(l,h);let c=this.transform.localTransform.copyTo(px).invert().translate(-e.x,-e.y);this.render=this._cacheData.originalRender,r.render(this,{renderTexture:l,clear:!0,transform:c,skipUpdateTransform:!1}),r.framebuffer.blit(),r.projection.transform=a,r.renderTexture.bind(s,o,n),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=t;let u=new I(l);u.transform.worldTransform=this.transform.worldTransform,u.anchor.x=-(e.x/e.width),u.anchor.y=-(e.y/e.height),u.alpha=t,u._bounds=this._bounds,this._cacheData.sprite=u,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=u.containsPoint.bind(u)};pt.prototype._renderCachedCanvas=function(r){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(r),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(r))};pt.prototype._initCachedDisplayObjectCanvas=function(r){if(this._cacheData?.sprite)return;let t=this.getLocalBounds(new Y,!0),e=this.alpha;this.alpha=1;let i=r.canvasContext.activeContext,s=r._projTransform,o=this.cacheAsBitmapResolution||r.resolution;t.ceil(o),t.width=Math.max(t.width,1/o),t.height=Math.max(t.height,1/o);let n=Oe.create({width:t.width,height:t.height,resolution:o}),a=`cacheAsBitmap_${w.uid()}`;this._cacheData.textureCacheId=a,K.addToCache(n.baseTexture,a),v.addToCache(n,a);let l=px;this.transform.localTransform.copyTo(l),l.invert(),l.tx-=t.x,l.ty-=t.y,this.renderCanvas=this._cacheData.originalRenderCanvas,r.render(this,{renderTexture:n,clear:!0,transform:l,skipUpdateTransform:!1}),r.canvasContext.activeContext=i,r._projTransform=s,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=e;let h=new I(n);h.transform.worldTransform=this.transform.worldTransform,h.anchor.x=-(t.x/t.width),h.anchor.y=-(t.y/t.height),h.alpha=e,h._bounds=this._bounds,this._cacheData.sprite=h,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=r._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=h.containsPoint.bind(h)};pt.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};pt.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};pt.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,K.removeFromCache(this._cacheData.textureCacheId),v.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};pt.prototype._cacheAsBitmapDestroy=function(r){this.cacheAsBitmap=!1,this.destroy(r)};pt.prototype.name=null;D.prototype.getChildByName=function(r,t){for(let e=0,i=this.children.length;e<i;e++)if(this.children[e].name===r)return this.children[e];if(t)for(let e=0,i=this.children.length;e<i;e++){let s=this.children[e];if(!s.getChildByName)continue;let o=s.getChildByName(r,!0);if(o)return o}return null};pt.prototype.getGlobalPosition=function(r=new $,t=!1){return this.parent?this.parent.toGlobal(this.position,r,t):(r.x=this.position.x,r.y=this.position.y),r};var fx=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;var ji=class extends z{constructor(){let t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(en,fx,t),this.alpha=1}_loadMatrix(t,e=!1){let i=t;e&&(this._multiply(i,this.uniforms.m,t),i=this._colorMatrix(i)),this.uniforms.m=i}_multiply(t,e,i){return t[0]=e[0]*i[0]+e[1]*i[5]+e[2]*i[10]+e[3]*i[15],t[1]=e[0]*i[1]+e[1]*i[6]+e[2]*i[11]+e[3]*i[16],t[2]=e[0]*i[2]+e[1]*i[7]+e[2]*i[12]+e[3]*i[17],t[3]=e[0]*i[3]+e[1]*i[8]+e[2]*i[13]+e[3]*i[18],t[4]=e[0]*i[4]+e[1]*i[9]+e[2]*i[14]+e[3]*i[19]+e[4],t[5]=e[5]*i[0]+e[6]*i[5]+e[7]*i[10]+e[8]*i[15],t[6]=e[5]*i[1]+e[6]*i[6]+e[7]*i[11]+e[8]*i[16],t[7]=e[5]*i[2]+e[6]*i[7]+e[7]*i[12]+e[8]*i[17],t[8]=e[5]*i[3]+e[6]*i[8]+e[7]*i[13]+e[8]*i[18],t[9]=e[5]*i[4]+e[6]*i[9]+e[7]*i[14]+e[8]*i[19]+e[9],t[10]=e[10]*i[0]+e[11]*i[5]+e[12]*i[10]+e[13]*i[15],t[11]=e[10]*i[1]+e[11]*i[6]+e[12]*i[11]+e[13]*i[16],t[12]=e[10]*i[2]+e[11]*i[7]+e[12]*i[12]+e[13]*i[17],t[13]=e[10]*i[3]+e[11]*i[8]+e[12]*i[13]+e[13]*i[18],t[14]=e[10]*i[4]+e[11]*i[9]+e[12]*i[14]+e[13]*i[19]+e[14],t[15]=e[15]*i[0]+e[16]*i[5]+e[17]*i[10]+e[18]*i[15],t[16]=e[15]*i[1]+e[16]*i[6]+e[17]*i[11]+e[18]*i[16],t[17]=e[15]*i[2]+e[16]*i[7]+e[17]*i[12]+e[18]*i[17],t[18]=e[15]*i[3]+e[16]*i[8]+e[17]*i[13]+e[18]*i[18],t[19]=e[15]*i[4]+e[16]*i[9]+e[17]*i[14]+e[18]*i[19]+e[19],t}_colorMatrix(t){let e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e}brightness(t,e){let i=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(i,e)}tint(t,e){let[i,s,o]=tt.shared.setValue(t).toArray(),n=[i,0,0,0,0,0,s,0,0,0,0,0,o,0,0,0,0,0,1,0];this._loadMatrix(n,e)}greyscale(t,e){let i=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(i,e)}blackAndWhite(t){let e=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(e,t)}hue(t,e){t=(t||0)/180*Math.PI;let i=Math.cos(t),s=Math.sin(t),o=Math.sqrt,n=1/3,a=o(n),l=i+(1-i)*n,h=n*(1-i)-a*s,c=n*(1-i)+a*s,u=n*(1-i)+a*s,d=i+n*(1-i),p=n*(1-i)-a*s,f=n*(1-i)-a*s,m=n*(1-i)+a*s,g=i+n*(1-i),x=[l,h,c,0,0,u,d,p,0,0,f,m,g,0,0,0,0,0,1,0];this._loadMatrix(x,e)}contrast(t,e){let i=(t||0)+1,s=-.5*(i-1),o=[i,0,0,0,s,0,i,0,0,s,0,0,i,0,s,0,0,0,1,0];this._loadMatrix(o,e)}saturate(t=0,e){let i=t*2/3+1,s=(i-1)*-.5,o=[i,s,s,0,0,s,i,s,0,0,s,s,i,0,0,0,0,0,1,0];this._loadMatrix(o,e)}desaturate(){this.saturate(-1)}negative(t){let e=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(e,t)}sepia(t){let e=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(e,t)}technicolor(t){let e=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(e,t)}polaroid(t){let e=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(e,t)}toBGR(t){let e=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(e,t)}kodachrome(t){let e=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(e,t)}browni(t){let e=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(e,t)}vintage(t){let e=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(e,t)}colorTone(t,e,i,s,o){t=t||.2,e=e||.15,i=i||16770432,s=s||3375104;let n=tt.shared,[a,l,h]=n.setValue(i).toArray(),[c,u,d]=n.setValue(s).toArray(),p=[.3,.59,.11,0,0,a,l,h,t,0,c,u,d,e,0,a-c,l-u,h-d,0,0];this._loadMatrix(p,o)}night(t,e){t=t||.1;let i=[t*-2,-t,0,0,0,-t,0,t,0,0,0,t,t*2,0,0,0,0,0,1,0];this._loadMatrix(i,e)}predator(t,e){let i=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(i,e)}lsd(t){let e=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(e,t)}reset(){let t=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(t,!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}};ji.prototype.grayscale=ji.prototype.greyscale;var mx=`varying vec2 vFilterCoord;
varying vec2 vTextureCoord;

uniform vec2 scale;
uniform mat2 rotation;
uniform sampler2D uSampler;
uniform sampler2D mapSampler;

uniform highp vec4 inputSize;
uniform vec4 inputClamp;

void main(void)
{
  vec4 map =  texture2D(mapSampler, vFilterCoord);

  map -= 0.5;
  map.xy = scale * inputSize.zw * (rotation * map.xy);

  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));
}
`;var gx=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;
uniform mat3 filterMatrix;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
	gl_Position = filterVertexPosition();
	vTextureCoord = filterTextureCoord();
	vFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;
}
`;var An=class extends z{constructor(t,e){let i=new ot;t.renderable=!1,super(gx,mx,{mapSampler:t._texture,filterMatrix:i,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=t,this.maskMatrix=i,e==null&&(e=20),this.scale=new $(e,e)}apply(t,e,i,s){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;let o=this.maskSprite.worldTransform,n=Math.sqrt(o.a*o.a+o.b*o.b),a=Math.sqrt(o.c*o.c+o.d*o.d);n!==0&&a!==0&&(this.uniforms.rotation[0]=o.a/n,this.uniforms.rotation[1]=o.b/n,this.uniforms.rotation[2]=o.c/a,this.uniforms.rotation[3]=o.d/a),t.applyFilter(this,e,i,s)}get map(){return this.uniforms.mapSampler}set map(t){this.uniforms.mapSampler=t}};var xx=`varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;
uniform sampler2D uSampler;
uniform highp vec4 inputSize;


/**
 Basic FXAA implementation based on the code on geeks3d.com with the
 modification that the texture2DLod stuff was removed since it's
 unsupported by WebGL.

 --

 From:
 https://github.com/mitsuhiko/webgl-meincraft

 Copyright (c) 2011 by Armin Ronacher.

 Some rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are
 met:

 * Redistributions of source code must retain the above copyright
 notice, this list of conditions and the following disclaimer.

 * Redistributions in binary form must reproduce the above
 copyright notice, this list of conditions and the following
 disclaimer in the documentation and/or other materials provided
 with the distribution.

 * The names of the contributors may not be used to endorse or
 promote products derived from this software without specific
 prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef FXAA_REDUCE_MIN
#define FXAA_REDUCE_MIN   (1.0/ 128.0)
#endif
#ifndef FXAA_REDUCE_MUL
#define FXAA_REDUCE_MUL   (1.0 / 8.0)
#endif
#ifndef FXAA_SPAN_MAX
#define FXAA_SPAN_MAX     8.0
#endif

//optimized version for mobile, where dependent
//texture reads can be a bottleneck
vec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,
          vec2 v_rgbNW, vec2 v_rgbNE,
          vec2 v_rgbSW, vec2 v_rgbSE,
          vec2 v_rgbM) {
    vec4 color;
    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;
    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;
    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;
    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;
    vec4 texColor = texture2D(tex, v_rgbM);
    vec3 rgbM  = texColor.xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    mediump vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
                  dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +
                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, texColor.a);
    else
        color = vec4(rgbB, texColor.a);
    return color;
}

void main() {

      vec4 color;

      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);

      gl_FragColor = color;
}
`;var yx=`
attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

void texcoords(vec2 fragCoord, vec2 inverseVP,
               out vec2 v_rgbNW, out vec2 v_rgbNE,
               out vec2 v_rgbSW, out vec2 v_rgbSE,
               out vec2 v_rgbM) {
    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;
    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;
    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;
    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;
    v_rgbM = vec2(fragCoord * inverseVP);
}

void main(void) {

   gl_Position = filterVertexPosition();

   vFragCoord = aVertexPosition * outputFrame.zw;

   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);
}
`;var Pn=class extends z{constructor(){super(yx,xx)}};var vx=`precision highp float;

varying vec2 vTextureCoord;
varying vec4 vColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * uSeed);
    float diff = (randomValue - 0.5) * uNoise;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    gl_FragColor = color;
}
`;var In=class extends z{constructor(t=.5,e=Math.random()){super(en,vx,{uNoise:0,uSeed:0}),this.noise=t,this.seed=e}get noise(){return this.uniforms.uNoise}set noise(t){this.uniforms.uNoise=t}get seed(){return this.uniforms.uSeed}set seed(t){this.uniforms.uSeed=t}};var zu={AlphaFilter:Zs,BlurFilter:Cn,BlurFilterPass:Fr,ColorMatrixFilter:ji,DisplacementFilter:An,FXAAFilter:Pn,NoiseFilter:In};Object.entries(zu).forEach(([r,t])=>{Object.defineProperty(zu,r,{get(){return w.deprecation("7.1.0",`filters.${r} has moved to ${r}`),t}})});var Hu=class{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(t){this.removeTickerListener(),this.events=t,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(t){this._pauseUpdate=t}addTickerListener(){this.tickerAdded||!this.domElement||(ut.system.add(this.tickerUpdate,this,ve.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(ut.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove){this._didMove=!1;return}let t=this.events.rootPointerEvent;this.events.supportsTouchEvents&&t.pointerType==="touch"||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:t.clientX,clientY:t.clientY}))}tickerUpdate(t){this._deltaTime+=t,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())}},mr=new Hu;var Dr=class r{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=r.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new $,this.page=new $,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,e,i){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,e,i,s,o){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}};var gr=class extends Dr{constructor(){super(...arguments),this.client=new $,this.movement=new $,this.offset=new $,this.global=new $,this.screen=new $}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(t,e,i){return t.worldTransform.applyInverse(i||this.global,e)}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,i,s,o,n,a,l,h,c,u,d,p,f,m){throw new Error("Method not implemented.")}};var oe=class extends gr{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}};var Je=class extends gr{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}};Je.DOM_DELTA_PIXEL=0,Je.DOM_DELTA_LINE=1,Je.DOM_DELTA_PAGE=2;var BT=2048,LT=new $,Vu=new $,Mn=class{constructor(t){this.dispatch=new w.EventEmitter,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort((i,s)=>i.priority-s.priority)}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){if(!this.rootTarget)return;let e=this.mappingTable[t.type];if(e)for(let i=0,s=e.length;i<s;i++)e[i].fn(t);else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,e){mr.pauseUpdate=!0;let i=this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive",s=this[i](this.rootTarget,this.rootTarget.eventMode,LT.set(t,e),this.hitTestFn,this.hitPruneFn);return s&&s[0]}propagate(t,e){if(!t.target)return;let i=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let s=0,o=i.length-1;s<o;s++)if(t.currentTarget=i[s],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!(t.propagationStopped||t.propagationImmediatelyStopped)){t.eventPhase=t.BUBBLING_PHASE;for(let s=i.length-2;s>=0;s--)if(t.currentTarget=i[s],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,e,i=this._allInteractiveElements){if(i.length===0)return;t.eventPhase=t.BUBBLING_PHASE;let s=Array.isArray(e)?e:[e];for(let o=i.length-1;o>=0;o--)s.forEach(n=>{t.currentTarget=i[o],this.notifyTarget(t,n)})}propagationPath(t){let e=[t];for(let i=0;i<BT&&t!==this.rootTarget;i++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}hitTestMoveRecursive(t,e,i,s,o,n=!1){let a=!1;if(this._interactivePrune(t))return null;if((t.eventMode==="dynamic"||e==="dynamic")&&(mr.pauseUpdate=!1),t.interactiveChildren&&t.children){let c=t.children;for(let u=c.length-1;u>=0;u--){let d=c[u],p=this.hitTestMoveRecursive(d,this._isInteractive(e)?e:d.eventMode,i,s,o,n||o(t,i));if(p){if(p.length>0&&!p[p.length-1].parent)continue;let f=t.isInteractive();(p.length>0||f)&&(f&&this._allInteractiveElements.push(t),p.push(t)),this._hitElements.length===0&&(this._hitElements=p),a=!0}}}let l=this._isInteractive(e),h=t.isInteractive();return l&&h&&this._allInteractiveElements.push(t),n||this._hitElements.length>0?null:a?this._hitElements:l&&!o(t,i)&&s(t,i)?h?[t]:[]:null}hitTestRecursive(t,e,i,s,o){if(this._interactivePrune(t)||o(t,i))return null;if((t.eventMode==="dynamic"||e==="dynamic")&&(mr.pauseUpdate=!1),t.interactiveChildren&&t.children){let l=t.children;for(let h=l.length-1;h>=0;h--){let c=l[h],u=this.hitTestRecursive(c,this._isInteractive(e)?e:c.eventMode,i,s,o);if(u){if(u.length>0&&!u[u.length-1].parent)continue;let d=t.isInteractive();return(u.length>0||d)&&u.push(t),u}}}let n=this._isInteractive(e),a=t.isInteractive();return n&&s(t,i)?a?[t]:[]:null}_isInteractive(t){return t==="static"||t==="dynamic"}_interactivePrune(t){return!!(!t||t.isMask||!t.visible||!t.renderable||t.eventMode==="none"||t.eventMode==="passive"&&!t.interactiveChildren||t.isMask)}hitPruneFn(t,e){if(t.hitArea&&(t.worldTransform.applyInverse(e,Vu),!t.hitArea.contains(Vu.x,Vu.y)))return!0;if(t._mask){let i=t._mask.isMaskData?t._mask.maskObject:t._mask;if(i&&!i.containsPoint?.(e))return!0}return!1}hitTestFn(t,e){return t.eventMode==="passive"?!1:t.hitArea?!0:t.containsPoint?t.containsPoint(e):!1}notifyTarget(t,e){e=e??t.type;let i=`on${e}`;t.currentTarget[i]?.(t);let s=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this.notifyListeners(t,s),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}mapPointerDown(t){if(!(t instanceof oe)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}let e=this.createPointerEvent(t);if(this.dispatchEvent(e,"pointerdown"),e.pointerType==="touch")this.dispatchEvent(e,"touchstart");else if(e.pointerType==="mouse"||e.pointerType==="pen"){let s=e.button===2;this.dispatchEvent(e,s?"rightdown":"mousedown")}let i=this.trackingData(t.pointerId);i.pressTargetsByButton[t.button]=e.composedPath(),this.freeEvent(e)}mapPointerMove(t){if(!(t instanceof oe)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;let e=this.createPointerEvent(t);this._isPointerMoveEvent=!1;let i=e.pointerType==="mouse"||e.pointerType==="pen",s=this.trackingData(t.pointerId),o=this.findMountedTarget(s.overTargets);if(s.overTargets?.length>0&&o!==e.target){let l=t.type==="mousemove"?"mouseout":"pointerout",h=this.createPointerEvent(t,l,o);if(this.dispatchEvent(h,"pointerout"),i&&this.dispatchEvent(h,"mouseout"),!e.composedPath().includes(o)){let c=this.createPointerEvent(t,"pointerleave",o);for(c.eventPhase=c.AT_TARGET;c.target&&!e.composedPath().includes(c.target);)c.currentTarget=c.target,this.notifyTarget(c),i&&this.notifyTarget(c,"mouseleave"),c.target=c.target.parent;this.freeEvent(c)}this.freeEvent(h)}if(o!==e.target){let l=t.type==="mousemove"?"mouseover":"pointerover",h=this.clonePointerEvent(e,l);this.dispatchEvent(h,"pointerover"),i&&this.dispatchEvent(h,"mouseover");let c=o?.parent;for(;c&&c!==this.rootTarget.parent&&c!==e.target;)c=c.parent;if(!c||c===this.rootTarget.parent){let u=this.clonePointerEvent(e,"pointerenter");for(u.eventPhase=u.AT_TARGET;u.target&&u.target!==o&&u.target!==this.rootTarget.parent;)u.currentTarget=u.target,this.notifyTarget(u),i&&this.notifyTarget(u,"mouseenter"),u.target=u.target.parent;this.freeEvent(u)}this.freeEvent(h)}let n=[],a=this.enableGlobalMoveEvents??!0;this.moveOnAll?n.push("pointermove"):this.dispatchEvent(e,"pointermove"),a&&n.push("globalpointermove"),e.pointerType==="touch"&&(this.moveOnAll?n.splice(1,0,"touchmove"):this.dispatchEvent(e,"touchmove"),a&&n.push("globaltouchmove")),i&&(this.moveOnAll?n.splice(1,0,"mousemove"):this.dispatchEvent(e,"mousemove"),a&&n.push("globalmousemove"),this.cursor=e.target?.cursor),n.length>0&&this.all(e,n),this._allInteractiveElements.length=0,this._hitElements.length=0,s.overTargets=e.composedPath(),this.freeEvent(e)}mapPointerOver(t){if(!(t instanceof oe)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}let e=this.trackingData(t.pointerId),i=this.createPointerEvent(t),s=i.pointerType==="mouse"||i.pointerType==="pen";this.dispatchEvent(i,"pointerover"),s&&this.dispatchEvent(i,"mouseover"),i.pointerType==="mouse"&&(this.cursor=i.target?.cursor);let o=this.clonePointerEvent(i,"pointerenter");for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==this.rootTarget.parent;)o.currentTarget=o.target,this.notifyTarget(o),s&&this.notifyTarget(o,"mouseenter"),o.target=o.target.parent;e.overTargets=i.composedPath(),this.freeEvent(i),this.freeEvent(o)}mapPointerOut(t){if(!(t instanceof oe)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}let e=this.trackingData(t.pointerId);if(e.overTargets){let i=t.pointerType==="mouse"||t.pointerType==="pen",s=this.findMountedTarget(e.overTargets),o=this.createPointerEvent(t,"pointerout",s);this.dispatchEvent(o),i&&this.dispatchEvent(o,"mouseout");let n=this.createPointerEvent(t,"pointerleave",s);for(n.eventPhase=n.AT_TARGET;n.target&&n.target!==this.rootTarget.parent;)n.currentTarget=n.target,this.notifyTarget(n),i&&this.notifyTarget(n,"mouseleave"),n.target=n.target.parent;e.overTargets=null,this.freeEvent(o),this.freeEvent(n)}this.cursor=null}mapPointerUp(t){if(!(t instanceof oe)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}let e=performance.now(),i=this.createPointerEvent(t);if(this.dispatchEvent(i,"pointerup"),i.pointerType==="touch")this.dispatchEvent(i,"touchend");else if(i.pointerType==="mouse"||i.pointerType==="pen"){let a=i.button===2;this.dispatchEvent(i,a?"rightup":"mouseup")}let s=this.trackingData(t.pointerId),o=this.findMountedTarget(s.pressTargetsByButton[t.button]),n=o;if(o&&!i.composedPath().includes(o)){let a=o;for(;a&&!i.composedPath().includes(a);){if(i.currentTarget=a,this.notifyTarget(i,"pointerupoutside"),i.pointerType==="touch")this.notifyTarget(i,"touchendoutside");else if(i.pointerType==="mouse"||i.pointerType==="pen"){let l=i.button===2;this.notifyTarget(i,l?"rightupoutside":"mouseupoutside")}a=a.parent}delete s.pressTargetsByButton[t.button],n=a}if(n){let a=this.clonePointerEvent(i,"click");a.target=n,a.path=null,s.clicksByButton[t.button]||(s.clicksByButton[t.button]={clickCount:0,target:a.target,timeStamp:e});let l=s.clicksByButton[t.button];if(l.target===a.target&&e-l.timeStamp<200?++l.clickCount:l.clickCount=1,l.target=a.target,l.timeStamp=e,a.detail=l.clickCount,a.pointerType==="mouse"){let h=a.button===2;this.dispatchEvent(a,h?"rightclick":"click")}else a.pointerType==="touch"&&this.dispatchEvent(a,"tap");this.dispatchEvent(a,"pointertap"),this.freeEvent(a)}this.freeEvent(i)}mapPointerUpOutside(t){if(!(t instanceof oe)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}let e=this.trackingData(t.pointerId),i=this.findMountedTarget(e.pressTargetsByButton[t.button]),s=this.createPointerEvent(t);if(i){let o=i;for(;o;)s.currentTarget=o,this.notifyTarget(s,"pointerupoutside"),s.pointerType==="touch"?this.notifyTarget(s,"touchendoutside"):(s.pointerType==="mouse"||s.pointerType==="pen")&&this.notifyTarget(s,s.button===2?"rightupoutside":"mouseupoutside"),o=o.parent;delete e.pressTargetsByButton[t.button]}this.freeEvent(s)}mapWheel(t){if(!(t instanceof Je)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}let e=this.createWheelEvent(t);this.dispatchEvent(e),this.freeEvent(e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let i=1;i<t.length&&t[i].parent===e;i++)e=t[i];return e}createPointerEvent(t,e,i){let s=this.allocateEvent(oe);return this.copyPointerData(t,s),this.copyMouseData(t,s),this.copyData(t,s),s.nativeEvent=t.nativeEvent,s.originalEvent=t,s.target=i??this.hitTest(s.global.x,s.global.y)??this._hitElements[0],typeof e=="string"&&(s.type=e),s}createWheelEvent(t){let e=this.allocateEvent(Je);return this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.hitTest(e.global.x,e.global.y),e}clonePointerEvent(t,e){let i=this.allocateEvent(oe);return i.nativeEvent=t.nativeEvent,i.originalEvent=t.originalEvent,this.copyPointerData(t,i),this.copyMouseData(t,i),this.copyData(t,i),i.target=t.target,i.path=t.composedPath().slice(),i.type=e??i.type,i}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof oe&&e instanceof oe&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof gr&&e instanceof gr&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.copyFrom(t.client),e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.copyFrom(t.movement),e.screen.copyFrom(t.screen),e.shiftKey=t.shiftKey,e.global.copyFrom(t.global))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.copyFrom(t.layer),e.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);let e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.path=null,e.target=null,e}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");let e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t)}notifyListeners(t,e){let i=t.currentTarget._events[e];if(i&&t.currentTarget.isInteractive())if("fn"in i)i.once&&t.currentTarget.removeListener(e,i.fn,void 0,!0),i.fn.call(i.context,t);else for(let s=0,o=i.length;s<o&&!t.propagationImmediatelyStopped;s++)i[s].once&&t.currentTarget.removeListener(e,i[s].fn,void 0,!0),i[s].fn.call(i[s].context,t)}};var OT=1,kT={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},ju=class Wu{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new Mn(null),mr.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new oe(null),this.rootWheelEvent=new Je(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...Wu.defaultEventFeatures},{set:(e,i,s)=>(i==="globalMove"&&(this.rootBoundary.enableGlobalMoveEvents=s),e[i]=s,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(t){let{view:e,resolution:i}=this.renderer;this.setTargetElement(e),this.resolution=i,Wu._defaultEventMode=t.eventMode??"auto",Object.assign(this.features,t.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(t){t=t||"default";let e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this.currentCursor===t)return;this.currentCursor=t;let i=this.cursorStyles[t];if(i)switch(typeof i){case"string":e&&(this.domElement.style.cursor=i);break;case"function":i(t);break;case"object":e&&Object.assign(this.domElement.style,i);break}else e&&typeof t=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}get pointer(){return this.rootPointerEvent}onPointerDown(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let i=0,s=e.length;i<s;i++){let o=e[i],n=this.bootstrapEvent(this.rootPointerEvent,o);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(t){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,mr.pointerMoved();let e=this.normalizeToPointerData(t);for(let i=0,s=e.length;i<s;i++){let o=this.bootstrapEvent(this.rootPointerEvent,e[i]);this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let e=t.target;t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]);let i=e!==this.domElement?"outside":"",s=this.normalizeToPointerData(t);for(let o=0,n=s.length;o<n;o++){let a=this.bootstrapEvent(this.rootPointerEvent,s[o]);a.type+=i,this.rootBoundary.mapEvent(a)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let e=this.normalizeToPointerData(t);for(let i=0,s=e.length;i<s;i++){let o=this.bootstrapEvent(this.rootPointerEvent,e[i]);this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){if(!this.features.wheel)return;let e=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e)}setTargetElement(t){this.removeEvents(),this.domElement=t,mr.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;mr.addTickerListener();let t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0))),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;mr.removeTickerListener();let t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0))),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(t,e,i){let s=this.domElement.isConnected?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0},o=1/this.resolution;t.x=(e-s.left)*(this.domElement.width/s.width)*o,t.y=(i-s.top)*(this.domElement.height/s.height)*o}normalizeToPointerData(t){let e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let i=0,s=t.changedTouches.length;i<s;i++){let o=t.changedTouches[i];typeof o.button>"u"&&(o.button=0),typeof o.buttons>"u"&&(o.buttons=1),typeof o.isPrimary>"u"&&(o.isPrimary=t.touches.length===1&&t.type==="touchstart"),typeof o.width>"u"&&(o.width=o.radiusX||1),typeof o.height>"u"&&(o.height=o.radiusY||1),typeof o.tiltX>"u"&&(o.tiltX=0),typeof o.tiltY>"u"&&(o.tiltY=0),typeof o.pointerType>"u"&&(o.pointerType="touch"),typeof o.pointerId>"u"&&(o.pointerId=o.identifier||0),typeof o.pressure>"u"&&(o.pressure=o.force||.5),typeof o.twist>"u"&&(o.twist=0),typeof o.tangentialPressure>"u"&&(o.tangentialPressure=0),typeof o.layerX>"u"&&(o.layerX=o.offsetX=o.clientX),typeof o.layerY>"u"&&(o.layerY=o.offsetY=o.clientY),o.isNormalized=!0,o.type=t.type,e.push(o)}else if(!globalThis.MouseEvent||t instanceof MouseEvent&&(!this.supportsPointerEvents||!(t instanceof globalThis.PointerEvent))){let i=t;typeof i.isPrimary>"u"&&(i.isPrimary=!0),typeof i.width>"u"&&(i.width=1),typeof i.height>"u"&&(i.height=1),typeof i.tiltX>"u"&&(i.tiltX=0),typeof i.tiltY>"u"&&(i.tiltY=0),typeof i.pointerType>"u"&&(i.pointerType="mouse"),typeof i.pointerId>"u"&&(i.pointerId=OT),typeof i.pressure>"u"&&(i.pressure=.5),typeof i.twist>"u"&&(i.twist=0),typeof i.tangentialPressure>"u"&&(i.tangentialPressure=0),i.isNormalized=!0,e.push(i)}else e.push(t);return e}normalizeWheelEvent(t){let e=this.rootWheelEvent;return this.transferMouseData(e,t),e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ,e.deltaMode=t.deltaMode,this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){return t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e),this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=e.isTrusted,t.type==="pointerleave"&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=kT[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null,t.shiftKey=e.shiftKey}};ju.extension={name:"events",type:[T.RendererSystem,T.CanvasRendererSystem]},ju.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};var Rn=ju;S.add(Rn);function _x(r){return r==="dynamic"||r==="static"}var bx={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){return this._internalInteractive??_x(Rn.defaultEventMode)},set interactive(r){w.deprecation("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=r,this.eventMode=r?"static":"auto"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??Rn.defaultEventMode},set eventMode(r){this._internalInteractive=_x(r),this._internalEventMode=r},isInteractive(){return this.eventMode==="static"||this.eventMode==="dynamic"},interactiveChildren:!0,hitArea:null,addEventListener(r,t,e){let i=typeof e=="boolean"&&e||typeof e=="object"&&e.capture,s=typeof t=="function"?void 0:t;r=i?`${r}capture`:r,t=typeof t=="function"?t:t.handleEvent,this.on(r,t,s)},removeEventListener(r,t,e){let i=typeof e=="boolean"&&e||typeof e=="object"&&e.capture,s=typeof t=="function"?void 0:t;r=i?`${r}capture`:r,t=typeof t=="function"?t:t.handleEvent,this.off(r,t,s)},dispatchEvent(r){if(!(r instanceof Dr))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return r.defaultPrevented=!1,r.path=null,r.target=this,r.manager.dispatchEvent(r),!r.defaultPrevented}};pt.mixin(bx);var Xu={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};pt.mixin(Xu);var NT=9,El=100,UT=0,GT=0,Tx=2,wx=1,zT=-1e3,HT=-1e3,VT=2,Fn=class{constructor(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(w.isMobile.tablet||w.isMobile.phone)&&this.createTouchHook();let e=document.createElement("div");e.style.width=`${El}px`,e.style.height=`${El}px`,e.style.position="absolute",e.style.top=`${UT}px`,e.style.left=`${GT}px`,e.style.zIndex=Tx.toString(),this.div=e,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){let t=document.createElement("button");t.style.width=`${wx}px`,t.style.height=`${wx}px`,t.style.position="absolute",t.style.top=`${zT}px`,t.style.left=`${HT}px`,t.style.zIndex=VT.toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(t),this._hookDiv=t}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode?.appendChild(this.div))}deactivate(){!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode?.removeChild(this.div))}updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.isInteractive()&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);let e=t.children;if(e)for(let i=0;i<e.length;i++)this.updateAccessibleObjects(e[i])}update(){let t=performance.now();if(w.isMobile.android.device&&t<this.androidUpdateCount||(this.androidUpdateCount=t+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);let{x:e,y:i,width:s,height:o}=this.renderer.view.getBoundingClientRect(),{width:n,height:a,resolution:l}=this.renderer,h=s/n*l,c=o/a*l,u=this.div;u.style.left=`${e}px`,u.style.top=`${i}px`,u.style.width=`${n}px`,u.style.height=`${a}px`;for(let d=0;d<this.children.length;d++){let p=this.children[d];if(p.renderId!==this.renderId)p._accessibleActive=!1,w.removeItems(this.children,d,1),this.div.removeChild(p._accessibleDiv),this.pool.push(p._accessibleDiv),p._accessibleDiv=null,d--;else{u=p._accessibleDiv;let f=p.hitArea,m=p.worldTransform;p.hitArea?(u.style.left=`${(m.tx+f.x*m.a)*h}px`,u.style.top=`${(m.ty+f.y*m.d)*c}px`,u.style.width=`${f.width*m.a*h}px`,u.style.height=`${f.height*m.d*c}px`):(f=p.getBounds(),this.capHitArea(f),u.style.left=`${f.x*h}px`,u.style.top=`${f.y*c}px`,u.style.width=`${f.width*h}px`,u.style.height=`${f.height*c}px`,u.title!==p.accessibleTitle&&p.accessibleTitle!==null&&(u.title=p.accessibleTitle),u.getAttribute("aria-label")!==p.accessibleHint&&p.accessibleHint!==null&&u.setAttribute("aria-label",p.accessibleHint)),(p.accessibleTitle!==u.title||p.tabIndex!==u.tabIndex)&&(u.title=p.accessibleTitle,u.tabIndex=p.tabIndex,this.debug&&this.updateDebugHTML(u))}}this.renderId++}updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);let{width:e,height:i}=this.renderer;t.x+t.width>e&&(t.width=e-t.x),t.y+t.height>i&&(t.height=i-t.y)}addChild(t){let e=this.pool.pop();e||(e=document.createElement("button"),e.style.width=`${El}px`,e.style.height=`${El}px`,e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=Tx.toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&t.accessibleTitle!==null?e.title=t.accessibleTitle:(!t.accessibleHint||t.accessibleHint===null)&&(e.title=`displayObject ${t.tabIndex}`),t.accessibleHint&&t.accessibleHint!==null&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex}_dispatchEvent(t,e){let{displayObject:i}=t.target,s=this.renderer.events.rootBoundary,o=Object.assign(new Dr(s),{target:i});s.rootTarget=this.renderer.lastObjectRendered,e.forEach(n=>s.dispatchEvent(o,n))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){t.keyCode===NT&&this.activate()}_onMouseMove(t){t.movementX===0&&t.movementY===0||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}};Fn.extension={name:"accessibility",type:[T.RendererPlugin,T.CanvasRendererPlugin]};S.add(Fn);var fe=(r=>(r[r.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",r[r.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",r[r.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",r[r.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",r[r.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",r[r.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",r[r.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",r[r.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",r[r.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",r[r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",r[r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",r[r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",r[r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",r[r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",r[r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",r[r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",r[r.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",r[r.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",r[r.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",r[r.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",r[r.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",r))(fe||{}),ii={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35986:1,34798:1,37808:1};var Br,to;function Cx(){to={s3tc:Br.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:Br.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:Br.getExtension("WEBGL_compressed_texture_etc"),etc1:Br.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:Br.getExtension("WEBGL_compressed_texture_pvrtc")||Br.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:Br.getExtension("WEBGL_compressed_texture_atc"),astc:Br.getExtension("WEBGL_compressed_texture_astc")}}var $u={extension:{type:T.DetectionParser,priority:2},test:async()=>{let r=C.ADAPTER.createCanvas().getContext("webgl");return r?(Br=r,!0):(console.warn("WebGL not available for compressed textures."),!1)},add:async r=>{to||Cx();let t=[];for(let e in to)to[e]&&t.push(e);return[...t,...r]},remove:async r=>(to||Cx(),r.filter(t=>!(t in to)))};S.add($u);var eo=class extends Xe{constructor(t,e={width:1,height:1,autoLoad:!0}){let i,s;typeof t=="string"?(i=t,s=new Uint8Array):(i=null,s=t),super(s,e),this.origin=i,this.buffer=s?new Xr(s):null,this._load=null,this.loaded=!1,this.origin!==null&&e.autoLoad!==!1&&this.load(),this.origin===null&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(t){}load(){return this._load?this._load:(this._load=fetch(this.origin).then(t=>t.blob()).then(t=>t.arrayBuffer()).then(t=>(this.data=new Uint32Array(t),this.buffer=new Xr(t),this.loaded=!0,this.onBlobLoaded(t),this.update(),this)),this._load)}};var Lr=class r extends eo{constructor(t,e){super(t,e),this.format=e.format,this.levels=e.levels||1,this._width=e.width,this._height=e.height,this._extension=r._formatToExtension(this.format),(e.levelBuffers||this.buffer)&&(this._levelBuffers=e.levelBuffers||r._createLevelBuffers(t instanceof Uint8Array?t:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(t,e,i){let s=t.gl;if(!t.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;s.pixelStorei(s.UNPACK_ALIGNMENT,4);for(let o=0,n=this.levels;o<n;o++){let{levelID:a,levelWidth:l,levelHeight:h,levelBuffer:c}=this._levelBuffers[o];s.compressedTexImage2D(s.TEXTURE_2D,a,this.format,l,h,0,c)}return!0}onBlobLoaded(){this._levelBuffers=r._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t>=36196)return"etc1";if(t>=35986&&t<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")}static _createLevelBuffers(t,e,i,s,o,n,a){let l=new Array(i),h=t.byteOffset,c=n,u=a,d=c+s-1&~(s-1),p=u+o-1&~(o-1),f=d*p*ii[e];for(let m=0;m<i;m++)l[m]={levelID:m,levelWidth:i>1?c:d,levelHeight:i>1?u:p,levelBuffer:new Uint8Array(t.buffer,h,f)},h+=f,c=c>>1||1,u=u>>1||1,d=c+s-1&~(s-1),p=u+o-1&~(o-1),f=d*p*ii[e];return l}};var Yu=4,Al=124,jT=32,Sx=20,WT=542327876,Pl={SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},XT={SIZE:0,FLAGS:1,FOURCC:2,RGB_BITCOUNT:3,R_BIT_MASK:4,G_BIT_MASK:5,B_BIT_MASK:6,A_BIT_MASK:7},Il={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4},$T=1,YT=2,KT=4,qT=64,ZT=512,QT=131072,JT=827611204,tw=861165636,ew=894720068,rw=808540228,iw=4,sw={[JT]:fe.COMPRESSED_RGBA_S3TC_DXT1_EXT,[tw]:fe.COMPRESSED_RGBA_S3TC_DXT3_EXT,[ew]:fe.COMPRESSED_RGBA_S3TC_DXT5_EXT},ow={70:fe.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:fe.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:fe.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:fe.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:fe.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:fe.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:fe.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:fe.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:fe.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT};function Ml(r){let t=new Uint32Array(r);if(t[0]!==WT)throw new Error("Invalid DDS file magic word");let e=new Uint32Array(r,0,Al/Uint32Array.BYTES_PER_ELEMENT),i=e[Pl.HEIGHT],s=e[Pl.WIDTH],o=e[Pl.MIPMAP_COUNT],n=new Uint32Array(r,Pl.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,jT/Uint32Array.BYTES_PER_ELEMENT),a=n[$T];if(a&KT){let l=n[XT.FOURCC];if(l!==rw){let b=sw[l],y=Yu+Al,_=new Uint8Array(r,y);return[new Lr(_,{format:b,width:s,height:i,levels:o})]}let h=Yu+Al,c=new Uint32Array(t.buffer,h,Sx/Uint32Array.BYTES_PER_ELEMENT),u=c[Il.DXGI_FORMAT],d=c[Il.RESOURCE_DIMENSION],p=c[Il.MISC_FLAG],f=c[Il.ARRAY_SIZE],m=ow[u];if(m===void 0)throw new Error(`DDSParser cannot parse texture data with DXGI format ${u}`);if(p===iw)throw new Error("DDSParser does not support cubemap textures");if(d===6)throw new Error("DDSParser does not supported 3D texture data");let g=new Array,x=Yu+Al+Sx;if(f===1)g.push(new Uint8Array(r,x));else{let b=ii[m],y=0,_=s,L=i;for(let F=0;F<o;F++){let B=Math.max(1,_+3&-4),H=Math.max(1,L+3&-4),Z=B*H*b;y+=Z,_=_>>>1,L=L>>>1}let W=x;for(let F=0;F<f;F++)g.push(new Uint8Array(r,W,y)),W+=y}return g.map(b=>new Lr(b,{format:m,width:s,height:i,levels:o}))}throw a&qT?new Error("DDSParser does not support uncompressed texture data."):a&ZT?new Error("DDSParser does not supported YUV uncompressed texture data."):a&QT?new Error("DDSParser does not support single-channel (lumninance) texture data!"):a&YT?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}var Ex=[171,75,84,88,32,49,49,187,13,10,26,10],nw=67305985,tr={FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},Ku=64,Rl={[X.UNSIGNED_BYTE]:1,[X.UNSIGNED_SHORT]:2,[X.INT]:4,[X.UNSIGNED_INT]:4,[X.FLOAT]:4,[X.HALF_FLOAT]:8},qu={[R.RGBA]:4,[R.RGB]:3,[R.RG]:2,[R.RED]:1,[R.LUMINANCE]:1,[R.LUMINANCE_ALPHA]:2,[R.ALPHA]:1},Zu={[X.UNSIGNED_SHORT_4_4_4_4]:2,[X.UNSIGNED_SHORT_5_5_5_1]:2,[X.UNSIGNED_SHORT_5_6_5]:2};function Fl(r,t,e=!1){let i=new DataView(t);if(!aw(r,i))return null;let s=i.getUint32(tr.ENDIANNESS,!0)===nw,o=i.getUint32(tr.GL_TYPE,s),n=i.getUint32(tr.GL_FORMAT,s),a=i.getUint32(tr.GL_INTERNAL_FORMAT,s),l=i.getUint32(tr.PIXEL_WIDTH,s),h=i.getUint32(tr.PIXEL_HEIGHT,s)||1,c=i.getUint32(tr.PIXEL_DEPTH,s)||1,u=i.getUint32(tr.NUMBER_OF_ARRAY_ELEMENTS,s)||1,d=i.getUint32(tr.NUMBER_OF_FACES,s),p=i.getUint32(tr.NUMBER_OF_MIPMAP_LEVELS,s),f=i.getUint32(tr.BYTES_OF_KEY_VALUE_DATA,s);if(h===0||c!==1)throw new Error("Only 2D textures are supported");if(d!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(u!==1)throw new Error("WebGL does not support array textures");let m=4,g=4,x=l+3&-4,b=h+3&-4,y=new Array(u),_=l*h;o===0&&(_=x*b);let L;if(o!==0?Rl[o]?L=Rl[o]*qu[n]:L=Zu[o]:L=ii[a],L===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");let W=e?hw(i,f,s):null,F=_*L,B=l,H=h,Z=x,O=b,G=Ku+f;for(let E=0;E<p;E++){let P=i.getUint32(G,s),J=G+4;for(let it=0;it<u;it++){let A=y[it];A||(A=y[it]=new Array(p)),A[E]={levelID:E,levelWidth:p>1||o!==0?B:Z,levelHeight:p>1||o!==0?H:O,levelBuffer:new Uint8Array(t,J,F)},J+=F}G+=P+4,G=G%4!==0?G+4-G%4:G,B=B>>1||1,H=H>>1||1,Z=B+m-1&~(m-1),O=H+g-1&~(g-1),F=Z*O*L}return o!==0?{uncompressed:y.map(E=>{let P=E[0].levelBuffer,J=!1;return o===X.FLOAT?P=new Float32Array(E[0].levelBuffer.buffer,E[0].levelBuffer.byteOffset,E[0].levelBuffer.byteLength/4):o===X.UNSIGNED_INT?(J=!0,P=new Uint32Array(E[0].levelBuffer.buffer,E[0].levelBuffer.byteOffset,E[0].levelBuffer.byteLength/4)):o===X.INT&&(J=!0,P=new Int32Array(E[0].levelBuffer.buffer,E[0].levelBuffer.byteOffset,E[0].levelBuffer.byteLength/4)),{resource:new Xe(P,{width:E[0].levelWidth,height:E[0].levelHeight}),type:o,format:J?lw(n):n}}),kvData:W}:{compressed:y.map(E=>new Lr(null,{format:a,width:l,height:h,levels:p,levelBuffers:E})),kvData:W}}function aw(r,t){for(let e=0;e<Ex.length;e++)if(t.getUint8(e)!==Ex[e])return console.error(`${r} is not a valid *.ktx file!`),!1;return!0}function lw(r){switch(r){case R.RGBA:return R.RGBA_INTEGER;case R.RGB:return R.RGB_INTEGER;case R.RG:return R.RG_INTEGER;case R.RED:return R.RED_INTEGER;default:return r}}function hw(r,t,e){let i=new Map,s=0;for(;s<t;){let o=r.getUint32(Ku+s,e),n=Ku+s+4,a=3-(o+3)%4;if(o===0||o>t-s){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let l=0;for(;l<o&&r.getUint8(n+l)!==0;l++);if(l===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}let h=new TextDecoder().decode(new Uint8Array(r.buffer,n,l)),c=new DataView(r.buffer,n+l+1,o-l-1);i.set(h,c),s+=4+o+a}return i}var Qu={extension:{type:T.LoadParser,priority:_t.High},name:"loadDDS",test(r){return Ht(r,".dds")},async load(r,t,e){let i=await(await C.ADAPTER.fetch(r)).arrayBuffer(),s=Ml(i).map(o=>{let n=new K(o,{mipmap:Lt.OFF,alphaMode:St.NO_PREMULTIPLIED_ALPHA,resolution:w.getResolutionOfUrl(r),...t.data});return Ue(n,e,r)});return s.length===1?s[0]:s},unload(r){Array.isArray(r)?r.forEach(t=>t.destroy(!0)):r.destroy(!0)}};S.add(Qu);var Ju={extension:{type:T.LoadParser,priority:_t.High},name:"loadKTX",test(r){return Ht(r,".ktx")},async load(r,t,e){let i=await(await C.ADAPTER.fetch(r)).arrayBuffer(),{compressed:s,uncompressed:o,kvData:n}=Fl(r,i),a=s??o,l={mipmap:Lt.OFF,alphaMode:St.NO_PREMULTIPLIED_ALPHA,resolution:w.getResolutionOfUrl(r),...t.data},h=a.map(c=>{a===o&&Object.assign(l,{type:c.type,format:c.format});let u=c.resource??c,d=new K(u,l);return d.ktxKeyValueData=n,Ue(d,e,r)});return h.length===1?h[0]:h},unload(r){Array.isArray(r)?r.forEach(t=>t.destroy(!0)):r.destroy(!0)}};S.add(Ju);var td={extension:T.ResolveParser,test:r=>{let t=w.path.extname(r).slice(1);return["basis","ktx","dds"].includes(t)},parse:r=>{let t=w.path.extname(r).slice(1);if(t==="ktx"){let e=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx"];if(e.some(i=>r.endsWith(i)))return{resolution:parseFloat(C.RETINA_PREFIX.exec(r)?.[1]??"1"),format:e.find(i=>r.endsWith(i)),src:r}}return{resolution:parseFloat(C.RETINA_PREFIX.exec(r)?.[1]??"1"),format:t,src:r}}};S.add(td);var Dl=new Y,cw=4,Ax=class Dn{constructor(t){this.renderer=t,this._rendererPremultipliedAlpha=!1}contextChange(){let t=this.renderer?.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}async image(t,e,i,s){let o=new Image;return o.src=await this.base64(t,e,i,s),o}async base64(t,e,i,s){let o=this.canvas(t,s);if(o.toBlob!==void 0)return new Promise((n,a)=>{o.toBlob(l=>{if(!l){a(new Error("ICanvas.toBlob failed!"));return}let h=new FileReader;h.onload=()=>n(h.result),h.onerror=a,h.readAsDataURL(l)},e,i)});if(o.toDataURL!==void 0)return o.toDataURL(e,i);if(o.convertToBlob!==void 0){let n=await o.convertToBlob({type:e,quality:i});return new Promise((a,l)=>{let h=new FileReader;h.onload=()=>a(h.result),h.onerror=l,h.readAsDataURL(n)})}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(t,e){let{pixels:i,width:s,height:o,flipY:n,premultipliedAlpha:a}=this._rawPixels(t,e);n&&Dn._flipY(i,s,o),a&&Dn._unpremultiplyAlpha(i);let l=new w.CanvasRenderTarget(s,o,1),h=new ImageData(new Uint8ClampedArray(i.buffer),s,o);return l.context.putImageData(h,0,0),l.canvas}pixels(t,e){let{pixels:i,width:s,height:o,flipY:n,premultipliedAlpha:a}=this._rawPixels(t,e);return n&&Dn._flipY(i,s,o),a&&Dn._unpremultiplyAlpha(i),i}_rawPixels(t,e){let i=this.renderer;if(!i)throw new Error("The Extract has already been destroyed");let s,o=!1,n=!1,a,l=!1;t&&(t instanceof Oe?a=t:(a=i.generateTexture(t,{region:e,resolution:i.resolution,multisample:i.multisample}),l=!0,e&&(Dl.width=e.width,Dl.height=e.height,e=Dl)));let h=i.gl;if(a){if(s=a.baseTexture.resolution,e=e??a.frame,o=!1,n=a.baseTexture.alphaMode>0&&a.baseTexture.format===R.RGBA,!l){i.renderTexture.bind(a);let p=a.framebuffer.glFramebuffers[i.CONTEXT_UID];p.blitFramebuffer&&i.framebuffer.bind(p.blitFramebuffer)}}else s=i.resolution,e||(e=Dl,e.width=i.width/s,e.height=i.height/s),o=!0,n=this._rendererPremultipliedAlpha,i.renderTexture.bind();let c=Math.max(Math.round(e.width*s),1),u=Math.max(Math.round(e.height*s),1),d=new Uint8Array(cw*c*u);return h.readPixels(Math.round(e.x*s),Math.round(e.y*s),c,u,h.RGBA,h.UNSIGNED_BYTE,d),l&&a?.destroy(!0),{pixels:d,width:c,height:u,flipY:o,premultipliedAlpha:n}}destroy(){this.renderer=null}static _flipY(t,e,i){let s=e<<2,o=i>>1,n=new Uint8Array(s);for(let a=0;a<o;a++){let l=a*s,h=(i-a-1)*s;n.set(t.subarray(l,l+s)),t.copyWithin(l,h,h+s),t.set(n,h)}}static _unpremultiplyAlpha(t){t instanceof Uint8ClampedArray&&(t=new Uint8Array(t.buffer));let e=t.length;for(let i=0;i<e;i+=4){let s=t[i+3];if(s!==0){let o=255.001/s;t[i]=t[i]*o+.5,t[i+1]=t[i+1]*o+.5,t[i+2]=t[i+2]*o+.5}}}};Ax.extension={name:"extract",type:T.RendererSystem};var Px=Ax;S.add(Px);var Bn=class{constructor(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;let e=this.uvBuffer.data;(!this.data||this.data.length!==e.length)&&(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}};var ed=new $,Ix=new ar,Mx=class Rx extends D{constructor(t,e,i,s=xe.TRIANGLES){super(),this.geometry=t,this.shader=e,this.state=i||Gt.for2d(),this.drawMode=s,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=C.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(t){this._geometry!==t&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=t,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(t){this.shader=t}get material(){return this.shader}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(t){this.shader.tint=t}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(t){this.shader.texture=t}_render(t){let e=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===xe.TRIANGLES&&e.length<Rx.BATCHABLE_SIZE*2?this._renderToBatch(t):this._renderDefault(t)}_renderDefault(t){let e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),t.shader.bind(e),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(t){let e=this.geometry,i=this.shader;i.uvMatrix&&(i.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=i._tintRGB,this._texture=i.texture;let s=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[s]),t.plugins[s].render(this)}calculateVertices(){let t=this.geometry.buffers[0],e=t.data,i=t._updateID;if(i===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));let s=this.transform.worldTransform,o=s.a,n=s.b,a=s.c,l=s.d,h=s.tx,c=s.ty,u=this.vertexData;for(let d=0;d<u.length/2;d++){let p=e[d*2],f=e[d*2+1];u[d*2]=o*p+a*f+h,u[d*2+1]=n*p+l*f+c}if(this._roundPixels){let d=C.RESOLUTION;for(let p=0;p<u.length;++p)u[p]=Math.round(u[p]*d)/d}this.vertexDirty=i}calculateUvs(){let t=this.geometry.buffers[1],e=this.shader;e.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new Bn(t,e.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,ed);let e=this.geometry.getBuffer("aVertexPosition").data,i=Ix.points,s=this.geometry.getIndex().data,o=s.length,n=this.drawMode===4?3:1;for(let a=0;a+2<o;a+=n){let l=s[a]*2,h=s[a+1]*2,c=s[a+2]*2;if(i[0]=e[l],i[1]=e[l+1],i[2]=e[h],i[3]=e[h+1],i[4]=e[c],i[5]=e[c+1],Ix.contains(ed.x,ed.y))return!0}return!1}destroy(t){super.destroy(t),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};Mx.BATCHABLE_SIZE=100;var Wi=Mx;var si=class extends Ie{constructor(t,e,i){super();let s=new mt(t),o=new mt(e,!0),n=new mt(i,!0,!0);this.addAttribute("aVertexPosition",s,2,!1,X.FLOAT).addAttribute("aTextureCoord",o,2,!1,X.FLOAT).addIndex(n),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}};var Fx=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`;var Dx=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`;var Or=class extends Xt{constructor(t,e){let i={uSampler:t,alpha:1,uTextureMatrix:ot.IDENTITY,uColor:new Float32Array([1,1,1,1])};e=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},e),e.uniforms&&Object.assign(i,e.uniforms),super(e.program||ie.from(Dx,Fx),i),this._colorDirty=!1,this.uvMatrix=new Zr(t),this.batchable=e.program===void 0,this.pluginName=e.pluginName,this._tintColor=new tt(e.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=e.alpha}get texture(){return this.uniforms.uSampler}set texture(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)}set alpha(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(t){t!==this.tint&&(this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;let t=this.texture.baseTexture.alphaMode;tt.shared.setValue(this._tintColor).premultiply(this._alpha,t).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}};var Ln=class{constructor(t,e,i){this.geometry=new Ie,this.indexBuffer=null,this.size=i,this.dynamicProperties=[],this.staticProperties=[];for(let s=0;s<t.length;++s){let o=t[s];o={attributeName:o.attributeName,size:o.size,uploadFunction:o.uploadFunction,type:o.type||X.FLOAT,offset:o.offset},e[s]?this.dynamicProperties.push(o):this.staticProperties.push(o)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){let t=this.geometry,e=0;this.indexBuffer=new mt(w.createIndicesForQuads(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(let n=0;n<this.dynamicProperties.length;++n){let a=this.dynamicProperties[n];a.offset=e,e+=a.size,this.dynamicStride+=a.size}let i=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(i),this.dynamicDataUint32=new Uint32Array(i),this.dynamicBuffer=new mt(this.dynamicData,!1,!1);let s=0;this.staticStride=0;for(let n=0;n<this.staticProperties.length;++n){let a=this.staticProperties[n];a.offset=s,s+=a.size,this.staticStride+=a.size}let o=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(o),this.staticDataUint32=new Uint32Array(o),this.staticBuffer=new mt(this.staticData,!0,!1);for(let n=0;n<this.dynamicProperties.length;++n){let a=this.dynamicProperties[n];t.addAttribute(a.attributeName,this.dynamicBuffer,0,a.type===X.UNSIGNED_BYTE,a.type,this.dynamicStride*4,a.offset*4)}for(let n=0;n<this.staticProperties.length;++n){let a=this.staticProperties[n];t.addAttribute(a.attributeName,this.staticBuffer,0,a.type===X.UNSIGNED_BYTE,a.type,this.staticStride*4,a.offset*4)}}uploadDynamic(t,e,i){for(let s=0;s<this.dynamicProperties.length;s++){let o=this.dynamicProperties[s];o.uploadFunction(t,e,i,o.type===X.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,o.offset)}this.dynamicBuffer._updateID++}uploadStatic(t,e,i){for(let s=0;s<this.staticProperties.length;s++){let o=this.staticProperties[s];o.uploadFunction(t,e,i,o.type===X.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,o.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}};var Bx=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`;var Lx=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`;var On=class extends Ye{constructor(t){super(t),this.shader=null,this.properties=null,this.tempMatrix=new ot,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:X.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=Xt.from(Lx,Bx,{}),this.state=Gt.for2d()}render(t){let e=t.children,i=t._maxSize,s=t._batchSize,o=this.renderer,n=e.length;if(n===0)return;n>i&&!t.autoResize&&(n=i);let a=t._buffers;a||(a=t._buffers=this.generateBuffers(t));let l=e[0]._texture.baseTexture,h=l.alphaMode>0;this.state.blendMode=w.correctBlendMode(t.blendMode,h),o.state.set(this.state);let c=o.gl,u=t.worldTransform.copyTo(this.tempMatrix);u.prepend(o.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=u.toArray(!0),this.shader.uniforms.uColor=tt.shared.setValue(t.tintRgb).premultiply(t.worldAlpha,h).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=l,this.renderer.shader.bind(this.shader);let d=!1;for(let p=0,f=0;p<n;p+=s,f+=1){let m=n-p;m>s&&(m=s),f>=a.length&&a.push(this._generateOneMoreBuffer(t));let g=a[f];g.uploadDynamic(e,p,m);let x=t._bufferUpdateIDs[f]||0;d=d||g._updateID<x,d&&(g._updateID=t._updateID,g.uploadStatic(e,p,m)),o.geometry.bind(g.geometry),c.drawElements(c.TRIANGLES,m*6,c.UNSIGNED_SHORT,0)}}generateBuffers(t){let e=[],i=t._maxSize,s=t._batchSize,o=t._properties;for(let n=0;n<i;n+=s)e.push(new Ln(this.properties,o,s));return e}_generateOneMoreBuffer(t){let e=t._batchSize,i=t._properties;return new Ln(this.properties,i,e)}uploadVertices(t,e,i,s,o,n){let a=0,l=0,h=0,c=0;for(let u=0;u<i;++u){let d=t[e+u],p=d._texture,f=d.scale.x,m=d.scale.y,g=p.trim,x=p.orig;g?(l=g.x-d.anchor.x*x.width,a=l+g.width,c=g.y-d.anchor.y*x.height,h=c+g.height):(a=x.width*(1-d.anchor.x),l=x.width*-d.anchor.x,h=x.height*(1-d.anchor.y),c=x.height*-d.anchor.y),s[n]=l*f,s[n+1]=c*m,s[n+o]=a*f,s[n+o+1]=c*m,s[n+o*2]=a*f,s[n+o*2+1]=h*m,s[n+o*3]=l*f,s[n+o*3+1]=h*m,n+=o*4}}uploadPosition(t,e,i,s,o,n){for(let a=0;a<i;a++){let l=t[e+a].position;s[n]=l.x,s[n+1]=l.y,s[n+o]=l.x,s[n+o+1]=l.y,s[n+o*2]=l.x,s[n+o*2+1]=l.y,s[n+o*3]=l.x,s[n+o*3+1]=l.y,n+=o*4}}uploadRotation(t,e,i,s,o,n){for(let a=0;a<i;a++){let l=t[e+a].rotation;s[n]=l,s[n+o]=l,s[n+o*2]=l,s[n+o*3]=l,n+=o*4}}uploadUvs(t,e,i,s,o,n){for(let a=0;a<i;++a){let l=t[e+a]._texture._uvs;l?(s[n]=l.x0,s[n+1]=l.y0,s[n+o]=l.x1,s[n+o+1]=l.y1,s[n+o*2]=l.x2,s[n+o*2+1]=l.y2,s[n+o*3]=l.x3,s[n+o*3+1]=l.y3,n+=o*4):(s[n]=0,s[n+1]=0,s[n+o]=0,s[n+o+1]=0,s[n+o*2]=0,s[n+o*2+1]=0,s[n+o*3]=0,s[n+o*3+1]=0,n+=o*4)}}uploadTint(t,e,i,s,o,n){for(let a=0;a<i;++a){let l=t[e+a],h=tt.shared.setValue(l._tintRGB).toPremultiplied(l.alpha,l.texture.baseTexture.alphaMode>0);s[n]=h,s[n+o]=h,s[n+o*2]=h,s[n+o*3]=h,n+=o*4}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}};On.extension={name:"particle",type:T.RendererPlugin};S.add(On);var kn=class{constructor(t){this.maxItemsPerFrame=t,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}};function fw(r,t){let e=!1;if(r?._textures?.length){for(let i=0;i<r._textures.length;i++)if(r._textures[i]instanceof v){let s=r._textures[i].baseTexture;t.includes(s)||(t.push(s),e=!0)}}return e}function mw(r,t){if(r.baseTexture instanceof K){let e=r.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function gw(r,t){if(r._texture&&r._texture instanceof v){let e=r._texture.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function xw(r,t){return t instanceof rt?(t.updateText(!0),!0):!1}function yw(r,t){if(t instanceof Te){let e=t.toFontString();return Ve.measureFont(e),!0}return!1}function vw(r,t){if(r instanceof rt){t.includes(r.style)||t.push(r.style),t.includes(r)||t.push(r);let e=r._texture.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function _w(r,t){return r instanceof Te?(t.includes(r)||t.push(r),!0):!1}var Ox=class kx{constructor(t){this.limiter=new kn(kx.uploadsPerFrame),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(vw),this.registerFindHook(_w),this.registerFindHook(fw),this.registerFindHook(mw),this.registerFindHook(gw),this.registerUploadHook(xw),this.registerUploadHook(yw)}upload(t){return new Promise(e=>{t&&this.add(t),this.queue.length?(this.completes.push(e),this.ticking||(this.ticking=!0,ut.system.addOnce(this.tick,this,ve.UTILITY))):e()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){let t=this.queue[0],e=!1;if(t&&!t._destroyed){for(let i=0,s=this.uploadHooks.length;i<s;i++)if(this.uploadHooks[i](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}}e||this.queue.shift()}if(this.queue.length)ut.system.addOnce(this.tick,this,ve.UTILITY);else{this.ticking=!1;let t=this.completes.slice(0);this.completes.length=0;for(let e=0,i=t.length;e<i;e++)t[e]()}}registerFindHook(t){return t&&this.addHooks.push(t),this}registerUploadHook(t){return t&&this.uploadHooks.push(t),this}add(t){for(let e=0,i=this.addHooks.length;e<i&&!this.addHooks[e](t,this.queue);e++);if(t instanceof D)for(let e=t.children.length-1;e>=0;e--)this.add(t.children[e]);return this}destroy(){this.ticking&&ut.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};Ox.uploadsPerFrame=4;var ro=Ox;Object.defineProperties(C,{UPLOADS_PER_FRAME:{get(){return ro.uploadsPerFrame},set(r){w.deprecation("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),ro.uploadsPerFrame=r}}});function Nx(r,t){return t instanceof K?(t._glTextures[r.CONTEXT_UID]||r.texture.bind(t),!0):!1}function bw(r,t){if(!(t instanceof ur))return!1;let{geometry:e}=t;t.finishPoly(),e.updateBatches();let{batches:i}=e;for(let s=0;s<i.length;s++){let{texture:o}=i[s].style;o&&Nx(r,o.baseTexture)}return e.batchable||r.geometry.bind(e,t._resolveDirectShader(r)),!0}function Tw(r,t){return r instanceof ur?(t.push(r),!0):!1}var Nn=class extends ro{constructor(t){super(t),this.uploadHookHelper=this.renderer,this.registerFindHook(Tw),this.registerUploadHook(Nx),this.registerUploadHook(bw)}};Nn.extension={name:"prepare",type:T.RendererSystem};S.add(Nn);var _9=new $;var Ux=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`;var Gx=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`;var zx=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`;var rd=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`;var Hx=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`;var Bl=new ot,Un=class extends Ye{constructor(t){super(t),t.runners.contextChange.add(this),this.quad=new Pi,this.state=Gt.for2d()}contextChange(){let t=this.renderer,e={globals:t.globalUniforms};this.simpleShader=Xt.from(rd,Hx,e),this.shader=t.context.webGLVersion>1?Xt.from(Gx,Ux,e):Xt.from(rd,zx,e)}render(t){let e=this.renderer,i=this.quad,s=i.vertices;s[0]=s[6]=t._width*-t.anchor.x,s[1]=s[3]=t._height*-t.anchor.y,s[2]=s[4]=t._width*(1-t.anchor.x),s[5]=s[7]=t._height*(1-t.anchor.y);let o=t.uvRespectAnchor?t.anchor.x:0,n=t.uvRespectAnchor?t.anchor.y:0;s=i.uvs,s[0]=s[6]=-o,s[1]=s[3]=-n,s[2]=s[4]=1-o,s[5]=s[7]=1-n,i.invalidate();let a=t._texture,l=a.baseTexture,h=l.alphaMode>0,c=t.tileTransform.localTransform,u=t.uvMatrix,d=l.isPowerOfTwo&&a.frame.width===l.width&&a.frame.height===l.height;d&&(l._glTextures[e.CONTEXT_UID]?d=l.wrapMode!==Ee.CLAMP:l.wrapMode===Ee.CLAMP&&(l.wrapMode=Ee.REPEAT));let p=d?this.simpleShader:this.shader,f=a.width,m=a.height,g=t._width,x=t._height;Bl.set(c.a*f/g,c.b*f/x,c.c*m/g,c.d*m/x,c.tx/g,c.ty/x),Bl.invert(),d?Bl.prepend(u.mapCoord):(p.uniforms.uMapCoord=u.mapCoord.toArray(!0),p.uniforms.uClampFrame=u.uClampFrame,p.uniforms.uClampOffset=u.uClampOffset),p.uniforms.uTransform=Bl.toArray(!0),p.uniforms.uColor=tt.shared.setValue(t.tint).premultiply(t.worldAlpha,h).toArray(p.uniforms.uColor),p.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),p.uniforms.uSampler=a,e.shader.bind(p),e.geometry.bind(i),this.state.blendMode=w.correctBlendMode(t.blendMode,h),e.state.set(this.state),e.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}};Un.extension={name:"tilingSprite",type:T.RendererPlugin};S.add(Un);var Vx=class Gn{constructor(t,e,i=null){this.linkedSheets=[],this._texture=t instanceof v?t:null,this.baseTexture=t instanceof K?t:this._texture.baseTexture,this.textures={},this.animations={},this.data=e;let s=this.baseTexture.resource;this.resolution=this._updateResolution(i||(s?s.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(t=null){let{scale:e}=this.data.meta,i=w.getResolutionOfUrl(t,null);return i===null&&(i=parseFloat(e??"1")),i!==1&&this.baseTexture.setResolution(i),i}parse(){return new Promise(t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=Gn.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(t){let e=t,i=Gn.BATCH_SIZE;for(;e-t<i&&e<this._frameKeys.length;){let s=this._frameKeys[e],o=this._frames[s],n=o.frame;if(n){let a=null,l=null,h=o.trimmed!==!1&&o.sourceSize?o.sourceSize:o.frame,c=new Y(0,0,Math.floor(h.w)/this.resolution,Math.floor(h.h)/this.resolution);o.rotated?a=new Y(Math.floor(n.x)/this.resolution,Math.floor(n.y)/this.resolution,Math.floor(n.h)/this.resolution,Math.floor(n.w)/this.resolution):a=new Y(Math.floor(n.x)/this.resolution,Math.floor(n.y)/this.resolution,Math.floor(n.w)/this.resolution,Math.floor(n.h)/this.resolution),o.trimmed!==!1&&o.spriteSourceSize&&(l=new Y(Math.floor(o.spriteSourceSize.x)/this.resolution,Math.floor(o.spriteSourceSize.y)/this.resolution,Math.floor(n.w)/this.resolution,Math.floor(n.h)/this.resolution)),this.textures[s]=new v(this.baseTexture,a,c,l,o.rotated?2:0,o.anchor,o.borders),v.addToCache(this.textures[s],s.toString())}e++}}_processAnimations(){let t=this.data.animations||{};for(let e in t){this.animations[e]=[];for(let i=0;i<t[e].length;i++){let s=t[e][i];this.animations[e].push(this.textures[s])}}}_parseComplete(){let t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*Gn.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*Gn.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(t=!1){for(let e in this.textures)this.textures[e].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&(this._texture?.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};Vx.BATCH_SIZE=1e3;var Ll=Vx;var ww=["jpg","png","jpeg","avif","webp"];function jx(r,t,e){let i={};if(r.forEach(s=>{i[s]=t}),Object.keys(t.textures).forEach(s=>{i[s]=t.textures[s]}),!e){let s=w.path.dirname(r[0]);t.linkedSheets.forEach((o,n)=>{let a=jx([`${s}/${t.data.meta.related_multi_packs[n]}`],o,!0);Object.assign(i,a)})}return i}var Ol={extension:T.Asset,cache:{test:r=>r instanceof Ll,getCacheableAssets:(r,t)=>jx(r,t,!1)},resolver:{test:r=>{let t=r.split("?")[0].split("."),e=t.pop(),i=t.pop();return e==="json"&&ww.includes(i)},parse:r=>{let t=r.split(".");return{resolution:parseFloat(C.RETINA_PREFIX.exec(r)?.[1]??"1"),format:t[t.length-2],src:r}}},loader:{name:"spritesheetLoader",extension:{type:T.LoadParser,priority:_t.Normal},async testParse(r,t){return w.path.extname(t.src).toLowerCase()===".json"&&!!r.frames},async parse(r,t,e){let i=w.path.dirname(t.src);i&&i.lastIndexOf("/")!==i.length-1&&(i+="/");let s=i+r.meta.image;s=Oi(s,t.src);let o=(await e.load([s]))[s],n=new Ll(o.baseTexture,r,t.src);await n.parse();let a=r?.meta?.related_multi_packs;if(Array.isArray(a)){let l=[];for(let c of a){if(typeof c!="string")continue;let u=i+c;t.data?.ignoreMultiPack||(u=Oi(u,t.src),l.push(e.load({src:u,data:{ignoreMultiPack:!0}})))}let h=await Promise.all(l);n.linkedSheets=h,h.forEach(c=>{c.linkedSheets=[n].concat(n.linkedSheets.filter(u=>u!==c))})}return n},unload(r){r.destroy(!0)}}};S.add(Ol);var xr=class{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}};var kr=class{static test(t){return typeof t=="string"&&t.startsWith("info face=")}static parse(t){let e=t.match(/^[a-z]+\s+.+$/gm),i={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(let o in e){let n=e[o].match(/^[a-z]+/gm)[0],a=e[o].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),l={};for(let h in a){let c=a[h].split("="),u=c[0],d=c[1].replace(/"/gm,""),p=parseFloat(d),f=isNaN(p)?d:p;l[u]=f}i[n].push(l)}let s=new xr;return i.info.forEach(o=>s.info.push({face:o.face,size:parseInt(o.size,10)})),i.common.forEach(o=>s.common.push({lineHeight:parseInt(o.lineHeight,10)})),i.page.forEach(o=>s.page.push({id:parseInt(o.id,10),file:o.file})),i.char.forEach(o=>s.char.push({id:parseInt(o.id,10),page:parseInt(o.page,10),x:parseInt(o.x,10),y:parseInt(o.y,10),width:parseInt(o.width,10),height:parseInt(o.height,10),xoffset:parseInt(o.xoffset,10),yoffset:parseInt(o.yoffset,10),xadvance:parseInt(o.xadvance,10)})),i.kerning.forEach(o=>s.kerning.push({first:parseInt(o.first,10),second:parseInt(o.second,10),amount:parseInt(o.amount,10)})),i.distanceField.forEach(o=>s.distanceField.push({distanceRange:parseInt(o.distanceRange,10),fieldType:o.fieldType})),s}};var oi=class{static test(t){let e=t;return typeof t!="string"&&"getElementsByTagName"in t&&e.getElementsByTagName("page").length&&e.getElementsByTagName("info")[0].getAttribute("face")!==null}static parse(t){let e=new xr,i=t.getElementsByTagName("info"),s=t.getElementsByTagName("common"),o=t.getElementsByTagName("page"),n=t.getElementsByTagName("char"),a=t.getElementsByTagName("kerning"),l=t.getElementsByTagName("distanceField");for(let h=0;h<i.length;h++)e.info.push({face:i[h].getAttribute("face"),size:parseInt(i[h].getAttribute("size"),10)});for(let h=0;h<s.length;h++)e.common.push({lineHeight:parseInt(s[h].getAttribute("lineHeight"),10)});for(let h=0;h<o.length;h++)e.page.push({id:parseInt(o[h].getAttribute("id"),10)||0,file:o[h].getAttribute("file")});for(let h=0;h<n.length;h++){let c=n[h];e.char.push({id:parseInt(c.getAttribute("id"),10),page:parseInt(c.getAttribute("page"),10)||0,x:parseInt(c.getAttribute("x"),10),y:parseInt(c.getAttribute("y"),10),width:parseInt(c.getAttribute("width"),10),height:parseInt(c.getAttribute("height"),10),xoffset:parseInt(c.getAttribute("xoffset"),10),yoffset:parseInt(c.getAttribute("yoffset"),10),xadvance:parseInt(c.getAttribute("xadvance"),10)})}for(let h=0;h<a.length;h++)e.kerning.push({first:parseInt(a[h].getAttribute("first"),10),second:parseInt(a[h].getAttribute("second"),10),amount:parseInt(a[h].getAttribute("amount"),10)});for(let h=0;h<l.length;h++)e.distanceField.push({fieldType:l[h].getAttribute("fieldType"),distanceRange:parseInt(l[h].getAttribute("distanceRange"),10)});return e}};var ni=class{static test(t){return typeof t=="string"&&t.includes("<font>")?oi.test(C.ADAPTER.parseXML(t)):!1}static parse(t){return oi.parse(C.ADAPTER.parseXML(t))}};var id=[kr,oi,ni];function sd(r){for(let t=0;t<id.length;t++)if(id[t].test(r))return id[t];return null}function od(r,t,e,i,s,o){let n=e.fill;if(Array.isArray(n)){if(n.length===1)return n[0]}else return n;let a,l=e.dropShadow?e.dropShadowDistance:0,h=e.padding||0,c=r.width/i-l-h*2,u=r.height/i-l-h*2,d=n.slice(),p=e.fillGradientStops.slice();if(!p.length){let f=d.length+1;for(let m=1;m<f;++m)p.push(m/f)}if(d.unshift(n[0]),p.unshift(0),d.push(n[n.length-1]),p.push(1),e.fillGradientType===ri.LINEAR_VERTICAL){a=t.createLinearGradient(c/2,h,c/2,u+h);let f=0,m=(o.fontProperties.fontSize+e.strokeThickness)/u;for(let g=0;g<s.length;g++){let x=o.lineHeight*g;for(let b=0;b<d.length;b++){let y=0;typeof p[b]=="number"?y=p[b]:y=b/d.length;let _=x/u+y*m,L=Math.max(f,_);L=Math.min(L,1),a.addColorStop(L,d[b]),f=L}}}else{a=t.createLinearGradient(h,u/2,c+h,u/2);let f=d.length+1,m=1;for(let g=0;g<d.length;g++){let x;typeof p[g]=="number"?x=p[g]:x=m/f,a.addColorStop(x,d[g]),m++}}return a}function nd(r,t,e,i,s,o,n){let a=e.text,l=e.fontProperties;t.translate(i,s),t.scale(o,o);let h=n.strokeThickness/2,c=-(n.strokeThickness/2);if(t.font=n.toFontString(),t.lineWidth=n.strokeThickness,t.textBaseline=n.textBaseline,t.lineJoin=n.lineJoin,t.miterLimit=n.miterLimit,t.fillStyle=od(r,t,n,o,[a],e),t.strokeStyle=n.stroke,n.dropShadow){let u=n.dropShadowColor,d=n.dropShadowBlur*o,p=n.dropShadowDistance*o;t.shadowColor=tt.shared.setValue(u).setAlpha(n.dropShadowAlpha).toRgbaString(),t.shadowBlur=d,t.shadowOffsetX=Math.cos(n.dropShadowAngle)*p,t.shadowOffsetY=Math.sin(n.dropShadowAngle)*p}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0;n.stroke&&n.strokeThickness&&t.strokeText(a,h,c+e.lineHeight-l.descent),n.fill&&t.fillText(a,h,c+e.lineHeight-l.descent),t.setTransform(1,0,0,1,0,0),t.fillStyle="rgba(0, 0, 0, 0)"}function Xi(r){return r.codePointAt?r.codePointAt(0):r.charCodeAt(0)}function zn(r){return Array.from?Array.from(r):r.split("")}function ad(r){typeof r=="string"&&(r=[r]);let t=[];for(let e=0,i=r.length;e<i;e++){let s=r[e];if(Array.isArray(s)){if(s.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${s.length}.`);let o=s[0].charCodeAt(0),n=s[1].charCodeAt(0);if(n<o)throw new Error("[BitmapFont]: Invalid character range.");for(let a=o,l=n;a<=l;a++)t.push(String.fromCharCode(a))}else t.push(...zn(s))}if(t.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}var ai=class yr{constructor(t,e,i){let[s]=t.info,[o]=t.common,[n]=t.page,[a]=t.distanceField,l=w.getResolutionOfUrl(n.file),h={};this._ownsTextures=i,this.font=s.face,this.size=s.size,this.lineHeight=o.lineHeight/l,this.chars={},this.pageTextures=h;for(let c=0;c<t.page.length;c++){let{id:u,file:d}=t.page[c];h[u]=e instanceof Array?e[c]:e[d],a?.fieldType&&a.fieldType!=="none"&&(h[u].baseTexture.alphaMode=St.NO_PREMULTIPLIED_ALPHA,h[u].baseTexture.mipmap=Lt.OFF)}for(let c=0;c<t.char.length;c++){let{id:u,page:d}=t.char[c],{x:p,y:f,width:m,height:g,xoffset:x,yoffset:b,xadvance:y}=t.char[c];p/=l,f/=l,m/=l,g/=l,x/=l,b/=l,y/=l;let _=new Y(p+h[d].frame.x/l,f+h[d].frame.y/l,m,g);this.chars[u]={xOffset:x,yOffset:b,xAdvance:y,kerning:{},texture:new v(h[d].baseTexture,_),page:d}}for(let c=0;c<t.kerning.length;c++){let{first:u,second:d,amount:p}=t.kerning[c];u/=l,d/=l,p/=l,this.chars[d]&&(this.chars[d].kerning[u]=p)}this.distanceFieldRange=a?.distanceRange,this.distanceFieldType=a?.fieldType?.toLowerCase()??"none"}destroy(){for(let t in this.chars)this.chars[t].texture.destroy(),this.chars[t].texture=null;for(let t in this.pageTextures)this._ownsTextures&&this.pageTextures[t].destroy(!0),this.pageTextures[t]=null;this.chars=null,this.pageTextures=null}static install(t,e,i){let s;if(t instanceof xr)s=t;else{let n=sd(t);if(!n)throw new Error("Unrecognized data format for font.");s=n.parse(t)}e instanceof v&&(e=[e]);let o=new yr(s,e,i);return yr.available[o.font]=o,o}static uninstall(t){let e=yr.available[t];if(!e)throw new Error(`No font found named '${t}'`);e.destroy(),delete yr.available[t]}static from(t,e,i){if(!t)throw new Error("[BitmapFont] Property `name` is required.");let{chars:s,padding:o,resolution:n,textureWidth:a,textureHeight:l,...h}=Object.assign({},yr.defaultOptions,i),c=ad(s),u=e instanceof Te?e:new Te(e),d=a,p=new xr;p.info[0]={face:u.fontFamily,size:u.fontSize},p.common[0]={lineHeight:u.fontSize};let f=0,m=0,g,x,b,y=0,_=[],L=[];for(let F=0;F<c.length;F++){g||(g=C.ADAPTER.createCanvas(),g.width=a,g.height=l,x=g.getContext("2d"),b=new K(g,{resolution:n,...h}),_.push(b),L.push(new v(b)),p.page.push({id:L.length-1,file:""}));let B=c[F],H=Ve.measureText(B,u,!1,g),Z=H.width,O=Math.ceil(H.height),G=Math.ceil((u.fontStyle==="italic"?2:1)*Z);if(m>=l-O*n){if(m===0)throw new Error(`[BitmapFont] textureHeight ${l}px is too small (fontFamily: '${u.fontFamily}', fontSize: ${u.fontSize}px, char: '${B}')`);--F,g=null,x=null,b=null,m=0,f=0,y=0;continue}if(y=Math.max(O+H.fontProperties.descent,y),G*n+f>=d){if(f===0)throw new Error(`[BitmapFont] textureWidth ${a}px is too small (fontFamily: '${u.fontFamily}', fontSize: ${u.fontSize}px, char: '${B}')`);--F,m+=y*n,m=Math.ceil(m),f=0,y=0;continue}nd(g,x,H,f,m,n,u);let E=Xi(H.text);p.char.push({id:E,page:L.length-1,x:f/n,y:m/n,width:G,height:O,xoffset:0,yoffset:0,xadvance:Z-(u.dropShadow?u.dropShadowDistance:0)-(u.stroke?u.strokeThickness:0)}),f+=(G+2*o)*n,f=Math.ceil(f)}if(!i?.skipKerning)for(let F=0,B=c.length;F<B;F++){let H=c[F];for(let Z=0;Z<B;Z++){let O=c[Z],G=x.measureText(H).width,E=x.measureText(O).width,P=x.measureText(H+O).width-(G+E);P&&p.kerning.push({first:Xi(H),second:Xi(O),amount:P})}}let W=new yr(p,L,!0);return yr.available[t]!==void 0&&yr.uninstall(t),yr.available[t]=W,W}};ai.ALPHA=[["a","z"],["A","Z"]," "],ai.NUMERIC=[["0","9"]],ai.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],ai.ASCII=[[" ","~"]],ai.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:ai.ALPHANUMERIC},ai.available={};var er=ai;var Wx=`// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
  if (median < 0.01) {\r
    alpha = 0.0;\r
  } else if (median > 0.99) {\r
    alpha = 1.0;\r
  }\r
\r
  // Gamma correction for coverage-like alpha\r
  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r
  float gamma = mix(1.0, 1.0 / 2.2, luma);\r
  float coverage = pow(uColor.a * alpha, gamma);  \r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, coverage);\r
}\r
`;var Xx=`// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`;var $x=[],Yx=[],Kx=[],Cw=class qx extends D{constructor(t,e={}){super();let{align:i,tint:s,maxWidth:o,letterSpacing:n,fontName:a,fontSize:l}=Object.assign({},qx.styleDefaults,e);if(!er.available[a])throw new Error(`Missing BitmapFont "${a}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=i,this._tintColor=new tt(s),this._font=void 0,this._fontName=a,this._fontSize=l,this.text=t,this._maxWidth=o,this._maxLineHeight=0,this._letterSpacing=n,this._anchor=new re(()=>{this.dirty=!0},this,0,0),this._roundPixels=C.ROUND_PIXELS,this.dirty=!0,this._resolution=C.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){let t=er.available[this._fontName],e=this.fontSize,i=e/t.size,s=new $,o=[],n=[],a=[],l=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",h=zn(l),c=this._maxWidth*t.size/e,u=t.distanceFieldType==="none"?$x:Yx,d=null,p=0,f=0,m=0,g=-1,x=0,b=0,y=0,_=0;for(let O=0;O<h.length;O++){let G=h[O],E=Xi(G);if(/(?:\s)/.test(G)&&(g=O,x=p,_++),G==="\r"||G===`
`){n.push(p),a.push(-1),f=Math.max(f,p),++m,++b,s.x=0,s.y+=t.lineHeight,d=null,_=0;continue}let P=t.chars[E];if(!P)continue;d&&P.kerning[d]&&(s.x+=P.kerning[d]);let J=Kx.pop()||{texture:v.EMPTY,line:0,charCode:0,prevSpaces:0,position:new $};J.texture=P.texture,J.line=m,J.charCode=E,J.position.x=Math.round(s.x+P.xOffset+this._letterSpacing/2),J.position.y=Math.round(s.y+P.yOffset),J.prevSpaces=_,o.push(J),p=J.position.x+Math.max(P.xAdvance-P.xOffset,P.texture.orig.width),s.x+=P.xAdvance+this._letterSpacing,y=Math.max(y,P.yOffset+P.texture.height),d=E,g!==-1&&c>0&&s.x>c&&(++b,w.removeItems(o,1+g-b,1+O-g),O=g,g=-1,n.push(x),a.push(o.length>0?o[o.length-1].prevSpaces:0),f=Math.max(f,x),m++,s.x=0,s.y+=t.lineHeight,d=null,_=0)}let L=h[h.length-1];L!=="\r"&&L!==`
`&&(/(?:\s)/.test(L)&&(p=x),n.push(p),f=Math.max(f,p),a.push(-1));let W=[];for(let O=0;O<=m;O++){let G=0;this._align==="right"?G=f-n[O]:this._align==="center"?G=(f-n[O])/2:this._align==="justify"&&(G=a[O]<0?0:(f-n[O])/a[O]),W.push(G)}let F=o.length,B={},H=[],Z=this._activePagesMeshData;u.push(...Z);for(let O=0;O<F;O++){let G=o[O].texture,E=G.baseTexture.uid;if(!B[E]){let P=u.pop();if(!P){let it=new si,A,M;t.distanceFieldType==="none"?(A=new Or(v.EMPTY),M=q.NORMAL):(A=new Or(v.EMPTY,{program:ie.from(Xx,Wx),uniforms:{uFWidth:0}}),M=q.NORMAL_NPM);let k=new Wi(it,A);k.blendMode=M,P={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:k,vertices:null,uvs:null,indices:null}}P.index=0,P.indexCount=0,P.vertexCount=0,P.uvsCount=0,P.total=0;let{_textureCache:J}=this;J[E]=J[E]||new v(G.baseTexture),P.mesh.texture=J[E],P.mesh.tint=this._tintColor.value,H.push(P),B[E]=P}B[E].total++}for(let O=0;O<Z.length;O++)H.includes(Z[O])||this.removeChild(Z[O].mesh);for(let O=0;O<H.length;O++)H[O].mesh.parent!==this&&this.addChild(H[O].mesh);this._activePagesMeshData=H;for(let O in B){let G=B[O],E=G.total;if(!(G.indices?.length>6*E)||G.vertices.length<Wi.BATCHABLE_SIZE*2)G.vertices=new Float32Array(4*2*E),G.uvs=new Float32Array(4*2*E),G.indices=new Uint16Array(6*E);else{let P=G.total,J=G.vertices;for(let it=P*4*2;it<J.length;it++)J[it]=0}G.mesh.size=6*E}for(let O=0;O<F;O++){let G=o[O],E=G.position.x+W[G.line]*(this._align==="justify"?G.prevSpaces:1);this._roundPixels&&(E=Math.round(E));let P=E*i,J=G.position.y*i,it=G.texture,A=B[it.baseTexture.uid],M=it.frame,k=it._uvs,V=A.index++;A.indices[V*6+0]=0+V*4,A.indices[V*6+1]=1+V*4,A.indices[V*6+2]=2+V*4,A.indices[V*6+3]=0+V*4,A.indices[V*6+4]=2+V*4,A.indices[V*6+5]=3+V*4,A.vertices[V*8+0]=P,A.vertices[V*8+1]=J,A.vertices[V*8+2]=P+M.width*i,A.vertices[V*8+3]=J,A.vertices[V*8+4]=P+M.width*i,A.vertices[V*8+5]=J+M.height*i,A.vertices[V*8+6]=P,A.vertices[V*8+7]=J+M.height*i,A.uvs[V*8+0]=k.x0,A.uvs[V*8+1]=k.y0,A.uvs[V*8+2]=k.x1,A.uvs[V*8+3]=k.y1,A.uvs[V*8+4]=k.x2,A.uvs[V*8+5]=k.y2,A.uvs[V*8+6]=k.x3,A.uvs[V*8+7]=k.y3}this._textWidth=f*i,this._textHeight=(s.y+t.lineHeight)*i;for(let O in B){let G=B[O];if(this.anchor.x!==0||this.anchor.y!==0){let it=0,A=this._textWidth*this.anchor.x,M=this._textHeight*this.anchor.y;for(let k=0;k<G.total;k++)G.vertices[it++]-=A,G.vertices[it++]-=M,G.vertices[it++]-=A,G.vertices[it++]-=M,G.vertices[it++]-=A,G.vertices[it++]-=M,G.vertices[it++]-=A,G.vertices[it++]-=M}this._maxLineHeight=y*i;let E=G.mesh.geometry.getBuffer("aVertexPosition"),P=G.mesh.geometry.getBuffer("aTextureCoord"),J=G.mesh.geometry.getIndex();E.data=G.vertices,P.data=G.uvs,J.data=G.indices,E.update(),P.update(),J.update()}for(let O=0;O<o.length;O++)Kx.push(o[O]);this._font=t,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0);let{distanceFieldRange:e,distanceFieldType:i,size:s}=er.available[this._fontName];if(i!=="none"){let{a:o,b:n,c:a,d:l}=this.worldTransform,h=Math.sqrt(o*o+n*n),c=Math.sqrt(a*a+l*l),u=(Math.abs(h)+Math.abs(c))/2,d=this.fontSize/s,p=t._view.resolution;for(let f of this._activePagesMeshData)f.mesh.shader.uniforms.uFWidth=u*e*d*p}super._render(t)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){let t=er.available[this._fontName];if(!t)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==t&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(t){if(this.tint!==t){this._tintColor.setValue(t);for(let e=0;e<this._activePagesMeshData.length;e++)this._activePagesMeshData[e].mesh.tint=t}}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.dirty=!0)}get fontName(){return this._fontName}set fontName(t){if(!er.available[t])throw new Error(`Missing BitmapFont "${t}"`);this._fontName!==t&&(this._fontName=t,this.dirty=!0)}get fontSize(){return this._fontSize??er.available[this._fontName].size}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.dirty=!0)}get anchor(){return this._anchor}set anchor(t){typeof t=="number"?this._anchor.set(t):this._anchor.copyFrom(t)}get text(){return this._text}set text(t){t=String(t??""),this._text!==t&&(this._text=t,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(t){t!==this._roundPixels&&(this._roundPixels=t,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}destroy(t){let{_textureCache:e}=this,i=er.available[this._fontName].distanceFieldType==="none"?$x:Yx;i.push(...this._activePagesMeshData);for(let s of this._activePagesMeshData)this.removeChild(s.mesh);this._activePagesMeshData=[],i.filter(s=>e[s.mesh.texture.baseTexture.uid]).forEach(s=>{s.mesh.texture=v.EMPTY});for(let s in e)e[s].destroy(),delete e[s];this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(t)}};Cw.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};var Sw=[".xml",".fnt"],Zx={extension:{type:T.LoadParser,priority:_t.Normal},name:"loadBitmapFont",test(r){return Sw.includes(w.path.extname(r).toLowerCase())},async testParse(r){return kr.test(r)||ni.test(r)},async parse(r,t,e){let i=kr.test(r)?kr.parse(r):ni.parse(r),{src:s}=t,{page:o}=i,n=[];for(let h=0;h<o.length;++h){let c=o[h].file,u=w.path.join(w.path.dirname(s),c);u=Oi(u,s),n.push(u)}let a=await e.load(n),l=n.map(h=>a[h]);return er.install(i,l,!0)},async load(r,t){return(await C.ADAPTER.fetch(r)).text()},unload(r){r.destroy()}};S.add(Zx);var ld=class io extends Te{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(t){return new io(Object.keys(io.defaultOptions).reduce((e,i)=>({...e,[i]:t[i]}),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach(t=>{URL.revokeObjectURL(t.src),t.refs--,t.refs===0&&(t.fontFace&&document.fonts.delete(t.fontFace),delete io.availableFonts[t.originalUrl])}),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(t,e={}){let{availableFonts:i}=io;if(i[t]){let s=i[t];return this._fonts.push(s),s.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return C.ADAPTER.fetch(t).then(s=>s.blob()).then(async s=>new Promise((o,n)=>{let a=URL.createObjectURL(s),l=new FileReader;l.onload=()=>o([a,l.result]),l.onerror=n,l.readAsDataURL(s)})).then(async([s,o])=>{let n=Object.assign({family:w.path.basename(t,w.path.extname(t)),weight:"normal",style:"normal",display:"auto",src:s,dataSrc:o,refs:1,originalUrl:t,fontFace:null},e);i[t]=n,this._fonts.push(n),this.styleID++;let a=new FontFace(n.family,`url(${n.src})`,{weight:n.weight,style:n.style,display:n.display});n.fontFace=a,await a.load(),document.fonts.add(a),await document.fonts.ready,this.styleID++,this.fontsDirty=!0})}addOverride(...t){let e=t.filter(i=>!this._overrides.includes(i));e.length>0&&(this._overrides.push(...e),this.styleID++)}removeOverride(...t){let e=t.filter(i=>this._overrides.includes(i));e.length>0&&(this._overrides=this._overrides.filter(i=>!e.includes(i)),this.styleID++)}toCSS(t){return[`transform: scale(${t})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?[`word-wrap: ${this.breakWords?"break-all":"break-word"}`,`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce((t,e)=>`${t}
            @font-face {
                font-family: "${e.family}";
                src: url('${e.dataSrc}');
                font-weight: ${e.weight};
                font-style: ${e.style};
                font-display: ${e.display};
            }`,this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(t){this._stylesheet!==t&&(this._stylesheet=t,this.styleID++)}normalizeColor(t){return Array.isArray(t)&&(t=w.rgb2hex(t)),typeof t=="number"?w.hex2string(t):t}dropShadowToCSS(){let t=this.normalizeColor(this.dropShadowColor),e=this.dropShadowAlpha,i=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),s=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);t.startsWith("#")&&e<1&&(t+=(e*255|0).toString(16).padStart(2,"0"));let o=`${i}px ${s}px`;return this.dropShadowBlur>0?`text-shadow: ${o} ${this.dropShadowBlur}px ${t}`:`text-shadow: ${o} ${t}`}reset(){Object.assign(this,io.defaultOptions)}onBeforeDraw(){let{fontsDirty:t}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&t?new Promise(e=>setTimeout(e,100)):Promise.resolve()}get isSafari(){let{userAgent:t}=C.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(t)}set fillGradientStops(t){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(t){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(t){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(t){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(t){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(t){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(t){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}};ld.availableFonts={},ld.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};var Hn=ld;var kl=class so extends I{constructor(t="",e={}){super(v.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this.localStyleID=-1,this.dirty=!1,this._updateID=0,this.ownsStyle=!1;let i=new Image,s=v.from(i,{scaleMode:C.SCALE_MODE,resourceOptions:{autoLoad:!1}});s.orig=new Y,s.trim=new Y,this.texture=s;let o="http://www.w3.org/2000/svg",n="http://www.w3.org/1999/xhtml",a=document.createElementNS(o,"svg"),l=document.createElementNS(o,"foreignObject"),h=document.createElementNS(n,"div"),c=document.createElementNS(n,"style");l.setAttribute("width","10000"),l.setAttribute("height","10000"),l.style.overflow="hidden",a.appendChild(l),this.maxWidth=so.defaultMaxWidth,this.maxHeight=so.defaultMaxHeight,this._domElement=h,this._styleElement=c,this._svgRoot=a,this._foreignObject=l,this._foreignObject.appendChild(c),this._foreignObject.appendChild(h),this._image=i,this._loadImage=new Image,this._autoResolution=so.defaultAutoResolution,this._resolution=so.defaultResolution??C.RESOLUTION,this.text=t,this.style=e}measureText(t){let{text:e,style:i,resolution:s}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},t);Object.assign(this._domElement,{innerHTML:e,style:i.toCSS(s)}),this._styleElement.textContent=i.toGlobalCSS(),document.body.appendChild(this._svgRoot);let o=this._domElement.getBoundingClientRect();this._svgRoot.remove();let{width:n,height:a}=o;(n>this.maxWidth||a>this.maxHeight)&&console.warn("[HTMLText] Large expanse of text, increase HTMLText.maxWidth or HTMLText.maxHeight property.");let l=Math.min(this.maxWidth,Math.ceil(n)),h=Math.min(this.maxHeight,Math.ceil(a));return this._svgRoot.setAttribute("width",l.toString()),this._svgRoot.setAttribute("height",h.toString()),e!==this._text&&(this._domElement.innerHTML=this._text),i!==this._style&&(Object.assign(this._domElement,{style:this._style?.toCSS(s)}),this._styleElement.textContent=this._style?.toGlobalCSS()),{width:l+i.padding*2,height:h+i.padding*2}}async updateText(t=!0){let{style:e,_image:i,_loadImage:s}=this;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;let{width:o,height:n}=this.measureText();i.width=s.width=Math.ceil(Math.max(1,o)),i.height=s.height=Math.ceil(Math.max(1,n)),this._updateID++;let a=this._updateID;await new Promise(l=>{s.onload=async()=>{if(a<this._updateID){l();return}await e.onBeforeDraw(),i.src=s.src,s.onload=null,s.src="",this.updateTexture(),l()};let h=new XMLSerializer().serializeToString(this._svgRoot);s.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(h)}`})}get source(){return this._image}updateTexture(){let{style:t,texture:e,_image:i,resolution:s}=this,{padding:o}=t,{baseTexture:n}=e;e.trim.width=e._frame.width=i.width/s,e.trim.height=e._frame.height=i.height/s,e.trim.x=-o,e.trim.y=-o,e.orig.width=e._frame.width-o*2,e.orig.height=e._frame.height-o*2,this._onTextureUpdate(),n.setRealSize(i.width,i.height,s),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}_renderCanvas(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(t)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds(t)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(t){typeof t=="boolean"&&(t={children:t}),t=Object.assign({},so.defaultDestroyOptions,t),super.destroy(t);let e=null;this.ownsStyle&&this._style?.cleanFonts(),this._style=e,this._svgRoot?.remove(),this._svgRoot=e,this._domElement?.remove(),this._domElement=e,this._foreignObject?.remove(),this._foreignObject=e,this._styleElement?.remove(),this._styleElement=e,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=e,this._image.src="",this._image=e}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(t){this.updateText(!0);let e=w.sign(this.scale.x)||1;this.scale.x=e*t/this._image.width/this.resolution,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(t){this.updateText(!0);let e=w.sign(this.scale.y)||1;this.scale.y=e*t/this._image.height/this.resolution,this._height=t}get style(){return this._style}set style(t){this._style!==t&&(t=t||{},t instanceof Hn?(this.ownsStyle=!1,this._style=t):t instanceof Te?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=Hn.from(t)):(this.ownsStyle=!0,this._style=new Hn(t)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(t){t=String(t===""||t===null||t===void 0?" ":t),t=this.sanitiseText(t),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}sanitiseText(t){return t.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};kl.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},kl.defaultMaxWidth=2024,kl.defaultMaxHeight=2024,kl.defaultAutoResolution=!0;var Nl=class extends D{icon;label;constructor(t,e){super(),this.icon=new I(v.from(t)),this.label=new rt(e,{fontFamily:N.font,fontSize:54,fill:16777215}),this.icon.anchor.set(.5),this.label.anchor.set(0,.5),this.label.position.set(this.icon.width/2+7,-1),this.addChild(this.icon),this.addChild(this.label)}reset(t,e){this.icon.texture=v.from(t),this.label.text=e,this.alpha=1}};function jt(r,t){let e=t.reduce((s,o)=>s+o),i=Math.floor(Math.random()*e);for(let s=0;s<t.length;s++){if(i-t[s]<0)return r[s];i-=t[s]}}var Ul=class r{static recentChoice=0;pickups=new Vt(()=>{let t=jt(["Health","Magnet","MoneyX2"],[1,1,1]);return new Sl(t)},t=>{let e=r.getNextKind([...dx]);t.reset(e)},t=>{t.destroy()});constructor(){}getFromEnemy(t,e){let i=this.pickups.getInstance();if(t.extraLoot&&Math.random()<t.extraLoot.chance){let s=e?this.filterOptions(t.extraLoot.drop,e):t.extraLoot.drop,o=jt(s,Array(s.length).fill(1));return i.reset(o),i}if(t.regularLoot){let s=e?this.filterOptions(Object.keys(t.regularLoot),e):Object.keys(t.regularLoot),o=jt(s,s.map(n=>t.regularLoot[n]));return i.reset(o),i}}filterOptions(t,e){if(e.length>0){let i=t.filter(s=>!e.includes(s));if(i.length>0)return i}return t}static getNextKind(t){return t[r.recentChoice++%t.length]}};var Gl=class{target;_active=!1;initialTargetCoord;initialPointerCoord;leftBound;rightBound;factor=.02;constructor(t){this.target=t}start(t){this.initialPointerCoord=t.x,this.initialTargetCoord=this.target.roadX,this._active=!0}stop(){this._active=!1}update(t){if(!this.active)return;let e=t.x-this.initialPointerCoord,i=this.initialTargetCoord+e*this.factor;this.target.roadX=Math.min(this.rightBound,Math.max(this.leftBound,i))}setBounds(t,e){this.leftBound=t,this.rightBound=e}get active(){return this._active}};var oo=class extends D{bgSprite;fillSprite;constructor(){super(),this.reset()}reset(){this.removeChildren(),this.bgSprite=new I(v.from("enemy-progress-bar-back")),this.bgSprite.anchor.set(.5),this.fillSprite=new I(v.from("enemy-progress-bar-full")),this.fillSprite.anchor.set(.5);let t=new I(v.from("enemy-progress-bar-mask"));t.anchor.set(.5),this.fillSprite.mask=t,this.addChild(this.bgSprite),this.addChild(this.fillSprite),this.addChild(t),this.scale.set(.5),this.updateValue(1)}updateValue(t){this.fillSprite.x=-this.fillSprite.width*(1-t)}};var Nr={minDamage:10,maxDamage:45,minRadius:300,maxRadius:800},zl=["regular","fuel","taxi","hpvan","moneyvan","mystery"],Vn={regular:{gfx:"Enemy-Car",hp:60,rep:1,regularLoot:{MoneyBill:.8,MoneyStack:.2},extraLoot:{chance:.05,drop:["Health","Magnet","MoneyX2"]}},fuel:{gfx:"Gas-Car",hp:90,rep:5,regularLoot:{MoneyBill:.6,MoneyStack:.4},extraLoot:{chance:.1,drop:["Health","Magnet","MoneyX2"]}},taxi:{gfx:"Taxi-Car",hp:120,rep:5,regularLoot:{MoneyBill:.6,MoneyStack:.4},extraLoot:{chance:.1,drop:["Health","Magnet","MoneyX2"]}},hpvan:{gfx:"Heal-Car",hp:120,rep:5,extraLoot:{chance:1,drop:["Health"]}},moneyvan:{gfx:"Money-Car",hp:120,rep:5,extraLoot:{chance:1,drop:["MoneyStack"]}},mystery:{gfx:"Mystery-Car",hp:480,rep:5,extraLoot:{chance:1,drop:["Health","Magnet","MoneyX2"]}}},no=class extends ti{kind;dead;maxHealth;healthBar;constructor(){super(),this.healthBar=new oo,this.addChild(this.healthBar)}takeDamage(t){super.takeDamage(t),this.health-=t,this.healthBar.visible=!0,this.healthBar.updateValue(this.health/this.maxHealth)}static getFuelExplosionDamage(t){return Math.min(Nr.maxDamage,Nr.minDamage+(Nr.maxRadius-t)/(Nr.maxRadius-Nr.minRadius)*(Nr.maxDamage-Nr.minDamage))}};function vr(r,t){return r=Math.ceil(r),t=Math.floor(t),Math.floor(Math.random()*(t-r+1))+r}var Ew={spawnPeriodMS:1e3},ao=class r{static lastid=0;config;lastSpawnedMS;cars=new Vt(()=>new no,t=>{t.dead=!1,t.healthBar.visible=!1},t=>{t.destroy({children:!0})});onSpawn=new Ge;constructor(t){this.config=Object.assign({},Ew,t||{}),this.lastSpawnedMS=0}spawn(){this.onSpawn.dispatch()}update(t){this.lastSpawnedMS+=t,this.lastSpawnedMS>this.config.spawnPeriodMS&&(this.lastSpawnedMS-=this.config.spawnPeriodMS,this.spawn())}resetTimer(t){this.lastSpawnedMS=this.config.spawnPeriodMS-t}static randomizeCar(t){let e=jt([...zl],[0,1,0,0,0]);r.changeCarKind(t,e)}static changeCarKind(t,e){let i=Vn[e];t.kind=e,t.body.texture=v.from(i.gfx),t.resizeHitbox(),t.maxHealth=i.hp,t.health=i.hp,t.healthBar.y=t.body.height/2+t.healthBar.height/2+10,t.healthBar.updateValue(1)}static loadNextCar(t){let e=zl[r.lastid++%zl.length];t.kind=e,this.changeCarKind(t,e)}};var Aw=[1,2,4],Hl={hitboxPadding:20},lo=class r extends D{hitbox;roadMark;items;lane;constructor(){super(),this.roadMark=new I(v.from("Obs-11")),this.roadMark.anchor.set(.5,0),this.items=new D,this.hitbox=new ur,this.scale.set(.5),this.addChild(this.roadMark),this.addChild(this.hitbox),this.addChild(this.items)}static create(){let t=new r;return r.reset(t),t}static reset(t){let e=r.getRandomId(),i=Math.floor(Math.random()*3)+4;t.items.removeChildren();let s=0,o=0;for(let n=0;n<i;n++){let a=new I(v.from(`Obs-${e}`));a.position.set(s,o),s+=a.width,s>t.roadMark.width-2*Hl.hitboxPadding&&(s=0,o+=a.width),t.items.addChild(a)}t.items.pivot.x=t.items.width/2,Ft.disableShadows||(t.items.filters=[new Vi({blur:2,offset:{x:-6,y:4}})]),t.hitbox.clear(),t.hitbox.beginFill(16777215,.5),t.hitbox.drawRect(-t.items.width/2+Hl.hitboxPadding,Hl.hitboxPadding,t.items.width-Hl.hitboxPadding*2,t.items.height*.9),t.hitbox.endFill(),t.hitbox.visible=!1}static destroyObstacle(t){t.destroy({children:!0})}static getRandomId(){return jt([...Aw],[1,1,1])}};var Pw={spawnPeriodMS:5e3},Vl=class{config;lastSpawnedMS;obstacles=new Vt(lo.create,lo.reset,lo.destroyObstacle);onSpawn=new Ge;constructor(t){this.config=Object.assign({},Pw,t||{}),this.lastSpawnedMS=0}spawn(){return this.obstacles.getInstance()}update(t){this.lastSpawnedMS+=t,this.lastSpawnedMS>this.config.spawnPeriodMS&&(this.lastSpawnedMS-=this.config.spawnPeriodMS,this.spawn())}};var jl=160,hd=[[{lane:0,possibleEnemies:["regular","taxi","obstacle"],offsetRange:[0,0]},{lane:1,possibleEnemies:["fuel","regular","taxi","obstacle"],offsetRange:[0,jl]}],[{lane:0,possibleEnemies:["regular","taxi"],offsetRange:[0,jl]},{lane:2,possibleEnemies:["regular"],offsetRange:[0,0]}],[{lane:0,possibleEnemies:["regular","taxi"],offsetRange:[0,jl]},{lane:2,possibleEnemies:["fuel","moneyvan","hpvan","obstacle"],offsetRange:[0,jl]},{lane:4,possibleEnemies:["regular","obstacle"],offsetRange:[0,0]}]],Wl=class{laneData;constructor(t,e=0,i=!1){this.laneData=t.map(s=>({lane:this.pickLane(s.lane,e,i),enemy:this.pickEnemyKind(s.possibleEnemies),offset:this.pickEnemyOffset(s.offsetRange)}))}pickLane(t,e,i){return(t+e)%ne.laneCount}pickEnemyKind(t){return jt(t,Array(t.length).fill(1))}pickEnemyOffset(t){return vr(t[0],t[1])}};var Xl=class{road;enemySpawner;obstacleSpawner;container;enemyContainer;obstacleContainer;timeToMysteryCarMS;timeToBossMS;bossMode;constructor(t,e){this.road=t,this.timeToBossMS=bt.timeToBossMS,this.bossMode=!1,this.enemySpawner=new ao,this.obstacleSpawner=new Vl,this.container=new D,this.enemyContainer=new D,this.obstacleContainer=new D,this.container.addChild(this.obstacleContainer),this.container.addChild(this.enemyContainer),this.enemySpawner.onSpawn.add(()=>{this.timeToBossMS>1500&&this.spawnThreats(e.isFullHealth()?["hpvan"]:void 0)}),this.timeToMysteryCarMS=bt.mysteryCarPeriodMS}spawnThreats(t){let e=jt(hd,Array(hd.length).fill(1)),i=[];t?e.forEach(o=>{i.push(Object.assign({},o,{possibleEnemies:o.possibleEnemies.filter(n=>!t.includes(n))}))}):i=[...e],new Wl(i,vr(0,ne.laneCount-1)).laneData.forEach(o=>{if(this.road.lanes[o.lane]<1){let n,a;o.enemy!="obstacle"?(n=this.enemySpawner.cars.getInstance(),a=this.enemyContainer,ao.changeCarKind(n,o.enemy)):(n=this.obstacleSpawner.obstacles.getInstance(),a=this.obstacleContainer),this.addThreatToLane(n,a,o.lane,o.offset)}})}addThreatToLane(t,e,i,s=0){t.lane=i,e.addChild(t),t.position.set(this.road.getLaneX(i),-t.height-s),this.road.increaseLaneOccupancy(i)}update(t){this.bossMode||(this.timeToBossMS-=t,this.checkMysteryCarSpawn(t),this.enemySpawner.update(t),this.timeToBossMS<=0&&this.spawnBoss())}spawnBoss(){this.bossMode=!0,ct.emit("BOSS_APPEAR")}disableBossMode(){this.bossMode=!1,this.timeToBossMS=bt.timeToBossMS}clearThreats(){this.enemySpawner.cars.activeInstances.forEach(t=>this.enemySpawner.cars.release(t)),this.obstacleSpawner.obstacles.activeInstances.forEach(t=>this.obstacleSpawner.obstacles.release(t)),this.road.clearLanes()}resetTimers(t){this.enemySpawner.resetTimer(t),this.timeToMysteryCarMS=bt.mysteryCarPeriodMS+t}checkMysteryCarSpawn(t){if(this.timeToMysteryCarMS-=t,this.timeToMysteryCarMS<0){let e=this.road.getFreeLane();if(e!==void 0){let i=this.enemySpawner.cars.getInstance();ao.changeCarKind(i,"mystery"),this.addThreatToLane(i,this.enemyContainer,e,0),this.timeToMysteryCarMS=bt.mysteryCarPeriodMS}}}releaseEnemy(t){this.road.decreaseLaneOccupancy(t.lane),this.enemySpawner.cars.release(t)}releaseObstacle(t){this.road.decreaseLaneOccupancy(t.lane),this.obstacleSpawner.obstacles.release(t)}get enemies(){return this.enemySpawner.cars}get activeEnemies(){return this.enemySpawner.cars.activeInstances}get obstacles(){return this.obstacleSpawner.obstacles}get activeObstacles(){return this.obstacleSpawner.obstacles.activeInstances}clearSignals(){this.enemySpawner.onSpawn.removeAll(),this.obstacleSpawner.onSpawn.removeAll()}};var $l={projectileOffsetX:30,projectileOffsetY:-150},Yl=class extends Re{rotation=0;body;level=1;constructor(t){super(t||{},new Vt(()=>{let e=new I;return e.anchor.set(.5),e.scale.set(1.5),e},e=>{e.rotation=0,e.texture=v.from(`Fire-1-${this.getColor(this.level)}`)},Re.destroyProjectile)),this.lastFiredMS=0,this.body=new I(v.from("Boss_Weapon_Front")),this.body.scale.set(.5),this.body.anchor.set(.5,.7),this.body.addChild(this.flashes)}setupMuzzleFlash(t){this.flashes.removeChildren();let e=this.getColor(t);this.addMuzzleFlash(v.from(`Fire-Exit-1-${e}`),{x:-32,y:-180}),this.addMuzzleFlash(v.from(`Fire-Exit-1-${e}`),{x:30,y:-180})}upgrade(t){this.level=t,this.setupMuzzleFlash(t)}aim(t){this.rotation=Math.atan2(t.y-this.body.parent.y,t.x-this.body.parent.x),this.body.rotation=this.rotation+Math.PI/2}fire(){super.fire();let t=this.projectiles.getInstance();t.rotation=this.rotation+Math.PI/2,this.body.addChild(t),t.position.set(-$l.projectileOffsetX,$l.projectileOffsetY),this.onFire.dispatch([t]);let e=this.projectiles.getInstance();e.rotation=this.rotation+Math.PI/2,this.body.addChild(e),e.position.set($l.projectileOffsetX,$l.projectileOffsetY),this.onFire.dispatch([e])}};function Qx(r){return r<.5?2*r*r:1-Math.pow(-2*r+2,2)/2}var Iw={threshold:.2,moveTime:1e3,checkPeriodMS:2e3},Kl=class{config;checkTime;steeredCar;targetCar;oldX;targetX;movementTime;constructor(t,e,i){this.config=Object.assign({},Iw,t),this.steeredCar=e,this.targetCar=i,this.oldX=this.steeredCar.roadX,this.targetX=this.targetCar.roadX,this.checkTime=0}update(t){this.checkTime+=t,this.checkTime>=this.config.checkPeriodMS&&Math.abs(this.steeredCar.roadX-this.targetCar.roadX)>this.config.threshold&&(this.checkTime-=this.config.checkPeriodMS,this.startMoving(this.targetCar.roadX)),this.movementTime<this.config.moveTime&&this.adjustPosition(t)}reset(){this.checkTime=0,this.movementTime=this.config.moveTime}startMoving(t){this.oldX=this.steeredCar.roadX,this.targetX=t,this.movementTime=0}adjustPosition(t){this.movementTime+=t,this.steeredCar.roadX=this.oldX+(this.targetX-this.oldX)*Qx(this.movementTime/this.config.moveTime)}};var ql=class extends ti{target;steering;healthBar;level;gun;constructor(t){super(),this.level=t,this.body.texture=v.from("Boss-Car"),this.body.scale.set(.75),this.resizeHitbox(),this.hitbox.y-=10,this.hitbox.scale.x=1.1,this.gun=new Yl({firePeriodMS:1e3,projectileSpeed:.7}),this.addChild(this.gun.body),this.scale.set(1.5),this.resetHealth(t),this.gun.aim({x:this.x,y:this.y+100})}setTarget(t){this.target=t,this.steering=new Kl({},this,this.target)}update(t){this.gun.aim(this.target.position),this.gun.body.tint=this.body.tint,this.steering&&this.steering.update(t)}revive(t){this.level=t,this.steering.reset(),this.resetHealth(t),this.gun.upgrade(t)}takeDamage(t){super.takeDamage(t),this.health-=t,this.healthBar.alpha=1,this.healthBar.updateValue(this.health/this.getHealthForLevel(this.level))}resetHealth(t){this.healthBar&&this.removeChild(this.healthBar),this.health=this.getHealthForLevel(t),this.healthBar=new oo,this.healthBar.y=this.body.height/2+this.healthBar.height/2,this.healthBar.scale.set(.25),this.healthBar.alpha=0,this.addChild(this.healthBar)}getHealthForLevel(t){return Ft.weakBosses?200+t*10:1800+t*300}getRewardForLevel(t){return Math.round((130+t*(10+t))/10)*10}};var Kt=class extends D{type;text;constructor(t){super(),this.type=t;let e=new I(v.from("panel-currency")),i=new I(this.getIconTexture(this.type));this.text=new rt("0",{fontFamily:N.font,fontSize:N.locale=="en"?42:38,fill:16777215}),this.text.x=5,this.text.y=-1,i.position.set(-e.width/2,-3),[e,i,this.text].forEach(s=>{s.anchor.set(.5)}),this.addChild(e),this.addChild(i),this.addChild(this.text)}updateValue(t){this.text.text=t.toString()}getIconTexture(t){switch(t){case"Money":return v.from("icon-money")}}};var Zl=class extends D{icon;bg;fill;fillMask;tween;constructor(){super(),this.icon=new I(v.from("icon-health")),this.bg=new I(v.from("health-progress-back")),this.fill=new I(v.from("health-progress-full")),[this.bg,this.fill,this.icon].forEach(t=>t.anchor.set(.5)),this.icon.position.x-=this.bg.width/2,this.tween=new lt(this.fill).easing(at.Cubic.InOut).duration(300),this.updateValue(1),this.fillMask=new ur,this.fillMask.beginFill(16777215),this.fillMask.drawRect(-this.bg.width/2+4,-this.bg.height/2,this.bg.width,this.bg.height),this.fill.mask=this.fillMask,this.addChild(this.fillMask),this.addChild(this.bg),this.addChild(this.fill),this.addChild(this.icon)}updateValue(t){this.tween.dynamicTo({x:-this.bg.width*(1-t)}).restart()}};var ho=class extends D{text;constructor(){super();let t=new I(v.from("panel-profile")),e=new I(v.from("icon-rep")),i=new I(v.from("icon-profile")),s=new rt("0",{fontFamily:N.font,fontSize:48,fill:16777215});[t,i,e].forEach(o=>{o.anchor.set(.5)}),s.anchor.set(0,.5),i.position.set(-145,-15),e.position.set(-30,0),s.position.set(20,0),this.addChild(t),this.addChild(i),this.addChild(e),this.text=this.addChild(s)}updateValue(t){this.text.text=t.toString()}};var qt={width:300,height:30},Ql=class extends D{start;finish;fullBar;currentProgress;currentMarker;duration;g;progressValue=0;constructor(){super(),this.fullBar=new I(v.WHITE),this.fullBar.scale.set(qt.width/16,qt.height/16),this.fullBar.alpha=.5,this.fullBar.anchor.set(.5),this.currentProgress=new I(v.WHITE),this.currentProgress.scale.set(qt.width/16*this.progressValue,qt.height/16),this.currentProgress.anchor.set(0,.5),this.currentProgress.x=-qt.width/2,this.currentProgress.tint=2017783,this.start=new I(v.from("progress-meter-start")),this.finish=new I(v.from("progress-meter-finish")),this.currentMarker=new I(v.from("icon-car")),[this.start,this.finish,this.currentMarker].forEach(t=>t.anchor.set(.5)),this.start.x=-qt.width/2,this.currentMarker.position.set(this.start.x,-35),this.finish.x=qt.width/2,this.addChild(this.fullBar),this.addChild(this.currentProgress),this.addChild(this.currentMarker),this.addChild(this.start),this.addChild(this.finish)}drawBar(){this.g.clear(),this.g.beginFill(tt.shared.setValue({r:255,g:255,b:255,a:.5})),this.g.drawRect(-qt.width/2,-qt.height/2,qt.width,qt.height),this.g.endFill(),this.g.beginFill(2217723),this.g.drawRect(-qt.width/2,-qt.height/2,qt.width*this.progressValue,qt.height)}updateValue(t){this.progressValue=t,this.currentMarker.x=qt.width*(t-.5),this.currentProgress.scale.x=qt.width/16*this.progressValue}};var Jl=class extends D{playerHealth;progress;money;reputation;constructor(){super(),this.money=new Kt("Money"),this.reputation=new ho,this.progress=new Ql,this.playerHealth=new Zl,this.addChild(this.progress),this.addChild(this.money),this.addChild(this.reputation),this.addChild(this.playerHealth),this.positionElements()}setMoney(t){this.money.updateValue(t)}setReputation(t){this.reputation.updateValue(t)}setProgress(t){this.progress.updateValue(t)}setHealth(t){this.playerHealth.updateValue(t)}positionElements(){this.reputation.position.set(U.width/2-300,80),this.progress.position.set(U.width/2+40,80),this.money.position.set(U.width/2+400,80),this.playerHealth.position.set(this.reputation.position.x-20,this.reputation.getBounds().bottom+5)}};function Mw(r,t){let e=t.x-r.x,i=t.y-r.y;return e*e+i*i}function Jx(r,t){return Math.sqrt(Mw(r,t))}var th=class extends D{title;titleBg;titleLabel;rewards;mainBg;rewardLabel;reward;constructor(t){super(),this.title=new D,this.titleBg=new I(v.from("panel-boss-title")),this.mainBg=new I(v.from("panel-boss-appear")),this.titleLabel=new rt(N.getText("Boss").toUpperCase(),{fontFamily:N.font,fill:2108255,fontSize:54}),this.rewards=new D,this.rewardLabel=new rt(N.getText("Bounty").toUpperCase(),{fontFamily:N.font,fill:16777215,fontSize:54}),this.reward=new Kt("Money"),this.reward.updateValue(t),[this.titleBg,this.mainBg,this.titleLabel,this.rewardLabel].forEach(e=>e.anchor.set(.5)),this.title.addChild(this.titleBg),this.title.addChild(this.titleLabel),this.rewards.addChild(this.rewardLabel),this.rewards.addChild(this.reward),this.addChild(this.mainBg),this.addChild(this.title),this.addChild(this.rewards),this.positionElements()}positionElements(){this.title.position.set(10,-100),this.mainBg.position.set(0,-30),this.rewards.position.set(-15,10),this.rewardLabel.position.set(-150,0),this.reward.position.set(150,0)}};var eh=class extends D{title;titleBg;titleLabel;rewards;mainBg;rewardLabel;reward;constructor(t){super(),this.title=new D,this.titleBg=new I(v.from("panel-boss-title")),this.mainBg=new I(v.from("panel-boss-complete")),this.titleLabel=new rt(N.getText("Boss defeated").toUpperCase(),{fontFamily:N.font,fill:2108255,fontSize:54}),this.rewards=new D,this.rewardLabel=new rt(N.getText("Reward").toUpperCase(),{fontFamily:N.font,fill:16777215,fontSize:54}),this.reward=new Kt("Money"),this.reward.updateValue(t),[this.titleBg,this.mainBg,this.titleLabel,this.rewardLabel].forEach(e=>e.anchor.set(.5)),this.title.addChild(this.titleBg),this.title.addChild(this.titleLabel),this.rewards.addChild(this.rewardLabel),this.rewards.addChild(this.reward),this.addChild(this.mainBg),this.addChild(this.title),this.addChild(this.rewards),this.positionElements()}positionElements(){this.title.position.set(10,-100),this.mainBg.position.set(0,-30),this.rewards.position.set(-15,10),this.rewardLabel.position.set(-150,0),this.reward.position.set(150,0)}};var rh=class extends D{dimmer;text;tween;constructor(){super(),this.tween=new lt(this).from({alpha:0}).to({alpha:1},300).easing(at.Quadratic.InOut),this.dimmer=new I(v.WHITE),this.dimmer.scale.set(U.width/this.dimmer.texture.width,U.height/this.dimmer.texture.height),this.dimmer.tint=0,this.dimmer.alpha=.7,this.text=new rt(N.getText("Tap to play"),{fontFamily:N.font,fontSize:104,fill:16777215,align:"center"}),this.text.anchor.set(.5),this.text.position.set(U.width/2,U.height*.7),this.alpha=0,this.addChild(this.dimmer),this.addChild(this.text)}tweenShow(){this.tween.start()}};var Tt=class extends D{bg;text;constructor(t,e,i){super(),this.bg=new I(e||v.WHITE),this.bg.anchor.set(.5),this.eventMode="static",this.on("pointerdown",()=>ct.emit("BUTTON_PRESS")),this.text=new rt(t,i),this.text.style.align="center",this.text.anchor.set(.5),this.addChild(this.bg),this.addChild(this.text)}};var ih=class extends D{text;constructor(){super();let t=new I(v.from("panel-end-rep")),e=new I(v.from("icon-rep"));e.scale.set(1.5);let i=new rt(N.getText("Rep:"),{fontFamily:N.font,fontSize:64,fill:16777215}),s=new rt("0",{fontFamily:N.font,fontSize:64,fill:16777215});[t].forEach(o=>{o.anchor.set(.5)}),[i,e,s].forEach(o=>{o.anchor.set(0,.5)}),i.position.set(-t.width/2+40,0),e.position.set(i.getBounds().right+40,0),s.position.set(e.getBounds().right+40,0),this.addChild(t),this.addChild(i),this.addChild(e),this.text=this.addChild(s)}updateValue(t){this.text.text=t.toString()}};var Rw=Object.defineProperty,Fw=(r,t,e)=>t in r?Rw(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,Pt=(r,t,e)=>(Fw(r,typeof t!="symbol"?t+"":t,e),e);var w0=function(r){let t=[],e=0;for(let i=0;i<r.length;i++){let s=r.charCodeAt(i);s<128?t[e++]=s:s<2048?(t[e++]=s>>6|192,t[e++]=s&63|128):(s&64512)===55296&&i+1<r.length&&(r.charCodeAt(i+1)&64512)===56320?(s=65536+((s&1023)<<10)+(r.charCodeAt(++i)&1023),t[e++]=s>>18|240,t[e++]=s>>12&63|128,t[e++]=s>>6&63|128,t[e++]=s&63|128):(t[e++]=s>>12|224,t[e++]=s>>6&63|128,t[e++]=s&63|128)}return t},Dw=function(r){let t=[],e=0,i=0;for(;e<r.length;){let s=r[e++];if(s<128)t[i++]=String.fromCharCode(s);else if(s>191&&s<224){let o=r[e++];t[i++]=String.fromCharCode((s&31)<<6|o&63)}else if(s>239&&s<365){let o=r[e++],n=r[e++],a=r[e++],l=((s&7)<<18|(o&63)<<12|(n&63)<<6|a&63)-65536;t[i++]=String.fromCharCode(55296+(l>>10)),t[i++]=String.fromCharCode(56320+(l&1023))}else{let o=r[e++],n=r[e++];t[i++]=String.fromCharCode((s&15)<<12|(o&63)<<6|n&63)}}return t.join("")},C0={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(r,t){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();let e=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let s=0;s<r.length;s+=3){let o=r[s],n=s+1<r.length,a=n?r[s+1]:0,l=s+2<r.length,h=l?r[s+2]:0,c=o>>2,u=(o&3)<<4|a>>4,d=(a&15)<<2|h>>6,p=h&63;l||(p=64,n||(d=64)),i.push(e[c],e[u],e[d],e[p])}return i.join("")},encodeString(r,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(r):this.encodeByteArray(w0(r),t)},decodeString(r,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(r):Dw(this.decodeStringToByteArray(r,t))},decodeStringToByteArray(r,t){this.init_();let e=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let s=0;s<r.length;){let o=e[r.charAt(s++)],n=s<r.length?e[r.charAt(s)]:0;++s;let a=s<r.length?e[r.charAt(s)]:64;++s;let l=s<r.length?e[r.charAt(s)]:64;if(++s,o==null||n==null||a==null||l==null)throw new bd;let h=o<<2|n>>4;if(i.push(h),a!==64){let c=n<<4&240|a>>2;if(i.push(c),l!==64){let u=a<<6&192|l;i.push(u)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let r=0;r<this.ENCODED_VALS.length;r++)this.byteToCharMap_[r]=this.ENCODED_VALS.charAt(r),this.charToByteMap_[this.byteToCharMap_[r]]=r,this.byteToCharMapWebSafe_[r]=this.ENCODED_VALS_WEBSAFE.charAt(r),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[r]]=r,r>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(r)]=r,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(r)]=r)}}},bd=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},Bw=function(r){let t=w0(r);return C0.encodeByteArray(t,!0)},S0=function(r){return Bw(r).replace(/\./g,"")},Lw=function(r){try{return C0.decodeString(r,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function Ow(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var kw=()=>Ow().__FIREBASE_DEFAULTS__,Nw=()=>{if(typeof process>"u"||typeof process.env>"u")return;let r=process.env.__FIREBASE_DEFAULTS__;if(r)return JSON.parse(r)},Uw=()=>{if(typeof document>"u")return;let r;try{r=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let t=r&&Lw(r[1]);return t&&JSON.parse(t)},Gw=()=>{try{return kw()||Nw()||Uw()}catch(r){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${r}`);return}},E0=()=>{var r;return(r=Gw())===null||r===void 0?void 0:r.config};var Td=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,i)=>{e?this.reject(e):this.resolve(i),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(e):t(e,i))}}};function zw(){let r=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof r=="object"&&r.id!==void 0}function Yd(){try{return typeof indexedDB=="object"}catch{return!1}}function A0(){return new Promise((r,t)=>{try{let e=!0,i="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(i);s.onsuccess=()=>{s.result.close(),e||self.indexedDB.deleteDatabase(i),r(!0)},s.onupgradeneeded=()=>{e=!1},s.onerror=()=>{var o;t(((o=s.error)===null||o===void 0?void 0:o.message)||"")}}catch(e){t(e)}})}function Hw(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}var Vw="FirebaseError",Ur=class r extends Error{constructor(t,e,i){super(e),this.code=t,this.customData=i,this.name=Vw,Object.setPrototypeOf(this,r.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,qi.prototype.create)}},qi=class{constructor(t,e,i){this.service=t,this.serviceName=e,this.errors=i}create(t,...e){let i=e[0]||{},s=`${this.service}/${t}`,o=this.errors[t],n=o?jw(o,i):"Error",a=`${this.serviceName}: ${n} (${s}).`;return new Ur(s,a,i)}};function jw(r,t){return r.replace(Ww,(e,i)=>{let s=t[i];return s!=null?String(s):`<${i}?>`})}var Ww=/\{\$([^}]+)}/g;function nh(r,t){if(r===t)return!0;let e=Object.keys(r),i=Object.keys(t);for(let s of e){if(!i.includes(s))return!1;let o=r[s],n=t[s];if(t0(o)&&t0(n)){if(!nh(o,n))return!1}else if(o!==n)return!1}for(let s of i)if(!e.includes(s))return!1;return!0}function t0(r){return r!==null&&typeof r=="object"}var Xw=1e3,$w=2,Yw=4*60*60*1e3,Kw=.5;function wd(r,t=Xw,e=$w){let i=t*Math.pow(e,r),s=Math.round(Kw*i*(Math.random()-.5)*2);return Math.min(Yw,i+s)}function di(r){return r&&r._delegate?r._delegate:r}var rr=class{constructor(t,e,i){this.name=t,this.instanceFactory=e,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}};var $i="[DEFAULT]";var Cd=class{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){let e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){let i=new Td;if(this.instancesDeferred.set(e,i),this.isInitialized(e)||this.shouldAutoInitialize())try{let s=this.getOrInitializeService({instanceIdentifier:e});s&&i.resolve(s)}catch{}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;let i=this.normalizeInstanceIdentifier(t?.identifier),s=(e=t?.optional)!==null&&e!==void 0?e:!1;if(this.isInitialized(i)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:i})}catch(o){if(s)return null;throw o}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(Zw(t))try{this.getOrInitializeService({instanceIdentifier:$i})}catch{}for(let[e,i]of this.instancesDeferred.entries()){let s=this.normalizeInstanceIdentifier(e);try{let o=this.getOrInitializeService({instanceIdentifier:s});i.resolve(o)}catch{}}}}clearInstance(t=$i){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){let t=Array.from(this.instances.values());await Promise.all([...t.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...t.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=$i){return this.instances.has(t)}getOptions(t=$i){return this.instancesOptions.get(t)||{}}initialize(t={}){let{options:e={}}=t,i=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let s=this.getOrInitializeService({instanceIdentifier:i,options:e});for(let[o,n]of this.instancesDeferred.entries()){let a=this.normalizeInstanceIdentifier(o);i===a&&n.resolve(s)}return s}onInit(t,e){var i;let s=this.normalizeInstanceIdentifier(e),o=(i=this.onInitCallbacks.get(s))!==null&&i!==void 0?i:new Set;o.add(t),this.onInitCallbacks.set(s,o);let n=this.instances.get(s);return n&&t(n,s),()=>{o.delete(t)}}invokeOnInitCallbacks(t,e){let i=this.onInitCallbacks.get(e);if(i)for(let s of i)try{s(t,e)}catch{}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let i=this.instances.get(t);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:qw(t),options:e}),this.instances.set(t,i),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(i,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,i)}catch{}return i||null}normalizeInstanceIdentifier(t=$i){return this.component?this.component.multipleInstances?t:$i:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function qw(r){return r===$i?void 0:r}function Zw(r){return r.instantiationMode==="EAGER"}var Sd=class{constructor(t){this.name=t,this.providers=new Map}addComponent(t){let e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);let e=new Cd(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}};var xt;(function(r){r[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT"})(xt||(xt={}));var Qw={debug:xt.DEBUG,verbose:xt.VERBOSE,info:xt.INFO,warn:xt.WARN,error:xt.ERROR,silent:xt.SILENT},Jw=xt.INFO,tC={[xt.DEBUG]:"log",[xt.VERBOSE]:"log",[xt.INFO]:"info",[xt.WARN]:"warn",[xt.ERROR]:"error"},eC=(r,t,...e)=>{if(t<r.logLevel)return;let i=new Date().toISOString(),s=tC[t];if(s)console[s](`[${i}]  ${r.name}:`,...e);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)},$n=class{constructor(t){this.name=t,this._logLevel=Jw,this._logHandler=eC,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in xt))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?Qw[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,xt.DEBUG,...t),this._logHandler(this,xt.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,xt.VERBOSE,...t),this._logHandler(this,xt.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,xt.INFO,...t),this._logHandler(this,xt.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,xt.WARN,...t),this._logHandler(this,xt.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,xt.ERROR,...t),this._logHandler(this,xt.ERROR,...t)}},rC=(r,t)=>t.some(e=>r instanceof e),e0,r0;function iC(){return e0||(e0=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function sC(){return r0||(r0=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var P0=new WeakMap,Ed=new WeakMap,I0=new WeakMap,cd=new WeakMap,Kd=new WeakMap;function oC(r){let t=new Promise((e,i)=>{let s=()=>{r.removeEventListener("success",o),r.removeEventListener("error",n)},o=()=>{e(li(r.result)),s()},n=()=>{i(r.error),s()};r.addEventListener("success",o),r.addEventListener("error",n)});return t.then(e=>{e instanceof IDBCursor&&P0.set(e,r)}).catch(()=>{}),Kd.set(t,r),t}function nC(r){if(Ed.has(r))return;let t=new Promise((e,i)=>{let s=()=>{r.removeEventListener("complete",o),r.removeEventListener("error",n),r.removeEventListener("abort",n)},o=()=>{e(),s()},n=()=>{i(r.error||new DOMException("AbortError","AbortError")),s()};r.addEventListener("complete",o),r.addEventListener("error",n),r.addEventListener("abort",n)});Ed.set(r,t)}var Ad={get(r,t,e){if(r instanceof IDBTransaction){if(t==="done")return Ed.get(r);if(t==="objectStoreNames")return r.objectStoreNames||I0.get(r);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return li(r[t])},set(r,t,e){return r[t]=e,!0},has(r,t){return r instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in r}};function aC(r){Ad=r(Ad)}function lC(r){return r===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...e){let i=r.call(ud(this),t,...e);return I0.set(i,t.sort?t.sort():[t]),li(i)}:sC().includes(r)?function(...t){return r.apply(ud(this),t),li(P0.get(this))}:function(...t){return li(r.apply(ud(this),t))}}function hC(r){return typeof r=="function"?lC(r):(r instanceof IDBTransaction&&nC(r),rC(r,iC())?new Proxy(r,Ad):r)}function li(r){if(r instanceof IDBRequest)return oC(r);if(cd.has(r))return cd.get(r);let t=hC(r);return t!==r&&(cd.set(r,t),Kd.set(t,r)),t}var ud=r=>Kd.get(r);function cC(r,t,{blocked:e,upgrade:i,blocking:s,terminated:o}={}){let n=indexedDB.open(r,t),a=li(n);return i&&n.addEventListener("upgradeneeded",l=>{i(li(n.result),l.oldVersion,l.newVersion,li(n.transaction),l)}),e&&n.addEventListener("blocked",l=>e(l.oldVersion,l.newVersion,l)),a.then(l=>{o&&l.addEventListener("close",()=>o()),s&&l.addEventListener("versionchange",h=>s(h.oldVersion,h.newVersion,h))}).catch(()=>{}),a}var uC=["get","getKey","getAll","getAllKeys","count"],dC=["put","add","delete","clear"],dd=new Map;function i0(r,t){if(!(r instanceof IDBDatabase&&!(t in r)&&typeof t=="string"))return;if(dd.get(t))return dd.get(t);let e=t.replace(/FromIndex$/,""),i=t!==e,s=dC.includes(e);if(!(e in(i?IDBIndex:IDBObjectStore).prototype)||!(s||uC.includes(e)))return;let o=async function(n,...a){let l=this.transaction(n,s?"readwrite":"readonly"),h=l.store;return i&&(h=h.index(a.shift())),(await Promise.all([h[e](...a),s&&l.done]))[0]};return dd.set(t,o),o}aC(r=>({...r,get:(t,e,i)=>i0(t,e)||r.get(t,e,i),has:(t,e)=>!!i0(t,e)||r.has(t,e)}));var Pd=class{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(pC(t)){let e=t.getImmediate();return`${e.library}/${e.version}`}else return null}).filter(t=>t).join(" ")}};function pC(r){let t=r.getComponent();return t?.type==="VERSION"}var Id="@firebase/app",s0="0.9.25";var Zi=new $n("@firebase/app"),fC="@firebase/app-compat",mC="@firebase/analytics-compat",gC="@firebase/analytics",xC="@firebase/app-check-compat",yC="@firebase/app-check",vC="@firebase/auth",_C="@firebase/auth-compat",bC="@firebase/database",TC="@firebase/database-compat",wC="@firebase/functions",CC="@firebase/functions-compat",SC="@firebase/installations",EC="@firebase/installations-compat",AC="@firebase/messaging",PC="@firebase/messaging-compat",IC="@firebase/performance",MC="@firebase/performance-compat",RC="@firebase/remote-config",FC="@firebase/remote-config-compat",DC="@firebase/storage",BC="@firebase/storage-compat",LC="@firebase/firestore",OC="@firebase/firestore-compat",kC="firebase",NC="10.7.1";var Md="[DEFAULT]",UC={[Id]:"fire-core",[fC]:"fire-core-compat",[gC]:"fire-analytics",[mC]:"fire-analytics-compat",[yC]:"fire-app-check",[xC]:"fire-app-check-compat",[vC]:"fire-auth",[_C]:"fire-auth-compat",[bC]:"fire-rtdb",[TC]:"fire-rtdb-compat",[wC]:"fire-fn",[CC]:"fire-fn-compat",[SC]:"fire-iid",[EC]:"fire-iid-compat",[AC]:"fire-fcm",[PC]:"fire-fcm-compat",[IC]:"fire-perf",[MC]:"fire-perf-compat",[RC]:"fire-rc",[FC]:"fire-rc-compat",[DC]:"fire-gcs",[BC]:"fire-gcs-compat",[LC]:"fire-fst",[OC]:"fire-fst-compat","fire-js":"fire-js",[kC]:"fire-js-all"};var ah=new Map,Rd=new Map;function GC(r,t){try{r.container.addComponent(t)}catch(e){Zi.debug(`Component ${t.name} failed to register with FirebaseApp ${r.name}`,e)}}function ui(r){let t=r.name;if(Rd.has(t))return Zi.debug(`There were multiple attempts to register component ${t}.`),!1;Rd.set(t,r);for(let e of ah.values())GC(e,r);return!0}function Kn(r,t){let e=r.container.getProvider("heartbeat").getImmediate({optional:!0});return e&&e.triggerHeartbeat(),r.container.getProvider(t)}var zC={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},hi=new qi("app","Firebase",zC);var Fd=class{constructor(t,e,i){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new rr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw hi.create("app-deleted",{appName:this._name})}};var HC=NC;function M0(r,t={}){let e=r;typeof t!="object"&&(t={name:t});let i=Object.assign({name:Md,automaticDataCollectionEnabled:!1},t),s=i.name;if(typeof s!="string"||!s)throw hi.create("bad-app-name",{appName:String(s)});if(e||(e=E0()),!e)throw hi.create("no-options");let o=ah.get(s);if(o){if(nh(e,o.options)&&nh(i,o.config))return o;throw hi.create("duplicate-app",{appName:s})}let n=new Sd(s);for(let l of Rd.values())n.addComponent(l);let a=new Fd(e,i,n);return ah.set(s,a),a}function R0(r=Md){let t=ah.get(r);if(!t&&r===Md&&E0())return M0();if(!t)throw hi.create("no-app",{appName:r});return t}function _r(r,t,e){var i;let s=(i=UC[r])!==null&&i!==void 0?i:r;e&&(s+=`-${e}`);let o=s.match(/\s|\//),n=t.match(/\s|\//);if(o||n){let a=[`Unable to register library "${s}" with version "${t}":`];o&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),o&&n&&a.push("and"),n&&a.push(`version name "${t}" contains illegal characters (whitespace or "/")`),Zi.warn(a.join(" "));return}ui(new rr(`${s}-version`,()=>({library:s,version:t}),"VERSION"))}var VC="firebase-heartbeat-database",jC=1,Yn="firebase-heartbeat-store",pd=null;function F0(){return pd||(pd=cC(VC,jC,{upgrade:(r,t)=>{switch(t){case 0:r.createObjectStore(Yn)}}}).catch(r=>{throw hi.create("idb-open",{originalErrorMessage:r.message})})),pd}async function WC(r){try{return await(await F0()).transaction(Yn).objectStore(Yn).get(D0(r))}catch(t){if(t instanceof Ur)Zi.warn(t.message);else{let e=hi.create("idb-get",{originalErrorMessage:t?.message});Zi.warn(e.message)}}}async function o0(r,t){try{let e=(await F0()).transaction(Yn,"readwrite");await e.objectStore(Yn).put(t,D0(r)),await e.done}catch(e){if(e instanceof Ur)Zi.warn(e.message);else{let i=hi.create("idb-set",{originalErrorMessage:e?.message});Zi.warn(i.message)}}}function D0(r){return`${r.name}!${r.options.appId}`}var XC=1024,$C=30*24*60*60*1e3,Dd=class{constructor(t){this.container=t,this._heartbeatsCache=null;let e=this.container.getProvider("app").getImmediate();this._storage=new Bd(e),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}async triggerHeartbeat(){var t,e;let i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=n0();if(!(((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null))&&!(this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(o=>o.date===s)))return this._heartbeatsCache.heartbeats.push({date:s,agent:i}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{let n=new Date(o.date).valueOf();return Date.now()-n<=$C}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){var t;if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";let e=n0(),{heartbeatsToSend:i,unsentEntries:s}=YC(this._heartbeatsCache.heartbeats),o=S0(JSON.stringify({version:2,heartbeats:i}));return this._heartbeatsCache.lastSentHeartbeatDate=e,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),o}};function n0(){return new Date().toISOString().substring(0,10)}function YC(r,t=XC){let e=[],i=r.slice();for(let s of r){let o=e.find(n=>n.agent===s.agent);if(o){if(o.dates.push(s.date),a0(e)>t){o.dates.pop();break}}else if(e.push({agent:s.agent,dates:[s.date]}),a0(e)>t){e.pop();break}i=i.slice(1)}return{heartbeatsToSend:e,unsentEntries:i}}var Bd=class{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Yd()?A0().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){let t=await WC(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){let i=await this.read();return o0(this.app,{lastSentHeartbeatDate:(e=t.lastSentHeartbeatDate)!==null&&e!==void 0?e:i.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){var e;if(await this._canUseIndexedDBPromise){let i=await this.read();return o0(this.app,{lastSentHeartbeatDate:(e=t.lastSentHeartbeatDate)!==null&&e!==void 0?e:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...t.heartbeats]})}else return}};function a0(r){return S0(JSON.stringify({version:2,heartbeats:r})).length}function KC(r){ui(new rr("platform-logger",t=>new Pd(t),"PRIVATE")),ui(new rr("heartbeat",t=>new Dd(t),"PRIVATE")),_r(Id,s0,r),_r(Id,s0,"esm2017"),_r("fire-js","")}KC("");var qC="firebase",ZC="10.7.1";_r(qC,ZC,"app");var QC=(r,t)=>t.some(e=>r instanceof e),l0,h0;function JC(){return l0||(l0=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function tS(){return h0||(h0=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var B0=new WeakMap,Ld=new WeakMap,L0=new WeakMap,fd=new WeakMap,qd=new WeakMap;function eS(r){let t=new Promise((e,i)=>{let s=()=>{r.removeEventListener("success",o),r.removeEventListener("error",n)},o=()=>{e(ci(r.result)),s()},n=()=>{i(r.error),s()};r.addEventListener("success",o),r.addEventListener("error",n)});return t.then(e=>{e instanceof IDBCursor&&B0.set(e,r)}).catch(()=>{}),qd.set(t,r),t}function rS(r){if(Ld.has(r))return;let t=new Promise((e,i)=>{let s=()=>{r.removeEventListener("complete",o),r.removeEventListener("error",n),r.removeEventListener("abort",n)},o=()=>{e(),s()},n=()=>{i(r.error||new DOMException("AbortError","AbortError")),s()};r.addEventListener("complete",o),r.addEventListener("error",n),r.addEventListener("abort",n)});Ld.set(r,t)}var Od={get(r,t,e){if(r instanceof IDBTransaction){if(t==="done")return Ld.get(r);if(t==="objectStoreNames")return r.objectStoreNames||L0.get(r);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return ci(r[t])},set(r,t,e){return r[t]=e,!0},has(r,t){return r instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in r}};function iS(r){Od=r(Od)}function sS(r){return r===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...e){let i=r.call(md(this),t,...e);return L0.set(i,t.sort?t.sort():[t]),ci(i)}:tS().includes(r)?function(...t){return r.apply(md(this),t),ci(B0.get(this))}:function(...t){return ci(r.apply(md(this),t))}}function oS(r){return typeof r=="function"?sS(r):(r instanceof IDBTransaction&&rS(r),QC(r,JC())?new Proxy(r,Od):r)}function ci(r){if(r instanceof IDBRequest)return eS(r);if(fd.has(r))return fd.get(r);let t=oS(r);return t!==r&&(fd.set(r,t),qd.set(t,r)),t}var md=r=>qd.get(r);function nS(r,t,{blocked:e,upgrade:i,blocking:s,terminated:o}={}){let n=indexedDB.open(r,t),a=ci(n);return i&&n.addEventListener("upgradeneeded",l=>{i(ci(n.result),l.oldVersion,l.newVersion,ci(n.transaction))}),e&&n.addEventListener("blocked",()=>e()),a.then(l=>{o&&l.addEventListener("close",()=>o()),s&&l.addEventListener("versionchange",()=>s())}).catch(()=>{}),a}var aS=["get","getKey","getAll","getAllKeys","count"],lS=["put","add","delete","clear"],gd=new Map;function c0(r,t){if(!(r instanceof IDBDatabase&&!(t in r)&&typeof t=="string"))return;if(gd.get(t))return gd.get(t);let e=t.replace(/FromIndex$/,""),i=t!==e,s=lS.includes(e);if(!(e in(i?IDBIndex:IDBObjectStore).prototype)||!(s||aS.includes(e)))return;let o=async function(n,...a){let l=this.transaction(n,s?"readwrite":"readonly"),h=l.store;return i&&(h=h.index(a.shift())),(await Promise.all([h[e](...a),s&&l.done]))[0]};return gd.set(t,o),o}iS(r=>({...r,get:(t,e,i)=>c0(t,e)||r.get(t,e,i),has:(t,e)=>!!c0(t,e)||r.has(t,e)}));var O0="@firebase/installations",Zd="0.6.4";var k0=1e4,N0=`w:${Zd}`,U0="FIS_v2",hS="https://firebaseinstallations.googleapis.com/v1",cS=60*60*1e3,uS="installations",dS="Installations";var pS={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},Qi=new qi(uS,dS,pS);function G0(r){return r instanceof Ur&&r.code.includes("request-failed")}function z0({projectId:r}){return`${hS}/projects/${r}/installations`}function H0(r){return{token:r.token,requestStatus:2,expiresIn:mS(r.expiresIn),creationTime:Date.now()}}async function V0(r,t){let e=(await t.json()).error;return Qi.create("request-failed",{requestName:r,serverCode:e.code,serverMessage:e.message,serverStatus:e.status})}function j0({apiKey:r}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":r})}function fS(r,{refreshToken:t}){let e=j0(r);return e.append("Authorization",gS(t)),e}async function W0(r){let t=await r();return t.status>=500&&t.status<600?r():t}function mS(r){return Number(r.replace("s","000"))}function gS(r){return`${U0} ${r}`}async function xS({appConfig:r,heartbeatServiceProvider:t},{fid:e}){let i=z0(r),s=j0(r),o=t.getImmediate({optional:!0});if(o){let h=await o.getHeartbeatsHeader();h&&s.append("x-firebase-client",h)}let n={fid:e,authVersion:U0,appId:r.appId,sdkVersion:N0},a={method:"POST",headers:s,body:JSON.stringify(n)},l=await W0(()=>fetch(i,a));if(l.ok){let h=await l.json();return{fid:h.fid||e,registrationStatus:2,refreshToken:h.refreshToken,authToken:H0(h.authToken)}}else throw await V0("Create Installation",l)}function X0(r){return new Promise(t=>{setTimeout(t,r)})}function yS(r){return btoa(String.fromCharCode(...r)).replace(/\+/g,"-").replace(/\//g,"_")}var vS=/^[cdef][\w-]{21}$/,kd="";function _S(){try{let r=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(r),r[0]=112+r[0]%16;let t=bS(r);return vS.test(t)?t:kd}catch{return kd}}function bS(r){return yS(r).substr(0,22)}function dh(r){return`${r.appName}!${r.appId}`}var $0=new Map;function Y0(r,t){let e=dh(r);K0(e,t),TS(e,t)}function K0(r,t){let e=$0.get(r);if(e)for(let i of e)i(t)}function TS(r,t){let e=wS();e&&e.postMessage({key:r,fid:t}),CS()}var Ki=null;function wS(){return!Ki&&"BroadcastChannel"in self&&(Ki=new BroadcastChannel("[Firebase] FID Change"),Ki.onmessage=r=>{K0(r.data.key,r.data.fid)}),Ki}function CS(){$0.size===0&&Ki&&(Ki.close(),Ki=null)}var SS="firebase-installations-database",ES=1,Ji="firebase-installations-store",xd=null;function Qd(){return xd||(xd=nS(SS,ES,{upgrade:(r,t)=>{switch(t){case 0:r.createObjectStore(Ji)}}})),xd}async function lh(r,t){let e=dh(r),i=(await Qd()).transaction(Ji,"readwrite"),s=i.objectStore(Ji),o=await s.get(e);return await s.put(t,e),await i.done,(!o||o.fid!==t.fid)&&Y0(r,t.fid),t}async function q0(r){let t=dh(r),e=(await Qd()).transaction(Ji,"readwrite");await e.objectStore(Ji).delete(t),await e.done}async function ph(r,t){let e=dh(r),i=(await Qd()).transaction(Ji,"readwrite"),s=i.objectStore(Ji),o=await s.get(e),n=t(o);return n===void 0?await s.delete(e):await s.put(n,e),await i.done,n&&(!o||o.fid!==n.fid)&&Y0(r,n.fid),n}async function Jd(r){let t,e=await ph(r.appConfig,i=>{let s=AS(i),o=PS(r,s);return t=o.registrationPromise,o.installationEntry});return e.fid===kd?{installationEntry:await t}:{installationEntry:e,registrationPromise:t}}function AS(r){let t=r||{fid:_S(),registrationStatus:0};return Z0(t)}function PS(r,t){if(t.registrationStatus===0){if(!navigator.onLine){let s=Promise.reject(Qi.create("app-offline"));return{installationEntry:t,registrationPromise:s}}let e={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},i=IS(r,e);return{installationEntry:e,registrationPromise:i}}else return t.registrationStatus===1?{installationEntry:t,registrationPromise:MS(r)}:{installationEntry:t}}async function IS(r,t){try{let e=await xS(r,t);return lh(r.appConfig,e)}catch(e){throw G0(e)&&e.customData.serverCode===409?await q0(r.appConfig):await lh(r.appConfig,{fid:t.fid,registrationStatus:0}),e}}async function MS(r){let t=await u0(r.appConfig);for(;t.registrationStatus===1;)await X0(100),t=await u0(r.appConfig);if(t.registrationStatus===0){let{installationEntry:e,registrationPromise:i}=await Jd(r);return i||e}return t}function u0(r){return ph(r,t=>{if(!t)throw Qi.create("installation-not-found");return Z0(t)})}function Z0(r){return RS(r)?{fid:r.fid,registrationStatus:0}:r}function RS(r){return r.registrationStatus===1&&r.registrationTime+k0<Date.now()}async function FS({appConfig:r,heartbeatServiceProvider:t},e){let i=DS(r,e),s=fS(r,e),o=t.getImmediate({optional:!0});if(o){let h=await o.getHeartbeatsHeader();h&&s.append("x-firebase-client",h)}let n={installation:{sdkVersion:N0,appId:r.appId}},a={method:"POST",headers:s,body:JSON.stringify(n)},l=await W0(()=>fetch(i,a));if(l.ok){let h=await l.json();return H0(h)}else throw await V0("Generate Auth Token",l)}function DS(r,{fid:t}){return`${z0(r)}/${t}/authTokens:generate`}async function tp(r,t=!1){let e,i=await ph(r.appConfig,s=>{if(!Q0(s))throw Qi.create("not-registered");let o=s.authToken;if(!t&&OS(o))return s;if(o.requestStatus===1)return e=BS(r,t),s;{if(!navigator.onLine)throw Qi.create("app-offline");let n=NS(s);return e=LS(r,n),n}});return e?await e:i.authToken}async function BS(r,t){let e=await d0(r.appConfig);for(;e.authToken.requestStatus===1;)await X0(100),e=await d0(r.appConfig);let i=e.authToken;return i.requestStatus===0?tp(r,t):i}function d0(r){return ph(r,t=>{if(!Q0(t))throw Qi.create("not-registered");let e=t.authToken;return US(e)?Object.assign(Object.assign({},t),{authToken:{requestStatus:0}}):t})}async function LS(r,t){try{let e=await FS(r,t),i=Object.assign(Object.assign({},t),{authToken:e});return await lh(r.appConfig,i),e}catch(e){if(G0(e)&&(e.customData.serverCode===401||e.customData.serverCode===404))await q0(r.appConfig);else{let i=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}});await lh(r.appConfig,i)}throw e}}function Q0(r){return r!==void 0&&r.registrationStatus===2}function OS(r){return r.requestStatus===2&&!kS(r)}function kS(r){let t=Date.now();return t<r.creationTime||r.creationTime+r.expiresIn<t+cS}function NS(r){let t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},r),{authToken:t})}function US(r){return r.requestStatus===1&&r.requestTime+k0<Date.now()}async function GS(r){let t=r,{installationEntry:e,registrationPromise:i}=await Jd(t);return i?i.catch(console.error):tp(t).catch(console.error),e.fid}async function zS(r,t=!1){let e=r;return await HS(e),(await tp(e,t)).token}async function HS(r){let{registrationPromise:t}=await Jd(r);t&&await t}function VS(r){if(!r||!r.options)throw yd("App Configuration");if(!r.name)throw yd("App Name");let t=["projectId","apiKey","appId"];for(let e of t)if(!r.options[e])throw yd(e);return{appName:r.name,projectId:r.options.projectId,apiKey:r.options.apiKey,appId:r.options.appId}}function yd(r){return Qi.create("missing-app-config-values",{valueName:r})}var J0="installations",jS="installations-internal",WS=r=>{let t=r.getProvider("app").getImmediate(),e=VS(t),i=Kn(t,"heartbeat");return{app:t,appConfig:e,heartbeatServiceProvider:i,_delete:()=>Promise.resolve()}},XS=r=>{let t=r.getProvider("app").getImmediate(),e=Kn(t,J0).getImmediate();return{getId:()=>GS(e),getToken:i=>zS(e,i)}};function $S(){ui(new rr(J0,WS,"PUBLIC")),ui(new rr(jS,XS,"PRIVATE"))}$S();_r(O0,Zd);_r(O0,Zd,"esm2017");var vd="@firebase/remote-config",p0="0.4.4";var Nd=class{constructor(){this.listeners=[]}addEventListener(t){this.listeners.push(t)}abort(){this.listeners.forEach(t=>t())}};var ty="remote-config";var YS={"registration-window":"Undefined window object. This SDK only supports usage in a browser environment.","registration-project-id":"Undefined project identifier. Check Firebase app initialization.","registration-api-key":"Undefined API key. Check Firebase app initialization.","registration-app-id":"Undefined app identifier. Check Firebase app initialization.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","storage-delete":"Error thrown when deleting from storage. Original error: {$originalErrorMessage}.","fetch-client-network":"Fetch client failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-timeout":'The config fetch request timed out.  Configure timeout using "fetchTimeoutMillis" SDK setting.',"fetch-throttle":'The config fetch request timed out while in an exponential backoff state. Configure timeout using "fetchTimeoutMillis" SDK setting. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.',"fetch-client-parse":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","indexed-db-unavailable":"Indexed DB is not supported by current browser"},we=new qi("remoteconfig","Remote Config",YS);function KS(r,t){return r instanceof Ur&&r.code.indexOf(t)!==-1}var qS=!1,ZS="",f0=0,QS=["1","true","t","yes","y","on"],Wn=class{constructor(t,e=ZS){this._source=t,this._value=e}asString(){return this._value}asBoolean(){return this._source==="static"?qS:QS.indexOf(this._value.toLowerCase())>=0}asNumber(){if(this._source==="static")return f0;let t=Number(this._value);return isNaN(t)&&(t=f0),t}getSource(){return this._source}};function JS(r=R0()){return r=di(r),Kn(r,ty).getImmediate()}async function tE(r){let t=di(r),[e,i]=await Promise.all([t._storage.getLastSuccessfulFetchResponse(),t._storage.getActiveConfigEtag()]);return!e||!e.config||!e.eTag||e.eTag===i?!1:(await Promise.all([t._storageCache.setActiveConfig(e.config),t._storage.setActiveConfigEtag(e.eTag)]),!0)}function eE(r){let t=di(r);return t._initializePromise||(t._initializePromise=t._storageCache.loadFromStorage().then(()=>{t._isInitializationComplete=!0})),t._initializePromise}async function rE(r){let t=di(r),e=new Nd;setTimeout(async()=>{e.abort()},t.settings.fetchTimeoutMillis);try{await t._client.fetch({cacheMaxAgeMillis:t.settings.minimumFetchIntervalMillis,signal:e}),await t._storageCache.setLastFetchStatus("success")}catch(i){let s=KS(i,"fetch-throttle")?"throttle":"failure";throw await t._storageCache.setLastFetchStatus(s),i}}function m0(r,t){let e=di(r);e._isInitializationComplete||e._logger.debug(`A value was requested for key "${t}" before SDK initialization completed. Await on ensureInitialized if the intent was to get a previously activated value.`);let i=e._storageCache.getActiveConfig();return i&&i[t]!==void 0?new Wn("remote",i[t]):e.defaultConfig&&e.defaultConfig[t]!==void 0?new Wn("default",String(e.defaultConfig[t])):(e._logger.debug(`Returning static value for key "${t}". Define a default or remote value if this is unintentional.`),new Wn("static"))}var Ud=class{constructor(t,e,i,s){this.client=t,this.storage=e,this.storageCache=i,this.logger=s}isCachedDataFresh(t,e){if(!e)return this.logger.debug("Config fetch cache check. Cache unpopulated."),!1;let i=Date.now()-e,s=i<=t;return this.logger.debug(`Config fetch cache check. Cache age millis: ${i}. Cache max age millis (minimumFetchIntervalMillis setting): ${t}. Is cache hit: ${s}.`),s}async fetch(t){let[e,i]=await Promise.all([this.storage.getLastSuccessfulFetchTimestampMillis(),this.storage.getLastSuccessfulFetchResponse()]);if(i&&this.isCachedDataFresh(t.cacheMaxAgeMillis,e))return i;t.eTag=i&&i.eTag;let s=await this.client.fetch(t),o=[this.storageCache.setLastSuccessfulFetchTimestampMillis(Date.now())];return s.status===200&&o.push(this.storage.setLastSuccessfulFetchResponse(s)),await Promise.all(o),s}};function iE(r=navigator){return r.languages&&r.languages[0]||r.language}var Gd=class{constructor(t,e,i,s,o,n){this.firebaseInstallations=t,this.sdkVersion=e,this.namespace=i,this.projectId=s,this.apiKey=o,this.appId=n}async fetch(t){let[e,i]=await Promise.all([this.firebaseInstallations.getId(),this.firebaseInstallations.getToken()]),s=`${window.FIREBASE_REMOTE_CONFIG_URL_BASE||"https://firebaseremoteconfig.googleapis.com"}/v1/projects/${this.projectId}/namespaces/${this.namespace}:fetch?key=${this.apiKey}`,o={"Content-Type":"application/json","Content-Encoding":"gzip","If-None-Match":t.eTag||"*"},n={sdk_version:this.sdkVersion,app_instance_id:e,app_instance_id_token:i,app_id:this.appId,language_code:iE()},a={method:"POST",headers:o,body:JSON.stringify(n)},l=fetch(s,a),h=new Promise((m,g)=>{t.signal.addEventListener(()=>{let x=new Error("The operation was aborted.");x.name="AbortError",g(x)})}),c;try{await Promise.race([l,h]),c=await l}catch(m){let g="fetch-client-network";throw m?.name==="AbortError"&&(g="fetch-timeout"),we.create(g,{originalErrorMessage:m?.message})}let u=c.status,d=c.headers.get("ETag")||void 0,p,f;if(c.status===200){let m;try{m=await c.json()}catch(g){throw we.create("fetch-client-parse",{originalErrorMessage:g?.message})}p=m.entries,f=m.state}if(f==="INSTANCE_STATE_UNSPECIFIED"?u=500:f==="NO_CHANGE"?u=304:(f==="NO_TEMPLATE"||f==="EMPTY_CONFIG")&&(p={}),u!==304&&u!==200)throw we.create("fetch-status",{httpStatus:u});return{status:u,eTag:d,config:p}}};function sE(r,t){return new Promise((e,i)=>{let s=Math.max(t-Date.now(),0),o=setTimeout(e,s);r.addEventListener(()=>{clearTimeout(o),i(we.create("fetch-throttle",{throttleEndTimeMillis:t}))})})}function oE(r){if(!(r instanceof Ur)||!r.customData)return!1;let t=Number(r.customData.httpStatus);return t===429||t===500||t===503||t===504}var zd=class{constructor(t,e){this.client=t,this.storage=e}async fetch(t){let e=await this.storage.getThrottleMetadata()||{backoffCount:0,throttleEndTimeMillis:Date.now()};return this.attemptFetch(t,e)}async attemptFetch(t,{throttleEndTimeMillis:e,backoffCount:i}){await sE(t.signal,e);try{let s=await this.client.fetch(t);return await this.storage.deleteThrottleMetadata(),s}catch(s){if(!oE(s))throw s;let o={throttleEndTimeMillis:Date.now()+wd(i),backoffCount:i+1};return await this.storage.setThrottleMetadata(o),this.attemptFetch(t,o)}}};var nE=60*1e3,aE=12*60*60*1e3,Hd=class{constructor(t,e,i,s,o){this.app=t,this._client=e,this._storageCache=i,this._storage=s,this._logger=o,this._isInitializationComplete=!1,this.settings={fetchTimeoutMillis:nE,minimumFetchIntervalMillis:aE},this.defaultConfig={}}get fetchTimeMillis(){return this._storageCache.getLastSuccessfulFetchTimestampMillis()||-1}get lastFetchStatus(){return this._storageCache.getLastFetchStatus()||"no-fetch-yet"}};function sh(r,t){let e=r.target.error||void 0;return we.create(t,{originalErrorMessage:e&&e?.message})}var Yi="app_namespace_store",lE="firebase_remote_config",hE=1;function cE(){return new Promise((r,t)=>{try{let e=indexedDB.open(lE,hE);e.onerror=i=>{t(sh(i,"storage-open"))},e.onsuccess=i=>{r(i.target.result)},e.onupgradeneeded=i=>{let s=i.target.result;switch(i.oldVersion){case 0:s.createObjectStore(Yi,{keyPath:"compositeKey"})}}}catch(e){t(we.create("storage-open",{originalErrorMessage:e?.message}))}})}var Vd=class{constructor(t,e,i,s=cE()){this.appId=t,this.appName=e,this.namespace=i,this.openDbPromise=s}getLastFetchStatus(){return this.get("last_fetch_status")}setLastFetchStatus(t){return this.set("last_fetch_status",t)}getLastSuccessfulFetchTimestampMillis(){return this.get("last_successful_fetch_timestamp_millis")}setLastSuccessfulFetchTimestampMillis(t){return this.set("last_successful_fetch_timestamp_millis",t)}getLastSuccessfulFetchResponse(){return this.get("last_successful_fetch_response")}setLastSuccessfulFetchResponse(t){return this.set("last_successful_fetch_response",t)}getActiveConfig(){return this.get("active_config")}setActiveConfig(t){return this.set("active_config",t)}getActiveConfigEtag(){return this.get("active_config_etag")}setActiveConfigEtag(t){return this.set("active_config_etag",t)}getThrottleMetadata(){return this.get("throttle_metadata")}setThrottleMetadata(t){return this.set("throttle_metadata",t)}deleteThrottleMetadata(){return this.delete("throttle_metadata")}async get(t){let e=await this.openDbPromise;return new Promise((i,s)=>{let o=e.transaction([Yi],"readonly").objectStore(Yi),n=this.createCompositeKey(t);try{let a=o.get(n);a.onerror=l=>{s(sh(l,"storage-get"))},a.onsuccess=l=>{let h=l.target.result;i(h?h.value:void 0)}}catch(a){s(we.create("storage-get",{originalErrorMessage:a?.message}))}})}async set(t,e){let i=await this.openDbPromise;return new Promise((s,o)=>{let n=i.transaction([Yi],"readwrite").objectStore(Yi),a=this.createCompositeKey(t);try{let l=n.put({compositeKey:a,value:e});l.onerror=h=>{o(sh(h,"storage-set"))},l.onsuccess=()=>{s()}}catch(l){o(we.create("storage-set",{originalErrorMessage:l?.message}))}})}async delete(t){let e=await this.openDbPromise;return new Promise((i,s)=>{let o=e.transaction([Yi],"readwrite").objectStore(Yi),n=this.createCompositeKey(t);try{let a=o.delete(n);a.onerror=l=>{s(sh(l,"storage-delete"))},a.onsuccess=()=>{i()}}catch(a){s(we.create("storage-delete",{originalErrorMessage:a?.message}))}})}createCompositeKey(t){return[this.appId,this.appName,this.namespace,t].join()}};var jd=class{constructor(t){this.storage=t}getLastFetchStatus(){return this.lastFetchStatus}getLastSuccessfulFetchTimestampMillis(){return this.lastSuccessfulFetchTimestampMillis}getActiveConfig(){return this.activeConfig}async loadFromStorage(){let t=this.storage.getLastFetchStatus(),e=this.storage.getLastSuccessfulFetchTimestampMillis(),i=this.storage.getActiveConfig(),s=await t;s&&(this.lastFetchStatus=s);let o=await e;o&&(this.lastSuccessfulFetchTimestampMillis=o);let n=await i;n&&(this.activeConfig=n)}setLastFetchStatus(t){return this.lastFetchStatus=t,this.storage.setLastFetchStatus(t)}setLastSuccessfulFetchTimestampMillis(t){return this.lastSuccessfulFetchTimestampMillis=t,this.storage.setLastSuccessfulFetchTimestampMillis(t)}setActiveConfig(t){return this.activeConfig=t,this.storage.setActiveConfig(t)}};function uE(){ui(new rr(ty,r,"PUBLIC").setMultipleInstances(!0)),_r(vd,p0),_r(vd,p0,"esm2017");function r(t,{instanceIdentifier:e}){let i=t.getProvider("app").getImmediate(),s=t.getProvider("installations-internal").getImmediate();if(typeof window>"u")throw we.create("registration-window");if(!Yd())throw we.create("indexed-db-unavailable");let{projectId:o,apiKey:n,appId:a}=i.options;if(!o)throw we.create("registration-project-id");if(!n)throw we.create("registration-api-key");if(!a)throw we.create("registration-app-id");e=e||"firebase";let l=new Vd(a,i.name,e),h=new jd(l),c=new $n(vd);c.logLevel=xt.ERROR;let u=new Gd(s,HC,e,o,n,a),d=new zd(u,l),p=new Ud(d,l,h,c),f=new Hd(i,p,h,l,c);return eE(f),f}}async function dE(r){return r=di(r),await rE(r),tE(r)}uE();var hh="analytics",pE="firebase_id",fE="origin",mE=60*1e3,gE="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",ep="https://www.googletagmanager.com/gtag/js";var Ce=new $n("@firebase/analytics");var xE={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},Fe=new qi("analytics","Analytics",xE);function yE(r){if(!r.startsWith(ep)){let t=Fe.create("invalid-gtag-resource",{gtagURL:r});return Ce.warn(t.message),""}return r}function ey(r){return Promise.all(r.map(t=>t.catch(e=>e)))}function vE(r,t){let e;return window.trustedTypes&&(e=window.trustedTypes.createPolicy(r,t)),e}function _E(r,t){let e=vE("firebase-js-sdk-policy",{createScriptURL:yE}),i=document.createElement("script"),s=`${ep}?l=${r}&id=${t}`;i.src=e?e?.createScriptURL(s):s,i.async=!0,document.head.appendChild(i)}function bE(r){let t=[];return Array.isArray(window[r])?t=window[r]:window[r]=t,t}async function TE(r,t,e,i,s,o){let n=i[s];try{if(n)await t[n];else{let a=(await ey(e)).find(l=>l.measurementId===s);a&&await t[a.appId]}}catch(a){Ce.error(a)}r("config",s,o)}async function wE(r,t,e,i,s){try{let o=[];if(s&&s.send_to){let n=s.send_to;Array.isArray(n)||(n=[n]);let a=await ey(e);for(let l of n){let h=a.find(u=>u.measurementId===l),c=h&&t[h.appId];if(c)o.push(c);else{o=[];break}}}o.length===0&&(o=Object.values(t)),await Promise.all(o),r("event",i,s||{})}catch(o){Ce.error(o)}}function CE(r,t,e,i){async function s(o,...n){try{if(o==="event"){let[a,l]=n;await wE(r,t,e,a,l)}else if(o==="config"){let[a,l]=n;await TE(r,t,e,i,a,l)}else if(o==="consent"){let[a]=n;r("consent","update",a)}else if(o==="get"){let[a,l,h]=n;r("get",a,l,h)}else if(o==="set"){let[a]=n;r("set",a)}else r(o,...n)}catch(a){Ce.error(a)}}return s}function SE(r,t,e,i,s){let o=function(...n){window[i].push(arguments)};return window[s]&&typeof window[s]=="function"&&(o=window[s]),window[s]=CE(o,r,t,e),{gtagCore:o,wrappedGtag:window[s]}}function EE(r){let t=window.document.getElementsByTagName("script");for(let e of Object.values(t))if(e.src&&e.src.includes(ep)&&e.src.includes(r))return e;return null}var AE=30,PE=1e3,Wd=class{constructor(t={},e=PE){this.throttleMetadata=t,this.intervalMillis=e}getThrottleMetadata(t){return this.throttleMetadata[t]}setThrottleMetadata(t,e){this.throttleMetadata[t]=e}deleteThrottleMetadata(t){delete this.throttleMetadata[t]}},ry=new Wd;function IE(r){return new Headers({Accept:"application/json","x-goog-api-key":r})}async function ME(r){var t;let{appId:e,apiKey:i}=r,s={method:"GET",headers:IE(i)},o=gE.replace("{app-id}",e),n=await fetch(o,s);if(n.status!==200&&n.status!==304){let a="";try{let l=await n.json();!((t=l.error)===null||t===void 0)&&t.message&&(a=l.error.message)}catch{}throw Fe.create("config-fetch-failed",{httpStatus:n.status,responseMessage:a})}return n.json()}async function RE(r,t=ry,e){let{appId:i,apiKey:s,measurementId:o}=r.options;if(!i)throw Fe.create("no-app-id");if(!s){if(o)return{measurementId:o,appId:i};throw Fe.create("no-api-key")}let n=t.getThrottleMetadata(i)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new Xd;return setTimeout(async()=>{a.abort()},e!==void 0?e:mE),iy({appId:i,apiKey:s,measurementId:o},n,a,t)}async function iy(r,{throttleEndTimeMillis:t,backoffCount:e},i,s=ry){var o;let{appId:n,measurementId:a}=r;try{await FE(i,t)}catch(l){if(a)return Ce.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${l?.message}]`),{appId:n,measurementId:a};throw l}try{let l=await ME(r);return s.deleteThrottleMetadata(n),l}catch(l){let h=l;if(!DE(h)){if(s.deleteThrottleMetadata(n),a)return Ce.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${h?.message}]`),{appId:n,measurementId:a};throw l}let c=Number((o=h?.customData)===null||o===void 0?void 0:o.httpStatus)===503?wd(e,s.intervalMillis,AE):wd(e,s.intervalMillis),u={throttleEndTimeMillis:Date.now()+c,backoffCount:e+1};return s.setThrottleMetadata(n,u),Ce.debug(`Calling attemptFetch again in ${c} millis`),iy(r,u,i,s)}}function FE(r,t){return new Promise((e,i)=>{let s=Math.max(t-Date.now(),0),o=setTimeout(e,s);r.addEventListener(()=>{clearTimeout(o),i(Fe.create("fetch-throttle",{throttleEndTimeMillis:t}))})})}function DE(r){if(!(r instanceof Ur)||!r.customData)return!1;let t=Number(r.customData.httpStatus);return t===429||t===500||t===503||t===504}var Xd=class{constructor(){this.listeners=[]}addEventListener(t){this.listeners.push(t)}abort(){this.listeners.forEach(t=>t())}};async function BE(r,t,e,i,s){if(s&&s.global){r("event",e,i);return}else{let o=await t,n=Object.assign(Object.assign({},i),{send_to:o});r("event",e,n)}}async function LE(){if(Yd())try{await A0()}catch(r){return Ce.warn(Fe.create("indexeddb-unavailable",{errorInfo:r?.toString()}).message),!1}else return Ce.warn(Fe.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function OE(r,t,e,i,s,o,n){var a;let l=RE(r);l.then(p=>{e[p.measurementId]=p.appId,r.options.measurementId&&p.measurementId!==r.options.measurementId&&Ce.warn(`The measurement ID in the local Firebase config (${r.options.measurementId}) does not match the measurement ID fetched from the server (${p.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(p=>Ce.error(p)),t.push(l);let h=LE().then(p=>{if(p)return i.getId()}),[c,u]=await Promise.all([l,h]);EE(o)||_E(o,c.measurementId),s("js",new Date);let d=(a=n?.config)!==null&&a!==void 0?a:{};return d[fE]="firebase",d.update=!0,u!=null&&(d[pE]=u),s("config",c.measurementId,d),c.measurementId}var $d=class{constructor(t){this.app=t}_delete(){return delete Xn[this.app.options.appId],Promise.resolve()}},Xn={},g0=[],x0={},_d="dataLayer",kE="gtag",y0,sy,v0=!1;function NE(){let r=[];if(zw()&&r.push("This is a browser extension environment."),Hw()||r.push("Cookies are not available."),r.length>0){let t=r.map((i,s)=>`(${s+1}) ${i}`).join(" "),e=Fe.create("invalid-analytics-context",{errorInfo:t});Ce.warn(e.message)}}function UE(r,t,e){NE();let i=r.options.appId;if(!i)throw Fe.create("no-app-id");if(!r.options.apiKey)if(r.options.measurementId)Ce.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${r.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw Fe.create("no-api-key");if(Xn[i]!=null)throw Fe.create("already-exists",{id:i});if(!v0){bE(_d);let{wrappedGtag:s,gtagCore:o}=SE(Xn,g0,x0,_d,kE);sy=s,y0=o,v0=!0}return Xn[i]=OE(r,g0,x0,t,y0,_d,e),new $d(r)}function GE(r=R0()){r=di(r);let t=Kn(r,hh);return t.isInitialized()?t.getImmediate():zE(r)}function zE(r,t={}){let e=Kn(r,hh);if(e.isInitialized()){let i=e.getImmediate();if(nh(t,e.getOptions()))return i;throw Fe.create("already-initialized")}return e.initialize({options:t})}function jn(r,t,e,i){r=di(r),BE(sy,Xn[r.app.options.appId],t,e,i).catch(s=>Ce.error(s))}var _0="@firebase/analytics",b0="0.10.0";function HE(){ui(new rr(hh,(t,{options:e})=>{let i=t.getProvider("app").getImmediate(),s=t.getProvider("installations-internal").getImmediate();return UE(i,s,e)},"PUBLIC")),ui(new rr("analytics-internal",r,"PRIVATE")),_r(_0,b0),_r(_0,b0,"esm2017");function r(t){try{let e=t.getProvider(hh).getImmediate();return{logEvent:(i,s,o)=>jn(e,i,s,o)}}catch(e){throw Fe.create("interop-component-reg-failed",{reason:e})}}}HE();var VE='[{"id":"bs2d-6","show":"BubbleShooter2d","when":"onLevelEnd","levels":[10,30]},{"id":"bs2d-dog-1","from":"BubbleShooter2d","show":"DogEscape","when":"onLevelEnd","levels":[5,20,50]}]',jE=`[
  {
    "id": "BubbleShooter2d",
    "title": "Glossy Bubble Challenge",
    "url": "https://yandex.ru/games/app/268294",
    "icon": "bubble-icon.png",
    "cover": "buble-cover.jpg"
  },
  {
    "id": "DogEscape",
    "title": "Dog Escape",
    "url": "https://yandex.com/games/app/255645",
    "icon": "dogescape-icon.png",
    "cover": "dogescape-cover.jpg"
  },
  {
    "id": "WeaponWars",
    "title": "Weapon Wars",
    "url": "https://yandex.com/games/app/268058",
    "icon": "weaponwars-icon.png",
    "cover": "weaponwars-cover.jpg"
  }
]`,WE={single:VE,all:jE},ch=class{constructor(){Pt(this,"container"),Pt(this,"content")}};function XE(r,t,e,i,s){let o=document.createElement("div");o.setAttribute("class","item");let n=document.createElement("img");n.setAttribute("src",e+"img/cover/"+r.cover);let a=document.createElement("button");a.setAttribute("class","play-btn"),a.innerHTML=s.localize("play"),a.onclick=()=>{window.open(s.resolveDomain(r.url),"_blank"),i(r.id)},o.appendChild(n),o.appendChild(a),t.appendChild(o)}var oh=class co{constructor(){Pt(this,"lang"),Pt(this,"domain")}setContext(t){console.log(t),this.lang=t.i18n.lang,this.domain=t.i18n.tld,console.log("GameFuse Lang:"+this.lang),console.log("GameFuse Domain:"+this.domain)}localize(t){let e=co.Words[t+"-"+this.lang];return console.log(t+this.lang+" :"+e),e==null&&(e=co.Words[t+"-"+co.defaultLang],console.log(t+co.defaultLang+" :"+e)),e}resolveDomain(t){let e=this.domain!=null?this.domain:co.defaultDomain;return t.replace("yandex.com","yandex."+e)}};Pt(oh,"Words",{"play-en":"Play","play-ru":"\u0418\u0433\u0440\u0430\u0442\u044C","more-en":"More Games","more-ru":"\u0411\u043E\u043B\u044C\u0448\u0435 \u0438\u0433\u0440"}),Pt(oh,"defaultLang","en"),Pt(oh,"defaultDomain","com");var $E=oh,T0={apiKey:"AIzaSyDDLHPj-rb7QtuQVNNH43zZomBRh9945eI",authDomain:"game-fuse-e54ee.firebaseapp.com",projectId:"game-fuse-e54ee",storageBucket:"game-fuse-e54ee.appspot.com",messagingSenderId:"944870108663",appId:"1:944870108663:web:40e3cf0562dc7811dcd2f2",measurementId:"G-6C21JSMX0K"},YE="modal-all",KE="modal-single",uh=class{constructor(){Pt(this,"analytics"),Pt(this,"remoteConfig"),Pt(this,"popupAll",new ch),Pt(this,"popupSingle",new ch),Pt(this,"host"),Pt(this,"currentGame"),Pt(this,"allEntries"),Pt(this,"singleEntries"),Pt(this,"currentSingle"),Pt(this,"showCallback"),Pt(this,"isSetup",!1),Pt(this,"retryTime",5e3),Pt(this,"retryCount",0),Pt(this,"localization",new $E),Pt(this,"container")}setup(t){if(this.isSetup)return;this.isSetup=!0,this.currentGame=t;let e=M0(T0),i=GE(e);this.analytics=i;let s=JS(e);this.remoteConfig=s,s.settings.minimumFetchIntervalMillis=36e5,s.defaultConfig=WE,this.setConfigValues(),this.fetchConfig();let o="https://"+T0.projectId+".web.app/";this.host=o;let n=o+"gamefuse.css";this.injectCSS(n);let a=document.createElement("div");this.container=a,a.hidden=!0,a.setAttribute("id","gf-ui"),this.popupAll.container=a.appendChild(this.createModal(this.popupAll,YE)),this.popupSingle.container=a.appendChild(this.createModal(this.popupSingle,KE,!0)),document.body.append(a)}setConfigValues(){this.allEntries=JSON.parse(m0(this.remoteConfig,"all").asString()),this.singleEntries=JSON.parse(m0(this.remoteConfig,"single").asString())}fetchConfig(){try{dE(this.remoteConfig).then(()=>{this.setConfigValues()}).catch(()=>{this.fetchRetry()})}catch{this.fetchRetry()}}fetchRetry(){this.retryCount++,setTimeout(this.fetchConfig.bind(this),this.retryCount*this.retryTime)}onListItemClick(t){jn(this.analytics,"open_link",{from:this.currentGame,to:t,via:"MoreGames"})}onSingleItemClick(){this.currentSingle&&jn(this.analytics,"open_link",{from:this.currentGame,to:this.currentSingle.show,via:"Popup"})}onAllCloseClick(){this.popupAll.container.classList.remove("active"),jn(this.analytics,"close_more_games",{from:this.currentGame})}onSingleCloseClick(){this.currentSingle=void 0,this.popupSingle.container.classList.remove("active"),jn(this.analytics,"close_single",{from:this.currentGame}),this.showCallback()}showAll(){if(!this.isSetup)return;this.container.hidden=!1;let t=this.allEntries,e=this.popupAll.content;for(;e.firstChild;)e.removeChild(e.firstChild);let i=document.createElement("div");i.setAttribute("class","close-btn"),i.onclick=()=>{this.onAllCloseClick()};let s=document.createElement("h2");s.innerText=this.localization.localize("more"),e.appendChild(i),e.appendChild(s);let o=document.createElement("div");o.setAttribute("class","list"),t.forEach(n=>{n.id.trim()!=this.currentGame.trim()&&XE(n,o,this.host,this.onListItemClick.bind(this),this.localization)}),e.appendChild(o),this.popupAll.container.classList.add("active")}showPopup(t,e,i){if(!this.isSetup){i();return}this.container.hidden=!1,this.showCallback=i;let s=this.singleEntries.filter(f=>f.when==t.trim()),o=-1;for(let f=0;f<s.length;f++){let m=s[f];if(!(m.show.trim()==this.currentGame.trim()||!(m.from==null||m.from.trim()==this.currentGame.trim()))){if(m.levels!=null)for(let g=0;g<m.levels.length;g++){if(e<m.levels[g])continue;let x=m.id+m.levels[g].toString();if(localStorage.getItem(x)==null){o=f,localStorage.setItem(x,"true");break}}else if(localStorage.getItem(m.id)==null){localStorage.setItem(m.id,"true"),o=f;break}if(o>=0)break}}if(o<0){this.showCallback();return}let n=s[o];this.currentSingle=n;let a=this.popupSingle.content;for(;a.firstChild;)a.removeChild(a.firstChild);let l=document.createElement("div");l.setAttribute("class","close-btn"),l.onclick=()=>{this.onSingleCloseClick()};let h=document.createElement("img");h.setAttribute("class","cover"),a.appendChild(l),a.appendChild(h);let c=document.createElement("div");c.setAttribute("class","cover-info");let u=document.createElement("img");u.setAttribute("class","icon");let d=document.createElement("h3"),p=this.allEntries.find(f=>f.id.trim()==n.show.trim());if(a.appendChild(c),c.appendChild(u),c.appendChild(d),p){h.setAttribute("src",this.host+"img/cover/"+p.cover),u.setAttribute("src",this.host+"img/icon/"+p.icon),d.innerText=p.title;let f=document.createElement("button");f.setAttribute("class","play-btn"),f.innerHTML=this.localization.localize("play"),f.onclick=()=>{window.open(this.localization.resolveDomain(p.url),"_blank"),this.onSingleItemClick()},c.appendChild(f)}this.popupSingle.container.classList.add("active")}setLocalization(t){this.localization.setContext(t)}injectCSS(t){let e=document.createElement("link");e.rel="stylesheet",e.type="text/css",e.href=t,document.head.appendChild(e)}createModal(t,e,i=!1){let s=document.createElement("section");s.setAttribute("id",e),s.setAttribute("class","modal"+(i?" single":""));let o=document.createElement("div");return o.setAttribute("class","popup"),t.content=s.appendChild(o),s}};var rp=class{level=0;gameLevelKey="cars-n-guns-level-key";gf;setup(t){console.log("promo setup");let e=localStorage.getItem(this.gameLevelKey);e?this.level=Number.parseInt(e):this.processLevel(),this.gf=new uh,this.gf.setup(t)}processLevel(){this.level++,localStorage.setItem(this.gameLevelKey,this.level.toString())}showMoreGames(){this.gf.showAll()}showPopup(t,e){t=="onLevelStart"&&this.processLevel(),this.gf.showPopup(t,this.level,e)}},qE=new rp,pi=qE;var fh=class extends D{titleContainer;titleBg;titleText;repCounter;moneyCounter;continueButton;constructor(t,e,i){super(),this.titleContainer=new D,this.titleBg=new I(v.from("panel-end")),this.titleBg.anchor.set(.5,0),this.titleText=new rt(N.getText(t?"Victory":"Defeat").toUpperCase(),{fontFamily:N.font,fontSize:144,fill:16777215,align:"center",strokeThickness:4,stroke:4134513}),this.titleText.anchor.set(.5),this.titleText.y=this.titleBg.height/2,this.repCounter=new ih,this.repCounter.updateValue(i.data.reputation),this.moneyCounter=new Kt("Money"),this.moneyCounter.scale.set(1.5),this.moneyCounter.updateValue(i.data.money),this.continueButton=new Tt(N.getText("Continue").toUpperCase(),v.from("btn-green"),{fontFamily:N.font,fontSize:72,fill:84798,align:"center"}),this.continueButton.on("pointerdown",()=>{e.adsManager.showInterstitial(),ct.emit("START_MENU"),pi.showPopup("onLevelEnd",()=>{})}),this.titleContainer.addChild(this.titleBg),this.titleContainer.addChild(this.titleText),this.addChild(this.repCounter),this.addChild(this.moneyCounter),this.addChild(this.titleContainer),this.addChild(this.continueButton),this.positionElements()}positionElements(){this.titleContainer.position.set(U.width/2,0),this.repCounter.position.set(U.width/2,U.height/2),this.moneyCounter.position.set(U.width/2,U.height-550),this.continueButton.position.set(U.width/2,U.height-250)}};var uo=class extends I{constructor(){super(v.WHITE),new I,this.scale.set(U.width/this.texture.width,U.height/this.texture.height),this.tint=0,this.alpha=.8,this.anchor.set(.5),this.eventMode="static",this.on("pointerdown",t=>t.stopImmediatePropagation())}};var mh=class extends D{overlay;info;bg;title;prompt;countdownText;countdownValue=5;countdown;btnClose;btnContinue;onTimeUp;onContinue;constructor(t,e){super(),this.onContinue=t,this.onTimeUp=e,this.overlay=new uo,this.info=new D,this.bg=new I(v.from("panel-continue")),this.bg.anchor.set(.5),this.title=new rt(N.getText("Busted").toUpperCase(),{fontFamily:N.font,fontSize:128,fill:16777215,stroke:1386821,strokeThickness:16}),this.title.anchor.set(.5),this.prompt=new rt(N.getText("Continue?"),{fontFamily:N.font,fill:16777215,fontSize:104,stroke:1386821,strokeThickness:12}),this.prompt.anchor.set(.5),this.countdownText=new rt(this.countdownValue.toString(),{fontFamily:N.font,dropShadow:!0,dropShadowAngle:90,dropShadowColor:"#16306d",dropShadowDistance:10,fill:["#ecf2ff","#b8ccff"],fillGradientStops:[.4],fontSize:144*3,stroke:"#3967d0"}),this.countdownText.anchor.set(.5),this.btnClose=new Tt("",v.from("icon-close")),this.btnClose.scale.set(1.5),this.btnClose.on("pointerdown",()=>{this.stopCounting(),this.onTimeUp()}),this.btnContinue=new Tt(N.getText("Yes").toUpperCase(),v.from("btn-orange"),{fontFamily:N.font,fontSize:72}),this.btnContinue.on("pointerdown",()=>{this.countdown.stop(),this.onContinue()});let i=new I(v.from("icon-video"));i.anchor.set(.5),this.btnContinue.addChild(i),i.x-=120,this.btnContinue.text.x+=50,this.addChild(this.overlay),this.addChild(this.title),this.addChild(this.info),this.info.addChild(this.bg),this.info.addChild(this.prompt),this.info.addChild(this.btnClose),this.info.addChild(this.countdownText),this.addChild(this.btnContinue),this.positionElements(),this.startCounting(4)}startCounting(t){this.countdown=new lt(this.countdownText).from({alpha:1}).to({alpha:0},1e3).start().repeat(t).easing(at.Quadratic.In).onRepeat(()=>{this.countdownText.text=(--this.countdownValue).toString()}).onComplete(()=>this.onTimeUp())}stopCounting(){this.countdown.stop()}positionElements(){this.title.position.set(0,-600),this.info.position.set(0,-70),this.btnClose.position.set(470,-this.bg.height/2+10),this.prompt.position.set(0,-this.bg.height/2+10),this.countdownText.position.set(0,10),this.btnContinue.position.set(0,520)}};var bt={roadWidth:5,timeDilation:8,enemySpeed:.12,scrollSpeed:1,timeToBossMS:6e4,collisionDamageToPlayer:10,projectileDamageToPlayer:15,mysteryCarPeriodMS:14e3},gh=class extends D{game;slowed=!0;paused=!0;race;road;projectiles;explosions;pickups;threatSpawner;pickupSpawner;bossCar;playerCar;steering;globalMousePos;progress;ui;pauseScreen;level=1;isOver=!1;stopped=!1;bossReady=!1;revivedOnce=!1;moneyMultiplier=1;moneyMultiplierRemainingTimeMS=0;magnetRemainingTimeMS=0;constructor(t,e,i){super(),this.game=t,this.progress=e,this.progress.trackFTUE(),this.game.audio.playSound(`engine_start_${vr(1,3)}`),this.race=new D,this.projectiles=new D,this.explosions=new D,this.pickups=new D,this.road=i,this.playerCar=new Js(e.data.selectedCar,e.getCarUpgrades()),this.threatSpawner=new Xl(this.road,this.playerCar),this.pickupSpawner=new Ul,this.bossCar=new ql(this.level),this.bossCar.setTarget(this.playerCar),this.bossCar.alpha=0,this.ui=new Jl,this.ui.setMoney(this.progress.data.money),this.ui.setReputation(this.progress.data.reputation),this.pauseScreen=new rh,bt.scrollSpeed=1,this.playerCar.guns.forEach(s=>s.onFire.add(o=>{this.game.audio.playSound("projectile"),o.forEach(n=>{let a=this.toLocal({x:this.playerCar.position.x+s.body.x+n.x,y:this.playerCar.position.y+s.body.y+n.y});this.projectiles.addChild(n),n.position.set(a.x*this.scale.x,a.y*this.scale.y)})})),this.bossCar.gun.onFire.add(s=>{s.forEach(o=>{o.position.copyFrom(this.toLocal(this.position,o)),this.projectiles.addChild(o)})}),this.addChild(this.race),this.race.addChild(this.road),this.race.addChild(this.threatSpawner.container),this.race.addChild(this.playerCar),this.race.addChild(this.bossCar),this.race.addChild(this.explosions),this.race.addChild(this.pickups),this.race.addChild(this.projectiles),this.addChild(this.ui),this.steering=new Gl(this.playerCar),this.steering.setBounds(-2,2),this.eventMode="static",ct.on("BOSS_APPEAR",()=>this.spawnBoss()),this.on("pointerdown",s=>{s.preventDefault(),this.globalMousePos=s.global,this.steering.start(s.global),this.unpause(),this.playerCar.setFiringPermission(!Ft.disablePlayerGun)}),this.on("pointermove",s=>{s.preventDefault(),this.globalMousePos=s.global}),this.on("pointerup",s=>{s.preventDefault(),this.steering.stop(),this.pause(),this.playerCar.setFiringPermission(!1)}),this.on("pointerupoutside",s=>{s.preventDefault(),this.steering.stop(),this.pause(),this.playerCar.setFiringPermission(!1)}),t.ticker.add(this.update,this),Ft.manualRaceEnd&&document.addEventListener("keydown",this.debugControls.bind(this)),new lt(this.playerCar).from({y:U.height+this.playerCar.height}).to({y:this.getPlayerCarDefaultY()},600).easing(at.Quadratic.Out).onComplete(()=>{this.pause(!0)}).start()}debugControls(t){switch(t.key){case"o":this.gameOver();break}}resize(){this.pickups.position.x=this.road.x,this.explosions.position.x=this.road.x,this.threatSpawner.container.x=this.road.x}pause(t=!1){(!this.stopped&&!this.paused||t)&&(this.paused=!0,this.slowed=!0,this.pauseScreen.tweenShow(),this.addChild(this.pauseScreen))}unpause(){!this.stopped&&this.paused&&(this.paused=!1,this.slowed=!1,this.removeChild(this.pauseScreen))}update(){if(this.stopped)return;this.steering.active&&this.steering.update(this.globalMousePos);let t=this.slowed?this.game.ticker.deltaMS/bt.timeDilation:this.game.ticker.deltaMS;this.threatSpawner.bossMode||(bt.scrollSpeed+=t*1e-5),this.ui.setProgress((bt.timeToBossMS-this.threatSpawner.timeToBossMS)/bt.timeToBossMS),this.threatSpawner.update(t),this.moneyMultiplier!=1&&(this.moneyMultiplierRemainingTimeMS-=t,this.moneyMultiplierRemainingTimeMS<=0&&(this.moneyMultiplier=1,this.playerCar.moneyEffect.visible=!1)),this.magnetRemainingTimeMS>0?this.magnetRemainingTimeMS-=t:this.playerCar.magnetEffect.visible=!1,this.isOver||(this.road.update(t),this.explosions.children.forEach(i=>{i.y+=bt.scrollSpeed*t})),this.threatSpawner.activeObstacles.forEach(i=>{if(i.y+=bt.scrollSpeed*t,i.getBounds().top>U.height){this.threatSpawner.releaseObstacle(i);return}this.isOver||this.detectOverlap(i.hitbox.getBounds(),this.playerCar.hitbox.getBounds())&&this.setPlayerHealth(0)}),this.bossReady&&(this.bossCar.update(t),this.playerCar.guns.forEach(i=>i.projectiles.activeInstances.forEach(s=>{this.detectOverlap(s.getBounds(),this.bossCar.hitbox.getBounds())&&(i.projectiles.release(s),this.bossCar.takeDamage(i.getProjectileDamage()),this.bossCar.health<=0&&this.defeatBoss())})),this.bossCar.gun.projectiles.activeInstances.forEach(i=>{this.detectOverlap(i.getBounds(),this.playerCar.hitbox.getBounds())&&(this.bossCar.gun.projectiles.release(i),this.setPlayerHealth(this.playerCar.health-bt.projectileDamageToPlayer))}),this.updateBossCarPosition()),this.bossCar.gun.update(t),this.threatSpawner.activeEnemies.forEach(i=>{if(i.position.y+=(bt.scrollSpeed-bt.enemySpeed)*t,i.position.y>U.height+i.height){this.threatSpawner.releaseEnemy(i);return}this.playerCar.guns.forEach(s=>s.projectiles.activeInstances.forEach(o=>{this.detectOverlap(o.getBounds(),i.hitbox.getBounds())&&(s.projectiles.release(o),i.takeDamage(s.getProjectileDamage()),i.health<=0&&this.onPlayerKillEnemy(i))})),this.isOver||this.detectOverlap(i.hitbox.getBounds(),this.playerCar.hitbox.getBounds())&&(this.onPlayerKillEnemy(i),this.setPlayerHealth(this.playerCar.health-bt.collisionDamageToPlayer))});let e=this.road.getDriveableBounds();this.pickupSpawner.pickups.activeInstances.forEach(i=>{i.applyGravity(t),this.magnetRemainingTimeMS>0&&i.applyMagnet(this.playerCar,t),i.move(t);let s=i.getBounds();i.bounceOffRoadBorders(e,s),s.top>U.height&&this.pickupSpawner.pickups.release(i),this.detectOverlap(this.playerCar.hitbox.getBounds(),s)&&(this.onPickup(i.kind),this.pickupSpawner.pickups.release(i))}),this.playerCar.updateGuns(t),this.isOver||this.updatePlayerCarPosition()}onPickup(t){switch(t){case"MoneyBill":this.collectMoney(1*this.moneyMultiplier),this.showPickupInfo(Qe[t].textureKey,(1*this.moneyMultiplier).toString());break;case"MoneyStack":this.collectMoney(10*this.moneyMultiplier),this.showPickupInfo(Qe[t].textureKey,(10*this.moneyMultiplier).toString());break;case"Health":this.game.audio.playSound("power_up_4"),this.showPickupInfo(Qe[t].textureKey,(this.playerCar.getMaxHealth(this.progress.getCarUpgrade("armor"))-this.playerCar.health).toString()),this.playerCar.resetHP(this.progress.getCarUpgrade("armor")),this.onPlayerHealthUpdate(),this.playerCar.hpEffect.visible=!0,this.playerCar.hpEffect.alpha=.8,this.playerCar.hpEffect.gotoAndPlay(0),this.playerCar.hpEffect.onComplete=()=>{this.playerCar.hpEffect.visible=!1};break;case"Magnet":this.game.audio.playSound("power_up_5"),this.magnetRemainingTimeMS=Qe.Magnet.durationMS,this.showPickupInfo(Qe[t].textureKey,(Qe.Magnet.durationMS/1e3).toString()+N.getText("s")),this.showPowerupVisualEffect("Magnet");break;case"MoneyX2":this.game.audio.playSound("power_up_4"),this.moneyMultiplier=2,this.moneyMultiplierRemainingTimeMS=Qe.MoneyX2.durationMS,this.showPickupInfo(Qe[t].textureKey,(Qe.MoneyX2.durationMS/1e3).toString()+N.getText("s")),this.showPowerupVisualEffect("MoneyX2");break}}showPowerupVisualEffect(t){switch(t){case"Magnet":this.playerCar.moneyEffect.visible&&(this.playerCar.moneyEffect.visible=!1),this.playerCar.magnetEffect.visible=!0;break;case"MoneyX2":this.playerCar.magnetEffect.visible&&(this.playerCar.magnetEffect.visible=!1),this.playerCar.moneyEffect.visible=!0;break;default:break}}showPickupInfo(t,e){let i=new Nl(t,e);this.playerCar.addChild(i),i.x=-i.getBounds().width/2,new lt(i).from({y:-170}).to({y:-220,alpha:.5},500).easing(at.Quadratic.InOut).start().onComplete(()=>{this.playerCar.removeChild(i)})}detectOverlap(t,e){let i=t.right>=e.left&&e.right>=t.left,s=t.bottom>=e.top&&e.bottom>=t.top;return i&&s}onPlayerKillEnemy(t){if(t.dead)return;t.dead=!0;let e=this.pickupSpawner.getFromEnemy(Vn[t.kind],this.playerCar.isFullHealth()?["Health"]:[]);e&&(e.position.copyFrom(t.position),this.pickups.addChild(e)),this.game.audio.playSound(`explosion_${vr(1,4)}`),t.kind=="fuel"?(this.showExplosion(t.position,2.1),this.explodeFuelTank(t)):this.showExplosion(t.position,1.7),this.increaseReputation(Vn[t.kind].rep),this.threatSpawner.releaseEnemy(t)}explodeFuelTank(t){this.threatSpawner.activeEnemies.forEach(e=>{if(t!=e){let i=Jx(t.position,e.position);if(i<Nr.maxRadius){let s=no.getFuelExplosionDamage(i);e.takeDamage(s),e.health<=0&&this.onPlayerKillEnemy(e)}}})}setPlayerHealth(t){Ft.playerInvulnerable||(this.playerCar.health=Math.max(0,t),this.onPlayerHealthUpdate())}onPlayerHealthUpdate(){this.ui.setHealth(this.playerCar.health/this.playerCar.getMaxHealth(this.progress.getCarUpgrade("armor"))),this.playerCar.health<=0&&(this.game.audio.playSound("player_car_crash"),this.gameOver())}collectMoney(t){this.game.audio.playSound(`money_collect_${vr(2,4)}`),this.progress.data.money+=t,this.progress.saveLocal(),this.ui.setMoney(this.progress.data.money)}increaseReputation(t){this.progress.data.reputation+=t,this.progress.saveLocal(),this.ui.setReputation(this.progress.data.reputation)}spawnBoss(){this.bossCar.revive(this.level),this.bossCar.alpha=1,this.bossCar.roadX=0,this.bossCar.position.set(U.width/2,-this.bossCar.height);let t=new th(this.bossCar.getRewardForLevel(this.level));t.alpha=0,t.position.set(-t.width,U.height/2),this.addChild(t);let e=new lt(t).to({alpha:1},300).easing(at.Quadratic.InOut),i=new lt(t).from({x:-t.width}).to({x:U.width/2},400).easing(at.Back.Out),s=new lt(t).to({x:U.width+t.width},400).easing(at.Back.In).onComplete(()=>{this.removeChild(t),t.destroy({children:!0})}),o=new lt(this.bossCar.position).to({y:this.bossCar.body.height/2+200},1e3).onStart(()=>{this.game.audio.playSound(`engine_start_${vr(1,3)}`)}).onComplete(()=>{this.bossReady=!0,this.bossCar.gun.canFire=!0});this.game.audio.playSound("ui_menu_whoosh"),e.start(),i.start().onComplete(()=>{s.start(1200),o.start(600)})}defeatBoss(){this.bossCar.gun.projectiles.activeInstances.forEach(o=>this.bossCar.gun.projectiles.release(o));let t=new eh(this.bossCar.getRewardForLevel(this.level)),e=new lt(t).to({alpha:1},300).easing(at.Quadratic.InOut),i=new lt(t).from({x:-t.width}).to({x:U.width/2},400).easing(at.Back.Out),s=new lt(t).to({x:U.width+t.width},400).easing(at.Back.In).onComplete(()=>{this.removeChild(t),t.destroy({children:!0})});e.start(),i.start().onComplete(()=>{s.start(1200)}),t.alpha=0,t.position.set(-t.width,U.height/2),this.addChild(t),this.collectMoney(this.bossCar.getRewardForLevel(this.level)),this.level++,this.threatSpawner.bossMode=!1,this.threatSpawner.resetTimers(2e3),this.game.audio.playSound(`explosion_${vr(1,4)}`),this.showExplosion(this.bossCar.position,2.6),this.bossCar.alpha=0,this.bossCar.gun.canFire=!1,this.bossReady=!1,this.threatSpawner.disableBossMode()}updatePlayerCarPosition(){let t=U.width/2+this.playerCar.roadX*this.getRoadPxPerUnit();this.playerCar.position.x=t}getPlayerCarDefaultY(){return U.height-this.playerCar.height/2-50}updateBossCarPosition(){let t=U.width/2+this.bossCar.roadX*this.getRoadPxPerUnit(),e=this.bossCar.body.height/2+200;this.bossCar.position.set(t,e)}getRoadPxPerUnit(){return this.road.width*.75/bt.roadWidth}getExplosionAnim(t,e,i,s,o){let n=be.get(t),a=new ki(n.animations[e]);return a.anchor.set(.5),a.scale.set(s),a.alpha=i,a.position.copyFrom(o),a.loop=!1,a.animationSpeed=.5,a.play(),a.onComplete=()=>{a.parent.removeChild(a)},a}showExplosion(t,e=1,i){let s=this.getExplosionAnim("mc","explosion",1,e,t);s.rotation=Math.random()*Math.PI;let o=this.getExplosionAnim("explosion","explosion",1,e,t);i&&(s.onFrameChange=n=>{n>s.totalFrames*i&&s.stop()},o.onFrameChange=n=>{n>s.totalFrames*i&&o.stop()}),o.blendMode=q.SCREEN,this.explosions.addChild(s),this.explosions.addChild(o)}gameOver(){if(this.stopped=!0,this.removeChild(this.pauseScreen),!this.revivedOnce&&!Ft.noRevive){let t=!1,e=new mh(()=>{this.game.adsManager.showRewarded(()=>{t?(this.removeChild(e),this.revivedOnce=!0,this.threatSpawner.clearThreats(),this.threatSpawner.resetTimers(2e3),this.stopped=!1,this.setPlayerHealth(this.playerCar.getMaxHealth(this.progress.getCarUpgrade("armor")))):(this.removeChild(e),this.trueGameOver())},()=>{t=!0})},()=>{this.removeChild(e),this.trueGameOver()});e.position.set(U.width/2,U.height/2),this.addChild(e)}else this.trueGameOver()}trueGameOver(){this.isOver=!0,this.playerCar.visible=!1,this.showExplosion(this.playerCar.position,1.7,.4),this.removeChild(this.ui),this.removeListeners(),this.removeChild(this.pauseScreen);let t=U.width/2+(this.playerCar.x-U.width/2),e=U.height;this.steering.stop(),this.race.pivot.set(t,e),this.race.position.set(this.race.position.x+t,this.race.position.y+e),new lt(this.race.scale).to({x:this.race.scale.x*2,y:this.race.scale.y*2},600).start(),new lt(this.race).to({angle:-30},600).easing(at.Sinusoidal.InOut).onComplete(()=>{this.game.ticker.remove(this.update,this),this.game.audio.stopMusic(),this.game.leaderboardsManager&&this.game.leaderboardsManager.setPlayerEntry(pr.name,this.progress.data.reputation,!0).then(i=>{console.log(i)}).catch(i=>{console.error("Error when setting player lb data",i)}),this.addChild(new fh(!1,this.game,this.progress))}).start()}destroy(t){this.game.ticker.remove(this.update,this),this.removeListeners(),this.playerCar.guns.forEach(e=>e.onFire.removeAll()),this.bossCar.gun.onFire.removeAll(),this.threatSpawner.clearSignals(),super.destroy(t)}removeListeners(){this.off("pointerdown"),this.off("pointerup"),this.off("pointermove"),this.off("pointeroutside"),ct.off("BOSS_APPEAR"),document.removeEventListener("keydown",this.debugControls)}};var ZE=["Crack-Left","Crack-Right","Crack-Center"],qn=class r extends I{type;constructor(){super()}static create(){let t=new r;return t.anchor.set(.5),r.reset(t),t}static reset(t){switch(t.type=r.getRandomType(),t.texture=v.from(t.type),t.type){case"Crack-Left":t.x=-320;break;case"Crack-Right":t.x=320;break;case"Crack-Center":{t.x=Math.random()*500-500/2;break}}t.y=0}static getRandomType(){return jt([...ZE],[30,30,40])}};var oy=[10],Zn=class r extends I{constructor(){super()}static create(){let t=new r;return t.anchor.set(.5),t.scale.set(.5),r.reset(t),Ft.disableShadows||(t.filters=[new Vi({blur:1,offset:{x:-4,y:2}})]),t}static reset(t){let e=r.getRandomId();r.resetGraphics(t,e),r.resetPosition(t,e)}static resetGraphics(t,e){t.texture=v.from(`Obs-${e}`)}static resetPosition(t,e){Math.random()>.5?(t.x=-475,e==10&&(t.scale.x=-Math.abs(t.scale.x),t.x+=25)):(t.x=475,e==10&&(t.x-=25,t.scale.x=Math.abs(t.scale.x))),t.y=-t.height}static getRandomId(){return jt([...oy],Array(oy.length).fill(1))}};var ne={laneCount:5,heightOffset:10,minCrackPeriod:2e3,maxCrackPeriod:4e3,linePeriod:350,driveable:.75},po=class extends D{lanes;bgPt1;bgPt2;crackTimer=0;lineTimer=0;timeTillCrack=ne.minCrackPeriod;cracks=new Vt(qn.create,qn.reset,t=>{});lines=new Vt(()=>{let t=new I(v.from("Road-Lines"));return t.anchor.set(.5,0),t.position.set(0,-t.height),t.alpha=Math.random()*.8+.1,t},t=>{t.position.set(0,-t.height),t.alpha=Math.random()*.6+.2},t=>{t.destroy()});obstacles=new Vt(Zn.create,Zn.reset,t=>{});roadTiles;constructor(){super(),this.clearLanes(),this.roadTiles=[new I(v.from("road")),new I(v.from("road")),new I(v.from("road"))],this.roadTiles.forEach((t,e)=>{t.anchor.set(.5,0),t.y=t.height*e,this.addChild(t)}),this.addChild(this.cracks.getInstance());for(let t=0;t<6;t++){let e=this.lines.getInstance();e.position.y+=t*400,this.addChild(e)}}listObstacles(){let t=0,e=0,i=0;for(let s=1;s<=11;s++){let o=new I(v.from(`Obs-${s}`));o.scale.set(.5),o.position.set(t,e),o.height>i&&(i=o.height),t+=o.width,t>500&&(t=0,e+=i,i=0),this.addChild(o)}}clearLanes(){this.lanes=new Array(ne.laneCount).fill(0)}scrollRoadTile(t,e,i,s){t.y>U.height&&(t.y=this.roadTiles[(this.roadTiles.length+(e-1))%this.roadTiles.length].y-t.texture.height+ne.heightOffset),t.y+=bt.scrollSpeed*i}update(t){let e=ny().height;this.roadTiles.forEach((i,s)=>{this.scrollRoadTile(i,s,t,e)}),this.crackTimer+=t,this.crackTimer>this.timeTillCrack&&(this.crackTimer-=this.timeTillCrack,this.timeTillCrack=Math.random()*(ne.maxCrackPeriod-ne.minCrackPeriod)+ne.minCrackPeriod,this.addChild(this.cracks.getInstance()),this.addChild(this.obstacles.getInstance())),this.lineTimer+=t,this.lineTimer>ne.linePeriod&&(this.lineTimer-=ne.linePeriod,this.addChild(this.lines.getInstance())),this.lines.activeInstances.forEach(i=>{i.y+=bt.scrollSpeed*t}),this.obstacles.activeInstances.forEach(i=>{i.y+=bt.scrollSpeed*t,i.getBounds().top>e&&this.obstacles.release(i)}),this.cracks.activeInstances.forEach(i=>{i.y+=bt.scrollSpeed*t,i.getBounds().top>e&&this.cracks.release(i)})}decreaseLaneOccupancy(t){this.lanes[t]--}increaseLaneOccupancy(t){this.lanes[t]++}getFreeLane(){let t=this.lanes.map((s,o)=>o),e=this.lanes.map(s=>s>0?0:1);return jt(t,e)}getRandomLane(){return Math.floor(Math.random()*ne.laneCount)}getLaneX(t){t=t??this.getRandomLane();let e=U.width*ne.driveable,i=(U.width-e)/2,s=e/ne.laneCount;return i+t*s+s/2}getDriveableBounds(){let t=this.getBounds(!1,new Y),e=t.width;return t.width*=ne.driveable,t.x+=(e-t.width)/2,t}};var fo=class extends I{constructor(t){super(v.from(t,{scaleMode:Wt.NEAREST})),this.anchor.set(.5,0),this.scale.set(U.width/this.texture.width+4,1)}};var xh=class extends D{currentLevel;maxLevel;constructor(t){super(),this.currentLevel=new rt(0,{fontFamily:N.font,fontSize:48,fill:t}),this.maxLevel=new rt("/10",{fontFamily:N.font,fontSize:36,fill:6452386}),this.currentLevel.anchor.set(1,1),this.maxLevel.anchor.set(0,1),this.maxLevel.y=-2,this.addChild(this.currentLevel),this.addChild(this.maxLevel)}updateLevel(t){this.currentLevel.text=t.toString()}};var QE=10,yh=class extends D{bg;marks;constructor(t){super(),this.bg=new I(v.from("panel-upgrade")),this.bg.anchor.set(.5),this.addChild(this.bg),this.marks=[];let e=this.bg.getBounds().left+5;for(let i=0;i<QE;i++){let s=new I(v.from("upgrade-mark"));s.anchor.set(.5),s.x=e+s.width/2+i*(s.width+8),this.marks.push(s),this.addChild(s)}this.setLevel(t)}setLevel(t){this.marks.forEach((e,i)=>{e.visible=i<t})}};var _h=["armor","damage","guns"],vh={armor:{colorName:"blue",colorValue:2916309,basePrice:[50,70,90,110,160,180,230,290,360,550],priceWeight:1},damage:{colorName:"orange",colorValue:16090682,basePrice:[80,120,150,170,250,290,370,460,580,870],priceWeight:1.6},guns:{colorName:"purple",colorValue:10442486,basePrice:[60,90,120,140,190,230,290,360,450,680],priceWeight:1.25}},ip={total:[0,7800,29200],coefs:[.07,.15,.25,.38,.54,.75,1,1.3,1.7,2.3]},mo=class r extends D{kind;level;state;bg;label;button;icon;progressBar;maxedText;price;levelCounter;onPress;constructor(t,e,i){super(),this.state="default",this.kind=e,this.level=i;let s=vh[e];this.onPress=new Ge,this.bg=new I(v.from(`box-${s.colorName}`)),this.bg.anchor.set(.5),this.label=new rt(this.getUpgradeName(e).toUpperCase(),{fontFamily:N.font,fontSize:40,fill:16777215}),this.label.anchor.set(.5),this.label.y=-205,this.icon=new I(v.from(`icon-${e}`)),this.icon.anchor.set(.5),this.icon.y=-50,this.levelCounter=new xh(s.colorValue),this.levelCounter.updateLevel(i),this.progressBar=new yh(this.level),this.progressBar.y=100,this.button=new Tt("",v.from("btn-orange-2")),this.price=new Kt("Money"),this.price.text.style.fontSize=48,this.price.x+=10,this.button.addChild(this.price),this.setupButtonAction(t),this.maxedText=new rt(N.getText("Max"),{fontFamily:N.font,fill:16777215,fontSize:54}),this.maxedText.anchor.set(.5),this.button.addChild(this.maxedText),this.maxedText.visible=!1,this.button.y=190,this.setLevel(t,this.level),this.addChild(this.bg),this.addChild(this.label),this.addChild(this.icon),this.addChild(this.levelCounter),this.addChild(this.progressBar),this.addChild(this.button),this.positionElements()}positionElements(){this.levelCounter.position.set(85,45)}getUpgradeName(t){switch(t){case"armor":return N.getText("Armor");case"damage":return N.getText("Main gun");case"guns":return N.getText("Extra guns")}}increaseLevel(t){this.setLevel(t,++this.level)}setLevel(t,e){this.level=e;let i=vh[this.kind].basePrice.length;this.level<i?(this.state=="maxed"&&(this.button.bg.visible=!0,this.state="default",this.button.addChild(this.price),this.maxedText.visible=!1,this.setupButtonAction(t)),this.price.updateValue(r.getPrice(t,this.level,this.kind))):this.state!="maxed"&&(this.button.removeAllListeners(),this.button.removeChild(this.price),this.button.bg.visible=!1,this.maxedText.visible=!0,this.state="maxed"),this.levelCounter.updateLevel(e),this.progressBar.setLevel(e)}setupButtonAction(t){this.button.on("pointerdown",()=>{this.onPress.dispatch({kind:this.kind,price:r.getPrice(t,this.level,this.kind)})})}static getPrice(t,e,i){let s=vh[i];if(t==0)return s.basePrice[e];let o=ip.total[t],n=Math.round(o*ip.coefs[e]/100)*100;e>0&&(n-=o*ip.coefs[e-1]),n=Math.round(n/100)*100;let a=Object.values(vh).map(h=>h.priceWeight).reduce((h,c)=>h+c);return Math.round(n*s.priceWeight/a/10)*10}};function bh(){return new Tt(N.getText("Race").toUpperCase(),v.from("btn-orange"),{fontFamily:N.font,fontSize:96,fill:8928518})}var Qn={carSkins:["Player-Car-1","Player-Car-2","Player-Car-3"],carPrices:[0,1e4,3e4]},Jn=class extends D{game;progress;bg;bottomShadow;title;playerCar;selectedCarId;btnBack;moneyCounter;btnNextCar;btnPrevCar;btnSelectCar;upgrades;btnPurchaseCar;carPurchasePrice;btnStartRace;constructor(t,e){super(),this.game=t,this.progress=e,this.bg=new I(v.from("garage")),this.bg.scale.set(U.height/this.bg.height),this.bg.anchor.x=.5,this.bg.x=U.width/2,this.bottomShadow=new fo("shadow-blue"),this.selectedCarId=e.data.selectedCar,this.playerCar=new Js(this.selectedCarId,this.progress.getCarUpgrades(this.selectedCarId)),this.playerCar.scale.set(2),this.btnBack=new Tt("",v.from("btn-back")),this.btnBack.on("pointerdown",()=>{this.progress.data.cars.find(i=>i.id==this.selectedCarId)?.unlocked&&(this.progress.data.selectedCar=this.selectedCarId,this.progress.saveLocal()),this.game.audio.playSound("ui_menu_whoosh"),ct.emit("START_MENU")}),this.moneyCounter=new Kt("Money"),this.moneyCounter.updateValue(e.data.money),this.btnPrevCar=new Tt("",v.from("btn-arrow")),this.btnPrevCar.scale.x=-1,this.btnPrevCar.on("pointerdown",()=>{this.selectedCarId>0&&(this.selectedCarId--,this.game.audio.playSound("ui_menu_whoosh"),this.reloadPlayerCar(this.selectedCarId),this.updateGarageUI(this.selectedCarId))}),this.btnNextCar=new Tt("",v.from("btn-arrow")),this.btnNextCar.on("pointerdown",()=>{this.selectedCarId<Qn.carSkins.length-1&&(this.selectedCarId++,this.game.audio.playSound("ui_menu_whoosh"),this.reloadPlayerCar(this.selectedCarId),this.updateGarageUI(this.selectedCarId))}),this.btnSelectCar=new Tt("Select",v.from("btn-green"),{fontFamily:N.font,fill:16777215,fontSize:48}),this.btnSelectCar.on("pointerdown",()=>{this.progress.data.selectedCar=this.selectedCarId,this.progress.saveLocal()}),this.upgrades=new D,this.addUpgradeButtons(),this.btnPurchaseCar=new Tt("",v.from("btn-orange"),{fontFamily:N.font,fill:16777215,fontSize:48}),this.carPurchasePrice=new Kt("Money"),this.carPurchasePrice.scale.set(1.5),this.carPurchasePrice.updateValue(Qn.carPrices[this.selectedCarId]),this.btnPurchaseCar.addChild(this.carPurchasePrice),this.carPurchasePrice.x=10,this.btnPurchaseCar.on("pointerdown",()=>{let i=Qn.carPrices[this.selectedCarId];i<=this.progress.data.money&&(this.progress.data.cars[this.selectedCarId].unlocked=!0,this.progress.data.money-=i,this.moneyCounter.updateValue(this.progress.data.money),this.progress.saveLocal(),this.updateGarageUI(this.selectedCarId))}),this.btnStartRace=bh(),this.btnStartRace.on("pointerdown",()=>{let i=new po;i.pivot.x=-i.width/2,ct.emit("START_RACE",i)}),this.updateGarageUI(this.selectedCarId),this.addChild(this.bg),this.addChild(this.bottomShadow),this.addChild(this.btnBack),this.addChild(this.moneyCounter),this.addChild(this.playerCar),this.progress.data.firstTime?(this.addChild(this.btnStartRace),new lt(this.btnStartRace.scale).to({x:1.15,y:1.15},600).easing(at.Sinusoidal.InOut).yoyo().repeat(1/0).start()):(this.addChild(this.btnPrevCar),this.addChild(this.btnNextCar),this.addChild(this.upgrades)),this.addChild(this.btnPurchaseCar),this.positionElements()}positionElements(){this.bottomShadow.position.set(U.width/2,U.height-this.bottomShadow.height),this.btnBack.position.set(100,80),this.moneyCounter.position.set(U.width/2+400,80),this.playerCar.position.set(U.width/2,this.height/2-200),this.btnPrevCar.position.set(U.width/2-380,this.playerCar.y),this.btnNextCar.position.set(U.width/2+380,this.playerCar.y),this.btnStartRace.position.set(U.width/2,this.height-this.btnSelectCar.height),this.btnSelectCar.position.set(U.width/2,this.btnStartRace.y-this.btnStartRace.height),this.btnPurchaseCar.position.set(U.width/2,this.playerCar.y+800),this.upgrades.position.set(U.width/2,this.playerCar.y+700),this.btnStartRace.position.set(U.width/2,this.playerCar.y+700)}reloadPlayerCar(t){this.playerCar.body.texture=v.from(Qn.carSkins[t])}addUpgradeButtons(){[..._h].forEach((t,e)=>{let i=new mo(this.selectedCarId,t,this.progress.getCarUpgrade(t,this.selectedCarId));i.onPress.add(s=>{(s.price<this.progress.data.money||Ft.freeUpgrades)&&(this.game.audio.playSound("upgrade_3"),this.progress.upgradeCar(this.selectedCarId,s.kind),this.progress.data.money-=Ft.freeUpgrades?0:s.price,this.progress.saveLocal(),this.moneyCounter.updateValue(this.progress.data.money),i.increaseLevel(this.selectedCarId),s.kind=="guns"&&(this.playerCar.leftGun.upgrade(this.progress.getCarUpgrade("guns",this.selectedCarId)),this.playerCar.rightGun.upgrade(this.progress.getCarUpgrade("guns",this.selectedCarId))),s.kind=="damage"&&this.playerCar.mainGun.upgrade(this.progress.getCarUpgrade("damage",this.selectedCarId)))}),i.position.x=(e-1)*320,this.upgrades.addChild(i)})}updateGarageUI(t){let e=this.progress.data.cars[t].unlocked;this.upgrades.visible=e,this.btnPurchaseCar.visible=!e,this.playerCar.mainGun.upgrade(this.progress.getCarUpgrade("damage",this.selectedCarId)),this.playerCar.leftGun.upgrade(this.progress.getCarUpgrade("guns",this.selectedCarId)),this.playerCar.rightGun.upgrade(this.progress.getCarUpgrade("guns",this.selectedCarId)),e?this.upgrades.children.forEach(i=>{i.setLevel(t,this.progress.getCarUpgrade(i.kind,t))}):this.carPurchasePrice.updateValue(Qn.carPrices[t])}};var JE={fontSize:36,fill:16777215,stroke:1849961,strokeThickness:8};function sp(r,t){let e=Object.assign({fontFamily:N.font},JE),i=new Tt(t,v.from("btn-blue"),e);i.text.position.set(-5,40);let s=new I(v.from(r));return s.anchor.set(.5),s.y=-60,i.addChild(s),i}var tA={bg:{on:"btn-green-2",off:"btn-blue-disabled"}},ta=class extends D{bg;icon;_toggledOn=!0;textures;constructor(t,e){super(),this.textures=Object.assign({},tA,t),this.bg=new I,this.bg.anchor.set(.5),this.icon=new I,this.icon.anchor.set(.5),this.eventMode="static",this.on("pointerdown",()=>{ct.emit("BUTTON_PRESS"),this.setState(!this.toggledOn),ct.emit(e,this.toggledOn)}),this.addChild(this.bg),this.addChild(this.icon),this.setState(!0)}setState(t){this._toggledOn=t,this.updateTextures(this._toggledOn),this.icon.tint=this._toggledOn?84798:2576510}updateTextures(t){this.bg.texture=v.from(t?this.textures.bg.on:this.textures.bg.off),this.icon.texture=v.from(t?this.textures.icon.on:this.textures.icon.off)}get toggledOn(){return this._toggledOn}};var Th=class extends D{overlay;bg;title;labelMusic;toggleMusic;labelSounds;toggleSounds;btnClose;btnRestart;btnHome;constructor(t,e){super(),this.overlay=new uo,this.bg=new I(v.from("panel-settings")),this.bg.anchor.set(.5),this.title=new rt(N.getText("Settings").toUpperCase(),{fontFamily:N.font,fontSize:54,fill:16777215}),this.title.anchor.set(.5),this.labelMusic=new rt(N.getText("Music").toUpperCase(),{fontFamily:N.font,fontSize:48,fill:16777215}),this.labelMusic.anchor.set(.5),this.labelSounds=new rt(N.getText("Sounds").toUpperCase(),{fontFamily:N.font,fontSize:48,fill:16777215}),this.labelSounds.anchor.set(.5),this.toggleMusic=new ta({icon:{on:"icon-music",off:"icon-music"}},"MUSIC_TOGGLE"),this.toggleMusic.setState(t.music),this.toggleSounds=new ta({icon:{on:"icon-sounds",off:"icon-sounds"}},"SOUNDS_TOGGLE"),this.toggleSounds.setState(t.sounds),this.btnClose=new Tt("",v.from("icon-close")),this.btnClose.on("pointerdown",()=>{this.parent.removeChild(this)}),this.btnRestart=new Tt(N.getText("Restart").toUpperCase(),v.from("btn-orange-3"),{fontFamily:N.font,fontSize:54,fill:7483392}),this.btnHome=new Tt(N.getText("Home").toUpperCase(),v.from("btn-orange"),{fontFamily:N.font,fontSize:54,fill:65792}),this.positionElements(e),this.addChild(this.overlay),this.addChild(this.bg),this.addChild(this.title),this.addChild(this.labelMusic),this.addChild(this.toggleMusic),this.addChild(this.labelSounds),this.addChild(this.toggleSounds),this.addChild(this.btnClose),this.addChild(this.btnRestart),this.addChild(this.btnHome)}positionElements(t){this.title.position.set(0,-270),this.btnClose.position.set(280,-300),this.labelMusic.position.set(-140,t?-150:-50),this.labelSounds.position.set(140,t?-150:-50),this.toggleMusic.position.set(-140,t?0:130),this.toggleSounds.position.set(140,t?0:130),this.btnRestart.visible=t,this.btnHome.visible=t,this.btnRestart.position.set(0,220),this.btnHome.position.set(0,500)}};var ea=class extends D{game;road;header;leaderboard;bottomShadow;repCounter;moneyCounter;settingsButton;raceButton;garageButton;moreGamesButton;constructor(t,e){super(),this.game=t,this.header=new I(v.from("panel-header")),this.header.anchor.set(.5,0),this.leaderboard=new Cl,this.leaderboard.visible=!1,this.game.leaderboardsManager&&this.game.leaderboardsManager.getLeaderboardEntries(pr.name,pr.rows).then(s=>{this.leaderboard.visible=!0;let o=[];s.userRank>pr.rows?(o=s.entries.slice(0,pr.rows),o.push(s.entries.find(n=>n.rank==s.userRank))):o=s.entries,this.leaderboard.displayEntries(o,s.userRank)}).catch(s=>{console.error("Error when fetching lb entries",s)}),this.repCounter=new ho,this.repCounter.updateValue(e.data.reputation),this.moneyCounter=new Kt("Money"),this.moneyCounter.updateValue(e.data.money),this.settingsButton=new Tt("",v.from("btn-settings")),this.settingsButton.on("pointerdown",()=>{let s=new Th(e.data,!1);s.position.set(U.width/2,U.height/2),this.addChild(s)}),this.road=new po,this.raceButton=bh(),this.raceButton.on("pointerdown",()=>{new lt(this.raceButton).to({y:-this.raceButton.height},300).easing(at.Back.In).start(),new lt(this.garageButton).to({y:U.height+this.garageButton.height},300).easing(at.Back.In).start(),new lt(this.moreGamesButton).to({y:U.height+this.garageButton.height},300).easing(at.Back.In).start(),new lt(this.bottomShadow).to({alpha:0},300).easing(at.Quadratic.In).onComplete(()=>{ct.emit("START_RACE",this.road)}).start()}),this.garageButton=sp("icon-upgrade",N.getText("Upgrade")),this.garageButton.on("pointerdown",()=>{this.game.audio.playSound("ui_menu_whoosh"),ct.emit("START_GARAGE")}),_h.map(s=>mo.getPrice(e.data.selectedCar,e.getCarUpgrade(s),s)).filter(s=>s>0&&s<=e.data.money).length>0&&new lt(this.garageButton.scale).to({x:1.1,y:1.1},900).yoyo().easing(at.Sinusoidal.InOut).repeat(1/0).start(),this.moreGamesButton=sp("icon-more-games",N.getText("More games")),this.moreGamesButton.on("pointerdown",()=>{this.game.audio.playSound("ui_menu_whoosh"),pi.showMoreGames()}),this.bottomShadow=new fo("shadow"),this.addChild(this.road),this.addChild(this.bottomShadow),this.addChild(this.header),this.addChild(this.repCounter),this.addChild(this.moneyCounter),this.addChild(this.settingsButton),this.addChild(this.leaderboard),this.addChild(this.raceButton),this.addChild(this.garageButton),this.addChild(this.moreGamesButton),this.positionElements(),this.game.ticker.add(this.update,this)}positionElements(){this.header.position.set(U.width/2,0),this.settingsButton.position.set(U.width-this.settingsButton.width-20,this.header.height/2),this.repCounter.position.set(250,this.header.height/2),this.moneyCounter.position.set(U.width/2+200,this.header.height/2),this.road.pivot.x=-this.road.width/2,this.bottomShadow.position.set(U.width/2,U.height-this.bottomShadow.height),this.leaderboard.position.set(U.width/2,400),this.leaderboard.scale.set(this.leaderboard.width/this.road.width),this.raceButton.position.set(U.width/2,1300),this.garageButton.position.set(U.width/2-170,1700),this.moreGamesButton.position.set(U.width/2+170,1700)}update(){Ri.shared.update(this.game.ticker.deltaMS),this.road.update(this.game.ticker.deltaMS/bt.timeDilation)}destroy(t){this.game.ticker.remove(this.update,this),super.destroy(t)}};var Ft={forceLocale:void 0,exposePIXI:!1,disablePlayerGun:!1,manualRaceEnd:!1,cheats:!1,freeUpgrades:!1,noRevive:!1,disableShadows:!0,weakBosses:!1,playerInvulnerable:!1},U={width:1080,height:1920},wh=class extends Qa{scene;progress;audio;leaderboardsManager;adsManager;isInitialised=!1;constructor(){super({view:document.getElementById("pixi-canvas"),resolution:window.devicePixelRatio||1,width:U.width,height:U.height,autoDensity:!0,backgroundColor:0})}init(){this.isInitialised||(this.progress=new fl,this.audio=new dl,this.audio.init(this.progress.data.sounds,this.progress.data.music),window.addEventListener("blur",()=>{this.audio.setMusicEnabled(!1,"AppPaused"),this.audio.setSoundEnabled(!1,"AppPaused")}),window.addEventListener("focus",()=>{this.audio.setMusicEnabled(!0,"AppPaused"),this.audio.setSoundEnabled(!0,"AppPaused")}),ct.on("BUTTON_PRESS",()=>{this.audio.playSound("ui_click_1")}),ct.on("MUSIC_TOGGLE",t=>{this.audio.setMusicEnabled(t,"UserAction"),this.progress.data.music=t,this.progress.saveLocal()}),ct.on("SOUNDS_TOGGLE",t=>{this.audio.setSoundEnabled(t,"UserAction"),this.progress.data.sounds=t,this.progress.saveLocal()}),ct.on("AD_STARTED",()=>{this.audio.setMusicEnabled(!1,"AdPlaying"),this.audio.setSoundEnabled(!1,"AdPlaying")}),ct.on("AD_FINISHED",()=>{this.audio.setMusicEnabled(!0,"AdPlaying"),this.audio.setSoundEnabled(!0,"AdPlaying")}),Ft.cheats&&document.addEventListener("keydown",this.cheats.bind(this)),this.progress.data.firstTime?this.switchScene(new Jn(this,this.progress)):this.switchScene(new ea(this,this.progress)),this.audio.playMusic("calm"),ct.on("START_RACE",t=>{pi.showPopup("onLevelStart",()=>{this.switchScene(new gh(this,this.progress,t)),this.audio.setMusicContext("active")})}),ct.on("START_GARAGE",()=>{this.switchScene(new Jn(this,this.progress)),this.audio.setMusicContext("calm")}),ct.on("START_MENU",()=>{this.switchScene(new ea(this,this.progress)),this.audio.setMusicContext("calm")}),this.ticker.add(()=>{Ri.shared.update(this.ticker.deltaMS)}),this.isInitialised=!0)}switchScene(t){this.stage.removeChildren(),this.scene&&this.scene.destroy({children:!0}),this.scene=t,this.onresize(),this.stage.addChild(t)}cheats(t){switch(t.key){case"r":this.progress.reset(),console.log("Game progress dropped",this.progress.data);break;case"m":this.progress.data.money+=1e3,this.progress.saveLocal,console.log(`Free money! ${this.progress.data.money}`);break}}initLeaderboards(t){this.leaderboardsManager=new pl(t)}initAds(t){this.adsManager=new el(t)}onresize(){let t=this.getGameScale();this.renderer.resize(U.width*t,U.height*t),this.scene.scale.set(t)}getGameScale(){let t=window.innerHeight/U.height,e=window.innerWidth/U.width;return Math.min(e,t)}};var ay={bundles:[{name:"main",assets:{cars:"./assets/atlases/cars.json",weapons:"./assets/atlases/weapons.json",projectiles:"./assets/atlases/projectiles.json",explosion:"./assets/atlases/explosion.json",pickups:"./assets/atlases/pickups.json",road:"./assets/road.jpg",garage:"./assets/garage.jpg",bg:"./assets/atlases/bg.json",obstacles:"./assets/atlases/obstacles.json",ui:"./assets/atlases/ui.json",rajdhani:"./assets/fonts/rajdhani.ttf",rubik:"./assets/fonts/rubik.ttf",mc:"./assets/atlases/mc.json",hp_loop:"./assets/atlases/hp_loop.json",shield_loop:"./assets/atlases/shield_loop.json"}},{name:"audio",assets:{calm:"./assets/music/calm.mp3",sounds:"./assets/sounds/sounds.mp3",active:"./assets/music/active.mp3"}}]};async function ly(r){S.add(Ol),await be.init({manifest:ay}),await be.loadBundle("main",r),await be.loadBundle("audio",r),console.log("assets loaded",be.cache)}var fi;pi.setup("CarsNGuns");ly(r=>{}).then(()=>{fi=new wh,YaGames.init().then(r=>{r.features.LoadingAPI?.ready(),N.setLocale(Ft.forceLocale||r.environment.i18n.lang),fi.initLeaderboards(r),fi.initAds(r),fi.adsManager.showInterstitial()}).catch(r=>console.error(r)).finally(()=>{fi.init(),document.addEventListener("contextmenu",r=>r.preventDefault()),document.addEventListener("webkitmouseforcewillbegin",r=>r.preventDefault()),window.addEventListener("resize",()=>{fi.onresize()})}),Ft.exposePIXI&&(globalThis.__PIXI_APP__=fi)});function ny(){return fi.screen}})();
/*! Bundled license information:

punycode/punycode.js:
  (*! https://mths.be/punycode v1.4.1 by @mathias *)

tweedle.js/dist/tweedle.es.js:
  (*!
   * tweedle.js - v2.1.0
   * Compiled Wed, 05 Apr 2023 15:21:25 UTC
   *
   * tweedle.js is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   * 
   * Copyright 2019-2021, Milton Candelero <miltoncandelero@gmail.com>, All Rights Reserved
   *)

@pixi/filter-adjustment/dist/filter-adjustment.mjs:
  (*!
   * @pixi/filter-adjustment - v5.1.1
   * Compiled Wed, 11 Jan 2023 23:10:33 UTC
   *
   * @pixi/filter-adjustment is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/filter-kawase-blur/dist/filter-kawase-blur.mjs:
  (*!
   * @pixi/filter-kawase-blur - v5.1.1
   * Compiled Wed, 11 Jan 2023 23:10:33 UTC
   *
   * @pixi/filter-kawase-blur is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/filter-advanced-bloom/dist/filter-advanced-bloom.mjs:
  (*!
   * @pixi/filter-advanced-bloom - v5.1.1
   * Compiled Wed, 11 Jan 2023 23:10:33 UTC
   *
   * @pixi/filter-advanced-bloom is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/filter-ascii/dist/filter-ascii.mjs:
  (*!
   * @pixi/filter-ascii - v5.1.1
   * Compiled Wed, 11 Jan 2023 23:10:33 UTC
   *
   * @pixi/filter-ascii is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/filter-bevel/dist/filter-bevel.mjs:
  (*!
   * @pixi/filter-bevel - v5.1.1
   * Compiled Wed, 11 Jan 2023 23:10:33 UTC
   *
   * @pixi/filter-bevel is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/filter-bloom/dist/filter-bloom.mjs:
  (*!
   * @pixi/filter-bloom - v5.1.1
   * Compiled Wed, 11 Jan 2023 23:10:33 UTC
   *
   * @pixi/filter-bloom is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/filter-bulge-pinch/dist/filter-bulge-pinch.mjs:
  (*!
   * @pixi/filter-bulge-pinch - v5.1.1
   * Compiled Wed, 11 Jan 2023 23:10:33 UTC
   *
   * @pixi/filter-bulge-pinch is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/filter-color-gradient/dist/filter-color-gradient.mjs:
  (*!
   * @pixi/filter-color-gradient - v5.2.0
   * Compiled Tue, 28 Feb 2023 14:24:35 UTC
   *
   * @pixi/filter-color-gradient is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/filter-color-map/dist/filter-color-map.mjs:
  (*!
   * @pixi/filter-color-map - v5.1.1
   * Compiled Wed, 11 Jan 2023 23:10:33 UTC
   *
   * @pixi/filter-color-map is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/filter-color-overlay/dist/filter-color-overlay.mjs:
  (*!
   * @pixi/filter-color-overlay - v5.1.1
   * Compiled Wed, 11 Jan 2023 23:10:33 UTC
   *
   * @pixi/filter-color-overlay is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/filter-color-replace/dist/filter-color-replace.mjs:
  (*!
   * @pixi/filter-color-replace - v5.1.1
   * Compiled Wed, 11 Jan 2023 23:10:33 UTC
   *
   * @pixi/filter-color-replace is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/filter-convolution/dist/filter-convolution.mjs:
  (*!
   * @pixi/filter-convolution - v5.1.1
   * Compiled Wed, 11 Jan 2023 23:10:33 UTC
   *
   * @pixi/filter-convolution is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/filter-cross-hatch/dist/filter-cross-hatch.mjs:
  (*!
   * @pixi/filter-cross-hatch - v5.1.1
   * Compiled Wed, 11 Jan 2023 23:10:33 UTC
   *
   * @pixi/filter-cross-hatch is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/filter-crt/dist/filter-crt.mjs:
  (*!
   * @pixi/filter-crt - v5.1.1
   * Compiled Wed, 11 Jan 2023 23:10:33 UTC
   *
   * @pixi/filter-crt is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/filter-dot/dist/filter-dot.mjs:
  (*!
   * @pixi/filter-dot - v5.1.1
   * Compiled Wed, 11 Jan 2023 23:10:33 UTC
   *
   * @pixi/filter-dot is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/filter-drop-shadow/dist/filter-drop-shadow.mjs:
  (*!
   * @pixi/filter-drop-shadow - v5.2.0
   * Compiled Tue, 28 Feb 2023 14:24:35 UTC
   *
   * @pixi/filter-drop-shadow is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/filter-emboss/dist/filter-emboss.mjs:
  (*!
   * @pixi/filter-emboss - v5.1.1
   * Compiled Wed, 11 Jan 2023 23:10:33 UTC
   *
   * @pixi/filter-emboss is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/filter-glitch/dist/filter-glitch.mjs:
  (*!
   * @pixi/filter-glitch - v5.1.1
   * Compiled Wed, 11 Jan 2023 23:10:33 UTC
   *
   * @pixi/filter-glitch is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/filter-glow/dist/filter-glow.mjs:
  (*!
   * @pixi/filter-glow - v5.2.1
   * Compiled Fri, 24 Mar 2023 22:12:11 UTC
   *
   * @pixi/filter-glow is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/filter-godray/dist/filter-godray.mjs:
  (*!
   * @pixi/filter-godray - v5.1.1
   * Compiled Wed, 11 Jan 2023 23:10:33 UTC
   *
   * @pixi/filter-godray is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/filter-grayscale/dist/filter-grayscale.mjs:
  (*!
   * @pixi/filter-grayscale - v5.1.1
   * Compiled Wed, 11 Jan 2023 23:10:33 UTC
   *
   * @pixi/filter-grayscale is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/filter-hsl-adjustment/dist/filter-hsl-adjustment.mjs:
  (*!
   * @pixi/filter-hsl-adjustment - v5.2.0
   * Compiled Tue, 28 Feb 2023 14:24:35 UTC
   *
   * @pixi/filter-hsl-adjustment is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/filter-motion-blur/dist/filter-motion-blur.mjs:
  (*!
   * @pixi/filter-motion-blur - v5.1.1
   * Compiled Wed, 11 Jan 2023 23:10:33 UTC
   *
   * @pixi/filter-motion-blur is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/filter-multi-color-replace/dist/filter-multi-color-replace.mjs:
  (*!
   * @pixi/filter-multi-color-replace - v5.1.1
   * Compiled Wed, 11 Jan 2023 23:10:33 UTC
   *
   * @pixi/filter-multi-color-replace is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/filter-old-film/dist/filter-old-film.mjs:
  (*!
   * @pixi/filter-old-film - v5.1.1
   * Compiled Wed, 11 Jan 2023 23:10:33 UTC
   *
   * @pixi/filter-old-film is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/filter-outline/dist/filter-outline.mjs:
  (*!
   * @pixi/filter-outline - v5.2.0
   * Compiled Tue, 28 Feb 2023 14:24:35 UTC
   *
   * @pixi/filter-outline is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/filter-pixelate/dist/filter-pixelate.mjs:
  (*!
   * @pixi/filter-pixelate - v5.1.1
   * Compiled Wed, 11 Jan 2023 23:10:33 UTC
   *
   * @pixi/filter-pixelate is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/filter-radial-blur/dist/filter-radial-blur.mjs:
  (*!
   * @pixi/filter-radial-blur - v5.1.1
   * Compiled Wed, 11 Jan 2023 23:10:33 UTC
   *
   * @pixi/filter-radial-blur is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/filter-reflection/dist/filter-reflection.mjs:
  (*!
   * @pixi/filter-reflection - v5.1.1
   * Compiled Wed, 11 Jan 2023 23:10:33 UTC
   *
   * @pixi/filter-reflection is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/filter-rgb-split/dist/filter-rgb-split.mjs:
  (*!
   * @pixi/filter-rgb-split - v5.1.1
   * Compiled Wed, 11 Jan 2023 23:10:33 UTC
   *
   * @pixi/filter-rgb-split is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/filter-shockwave/dist/filter-shockwave.mjs:
  (*!
   * @pixi/filter-shockwave - v5.1.1
   * Compiled Wed, 11 Jan 2023 23:10:33 UTC
   *
   * @pixi/filter-shockwave is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/filter-simple-lightmap/dist/filter-simple-lightmap.mjs:
  (*!
   * @pixi/filter-simple-lightmap - v5.1.1
   * Compiled Wed, 11 Jan 2023 23:10:33 UTC
   *
   * @pixi/filter-simple-lightmap is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/filter-tilt-shift/dist/filter-tilt-shift.mjs:
  (*!
   * @pixi/filter-tilt-shift - v5.2.0
   * Compiled Tue, 28 Feb 2023 14:24:35 UTC
   *
   * @pixi/filter-tilt-shift is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/filter-twist/dist/filter-twist.mjs:
  (*!
   * @pixi/filter-twist - v5.1.1
   * Compiled Wed, 11 Jan 2023 23:10:33 UTC
   *
   * @pixi/filter-twist is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/filter-zoom-blur/dist/filter-zoom-blur.mjs:
  (*!
   * @pixi/filter-zoom-blur - v5.1.1
   * Compiled Wed, 11 Jan 2023 23:10:33 UTC
   *
   * @pixi/filter-zoom-blur is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

pixi-filters/dist/esm/pixi-filters.mjs:
  (*!
   * pixi-filters - v5.2.1
   * Compiled Fri, 24 Mar 2023 22:12:11 UTC
   *
   * pixi-filters is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

gamefuse/dist/gamefuse.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2022 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2021 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
*/
