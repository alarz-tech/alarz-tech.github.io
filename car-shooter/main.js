(()=>{var Tm=Object.create;var mh=Object.defineProperty;var Em=Object.getOwnPropertyDescriptor;var wm=Object.getOwnPropertyNames;var Sm=Object.getPrototypeOf,Am=Object.prototype.hasOwnProperty;var ft=(r,t)=>()=>(t||r((t={exports:{}}).exports,t),t.exports),Cm=(r,t)=>{for(var e in t)mh(r,e,{get:t[e],enumerable:!0})},Pm=(r,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of wm(t))!Am.call(r,s)&&s!==e&&mh(r,s,{get:()=>t[s],enumerable:!(i=Em(t,s))||i.enumerable});return r};var gh=(r,t,e)=>(e=r!=null?Tm(Sm(r)):{},Pm(t||!r||!r.__esModule?mh(e,"default",{value:r,enumerable:!0}):e,r));var ac=ft((H0,bh)=>{"use strict";var Mm=Object.prototype.hasOwnProperty,ee="~";function Fs(){}Object.create&&(Fs.prototype=Object.create(null),new Fs().__proto__||(ee=!1));function Bm(r,t,e){this.fn=r,this.context=t,this.once=e||!1}function nc(r,t,e,i,s){if(typeof e!="function")throw new TypeError("The listener must be a function");var o=new Bm(e,i||r,s),n=ee?ee+t:t;return r._events[n]?r._events[n].fn?r._events[n]=[r._events[n],o]:r._events[n].push(o):(r._events[n]=o,r._eventsCount++),r}function mn(r,t){--r._eventsCount===0?r._events=new Fs:delete r._events[t]}function jt(){this._events=new Fs,this._eventsCount=0}jt.prototype.eventNames=function(){var t=[],e,i;if(this._eventsCount===0)return t;for(i in e=this._events)Mm.call(e,i)&&t.push(ee?i.slice(1):i);return Object.getOwnPropertySymbols?t.concat(Object.getOwnPropertySymbols(e)):t};jt.prototype.listeners=function(t){var e=ee?ee+t:t,i=this._events[e];if(!i)return[];if(i.fn)return[i.fn];for(var s=0,o=i.length,n=new Array(o);s<o;s++)n[s]=i[s].fn;return n};jt.prototype.listenerCount=function(t){var e=ee?ee+t:t,i=this._events[e];return i?i.fn?1:i.length:0};jt.prototype.emit=function(t,e,i,s,o,n){var a=ee?ee+t:t;if(!this._events[a])return!1;var h=this._events[a],l=arguments.length,u,c;if(h.fn){switch(h.once&&this.removeListener(t,h.fn,void 0,!0),l){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,e),!0;case 3:return h.fn.call(h.context,e,i),!0;case 4:return h.fn.call(h.context,e,i,s),!0;case 5:return h.fn.call(h.context,e,i,s,o),!0;case 6:return h.fn.call(h.context,e,i,s,o,n),!0}for(c=1,u=new Array(l-1);c<l;c++)u[c-1]=arguments[c];h.fn.apply(h.context,u)}else{var d=h.length,p;for(c=0;c<d;c++)switch(h[c].once&&this.removeListener(t,h[c].fn,void 0,!0),l){case 1:h[c].fn.call(h[c].context);break;case 2:h[c].fn.call(h[c].context,e);break;case 3:h[c].fn.call(h[c].context,e,i);break;case 4:h[c].fn.call(h[c].context,e,i,s);break;default:if(!u)for(p=1,u=new Array(l-1);p<l;p++)u[p-1]=arguments[p];h[c].fn.apply(h[c].context,u)}}return!0};jt.prototype.on=function(t,e,i){return nc(this,t,e,i,!1)};jt.prototype.once=function(t,e,i){return nc(this,t,e,i,!0)};jt.prototype.removeListener=function(t,e,i,s){var o=ee?ee+t:t;if(!this._events[o])return this;if(!e)return mn(this,o),this;var n=this._events[o];if(n.fn)n.fn===e&&(!s||n.once)&&(!i||n.context===i)&&mn(this,o);else{for(var a=0,h=[],l=n.length;a<l;a++)(n[a].fn!==e||s&&!n[a].once||i&&n[a].context!==i)&&h.push(n[a]);h.length?this._events[o]=h.length===1?h[0]:h:mn(this,o)}return this};jt.prototype.removeAllListeners=function(t){var e;return t?(e=ee?ee+t:t,this._events[e]&&mn(this,e)):(this._events=new Fs,this._eventsCount=0),this};jt.prototype.off=jt.prototype.removeListener;jt.prototype.addListener=jt.prototype.on;jt.prefixed=ee;jt.EventEmitter=jt;typeof bh<"u"&&(bh.exports=jt)});var dc=ft((V0,Sh)=>{"use strict";Sh.exports=_n;Sh.exports.default=_n;function _n(r,t,e){e=e||2;var i=t&&t.length,s=i?t[0]*e:r.length,o=lc(r,0,s,e,!0),n=[];if(!o||o.next===o.prev)return n;var a,h,l,u,c,d,p;if(i&&(o=Nm(r,t,o,e)),r.length>80*e){a=l=r[0],h=u=r[1];for(var f=e;f<s;f+=e)c=r[f],d=r[f+1],c<a&&(a=c),d<h&&(h=d),c>l&&(l=c),d>u&&(u=d);p=Math.max(l-a,u-h),p=p!==0?32767/p:0}return Ds(o,n,e,a,h,p,0),n}function lc(r,t,e,i,s){var o,n;if(s===wh(r,t,e,i)>0)for(o=t;o<e;o+=i)n=hc(o,r[o],r[o+1],n);else for(o=e-i;o>=t;o-=i)n=hc(o,r[o],r[o+1],n);return n&&xn(n,n.next)&&(Os(n),n=n.next),n}function $r(r,t){if(!r)return r;t||(t=r);var e=r,i;do if(i=!1,!e.steiner&&(xn(e,e.next)||vt(e.prev,e,e.next)===0)){if(Os(e),e=t=e.prev,e===e.next)break;i=!0}else e=e.next;while(i||e!==t);return t}function Ds(r,t,e,i,s,o,n){if(r){!n&&o&&Vm(r,i,s,o);for(var a=r,h,l;r.prev!==r.next;){if(h=r.prev,l=r.next,o?Dm(r,i,s,o):Fm(r)){t.push(h.i/e|0),t.push(r.i/e|0),t.push(l.i/e|0),Os(r),r=l.next,a=l.next;continue}if(r=l,r===a){n?n===1?(r=Lm($r(r),t,e),Ds(r,t,e,i,s,o,2)):n===2&&Om(r,t,e,i,s,o):Ds($r(r),t,e,i,s,o,1);break}}}}function Fm(r){var t=r.prev,e=r,i=r.next;if(vt(t,e,i)>=0)return!1;for(var s=t.x,o=e.x,n=i.x,a=t.y,h=e.y,l=i.y,u=s<o?s<n?s:n:o<n?o:n,c=a<h?a<l?a:l:h<l?h:l,d=s>o?s>n?s:n:o>n?o:n,p=a>h?a>l?a:l:h>l?h:l,f=i.next;f!==t;){if(f.x>=u&&f.x<=d&&f.y>=c&&f.y<=p&&wi(s,a,o,h,n,l,f.x,f.y)&&vt(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function Dm(r,t,e,i){var s=r.prev,o=r,n=r.next;if(vt(s,o,n)>=0)return!1;for(var a=s.x,h=o.x,l=n.x,u=s.y,c=o.y,d=n.y,p=a<h?a<l?a:l:h<l?h:l,f=u<c?u<d?u:d:c<d?c:d,m=a>h?a>l?a:l:h>l?h:l,g=u>c?u>d?u:d:c>d?c:d,y=Th(p,f,t,e,i),v=Th(m,g,t,e,i),_=r.prevZ,x=r.nextZ;_&&_.z>=y&&x&&x.z<=v;){if(_.x>=p&&_.x<=m&&_.y>=f&&_.y<=g&&_!==s&&_!==n&&wi(a,u,h,c,l,d,_.x,_.y)&&vt(_.prev,_,_.next)>=0||(_=_.prevZ,x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==s&&x!==n&&wi(a,u,h,c,l,d,x.x,x.y)&&vt(x.prev,x,x.next)>=0))return!1;x=x.nextZ}for(;_&&_.z>=y;){if(_.x>=p&&_.x<=m&&_.y>=f&&_.y<=g&&_!==s&&_!==n&&wi(a,u,h,c,l,d,_.x,_.y)&&vt(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;x&&x.z<=v;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==s&&x!==n&&wi(a,u,h,c,l,d,x.x,x.y)&&vt(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function Lm(r,t,e){var i=r;do{var s=i.prev,o=i.next.next;!xn(s,o)&&uc(s,i,i.next,o)&&Ls(s,o)&&Ls(o,s)&&(t.push(s.i/e|0),t.push(i.i/e|0),t.push(o.i/e|0),Os(i),Os(i.next),i=r=o),i=i.next}while(i!==r);return $r(i)}function Om(r,t,e,i,s,o){var n=r;do{for(var a=n.next.next;a!==n.prev;){if(n.i!==a.i&&zm(n,a)){var h=cc(n,a);n=$r(n,n.next),h=$r(h,h.next),Ds(n,t,e,i,s,o,0),Ds(h,t,e,i,s,o,0);return}a=a.next}n=n.next}while(n!==r)}function Nm(r,t,e,i){var s=[],o,n,a,h,l;for(o=0,n=t.length;o<n;o++)a=t[o]*i,h=o<n-1?t[o+1]*i:r.length,l=lc(r,a,h,i,!1),l===l.next&&(l.steiner=!0),s.push(Wm(l));for(s.sort(km),o=0;o<s.length;o++)e=Um(s[o],e);return e}function km(r,t){return r.x-t.x}function Um(r,t){var e=Gm(r,t);if(!e)return t;var i=cc(e,r);return $r(i,i.next),$r(e,e.next)}function Gm(r,t){var e=t,i=r.x,s=r.y,o=-1/0,n;do{if(s<=e.y&&s>=e.next.y&&e.next.y!==e.y){var a=e.x+(s-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(a<=i&&a>o&&(o=a,n=e.x<e.next.x?e:e.next,a===i))return n}e=e.next}while(e!==t);if(!n)return null;var h=n,l=n.x,u=n.y,c=1/0,d;e=n;do i>=e.x&&e.x>=l&&i!==e.x&&wi(s<u?i:o,s,l,u,s<u?o:i,s,e.x,e.y)&&(d=Math.abs(s-e.y)/(i-e.x),Ls(e,r)&&(d<c||d===c&&(e.x>n.x||e.x===n.x&&Hm(n,e)))&&(n=e,c=d)),e=e.next;while(e!==h);return n}function Hm(r,t){return vt(r.prev,r,t.prev)<0&&vt(t.next,r,r.next)<0}function Vm(r,t,e,i){var s=r;do s.z===0&&(s.z=Th(s.x,s.y,t,e,i)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==r);s.prevZ.nextZ=null,s.prevZ=null,Xm(s)}function Xm(r){var t,e,i,s,o,n,a,h,l=1;do{for(e=r,r=null,o=null,n=0;e;){for(n++,i=e,a=0,t=0;t<l&&(a++,i=i.nextZ,!!i);t++);for(h=l;a>0||h>0&&i;)a!==0&&(h===0||!i||e.z<=i.z)?(s=e,e=e.nextZ,a--):(s=i,i=i.nextZ,h--),o?o.nextZ=s:r=s,s.prevZ=o,o=s;e=i}o.nextZ=null,l*=2}while(n>1);return r}function Th(r,t,e,i,s){return r=(r-e)*s|0,t=(t-i)*s|0,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,r|t<<1}function Wm(r){var t=r,e=r;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==r);return e}function wi(r,t,e,i,s,o,n,a){return(s-n)*(t-a)>=(r-n)*(o-a)&&(r-n)*(i-a)>=(e-n)*(t-a)&&(e-n)*(o-a)>=(s-n)*(i-a)}function zm(r,t){return r.next.i!==t.i&&r.prev.i!==t.i&&!jm(r,t)&&(Ls(r,t)&&Ls(t,r)&&$m(r,t)&&(vt(r.prev,r,t.prev)||vt(r,t.prev,t))||xn(r,t)&&vt(r.prev,r,r.next)>0&&vt(t.prev,t,t.next)>0)}function vt(r,t,e){return(t.y-r.y)*(e.x-t.x)-(t.x-r.x)*(e.y-t.y)}function xn(r,t){return r.x===t.x&&r.y===t.y}function uc(r,t,e,i){var s=yn(vt(r,t,e)),o=yn(vt(r,t,i)),n=yn(vt(e,i,r)),a=yn(vt(e,i,t));return!!(s!==o&&n!==a||s===0&&gn(r,e,t)||o===0&&gn(r,i,t)||n===0&&gn(e,r,i)||a===0&&gn(e,t,i))}function gn(r,t,e){return t.x<=Math.max(r.x,e.x)&&t.x>=Math.min(r.x,e.x)&&t.y<=Math.max(r.y,e.y)&&t.y>=Math.min(r.y,e.y)}function yn(r){return r>0?1:r<0?-1:0}function jm(r,t){var e=r;do{if(e.i!==r.i&&e.next.i!==r.i&&e.i!==t.i&&e.next.i!==t.i&&uc(e,e.next,r,t))return!0;e=e.next}while(e!==r);return!1}function Ls(r,t){return vt(r.prev,r,r.next)<0?vt(r,t,r.next)>=0&&vt(r,r.prev,t)>=0:vt(r,t,r.prev)<0||vt(r,r.next,t)<0}function $m(r,t){var e=r,i=!1,s=(r.x+t.x)/2,o=(r.y+t.y)/2;do e.y>o!=e.next.y>o&&e.next.y!==e.y&&s<(e.next.x-e.x)*(o-e.y)/(e.next.y-e.y)+e.x&&(i=!i),e=e.next;while(e!==r);return i}function cc(r,t){var e=new Eh(r.i,r.x,r.y),i=new Eh(t.i,t.x,t.y),s=r.next,o=t.prev;return r.next=t,t.prev=r,e.next=s,s.prev=e,i.next=e,e.prev=i,o.next=i,i.prev=o,i}function hc(r,t,e,i){var s=new Eh(r,t,e);return i?(s.next=i.next,s.prev=i,i.next.prev=s,i.next=s):(s.prev=s,s.next=s),s}function Os(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Eh(r,t,e){this.i=r,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}_n.deviation=function(r,t,e,i){var s=t&&t.length,o=s?t[0]*e:r.length,n=Math.abs(wh(r,0,o,e));if(s)for(var a=0,h=t.length;a<h;a++){var l=t[a]*e,u=a<h-1?t[a+1]*e:r.length;n-=Math.abs(wh(r,l,u,e))}var c=0;for(a=0;a<i.length;a+=3){var d=i[a]*e,p=i[a+1]*e,f=i[a+2]*e;c+=Math.abs((r[d]-r[f])*(r[p+1]-r[d+1])-(r[d]-r[p])*(r[f+1]-r[d+1]))}return n===0&&c===0?0:Math.abs((c-n)/n)};function wh(r,t,e,i){for(var s=0,o=t,n=e-i;o<e;o+=i)s+=(r[n]-r[o])*(r[o+1]+r[n+1]),n=o;return s}_n.flatten=function(r){for(var t=r[0][0].length,e={vertices:[],holes:[],dimensions:t},i=0,s=0;s<r.length;s++){for(var o=0;o<r[s].length;o++)for(var n=0;n<t;n++)e.vertices.push(r[s][o][n]);s>0&&(i+=r[s-1].length,e.holes.push(i))}return e}});var pc=ft((Si,Ai)=>{(function(r){var t=typeof Si=="object"&&Si&&!Si.nodeType&&Si,e=typeof Ai=="object"&&Ai&&!Ai.nodeType&&Ai,i=typeof global=="object"&&global;(i.global===i||i.window===i||i.self===i)&&(r=i);var s,o=2147483647,n=36,a=1,h=26,l=38,u=700,c=72,d=128,p="-",f=/^xn--/,m=/[^\x20-\x7E]/,g=/[\x2E\u3002\uFF0E\uFF61]/g,y={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},v=n-a,_=Math.floor,x=String.fromCharCode,M;function G(L){throw new RangeError(y[L])}function I(L,j){for(var H=L.length,ht=[];H--;)ht[H]=j(L[H]);return ht}function R(L,j){var H=L.split("@"),ht="";H.length>1&&(ht=H[0]+"@",L=H[1]),L=L.replace(g,".");var yt=L.split("."),Et=I(yt,j).join(".");return ht+Et}function N(L){for(var j=[],H=0,ht=L.length,yt,Et;H<ht;)yt=L.charCodeAt(H++),yt>=55296&&yt<=56319&&H<ht?(Et=L.charCodeAt(H++),(Et&64512)==56320?j.push(((yt&1023)<<10)+(Et&1023)+65536):(j.push(yt),H--)):j.push(yt);return j}function q(L){return I(L,function(j){var H="";return j>65535&&(j-=65536,H+=x(j>>>10&1023|55296),j=56320|j&1023),H+=x(j),H}).join("")}function D(L){return L-48<10?L-22:L-65<26?L-65:L-97<26?L-97:n}function F(L,j){return L+22+75*(L<26)-((j!=0)<<5)}function A(L,j,H){var ht=0;for(L=H?_(L/u):L>>1,L+=_(L/j);L>v*h>>1;ht+=n)L=_(L/v);return _(ht+(v+1)*L/(L+l))}function C(L){var j=[],H=L.length,ht,yt=0,Et=d,_t=c,Wt,ae,Qt,he,At,wt,Ct,zt,Jt;for(Wt=L.lastIndexOf(p),Wt<0&&(Wt=0),ae=0;ae<Wt;++ae)L.charCodeAt(ae)>=128&&G("not-basic"),j.push(L.charCodeAt(ae));for(Qt=Wt>0?Wt+1:0;Qt<H;){for(he=yt,At=1,wt=n;Qt>=H&&G("invalid-input"),Ct=D(L.charCodeAt(Qt++)),(Ct>=n||Ct>_((o-yt)/At))&&G("overflow"),yt+=Ct*At,zt=wt<=_t?a:wt>=_t+h?h:wt-_t,!(Ct<zt);wt+=n)Jt=n-zt,At>_(o/Jt)&&G("overflow"),At*=Jt;ht=j.length+1,_t=A(yt-he,ht,he==0),_(yt/ht)>o-Et&&G("overflow"),Et+=_(yt/ht),yt%=ht,j.splice(yt++,0,Et)}return q(j)}function J(L){var j,H,ht,yt,Et,_t,Wt,ae,Qt,he,At,wt=[],Ct,zt,Jt,Ms;for(L=N(L),Ct=L.length,j=d,H=0,Et=c,_t=0;_t<Ct;++_t)At=L[_t],At<128&&wt.push(x(At));for(ht=yt=wt.length,yt&&wt.push(p);ht<Ct;){for(Wt=o,_t=0;_t<Ct;++_t)At=L[_t],At>=j&&At<Wt&&(Wt=At);for(zt=ht+1,Wt-j>_((o-H)/zt)&&G("overflow"),H+=(Wt-j)*zt,j=Wt,_t=0;_t<Ct;++_t)if(At=L[_t],At<j&&++H>o&&G("overflow"),At==j){for(ae=H,Qt=n;he=Qt<=Et?a:Qt>=Et+h?h:Qt-Et,!(ae<he);Qt+=n)Ms=ae-he,Jt=n-he,wt.push(x(F(he+Ms%Jt,0))),ae=_(Ms/Jt);wt.push(x(F(ae,0))),Et=A(H,zt,ht==yt),H=0,++ht}++H,++j}return wt.join("")}function rt(L){return R(L,function(j){return f.test(j)?C(j.slice(4).toLowerCase()):j})}function X(L){return R(L,function(j){return m.test(j)?"xn--"+J(j):j})}if(s={version:"1.4.1",ucs2:{decode:N,encode:q},decode:C,encode:J,toASCII:X,toUnicode:rt},typeof define=="function"&&typeof define.amd=="object"&&define.amd)define("punycode",function(){return s});else if(t&&e)if(Ai.exports==t)e.exports=s;else for(M in s)s.hasOwnProperty(M)&&(t[M]=s[M]);else r.punycode=s})(Si)});var mc=ft((X0,fc)=>{"use strict";fc.exports=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var t={},e=Symbol("test"),i=Object(e);if(typeof e=="string"||Object.prototype.toString.call(e)!=="[object Symbol]"||Object.prototype.toString.call(i)!=="[object Symbol]")return!1;var s=42;t[e]=s;for(e in t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var o=Object.getOwnPropertySymbols(t);if(o.length!==1||o[0]!==e||!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var n=Object.getOwnPropertyDescriptor(t,e);if(n.value!==s||n.enumerable!==!0)return!1}return!0}});var _c=ft((W0,yc)=>{"use strict";var gc=typeof Symbol<"u"&&Symbol,Ym=mc();yc.exports=function(){return typeof gc!="function"||typeof Symbol!="function"||typeof gc("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:Ym()}});var bc=ft((z0,vc)=>{"use strict";var xc={foo:{}},qm=Object;vc.exports=function(){return{__proto__:xc}.foo===xc.foo&&!({__proto__:null}instanceof qm)}});var wc=ft((j0,Ec)=>{"use strict";var Km="Function.prototype.bind called on incompatible ",Zm=Object.prototype.toString,Qm=Math.max,Jm="[object Function]",Tc=function(t,e){for(var i=[],s=0;s<t.length;s+=1)i[s]=t[s];for(var o=0;o<e.length;o+=1)i[o+t.length]=e[o];return i},tg=function(t,e){for(var i=[],s=e||0,o=0;s<t.length;s+=1,o+=1)i[o]=t[s];return i},eg=function(r,t){for(var e="",i=0;i<r.length;i+=1)e+=r[i],i+1<r.length&&(e+=t);return e};Ec.exports=function(t){var e=this;if(typeof e!="function"||Zm.apply(e)!==Jm)throw new TypeError(Km+e);for(var i=tg(arguments,1),s,o=function(){if(this instanceof s){var u=e.apply(this,Tc(i,arguments));return Object(u)===u?u:this}return e.apply(t,Tc(i,arguments))},n=Qm(0,e.length-i.length),a=[],h=0;h<n;h++)a[h]="$"+h;if(s=Function("binder","return function ("+eg(a,",")+"){ return binder.apply(this,arguments); }")(o),e.prototype){var l=function(){};l.prototype=e.prototype,s.prototype=new l,l.prototype=null}return s}});var vn=ft(($0,Sc)=>{"use strict";var rg=wc();Sc.exports=Function.prototype.bind||rg});var Cc=ft((Y0,Ac)=>{"use strict";var ig=Function.prototype.call,sg=Object.prototype.hasOwnProperty,og=vn();Ac.exports=og.call(ig,sg)});var wr=ft((q0,Bc)=>{"use strict";var it,Ri=SyntaxError,Mc=Function,Ii=TypeError,Ah=function(r){try{return Mc('"use strict"; return ('+r+").constructor;")()}catch{}},Yr=Object.getOwnPropertyDescriptor;if(Yr)try{Yr({},"")}catch{Yr=null}var Ch=function(){throw new Ii},ng=Yr?function(){try{return arguments.callee,Ch}catch{try{return Yr(arguments,"callee").get}catch{return Ch}}}():Ch,Ci=_c()(),ag=bc()(),Pt=Object.getPrototypeOf||(ag?function(r){return r.__proto__}:null),Pi={},hg=typeof Uint8Array>"u"||!Pt?it:Pt(Uint8Array),qr={"%AggregateError%":typeof AggregateError>"u"?it:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?it:ArrayBuffer,"%ArrayIteratorPrototype%":Ci&&Pt?Pt([][Symbol.iterator]()):it,"%AsyncFromSyncIteratorPrototype%":it,"%AsyncFunction%":Pi,"%AsyncGenerator%":Pi,"%AsyncGeneratorFunction%":Pi,"%AsyncIteratorPrototype%":Pi,"%Atomics%":typeof Atomics>"u"?it:Atomics,"%BigInt%":typeof BigInt>"u"?it:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?it:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?it:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?it:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":typeof Float32Array>"u"?it:Float32Array,"%Float64Array%":typeof Float64Array>"u"?it:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?it:FinalizationRegistry,"%Function%":Mc,"%GeneratorFunction%":Pi,"%Int8Array%":typeof Int8Array>"u"?it:Int8Array,"%Int16Array%":typeof Int16Array>"u"?it:Int16Array,"%Int32Array%":typeof Int32Array>"u"?it:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":Ci&&Pt?Pt(Pt([][Symbol.iterator]())):it,"%JSON%":typeof JSON=="object"?JSON:it,"%Map%":typeof Map>"u"?it:Map,"%MapIteratorPrototype%":typeof Map>"u"||!Ci||!Pt?it:Pt(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?it:Promise,"%Proxy%":typeof Proxy>"u"?it:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":typeof Reflect>"u"?it:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?it:Set,"%SetIteratorPrototype%":typeof Set>"u"||!Ci||!Pt?it:Pt(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?it:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":Ci&&Pt?Pt(""[Symbol.iterator]()):it,"%Symbol%":Ci?Symbol:it,"%SyntaxError%":Ri,"%ThrowTypeError%":ng,"%TypedArray%":hg,"%TypeError%":Ii,"%Uint8Array%":typeof Uint8Array>"u"?it:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?it:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?it:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?it:Uint32Array,"%URIError%":URIError,"%WeakMap%":typeof WeakMap>"u"?it:WeakMap,"%WeakRef%":typeof WeakRef>"u"?it:WeakRef,"%WeakSet%":typeof WeakSet>"u"?it:WeakSet};if(Pt)try{null.error}catch(r){Pc=Pt(Pt(r)),qr["%Error.prototype%"]=Pc}var Pc,lg=function r(t){var e;if(t==="%AsyncFunction%")e=Ah("async function () {}");else if(t==="%GeneratorFunction%")e=Ah("function* () {}");else if(t==="%AsyncGeneratorFunction%")e=Ah("async function* () {}");else if(t==="%AsyncGenerator%"){var i=r("%AsyncGeneratorFunction%");i&&(e=i.prototype)}else if(t==="%AsyncIteratorPrototype%"){var s=r("%AsyncGenerator%");s&&Pt&&(e=Pt(s.prototype))}return qr[t]=e,e},Ic={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Ns=vn(),bn=Cc(),ug=Ns.call(Function.call,Array.prototype.concat),cg=Ns.call(Function.apply,Array.prototype.splice),Rc=Ns.call(Function.call,String.prototype.replace),Tn=Ns.call(Function.call,String.prototype.slice),dg=Ns.call(Function.call,RegExp.prototype.exec),pg=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,fg=/\\(\\)?/g,mg=function(t){var e=Tn(t,0,1),i=Tn(t,-1);if(e==="%"&&i!=="%")throw new Ri("invalid intrinsic syntax, expected closing `%`");if(i==="%"&&e!=="%")throw new Ri("invalid intrinsic syntax, expected opening `%`");var s=[];return Rc(t,pg,function(o,n,a,h){s[s.length]=a?Rc(h,fg,"$1"):n||o}),s},gg=function(t,e){var i=t,s;if(bn(Ic,i)&&(s=Ic[i],i="%"+s[0]+"%"),bn(qr,i)){var o=qr[i];if(o===Pi&&(o=lg(i)),typeof o>"u"&&!e)throw new Ii("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:s,name:i,value:o}}throw new Ri("intrinsic "+t+" does not exist!")};Bc.exports=function(t,e){if(typeof t!="string"||t.length===0)throw new Ii("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof e!="boolean")throw new Ii('"allowMissing" argument must be a boolean');if(dg(/^%?[^%]*%?$/,t)===null)throw new Ri("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var i=mg(t),s=i.length>0?i[0]:"",o=gg("%"+s+"%",e),n=o.name,a=o.value,h=!1,l=o.alias;l&&(s=l[0],cg(i,ug([0,1],l)));for(var u=1,c=!0;u<i.length;u+=1){var d=i[u],p=Tn(d,0,1),f=Tn(d,-1);if((p==='"'||p==="'"||p==="`"||f==='"'||f==="'"||f==="`")&&p!==f)throw new Ri("property names with quotes must have matching quotes");if((d==="constructor"||!c)&&(h=!0),s+="."+d,n="%"+s+"%",bn(qr,n))a=qr[n];else if(a!=null){if(!(d in a)){if(!e)throw new Ii("base intrinsic for "+t+" exists, but the property is not available.");return}if(Yr&&u+1>=i.length){var m=Yr(a,d);c=!!m,c&&"get"in m&&!("originalValue"in m.get)?a=m.get:a=a[d]}else c=bn(a,d),a=a[d];c&&!h&&(qr[n]=a)}}return a}});var Rh=ft((K0,Fc)=>{"use strict";var yg=wr(),Ph=yg("%Object.defineProperty%",!0),Ih=function(){if(Ph)try{return Ph({},"a",{value:1}),!0}catch{return!1}return!1};Ih.hasArrayLengthDefineBug=function(){if(!Ih())return null;try{return Ph([],"length",{value:1}).length!==1}catch{return!0}};Fc.exports=Ih});var Mh=ft((Z0,Dc)=>{"use strict";var _g=wr(),En=_g("%Object.getOwnPropertyDescriptor%",!0);if(En)try{En([],"length")}catch{En=null}Dc.exports=En});var Nc=ft((Q0,Oc)=>{"use strict";var xg=Rh()(),Bh=wr(),ks=xg&&Bh("%Object.defineProperty%",!0);if(ks)try{ks({},"a",{value:1})}catch{ks=!1}var vg=Bh("%SyntaxError%"),Mi=Bh("%TypeError%"),Lc=Mh();Oc.exports=function(t,e,i){if(!t||typeof t!="object"&&typeof t!="function")throw new Mi("`obj` must be an object or a function`");if(typeof e!="string"&&typeof e!="symbol")throw new Mi("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new Mi("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new Mi("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new Mi("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new Mi("`loose`, if provided, must be a boolean");var s=arguments.length>3?arguments[3]:null,o=arguments.length>4?arguments[4]:null,n=arguments.length>5?arguments[5]:null,a=arguments.length>6?arguments[6]:!1,h=!!Lc&&Lc(t,e);if(ks)ks(t,e,{configurable:n===null&&h?h.configurable:!n,enumerable:s===null&&h?h.enumerable:!s,value:i,writable:o===null&&h?h.writable:!o});else if(a||!s&&!o&&!n)t[e]=i;else throw new vg("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")}});var Xc=ft((J0,Vc)=>{"use strict";var Hc=wr(),kc=Nc(),bg=Rh()(),Uc=Mh(),Gc=Hc("%TypeError%"),Tg=Hc("%Math.floor%");Vc.exports=function(t,e){if(typeof t!="function")throw new Gc("`fn` is not a function");if(typeof e!="number"||e<0||e>4294967295||Tg(e)!==e)throw new Gc("`length` must be a positive 32-bit integer");var i=arguments.length>2&&!!arguments[2],s=!0,o=!0;if("length"in t&&Uc){var n=Uc(t,"length");n&&!n.configurable&&(s=!1),n&&!n.writable&&(o=!1)}return(s||o||!i)&&(bg?kc(t,"length",e,!0,!0):kc(t,"length",e)),t}});var Yc=ft((tv,wn)=>{"use strict";var Fh=vn(),Bi=wr(),Eg=Xc(),wg=Bi("%TypeError%"),zc=Bi("%Function.prototype.apply%"),jc=Bi("%Function.prototype.call%"),$c=Bi("%Reflect.apply%",!0)||Fh.call(jc,zc),Us=Bi("%Object.defineProperty%",!0),Sg=Bi("%Math.max%");if(Us)try{Us({},"a",{value:1})}catch{Us=null}wn.exports=function(t){if(typeof t!="function")throw new wg("a function is required");var e=$c(Fh,jc,arguments);return Eg(e,1+Sg(0,t.length-(arguments.length-1)),!0)};var Wc=function(){return $c(Fh,zc,arguments)};Us?Us(wn.exports,"apply",{value:Wc}):wn.exports.apply=Wc});var Qc=ft((ev,Zc)=>{"use strict";var qc=wr(),Kc=Yc(),Ag=Kc(qc("String.prototype.indexOf"));Zc.exports=function(t,e){var i=qc(t,!!e);return typeof i=="function"&&Ag(t,".prototype.")>-1?Kc(i):i}});var Jc=ft(()=>{});var xd=ft((sv,_d)=>{var Xh=typeof Map=="function"&&Map.prototype,Dh=Object.getOwnPropertyDescriptor&&Xh?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,An=Xh&&Dh&&typeof Dh.get=="function"?Dh.get:null,td=Xh&&Map.prototype.forEach,Wh=typeof Set=="function"&&Set.prototype,Lh=Object.getOwnPropertyDescriptor&&Wh?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,Cn=Wh&&Lh&&typeof Lh.get=="function"?Lh.get:null,ed=Wh&&Set.prototype.forEach,Cg=typeof WeakMap=="function"&&WeakMap.prototype,Hs=Cg?WeakMap.prototype.has:null,Pg=typeof WeakSet=="function"&&WeakSet.prototype,Vs=Pg?WeakSet.prototype.has:null,Ig=typeof WeakRef=="function"&&WeakRef.prototype,rd=Ig?WeakRef.prototype.deref:null,Rg=Boolean.prototype.valueOf,Mg=Object.prototype.toString,Bg=Function.prototype.toString,Fg=String.prototype.match,zh=String.prototype.slice,Ar=String.prototype.replace,Dg=String.prototype.toUpperCase,id=String.prototype.toLowerCase,dd=RegExp.prototype.test,sd=Array.prototype.concat,Ye=Array.prototype.join,Lg=Array.prototype.slice,od=Math.floor,kh=typeof BigInt=="function"?BigInt.prototype.valueOf:null,Oh=Object.getOwnPropertySymbols,Uh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,Fi=typeof Symbol=="function"&&typeof Symbol.iterator=="object",$t=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===Fi||!0)?Symbol.toStringTag:null,pd=Object.prototype.propertyIsEnumerable,nd=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(r){return r.__proto__}:null);function ad(r,t){if(r===1/0||r===-1/0||r!==r||r&&r>-1e3&&r<1e3||dd.call(/e/,t))return t;var e=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof r=="number"){var i=r<0?-od(-r):od(r);if(i!==r){var s=String(i),o=zh.call(t,s.length+1);return Ar.call(s,e,"$&_")+"."+Ar.call(Ar.call(o,/([0-9]{3})/g,"$&_"),/_$/,"")}}return Ar.call(t,e,"$&_")}var Gh=Jc(),hd=Gh.custom,ld=md(hd)?hd:null;_d.exports=function r(t,e,i,s){var o=e||{};if(Sr(o,"quoteStyle")&&o.quoteStyle!=="single"&&o.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Sr(o,"maxStringLength")&&(typeof o.maxStringLength=="number"?o.maxStringLength<0&&o.maxStringLength!==1/0:o.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var n=Sr(o,"customInspect")?o.customInspect:!0;if(typeof n!="boolean"&&n!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Sr(o,"indent")&&o.indent!==null&&o.indent!=="	"&&!(parseInt(o.indent,10)===o.indent&&o.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Sr(o,"numericSeparator")&&typeof o.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var a=o.numericSeparator;if(typeof t>"u")return"undefined";if(t===null)return"null";if(typeof t=="boolean")return t?"true":"false";if(typeof t=="string")return yd(t,o);if(typeof t=="number"){if(t===0)return 1/0/t>0?"0":"-0";var h=String(t);return a?ad(t,h):h}if(typeof t=="bigint"){var l=String(t)+"n";return a?ad(t,l):l}var u=typeof o.depth>"u"?5:o.depth;if(typeof i>"u"&&(i=0),i>=u&&u>0&&typeof t=="object")return Hh(t)?"[Array]":"[Object]";var c=Jg(o,i);if(typeof s>"u")s=[];else if(gd(s,t)>=0)return"[Circular]";function d(A,C,J){if(C&&(s=Lg.call(s),s.push(C)),J){var rt={depth:o.depth};return Sr(o,"quoteStyle")&&(rt.quoteStyle=o.quoteStyle),r(A,rt,i+1,s)}return r(A,o,i+1,s)}if(typeof t=="function"&&!ud(t)){var p=Wg(t),f=Sn(t,d);return"[Function"+(p?": "+p:" (anonymous)")+"]"+(f.length>0?" { "+Ye.call(f,", ")+" }":"")}if(md(t)){var m=Fi?Ar.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):Uh.call(t);return typeof t=="object"&&!Fi?Gs(m):m}if(Kg(t)){for(var g="<"+id.call(String(t.nodeName)),y=t.attributes||[],v=0;v<y.length;v++)g+=" "+y[v].name+"="+fd(Og(y[v].value),"double",o);return g+=">",t.childNodes&&t.childNodes.length&&(g+="..."),g+="</"+id.call(String(t.nodeName))+">",g}if(Hh(t)){if(t.length===0)return"[]";var _=Sn(t,d);return c&&!Qg(_)?"["+Vh(_,c)+"]":"[ "+Ye.call(_,", ")+" ]"}if(kg(t)){var x=Sn(t,d);return!("cause"in Error.prototype)&&"cause"in t&&!pd.call(t,"cause")?"{ ["+String(t)+"] "+Ye.call(sd.call("[cause]: "+d(t.cause),x),", ")+" }":x.length===0?"["+String(t)+"]":"{ ["+String(t)+"] "+Ye.call(x,", ")+" }"}if(typeof t=="object"&&n){if(ld&&typeof t[ld]=="function"&&Gh)return Gh(t,{depth:u-i});if(n!=="symbol"&&typeof t.inspect=="function")return t.inspect()}if(zg(t)){var M=[];return td&&td.call(t,function(A,C){M.push(d(C,t,!0)+" => "+d(A,t))}),cd("Map",An.call(t),M,c)}if(Yg(t)){var G=[];return ed&&ed.call(t,function(A){G.push(d(A,t))}),cd("Set",Cn.call(t),G,c)}if(jg(t))return Nh("WeakMap");if(qg(t))return Nh("WeakSet");if($g(t))return Nh("WeakRef");if(Gg(t))return Gs(d(Number(t)));if(Vg(t))return Gs(d(kh.call(t)));if(Hg(t))return Gs(Rg.call(t));if(Ug(t))return Gs(d(String(t)));if(typeof window<"u"&&t===window)return"{ [object Window] }";if(t===global)return"{ [object globalThis] }";if(!Ng(t)&&!ud(t)){var I=Sn(t,d),R=nd?nd(t)===Object.prototype:t instanceof Object||t.constructor===Object,N=t instanceof Object?"":"null prototype",q=!R&&$t&&Object(t)===t&&$t in t?zh.call(Cr(t),8,-1):N?"Object":"",D=R||typeof t.constructor!="function"?"":t.constructor.name?t.constructor.name+" ":"",F=D+(q||N?"["+Ye.call(sd.call([],q||[],N||[]),": ")+"] ":"");return I.length===0?F+"{}":c?F+"{"+Vh(I,c)+"}":F+"{ "+Ye.call(I,", ")+" }"}return String(t)};function fd(r,t,e){var i=(e.quoteStyle||t)==="double"?'"':"'";return i+r+i}function Og(r){return Ar.call(String(r),/"/g,"&quot;")}function Hh(r){return Cr(r)==="[object Array]"&&(!$t||!(typeof r=="object"&&$t in r))}function Ng(r){return Cr(r)==="[object Date]"&&(!$t||!(typeof r=="object"&&$t in r))}function ud(r){return Cr(r)==="[object RegExp]"&&(!$t||!(typeof r=="object"&&$t in r))}function kg(r){return Cr(r)==="[object Error]"&&(!$t||!(typeof r=="object"&&$t in r))}function Ug(r){return Cr(r)==="[object String]"&&(!$t||!(typeof r=="object"&&$t in r))}function Gg(r){return Cr(r)==="[object Number]"&&(!$t||!(typeof r=="object"&&$t in r))}function Hg(r){return Cr(r)==="[object Boolean]"&&(!$t||!(typeof r=="object"&&$t in r))}function md(r){if(Fi)return r&&typeof r=="object"&&r instanceof Symbol;if(typeof r=="symbol")return!0;if(!r||typeof r!="object"||!Uh)return!1;try{return Uh.call(r),!0}catch{}return!1}function Vg(r){if(!r||typeof r!="object"||!kh)return!1;try{return kh.call(r),!0}catch{}return!1}var Xg=Object.prototype.hasOwnProperty||function(r){return r in this};function Sr(r,t){return Xg.call(r,t)}function Cr(r){return Mg.call(r)}function Wg(r){if(r.name)return r.name;var t=Fg.call(Bg.call(r),/^function\s*([\w$]+)/);return t?t[1]:null}function gd(r,t){if(r.indexOf)return r.indexOf(t);for(var e=0,i=r.length;e<i;e++)if(r[e]===t)return e;return-1}function zg(r){if(!An||!r||typeof r!="object")return!1;try{An.call(r);try{Cn.call(r)}catch{return!0}return r instanceof Map}catch{}return!1}function jg(r){if(!Hs||!r||typeof r!="object")return!1;try{Hs.call(r,Hs);try{Vs.call(r,Vs)}catch{return!0}return r instanceof WeakMap}catch{}return!1}function $g(r){if(!rd||!r||typeof r!="object")return!1;try{return rd.call(r),!0}catch{}return!1}function Yg(r){if(!Cn||!r||typeof r!="object")return!1;try{Cn.call(r);try{An.call(r)}catch{return!0}return r instanceof Set}catch{}return!1}function qg(r){if(!Vs||!r||typeof r!="object")return!1;try{Vs.call(r,Vs);try{Hs.call(r,Hs)}catch{return!0}return r instanceof WeakSet}catch{}return!1}function Kg(r){return!r||typeof r!="object"?!1:typeof HTMLElement<"u"&&r instanceof HTMLElement?!0:typeof r.nodeName=="string"&&typeof r.getAttribute=="function"}function yd(r,t){if(r.length>t.maxStringLength){var e=r.length-t.maxStringLength,i="... "+e+" more character"+(e>1?"s":"");return yd(zh.call(r,0,t.maxStringLength),t)+i}var s=Ar.call(Ar.call(r,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,Zg);return fd(s,"single",t)}function Zg(r){var t=r.charCodeAt(0),e={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return e?"\\"+e:"\\x"+(t<16?"0":"")+Dg.call(t.toString(16))}function Gs(r){return"Object("+r+")"}function Nh(r){return r+" { ? }"}function cd(r,t,e,i){var s=i?Vh(e,i):Ye.call(e,", ");return r+" ("+t+") {"+s+"}"}function Qg(r){for(var t=0;t<r.length;t++)if(gd(r[t],`
`)>=0)return!1;return!0}function Jg(r,t){var e;if(r.indent==="	")e="	";else if(typeof r.indent=="number"&&r.indent>0)e=Ye.call(Array(r.indent+1)," ");else return null;return{base:e,prev:Ye.call(Array(t+1),e)}}function Vh(r,t){if(r.length===0)return"";var e=`
`+t.prev+t.base;return e+Ye.call(r,","+e)+`
`+t.prev}function Sn(r,t){var e=Hh(r),i=[];if(e){i.length=r.length;for(var s=0;s<r.length;s++)i[s]=Sr(r,s)?t(r[s],r):""}var o=typeof Oh=="function"?Oh(r):[],n;if(Fi){n={};for(var a=0;a<o.length;a++)n["$"+o[a]]=o[a]}for(var h in r)Sr(r,h)&&(e&&String(Number(h))===h&&h<r.length||Fi&&n["$"+h]instanceof Symbol||(dd.call(/[^\w$]/,h)?i.push(t(h,r)+": "+t(r[h],r)):i.push(h+": "+t(r[h],r))));if(typeof Oh=="function")for(var l=0;l<o.length;l++)pd.call(r,o[l])&&i.push("["+t(o[l])+"]: "+t(r[o[l]],r));return i}});var bd=ft((ov,vd)=>{"use strict";var jh=wr(),Di=Qc(),ty=xd(),ey=jh("%TypeError%"),Pn=jh("%WeakMap%",!0),In=jh("%Map%",!0),ry=Di("WeakMap.prototype.get",!0),iy=Di("WeakMap.prototype.set",!0),sy=Di("WeakMap.prototype.has",!0),oy=Di("Map.prototype.get",!0),ny=Di("Map.prototype.set",!0),ay=Di("Map.prototype.has",!0),$h=function(r,t){for(var e=r,i;(i=e.next)!==null;e=i)if(i.key===t)return e.next=i.next,i.next=r.next,r.next=i,i},hy=function(r,t){var e=$h(r,t);return e&&e.value},ly=function(r,t,e){var i=$h(r,t);i?i.value=e:r.next={key:t,next:r.next,value:e}},uy=function(r,t){return!!$h(r,t)};vd.exports=function(){var t,e,i,s={assert:function(o){if(!s.has(o))throw new ey("Side channel does not contain "+ty(o))},get:function(o){if(Pn&&o&&(typeof o=="object"||typeof o=="function")){if(t)return ry(t,o)}else if(In){if(e)return oy(e,o)}else if(i)return hy(i,o)},has:function(o){if(Pn&&o&&(typeof o=="object"||typeof o=="function")){if(t)return sy(t,o)}else if(In){if(e)return ay(e,o)}else if(i)return uy(i,o);return!1},set:function(o,n){Pn&&o&&(typeof o=="object"||typeof o=="function")?(t||(t=new Pn),iy(t,o,n)):In?(e||(e=new In),ny(e,o,n)):(i||(i={key:{},next:null}),ly(i,o,n))}};return s}});var Rn=ft((nv,Td)=>{"use strict";var cy=String.prototype.replace,dy=/%20/g,Yh={RFC1738:"RFC1738",RFC3986:"RFC3986"};Td.exports={default:Yh.RFC3986,formatters:{RFC1738:function(r){return cy.call(r,dy,"+")},RFC3986:function(r){return String(r)}},RFC1738:Yh.RFC1738,RFC3986:Yh.RFC3986}});var Kh=ft((av,wd)=>{"use strict";var py=Rn(),qh=Object.prototype.hasOwnProperty,Kr=Array.isArray,qe=function(){for(var r=[],t=0;t<256;++t)r.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return r}(),fy=function(t){for(;t.length>1;){var e=t.pop(),i=e.obj[e.prop];if(Kr(i)){for(var s=[],o=0;o<i.length;++o)typeof i[o]<"u"&&s.push(i[o]);e.obj[e.prop]=s}}},Ed=function(t,e){for(var i=e&&e.plainObjects?Object.create(null):{},s=0;s<t.length;++s)typeof t[s]<"u"&&(i[s]=t[s]);return i},my=function r(t,e,i){if(!e)return t;if(typeof e!="object"){if(Kr(t))t.push(e);else if(t&&typeof t=="object")(i&&(i.plainObjects||i.allowPrototypes)||!qh.call(Object.prototype,e))&&(t[e]=!0);else return[t,e];return t}if(!t||typeof t!="object")return[t].concat(e);var s=t;return Kr(t)&&!Kr(e)&&(s=Ed(t,i)),Kr(t)&&Kr(e)?(e.forEach(function(o,n){if(qh.call(t,n)){var a=t[n];a&&typeof a=="object"&&o&&typeof o=="object"?t[n]=r(a,o,i):t.push(o)}else t[n]=o}),t):Object.keys(e).reduce(function(o,n){var a=e[n];return qh.call(o,n)?o[n]=r(o[n],a,i):o[n]=a,o},s)},gy=function(t,e){return Object.keys(e).reduce(function(i,s){return i[s]=e[s],i},t)},yy=function(r,t,e){var i=r.replace(/\+/g," ");if(e==="iso-8859-1")return i.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(i)}catch{return i}},_y=function(t,e,i,s,o){if(t.length===0)return t;var n=t;if(typeof t=="symbol"?n=Symbol.prototype.toString.call(t):typeof t!="string"&&(n=String(t)),i==="iso-8859-1")return escape(n).replace(/%u[0-9a-f]{4}/gi,function(u){return"%26%23"+parseInt(u.slice(2),16)+"%3B"});for(var a="",h=0;h<n.length;++h){var l=n.charCodeAt(h);if(l===45||l===46||l===95||l===126||l>=48&&l<=57||l>=65&&l<=90||l>=97&&l<=122||o===py.RFC1738&&(l===40||l===41)){a+=n.charAt(h);continue}if(l<128){a=a+qe[l];continue}if(l<2048){a=a+(qe[192|l>>6]+qe[128|l&63]);continue}if(l<55296||l>=57344){a=a+(qe[224|l>>12]+qe[128|l>>6&63]+qe[128|l&63]);continue}h+=1,l=65536+((l&1023)<<10|n.charCodeAt(h)&1023),a+=qe[240|l>>18]+qe[128|l>>12&63]+qe[128|l>>6&63]+qe[128|l&63]}return a},xy=function(t){for(var e=[{obj:{o:t},prop:"o"}],i=[],s=0;s<e.length;++s)for(var o=e[s],n=o.obj[o.prop],a=Object.keys(n),h=0;h<a.length;++h){var l=a[h],u=n[l];typeof u=="object"&&u!==null&&i.indexOf(u)===-1&&(e.push({obj:n,prop:l}),i.push(u))}return fy(e),t},vy=function(t){return Object.prototype.toString.call(t)==="[object RegExp]"},by=function(t){return!t||typeof t!="object"?!1:!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))},Ty=function(t,e){return[].concat(t,e)},Ey=function(t,e){if(Kr(t)){for(var i=[],s=0;s<t.length;s+=1)i.push(e(t[s]));return i}return e(t)};wd.exports={arrayToObject:Ed,assign:gy,combine:Ty,compact:xy,decode:yy,encode:_y,isBuffer:by,isRegExp:vy,maybeMap:Ey,merge:my}});var Rd=ft((hv,Id)=>{"use strict";var Cd=bd(),Mn=Kh(),Xs=Rn(),wy=Object.prototype.hasOwnProperty,Sd={brackets:function(t){return t+"[]"},comma:"comma",indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},ur=Array.isArray,Sy=Array.prototype.push,Pd=function(r,t){Sy.apply(r,ur(t)?t:[t])},Ay=Date.prototype.toISOString,Ad=Xs.default,Yt={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:Mn.encode,encodeValuesOnly:!1,format:Ad,formatter:Xs.formatters[Ad],indices:!1,serializeDate:function(t){return Ay.call(t)},skipNulls:!1,strictNullHandling:!1},Cy=function(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||typeof t=="symbol"||typeof t=="bigint"},Zh={},Py=function r(t,e,i,s,o,n,a,h,l,u,c,d,p,f,m,g){for(var y=t,v=g,_=0,x=!1;(v=v.get(Zh))!==void 0&&!x;){var M=v.get(t);if(_+=1,typeof M<"u"){if(M===_)throw new RangeError("Cyclic object value");x=!0}typeof v.get(Zh)>"u"&&(_=0)}if(typeof h=="function"?y=h(e,y):y instanceof Date?y=c(y):i==="comma"&&ur(y)&&(y=Mn.maybeMap(y,function(rt){return rt instanceof Date?c(rt):rt})),y===null){if(o)return a&&!f?a(e,Yt.encoder,m,"key",d):e;y=""}if(Cy(y)||Mn.isBuffer(y)){if(a){var G=f?e:a(e,Yt.encoder,m,"key",d);return[p(G)+"="+p(a(y,Yt.encoder,m,"value",d))]}return[p(e)+"="+p(String(y))]}var I=[];if(typeof y>"u")return I;var R;if(i==="comma"&&ur(y))f&&a&&(y=Mn.maybeMap(y,a)),R=[{value:y.length>0?y.join(",")||null:void 0}];else if(ur(h))R=h;else{var N=Object.keys(y);R=l?N.sort(l):N}for(var q=s&&ur(y)&&y.length===1?e+"[]":e,D=0;D<R.length;++D){var F=R[D],A=typeof F=="object"&&typeof F.value<"u"?F.value:y[F];if(!(n&&A===null)){var C=ur(y)?typeof i=="function"?i(q,F):q:q+(u?"."+F:"["+F+"]");g.set(t,_);var J=Cd();J.set(Zh,g),Pd(I,r(A,C,i,s,o,n,i==="comma"&&f&&ur(y)?null:a,h,l,u,c,d,p,f,m,J))}}return I},Iy=function(t){if(!t)return Yt;if(t.encoder!==null&&typeof t.encoder<"u"&&typeof t.encoder!="function")throw new TypeError("Encoder has to be a function.");var e=t.charset||Yt.charset;if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var i=Xs.default;if(typeof t.format<"u"){if(!wy.call(Xs.formatters,t.format))throw new TypeError("Unknown format option provided.");i=t.format}var s=Xs.formatters[i],o=Yt.filter;return(typeof t.filter=="function"||ur(t.filter))&&(o=t.filter),{addQueryPrefix:typeof t.addQueryPrefix=="boolean"?t.addQueryPrefix:Yt.addQueryPrefix,allowDots:typeof t.allowDots>"u"?Yt.allowDots:!!t.allowDots,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:Yt.charsetSentinel,delimiter:typeof t.delimiter>"u"?Yt.delimiter:t.delimiter,encode:typeof t.encode=="boolean"?t.encode:Yt.encode,encoder:typeof t.encoder=="function"?t.encoder:Yt.encoder,encodeValuesOnly:typeof t.encodeValuesOnly=="boolean"?t.encodeValuesOnly:Yt.encodeValuesOnly,filter:o,format:i,formatter:s,serializeDate:typeof t.serializeDate=="function"?t.serializeDate:Yt.serializeDate,skipNulls:typeof t.skipNulls=="boolean"?t.skipNulls:Yt.skipNulls,sort:typeof t.sort=="function"?t.sort:null,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:Yt.strictNullHandling}};Id.exports=function(r,t){var e=r,i=Iy(t),s,o;typeof i.filter=="function"?(o=i.filter,e=o("",e)):ur(i.filter)&&(o=i.filter,s=o);var n=[];if(typeof e!="object"||e===null)return"";var a;t&&t.arrayFormat in Sd?a=t.arrayFormat:t&&"indices"in t?a=t.indices?"indices":"repeat":a="indices";var h=Sd[a];if(t&&"commaRoundTrip"in t&&typeof t.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var l=h==="comma"&&t&&t.commaRoundTrip;s||(s=Object.keys(e)),i.sort&&s.sort(i.sort);for(var u=Cd(),c=0;c<s.length;++c){var d=s[c];i.skipNulls&&e[d]===null||Pd(n,Py(e[d],d,h,l,i.strictNullHandling,i.skipNulls,i.encode?i.encoder:null,i.filter,i.sort,i.allowDots,i.serializeDate,i.format,i.formatter,i.encodeValuesOnly,i.charset,u))}var p=n.join(i.delimiter),f=i.addQueryPrefix===!0?"?":"";return i.charsetSentinel&&(i.charset==="iso-8859-1"?f+="utf8=%26%2310003%3B&":f+="utf8=%E2%9C%93&"),p.length>0?f+p:""}});var Fd=ft((lv,Bd)=>{"use strict";var Li=Kh(),Qh=Object.prototype.hasOwnProperty,Ry=Array.isArray,It={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:Li.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},My=function(r){return r.replace(/&#(\d+);/g,function(t,e){return String.fromCharCode(parseInt(e,10))})},Md=function(r,t){return r&&typeof r=="string"&&t.comma&&r.indexOf(",")>-1?r.split(","):r},By="utf8=%26%2310003%3B",Fy="utf8=%E2%9C%93",Dy=function(t,e){var i={__proto__:null},s=e.ignoreQueryPrefix?t.replace(/^\?/,""):t,o=e.parameterLimit===1/0?void 0:e.parameterLimit,n=s.split(e.delimiter,o),a=-1,h,l=e.charset;if(e.charsetSentinel)for(h=0;h<n.length;++h)n[h].indexOf("utf8=")===0&&(n[h]===Fy?l="utf-8":n[h]===By&&(l="iso-8859-1"),a=h,h=n.length);for(h=0;h<n.length;++h)if(h!==a){var u=n[h],c=u.indexOf("]="),d=c===-1?u.indexOf("="):c+1,p,f;d===-1?(p=e.decoder(u,It.decoder,l,"key"),f=e.strictNullHandling?null:""):(p=e.decoder(u.slice(0,d),It.decoder,l,"key"),f=Li.maybeMap(Md(u.slice(d+1),e),function(m){return e.decoder(m,It.decoder,l,"value")})),f&&e.interpretNumericEntities&&l==="iso-8859-1"&&(f=My(f)),u.indexOf("[]=")>-1&&(f=Ry(f)?[f]:f),Qh.call(i,p)?i[p]=Li.combine(i[p],f):i[p]=f}return i},Ly=function(r,t,e,i){for(var s=i?t:Md(t,e),o=r.length-1;o>=0;--o){var n,a=r[o];if(a==="[]"&&e.parseArrays)n=[].concat(s);else{n=e.plainObjects?Object.create(null):{};var h=a.charAt(0)==="["&&a.charAt(a.length-1)==="]"?a.slice(1,-1):a,l=parseInt(h,10);!e.parseArrays&&h===""?n={0:s}:!isNaN(l)&&a!==h&&String(l)===h&&l>=0&&e.parseArrays&&l<=e.arrayLimit?(n=[],n[l]=s):h!=="__proto__"&&(n[h]=s)}s=n}return s},Oy=function(t,e,i,s){if(t){var o=i.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,n=/(\[[^[\]]*])/,a=/(\[[^[\]]*])/g,h=i.depth>0&&n.exec(o),l=h?o.slice(0,h.index):o,u=[];if(l){if(!i.plainObjects&&Qh.call(Object.prototype,l)&&!i.allowPrototypes)return;u.push(l)}for(var c=0;i.depth>0&&(h=a.exec(o))!==null&&c<i.depth;){if(c+=1,!i.plainObjects&&Qh.call(Object.prototype,h[1].slice(1,-1))&&!i.allowPrototypes)return;u.push(h[1])}return h&&u.push("["+o.slice(h.index)+"]"),Ly(u,e,i,s)}},Ny=function(t){if(!t)return It;if(t.decoder!==null&&t.decoder!==void 0&&typeof t.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var e=typeof t.charset>"u"?It.charset:t.charset;return{allowDots:typeof t.allowDots>"u"?It.allowDots:!!t.allowDots,allowPrototypes:typeof t.allowPrototypes=="boolean"?t.allowPrototypes:It.allowPrototypes,allowSparse:typeof t.allowSparse=="boolean"?t.allowSparse:It.allowSparse,arrayLimit:typeof t.arrayLimit=="number"?t.arrayLimit:It.arrayLimit,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:It.charsetSentinel,comma:typeof t.comma=="boolean"?t.comma:It.comma,decoder:typeof t.decoder=="function"?t.decoder:It.decoder,delimiter:typeof t.delimiter=="string"||Li.isRegExp(t.delimiter)?t.delimiter:It.delimiter,depth:typeof t.depth=="number"||t.depth===!1?+t.depth:It.depth,ignoreQueryPrefix:t.ignoreQueryPrefix===!0,interpretNumericEntities:typeof t.interpretNumericEntities=="boolean"?t.interpretNumericEntities:It.interpretNumericEntities,parameterLimit:typeof t.parameterLimit=="number"?t.parameterLimit:It.parameterLimit,parseArrays:t.parseArrays!==!1,plainObjects:typeof t.plainObjects=="boolean"?t.plainObjects:It.plainObjects,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:It.strictNullHandling}};Bd.exports=function(r,t){var e=Ny(t);if(r===""||r===null||typeof r>"u")return e.plainObjects?Object.create(null):{};for(var i=typeof r=="string"?Dy(r,e):r,s=e.plainObjects?Object.create(null):{},o=Object.keys(i),n=0;n<o.length;++n){var a=o[n],h=Oy(a,i[a],e,typeof r=="string");s=Li.merge(s,h,e)}return e.allowSparse===!0?s:Li.compact(s)}});var Ld=ft((uv,Dd)=>{"use strict";var ky=Rd(),Uy=Fd(),Gy=Rn();Dd.exports={formats:Gy,parse:Uy,stringify:ky}});var Ud=ft(Ni=>{"use strict";var Hy=pc();function Ae(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var Vy=/^([a-z0-9.+-]+:)/i,Xy=/:[0-9]*$/,Wy=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,zy=["<",">",'"',"`"," ","\r",`
`,"	"],jy=["{","}","|","\\","^","`"].concat(zy),Jh=["'"].concat(jy),Od=["%","/","?",";","#"].concat(Jh),Nd=["/","?","#"],$y=255,kd=/^[+a-z0-9A-Z_-]{0,63}$/,Yy=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,qy={javascript:!0,"javascript:":!0},tl={javascript:!0,"javascript:":!0},Oi={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},el=Ld();function Ws(r,t,e){if(r&&typeof r=="object"&&r instanceof Ae)return r;var i=new Ae;return i.parse(r,t,e),i}Ae.prototype.parse=function(r,t,e){if(typeof r!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof r);var i=r.indexOf("?"),s=i!==-1&&i<r.indexOf("#")?"?":"#",o=r.split(s),n=/\\/g;o[0]=o[0].replace(n,"/"),r=o.join(s);var a=r;if(a=a.trim(),!e&&r.split("#").length===1){var h=Wy.exec(a);if(h)return this.path=a,this.href=a,this.pathname=h[1],h[2]?(this.search=h[2],t?this.query=el.parse(this.search.substr(1)):this.query=this.search.substr(1)):t&&(this.search="",this.query={}),this}var l=Vy.exec(a);if(l){l=l[0];var u=l.toLowerCase();this.protocol=u,a=a.substr(l.length)}if(e||l||a.match(/^\/\/[^@/]+@[^@/]+/)){var c=a.substr(0,2)==="//";c&&!(l&&tl[l])&&(a=a.substr(2),this.slashes=!0)}if(!tl[l]&&(c||l&&!Oi[l])){for(var d=-1,p=0;p<Nd.length;p++){var f=a.indexOf(Nd[p]);f!==-1&&(d===-1||f<d)&&(d=f)}var m,g;d===-1?g=a.lastIndexOf("@"):g=a.lastIndexOf("@",d),g!==-1&&(m=a.slice(0,g),a=a.slice(g+1),this.auth=decodeURIComponent(m)),d=-1;for(var p=0;p<Od.length;p++){var f=a.indexOf(Od[p]);f!==-1&&(d===-1||f<d)&&(d=f)}d===-1&&(d=a.length),this.host=a.slice(0,d),a=a.slice(d),this.parseHost(),this.hostname=this.hostname||"";var y=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!y)for(var v=this.hostname.split(/\./),p=0,_=v.length;p<_;p++){var x=v[p];if(x&&!x.match(kd)){for(var M="",G=0,I=x.length;G<I;G++)x.charCodeAt(G)>127?M+="x":M+=x[G];if(!M.match(kd)){var R=v.slice(0,p),N=v.slice(p+1),q=x.match(Yy);q&&(R.push(q[1]),N.unshift(q[2])),N.length&&(a="/"+N.join(".")+a),this.hostname=R.join(".");break}}}this.hostname.length>$y?this.hostname="":this.hostname=this.hostname.toLowerCase(),y||(this.hostname=Hy.toASCII(this.hostname));var D=this.port?":"+this.port:"",F=this.hostname||"";this.host=F+D,this.href+=this.host,y&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),a[0]!=="/"&&(a="/"+a))}if(!qy[u])for(var p=0,_=Jh.length;p<_;p++){var A=Jh[p];if(a.indexOf(A)!==-1){var C=encodeURIComponent(A);C===A&&(C=escape(A)),a=a.split(A).join(C)}}var J=a.indexOf("#");J!==-1&&(this.hash=a.substr(J),a=a.slice(0,J));var rt=a.indexOf("?");if(rt!==-1?(this.search=a.substr(rt),this.query=a.substr(rt+1),t&&(this.query=el.parse(this.query)),a=a.slice(0,rt)):t&&(this.search="",this.query={}),a&&(this.pathname=a),Oi[u]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var D=this.pathname||"",X=this.search||"";this.path=D+X}return this.href=this.format(),this};function Ky(r){return typeof r=="string"&&(r=Ws(r)),r instanceof Ae?r.format():Ae.prototype.format.call(r)}Ae.prototype.format=function(){var r=this.auth||"";r&&(r=encodeURIComponent(r),r=r.replace(/%3A/i,":"),r+="@");var t=this.protocol||"",e=this.pathname||"",i=this.hash||"",s=!1,o="";this.host?s=r+this.host:this.hostname&&(s=r+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(s+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(o=el.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var n=this.search||o&&"?"+o||"";return t&&t.substr(-1)!==":"&&(t+=":"),this.slashes||(!t||Oi[t])&&s!==!1?(s="//"+(s||""),e&&e.charAt(0)!=="/"&&(e="/"+e)):s||(s=""),i&&i.charAt(0)!=="#"&&(i="#"+i),n&&n.charAt(0)!=="?"&&(n="?"+n),e=e.replace(/[?#]/g,function(a){return encodeURIComponent(a)}),n=n.replace("#","%23"),t+s+e+n+i};function Zy(r,t){return Ws(r,!1,!0).resolve(t)}Ae.prototype.resolve=function(r){return this.resolveObject(Ws(r,!1,!0)).format()};function Qy(r,t){return r?Ws(r,!1,!0).resolveObject(t):t}Ae.prototype.resolveObject=function(r){if(typeof r=="string"){var t=new Ae;t.parse(r,!1,!0),r=t}for(var e=new Ae,i=Object.keys(this),s=0;s<i.length;s++){var o=i[s];e[o]=this[o]}if(e.hash=r.hash,r.href==="")return e.href=e.format(),e;if(r.slashes&&!r.protocol){for(var n=Object.keys(r),a=0;a<n.length;a++){var h=n[a];h!=="protocol"&&(e[h]=r[h])}return Oi[e.protocol]&&e.hostname&&!e.pathname&&(e.pathname="/",e.path=e.pathname),e.href=e.format(),e}if(r.protocol&&r.protocol!==e.protocol){if(!Oi[r.protocol]){for(var l=Object.keys(r),u=0;u<l.length;u++){var c=l[u];e[c]=r[c]}return e.href=e.format(),e}if(e.protocol=r.protocol,!r.host&&!tl[r.protocol]){for(var _=(r.pathname||"").split("/");_.length&&!(r.host=_.shift()););r.host||(r.host=""),r.hostname||(r.hostname=""),_[0]!==""&&_.unshift(""),_.length<2&&_.unshift(""),e.pathname=_.join("/")}else e.pathname=r.pathname;if(e.search=r.search,e.query=r.query,e.host=r.host||"",e.auth=r.auth,e.hostname=r.hostname||r.host,e.port=r.port,e.pathname||e.search){var d=e.pathname||"",p=e.search||"";e.path=d+p}return e.slashes=e.slashes||r.slashes,e.href=e.format(),e}var f=e.pathname&&e.pathname.charAt(0)==="/",m=r.host||r.pathname&&r.pathname.charAt(0)==="/",g=m||f||e.host&&r.pathname,y=g,v=e.pathname&&e.pathname.split("/")||[],_=r.pathname&&r.pathname.split("/")||[],x=e.protocol&&!Oi[e.protocol];if(x&&(e.hostname="",e.port=null,e.host&&(v[0]===""?v[0]=e.host:v.unshift(e.host)),e.host="",r.protocol&&(r.hostname=null,r.port=null,r.host&&(_[0]===""?_[0]=r.host:_.unshift(r.host)),r.host=null),g=g&&(_[0]===""||v[0]==="")),m)e.host=r.host||r.host===""?r.host:e.host,e.hostname=r.hostname||r.hostname===""?r.hostname:e.hostname,e.search=r.search,e.query=r.query,v=_;else if(_.length)v||(v=[]),v.pop(),v=v.concat(_),e.search=r.search,e.query=r.query;else if(r.search!=null){if(x){e.host=v.shift(),e.hostname=e.host;var M=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;M&&(e.auth=M.shift(),e.hostname=M.shift(),e.host=e.hostname)}return e.search=r.search,e.query=r.query,(e.pathname!==null||e.search!==null)&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.href=e.format(),e}if(!v.length)return e.pathname=null,e.search?e.path="/"+e.search:e.path=null,e.href=e.format(),e;for(var G=v.slice(-1)[0],I=(e.host||r.host||v.length>1)&&(G==="."||G==="..")||G==="",R=0,N=v.length;N>=0;N--)G=v[N],G==="."?v.splice(N,1):G===".."?(v.splice(N,1),R++):R&&(v.splice(N,1),R--);if(!g&&!y)for(;R--;R)v.unshift("..");g&&v[0]!==""&&(!v[0]||v[0].charAt(0)!=="/")&&v.unshift(""),I&&v.join("/").substr(-1)!=="/"&&v.push("");var q=v[0]===""||v[0]&&v[0].charAt(0)==="/";if(x){e.hostname=q?"":v.length?v.shift():"",e.host=e.hostname;var M=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;M&&(e.auth=M.shift(),e.hostname=M.shift(),e.host=e.hostname)}return g=g||e.host&&v.length,g&&!q&&v.unshift(""),v.length>0?e.pathname=v.join("/"):(e.pathname=null,e.path=null),(e.pathname!==null||e.search!==null)&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.auth=r.auth||e.auth,e.slashes=e.slashes||r.slashes,e.href=e.format(),e};Ae.prototype.parseHost=function(){var r=this.host,t=Xy.exec(r);t&&(t=t[0],t!==":"&&(this.port=t.substr(1)),r=r.substr(0,r.length-t.length)),r&&(this.hostname=r)};Ni.parse=Ws;Ni.resolve=Zy;Ni.resolveObject=Qy;Ni.format=Ky;Ni.Url=Ae});var ge=(r=>(r[r.WEBGL_LEGACY=0]="WEBGL_LEGACY",r[r.WEBGL=1]="WEBGL",r[r.WEBGL2=2]="WEBGL2",r))(ge||{}),yh=(r=>(r[r.UNKNOWN=0]="UNKNOWN",r[r.WEBGL=1]="WEBGL",r[r.CANVAS=2]="CANVAS",r))(yh||{}),dn=(r=>(r[r.COLOR=16384]="COLOR",r[r.DEPTH=256]="DEPTH",r[r.STENCIL=1024]="STENCIL",r))(dn||{}),Y=(r=>(r[r.NORMAL=0]="NORMAL",r[r.ADD=1]="ADD",r[r.MULTIPLY=2]="MULTIPLY",r[r.SCREEN=3]="SCREEN",r[r.OVERLAY=4]="OVERLAY",r[r.DARKEN=5]="DARKEN",r[r.LIGHTEN=6]="LIGHTEN",r[r.COLOR_DODGE=7]="COLOR_DODGE",r[r.COLOR_BURN=8]="COLOR_BURN",r[r.HARD_LIGHT=9]="HARD_LIGHT",r[r.SOFT_LIGHT=10]="SOFT_LIGHT",r[r.DIFFERENCE=11]="DIFFERENCE",r[r.EXCLUSION=12]="EXCLUSION",r[r.HUE=13]="HUE",r[r.SATURATION=14]="SATURATION",r[r.COLOR=15]="COLOR",r[r.LUMINOSITY=16]="LUMINOSITY",r[r.NORMAL_NPM=17]="NORMAL_NPM",r[r.ADD_NPM=18]="ADD_NPM",r[r.SCREEN_NPM=19]="SCREEN_NPM",r[r.NONE=20]="NONE",r[r.SRC_OVER=0]="SRC_OVER",r[r.SRC_IN=21]="SRC_IN",r[r.SRC_OUT=22]="SRC_OUT",r[r.SRC_ATOP=23]="SRC_ATOP",r[r.DST_OVER=24]="DST_OVER",r[r.DST_IN=25]="DST_IN",r[r.DST_OUT=26]="DST_OUT",r[r.DST_ATOP=27]="DST_ATOP",r[r.ERASE=26]="ERASE",r[r.SUBTRACT=28]="SUBTRACT",r[r.XOR=29]="XOR",r))(Y||{}),le=(r=>(r[r.POINTS=0]="POINTS",r[r.LINES=1]="LINES",r[r.LINE_LOOP=2]="LINE_LOOP",r[r.LINE_STRIP=3]="LINE_STRIP",r[r.TRIANGLES=4]="TRIANGLES",r[r.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",r[r.TRIANGLE_FAN=6]="TRIANGLE_FAN",r))(le||{}),P=(r=>(r[r.RGBA=6408]="RGBA",r[r.RGB=6407]="RGB",r[r.RG=33319]="RG",r[r.RED=6403]="RED",r[r.RGBA_INTEGER=36249]="RGBA_INTEGER",r[r.RGB_INTEGER=36248]="RGB_INTEGER",r[r.RG_INTEGER=33320]="RG_INTEGER",r[r.RED_INTEGER=36244]="RED_INTEGER",r[r.ALPHA=6406]="ALPHA",r[r.LUMINANCE=6409]="LUMINANCE",r[r.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",r[r.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",r[r.DEPTH_STENCIL=34041]="DEPTH_STENCIL",r))(P||{}),hr=(r=>(r[r.TEXTURE_2D=3553]="TEXTURE_2D",r[r.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",r[r.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",r[r.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",r[r.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",r[r.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",r[r.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",r))(hr||{}),U=(r=>(r[r.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",r[r.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",r[r.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",r[r.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",r[r.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",r[r.UNSIGNED_INT=5125]="UNSIGNED_INT",r[r.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",r[r.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",r[r.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",r[r.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",r[r.BYTE=5120]="BYTE",r[r.SHORT=5122]="SHORT",r[r.INT=5124]="INT",r[r.FLOAT=5126]="FLOAT",r[r.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",r[r.HALF_FLOAT=36193]="HALF_FLOAT",r))(U||{}),k=(r=>(r[r.FLOAT=0]="FLOAT",r[r.INT=1]="INT",r[r.UINT=2]="UINT",r))(k||{}),ue=(r=>(r[r.NEAREST=0]="NEAREST",r[r.LINEAR=1]="LINEAR",r))(ue||{}),ye=(r=>(r[r.CLAMP=33071]="CLAMP",r[r.REPEAT=10497]="REPEAT",r[r.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",r))(ye||{}),Ut=(r=>(r[r.OFF=0]="OFF",r[r.POW2=1]="POW2",r[r.ON=2]="ON",r[r.ON_MANUAL=3]="ON_MANUAL",r))(Ut||{}),xt=(r=>(r[r.NPM=0]="NPM",r[r.UNPACK=1]="UNPACK",r[r.PMA=2]="PMA",r[r.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",r[r.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",r[r.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",r))(xt||{}),_e=(r=>(r[r.NO=0]="NO",r[r.YES=1]="YES",r[r.AUTO=2]="AUTO",r[r.BLEND=0]="BLEND",r[r.CLEAR=1]="CLEAR",r[r.BLIT=2]="BLIT",r))(_e||{}),pn=(r=>(r[r.AUTO=0]="AUTO",r[r.MANUAL=1]="MANUAL",r))(pn||{}),te=(r=>(r.LOW="lowp",r.MEDIUM="mediump",r.HIGH="highp",r))(te||{}),bt=(r=>(r[r.NONE=0]="NONE",r[r.SCISSOR=1]="SCISSOR",r[r.STENCIL=2]="STENCIL",r[r.SPRITE=3]="SPRITE",r[r.COLOR=4]="COLOR",r))(bt||{});var lt=(r=>(r[r.NONE=0]="NONE",r[r.LOW=2]="LOW",r[r.MEDIUM=4]="MEDIUM",r[r.HIGH=8]="HIGH",r))(lt||{}),ce=(r=>(r[r.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",r[r.ARRAY_BUFFER=34962]="ARRAY_BUFFER",r[r.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",r))(ce||{});var _h={createCanvas:(r,t)=>{let e=document.createElement("canvas");return e.width=r,e.height=t,e},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(r,t)=>fetch(r,t),parseXML:r=>new DOMParser().parseFromString(r,"text/xml")};var E={ADAPTER:_h,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var xh=/iPhone/i,qu=/iPod/i,Ku=/iPad/i,Zu=/\biOS-universal(?:.+)Mac\b/i,vh=/\bAndroid(?:.+)Mobile\b/i,Qu=/Android/i,Ei=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,fn=/Silk/i,lr=/Windows Phone/i,Ju=/\bWindows(?:.+)ARM\b/i,tc=/BlackBerry/i,ec=/BB10/i,rc=/Opera Mini/i,ic=/\b(CriOS|Chrome)(?:.+)Mobile/i,sc=/Mobile(?:.+)Firefox\b/i,oc=function(r){return typeof r<"u"&&r.platform==="MacIntel"&&typeof r.maxTouchPoints=="number"&&r.maxTouchPoints>1&&typeof MSStream>"u"};function Im(r){return function(t){return t.test(r)}}function Bs(r){var t={userAgent:"",platform:"",maxTouchPoints:0};!r&&typeof navigator<"u"?t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof r=="string"?t.userAgent=r:r&&r.userAgent&&(t={userAgent:r.userAgent,platform:r.platform,maxTouchPoints:r.maxTouchPoints||0});var e=t.userAgent,i=e.split("[FBAN");typeof i[1]<"u"&&(e=i[0]),i=e.split("Twitter"),typeof i[1]<"u"&&(e=i[0]);var s=Im(e),o={apple:{phone:s(xh)&&!s(lr),ipod:s(qu),tablet:!s(xh)&&(s(Ku)||oc(t))&&!s(lr),universal:s(Zu),device:(s(xh)||s(qu)||s(Ku)||s(Zu)||oc(t))&&!s(lr)},amazon:{phone:s(Ei),tablet:!s(Ei)&&s(fn),device:s(Ei)||s(fn)},android:{phone:!s(lr)&&s(Ei)||!s(lr)&&s(vh),tablet:!s(lr)&&!s(Ei)&&!s(vh)&&(s(fn)||s(Qu)),device:!s(lr)&&(s(Ei)||s(fn)||s(vh)||s(Qu))||s(/\bokhttp\b/i)},windows:{phone:s(lr),tablet:s(Ju),device:s(lr)||s(Ju)},other:{blackberry:s(tc),blackberry10:s(ec),opera:s(rc),firefox:s(sc),chrome:s(ic),device:s(tc)||s(ec)||s(rc)||s(sc)||s(ic)},any:!1,phone:!1,tablet:!1};return o.any=o.apple.device||o.android.device||o.windows.device||o.other.device,o.phone=o.apple.phone||o.android.phone||o.windows.phone,o.tablet=o.apple.tablet||o.android.tablet||o.windows.tablet,o}var Rm=Bs.default??Bs,Se=Rm(globalThis.navigator);var S={};Cm(S,{BaseTextureCache:()=>re,BoundingBox:()=>Ks,CanvasRenderTarget:()=>Nn,DATA_URI:()=>Ln,EventEmitter:()=>Ze.default,ProgramCache:()=>Zs,TextureCache:()=>Mt,clearTextureCache:()=>mp,correctBlendMode:()=>ap,createIndicesForQuads:()=>cp,decomposeDataUri:()=>xp,deprecation:()=>Z,destroyTextureCache:()=>fp,detectVideoAlphaMode:()=>Vd,determineCrossOrigin:()=>Un,earcut:()=>vp.default,getBufferType:()=>Pr,getCanvasBoundingBox:()=>kn,getResolutionOfUrl:()=>Qs,hex2rgb:()=>ip,hex2string:()=>sp,interleaveTypedArrays:()=>dp,isMobile:()=>Se,isPow2:()=>Ys,isWebGLSupported:()=>Bn,log2:()=>qs,nextPow2:()=>Ir,path:()=>rl,premultiplyBlendMode:()=>$s,premultiplyRgba:()=>hp,premultiplyTint:()=>lp,premultiplyTintToRgba:()=>up,removeItems:()=>On,rgb2hex:()=>np,sayHello:()=>Wd,sign:()=>pp,skipHello:()=>Xd,string2hex:()=>op,trimCanvas:()=>_p,uid:()=>Ke,url:()=>Hd});E.RETINA_PREFIX=/@([0-9\.]+)x/;E.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var Ze=gh(ac(),1),vp=gh(dc(),1);var ki=gh(Ud(),1);var Gd={};function Z(r,t,e=3){if(Gd[t])return;let i=new Error().stack;typeof i>"u"?console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${r}`):(i=i.split(`
`).splice(e).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${t}
Deprecated since v${r}`),console.warn(i),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${r}`),console.warn(i))),Gd[t]=!0}var Hd={get parse(){return Z("7.3.0","utils.url.parse is deprecated, use native URL API instead."),ki.parse},get format(){return Z("7.3.0","utils.url.format is deprecated, use native URL API instead."),ki.format},get resolve(){return Z("7.3.0","utils.url.resolve is deprecated, use native URL API instead."),ki.resolve}};function ke(r){if(typeof r!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(r)}`)}function zs(r){return r.split("?")[0].split("#")[0]}function Jy(r){return r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function t_(r,t,e){return r.replace(new RegExp(Jy(t),"g"),e)}function e_(r,t){let e="",i=0,s=-1,o=0,n=-1;for(let a=0;a<=r.length;++a){if(a<r.length)n=r.charCodeAt(a);else{if(n===47)break;n=47}if(n===47){if(!(s===a-1||o===1))if(s!==a-1&&o===2){if(e.length<2||i!==2||e.charCodeAt(e.length-1)!==46||e.charCodeAt(e.length-2)!==46){if(e.length>2){let h=e.lastIndexOf("/");if(h!==e.length-1){h===-1?(e="",i=0):(e=e.slice(0,h),i=e.length-1-e.lastIndexOf("/")),s=a,o=0;continue}}else if(e.length===2||e.length===1){e="",i=0,s=a,o=0;continue}}t&&(e.length>0?e+="/..":e="..",i=2)}else e.length>0?e+=`/${r.slice(s+1,a)}`:e=r.slice(s+1,a),i=a-s-1;s=a,o=0}else n===46&&o!==-1?++o:o=-1}return e}var rl={toPosix(r){return t_(r,"\\","/")},isUrl(r){return/^https?:/.test(this.toPosix(r))},isDataUrl(r){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(r)},isBlobUrl(r){return r.startsWith("blob:")},hasProtocol(r){return/^[^/:]+:/.test(this.toPosix(r))},getProtocol(r){ke(r),r=this.toPosix(r);let t=/^file:\/\/\//.exec(r);if(t)return t[0];let e=/^[^/:]+:\/{0,2}/.exec(r);return e?e[0]:""},toAbsolute(r,t,e){if(ke(r),this.isDataUrl(r)||this.isBlobUrl(r))return r;let i=zs(this.toPosix(t??E.ADAPTER.getBaseUrl())),s=zs(this.toPosix(e??this.rootname(i)));return r=this.toPosix(r),r.startsWith("/")?rl.join(s,r.slice(1)):this.isAbsolute(r)?r:this.join(i,r)},normalize(r){if(ke(r),r.length===0)return".";if(this.isDataUrl(r)||this.isBlobUrl(r))return r;r=this.toPosix(r);let t="",e=r.startsWith("/");this.hasProtocol(r)&&(t=this.rootname(r),r=r.slice(t.length));let i=r.endsWith("/");return r=e_(r,!1),r.length>0&&i&&(r+="/"),e?`/${r}`:t+r},isAbsolute(r){return ke(r),r=this.toPosix(r),this.hasProtocol(r)?!0:r.startsWith("/")},join(...r){if(r.length===0)return".";let t;for(let e=0;e<r.length;++e){let i=r[e];if(ke(i),i.length>0)if(t===void 0)t=i;else{let s=r[e-1]??"";this.extname(s)?t+=`/../${i}`:t+=`/${i}`}}return t===void 0?".":this.normalize(t)},dirname(r){if(ke(r),r.length===0)return".";r=this.toPosix(r);let t=r.charCodeAt(0),e=t===47,i=-1,s=!0,o=this.getProtocol(r),n=r;r=r.slice(o.length);for(let a=r.length-1;a>=1;--a)if(t=r.charCodeAt(a),t===47){if(!s){i=a;break}}else s=!1;return i===-1?e?"/":this.isUrl(n)?o+r:o:e&&i===1?"//":o+r.slice(0,i)},rootname(r){ke(r),r=this.toPosix(r);let t="";if(r.startsWith("/")?t="/":t=this.getProtocol(r),this.isUrl(r)){let e=r.indexOf("/",t.length);e!==-1?t=r.slice(0,e):t=r,t.endsWith("/")||(t+="/")}return t},basename(r,t){ke(r),t&&ke(t),r=zs(this.toPosix(r));let e=0,i=-1,s=!0,o;if(t!==void 0&&t.length>0&&t.length<=r.length){if(t.length===r.length&&t===r)return"";let n=t.length-1,a=-1;for(o=r.length-1;o>=0;--o){let h=r.charCodeAt(o);if(h===47){if(!s){e=o+1;break}}else a===-1&&(s=!1,a=o+1),n>=0&&(h===t.charCodeAt(n)?--n===-1&&(i=o):(n=-1,i=a))}return e===i?i=a:i===-1&&(i=r.length),r.slice(e,i)}for(o=r.length-1;o>=0;--o)if(r.charCodeAt(o)===47){if(!s){e=o+1;break}}else i===-1&&(s=!1,i=o+1);return i===-1?"":r.slice(e,i)},extname(r){ke(r),r=zs(this.toPosix(r));let t=-1,e=0,i=-1,s=!0,o=0;for(let n=r.length-1;n>=0;--n){let a=r.charCodeAt(n);if(a===47){if(!s){e=n+1;break}continue}i===-1&&(s=!1,i=n+1),a===46?t===-1?t=n:o!==1&&(o=1):t!==-1&&(o=-1)}return t===-1||i===-1||o===0||o===1&&t===i-1&&t===e+1?"":r.slice(t,i)},parse(r){ke(r);let t={root:"",dir:"",base:"",ext:"",name:""};if(r.length===0)return t;r=zs(this.toPosix(r));let e=r.charCodeAt(0),i=this.isAbsolute(r),s,o="";t.root=this.rootname(r),i||this.hasProtocol(r)?s=1:s=0;let n=-1,a=0,h=-1,l=!0,u=r.length-1,c=0;for(;u>=s;--u){if(e=r.charCodeAt(u),e===47){if(!l){a=u+1;break}continue}h===-1&&(l=!1,h=u+1),e===46?n===-1?n=u:c!==1&&(c=1):n!==-1&&(c=-1)}return n===-1||h===-1||c===0||c===1&&n===h-1&&n===a+1?h!==-1&&(a===0&&i?t.base=t.name=r.slice(1,h):t.base=t.name=r.slice(a,h)):(a===0&&i?(t.name=r.slice(1,n),t.base=r.slice(1,h)):(t.name=r.slice(a,n),t.base=r.slice(a,h)),t.ext=r.slice(n,h)),t.dir=this.dirname(r),o&&(t.dir=o+t.dir),t},sep:"/",delimiter:":"};var il;async function Vd(){return il??(il=(async()=>{let r=document.createElement("canvas").getContext("webgl");if(!r)return xt.UNPACK;let t=await new Promise(o=>{let n=document.createElement("video");n.onloadeddata=()=>o(n),n.onerror=()=>o(null),n.autoplay=!1,n.crossOrigin="anonymous",n.preload="auto",n.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",n.load()});if(!t)return xt.UNPACK;let e=r.createTexture();r.bindTexture(r.TEXTURE_2D,e);let i=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,i),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,r.NONE),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t);let s=new Uint8Array(4);return r.readPixels(0,0,1,1,r.RGBA,r.UNSIGNED_BYTE,s),r.deleteFramebuffer(i),r.deleteTexture(e),r.getExtension("WEBGL_lose_context")?.loseContext(),s[0]<=s[3]?xt.PMA:xt.UNPACK})()),il}function Xd(){Z("7.0.0","skipHello is deprecated, please use settings.RENDER_OPTIONS.hello")}function Wd(){Z("7.0.0",`sayHello is deprecated, please use Renderer's "hello" option`)}var sl;function Bn(){return typeof sl>"u"&&(sl=function(){let r={stencil:!0,failIfMajorPerformanceCaveat:E.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!E.ADAPTER.getWebGLRenderingContext())return!1;let t=E.ADAPTER.createCanvas(),e=t.getContext("webgl",r)||t.getContext("experimental-webgl",r),i=!!e?.getContextAttributes()?.stencil;if(e){let s=e.getExtension("WEBGL_lose_context");s&&s.loseContext()}return e=null,i}catch{return!1}}()),sl}var r_={grad:.9,turn:360,rad:360/(2*Math.PI)},cr=function(r){return typeof r=="string"?r.length>0:typeof r=="number"},Rt=function(r,t,e){return t===void 0&&(t=0),e===void 0&&(e=Math.pow(10,t)),Math.round(e*r)/e+0},Ce=function(r,t,e){return t===void 0&&(t=0),e===void 0&&(e=1),r>e?e:r>t?r:t},Qd=function(r){return(r=isFinite(r)?r%360:0)>0?r:r+360},zd=function(r){return{r:Ce(r.r,0,255),g:Ce(r.g,0,255),b:Ce(r.b,0,255),a:Ce(r.a)}},ol=function(r){return{r:Rt(r.r),g:Rt(r.g),b:Rt(r.b),a:Rt(r.a,3)}},i_=/^#([0-9a-f]{3,8})$/i,Fn=function(r){var t=r.toString(16);return t.length<2?"0"+t:t},Jd=function(r){var t=r.r,e=r.g,i=r.b,s=r.a,o=Math.max(t,e,i),n=o-Math.min(t,e,i),a=n?o===t?(e-i)/n:o===e?2+(i-t)/n:4+(t-e)/n:0;return{h:60*(a<0?a+6:a),s:o?n/o*100:0,v:o/255*100,a:s}},tp=function(r){var t=r.h,e=r.s,i=r.v,s=r.a;t=t/360*6,e/=100,i/=100;var o=Math.floor(t),n=i*(1-e),a=i*(1-(t-o)*e),h=i*(1-(1-t+o)*e),l=o%6;return{r:255*[i,a,n,n,h,i][l],g:255*[h,i,i,a,n,n][l],b:255*[n,n,h,i,i,a][l],a:s}},jd=function(r){return{h:Qd(r.h),s:Ce(r.s,0,100),l:Ce(r.l,0,100),a:Ce(r.a)}},$d=function(r){return{h:Rt(r.h),s:Rt(r.s),l:Rt(r.l),a:Rt(r.a,3)}},Yd=function(r){return tp((e=(t=r).s,{h:t.h,s:(e*=((i=t.l)<50?i:100-i)/100)>0?2*e/(i+e)*100:0,v:i+e,a:t.a}));var t,e,i},js=function(r){return{h:(t=Jd(r)).h,s:(s=(200-(e=t.s))*(i=t.v)/100)>0&&s<200?e*i/100/(s<=100?s:200-s)*100:0,l:s/2,a:t.a};var t,e,i,s},s_=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,o_=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,n_=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,a_=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,hl={string:[[function(r){var t=i_.exec(r);return t?(r=t[1]).length<=4?{r:parseInt(r[0]+r[0],16),g:parseInt(r[1]+r[1],16),b:parseInt(r[2]+r[2],16),a:r.length===4?Rt(parseInt(r[3]+r[3],16)/255,2):1}:r.length===6||r.length===8?{r:parseInt(r.substr(0,2),16),g:parseInt(r.substr(2,2),16),b:parseInt(r.substr(4,2),16),a:r.length===8?Rt(parseInt(r.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(r){var t=n_.exec(r)||a_.exec(r);return t?t[2]!==t[4]||t[4]!==t[6]?null:zd({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:t[7]===void 0?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(r){var t=s_.exec(r)||o_.exec(r);if(!t)return null;var e,i,s=jd({h:(e=t[1],i=t[2],i===void 0&&(i="deg"),Number(e)*(r_[i]||1)),s:Number(t[3]),l:Number(t[4]),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)});return Yd(s)},"hsl"]],object:[[function(r){var t=r.r,e=r.g,i=r.b,s=r.a,o=s===void 0?1:s;return cr(t)&&cr(e)&&cr(i)?zd({r:Number(t),g:Number(e),b:Number(i),a:Number(o)}):null},"rgb"],[function(r){var t=r.h,e=r.s,i=r.l,s=r.a,o=s===void 0?1:s;if(!cr(t)||!cr(e)||!cr(i))return null;var n=jd({h:Number(t),s:Number(e),l:Number(i),a:Number(o)});return Yd(n)},"hsl"],[function(r){var t=r.h,e=r.s,i=r.v,s=r.a,o=s===void 0?1:s;if(!cr(t)||!cr(e)||!cr(i))return null;var n=function(a){return{h:Qd(a.h),s:Ce(a.s,0,100),v:Ce(a.v,0,100),a:Ce(a.a)}}({h:Number(t),s:Number(e),v:Number(i),a:Number(o)});return tp(n)},"hsv"]]},qd=function(r,t){for(var e=0;e<t.length;e++){var i=t[e][0](r);if(i)return[i,t[e][1]]}return[null,void 0]},h_=function(r){return typeof r=="string"?qd(r.trim(),hl.string):typeof r=="object"&&r!==null?qd(r,hl.object):[null,void 0]};var nl=function(r,t){var e=js(r);return{h:e.h,s:Ce(e.s+100*t,0,100),l:e.l,a:e.a}},al=function(r){return(299*r.r+587*r.g+114*r.b)/1e3/255},Kd=function(r,t){var e=js(r);return{h:e.h,s:e.s,l:Ce(e.l+100*t,0,100),a:e.a}},ll=function(){function r(t){this.parsed=h_(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return r.prototype.isValid=function(){return this.parsed!==null},r.prototype.brightness=function(){return Rt(al(this.rgba),2)},r.prototype.isDark=function(){return al(this.rgba)<.5},r.prototype.isLight=function(){return al(this.rgba)>=.5},r.prototype.toHex=function(){return t=ol(this.rgba),e=t.r,i=t.g,s=t.b,n=(o=t.a)<1?Fn(Rt(255*o)):"","#"+Fn(e)+Fn(i)+Fn(s)+n;var t,e,i,s,o,n},r.prototype.toRgb=function(){return ol(this.rgba)},r.prototype.toRgbString=function(){return t=ol(this.rgba),e=t.r,i=t.g,s=t.b,(o=t.a)<1?"rgba("+e+", "+i+", "+s+", "+o+")":"rgb("+e+", "+i+", "+s+")";var t,e,i,s,o},r.prototype.toHsl=function(){return $d(js(this.rgba))},r.prototype.toHslString=function(){return t=$d(js(this.rgba)),e=t.h,i=t.s,s=t.l,(o=t.a)<1?"hsla("+e+", "+i+"%, "+s+"%, "+o+")":"hsl("+e+", "+i+"%, "+s+"%)";var t,e,i,s,o},r.prototype.toHsv=function(){return t=Jd(this.rgba),{h:Rt(t.h),s:Rt(t.s),v:Rt(t.v),a:Rt(t.a,3)};var t},r.prototype.invert=function(){return Ue({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},r.prototype.saturate=function(t){return t===void 0&&(t=.1),Ue(nl(this.rgba,t))},r.prototype.desaturate=function(t){return t===void 0&&(t=.1),Ue(nl(this.rgba,-t))},r.prototype.grayscale=function(){return Ue(nl(this.rgba,-1))},r.prototype.lighten=function(t){return t===void 0&&(t=.1),Ue(Kd(this.rgba,t))},r.prototype.darken=function(t){return t===void 0&&(t=.1),Ue(Kd(this.rgba,-t))},r.prototype.rotate=function(t){return t===void 0&&(t=15),this.hue(this.hue()+t)},r.prototype.alpha=function(t){return typeof t=="number"?Ue({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):Rt(this.rgba.a,3);var e},r.prototype.hue=function(t){var e=js(this.rgba);return typeof t=="number"?Ue({h:t,s:e.s,l:e.l,a:e.a}):Rt(e.h)},r.prototype.isEqual=function(t){return this.toHex()===Ue(t).toHex()},r}(),Ue=function(r){return r instanceof ll?r:new ll(r)},Zd=[],ep=function(r){r.forEach(function(t){Zd.indexOf(t)<0&&(t(ll,hl),Zd.push(t))})};function rp(r,t){var e={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},i={};for(var s in e)i[e[s]]=s;var o={};r.prototype.toName=function(n){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var a,h,l=i[this.toHex()];if(l)return l;if(n?.closest){var u=this.toRgb(),c=1/0,d="black";if(!o.length)for(var p in e)o[p]=new r(e[p]).toRgb();for(var f in e){var m=(a=u,h=o[f],Math.pow(a.r-h.r,2)+Math.pow(a.g-h.g,2)+Math.pow(a.b-h.b,2));m<c&&(c=m,d=f)}return d}},t.string.push([function(n){var a=n.toLowerCase(),h=a==="transparent"?"#0000":e[a];return h?new r(h).toRgb():null},"name"])}ep([rp]);var Ui=class Dn{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(t){if(t instanceof Dn)this._value=this.cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(t===null)throw new Error("Cannot set PIXI.Color#value to null");(this._value===null||!this.isSourceEqual(this._value,t))&&(this.normalize(t),this._value=this.cloneSource(t))}}get value(){return this._value}cloneSource(t){return typeof t=="string"||typeof t=="number"||t instanceof Number||t===null?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):typeof t=="object"&&t!==null?{...t}:t}isSourceEqual(t,e){let i=typeof t;if(i!==typeof e)return!1;if(i==="number"||i==="string"||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length!==e.length?!1:t.every((s,o)=>s===e[o]);if(t!==null&&e!==null){let s=Object.keys(t),o=Object.keys(e);return s.length!==o.length?!1:s.every(n=>t[n]===e[n])}return t===e}toRgba(){let[t,e,i,s]=this._components;return{r:t,g:e,b:i,a:s}}toRgb(){let[t,e,i]=this._components;return{r:t,g:e,b:i}}toRgbaString(){let[t,e,i]=this.toUint8RgbArray();return`rgba(${t},${e},${i},${this.alpha})`}toUint8RgbArray(t){let[e,i,s]=this._components;return t=t??[],t[0]=Math.round(e*255),t[1]=Math.round(i*255),t[2]=Math.round(s*255),t}toRgbArray(t){t=t??[];let[e,i,s]=this._components;return t[0]=e,t[1]=i,t[2]=s,t}toNumber(){return this._int}toLittleEndianNumber(){let t=this._int;return(t>>16)+(t&65280)+((t&255)<<16)}multiply(t){let[e,i,s,o]=Dn.temp.setValue(t)._components;return this._components[0]*=e,this._components[1]*=i,this._components[2]*=s,this._components[3]*=o,this.refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this.refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(t===1)return(255<<24)+this._int;if(t===0)return e?0:this._int;let i=this._int>>16&255,s=this._int>>8&255,o=this._int&255;return e&&(i=i*t+.5|0,s=s*t+.5|0,o=o*t+.5|0),(t*255<<24)+(i<<16)+(s<<8)+o}toHex(){let t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){let t=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-t.length)+t}setAlpha(t){return this._components[3]=this._clamp(t),this}round(t){let[e,i,s]=this._components;return this._components[0]=Math.round(e*t)/t,this._components[1]=Math.round(i*t)/t,this._components[2]=Math.round(s*t)/t,this.refreshInt(),this._value=null,this}toArray(t){t=t??[];let[e,i,s,o]=this._components;return t[0]=e,t[1]=i,t[2]=s,t[3]=o,t}normalize(t){let e,i,s,o;if((typeof t=="number"||t instanceof Number)&&t>=0&&t<=16777215){let n=t;e=(n>>16&255)/255,i=(n>>8&255)/255,s=(n&255)/255,o=1}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[e,i,s,o=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[e,i,s,o=255]=t,e/=255,i/=255,s/=255,o/=255;else if(typeof t=="string"||typeof t=="object"){if(typeof t=="string"){let a=Dn.HEX_PATTERN.exec(t);a&&(t=`#${a[2]}`)}let n=Ue(t);n.isValid()&&({r:e,g:i,b:s,a:o}=n.rgba,e/=255,i/=255,s/=255)}if(e!==void 0)this._components[0]=e,this._components[1]=i,this._components[2]=s,this._components[3]=o,this.refreshInt();else throw new Error(`Unable to convert color ${t}`)}refreshInt(){this._clamp(this._components);let[t,e,i]=this._components;this._int=(t*255<<16)+(e*255<<8)+(i*255|0)}_clamp(t,e=0,i=1){return typeof t=="number"?Math.min(Math.max(t,e),i):(t.forEach((s,o)=>{t[o]=Math.min(Math.max(s,e),i)}),t)}};Ui.shared=new Ui,Ui.temp=new Ui,Ui.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;var Q=Ui;function ip(r,t=[]){return Z("7.2.0","utils.hex2rgb is deprecated, use Color#toRgbArray instead"),Q.shared.setValue(r).toRgbArray(t)}function sp(r){return Z("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),Q.shared.setValue(r).toHex()}function op(r){return Z("7.2.0","utils.string2hex is deprecated, use Color#toNumber instead"),Q.shared.setValue(r).toNumber()}function np(r){return Z("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),Q.shared.setValue(r).toNumber()}function l_(){let r=[],t=[];for(let i=0;i<32;i++)r[i]=i,t[i]=i;r[Y.NORMAL_NPM]=Y.NORMAL,r[Y.ADD_NPM]=Y.ADD,r[Y.SCREEN_NPM]=Y.SCREEN,t[Y.NORMAL]=Y.NORMAL_NPM,t[Y.ADD]=Y.ADD_NPM,t[Y.SCREEN]=Y.SCREEN_NPM;let e=[];return e.push(t),e.push(r),e}var $s=l_();function ap(r,t){return $s[t?1:0][r]}function hp(r,t,e,i=!0){return Z("7.2.0","utils.premultiplyRgba has moved to Color.premultiply"),Q.shared.setValue(r).premultiply(t,i).toArray(e??new Float32Array(4))}function lp(r,t){return Z("7.2.0","utils.premultiplyTint has moved to Color.toPremultiplied"),Q.shared.setValue(r).toPremultiplied(t)}function up(r,t,e,i=!0){return Z("7.2.0","utils.premultiplyTintToRgba has moved to Color.premultiply"),Q.shared.setValue(r).premultiply(t,i).toArray(e??new Float32Array(4))}var Ln=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i;function cp(r,t=null){let e=r*6;if(t=t||new Uint16Array(e),t.length!==e)throw new Error(`Out buffer length is incorrect, got ${t.length} and expected ${e}`);for(let i=0,s=0;i<e;i+=6,s+=4)t[i+0]=s+0,t[i+1]=s+1,t[i+2]=s+2,t[i+3]=s+0,t[i+4]=s+2,t[i+5]=s+3;return t}function Pr(r){if(r.BYTES_PER_ELEMENT===4)return r instanceof Float32Array?"Float32Array":r instanceof Uint32Array?"Uint32Array":"Int32Array";if(r.BYTES_PER_ELEMENT===2){if(r instanceof Uint16Array)return"Uint16Array"}else if(r.BYTES_PER_ELEMENT===1&&r instanceof Uint8Array)return"Uint8Array";return null}var u_={Float32Array,Uint32Array,Int32Array,Uint8Array};function dp(r,t){let e=0,i=0,s={};for(let h=0;h<r.length;h++)i+=t[h],e+=r[h].length;let o=new ArrayBuffer(e*4),n=null,a=0;for(let h=0;h<r.length;h++){let l=t[h],u=r[h],c=Pr(u);s[c]||(s[c]=new u_[c](o)),n=s[c];for(let d=0;d<u.length;d++){let p=(d/l|0)*i+a,f=d%l;n[p+f]=u[d]}a+=l}return new Float32Array(o)}function Ir(r){return r+=r===0?1:0,--r,r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,r|=r>>>16,r+1}function Ys(r){return!(r&r-1)&&!!r}function qs(r){let t=(r>65535?1:0)<<4;r>>>=t;let e=(r>255?1:0)<<3;return r>>>=e,t|=e,e=(r>15?1:0)<<2,r>>>=e,t|=e,e=(r>3?1:0)<<1,r>>>=e,t|=e,t|r>>1}function On(r,t,e){let i=r.length,s;if(t>=i||e===0)return;e=t+e>i?i-t:e;let o=i-e;for(s=t;s<o;++s)r[s]=r[s+e];r.length=o}function pp(r){return r===0?0:r<0?-1:1}var c_=0;function Ke(){return++c_}var ul=class{constructor(r,t,e,i){this.left=r,this.top=t,this.right=e,this.bottom=i}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};ul.EMPTY=new ul(0,0,0,0);var Ks=ul;var Zs={},Mt=Object.create(null),re=Object.create(null);function fp(){let r;for(r in Mt)Mt[r].destroy();for(r in re)re[r].destroy()}function mp(){let r;for(r in Mt)delete Mt[r];for(r in re)delete re[r]}var Nn=class{constructor(t,e,i){this._canvas=E.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=i||E.RESOLUTION,this.resize(t,e)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(t,e){this._checkDestroyed(),this._canvas.width=Math.round(t*this.resolution),this._canvas.height=Math.round(e*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(t){this._checkDestroyed(),this._canvas.width=Math.round(t)}get height(){return this._checkDestroyed(),this._canvas.height}set height(t){this._checkDestroyed(),this._canvas.height=Math.round(t)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(this._canvas===null)throw new TypeError("The CanvasRenderTarget has already been destroyed")}};function gp(r,t,e){for(let i=0,s=4*e*t;i<t;++i,s+=4)if(r[s+3]!==0)return!1;return!0}function yp(r,t,e,i,s){let o=4*t;for(let n=i,a=i*o+4*e;n<=s;++n,a+=o)if(r[a+3]!==0)return!1;return!0}function kn(r){let{width:t,height:e}=r,i=r.getContext("2d",{willReadFrequently:!0});if(i===null)throw new TypeError("Failed to get canvas 2D context");let s=i.getImageData(0,0,t,e).data,o=0,n=0,a=t-1,h=e-1;for(;n<e&&gp(s,t,n);)++n;if(n===e)return Ks.EMPTY;for(;gp(s,t,h);)--h;for(;yp(s,t,o,n,h);)++o;for(;yp(s,t,a,n,h);)--a;return++a,++h,new Ks(o,n,a,h)}function _p(r){let t=kn(r),{width:e,height:i}=t,s=null;if(!t.isEmpty()){let o=r.getContext("2d");if(o===null)throw new TypeError("Failed to get canvas 2D context");s=o.getImageData(t.left,t.top,e,i)}return{width:e,height:i,data:s}}function xp(r){let t=Ln.exec(r);if(t)return{mediaType:t[1]?t[1].toLowerCase():void 0,subType:t[2]?t[2].toLowerCase():void 0,charset:t[3]?t[3].toLowerCase():void 0,encoding:t[4]?t[4].toLowerCase():void 0,data:t[5]}}function Un(r,t=globalThis.location){if(r.startsWith("data:"))return"";t=t||globalThis.location;let e=new URL(r,document.baseURI);return e.hostname!==t.hostname||e.port!==t.port||e.protocol!==t.protocol?"anonymous":""}function Qs(r,t=1){let e=E.RETINA_PREFIX?.exec(r);return e?parseFloat(e[1]):t}var T=(r=>(r.Renderer="renderer",r.Application="application",r.RendererSystem="renderer-webgl-system",r.RendererPlugin="renderer-webgl-plugin",r.CanvasRendererSystem="renderer-canvas-system",r.CanvasRendererPlugin="renderer-canvas-plugin",r.Asset="asset",r.LoadParser="load-parser",r.ResolveParser="resolve-parser",r.CacheParser="cache-parser",r.DetectionParser="detection-parser",r))(T||{}),cl=r=>{if(typeof r=="function"||typeof r=="object"&&r.extension){if(!r.extension)throw new Error("Extension class must have an extension object");r={...typeof r.extension!="object"?{type:r.extension}:r.extension,ref:r}}if(typeof r=="object")r={...r};else throw new Error("Invalid extension type");return typeof r.type=="string"&&(r.type=[r.type]),r},bp=(r,t)=>cl(r).priority??t,w={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...r){return r.map(cl).forEach(t=>{t.type.forEach(e=>this._removeHandlers[e]?.(t))}),this},add(...r){return r.map(cl).forEach(t=>{t.type.forEach(e=>{let i=this._addHandlers,s=this._queue;i[e]?i[e](t):(s[e]=s[e]||[],s[e].push(t))})}),this},handle(r,t,e){let i=this._addHandlers,s=this._removeHandlers;if(i[r]||s[r])throw new Error(`Extension type ${r} already has a handler`);i[r]=t,s[r]=e;let o=this._queue;return o[r]&&(o[r].forEach(n=>t(n)),delete o[r]),this},handleByMap(r,t){return this.handle(r,e=>{t[e.name]=e.ref},e=>{delete t[e.name]})},handleByList(r,t,e=-1){return this.handle(r,i=>{t.includes(i.ref)||(t.push(i.ref),t.sort((s,o)=>bp(o,e)-bp(s,e)))},i=>{let s=t.indexOf(i.ref);s!==-1&&t.splice(s,1)})}};var Rr=class{constructor(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}};var d_=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function p_(r){let t="";for(let e=0;e<r;++e)e>0&&(t+=`
else `),e<r-1&&(t+=`if(test == ${e}.0){}`);return t}function Gn(r,t){if(r===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");let e=t.createShader(t.FRAGMENT_SHADER);for(;;){let i=d_.replace(/%forloop%/gi,p_(r));if(t.shaderSource(e,i),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))r=r/2|0;else break}return r}var dl=0,pl=1,fl=2,ml=3,gl=4,yl=5,Bt=class r{constructor(){this.data=0,this.blendMode=Y.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<dl)}set blend(t){!!(this.data&1<<dl)!==t&&(this.data^=1<<dl)}get offsets(){return!!(this.data&1<<pl)}set offsets(t){!!(this.data&1<<pl)!==t&&(this.data^=1<<pl)}get culling(){return!!(this.data&1<<fl)}set culling(t){!!(this.data&1<<fl)!==t&&(this.data^=1<<fl)}get depthTest(){return!!(this.data&1<<ml)}set depthTest(t){!!(this.data&1<<ml)!==t&&(this.data^=1<<ml)}get depthMask(){return!!(this.data&1<<yl)}set depthMask(t){!!(this.data&1<<yl)!==t&&(this.data^=1<<yl)}get clockwiseFrontFace(){return!!(this.data&1<<gl)}set clockwiseFrontFace(t){!!(this.data&1<<gl)!==t&&(this.data^=1<<gl)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==Y.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}static for2d(){let t=new r;return t.depthTest=!1,t.blend=!0,t}};Bt.prototype.toString=function(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`};var Js=[];function Gi(r,t){if(!r)return null;let e="";if(typeof r=="string"){let i=/\.(\w{3,4})(?:$|\?|#)/i.exec(r);i&&(e=i[1].toLowerCase())}for(let i=Js.length-1;i>=0;--i){let s=Js[i];if(s.test&&s.test(r,e))return new s(r,t)}throw new Error("Unrecognized source type to auto-detect Resource")}var Tt=class{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,e,i,s,o,n,a,h){if(arguments.length>8)throw new Error("max arguments reached");let{name:l,items:u}=this;this._aliasCount++;for(let c=0,d=u.length;c<d;c++)u[c][l](t,e,i,s,o,n,a,h);return u===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){let e=this.items.indexOf(t);return e!==-1&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}};Object.defineProperties(Tt.prototype,{dispatch:{value:Tt.prototype.emit},run:{value:Tt.prototype.emit}});var xe=class{constructor(t=0,e=0){this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new Tt("setRealSize"),this.onUpdate=new Tt("update"),this.onError=new Tt("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,e){(t!==this._width||e!==this._height)&&(this._width=t,this._height=e,this.onResize.emit(t,e))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,e,i){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,e){return!1}};var Ge=class extends xe{constructor(t,e){let{width:i,height:s}=e||{};if(!i||!s)throw new Error("BufferResource width or height invalid");super(i,s),this.data=t,this.unpackAlignment=e.unpackAlignment??4}upload(t,e,i){let s=t.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,this.unpackAlignment),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===xt.UNPACK);let o=e.realWidth,n=e.realHeight;return i.width===o&&i.height===n?s.texSubImage2D(e.target,0,0,0,o,n,e.format,i.type,this.data):(i.width=o,i.height=n,s.texImage2D(e.target,0,i.internalFormat,o,n,0,e.format,i.type,this.data)),!0}dispose(){this.data=null}static test(t){return t===null||t instanceof Int8Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array}};var f_={scaleMode:ue.NEAREST,alphaMode:xt.NPM},_l=class Hi extends Ze.default{constructor(t=null,e=null){super(),e=Object.assign({},Hi.defaultOptions,e);let{alphaMode:i,mipmap:s,anisotropicLevel:o,scaleMode:n,width:a,height:h,wrapMode:l,format:u,type:c,target:d,resolution:p,resourceOptions:f}=e;t&&!(t instanceof xe)&&(t=Gi(t,f),t.internal=!0),this.resolution=p||E.RESOLUTION,this.width=Math.round((a||0)*this.resolution)/this.resolution,this.height=Math.round((h||0)*this.resolution)/this.resolution,this._mipmap=s,this.anisotropicLevel=o,this._wrapMode=l,this._scaleMode=n,this.format=u,this.type=c,this.target=d,this.alphaMode=i,this.uid=Ke(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=a>0&&h>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(t)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(t){this._mipmap!==t&&(this._mipmap=t,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(t){this._scaleMode!==t&&(this._scaleMode=t,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(t){this._wrapMode!==t&&(this._wrapMode=t,this.dirtyStyleId++)}setStyle(t,e){let i;return t!==void 0&&t!==this.scaleMode&&(this.scaleMode=t,i=!0),e!==void 0&&e!==this.mipmap&&(this.mipmap=e,i=!0),i&&this.dirtyStyleId++,this}setSize(t,e,i){return i=i||this.resolution,this.setRealSize(t*i,e*i,i)}setRealSize(t,e,i){return this.resolution=i||this.resolution,this.width=Math.round(t)/this.resolution,this.height=Math.round(e)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=Ys(this.realWidth)&&Ys(this.realHeight)}setResolution(t){let e=this.resolution;return e===t?this:(this.resolution=t,this.valid&&(this.width=Math.round(this.width*e)/t,this.height=Math.round(this.height*e)/t,this.emit("update",this)),this._refreshPOT(),this)}setResource(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(t){this.emit("error",this,t)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete re[this.cacheId],delete Mt[this.cacheId],this.cacheId=null),this.valid=!1,this.dispose(),Hi.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(t,e,i=E.STRICT_TEXTURE_CACHE){let s=typeof t=="string",o=null;if(s)o=t;else{if(!t._pixiId){let a=e?.pixiIdPrefix||"pixiid";t._pixiId=`${a}_${Ke()}`}o=t._pixiId}let n=re[o];if(s&&i&&!n)throw new Error(`The cacheId "${o}" does not exist in BaseTextureCache.`);return n||(n=new Hi(t,e),n.cacheId=o,Hi.addToCache(n,o)),n}static fromBuffer(t,e,i,s){t=t||new Float32Array(e*i*4);let o=new Ge(t,{width:e,height:i,...s?.resourceOptions}),n,a;return t instanceof Float32Array?(n=P.RGBA,a=U.FLOAT):t instanceof Int32Array?(n=P.RGBA_INTEGER,a=U.INT):t instanceof Uint32Array?(n=P.RGBA_INTEGER,a=U.UNSIGNED_INT):t instanceof Int16Array?(n=P.RGBA_INTEGER,a=U.SHORT):t instanceof Uint16Array?(n=P.RGBA_INTEGER,a=U.UNSIGNED_SHORT):t instanceof Int8Array?(n=P.RGBA,a=U.BYTE):(n=P.RGBA,a=U.UNSIGNED_BYTE),o.internal=!0,new Hi(o,Object.assign({},f_,{type:a,format:n},s))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),re[e]&&re[e]!==t&&console.warn(`BaseTexture added to the cache with an id [${e}] that already had an entry`),re[e]=t)}static removeFromCache(t){if(typeof t=="string"){let e=re[t];if(e){let i=e.textureCacheIds.indexOf(t);return i>-1&&e.textureCacheIds.splice(i,1),delete re[t],e}}else if(t?.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)delete re[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}};_l.defaultOptions={mipmap:Ut.POW2,anisotropicLevel:0,scaleMode:ue.LINEAR,wrapMode:ye.CLAMP,alphaMode:xt.UNPACK,target:hr.TEXTURE_2D,format:P.RGBA,type:U.UNSIGNED_BYTE},_l._globalBatch=0;var W=_l;var Mr=class{constructor(){this.texArray=null,this.blend=0,this.type=le.TRIANGLES,this.start=0,this.size=0,this.data=null}};var m_=0,ut=class r{constructor(t,e=!0,i=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=i,this.static=e,this.id=m_++,this.disposeRunner=new Tt("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?ce.ELEMENT_ARRAY_BUFFER:ce.ARRAY_BUFFER}get index(){return this.type===ce.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new r(t)}};var Vi=class r{constructor(t,e=0,i=!1,s=U.FLOAT,o,n,a,h=1){this.buffer=t,this.size=e,this.normalized=i,this.type=s,this.stride=o,this.start=n,this.instance=a,this.divisor=h}destroy(){this.buffer=null}static from(t,e,i,s,o){return new r(t,e,i,s,o)}};var g_={Float32Array,Uint32Array,Int32Array,Uint8Array};function Tp(r,t){let e=0,i=0,s={};for(let h=0;h<r.length;h++)i+=t[h],e+=r[h].length;let o=new ArrayBuffer(e*4),n=null,a=0;for(let h=0;h<r.length;h++){let l=t[h],u=r[h],c=Pr(u);s[c]||(s[c]=new g_[c](o)),n=s[c];for(let d=0;d<u.length;d++){let p=(d/l|0)*i+a,f=d%l;n[p+f]=u[d]}a+=l}return new Float32Array(o)}var Ep={5126:4,5123:2,5121:1},y_=0,__={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array},ve=class r{constructor(t=[],e={}){this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=y_++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new Tt("disposeGeometry"),this.refCount=0}addAttribute(t,e,i=0,s=!1,o,n,a,h=!1){if(!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof ut||(e instanceof Array&&(e=new Float32Array(e)),e=new ut(e));let l=t.split("|");if(l.length>1){for(let c=0;c<l.length;c++)this.addAttribute(l[c],e,i,s,o);return this}let u=this.buffers.indexOf(e);return u===-1&&(this.buffers.push(e),u=this.buffers.length-1),this.attributes[t]=new Vi(u,i,s,o,n,a,h),this.instanced=this.instanced||h,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof ut||(t instanceof Array&&(t=new Uint16Array(t)),t=new ut(t)),t.type=ce.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;let t=[],e=[],i=new ut,s;for(s in this.attributes){let o=this.attributes[s],n=this.buffers[o.buffer];t.push(n.data),e.push(o.size*Ep[o.type]/4),o.buffer=0}for(i.data=Tp(t,e),s=0;s<this.buffers.length;s++)this.buffers[s]!==this.indexBuffer&&this.buffers[s].destroy();return this.buffers=[i],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(let t in this.attributes){let e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){let t=new r;for(let e=0;e<this.buffers.length;e++)t.buffers[e]=new ut(this.buffers[e].data.slice(0));for(let e in this.attributes){let i=this.attributes[e];t.attributes[e]=new Vi(i.buffer,i.size,i.normalized,i.type,i.stride,i.start,i.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=ce.ELEMENT_ARRAY_BUFFER),t}static merge(t){let e=new r,i=[],s=[],o=[],n;for(let a=0;a<t.length;a++){n=t[a];for(let h=0;h<n.buffers.length;h++)s[h]=s[h]||0,s[h]+=n.buffers[h].data.length,o[h]=0}for(let a=0;a<n.buffers.length;a++)i[a]=new __[Pr(n.buffers[a].data)](s[a]),e.buffers[a]=new ut(i[a]);for(let a=0;a<t.length;a++){n=t[a];for(let h=0;h<n.buffers.length;h++)i[h].set(n.buffers[h].data,o[h]),o[h]+=n.buffers[h].data.length}if(e.attributes=n.attributes,n.indexBuffer){e.indexBuffer=e.buffers[n.buffers.indexOf(n.indexBuffer)],e.indexBuffer.type=ce.ELEMENT_ARRAY_BUFFER;let a=0,h=0,l=0,u=0;for(let c=0;c<n.buffers.length;c++)if(n.buffers[c]!==n.indexBuffer){u=c;break}for(let c in n.attributes){let d=n.attributes[c];(d.buffer|0)===u&&(h+=d.size*Ep[d.type]/4)}for(let c=0;c<t.length;c++){let d=t[c].indexBuffer.data;for(let p=0;p<d.length;p++)e.indexBuffer.data[p+l]+=a;a+=t[c].buffers[u].data.length/h,l+=d.length}}return e}};var Zr=class extends ve{constructor(t=!1){super(),this._buffer=new ut(null,t,!1),this._indexBuffer=new ut(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,U.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,U.FLOAT).addAttribute("aColor",this._buffer,4,!0,U.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,U.FLOAT).addIndex(this._indexBuffer)}};var Br=Math.PI*2,xl=180/Math.PI,vl=Math.PI/180,dt=(r=>(r[r.POLY=0]="POLY",r[r.RECT=1]="RECT",r[r.CIRC=2]="CIRC",r[r.ELIP=3]="ELIP",r[r.RREC=4]="RREC",r))(dt||{});var K=class r{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new r(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}};K.prototype.toString=function(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`};var Hn=[new K,new K,new K,new K],z=class r{constructor(t=0,e=0,i=0,s=0){this.x=Number(t),this.y=Number(e),this.width=Number(i),this.height=Number(s),this.type=dt.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new r(0,0,0,0)}clone(){return new r(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}intersects(t,e){if(!e){let R=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=R)return!1;let N=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>N}let i=this.left,s=this.right,o=this.top,n=this.bottom;if(s<=i||n<=o)return!1;let a=Hn[0].set(t.left,t.top),h=Hn[1].set(t.left,t.bottom),l=Hn[2].set(t.right,t.top),u=Hn[3].set(t.right,t.bottom);if(l.x<=a.x||h.y<=a.y)return!1;let c=Math.sign(e.a*e.d-e.b*e.c);if(c===0||(e.apply(a,a),e.apply(h,h),e.apply(l,l),e.apply(u,u),Math.max(a.x,h.x,l.x,u.x)<=i||Math.min(a.x,h.x,l.x,u.x)>=s||Math.max(a.y,h.y,l.y,u.y)<=o||Math.min(a.y,h.y,l.y,u.y)>=n))return!1;let d=c*(h.y-a.y),p=c*(a.x-h.x),f=d*i+p*o,m=d*s+p*o,g=d*i+p*n,y=d*s+p*n;if(Math.max(f,m,g,y)<=d*a.x+p*a.y||Math.min(f,m,g,y)>=d*u.x+p*u.y)return!1;let v=c*(a.y-l.y),_=c*(l.x-a.x),x=v*i+_*o,M=v*s+_*o,G=v*i+_*n,I=v*s+_*n;return!(Math.max(x,M,G,I)<=v*a.x+_*a.y||Math.min(x,M,G,I)>=v*u.x+_*u.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2,this}fit(t){let e=Math.max(this.x,t.x),i=Math.min(this.x+this.width,t.x+t.width),s=Math.max(this.y,t.y),o=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(i-e,0),this.y=s,this.height=Math.max(o-s,0),this}ceil(t=1,e=.001){let i=Math.ceil((this.x+this.width-e)*t)/t,s=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=i-this.x,this.height=s-this.y,this}enlarge(t){let e=Math.min(this.x,t.x),i=Math.max(this.x+this.width,t.x+t.width),s=Math.min(this.y,t.y),o=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=i-e,this.y=s,this.height=o-s,this}};z.prototype.toString=function(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};var Xi=class r{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.radius=i,this.type=dt.CIRC}clone(){return new r(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;let i=this.radius*this.radius,s=this.x-t,o=this.y-e;return s*=s,o*=o,s+o<=i}getBounds(){return new z(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)}};Xi.prototype.toString=function(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`};var Wi=class r{constructor(t=0,e=0,i=0,s=0){this.x=t,this.y=e,this.width=i,this.height=s,this.type=dt.ELIP}clone(){return new r(this.x,this.y,this.width,this.height)}contains(t,e){if(this.width<=0||this.height<=0)return!1;let i=(t-this.x)/this.width,s=(e-this.y)/this.height;return i*=i,s*=s,i+s<=1}getBounds(){return new z(this.x-this.width,this.y-this.height,this.width,this.height)}};Wi.prototype.toString=function(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};var Qe=class r{constructor(...t){let e=Array.isArray(t[0])?t[0]:t;if(typeof e[0]!="number"){let i=[];for(let s=0,o=e.length;s<o;s++)i.push(e[s].x,e[s].y);e=i}this.points=e,this.type=dt.POLY,this.closeStroke=!0}clone(){let t=this.points.slice(),e=new r(t);return e.closeStroke=this.closeStroke,e}contains(t,e){let i=!1,s=this.points.length/2;for(let o=0,n=s-1;o<s;n=o++){let a=this.points[o*2],h=this.points[o*2+1],l=this.points[n*2],u=this.points[n*2+1];h>e!=u>e&&t<(l-a)*((e-h)/(u-h))+a&&(i=!i)}return i}};Qe.prototype.toString=function(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce((r,t)=>`${r}, ${t}`,"")}]`};var zi=class r{constructor(t=0,e=0,i=0,s=0,o=20){this.x=t,this.y=e,this.width=i,this.height=s,this.radius=o,this.type=dt.RREC}clone(){return new r(this.x,this.y,this.width,this.height,this.radius)}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){let i=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+i&&e<=this.y+this.height-i||t>=this.x+i&&t<=this.x+this.width-i)return!0;let s=t-(this.x+i),o=e-(this.y+i),n=i*i;if(s*s+o*o<=n||(s=t-(this.x+this.width-i),s*s+o*o<=n)||(o=e-(this.y+this.height-i),s*s+o*o<=n)||(s=t-(this.x+i),s*s+o*o<=n))return!0}return!1}};zi.prototype.toString=function(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`};var et=class r{constructor(t=1,e=0,i=0,s=1,o=0,n=0){this.array=null,this.a=t,this.b=e,this.c=i,this.d=s,this.tx=o,this.ty=n}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,i,s,o,n){return this.a=t,this.b=e,this.c=i,this.d=s,this.tx=o,this.ty=n,this}toArray(t,e){this.array||(this.array=new Float32Array(9));let i=e||this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i}apply(t,e){e=e||new K;let i=t.x,s=t.y;return e.x=this.a*i+this.c*s+this.tx,e.y=this.b*i+this.d*s+this.ty,e}applyInverse(t,e){e=e||new K;let i=1/(this.a*this.d+this.c*-this.b),s=t.x,o=t.y;return e.x=this.d*i*s+-this.c*i*o+(this.ty*this.c-this.tx*this.d)*i,e.y=this.a*i*o+-this.b*i*s+(-this.ty*this.a+this.tx*this.b)*i,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){let e=Math.cos(t),i=Math.sin(t),s=this.a,o=this.c,n=this.tx;return this.a=s*e-this.b*i,this.b=s*i+this.b*e,this.c=o*e-this.d*i,this.d=o*i+this.d*e,this.tx=n*e-this.ty*i,this.ty=n*i+this.ty*e,this}append(t){let e=this.a,i=this.b,s=this.c,o=this.d;return this.a=t.a*e+t.b*s,this.b=t.a*i+t.b*o,this.c=t.c*e+t.d*s,this.d=t.c*i+t.d*o,this.tx=t.tx*e+t.ty*s+this.tx,this.ty=t.tx*i+t.ty*o+this.ty,this}setTransform(t,e,i,s,o,n,a,h,l){return this.a=Math.cos(a+l)*o,this.b=Math.sin(a+l)*o,this.c=-Math.sin(a-h)*n,this.d=Math.cos(a-h)*n,this.tx=t-(i*this.a+s*this.c),this.ty=e-(i*this.b+s*this.d),this}prepend(t){let e=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){let i=this.a,s=this.c;this.a=i*t.a+this.b*t.c,this.b=i*t.b+this.b*t.d,this.c=s*t.a+this.d*t.c,this.d=s*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){let e=this.a,i=this.b,s=this.c,o=this.d,n=t.pivot,a=-Math.atan2(-s,o),h=Math.atan2(i,e),l=Math.abs(a+h);return l<1e-5||Math.abs(Br-l)<1e-5?(t.rotation=h,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=a,t.skew.y=h),t.scale.x=Math.sqrt(e*e+i*i),t.scale.y=Math.sqrt(s*s+o*o),t.position.x=this.tx+(n.x*e+n.y*s),t.position.y=this.ty+(n.x*i+n.y*o),t}invert(){let t=this.a,e=this.b,i=this.c,s=this.d,o=this.tx,n=t*s-e*i;return this.a=s/n,this.b=-e/n,this.c=-i/n,this.d=t/n,this.tx=(i*this.ty-s*o)/n,this.ty=-(t*this.ty-e*o)/n,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){let t=new r;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}static get IDENTITY(){return new r}static get TEMP_MATRIX(){return new r}};et.prototype.toString=function(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`};var Qr=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Jr=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],ti=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],ei=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],bl=[],wp=[],Vn=Math.sign;function x_(){for(let r=0;r<16;r++){let t=[];bl.push(t);for(let e=0;e<16;e++){let i=Vn(Qr[r]*Qr[e]+ti[r]*Jr[e]),s=Vn(Jr[r]*Qr[e]+ei[r]*Jr[e]),o=Vn(Qr[r]*ti[e]+ti[r]*ei[e]),n=Vn(Jr[r]*ti[e]+ei[r]*ei[e]);for(let a=0;a<16;a++)if(Qr[a]===i&&Jr[a]===s&&ti[a]===o&&ei[a]===n){t.push(a);break}}}for(let r=0;r<16;r++){let t=new et;t.set(Qr[r],Jr[r],ti[r],ei[r],0,0),wp.push(t)}}x_();var mt={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:r=>Qr[r],uY:r=>Jr[r],vX:r=>ti[r],vY:r=>ei[r],inv:r=>r&8?r&15:-r&7,add:(r,t)=>bl[r][t],sub:(r,t)=>bl[r][mt.inv(t)],rotate180:r=>r^4,isVertical:r=>(r&3)===2,byDirection:(r,t)=>Math.abs(r)*2<=Math.abs(t)?t>=0?mt.S:mt.N:Math.abs(t)*2<=Math.abs(r)?r>0?mt.E:mt.W:t>0?r>0?mt.SE:mt.SW:r>0?mt.NE:mt.NW,matrixAppendRotationInv:(r,t,e=0,i=0)=>{let s=wp[mt.inv(t)];s.tx=e,s.ty=i,r.append(s)}};var be=class r{constructor(t,e,i=0,s=0){this._x=i,this._y=s,this.cb=t,this.scope=e}clone(t=this.cb,e=this.scope){return new r(t,e,this._x,this._y)}set(t=0,e=t){return(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this.cb.call(this.scope)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}};be.prototype.toString=function(){return`[@pixi/math:ObservablePoint x=${this.x} y=${this.y} scope=${this.scope}]`};var Tl=class{constructor(){this.worldTransform=new et,this.localTransform=new et,this.position=new be(this.onChange,this,0,0),this.scale=new be(this.onChange,this,1,1),this.pivot=new be(this.onChange,this,0,0),this.skew=new be(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){let r=this.localTransform;this._localID!==this._currentLocalID&&(r.a=this._cx*this.scale.x,r.b=this._sx*this.scale.x,r.c=this._cy*this.scale.y,r.d=this._sy*this.scale.y,r.tx=this.position.x-(this.pivot.x*r.a+this.pivot.y*r.c),r.ty=this.position.y-(this.pivot.x*r.b+this.pivot.y*r.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(r){let t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==r._worldID){let e=r.worldTransform,i=this.worldTransform;i.a=t.a*e.a+t.b*e.c,i.b=t.a*e.b+t.b*e.d,i.c=t.c*e.a+t.d*e.c,i.d=t.c*e.b+t.d*e.d,i.tx=t.tx*e.a+t.ty*e.c+e.tx,i.ty=t.tx*e.b+t.ty*e.d+e.ty,this._parentID=r._worldID,this._worldID++}}setFromMatrix(r){r.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(r){this._rotation!==r&&(this._rotation=r,this.updateSkew())}};Tl.IDENTITY=new Tl;var ri=Tl;ri.prototype.toString=function(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`};var Sp=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`;var Ap=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function Xn(r,t,e){let i=r.createShader(t);return r.shaderSource(i,e),r.compileShader(i),i}function El(r){let t=new Array(r);for(let e=0;e<t.length;e++)t[e]=!1;return t}function to(r,t){switch(r){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return El(2*t);case"bvec3":return El(3*t);case"bvec4":return El(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}var Je=[{test:r=>r.type==="float"&&r.size===1&&!r.isArray,code:r=>`
            if(uv["${r}"] !== ud["${r}"].value)
            {
                ud["${r}"].value = uv["${r}"]
                gl.uniform1f(ud["${r}"].location, uv["${r}"])
            }
            `},{test:(r,t)=>(r.type==="sampler2D"||r.type==="samplerCube"||r.type==="sampler2DArray")&&r.size===1&&!r.isArray&&(t==null||t.castToBaseTexture!==void 0),code:r=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${r}"], t);

            if(ud["${r}"].value !== t)
            {
                ud["${r}"].value = t;
                gl.uniform1i(ud["${r}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(r,t)=>r.type==="mat3"&&r.size===1&&!r.isArray&&t.a!==void 0,code:r=>`
            gl.uniformMatrix3fv(ud["${r}"].location, false, uv["${r}"].toArray(true));
            `,codeUbo:r=>`
                var ${r}_matrix = uv.${r}.toArray(true);

                data[offset] = ${r}_matrix[0];
                data[offset+1] = ${r}_matrix[1];
                data[offset+2] = ${r}_matrix[2];
        
                data[offset + 4] = ${r}_matrix[3];
                data[offset + 5] = ${r}_matrix[4];
                data[offset + 6] = ${r}_matrix[5];
        
                data[offset + 8] = ${r}_matrix[6];
                data[offset + 9] = ${r}_matrix[7];
                data[offset + 10] = ${r}_matrix[8];
            `},{test:(r,t)=>r.type==="vec2"&&r.size===1&&!r.isArray&&t.x!==void 0,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${r}"].location, v.x, v.y);
                }`,codeUbo:r=>`
                v = uv.${r};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:r=>r.type==="vec2"&&r.size===1&&!r.isArray,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${r}"].location, v[0], v[1]);
                }
            `},{test:(r,t)=>r.type==="vec4"&&r.size===1&&!r.isArray&&t.width!==void 0,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${r}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:r=>`
                    v = uv.${r};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:(r,t)=>r.type==="vec4"&&r.size===1&&!r.isArray&&t.red!==void 0,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
                    cv[3] = v.alpha;
                    gl.uniform4f(ud["${r}"].location, v.red, v.green, v.blue, v.alpha)
                }`,codeUbo:r=>`
                    v = uv.${r};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                    data[offset+3] = v.alpha;
                `},{test:(r,t)=>r.type==="vec3"&&r.size===1&&!r.isArray&&t.red!==void 0,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
    
                    gl.uniform3f(ud["${r}"].location, v.red, v.green, v.blue)
                }`,codeUbo:r=>`
                    v = uv.${r};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                `},{test:r=>r.type==="vec4"&&r.size===1&&!r.isArray,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${r}"].location, v[0], v[1], v[2], v[3])
                }`}];var v_={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},b_={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function wl(r,t){let e=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(let i in r.uniforms){let s=t[i];if(!s){r.uniforms[i]?.group===!0&&(r.uniforms[i].ubo?e.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${i}, '${i}');
                    `):e.push(`
                        renderer.shader.syncUniformGroup(uv.${i}, syncData);
                    `));continue}let o=r.uniforms[i],n=!1;for(let a=0;a<Je.length;a++)if(Je[a].test(s,o)){e.push(Je[a].code(i,o)),n=!0;break}if(!n){let a=(s.size===1&&!s.isArray?v_:b_)[s.type].replace("location",`ud["${i}"].location`);e.push(`
            cu = ud["${i}"];
            cv = cu.value;
            v = uv["${i}"];
            ${a};`)}}return new Function("ud","uv","renderer","syncData",e.join(`
`))}var Cp={},Wn=Cp;function zn(){if(Wn===Cp||Wn?.isContextLost()){let r=E.ADAPTER.createCanvas(),t;E.PREFER_ENV>=ge.WEBGL2&&(t=r.getContext("webgl2",{})),t||(t=r.getContext("webgl",{})||r.getContext("experimental-webgl",{}),t?t.getExtension("WEBGL_draw_buffers"):t=null),Wn=t}return Wn}var jn;function Sl(){if(!jn){jn=te.MEDIUM;let r=zn();if(r&&r.getShaderPrecisionFormat){let t=r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT);t&&(jn=t.precision?te.HIGH:te.MEDIUM)}}return jn}function Pp(r,t){let e=r.getShaderSource(t).split(`
`).map((l,u)=>`${u}: ${l}`),i=r.getShaderInfoLog(t),s=i.split(`
`),o={},n=s.map(l=>parseFloat(l.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(l=>l&&!o[l]?(o[l]=!0,!0):!1),a=[""];n.forEach(l=>{e[l-1]=`%c${e[l-1]}%c`,a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});let h=e.join(`
`);a[0]=h,console.error(i),console.groupCollapsed("click to view full shader code"),console.warn(...a),console.groupEnd()}function Al(r,t,e,i){r.getProgramParameter(t,r.LINK_STATUS)||(r.getShaderParameter(e,r.COMPILE_STATUS)||Pp(r,e),r.getShaderParameter(i,r.COMPILE_STATUS)||Pp(r,i),console.error("PixiJS Error: Could not initialize shader."),r.getProgramInfoLog(t)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",r.getProgramInfoLog(t)))}var T_={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function eo(r){return T_[r]}var $n=null,Ip={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function ro(r,t){if(!$n){let e=Object.keys(Ip);$n={};for(let i=0;i<e.length;++i){let s=e[i];$n[r[s]]=Ip[s]}}return $n[t]}function Yn(r,t,e){if(r.substring(0,9)!=="precision"){let i=t;return t===te.HIGH&&e!==te.HIGH&&(i=te.MEDIUM),`precision ${i} float;
${r}`}else if(e!==te.HIGH&&r.substring(0,15)==="precision highp")return r.replace("precision highp","precision mediump");return r}var io;function qn(){if(typeof io=="boolean")return io;try{io=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{io=!1}return io}var E_=0,Kn={},Cl=class ji{constructor(t,e,i="pixi-shader",s={}){this.extra={},this.id=E_++,this.vertexSrc=t||ji.defaultVertexSrc,this.fragmentSrc=e||ji.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=s,this.vertexSrc.substring(0,8)!=="#version"&&(i=i.replace(/\s+/g,"-"),Kn[i]?(Kn[i]++,i+=`-${Kn[i]}`):Kn[i]=1,this.vertexSrc=`#define SHADER_NAME ${i}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${i}
${this.fragmentSrc}`,this.vertexSrc=Yn(this.vertexSrc,ji.defaultVertexPrecision,te.HIGH),this.fragmentSrc=Yn(this.fragmentSrc,ji.defaultFragmentPrecision,Sl())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return Ap}static get defaultFragmentSrc(){return Sp}static from(t,e,i){let s=t+e,o=Zs[s];return o||(Zs[s]=o=new ji(t,e,i)),o}};Cl.defaultVertexPrecision=te.HIGH,Cl.defaultFragmentPrecision=Se.apple.device?te.HIGH:te.MEDIUM;var qt=Cl;var w_=0,ie=class r{constructor(t,e,i){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=w_++,this.static=!!e,this.ubo=!!i,t instanceof ut?(this.buffer=t,this.buffer.type=ce.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new ut(new Float32Array(1)),this.buffer.type=ce.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,e,i){if(!this.ubo)this.uniforms[t]=new r(e,i);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(t,e,i){return new r(t,e,i)}static uboFrom(t,e){return new r(t,e??!0,!0)}};var Gt=class r{constructor(t,e){this.uniformBindCount=0,this.program=t,e?e instanceof ie?this.uniformGroup=e:this.uniformGroup=new ie(e):this.uniformGroup=new ie({}),this.disposeRunner=new Tt("disposeShader")}checkUniformExists(t,e){if(e.uniforms[t])return!0;for(let i in e.uniforms){let s=e.uniforms[i];if(s.group===!0&&this.checkUniformExists(t,s))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,e,i){let s=qt.from(t,e);return new r(s,i)}};var so=class{constructor(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},!e.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!e.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){let i=new Int32Array(t);for(let o=0;o<t;o++)i[o]=o;this.defaultGroupCache[t]=ie.from({uSamplers:i},!0);let s=this.fragTemplate;s=s.replace(/%count%/gi,`${t}`),s=s.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new qt(this.vertexSrc,s)}let e={tint:new Float32Array([1,1,1,1]),translationMatrix:new et,default:this.defaultGroupCache[t]};return new Gt(this.programCache[t],e)}generateSampleSrc(t){let e="";e+=`
`,e+=`
`;for(let i=0;i<t;i++)i>0&&(e+=`
else `),i<t-1&&(e+=`if(vTextureId < ${i}.5)`),e+=`
{`,e+=`
	color = texture2D(uSamplers[${i}], vTextureCoord);`,e+=`
}`;return e+=`
`,e+=`
`,e}};var Fr=class{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}};function Rp(){return!Se.apple.device}function Mp(r){let t=!0,e=E.ADAPTER.getNavigator();if(Se.tablet||Se.phone){if(Se.apple.device){let i=e.userAgent.match(/OS (\d+)_(\d+)?/);i&&parseInt(i[1],10)<11&&(t=!1)}if(Se.android.device){let i=e.userAgent.match(/Android\s([0-9.]*)/);i&&parseInt(i[1],10)<7&&(t=!1)}}return t?r:4}var He=class{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}};var Bp=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`;var Fp=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;var oo=class Ve extends He{constructor(t){super(t),this.setShaderGenerator(),this.geometryClass=Zr,this.vertexSize=6,this.state=Bt.for2d(),this.size=Ve.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),t.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??Mp(32),this._defaultMaxTextures}static set defaultMaxTextures(t){this._defaultMaxTextures=t}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??Rp(),this._canUploadSameBuffer}static set canUploadSameBuffer(t){this._canUploadSameBuffer=t}get MAX_TEXTURES(){return Z("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return Fp}static get defaultFragmentTemplate(){return Bp}setShaderGenerator({vertex:t=Ve.defaultVertexSrc,fragment:e=Ve.defaultFragmentTemplate}={}){this.shaderGenerator=new so(t,e)}contextChange(){let t=this.renderer.gl;E.PREFER_ENV===ge.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),Ve.defaultMaxTextures),this.maxTextures=Gn(this.maxTextures,t)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){let{_drawCallPool:t,_textureArrayPool:e}=Ve,i=this.size/4,s=Math.floor(i/this.maxTextures)+1;for(;t.length<i;)t.push(new Mr);for(;e.length<s;)e.push(new Fr);for(let o=0;o<this.maxTextures;o++)this._tempBoundTextures[o]=null}onPrerender(){this._flushId=0}render(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)}buildTexturesAndDrawCalls(){let{_bufferedTextures:t,maxTextures:e}=this,i=Ve._textureArrayPool,s=this.renderer.batch,o=this._tempBoundTextures,n=this.renderer.textureGC.count,a=++W._globalBatch,h=0,l=i[0],u=0;s.copyBoundTextures(o,e);for(let c=0;c<this._bufferSize;++c){let d=t[c];t[c]=null,d._batchEnabled!==a&&(l.count>=e&&(s.boundArray(l,o,a,e),this.buildDrawCalls(l,u,c),u=c,l=i[++h],++a),d._batchEnabled=a,d.touched=n,l.elements[l.count++]=d)}l.count>0&&(s.boundArray(l,o,a,e),this.buildDrawCalls(l,u,this._bufferSize),++h,++a);for(let c=0;c<o.length;c++)o[c]=null;W._globalBatch=a}buildDrawCalls(t,e,i){let{_bufferedElements:s,_attributeBuffer:o,_indexBuffer:n,vertexSize:a}=this,h=Ve._drawCallPool,l=this._dcIndex,u=this._aIndex,c=this._iIndex,d=h[l];d.start=this._iIndex,d.texArray=t;for(let p=e;p<i;++p){let f=s[p],m=f._texture.baseTexture,g=$s[m.alphaMode?1:0][f.blendMode];s[p]=null,e<p&&d.blend!==g&&(d.size=c-d.start,e=p,d=h[++l],d.texArray=t,d.start=c),this.packInterleavedGeometry(f,o,n,u,c),u+=f.vertexData.length/2*a,c+=f.indices.length,d.blend=g}e<i&&(d.size=c-d.start,++l),this._dcIndex=l,this._aIndex=u,this._iIndex=c}bindAndClearTexArray(t){let e=this.renderer.texture;for(let i=0;i<t.count;i++)e.bind(t.elements[i],t.ids[i]),t.elements[i]=null;t.count=0}updateGeometry(){let{_packedGeometries:t,_attributeBuffer:e,_indexBuffer:i}=this;Ve.canUploadSameBuffer?(t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(i),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,t[this._flushId]=new this.geometryClass),t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(i),this.renderer.geometry.bind(t[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){let t=this._dcIndex,{gl:e,state:i}=this.renderer,s=Ve._drawCallPool,o=null;for(let n=0;n<t;n++){let{texArray:a,type:h,size:l,start:u,blend:c}=s[n];o!==a&&(o=a,this.bindAndClearTexArray(a)),this.state.blendMode=c,i.set(this.state),e.drawElements(h,l,e.UNSIGNED_SHORT,u*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),Ve.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(t){let e=Ir(Math.ceil(t/8)),i=qs(e),s=e*8;this._aBuffers.length<=i&&(this._iBuffers.length=i+1);let o=this._aBuffers[s];return o||(this._aBuffers[s]=o=new Rr(s*this.vertexSize*4)),o}getIndexBuffer(t){let e=Ir(Math.ceil(t/12)),i=qs(e),s=e*12;this._iBuffers.length<=i&&(this._iBuffers.length=i+1);let o=this._iBuffers[i];return o||(this._iBuffers[i]=o=new Uint16Array(s)),o}packInterleavedGeometry(t,e,i,s,o){let{uint32View:n,float32View:a}=e,h=s/this.vertexSize,l=t.uvs,u=t.indices,c=t.vertexData,d=t._texture.baseTexture._batchLocation,p=Math.min(t.worldAlpha,1),f=Q.shared.setValue(t._tintRGB).toPremultiplied(p,t._texture.baseTexture.alphaMode>0);for(let m=0;m<c.length;m+=2)a[s++]=c[m],a[s++]=c[m+1],a[s++]=l[m],a[s++]=l[m+1],n[s++]=f,a[s++]=d;for(let m=0;m<u.length;m++)i[o++]=h+u[m]}};oo.defaultBatchSize=4096,oo.extension={name:"batch",type:T.RendererPlugin},oo._drawCallPool=[],oo._textureArrayPool=[];var dr=oo;w.add(dr);var Dp=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`;var Lp=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;var Pl=class no extends Gt{constructor(t,e,i){let s=qt.from(t||no.defaultVertexSrc,e||no.defaultFragmentSrc);super(s,i),this.padding=0,this.resolution=no.defaultResolution,this.multisample=no.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new Bt}apply(t,e,i,s,o){t.applyFilter(this,e,i,s)}get blendMode(){return this.state.blendMode}set blendMode(t){this.state.blendMode=t}get resolution(){return this._resolution}set resolution(t){this._resolution=t}static get defaultVertexSrc(){return Lp}static get defaultFragmentSrc(){return Dp}};Pl.defaultResolution=1,Pl.defaultMultisample=lt.NONE;var pt=Pl;var pr=class{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new Q(0),this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender;let{backgroundColor:e,background:i,backgroundAlpha:s}=t,o=i??e;o!==void 0&&(this.color=o),this.alpha=s}get color(){return this._backgroundColor.value}set color(t){this._backgroundColor.setValue(t)}get alpha(){return this._backgroundColor.alpha}set alpha(t){this._backgroundColor.setAlpha(t)}get backgroundColor(){return this._backgroundColor}destroy(){}};pr.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},pr.extension={type:[T.RendererSystem,T.CanvasRendererSystem],name:"background"};w.add(pr);var $i=class{constructor(t){this.renderer=t,this.emptyRenderer=new He(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,e){let{boundTextures:i}=this.renderer.texture;for(let s=e-1;s>=0;--s)t[s]=i[s]||null,t[s]&&(t[s]._batchLocation=s)}boundArray(t,e,i,s){let{elements:o,ids:n,count:a}=t,h=0;for(let l=0;l<a;l++){let u=o[l],c=u._batchLocation;if(c>=0&&c<s&&e[c]===u){n[l]=c;continue}for(;h<s;){let d=e[h];if(d&&d._batchEnabled===i&&d._batchLocation===h){h++;continue}n[l]=h,u._batchLocation=h,e[h]=u;break}}}destroy(){this.renderer=null}};$i.extension={type:T.RendererSystem,name:"batch"};w.add($i);var Op=0,fr=class{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=Op++}init(t){if(t.context)this.initFromContext(t.context);else{let e=this.renderer.background.alpha<1,i=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:e,premultipliedAlpha:i,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=Op++,this.renderer.runners.contextChange.emit(t);let e=this.renderer.view;e.addEventListener!==void 0&&(e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){let e=this.createContext(this.renderer.view,t);this.initFromContext(e)}createContext(t,e){let i;if(E.PREFER_ENV>=ge.WEBGL2&&(i=t.getContext("webgl2",e)),i)this.webGLVersion=2;else if(this.webGLVersion=1,i=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),!i)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=i,this.getExtensions(),this.gl}getExtensions(){let{gl:t}=this,e={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};this.webGLVersion===1?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){let t=this.renderer.view;this.renderer=null,t.removeEventListener!==void 0&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){let e=t.getContextAttributes(),i="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;i&&(this.webGLVersion=2),e&&!e.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");let s=i||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=s,s||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}};fr.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},fr.extension={type:T.RendererSystem,name:"context"};w.add(fr);var Dr=class{constructor(t,e){if(this.width=Math.round(t),this.height=Math.round(e),!this.width||!this.height)throw new Error("Framebuffer width or height is zero");this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new Tt("disposeFramebuffer"),this.multisample=lt.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,e){return this.colorTextures[t]=e||new W(null,{scaleMode:ue.NEAREST,resolution:1,mipmap:Ut.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new W(null,{scaleMode:ue.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:Ut.OFF,format:P.DEPTH_COMPONENT,type:U.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,e){if(t=Math.round(t),e=Math.round(e),!t||!e)throw new Error("Framebuffer width and height must not be zero");if(!(t===this.width&&e===this.height)){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(let i=0;i<this.colorTextures.length;i++){let s=this.colorTextures[i],o=s.resolution;s.setSize(t/o,e/o)}if(this.depthTexture){let i=this.depthTexture.resolution;this.depthTexture.setSize(t/i,e/i)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}};var ii=class extends W{constructor(t={}){if(typeof t=="number"){let e=arguments[0],i=arguments[1],s=arguments[2],o=arguments[3];t={width:e,height:i,scaleMode:s,resolution:o}}t.width=t.width??100,t.height=t.height??100,t.multisample??(t.multisample=lt.NONE),super(null,t),this.mipmap=Ut.OFF,this.valid=!0,this._clear=new Q([0,0,0,0]),this.framebuffer=new Dr(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(t){this._clear.setValue(t)}get clearColor(){return this._clear.value}get clear(){return this._clear}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}};var Ht=class extends xe{constructor(t){let e=t,i=e.naturalWidth||e.videoWidth||e.width,s=e.naturalHeight||e.videoHeight||e.height;super(i,s),this.source=t,this.noSubImage=!1}static crossOrigin(t,e,i){i===void 0&&!e.startsWith("data:")?t.crossOrigin=Un(e):i!==!1&&(t.crossOrigin=typeof i=="string"?i:"anonymous")}upload(t,e,i,s){let o=t.gl,n=e.realWidth,a=e.realHeight;if(s=s||this.source,typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement){if(!s.complete||s.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&s instanceof HTMLVideoElement&&s.readyState<=1)return!1;return o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===xt.UNPACK),!this.noSubImage&&e.target===o.TEXTURE_2D&&i.width===n&&i.height===a?o.texSubImage2D(o.TEXTURE_2D,0,0,0,e.format,i.type,s):(i.width=n,i.height=a,o.texImage2D(e.target,0,i.internalFormat,e.format,i.type,s)),!0}update(){if(this.destroyed)return;let t=this.source,e=t.naturalWidth||t.videoWidth||t.width,i=t.naturalHeight||t.videoHeight||t.height;this.resize(e,i),super.update()}dispose(){this.source=null}};var si=class extends Ht{constructor(t,e){if(e=e||{},typeof t=="string"){let i=new Image;Ht.crossOrigin(i,t,e.crossorigin),i.src=t,t=i}super(t),!t.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(e.createBitmap??E.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this.bitmap=null,this._load=null,e.autoLoad!==!1&&this.load()}load(t){return this._load?this._load:(t!==void 0&&(this.createBitmap=t),this._load=new Promise((e,i)=>{let s=this.source;this.url=s.src;let o=()=>{this.destroyed||(s.onload=null,s.onerror=null,this.update(),this._load=null,this.createBitmap?e(this.process()):e(this))};s.complete&&s.src?o():(s.onload=o,s.onerror=n=>{i(n),this.onError.emit(n)})}),this._load)}process(){let t=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);let e=globalThis.createImageBitmap,i=!t.crossOrigin||t.crossOrigin==="anonymous";return this._process=fetch(t.src,{mode:i?"cors":"no-cors"}).then(s=>s.blob()).then(s=>e(s,0,0,t.width,t.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===xt.UNPACK?"premultiply":"none"})).then(s=>this.destroyed?Promise.reject():(this.bitmap=s,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(t,e,i){if(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,e,i);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,e,i,this.bitmap),!this.preserveBitmap){let s=!0,o=e._glTextures;for(let n in o){let a=o[n];if(a!==i&&a.dirtyId!==e.dirtyId){s=!1;break}}s&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return typeof HTMLImageElement<"u"&&(typeof t=="string"||t instanceof HTMLImageElement)}};var oi=class{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,e,i){let s=e.width,o=e.height;if(i){let n=t.width/2/s,a=t.height/2/o,h=t.x/s+n,l=t.y/o+a;i=mt.add(i,mt.NW),this.x0=h+n*mt.uX(i),this.y0=l+a*mt.uY(i),i=mt.add(i,2),this.x1=h+n*mt.uX(i),this.y1=l+a*mt.uY(i),i=mt.add(i,2),this.x2=h+n*mt.uX(i),this.y2=l+a*mt.uY(i),i=mt.add(i,2),this.x3=h+n*mt.uX(i),this.y3=l+a*mt.uY(i)}else this.x0=t.x/s,this.y0=t.y/o,this.x1=(t.x+t.width)/s,this.y1=t.y/o,this.x2=(t.x+t.width)/s,this.y2=(t.y+t.height)/o,this.x3=t.x/s,this.y3=(t.y+t.height)/o;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}};oi.prototype.toString=function(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`};var Np=new oi;function Zn(r){r.destroy=function(){},r.on=function(){},r.once=function(){},r.emit=function(){}}var b=class r extends Ze.default{constructor(t,e,i,s,o,n,a){if(super(),this.noFrame=!1,e||(this.noFrame=!0,e=new z(0,0,1,1)),t instanceof r&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.trim=s,this.valid=!1,this.destroyed=!1,this._uvs=Np,this.uvMatrix=null,this.orig=i||e,this._rotate=Number(o||0),o===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=n?new K(n.x,n.y):new K(0,0),this.defaultBorders=a,this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=e:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){let{resource:e}=this.baseTexture;e?.url&&Mt[e.url]&&r.removeFromCache(e.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,r.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}clone(){let t=this._frame.clone(),e=this._frame===this.orig?t:this.orig.clone(),i=new r(this.baseTexture,!this.noFrame&&t,e,this.trim?.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(i._frame=t),i}updateUvs(){this._uvs===Np&&(this._uvs=new oi),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,e={},i=E.STRICT_TEXTURE_CACHE){let s=typeof t=="string",o=null;if(s)o=t;else if(t instanceof W){if(!t.cacheId){let a=e?.pixiIdPrefix||"pixiid";t.cacheId=`${a}-${Ke()}`,W.addToCache(t,t.cacheId)}o=t.cacheId}else{if(!t._pixiId){let a=e?.pixiIdPrefix||"pixiid";t._pixiId=`${a}_${Ke()}`}o=t._pixiId}let n=Mt[o];if(s&&i&&!n)throw new Error(`The cacheId "${o}" does not exist in TextureCache.`);return!n&&!(t instanceof W)?(e.resolution||(e.resolution=Qs(t)),n=new r(new W(t,e)),n.baseTexture.cacheId=o,W.addToCache(n.baseTexture,o),r.addToCache(n,o)):!n&&t instanceof W&&(n=new r(t),r.addToCache(n,o)),n}static fromURL(t,e){let i=Object.assign({autoLoad:!1},e?.resourceOptions),s=r.from(t,Object.assign({resourceOptions:i},e),!1),o=s.baseTexture.resource;return s.baseTexture.valid?Promise.resolve(s):o.load().then(()=>Promise.resolve(s))}static fromBuffer(t,e,i,s){return new r(W.fromBuffer(t,e,i,s))}static fromLoader(t,e,i,s){let o=new W(t,Object.assign({scaleMode:W.defaultOptions.scaleMode,resolution:Qs(e)},s)),{resource:n}=o;n instanceof si&&(n.url=e);let a=new r(o);return i||(i=e),W.addToCache(a.baseTexture,i),r.addToCache(a,i),i!==e&&(W.addToCache(a.baseTexture,e),r.addToCache(a,e)),a.baseTexture.valid?Promise.resolve(a):new Promise(h=>{a.baseTexture.once("loaded",()=>h(a))})}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),Mt[e]&&Mt[e]!==t&&console.warn(`Texture added to the cache with an id [${e}] that already had an entry`),Mt[e]=t)}static removeFromCache(t){if(typeof t=="string"){let e=Mt[t];if(e){let i=e.textureCacheIds.indexOf(t);return i>-1&&e.textureCacheIds.splice(i,1),delete Mt[t],e}}else if(t?.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)Mt[t.textureCacheIds[e]]===t&&delete Mt[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;let{x:e,y:i,width:s,height:o}=t,n=e+s>this.baseTexture.width,a=i+o>this.baseTexture.height;if(n||a){let h=n&&a?"and":"or",l=`X: ${e} + ${s} = ${e+s} > ${this.baseTexture.width}`,u=`Y: ${i} + ${o} = ${i+o} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${l} ${h} ${u}`)}this.valid=s&&o&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return r._EMPTY||(r._EMPTY=new r(new W),Zn(r._EMPTY),Zn(r._EMPTY.baseTexture)),r._EMPTY}static get WHITE(){if(!r._WHITE){let t=E.ADAPTER.createCanvas(16,16),e=t.getContext("2d");t.width=16,t.height=16,e.fillStyle="white",e.fillRect(0,0,16,16),r._WHITE=new r(W.from(t)),Zn(r._WHITE),Zn(r._WHITE.baseTexture)}return r._WHITE}};var Pe=class r extends b{constructor(t,e){super(t,e),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e,i=!0){let s=this.baseTexture.resolution,o=Math.round(t*s)/s,n=Math.round(e*s)/s;this.valid=o>0&&n>0,this._frame.width=this.orig.width=o,this._frame.height=this.orig.height=n,i&&this.baseTexture.resize(o,n),this.updateUvs()}setResolution(t){let{baseTexture:e}=this;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))}static create(t){return new r(new ii(t))}};var Yi=class{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,e,i=lt.NONE){let s=new ii(Object.assign({width:t,height:e,resolution:1,multisample:i},this.textureOptions));return new Pe(s)}getOptimalTexture(t,e,i=1,s=lt.NONE){let o;t=Math.max(Math.ceil(t*i-1e-6),1),e=Math.max(Math.ceil(e*i-1e-6),1),!this.enableFullScreen||t!==this._pixelsWidth||e!==this._pixelsHeight?(t=Ir(t),e=Ir(e),o=((t&65535)<<16|e&65535)>>>0,s>1&&(o+=s*4294967296)):o=s>1?-s:-1,this.texturePool[o]||(this.texturePool[o]=[]);let n=this.texturePool[o].pop();return n||(n=this.createTexture(t,e,s)),n.filterPoolKey=o,n.setResolution(i),n}getFilterTexture(t,e,i){let s=this.getOptimalTexture(t.width,t.height,e||t.resolution,i||lt.NONE);return s.filterFrame=t.filterFrame,s}returnTexture(t){let e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=t!==!1,t)for(let e in this.texturePool){let i=this.texturePool[e];if(i)for(let s=0;s<i.length;s++)i[s].destroy(!0)}this.texturePool={}}setScreenSize(t){if(!(t.width===this._pixelsWidth&&t.height===this._pixelsHeight)){this.enableFullScreen=t.width>0&&t.height>0;for(let e in this.texturePool){if(!(Number(e)<0))continue;let i=this.texturePool[e];if(i)for(let s=0;s<i.length;s++)i[s].destroy(!0);this.texturePool[e]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}};Yi.SCREEN_KEY=-1;var ao=class extends ve{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}};var ni=class extends ve{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new ut(this.vertices),this.uvBuffer=new ut(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,e){let i=0,s=0;return this.uvs[0]=i,this.uvs[1]=s,this.uvs[2]=i+e.width/t.width,this.uvs[3]=s,this.uvs[4]=i+e.width/t.width,this.uvs[5]=s+e.height/t.height,this.uvs[6]=i,this.uvs[7]=s+e.height/t.height,i=e.x,s=e.y,this.vertices[0]=i,this.vertices[1]=s,this.vertices[2]=i+e.width,this.vertices[3]=s,this.vertices[4]=i+e.width,this.vertices[5]=s+e.height,this.vertices[6]=i,this.vertices[7]=s+e.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}};var ho=class{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=lt.NONE,this.sourceFrame=new z,this.destinationFrame=new z,this.bindingSourceFrame=new z,this.bindingDestinationFrame=new z,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}};var Qn=[new K,new K,new K,new K],Il=new et,qi=class{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new Yi,this.statePool=[],this.quad=new ao,this.quadUv=new ni,this.tempRect=new z,this.activeState={},this.globalUniforms=new ie({outputFrame:new z,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,e){let i=this.renderer,s=this.defaultFilterStack,o=this.statePool.pop()||new ho,n=i.renderTexture,a,h;if(n.current){let g=n.current;a=g.resolution,h=g.multisample}else a=i.resolution,h=i.multisample;let l=e[0].resolution||a,u=e[0].multisample??h,c=e[0].padding,d=e[0].autoFit,p=e[0].legacy??!0;for(let g=1;g<e.length;g++){let y=e[g];l=Math.min(l,y.resolution||a),u=Math.min(u,y.multisample??h),c=this.useMaxPadding?Math.max(c,y.padding):c+y.padding,d=d&&y.autoFit,p=p||(y.legacy??!0)}s.length===1&&(this.defaultFilterStack[0].renderTexture=n.current),s.push(o),o.resolution=l,o.multisample=u,o.legacy=p,o.target=t,o.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),o.sourceFrame.pad(c);let f=this.tempRect.copyFrom(n.sourceFrame);i.projection.transform&&this.transformAABB(Il.copyFrom(i.projection.transform).invert(),f),d?(o.sourceFrame.fit(f),(o.sourceFrame.width<=0||o.sourceFrame.height<=0)&&(o.sourceFrame.width=0,o.sourceFrame.height=0)):o.sourceFrame.intersects(f)||(o.sourceFrame.width=0,o.sourceFrame.height=0),this.roundFrame(o.sourceFrame,n.current?n.current.resolution:i.resolution,n.sourceFrame,n.destinationFrame,i.projection.transform),o.renderTexture=this.getOptimalFilterTexture(o.sourceFrame.width,o.sourceFrame.height,l,u),o.filters=e,o.destinationFrame.width=o.renderTexture.width,o.destinationFrame.height=o.renderTexture.height;let m=this.tempRect;m.x=0,m.y=0,m.width=o.sourceFrame.width,m.height=o.sourceFrame.height,o.renderTexture.filterFrame=o.sourceFrame,o.bindingSourceFrame.copyFrom(n.sourceFrame),o.bindingDestinationFrame.copyFrom(n.destinationFrame),o.transform=i.projection.transform,i.projection.transform=null,n.bind(o.renderTexture,o.sourceFrame,m),i.framebuffer.clear(0,0,0,0)}pop(){let t=this.defaultFilterStack,e=t.pop(),i=e.filters;this.activeState=e;let s=this.globalUniforms.uniforms;s.outputFrame=e.sourceFrame,s.resolution=e.resolution;let o=s.inputSize,n=s.inputPixel,a=s.inputClamp;if(o[0]=e.destinationFrame.width,o[1]=e.destinationFrame.height,o[2]=1/o[0],o[3]=1/o[1],n[0]=Math.round(o[0]*e.resolution),n[1]=Math.round(o[1]*e.resolution),n[2]=1/n[0],n[3]=1/n[1],a[0]=.5*n[2],a[1]=.5*n[3],a[2]=e.sourceFrame.width*o[2]-.5*n[2],a[3]=e.sourceFrame.height*o[3]-.5*n[3],e.legacy){let l=s.filterArea;l[0]=e.destinationFrame.width,l[1]=e.destinationFrame.height,l[2]=e.sourceFrame.x,l[3]=e.sourceFrame.y,s.filterClamp=s.inputClamp}this.globalUniforms.update();let h=t[t.length-1];if(this.renderer.framebuffer.blit(),i.length===1)i[0].apply(this,e.renderTexture,h.renderTexture,_e.BLEND,e),this.returnFilterTexture(e.renderTexture);else{let l=e.renderTexture,u=this.getOptimalFilterTexture(l.width,l.height,e.resolution);u.filterFrame=l.filterFrame;let c=0;for(c=0;c<i.length-1;++c){c===1&&e.multisample>1&&(u=this.getOptimalFilterTexture(l.width,l.height,e.resolution),u.filterFrame=l.filterFrame),i[c].apply(this,l,u,_e.CLEAR,e);let d=l;l=u,u=d}i[c].apply(this,l,h.renderTexture,_e.BLEND,e),c>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(l),this.returnFilterTexture(u)}e.clear(),this.statePool.push(e)}bindAndClear(t,e=_e.CLEAR){let{renderTexture:i,state:s}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t?.filterFrame){let n=this.tempRect;n.x=0,n.y=0,n.width=t.filterFrame.width,n.height=t.filterFrame.height,i.bind(t,t.filterFrame,n)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?i.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);let o=s.stateId&1||this.forceClear;(e===_e.CLEAR||e===_e.BLIT&&o)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,e,i,s){let o=this.renderer;o.state.set(t.state),this.bindAndClear(i,s),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,o.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),o.geometry.bind(this.quadUv),o.geometry.draw(le.TRIANGLES)):(o.geometry.bind(this.quad),o.geometry.draw(le.TRIANGLE_STRIP))}calculateSpriteMatrix(t,e){let{sourceFrame:i,destinationFrame:s}=this.activeState,{orig:o}=e._texture,n=t.set(s.width,0,0,s.height,i.x,i.y),a=e.worldTransform.copyTo(et.TEMP_MATRIX);return a.invert(),n.prepend(a),n.scale(1/o.width,1/o.height),n.translate(e.anchor.x,e.anchor.y),n}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,e,i=1,s=lt.NONE){return this.texturePool.getOptimalTexture(t,e,i,s)}getFilterTexture(t,e,i){if(typeof t=="number"){let o=t;t=e,e=o}t=t||this.activeState.renderTexture;let s=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,i||lt.NONE);return s.filterFrame=t.filterFrame,s}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,e){let i=Qn[0],s=Qn[1],o=Qn[2],n=Qn[3];i.set(e.left,e.top),s.set(e.left,e.bottom),o.set(e.right,e.top),n.set(e.right,e.bottom),t.apply(i,i),t.apply(s,s),t.apply(o,o),t.apply(n,n);let a=Math.min(i.x,s.x,o.x,n.x),h=Math.min(i.y,s.y,o.y,n.y),l=Math.max(i.x,s.x,o.x,n.x),u=Math.max(i.y,s.y,o.y,n.y);e.x=a,e.y=h,e.width=l-a,e.height=u-h}roundFrame(t,e,i,s,o){if(!(t.width<=0||t.height<=0||i.width<=0||i.height<=0)){if(o){let{a:n,b:a,c:h,d:l}=o;if((Math.abs(a)>1e-4||Math.abs(h)>1e-4)&&(Math.abs(n)>1e-4||Math.abs(l)>1e-4))return}o=o?Il.copyFrom(o):Il.identity(),o.translate(-i.x,-i.y).scale(s.width/i.width,s.height/i.height).translate(s.x,s.y),this.transformAABB(o,t),t.ceil(e),this.transformAABB(o.invert(),t)}}};qi.extension={type:T.RendererSystem,name:"filter"};w.add(qi);var lo=class{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=lt.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}};var S_=new z,Ki=class{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new Dr(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);let t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new z,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let e=this.renderer.context.extensions.drawBuffers,i=this.renderer.context.extensions.depthTexture;E.PREFER_ENV===ge.WEBGL_LEGACY&&(e=null,i=null),e?t.drawBuffers=s=>e.drawBuffersWEBGL(s):(this.hasMRT=!1,t.drawBuffers=()=>{}),i||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,e,i=0){let{gl:s}=this;if(t){let o=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,s.bindFramebuffer(s.FRAMEBUFFER,o.framebuffer)),o.mipLevel!==i&&(t.dirtyId++,t.dirtyFormat++,o.mipLevel=i),o.dirtyId!==t.dirtyId&&(o.dirtyId=t.dirtyId,o.dirtyFormat!==t.dirtyFormat?(o.dirtyFormat=t.dirtyFormat,o.dirtySize=t.dirtySize,this.updateFramebuffer(t,i)):o.dirtySize!==t.dirtySize&&(o.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let n=0;n<t.colorTextures.length;n++){let a=t.colorTextures[n];this.renderer.texture.unbind(a.parentTextureArray||a)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){let n=e.width>>i,a=e.height>>i,h=n/e.width;this.setViewport(e.x*h,e.y*h,n,a)}else{let n=t.width>>i,a=t.height>>i;this.setViewport(0,0,n,a)}}else this.current&&(this.current=null,s.bindFramebuffer(s.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,e,i,s){let o=this.viewport;t=Math.round(t),e=Math.round(e),i=Math.round(i),s=Math.round(s),(o.width!==i||o.height!==s||o.x!==t||o.y!==e)&&(o.x=t,o.y=e,o.width=i,o.height=s,this.gl.viewport(t,e,i,s))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,e,i,s,o=dn.COLOR|dn.DEPTH){let{gl:n}=this;n.clearColor(t,e,i,s),n.clear(o)}initFramebuffer(t){let{gl:e}=this,i=new lo(e.createFramebuffer());return i.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=i,this.managedFramebuffers.push(t),t.disposeRunner.add(this),i}resizeFramebuffer(t){let{gl:e}=this,i=t.glFramebuffers[this.CONTEXT_UID];if(i.stencil){e.bindRenderbuffer(e.RENDERBUFFER,i.stencil);let n;this.renderer.context.webGLVersion===1?n=e.DEPTH_STENCIL:t.depth&&t.stencil?n=e.DEPTH24_STENCIL8:t.depth?n=e.DEPTH_COMPONENT24:n=e.STENCIL_INDEX8,i.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,n,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,n,t.width,t.height)}let s=t.colorTextures,o=s.length;e.drawBuffers||(o=Math.min(o,1));for(let n=0;n<o;n++){let a=s[n],h=a.parentTextureArray||a;this.renderer.texture.bind(h,0),n===0&&i.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,i.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,h._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,e){let{gl:i}=this,s=t.glFramebuffers[this.CONTEXT_UID],o=t.colorTextures,n=o.length;i.drawBuffers||(n=Math.min(n,1)),s.multisample>1&&this.canMultisampleFramebuffer(t)?s.msaaBuffer=s.msaaBuffer||i.createRenderbuffer():s.msaaBuffer&&(i.deleteRenderbuffer(s.msaaBuffer),s.msaaBuffer=null,s.blitFramebuffer&&(s.blitFramebuffer.dispose(),s.blitFramebuffer=null));let a=[];for(let h=0;h<n;h++){let l=o[h],u=l.parentTextureArray||l;this.renderer.texture.bind(u,0),h===0&&s.msaaBuffer?(i.bindRenderbuffer(i.RENDERBUFFER,s.msaaBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,s.multisample,u._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,s.msaaBuffer)):(i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+h,l.target,u._glTextures[this.CONTEXT_UID].texture,e),a.push(i.COLOR_ATTACHMENT0+h))}if(a.length>1&&i.drawBuffers(a),t.depthTexture&&this.writeDepthTexture){let h=t.depthTexture;this.renderer.texture.bind(h,0),i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,h._glTextures[this.CONTEXT_UID].texture,e)}if((t.stencil||t.depth)&&!(t.depthTexture&&this.writeDepthTexture)){s.stencil=s.stencil||i.createRenderbuffer();let h,l;this.renderer.context.webGLVersion===1?(h=i.DEPTH_STENCIL_ATTACHMENT,l=i.DEPTH_STENCIL):t.depth&&t.stencil?(h=i.DEPTH_STENCIL_ATTACHMENT,l=i.DEPTH24_STENCIL8):t.depth?(h=i.DEPTH_ATTACHMENT,l=i.DEPTH_COMPONENT24):(h=i.STENCIL_ATTACHMENT,l=i.STENCIL_INDEX8),i.bindRenderbuffer(i.RENDERBUFFER,s.stencil),s.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,s.multisample,l,t.width,t.height):i.renderbufferStorage(i.RENDERBUFFER,l,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,h,i.RENDERBUFFER,s.stencil)}else s.stencil&&(i.deleteRenderbuffer(s.stencil),s.stencil=null)}canMultisampleFramebuffer(t){return this.renderer.context.webGLVersion!==1&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){let{msaaSamples:e}=this,i=lt.NONE;if(t<=1||e===null)return i;for(let s=0;s<e.length;s++)if(e[s]<=t){i=e[s];break}return i===1&&(i=lt.NONE),i}blit(t,e,i){let{current:s,renderer:o,gl:n,CONTEXT_UID:a}=this;if(o.context.webGLVersion!==2||!s)return;let h=s.glFramebuffers[a];if(!h)return;if(!t){if(!h.msaaBuffer)return;let u=s.colorTextures[0];if(!u)return;h.blitFramebuffer||(h.blitFramebuffer=new Dr(s.width,s.height),h.blitFramebuffer.addColorTexture(0,u)),t=h.blitFramebuffer,t.colorTextures[0]!==u&&(t.colorTextures[0]=u,t.dirtyId++,t.dirtyFormat++),(t.width!==s.width||t.height!==s.height)&&(t.width=s.width,t.height=s.height,t.dirtyId++,t.dirtySize++)}e||(e=S_,e.width=s.width,e.height=s.height),i||(i=e);let l=e.width===i.width&&e.height===i.height;this.bind(t),n.bindFramebuffer(n.READ_FRAMEBUFFER,h.framebuffer),n.blitFramebuffer(e.left,e.top,e.right,e.bottom,i.left,i.top,i.right,i.bottom,n.COLOR_BUFFER_BIT,l?n.NEAREST:n.LINEAR),n.bindFramebuffer(n.READ_FRAMEBUFFER,t.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(t,e){let i=t.glFramebuffers[this.CONTEXT_UID],s=this.gl;if(!i)return;delete t.glFramebuffers[this.CONTEXT_UID];let o=this.managedFramebuffers.indexOf(t);o>=0&&this.managedFramebuffers.splice(o,1),t.disposeRunner.remove(this),e||(s.deleteFramebuffer(i.framebuffer),i.msaaBuffer&&s.deleteRenderbuffer(i.msaaBuffer),i.stencil&&s.deleteRenderbuffer(i.stencil)),i.blitFramebuffer&&this.disposeFramebuffer(i.blitFramebuffer,e)}disposeAll(t){let e=this.managedFramebuffers;this.managedFramebuffers=[];for(let i=0;i<e.length;i++)this.disposeFramebuffer(e[i],t)}forceStencil(){let t=this.current;if(!t)return;let e=t.glFramebuffers[this.CONTEXT_UID];if(!e||e.stencil&&t.stencil)return;t.stencil=!0;let i=t.width,s=t.height,o=this.gl,n=e.stencil=o.createRenderbuffer();o.bindRenderbuffer(o.RENDERBUFFER,n);let a,h;this.renderer.context.webGLVersion===1?(a=o.DEPTH_STENCIL_ATTACHMENT,h=o.DEPTH_STENCIL):t.depth?(a=o.DEPTH_STENCIL_ATTACHMENT,h=o.DEPTH24_STENCIL8):(a=o.STENCIL_ATTACHMENT,h=o.STENCIL_INDEX8),e.msaaBuffer?o.renderbufferStorageMultisample(o.RENDERBUFFER,e.multisample,h,i,s):o.renderbufferStorage(o.RENDERBUFFER,h,i,s),o.framebufferRenderbuffer(o.FRAMEBUFFER,a,o.RENDERBUFFER,n)}reset(){this.current=this.unknownFramebuffer,this.viewport=new z}destroy(){this.renderer=null}};Ki.extension={type:T.RendererSystem,name:"framebuffer"};w.add(Ki);var Rl={5126:4,5123:2,5121:1},Zi=class{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);let t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,e.webGLVersion!==2){let i=this.renderer.context.extensions.vertexArrayObject;E.PREFER_ENV===ge.WEBGL_LEGACY&&(i=null),i?(t.createVertexArray=()=>i.createVertexArrayOES(),t.bindVertexArray=s=>i.bindVertexArrayOES(s),t.deleteVertexArray=s=>i.deleteVertexArrayOES(s)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(e.webGLVersion!==2){let i=t.getExtension("ANGLE_instanced_arrays");i?(t.vertexAttribDivisor=(s,o)=>i.vertexAttribDivisorANGLE(s,o),t.drawElementsInstanced=(s,o,n,a,h)=>i.drawElementsInstancedANGLE(s,o,n,a,h),t.drawArraysInstanced=(s,o,n,a)=>i.drawArraysInstancedANGLE(s,o,n,a)):this.hasInstance=!1}this.canUseUInt32ElementIndex=e.webGLVersion===2||!!e.extensions.uint32ElementIndex}bind(t,e){e=e||this.renderer.shader.shader;let{gl:i}=this,s=t.glVertexArrayObjects[this.CONTEXT_UID],o=!1;s||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=s={},o=!0);let n=s[e.program.id]||this.initGeometryVao(t,e,o);this._activeGeometry=t,this._activeVao!==n&&(this._activeVao=n,this.hasVao?i.bindVertexArray(n):this.activateVao(t,e.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){let t=this._activeGeometry,e=this.renderer.buffer;for(let i=0;i<t.buffers.length;i++){let s=t.buffers[i];e.update(s)}}checkCompatibility(t,e){let i=t.attributes,s=e.attributeData;for(let o in s)if(!i[o])throw new Error(`shader and geometry incompatible, geometry missing the "${o}" attribute`)}getSignature(t,e){let i=t.attributes,s=e.attributeData,o=["g",t.id];for(let n in i)s[n]&&o.push(n,s[n].location);return o.join("-")}initGeometryVao(t,e,i=!0){let s=this.gl,o=this.CONTEXT_UID,n=this.renderer.buffer,a=e.program;a.glPrograms[o]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,a);let h=this.getSignature(t,a),l=t.glVertexArrayObjects[this.CONTEXT_UID],u=l[h];if(u)return l[a.id]=u,u;let c=t.buffers,d=t.attributes,p={},f={};for(let m in c)p[m]=0,f[m]=0;for(let m in d)!d[m].size&&a.attributeData[m]?d[m].size=a.attributeData[m].size:d[m].size||console.warn(`PIXI Geometry attribute '${m}' size cannot be determined (likely the bound shader does not have the attribute)`),p[d[m].buffer]+=d[m].size*Rl[d[m].type];for(let m in d){let g=d[m],y=g.size;g.stride===void 0&&(p[g.buffer]===y*Rl[g.type]?g.stride=0:g.stride=p[g.buffer]),g.start===void 0&&(g.start=f[g.buffer],f[g.buffer]+=y*Rl[g.type])}u=s.createVertexArray(),s.bindVertexArray(u);for(let m=0;m<c.length;m++){let g=c[m];n.bind(g),i&&g._glBuffers[o].refCount++}return this.activateVao(t,a),l[a.id]=u,l[h]=u,s.bindVertexArray(null),n.unbind(ce.ARRAY_BUFFER),u}disposeGeometry(t,e){if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];let i=t.glVertexArrayObjects[this.CONTEXT_UID],s=this.gl,o=t.buffers,n=this.renderer?.buffer;if(t.disposeRunner.remove(this),!!i){if(n)for(let a=0;a<o.length;a++){let h=o[a]._glBuffers[this.CONTEXT_UID];h&&(h.refCount--,h.refCount===0&&!e&&n.dispose(o[a],e))}if(!e){for(let a in i)if(a[0]==="g"){let h=i[a];this._activeVao===h&&this.unbind(),s.deleteVertexArray(h)}}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){let e=Object.keys(this.managedGeometries);for(let i=0;i<e.length;i++)this.disposeGeometry(this.managedGeometries[e[i]],t)}activateVao(t,e){let i=this.gl,s=this.CONTEXT_UID,o=this.renderer.buffer,n=t.buffers,a=t.attributes;t.indexBuffer&&o.bind(t.indexBuffer);let h=null;for(let l in a){let u=a[l],c=n[u.buffer],d=c._glBuffers[s];if(e.attributeData[l]){h!==d&&(o.bind(c),h=d);let p=e.attributeData[l].location;if(i.enableVertexAttribArray(p),i.vertexAttribPointer(p,u.size,u.type||i.FLOAT,u.normalized,u.stride,u.start),u.instance)if(this.hasInstance)i.vertexAttribDivisor(p,u.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(t,e,i,s){let{gl:o}=this,n=this._activeGeometry;if(n.indexBuffer){let a=n.indexBuffer.data.BYTES_PER_ELEMENT,h=a===2?o.UNSIGNED_SHORT:o.UNSIGNED_INT;a===2||a===4&&this.canUseUInt32ElementIndex?n.instanced?o.drawElementsInstanced(t,e||n.indexBuffer.data.length,h,(i||0)*a,s||1):o.drawElements(t,e||n.indexBuffer.data.length,h,(i||0)*a):console.warn("unsupported index buffer type: uint32")}else n.instanced?o.drawArraysInstanced(t,i,e||n.getSize(),s||1):o.drawArrays(t,i,e||n.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}};Zi.extension={type:T.RendererSystem,name:"geometry"};w.add(Zi);var kp=new et,Lr=class{constructor(t,e){this._texture=t,this.mapCoord=new et,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof e>"u"?.5:e,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,e){e===void 0&&(e=t);let i=this.mapCoord;for(let s=0;s<t.length;s+=2){let o=t[s],n=t[s+1];e[s]=o*i.a+n*i.c+i.tx,e[s+1]=o*i.b+n*i.d+i.ty}return e}update(t){let e=this._texture;if(!e||!e.valid||!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;let i=e._uvs;this.mapCoord.set(i.x1-i.x0,i.y1-i.y0,i.x3-i.x0,i.y3-i.y0,i.x0,i.y0);let s=e.orig,o=e.trim;o&&(kp.set(s.width/o.width,0,0,s.height/o.height,-o.x/o.width,-o.y/o.height),this.mapCoord.append(kp));let n=e.baseTexture,a=this.uClampFrame,h=this.clampMargin/n.resolution,l=this.clampOffset;return a[0]=(e._frame.x+h+l)/n.width,a[1]=(e._frame.y+h+l)/n.height,a[2]=(e._frame.x+e._frame.width-h+l)/n.width,a[3]=(e._frame.y+e._frame.height-h+l)/n.height,this.uClampOffset[0]=l/n.realWidth,this.uClampOffset[1]=l/n.realHeight,this.isSimple=e._frame.width===n.width&&e._frame.height===n.height&&e.rotate===0,!0}};var Up=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`;var Gp=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;var uo=class extends pt{constructor(t,e,i){let s=null;typeof t!="string"&&e===void 0&&i===void 0&&(s=t,t=void 0,e=void 0,i=void 0),super(t||Gp,e||Up,i),this.maskSprite=s,this.maskMatrix=new et}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,e,i,s){let o=this._maskSprite,n=o._texture;n.valid&&(n.uvMatrix||(n.uvMatrix=new Lr(n,0)),n.uvMatrix.update(),this.uniforms.npmAlpha=n.baseTexture.alphaMode?0:1,this.uniforms.mask=n,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,o).prepend(n.uvMatrix.mapCoord),this.uniforms.alpha=o.worldAlpha,this.uniforms.maskClamp=n.uvMatrix.uClampFrame,t.applyFilter(this,e,i,s))}};var co=class{constructor(t=null){this.type=bt.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=pt.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=bt.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}};var Qi=class{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,e){let i=e;if(!i.isMaskData){let o=this.maskDataPool.pop()||new co;o.pooled=!0,o.maskObject=e,i=o}let s=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(i.copyCountersOrReset(s),i._colorMask=s?s._colorMask:15,i.autoDetect&&this.detect(i),i._target=t,i.type!==bt.SPRITE&&this.maskStack.push(i),i.enabled)switch(i.type){case bt.SCISSOR:this.renderer.scissor.push(i);break;case bt.STENCIL:this.renderer.stencil.push(i);break;case bt.SPRITE:i.copyCountersOrReset(null),this.pushSpriteMask(i);break;case bt.COLOR:this.pushColorMask(i);break;default:break}i.type===bt.SPRITE&&this.maskStack.push(i)}pop(t){let e=this.maskStack.pop();if(!(!e||e._target!==t)){if(e.enabled)switch(e.type){case bt.SCISSOR:this.renderer.scissor.pop(e);break;case bt.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case bt.SPRITE:this.popSpriteMask(e);break;case bt.COLOR:this.popColorMask(e);break;default:break}if(e.reset(),e.pooled&&this.maskDataPool.push(e),this.maskStack.length!==0){let i=this.maskStack[this.maskStack.length-1];i.type===bt.SPRITE&&i._filters&&(i._filters[0].maskSprite=i.maskObject)}}}detect(t){let e=t.maskObject;e?e.isSprite?t.type=bt.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=bt.SCISSOR:t.type=bt.STENCIL:t.type=bt.COLOR}pushSpriteMask(t){let{maskObject:e}=t,i=t._target,s=t._filters;s||(s=this.alphaMaskPool[this.alphaMaskIndex],s||(s=this.alphaMaskPool[this.alphaMaskIndex]=[new uo])),s[0].resolution=t.resolution,s[0].multisample=t.multisample,s[0].maskSprite=e;let o=i.filterArea;i.filterArea=e.getBounds(!0),this.renderer.filter.push(i,s),i.filterArea=o,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){let e=t._colorMask,i=t._colorMask=e&t.colorMask;i!==e&&this.renderer.gl.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)}popColorMask(t){let e=t._colorMask,i=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;i!==e&&this.renderer.gl.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)}destroy(){this.renderer=null}};Qi.extension={type:T.RendererSystem,name:"mask"};w.add(Qi);var Ji=class{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){let{gl:e}=this.renderer,i=this.getStackLength();this.maskStack=t;let s=this.getStackLength();s!==i&&(s===0?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}};var Hp=new et,Vp=[],Xp=class Jn extends Ji{constructor(t){super(t),this.glConst=E.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){let t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0}calcScissorRect(t){if(t._scissorRectLocal)return;let e=t._scissorRect,{maskObject:i}=t,{renderer:s}=this,o=s.renderTexture,n=i.getBounds(!0,Vp.pop()??new z);this.roundFrameToPixels(n,o.current?o.current.resolution:s.resolution,o.sourceFrame,o.destinationFrame,s.projection.transform),e&&n.fit(e),t._scissorRectLocal=n}static isMatrixRotated(t){if(!t)return!1;let{a:e,b:i,c:s,d:o}=t;return(Math.abs(i)>1e-4||Math.abs(s)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(o)>1e-4)}testScissor(t){let{maskObject:e}=t;if(!e.isFastRect||!e.isFastRect()||Jn.isMatrixRotated(e.worldTransform)||Jn.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(t);let i=t._scissorRectLocal;return i.width>0&&i.height>0}roundFrameToPixels(t,e,i,s,o){Jn.isMatrixRotated(o)||(o=o?Hp.copyFrom(o):Hp.identity(),o.translate(-i.x,-i.y).scale(s.width/i.width,s.height/i.height).translate(s.x,s.y),this.renderer.filter.transformAABB(o,t),t.fit(s),t.x=Math.round(t.x*e),t.y=Math.round(t.y*e),t.width=Math.round(t.width*e),t.height=Math.round(t.height*e))}push(t){t._scissorRectLocal||this.calcScissorRect(t);let{gl:e}=this.renderer;t._scissorRect||e.enable(e.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=t._scissorRectLocal,this._useCurrent()}pop(t){let{gl:e}=this.renderer;t&&Vp.push(t._scissorRectLocal),this.getStackLength()>0?this._useCurrent():e.disable(e.SCISSOR_TEST)}_useCurrent(){let t=this.maskStack[this.maskStack.length-1]._scissorRect,e;this.renderer.renderTexture.current?e=t.y:e=this.renderer.height-t.height-t.y,this.renderer.gl.scissor(t.x,e,t.width,t.height)}};Xp.extension={type:T.RendererSystem,name:"scissor"};var Ml=Xp;w.add(Ml);var ts=class extends Ji{constructor(t){super(t),this.glConst=E.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){let t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){let e=t.maskObject,{gl:i}=this.renderer,s=t._stencilCounter;s===0&&(this.renderer.framebuffer.forceStencil(),i.clearStencil(0),i.clear(i.STENCIL_BUFFER_BIT),i.enable(i.STENCIL_TEST)),t._stencilCounter++;let o=t._colorMask;o!==0&&(t._colorMask=0,i.colorMask(!1,!1,!1,!1)),i.stencilFunc(i.EQUAL,s,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,o!==0&&(t._colorMask=o,i.colorMask((o&1)!==0,(o&2)!==0,(o&4)!==0,(o&8)!==0)),this._useCurrent()}pop(t){let e=this.renderer.gl;if(this.getStackLength()===0)e.disable(e.STENCIL_TEST);else{let i=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,s=i?i._colorMask:15;s!==0&&(i._colorMask=0,e.colorMask(!1,!1,!1,!1)),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,s!==0&&(i._colorMask=s,e.colorMask((s&1)!==0,(s&2)!==0,(s&4)!==0,(s&8)!==0)),this._useCurrent()}}_useCurrent(){let t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}};ts.extension={type:T.RendererSystem,name:"stencil"};w.add(ts);var es=class{constructor(t){this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return Z("7.0.0","renderer.plugins.extract has moved to renderer.extract"),t.extract}},prepare:{enumerable:!1,get(){return Z("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),t.prepare}},interaction:{enumerable:!1,get(){return Z("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),t.events}}})}init(){let t=this.rendererPlugins;for(let e in t)this.plugins[e]=new t[e](this.renderer)}destroy(){for(let t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}};es.extension={type:[T.RendererSystem,T.CanvasRendererSystem],name:"_plugin"};w.add(es);var rs=class{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new et,this.transform=null}update(t,e,i,s){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,i,s),this.transform&&this.projectionMatrix.append(this.transform);let o=this.renderer;o.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,o.globalUniforms.update(),o.shader.shader&&o.shader.syncUniformGroup(o.shader.shader.uniforms.globals)}calculateProjection(t,e,i,s){let o=this.projectionMatrix,n=s?-1:1;o.identity(),o.a=1/e.width*2,o.d=n*(1/e.height*2),o.tx=-1-e.x*o.a,o.ty=-n-e.y*o.d}setTransform(t){}destroy(){this.renderer=null}};rs.extension={type:T.RendererSystem,name:"projection"};w.add(rs);var A_=new ri,Wp=new z,is=class{constructor(t){this.renderer=t,this._tempMatrix=new et}generateTexture(t,e){let{region:i,...s}=e||{},o=i?.copyTo(Wp)||t.getLocalBounds(Wp,!0),n=s.resolution||this.renderer.resolution;o.width=Math.max(o.width,1/n),o.height=Math.max(o.height,1/n),s.width=o.width,s.height=o.height,s.resolution=n,s.multisample??(s.multisample=this.renderer.multisample);let a=Pe.create(s);this._tempMatrix.tx=-o.x,this._tempMatrix.ty=-o.y;let h=t.transform;return t.transform=A_,this.renderer.render(t,{renderTexture:a,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=h,a}destroy(){}};is.extension={type:[T.RendererSystem,T.CanvasRendererSystem],name:"textureGenerator"};w.add(is);var ai=new z,po=new z,ss=class{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new z,this.destinationFrame=new z,this.viewportFrame=new z}contextChange(){let t=this.renderer?.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}bind(t=null,e,i){let s=this.renderer;this.current=t;let o,n,a;t?(o=t.baseTexture,a=o.resolution,e||(ai.width=t.frame.width,ai.height=t.frame.height,e=ai),i||(po.x=t.frame.x,po.y=t.frame.y,po.width=e.width,po.height=e.height,i=po),n=o.framebuffer):(a=s.resolution,e||(ai.width=s._view.screen.width,ai.height=s._view.screen.height,e=ai),i||(i=ai,i.width=e.width,i.height=e.height));let h=this.viewportFrame;h.x=i.x*a,h.y=i.y*a,h.width=i.width*a,h.height=i.height*a,t||(h.y=s.view.height-(h.y+h.height)),h.ceil(),this.renderer.framebuffer.bind(n,h),this.renderer.projection.update(i,e,a,!n),t?this.renderer.mask.setMaskStack(o.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(i)}clear(t,e){let i=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,s=Q.shared.setValue(t||i);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&s.premultiply(s.alpha);let o=this.destinationFrame,n=this.current?this.current.baseTexture:this.renderer._view.screen,a=o.width!==n.width||o.height!==n.height;if(a){let{x:h,y:l,width:u,height:c}=this.viewportFrame;h=Math.round(h),l=Math.round(l),u=Math.round(u),c=Math.round(c),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(h,l,u,c)}this.renderer.framebuffer.clear(s.red,s.green,s.blue,s.alpha,e),a&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}};ss.extension={type:T.RendererSystem,name:"renderTexture"};w.add(ss);var fo=class{constructor(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}};function zp(r,t){let e={},i=t.getProgramParameter(r,t.ACTIVE_ATTRIBUTES);for(let s=0;s<i;s++){let o=t.getActiveAttrib(r,s);if(o.name.startsWith("gl_"))continue;let n=ro(t,o.type),a={type:n,name:o.name,size:eo(n),location:t.getAttribLocation(r,o.name)};e[o.name]=a}return e}function jp(r,t){let e={},i=t.getProgramParameter(r,t.ACTIVE_UNIFORMS);for(let s=0;s<i;s++){let o=t.getActiveUniform(r,s),n=o.name.replace(/\[.*?\]$/,""),a=!!o.name.match(/\[.*?\]$/),h=ro(t,o.type);e[n]={name:n,index:s,type:h,size:o.size,isArray:a,value:to(h,o.size)}}return e}function Bl(r,t){let e=Xn(r,r.VERTEX_SHADER,t.vertexSrc),i=Xn(r,r.FRAGMENT_SHADER,t.fragmentSrc),s=r.createProgram();r.attachShader(s,e),r.attachShader(s,i);let o=t.extra?.transformFeedbackVaryings;if(o&&(typeof r.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):r.transformFeedbackVaryings(s,o.names,o.bufferMode==="separate"?r.SEPARATE_ATTRIBS:r.INTERLEAVED_ATTRIBS)),r.linkProgram(s),r.getProgramParameter(s,r.LINK_STATUS)||Al(r,s,e,i),t.attributeData=zp(s,r),t.uniformData=jp(s,r),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){let a=Object.keys(t.attributeData);a.sort((h,l)=>h>l?1:-1);for(let h=0;h<a.length;h++)t.attributeData[a[h]].location=h,r.bindAttribLocation(s,h,a[h]);r.linkProgram(s)}r.deleteShader(e),r.deleteShader(i);let n={};for(let a in t.uniformData){let h=t.uniformData[a];n[a]={location:r.getUniformLocation(s,a),value:to(h.type,h.size)}}return new fo(s,n)}function C_(r,t,e,i,s){e.buffer.update(s)}var P_={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},$p={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function Yp(r){let t=r.map(o=>({data:o,offset:0,dataLen:0,dirty:0})),e=0,i=0,s=0;for(let o=0;o<t.length;o++){let n=t[o];if(e=$p[n.data.type],n.data.size>1&&(e=Math.max(e,16)*n.data.size),n.dataLen=e,i%e!==0&&i<16){let a=i%e%16;i+=a,s+=a}i+e>16?(s=Math.ceil(s/16)*16,n.offset=s,s+=e,i=e):(n.offset=s,i+=e,s+=e)}return s=Math.ceil(s/16)*16,{uboElements:t,size:s}}function qp(r,t){let e=[];for(let i in r)t[i]&&e.push(t[i]);return e.sort((i,s)=>i.index-s.index),e}function Fl(r,t){if(!r.autoManage)return{size:0,syncFunc:C_};let e=qp(r.uniforms,t),{uboElements:i,size:s}=Yp(e),o=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let n=0;n<i.length;n++){let a=i[n],h=r.uniforms[a.data.name],l=a.data.name,u=!1;for(let c=0;c<Je.length;c++){let d=Je[c];if(d.codeUbo&&d.test(a.data,h)){o.push(`offset = ${a.offset/4};`,Je[c].codeUbo(a.data.name,h)),u=!0;break}}if(!u)if(a.data.size>1){let c=eo(a.data.type),d=Math.max($p[a.data.type]/16,1),p=c/d,f=(4-p%4)%4;o.push(`
                cv = ud.${l}.value;
                v = uv.${l};
                offset = ${a.offset/4};

                t = 0;

                for(var i=0; i < ${a.data.size*d}; i++)
                {
                    for(var j = 0; j < ${p}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${f};
                }

                `)}else{let c=P_[a.data.type];o.push(`
                cv = ud.${l}.value;
                v = uv.${l};
                offset = ${a.offset/4};
                ${c};
                `)}}return o.push(`
       renderer.buffer.update(buffer);
    `),{size:s,syncFunc:new Function("ud","uv","renderer","syncData","buffer",o.join(`
`))}}var I_=0,ta={textureCount:0,uboCount:0},os=class{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=I_++}systemCheck(){if(!qn())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;let i=t.program,s=i.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==i&&(this.program=i,this.gl.useProgram(s.program)),e||(ta.textureCount=0,ta.uboCount=0,this.syncUniformGroup(t.uniformGroup,ta)),s}setUniforms(t){let e=this.shader.program,i=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(i.uniformData,t,this.renderer)}syncUniformGroup(t,e){let i=this.getGlProgram();(!t.static||t.dirtyId!==i.uniformDirtyGroups[t.id])&&(i.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,i,e))}syncUniforms(t,e,i){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,i)}createSyncGroups(t){let e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=wl(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,e){let i=this.getGlProgram();if(!t.static||t.dirtyId!==0||!i.uniformGroups[t.id]){t.dirtyId=0;let s=i.uniformGroups[t.id]||this.createSyncBufferGroup(t,i,e);t.buffer.update(),s(i.uniformData,t.uniforms,this.renderer,ta,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,i.uniformBufferBindings[e])}createSyncBufferGroup(t,e,i){let{gl:s}=this.renderer;this.renderer.buffer.bind(t.buffer);let o=this.gl.getUniformBlockIndex(e.program,i);e.uniformBufferBindings[i]=this.shader.uniformBindCount,s.uniformBlockBinding(e.program,o,this.shader.uniformBindCount),this.shader.uniformBindCount++;let n=this.getSignature(t,this.shader.program.uniformData,"ubo"),a=this._uboCache[n];if(a||(a=this._uboCache[n]=Fl(t,this.shader.program.uniformData)),t.autoManage){let h=new Float32Array(a.size/4);t.buffer.update(h)}return e.uniformGroups[t.id]=a.syncFunc,e.uniformGroups[t.id]}getSignature(t,e,i){let s=t.uniforms,o=[`${i}-`];for(let n in s)o.push(n),e[n]&&o.push(e[n].type);return o.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){let e=this.gl,i=t.program,s=Bl(e,i);return i.glPrograms[this.renderer.CONTEXT_UID]=s,s}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}};os.extension={type:T.RendererSystem,name:"shader"};w.add(os);var mr=class{constructor(t){this.renderer=t}run(t){let{renderer:e}=this;e.runners.init.emit(e.options),t.hello&&console.log(`PixiJS 7.3.2 - ${e.rendererLogId} - https://pixijs.com`),e.resize(e.screen.width,e.screen.height)}destroy(){}};mr.defaultOptions={hello:!1},mr.extension={type:[T.RendererSystem,T.CanvasRendererSystem],name:"startup"};w.add(mr);function Kp(r,t=[]){return t[Y.NORMAL]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[Y.ADD]=[r.ONE,r.ONE],t[Y.MULTIPLY]=[r.DST_COLOR,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA],t[Y.SCREEN]=[r.ONE,r.ONE_MINUS_SRC_COLOR,r.ONE,r.ONE_MINUS_SRC_ALPHA],t[Y.OVERLAY]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[Y.DARKEN]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[Y.LIGHTEN]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[Y.COLOR_DODGE]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[Y.COLOR_BURN]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[Y.HARD_LIGHT]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[Y.SOFT_LIGHT]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[Y.DIFFERENCE]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[Y.EXCLUSION]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[Y.HUE]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[Y.SATURATION]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[Y.COLOR]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[Y.LUMINOSITY]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[Y.NONE]=[0,0],t[Y.NORMAL_NPM]=[r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA],t[Y.ADD_NPM]=[r.SRC_ALPHA,r.ONE,r.ONE,r.ONE],t[Y.SCREEN_NPM]=[r.SRC_ALPHA,r.ONE_MINUS_SRC_COLOR,r.ONE,r.ONE_MINUS_SRC_ALPHA],t[Y.SRC_IN]=[r.DST_ALPHA,r.ZERO],t[Y.SRC_OUT]=[r.ONE_MINUS_DST_ALPHA,r.ZERO],t[Y.SRC_ATOP]=[r.DST_ALPHA,r.ONE_MINUS_SRC_ALPHA],t[Y.DST_OVER]=[r.ONE_MINUS_DST_ALPHA,r.ONE],t[Y.DST_IN]=[r.ZERO,r.SRC_ALPHA],t[Y.DST_OUT]=[r.ZERO,r.ONE_MINUS_SRC_ALPHA],t[Y.DST_ATOP]=[r.ONE_MINUS_DST_ALPHA,r.SRC_ALPHA],t[Y.XOR]=[r.ONE_MINUS_DST_ALPHA,r.ONE_MINUS_SRC_ALPHA],t[Y.SUBTRACT]=[r.ONE,r.ONE,r.ONE,r.ONE,r.FUNC_REVERSE_SUBTRACT,r.FUNC_ADD],t}var R_=0,M_=1,B_=2,F_=3,D_=4,L_=5,Zp=class Dl{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=Y.NONE,this._blendEq=!1,this.map=[],this.map[R_]=this.setBlend,this.map[M_]=this.setOffset,this.map[B_]=this.setCullFace,this.map[F_]=this.setDepthTest,this.map[D_]=this.setFrontFace,this.map[L_]=this.setDepthMask,this.checks=[],this.defaultState=new Bt,this.defaultState.blend=!0}contextChange(t){this.gl=t,this.blendModes=Kp(t),this.set(this.defaultState),this.reset()}set(t){if(t=t||this.defaultState,this.stateId!==t.data){let e=this.stateId^t.data,i=0;for(;e;)e&1&&this.map[i].call(this,!!(t.data&1<<i)),e=e>>1,i++;this.stateId=t.data}for(let e=0;e<this.checks.length;e++)this.checks[e](this,t)}forceState(t){t=t||this.defaultState;for(let e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(let e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data}setBlend(t){this.updateCheck(Dl.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)}setOffset(t){this.updateCheck(Dl.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(t){this.gl.depthMask(t)}setCullFace(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])}setBlendMode(t){if(t===this.blendMode)return;this.blendMode=t;let e=this.blendModes[t],i=this.gl;e.length===2?i.blendFunc(e[0],e[1]):i.blendFuncSeparate(e[0],e[1],e[2],e[3]),e.length===6?(this._blendEq=!0,i.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD))}setPolygonOffset(t,e){this.gl.polygonOffset(t,e)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(t,e){let i=this.checks.indexOf(t);e&&i===-1?this.checks.push(t):!e&&i!==-1&&this.checks.splice(i,1)}static checkBlendMode(t,e){t.setBlendMode(e.blendMode)}static checkPolygonOffset(t,e){t.setPolygonOffset(1,e.polygonOffset)}destroy(){this.gl=null}};Zp.extension={type:T.RendererSystem,name:"state"};var Ll=Zp;w.add(Ll);var ns=class extends Ze.default{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){this.addRunners(...t.runners);let e=(t.priority??[]).filter(s=>t.systems[s]),i=[...e,...Object.keys(t.systems).filter(s=>!e.includes(s))];for(let s of i)this.addSystem(t.systems[s],s)}addRunners(...t){t.forEach(e=>{this.runners[e]=new Tt(e)})}addSystem(t,e){let i=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=i,this._systemsHash[e]=i;for(let s in this.runners)this.runners[s].add(i);return this}emitWithCustomOptions(t,e){let i=Object.keys(this._systemsHash);t.items.forEach(s=>{let o=i.find(n=>this._systemsHash[n]===s);s[t.name](e[o])})}destroy(){Object.values(this.runners).forEach(t=>{t.destroy()}),this._systemsHash={}}};var mo=class ea{constructor(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=ea.defaultMaxIdle,this.checkCountMax=ea.defaultCheckCountMax,this.mode=ea.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==pn.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){let t=this.renderer.texture,e=t.managedTextures,i=!1;for(let s=0;s<e.length;s++){let o=e[s];o.resource&&this.count-o.touched>this.maxIdle&&(t.destroyTexture(o,!0),e[s]=null,i=!0)}if(i){let s=0;for(let o=0;o<e.length;o++)e[o]!==null&&(e[s++]=e[o]);e.length=s}}unload(t){let e=this.renderer.texture,i=t._texture;i&&!i.framebuffer&&e.destroyTexture(i);for(let s=t.children.length-1;s>=0;s--)this.unload(t.children[s])}destroy(){this.renderer=null}};mo.defaultMode=pn.AUTO,mo.defaultMaxIdle=60*60,mo.defaultCheckCountMax=60*10,mo.extension={type:T.RendererSystem,name:"textureGC"};var tr=mo;w.add(tr);var hi=class{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=U.UNSIGNED_BYTE,this.internalFormat=P.RGBA,this.samplerType=0}};function Qp(r){let t;return"WebGL2RenderingContext"in globalThis&&r instanceof globalThis.WebGL2RenderingContext?t={[r.RGB]:k.FLOAT,[r.RGBA]:k.FLOAT,[r.ALPHA]:k.FLOAT,[r.LUMINANCE]:k.FLOAT,[r.LUMINANCE_ALPHA]:k.FLOAT,[r.R8]:k.FLOAT,[r.R8_SNORM]:k.FLOAT,[r.RG8]:k.FLOAT,[r.RG8_SNORM]:k.FLOAT,[r.RGB8]:k.FLOAT,[r.RGB8_SNORM]:k.FLOAT,[r.RGB565]:k.FLOAT,[r.RGBA4]:k.FLOAT,[r.RGB5_A1]:k.FLOAT,[r.RGBA8]:k.FLOAT,[r.RGBA8_SNORM]:k.FLOAT,[r.RGB10_A2]:k.FLOAT,[r.RGB10_A2UI]:k.FLOAT,[r.SRGB8]:k.FLOAT,[r.SRGB8_ALPHA8]:k.FLOAT,[r.R16F]:k.FLOAT,[r.RG16F]:k.FLOAT,[r.RGB16F]:k.FLOAT,[r.RGBA16F]:k.FLOAT,[r.R32F]:k.FLOAT,[r.RG32F]:k.FLOAT,[r.RGB32F]:k.FLOAT,[r.RGBA32F]:k.FLOAT,[r.R11F_G11F_B10F]:k.FLOAT,[r.RGB9_E5]:k.FLOAT,[r.R8I]:k.INT,[r.R8UI]:k.UINT,[r.R16I]:k.INT,[r.R16UI]:k.UINT,[r.R32I]:k.INT,[r.R32UI]:k.UINT,[r.RG8I]:k.INT,[r.RG8UI]:k.UINT,[r.RG16I]:k.INT,[r.RG16UI]:k.UINT,[r.RG32I]:k.INT,[r.RG32UI]:k.UINT,[r.RGB8I]:k.INT,[r.RGB8UI]:k.UINT,[r.RGB16I]:k.INT,[r.RGB16UI]:k.UINT,[r.RGB32I]:k.INT,[r.RGB32UI]:k.UINT,[r.RGBA8I]:k.INT,[r.RGBA8UI]:k.UINT,[r.RGBA16I]:k.INT,[r.RGBA16UI]:k.UINT,[r.RGBA32I]:k.INT,[r.RGBA32UI]:k.UINT,[r.DEPTH_COMPONENT16]:k.FLOAT,[r.DEPTH_COMPONENT24]:k.FLOAT,[r.DEPTH_COMPONENT32F]:k.FLOAT,[r.DEPTH_STENCIL]:k.FLOAT,[r.DEPTH24_STENCIL8]:k.FLOAT,[r.DEPTH32F_STENCIL8]:k.FLOAT}:t={[r.RGB]:k.FLOAT,[r.RGBA]:k.FLOAT,[r.ALPHA]:k.FLOAT,[r.LUMINANCE]:k.FLOAT,[r.LUMINANCE_ALPHA]:k.FLOAT,[r.DEPTH_STENCIL]:k.FLOAT},t}function Jp(r){let t;return"WebGL2RenderingContext"in globalThis&&r instanceof globalThis.WebGL2RenderingContext?t={[U.UNSIGNED_BYTE]:{[P.RGBA]:r.RGBA8,[P.RGB]:r.RGB8,[P.RG]:r.RG8,[P.RED]:r.R8,[P.RGBA_INTEGER]:r.RGBA8UI,[P.RGB_INTEGER]:r.RGB8UI,[P.RG_INTEGER]:r.RG8UI,[P.RED_INTEGER]:r.R8UI,[P.ALPHA]:r.ALPHA,[P.LUMINANCE]:r.LUMINANCE,[P.LUMINANCE_ALPHA]:r.LUMINANCE_ALPHA},[U.BYTE]:{[P.RGBA]:r.RGBA8_SNORM,[P.RGB]:r.RGB8_SNORM,[P.RG]:r.RG8_SNORM,[P.RED]:r.R8_SNORM,[P.RGBA_INTEGER]:r.RGBA8I,[P.RGB_INTEGER]:r.RGB8I,[P.RG_INTEGER]:r.RG8I,[P.RED_INTEGER]:r.R8I},[U.UNSIGNED_SHORT]:{[P.RGBA_INTEGER]:r.RGBA16UI,[P.RGB_INTEGER]:r.RGB16UI,[P.RG_INTEGER]:r.RG16UI,[P.RED_INTEGER]:r.R16UI,[P.DEPTH_COMPONENT]:r.DEPTH_COMPONENT16},[U.SHORT]:{[P.RGBA_INTEGER]:r.RGBA16I,[P.RGB_INTEGER]:r.RGB16I,[P.RG_INTEGER]:r.RG16I,[P.RED_INTEGER]:r.R16I},[U.UNSIGNED_INT]:{[P.RGBA_INTEGER]:r.RGBA32UI,[P.RGB_INTEGER]:r.RGB32UI,[P.RG_INTEGER]:r.RG32UI,[P.RED_INTEGER]:r.R32UI,[P.DEPTH_COMPONENT]:r.DEPTH_COMPONENT24},[U.INT]:{[P.RGBA_INTEGER]:r.RGBA32I,[P.RGB_INTEGER]:r.RGB32I,[P.RG_INTEGER]:r.RG32I,[P.RED_INTEGER]:r.R32I},[U.FLOAT]:{[P.RGBA]:r.RGBA32F,[P.RGB]:r.RGB32F,[P.RG]:r.RG32F,[P.RED]:r.R32F,[P.DEPTH_COMPONENT]:r.DEPTH_COMPONENT32F},[U.HALF_FLOAT]:{[P.RGBA]:r.RGBA16F,[P.RGB]:r.RGB16F,[P.RG]:r.RG16F,[P.RED]:r.R16F},[U.UNSIGNED_SHORT_5_6_5]:{[P.RGB]:r.RGB565},[U.UNSIGNED_SHORT_4_4_4_4]:{[P.RGBA]:r.RGBA4},[U.UNSIGNED_SHORT_5_5_5_1]:{[P.RGBA]:r.RGB5_A1},[U.UNSIGNED_INT_2_10_10_10_REV]:{[P.RGBA]:r.RGB10_A2,[P.RGBA_INTEGER]:r.RGB10_A2UI},[U.UNSIGNED_INT_10F_11F_11F_REV]:{[P.RGB]:r.R11F_G11F_B10F},[U.UNSIGNED_INT_5_9_9_9_REV]:{[P.RGB]:r.RGB9_E5},[U.UNSIGNED_INT_24_8]:{[P.DEPTH_STENCIL]:r.DEPTH24_STENCIL8},[U.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[P.DEPTH_STENCIL]:r.DEPTH32F_STENCIL8}}:t={[U.UNSIGNED_BYTE]:{[P.RGBA]:r.RGBA,[P.RGB]:r.RGB,[P.ALPHA]:r.ALPHA,[P.LUMINANCE]:r.LUMINANCE,[P.LUMINANCE_ALPHA]:r.LUMINANCE_ALPHA},[U.UNSIGNED_SHORT_5_6_5]:{[P.RGB]:r.RGB},[U.UNSIGNED_SHORT_4_4_4_4]:{[P.RGBA]:r.RGBA},[U.UNSIGNED_SHORT_5_5_5_1]:{[P.RGBA]:r.RGBA}},t}var as=class{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new W,this.hasIntegerTextures=!1}contextChange(){let t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=Jp(t),this.samplerTypes=Qp(t);let e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(let s=0;s<e;s++)this.boundTextures[s]=null;this.emptyTextures={};let i=new hi(t.createTexture());t.bindTexture(t.TEXTURE_2D,i.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=i,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new hi(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let s=0;s<6;s++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let s=0;s<this.boundTextures.length;s++)this.bind(null,s)}bind(t,e=0){let{gl:i}=this;if(t=t?.castToBaseTexture(),t?.valid&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;let s=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(t.target,s.texture)),s.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),this.updateTexture(t)):s.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(i.TEXTURE_2D,this.emptyTextures[i.TEXTURE_2D].texture),this.boundTextures[e]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){let{gl:e,boundTextures:i}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let s=0;s<i.length;s++)i[s]===this.unknownTexture&&this.bind(null,s)}for(let s=0;s<i.length;s++)i[s]===t&&(this.currentLocation!==s&&(e.activeTexture(e.TEXTURE0+s),this.currentLocation=s),e.bindTexture(t.target,this.emptyTextures[t.target].texture),i[s]=null)}ensureSamplerType(t){let{boundTextures:e,hasIntegerTextures:i,CONTEXT_UID:s}=this;if(i)for(let o=t-1;o>=0;--o){let n=e[o];n&&n._glTextures[s].samplerType!==k.FLOAT&&this.renderer.texture.unbind(n)}}initTexture(t){let e=new hi(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e}initTextureType(t,e){e.internalFormat=this.internalFormats[t.type]?.[t.format]??t.format,e.samplerType=this.samplerTypes[e.internalFormat]??k.FLOAT,this.webGLVersion===2&&t.type===U.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type}updateTexture(t){let e=t._glTextures[this.CONTEXT_UID];if(!e)return;let i=this.renderer;if(this.initTextureType(t,e),t.resource?.upload(i,t,e))e.samplerType!==k.FLOAT&&(this.hasIntegerTextures=!0);else{let s=t.realWidth,o=t.realHeight,n=i.gl;(e.width!==s||e.height!==o||e.dirtyId<0)&&(e.width=s,e.height=o,n.texImage2D(t.target,0,e.internalFormat,s,o,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}destroyTexture(t,e){let{gl:i}=this;if(t=t.castToBaseTexture(),t._glTextures[this.CONTEXT_UID]&&(this.unbind(t),i.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){let s=this.managedTextures.indexOf(t);s!==-1&&On(this.managedTextures,s,1)}}updateTextureStyle(t){let e=t._glTextures[this.CONTEXT_UID];e&&((t.mipmap===Ut.POW2||this.webGLVersion!==2)&&!t.isPowerOfTwo?e.mipmap=!1:e.mipmap=t.mipmap>=1,this.webGLVersion!==2&&!t.isPowerOfTwo?e.wrapMode=ye.CLAMP:e.wrapMode=t.wrapMode,t.resource?.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)}setStyle(t,e){let i=this.gl;if(e.mipmap&&t.mipmap!==Ut.ON_MANUAL&&i.generateMipmap(t.target),i.texParameteri(t.target,i.TEXTURE_WRAP_S,e.wrapMode),i.texParameteri(t.target,i.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===ue.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST);let s=this.renderer.context.extensions.anisotropicFiltering;if(s&&t.anisotropicLevel>0&&t.scaleMode===ue.LINEAR){let o=Math.min(t.anisotropicLevel,i.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY_EXT));i.texParameterf(t.target,s.TEXTURE_MAX_ANISOTROPY_EXT,o)}}else i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===ue.LINEAR?i.LINEAR:i.NEAREST);i.texParameteri(t.target,i.TEXTURE_MAG_FILTER,t.scaleMode===ue.LINEAR?i.LINEAR:i.NEAREST)}destroy(){this.renderer=null}};as.extension={type:T.RendererSystem,name:"texture"};w.add(as);var hs=class{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){let{gl:e,CONTEXT_UID:i}=this,s=t._glTransformFeedbacks[i]||this.createGLTransformFeedback(t);e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,s)}unbind(){let{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,e){let{gl:i,renderer:s}=this;e&&s.shader.bind(e),i.beginTransformFeedback(t)}endTransformFeedback(){let{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){let{gl:e,renderer:i,CONTEXT_UID:s}=this,o=e.createTransformFeedback();t._glTransformFeedbacks[s]=o,e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,o);for(let n=0;n<t.buffers.length;n++){let a=t.buffers[n];a&&(i.buffer.update(a),a._glBuffers[s].refCount++,e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,n,a._glBuffers[s].buffer||null))}return e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),o}disposeTransformFeedback(t,e){let i=t._glTransformFeedbacks[this.CONTEXT_UID],s=this.gl;t.disposeRunner.remove(this);let o=this.renderer.buffer;if(o)for(let n=0;n<t.buffers.length;n++){let a=t.buffers[n];if(!a)continue;let h=a._glBuffers[this.CONTEXT_UID];h&&(h.refCount--,h.refCount===0&&!e&&o.dispose(a,e))}i&&(e||s.deleteTransformFeedback(i),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}};hs.extension={type:T.RendererSystem,name:"transformFeedback"};w.add(hs);var gr=class{constructor(t){this.renderer=t}init(t){this.screen=new z(0,0,t.width,t.height),this.element=t.view||E.ADAPTER.createCanvas(),this.resolution=t.resolution||E.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,e){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(e*this.resolution);let i=this.element.width/this.resolution,s=this.element.height/this.resolution;this.screen.width=i,this.screen.height=s,this.autoDensity&&(this.element.style.width=`${i}px`,this.element.style.height=`${s}px`),this.renderer.emit("resize",i,s),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){t&&this.element.parentNode?.removeChild(this.element),this.renderer=null,this.element=null,this.screen=null}};gr.defaultOptions={width:800,height:600,resolution:void 0,autoDensity:!1},gr.extension={type:[T.RendererSystem,T.CanvasRendererSystem],name:"_view"};w.add(gr);E.PREFER_ENV=ge.WEBGL2;E.STRICT_TEXTURE_CACHE=!1;E.RENDER_OPTIONS={...fr.defaultOptions,...pr.defaultOptions,...gr.defaultOptions,...mr.defaultOptions};Object.defineProperties(E,{WRAP_MODE:{get(){return W.defaultOptions.wrapMode},set(r){Z("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),W.defaultOptions.wrapMode=r}},SCALE_MODE:{get(){return W.defaultOptions.scaleMode},set(r){Z("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),W.defaultOptions.scaleMode=r}},MIPMAP_TEXTURES:{get(){return W.defaultOptions.mipmap},set(r){Z("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),W.defaultOptions.mipmap=r}},ANISOTROPIC_LEVEL:{get(){return W.defaultOptions.anisotropicLevel},set(r){Z("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),W.defaultOptions.anisotropicLevel=r}},FILTER_RESOLUTION:{get(){return Z("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),pt.defaultResolution},set(r){pt.defaultResolution=r}},FILTER_MULTISAMPLE:{get(){return Z("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),pt.defaultMultisample},set(r){pt.defaultMultisample=r}},SPRITE_MAX_TEXTURES:{get(){return dr.defaultMaxTextures},set(r){Z("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),dr.defaultMaxTextures=r}},SPRITE_BATCH_SIZE:{get(){return dr.defaultBatchSize},set(r){Z("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),dr.defaultBatchSize=r}},CAN_UPLOAD_SAME_BUFFER:{get(){return dr.canUploadSameBuffer},set(r){Z("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),dr.canUploadSameBuffer=r}},GC_MODE:{get(){return tr.defaultMode},set(r){Z("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),tr.defaultMode=r}},GC_MAX_IDLE:{get(){return tr.defaultMaxIdle},set(r){Z("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),tr.defaultMaxIdle=r}},GC_MAX_CHECK_COUNT:{get(){return tr.defaultCheckCountMax},set(r){Z("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),tr.defaultCheckCountMax=r}},PRECISION_VERTEX:{get(){return qt.defaultVertexPrecision},set(r){Z("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),qt.defaultVertexPrecision=r}},PRECISION_FRAGMENT:{get(){return qt.defaultFragmentPrecision},set(r){Z("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),qt.defaultFragmentPrecision=r}}});var de=(r=>(r[r.INTERACTION=50]="INTERACTION",r[r.HIGH=25]="HIGH",r[r.NORMAL=0]="NORMAL",r[r.LOW=-25]="LOW",r[r.UTILITY=-50]="UTILITY",r))(de||{});var ls=class{constructor(t,e=null,i=0,s=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=i,this.once=s}match(t,e=null){return this.fn===t&&this.context===e}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));let e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);let e=this.next;return this.next=t?null:e,this.previous=null,e}};var tf=class Te{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new ls(null,null,1/0),this.deltaMS=1/Te.targetFPMS,this.elapsedMS=1/Te.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,i=de.NORMAL){return this._addListener(new ls(t,e,i))}addOnce(t,e,i=de.NORMAL){return this._addListener(new ls(t,e,i,!0))}_addListener(t){let e=this._head.next,i=this._head;if(!e)t.connect(i);else{for(;e;){if(t.priority>e.priority){t.connect(i);break}i=e,e=e.next}t.previous||t.connect(i)}return this._startIfPossible(),this}remove(t,e){let i=this._head.next;for(;i;)i.match(t,e)?i=i.destroy():i=i.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){let o=t-this._lastFrame|0;if(o<this._minElapsedMS)return;this._lastFrame=t-o%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*Te.targetFPMS;let i=this._head,s=i.next;for(;s;)s=s.emit(this.deltaTime);i.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){let e=Math.min(this.maxFPS,t),i=Math.min(Math.max(0,e)/1e3,Te.targetFPMS);this._maxElapsedMS=1/i}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(t===0)this._minElapsedMS=0;else{let e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!Te._shared){let t=Te._shared=new Te;t.autoStart=!0,t._protected=!0}return Te._shared}static get system(){if(!Te._system){let t=Te._system=new Te;t.autoStart=!0,t._protected=!0}return Te._system}};tf.targetFPMS=.06;var st=tf;Object.defineProperties(E,{TARGET_FPMS:{get(){return st.targetFPMS},set(r){Z("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),st.targetFPMS=r}}});var go=class{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,de.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?st.shared:new st,t.autoStart&&this.start()}static destroy(){if(this._ticker){let t=this._ticker;this.ticker=null,t.destroy()}}};go.extension=T.Application;w.add(go);var ef=[];w.handleByList(T.Renderer,ef);function Ol(r){for(let t of ef)if(t.test(r))return new t(r);throw new Error("Unable to auto-detect a suitable renderer.")}var rf=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`;var sf=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;var Nl=rf,yo=sf;var _o=class{constructor(t){this.renderer=t}contextChange(t){let e;if(this.renderer.context.webGLVersion===1){let i=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,i)}else{let i=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,i)}e>=lt.HIGH?this.multisample=lt.HIGH:e>=lt.MEDIUM?this.multisample=lt.MEDIUM:e>=lt.LOW?this.multisample=lt.LOW:this.multisample=lt.NONE}destroy(){}};_o.extension={type:T.RendererSystem,name:"_multisample"};w.add(_o);var ra=class{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}};var xo=class{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){let{gl:e,CONTEXT_UID:i}=this,s=t._glBuffers[i]||this.createGLBuffer(t);e.bindBuffer(t.type,s.buffer)}unbind(t){let{gl:e}=this;e.bindBuffer(t,null)}bindBufferBase(t,e){let{gl:i,CONTEXT_UID:s}=this;if(this.boundBufferBases[e]!==t){let o=t._glBuffers[s]||this.createGLBuffer(t);this.boundBufferBases[e]=t,i.bindBufferBase(i.UNIFORM_BUFFER,e,o.buffer)}}bindBufferRange(t,e,i){let{gl:s,CONTEXT_UID:o}=this;i=i||0;let n=t._glBuffers[o]||this.createGLBuffer(t);s.bindBufferRange(s.UNIFORM_BUFFER,e||0,n.buffer,i*256,256)}update(t){let{gl:e,CONTEXT_UID:i}=this,s=t._glBuffers[i]||this.createGLBuffer(t);if(t._updateID!==s.updateID)if(s.updateID=t._updateID,e.bindBuffer(t.type,s.buffer),s.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{let o=t.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;s.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,o)}}dispose(t,e){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];let i=t._glBuffers[this.CONTEXT_UID],s=this.gl;t.disposeRunner.remove(this),i&&(e||s.deleteBuffer(i.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){let e=Object.keys(this.managedBuffers);for(let i=0;i<e.length;i++)this.dispose(this.managedBuffers[e[i]],t)}createGLBuffer(t){let{CONTEXT_UID:e,gl:i}=this;return t._glBuffers[e]=new ra(i.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e]}};xo.extension={type:T.RendererSystem,name:"buffer"};w.add(xo);var vo=class{constructor(t){this.renderer=t}render(t,e){let i=this.renderer,s,o,n,a;if(e&&(s=e.renderTexture,o=e.clear,n=e.transform,a=e.skipUpdateTransform),this.renderingToScreen=!s,i.runners.prerender.emit(),i.emit("prerender"),i.projection.transform=n,!i.context.isLost){if(s||(this.lastObjectRendered=t),!a){let h=t.enableTempParent();t.updateTransform(),t.disableTempParent(h)}i.renderTexture.bind(s),i.batch.currentRenderer.start(),(o??i.background.clearBeforeRender)&&i.renderTexture.clear(),t.render(i),i.batch.currentRenderer.flush(),s&&(e.blit&&i.framebuffer.blit(),s.baseTexture.update()),i.runners.postrender.emit(),i.projection.transform=null,i.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}};vo.extension={type:T.RendererSystem,name:"objectRenderer"};w.add(vo);var ia=class kl extends ns{constructor(t){super(),this.type=yh.WEBGL,t=Object.assign({},E.RENDER_OPTIONS,t),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new ie({projectionMatrix:new et},!0);let e={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:kl.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(e),"useContextAlpha"in t&&(Z("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),t.premultipliedAlpha=t.useContextAlpha&&t.useContextAlpha!=="notMultiplied",t.backgroundAlpha=t.useContextAlpha===!1?1:t.backgroundAlpha),this._plugin.rendererPlugins=kl.__plugins,this.options=t,this.startup.run(this.options)}static test(t){return t?.forceCanvas?!1:Bn()}render(t,e){this.objectRenderer.render(t,e)}resize(t,e){this._view.resizeView(t,e)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(t=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:t}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(t){this._view.resolution=t,this.runners.resolutionChange.emit(t)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return Z("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return Z("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return Z("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return Z("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(t){Z("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=t}get backgroundAlpha(){return Z("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(t){Z("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=t}get powerPreference(){return Z("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(t,e){return this.textureGenerator.generateTexture(t,e)}};ia.extension={type:T.Renderer,priority:1},ia.__plugins={},ia.__systems={};var sa=ia;w.handleByMap(T.RendererPlugin,sa.__plugins);w.handleByMap(T.RendererSystem,sa.__systems);w.add(sa);var Or=class extends xe{constructor(t,e){let{width:i,height:s}=e||{};super(i,s),this.items=[],this.itemDirtyIds=[];for(let o=0;o<t;o++){let n=new W;this.items.push(n),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,e){for(let i=0;i<this.length;i++)t[i]&&(t[i].castToBaseTexture?this.addBaseTextureAt(t[i].castToBaseTexture(),i):t[i]instanceof xe?this.addResourceAt(t[i],i):this.addResourceAt(Gi(t[i],e),i))}dispose(){for(let t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,e){if(!this.items[e])throw new Error(`Index ${e} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this}bind(t){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=t,this.items[e].on("update",t.update,t)}unbind(t){super.unbind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=null,this.items[e].off("update",t.update,t)}load(){if(this._load)return this._load;let t=this.items.map(e=>e.resource).filter(e=>e).map(e=>e.load());return this._load=Promise.all(t).then(()=>{let{realWidth:e,realHeight:i}=this.items[0];return this.resize(e,i),this.update(),Promise.resolve(this)}),this._load}};var bo=class extends Or{constructor(t,e){let{width:i,height:s}=e||{},o,n;Array.isArray(t)?(o=t,n=t.length):n=t,super(n,{width:i,height:s}),o&&this.initFromArray(o,e)}addBaseTextureAt(t,e){if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(t){super.bind(t),t.target=hr.TEXTURE_2D_ARRAY}upload(t,e,i){let{length:s,itemDirtyIds:o,items:n}=this,{gl:a}=t;i.dirtyId<0&&a.texImage3D(a.TEXTURE_2D_ARRAY,0,i.internalFormat,this._width,this._height,s,0,e.format,i.type,null);for(let h=0;h<s;h++){let l=n[h];o[h]<l.dirtyId&&(o[h]=l.dirtyId,l.valid&&a.texSubImage3D(a.TEXTURE_2D_ARRAY,0,0,0,h,l.resource.width,l.resource.height,1,e.format,i.type,l.resource.source))}return!0}};var To=class extends Ht{constructor(t){super(t)}static test(t){let{OffscreenCanvas:e}=globalThis;return e&&t instanceof e?!0:globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}};var of=class Eo extends Or{constructor(t,e){let{width:i,height:s,autoLoad:o,linkBaseTexture:n}=e||{};if(t&&t.length!==Eo.SIDES)throw new Error(`Invalid length. Got ${t.length}, expected 6`);super(6,{width:i,height:s});for(let a=0;a<Eo.SIDES;a++)this.items[a].target=hr.TEXTURE_CUBE_MAP_POSITIVE_X+a;this.linkBaseTexture=n!==!1,t&&this.initFromArray(t,e),o!==!1&&this.load()}bind(t){super.bind(t),t.target=hr.TEXTURE_CUBE_MAP}addBaseTextureAt(t,e,i){if(i===void 0&&(i=this.linkBaseTexture),!this.items[e])throw new Error(`Index ${e} is out of bounds`);if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0)if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("CubeResource does not support copying of renderTexture.");else t.target=hr.TEXTURE_CUBE_MAP_POSITIVE_X+e,t.parentTextureArray=this.baseTexture,this.items[e]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[e]=t,this}upload(t,e,i){let s=this.itemDirtyIds;for(let o=0;o<Eo.SIDES;o++){let n=this.items[o];(s[o]<n.dirtyId||i.dirtyId<e.dirtyId)&&(n.valid&&n.resource?(n.resource.upload(t,n,i),s[o]=n.dirtyId):s[o]<-1&&(t.gl.texImage2D(n.target,0,i.internalFormat,e.realWidth,e.realHeight,0,e.format,i.type,null),s[o]=-1))}return!0}static test(t){return Array.isArray(t)&&t.length===Eo.SIDES}};of.SIDES=6;var Ul=of;var wo=class r extends Ht{constructor(t,e){e=e||{};let i,s,o;typeof t=="string"?(i=r.EMPTY,s=t,o=!0):(i=t,s=null,o=!1),super(i),this.url=s,this.crossOrigin=e.crossOrigin??!0,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this.ownsImageBitmap=e.ownsImageBitmap??o,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(t,e)=>{if(this.url===null){t(this);return}try{let i=await E.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;let s=await i.blob();if(this.destroyed)return;let o=await createImageBitmap(s,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===xt.UNPACK?"premultiply":"none"});if(this.destroyed){o.close();return}this.source=o,this.update(),t(this)}catch(i){if(this.destroyed)return;e(i),this.onError.emit(i)}}),this._load)}upload(t,e,i){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),super.upload(t,e,i)):(this.load(),!1)}dispose(){this.ownsImageBitmap&&this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof t=="string"||t instanceof ImageBitmap)}static get EMPTY(){return r._EMPTY=r._EMPTY??E.ADAPTER.createCanvas(0,0),r._EMPTY}};var Gl=class oa extends Ht{constructor(t,e){e=e||{},super(E.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=t,this.scale=e.scale||1,this._overrideWidth=e.width,this._overrideHeight=e.height,this._resolve=null,this._crossorigin=e.crossorigin,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(t=>{if(this._resolve=()=>{this.update(),t(this)},oa.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){let t=new Image;Ht.crossOrigin(t,this.svg,this._crossorigin),t.src=this.svg,t.onerror=e=>{this._resolve&&(t.onerror=null,this.onError.emit(e))},t.onload=()=>{if(!this._resolve)return;let e=t.width,i=t.height;if(!e||!i)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let s=e*this.scale,o=i*this.scale;(this._overrideWidth||this._overrideHeight)&&(s=this._overrideWidth||this._overrideHeight/i*e,o=this._overrideHeight||this._overrideWidth/e*i),s=Math.round(s),o=Math.round(o);let n=this.source;n.width=s,n.height=o,n._pixiId=`canvas_${Ke()}`,n.getContext("2d").drawImage(t,0,0,e,i,0,0,s,o),this._resolve(),this._resolve=null}}static getSize(t){let e=oa.SVG_SIZE.exec(t),i={};return e&&(i[e[1]]=Math.round(parseFloat(e[3])),i[e[5]]=Math.round(parseFloat(e[7]))),i}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(t,e){return e==="svg"||typeof t=="string"&&t.startsWith("data:image/svg+xml")||typeof t=="string"&&oa.SVG_XML.test(t)}};Gl.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,Gl.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;var us=Gl;var Hl=class Vl extends Ht{constructor(t,e){if(e=e||{},!(t instanceof HTMLVideoElement)){let i=document.createElement("video");e.autoLoad!==!1&&i.setAttribute("preload","auto"),e.playsinline!==!1&&(i.setAttribute("webkit-playsinline",""),i.setAttribute("playsinline","")),e.muted===!0&&(i.setAttribute("muted",""),i.muted=!0),e.loop===!0&&i.setAttribute("loop",""),e.autoPlay!==!1&&i.setAttribute("autoplay",""),typeof t=="string"&&(t=[t]);let s=t[0].src||t[0];Ht.crossOrigin(i,s,e.crossorigin);for(let o=0;o<t.length;++o){let n=document.createElement("source"),{src:a,mime:h}=t[o];if(a=a||t[o],a.startsWith("data:"))h=a.slice(5,a.indexOf(";"));else if(!a.startsWith("blob:")){let l=a.split("?").shift().toLowerCase(),u=l.slice(l.lastIndexOf(".")+1);h=h||Vl.MIME_TYPES[u]||`video/${u}`}n.src=a,h&&(n.type=h),i.appendChild(n)}t=i}super(t),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=e.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=e.autoPlay!==!1,this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),e.autoLoad!==!1&&this.load()}update(t=0){if(!this.destroyed){if(this._updateFPS){let e=st.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-e)}(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}_videoFrameRequestCallback(){this.update(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback)}load(){if(this._load)return this._load;let t=this.source;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart),t.addEventListener("pause",this._onPlayStop),t.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._onCanPlay():(t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("error",this._onError,!0)),this._load=new Promise((e,i)=>{this.valid?e(this):(this._resolve=e,this._reject=i,t.load())}),this._load}_onError(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t),this._reject&&(this._reject(t),this._reject=null,this._resolve=null)}_isSourcePlaying(){let t=this.source;return!t.paused&&!t.ended}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0)}_onCanPlay(){let t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);let e=this.valid;this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0,!e&&this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()}dispose(){this._configureAutoUpdate();let t=this.source;t&&(t.removeEventListener("play",this._onPlayStart),t.removeEventListener("pause",this._onPlayStop),t.removeEventListener("seeked",this._onSeeked),t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay),t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.source.requestVideoFrameCallback?(this._isConnectedToTicker&&(st.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(st.shared.add(this.update,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(st.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(t,e){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement||Vl.TYPES.includes(e)}};Hl.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],Hl.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};var So=Hl;Js.push(wo,si,To,So,us,Ge,Ul,bo);var er=class{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?z.EMPTY:(t=t||new z(0,0,1,1),t.x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,e){let{a:i,b:s,c:o,d:n,tx:a,ty:h}=t,l=i*e.x+o*e.y+a,u=s*e.x+n*e.y+h;this.minX=Math.min(this.minX,l),this.maxX=Math.max(this.maxX,l),this.minY=Math.min(this.minY,u),this.maxY=Math.max(this.maxY,u)}addQuad(t){let e=this.minX,i=this.minY,s=this.maxX,o=this.maxY,n=t[0],a=t[1];e=n<e?n:e,i=a<i?a:i,s=n>s?n:s,o=a>o?a:o,n=t[2],a=t[3],e=n<e?n:e,i=a<i?a:i,s=n>s?n:s,o=a>o?a:o,n=t[4],a=t[5],e=n<e?n:e,i=a<i?a:i,s=n>s?n:s,o=a>o?a:o,n=t[6],a=t[7],e=n<e?n:e,i=a<i?a:i,s=n>s?n:s,o=a>o?a:o,this.minX=e,this.minY=i,this.maxX=s,this.maxY=o}addFrame(t,e,i,s,o){this.addFrameMatrix(t.worldTransform,e,i,s,o)}addFrameMatrix(t,e,i,s,o){let n=t.a,a=t.b,h=t.c,l=t.d,u=t.tx,c=t.ty,d=this.minX,p=this.minY,f=this.maxX,m=this.maxY,g=n*e+h*i+u,y=a*e+l*i+c;d=g<d?g:d,p=y<p?y:p,f=g>f?g:f,m=y>m?y:m,g=n*s+h*i+u,y=a*s+l*i+c,d=g<d?g:d,p=y<p?y:p,f=g>f?g:f,m=y>m?y:m,g=n*e+h*o+u,y=a*e+l*o+c,d=g<d?g:d,p=y<p?y:p,f=g>f?g:f,m=y>m?y:m,g=n*s+h*o+u,y=a*s+l*o+c,d=g<d?g:d,p=y<p?y:p,f=g>f?g:f,m=y>m?y:m,this.minX=d,this.minY=p,this.maxX=f,this.maxY=m}addVertexData(t,e,i){let s=this.minX,o=this.minY,n=this.maxX,a=this.maxY;for(let h=e;h<i;h+=2){let l=t[h],u=t[h+1];s=l<s?l:s,o=u<o?u:o,n=l>n?l:n,a=u>a?u:a}this.minX=s,this.minY=o,this.maxX=n,this.maxY=a}addVertices(t,e,i,s){this.addVerticesMatrix(t.worldTransform,e,i,s)}addVerticesMatrix(t,e,i,s,o=0,n=o){let a=t.a,h=t.b,l=t.c,u=t.d,c=t.tx,d=t.ty,p=this.minX,f=this.minY,m=this.maxX,g=this.maxY;for(let y=i;y<s;y+=2){let v=e[y],_=e[y+1],x=a*v+l*_+c,M=u*_+h*v+d;p=Math.min(p,x-o),m=Math.max(m,x+o),f=Math.min(f,M-n),g=Math.max(g,M+n)}this.minX=p,this.minY=f,this.maxX=m,this.maxY=g}addBounds(t){let e=this.minX,i=this.minY,s=this.maxX,o=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<i?t.minY:i,this.maxX=t.maxX>s?t.maxX:s,this.maxY=t.maxY>o?t.maxY:o}addBoundsMask(t,e){let i=t.minX>e.minX?t.minX:e.minX,s=t.minY>e.minY?t.minY:e.minY,o=t.maxX<e.maxX?t.maxX:e.maxX,n=t.maxY<e.maxY?t.maxY:e.maxY;if(i<=o&&s<=n){let a=this.minX,h=this.minY,l=this.maxX,u=this.maxY;this.minX=i<a?i:a,this.minY=s<h?s:h,this.maxX=o>l?o:l,this.maxY=n>u?n:u}}addBoundsMatrix(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,e){let i=t.minX>e.x?t.minX:e.x,s=t.minY>e.y?t.minY:e.y,o=t.maxX<e.x+e.width?t.maxX:e.x+e.width,n=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(i<=o&&s<=n){let a=this.minX,h=this.minY,l=this.maxX,u=this.maxY;this.minX=i<a?i:a,this.minY=s<h?s:h,this.maxX=o>l?o:l,this.maxY=n>u?n:u}}pad(t=0,e=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)}addFramePad(t,e,i,s,o,n){t-=o,e-=n,i+=o,s+=n,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>i?this.maxX:i,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>s?this.maxY:s}};var at=class r extends S.EventEmitter{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new ri,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new er,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){let e=Object.keys(t);for(let i=0;i<e.length;++i){let s=e[i];Object.defineProperty(r.prototype,s,Object.getOwnPropertyDescriptor(t,s))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new z),e=this._boundsRect),this._bounds.getRectangle(e)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new z),t=this._localBoundsRect),this._localBounds||(this._localBounds=new er);let e=this.transform,i=this.parent;this.parent=null,this._tempDisplayObjectParent.worldAlpha=i?.worldAlpha??1,this.transform=this._tempDisplayObjectParent.transform;let s=this._bounds,o=this._boundsID;this._bounds=this._localBounds;let n=this.getBounds(!1,t);return this.parent=i,this.transform=e,this._bounds=s,this._bounds.updateID+=this._boundsID-o,n}toGlobal(t,e,i=!1){return i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)}toLocal(t,e,i,s){return e&&(t=e.toGlobal(t,i,s)),s||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,i)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){this.parent?.removeChild(this)}setTransform(t=0,e=0,i=1,s=1,o=0,n=0,a=0,h=0,l=0){return this.position.x=t,this.position.y=e,this.scale.x=i||1,this.scale.y=s||1,this.rotation=o,this.skew.x=n,this.skew.y=a,this.pivot.x=h,this.pivot.y=l,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new na),this.tempDisplayObjectParent}enableTempParent(){let t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*xl}set angle(t){this.transform.rotation=t*vl}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){let e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount--,e._maskRefCount===0&&(e.renderable=!0,e.isMask=!1))}if(this._mask=t,this._mask){let e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount===0&&(e.renderable=!1,e.isMask=!0),e._maskRefCount++)}}}},na=class extends at{constructor(){super(...arguments),this.sortDirty=null}};at.prototype.displayObjectUpdateTransform=at.prototype.updateTransform;var O_=new et;function N_(r,t){return r.zIndex===t.zIndex?r._lastSortedIndex-t._lastSortedIndex:r.zIndex-t.zIndex}var nf=class Xl extends at{constructor(){super(),this.children=[],this.sortableChildren=Xl.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(t){}addChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.addChild(t[e]);else{let e=t[0];e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.push(e),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this)}return t[0]}addChildAt(t,e){if(e<0||e>this.children.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${this.children.length}`);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t}swapChildren(t,e){if(t===e)return;let i=this.getChildIndex(t),s=this.getChildIndex(e);this.children[i]=e,this.children[s]=t,this.onChildrenChange(i<s?i:s)}getChildIndex(t){let e=this.children.indexOf(t);if(e===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return e}setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);let i=this.getChildIndex(t);S.removeItems(this.children,i,1),this.children.splice(e,0,t),this.onChildrenChange(e)}getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]}removeChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.removeChild(t[e]);else{let e=t[0],i=this.children.indexOf(e);if(i===-1)return null;e.parent=null,e.transform._parentID=-1,S.removeItems(this.children,i,1),this._boundsID++,this.onChildrenChange(i),e.emit("removed",this),this.emit("childRemoved",e,this,i)}return t[0]}removeChildAt(t){let e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,S.removeItems(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e}removeChildren(t=0,e=this.children.length){let i=t,s=e,o=s-i,n;if(o>0&&o<=s){n=this.children.splice(i,o);for(let a=0;a<n.length;++a)n[a].parent=null,n[a].transform&&(n[a].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(let a=0;a<n.length;++a)n[a].emit("removed",this),this.emit("childRemoved",n[a],this,a);return n}else if(o===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let t=!1;for(let e=0,i=this.children.length;e<i;++e){let s=this.children[e];s._lastSortedIndex=e,!t&&s.zIndex!==0&&(t=!0)}t&&this.children.length>1&&this.children.sort(N_),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let t=0,e=this.children.length;t<e;++t){let i=this.children[t];i.visible&&i.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let t=0;t<this.children.length;t++){let e=this.children[t];if(!(!e.visible||!e.renderable))if(e.calculateBounds(),e._mask){let i=e._mask.isMaskData?e._mask.maskObject:e._mask;i?(i.calculateBounds(),this._bounds.addBoundsMask(e._bounds,i._bounds)):this._bounds.addBounds(e._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(t,e=!1){let i=super.getLocalBounds(t);if(!e)for(let s=0,o=this.children.length;s<o;++s){let n=this.children[s];n.visible&&n.updateTransform()}return i}_calculateBounds(){}_renderWithCulling(t){let e=t.renderTexture.sourceFrame;if(!(e.width>0&&e.height>0))return;let i,s;this.cullArea?(i=this.cullArea,s=this.worldTransform):this._render!==Xl.prototype._render&&(i=this.getBounds(!0));let o=t.projection.transform;if(o&&(s?(s=O_.copyFrom(s),s.prepend(o)):s=o),i&&e.intersects(i,s))this._render(t);else if(this.cullArea)return;for(let n=0,a=this.children.length;n<a;++n){let h=this.children[n],l=h.cullable;h.cullable=l||!this.cullArea,h.render(t),h.cullable=l}}render(t){if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||this.filters?.length)this.renderAdvanced(t);else if(this.cullable)this._renderWithCulling(t);else{this._render(t);for(let e=0,i=this.children.length;e<i;++e)this.children[e].render(t)}}renderAdvanced(t){let e=this.filters,i=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let o=0;o<e.length;o++)e[o].enabled&&this._enabledFilters.push(e[o])}let s=e&&this._enabledFilters?.length||i&&(!i.isMaskData||i.enabled&&(i.autoDetect||i.type!==bt.NONE));if(s&&t.batch.flush(),e&&this._enabledFilters?.length&&t.filter.push(this,this._enabledFilters),i&&t.mask.push(this,this._mask),this.cullable)this._renderWithCulling(t);else{this._render(t);for(let o=0,n=this.children.length;o<n;++o)this.children[o].render(t)}s&&t.batch.flush(),i&&t.mask.pop(this),e&&this._enabledFilters?.length&&t.filter.pop()}_render(t){}destroy(t){super.destroy(),this.sortDirty=!1;let e=typeof t=="boolean"?t:t?.children,i=this.removeChildren(0,this.children.length);if(e)for(let s=0;s<i.length;++s)i[s].destroy(t)}get width(){return this.scale.x*this.getLocalBounds().width}set width(t){let e=this.getLocalBounds().width;e!==0?this.scale.x=t/e:this.scale.x=1,this._width=t}get height(){return this.scale.y*this.getLocalBounds().height}set height(t){let e=this.getLocalBounds().height;e!==0?this.scale.y=t/e:this.scale.y=1,this._height=t}};nf.defaultSortableChildren=!1;var O=nf;O.prototype.containerUpdateTransform=O.prototype.updateTransform;Object.defineProperties(E,{SORTABLE_CHILDREN:{get(){return O.defaultSortableChildren},set(r){S.deprecation("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),O.defaultSortableChildren=r}}});var af=class Wl{constructor(t){this.stage=new O,t=Object.assign({forceCanvas:!1},t),this.renderer=Ol(t),Wl._plugins.forEach(e=>{e.init.call(this,t)})}render(){this.renderer.render(this.stage)}get view(){return this.renderer?.view}get screen(){return this.renderer?.screen}destroy(t,e){let i=Wl._plugins.slice(0);i.reverse(),i.forEach(s=>{s.destroy.call(this)}),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null}};af._plugins=[];var aa=af;w.handleByList(T.Application,aa._plugins);var Ao=class{static init(t){Object.defineProperty(this,"resizeTo",{set(e){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=e,e&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let e,i;if(this._resizeTo===globalThis.window)e=globalThis.innerWidth,i=globalThis.innerHeight;else{let{clientWidth:s,clientHeight:o}=this._resizeTo;e=s,i=o}this.renderer.resize(e,i),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}};Ao.extension=T.Application;w.add(Ao);var hf;function lf(r){return hf=r,r}function Ft(){return hf}var k_=0,zl=class extends S.EventEmitter{constructor(r){super(),this.id=k_++,this.init(r)}set(r,t){if(this[r]===void 0)throw new Error(`Property with name ${r} does not exist.`);switch(r){case"speed":this.speed=t;break;case"volume":this.volume=t;break;case"paused":this.paused=t;break;case"loop":this.loop=t;break;case"muted":this.muted=t;break}return this}get progress(){let{currentTime:r}=this._source;return r/this._duration}get paused(){return this._paused}set paused(r){this._paused=r,this.refreshPaused()}_onPlay(){this._playing=!0}_onPause(){this._playing=!1}init(r){this._playing=!1,this._duration=r.source.duration;let t=this._source=r.source.cloneNode(!1);t.src=r.parent.url,t.onplay=this._onPlay.bind(this),t.onpause=this._onPause.bind(this),r.context.on("refresh",this.refresh,this),r.context.on("refreshPaused",this.refreshPaused,this),this._media=r}_internalStop(){this._source&&this._playing&&(this._source.onended=null,this._source.pause())}stop(){this._internalStop(),this._source&&this.emit("stop")}get speed(){return this._speed}set speed(r){this._speed=r,this.refresh()}get volume(){return this._volume}set volume(r){this._volume=r,this.refresh()}get loop(){return this._loop}set loop(r){this._loop=r,this.refresh()}get muted(){return this._muted}set muted(r){this._muted=r,this.refresh()}get filters(){return console.warn("HTML Audio does not support filters"),null}set filters(r){console.warn("HTML Audio does not support filters")}refresh(){let r=this._media.context,t=this._media.parent;this._source.loop=this._loop||t.loop;let e=r.volume*(r.muted?0:1),i=t.volume*(t.muted?0:1),s=this._volume*(this._muted?0:1);this._source.volume=s*e*i,this._source.playbackRate=this._speed*r.speed*t.speed}refreshPaused(){let r=this._media.context,t=this._media.parent,e=this._paused||t.paused||r.paused;e!==this._pausedReal&&(this._pausedReal=e,e?(this._internalStop(),this.emit("paused")):(this.emit("resumed"),this.play({start:this._source.currentTime,end:this._end,volume:this._volume,speed:this._speed,loop:this._loop})),this.emit("pause",e))}play(r){let{start:t,end:e,speed:i,loop:s,volume:o,muted:n}=r;e&&console.assert(e>t,"End time is before start time"),this._speed=i,this._volume=o,this._loop=!!s,this._muted=n,this.refresh(),this.loop&&e!==null&&(console.warn('Looping not support when specifying an "end" time'),this.loop=!1),this._start=t,this._end=e||this._duration,this._start=Math.max(0,this._start-zl.PADDING),this._end=Math.min(this._end+zl.PADDING,this._duration),this._source.onloadedmetadata=()=>{this._source&&(this._source.currentTime=t,this._source.onloadedmetadata=null,this.emit("progress",t,this._duration),st.shared.add(this._onUpdate,this))},this._source.onended=this._onComplete.bind(this),this._source.play(),this.emit("start")}_onUpdate(){this.emit("progress",this.progress,this._duration),this._source.currentTime>=this._end&&!this._source.loop&&this._onComplete()}_onComplete(){st.shared.remove(this._onUpdate,this),this._internalStop(),this.emit("progress",1,this._duration),this.emit("end",this)}destroy(){st.shared.remove(this._onUpdate,this),this.removeAllListeners();let r=this._source;r&&(r.onended=null,r.onplay=null,r.onpause=null,this._internalStop()),this._source=null,this._speed=1,this._volume=1,this._loop=!1,this._end=null,this._start=0,this._duration=0,this._playing=!1,this._pausedReal=!1,this._paused=!1,this._muted=!1,this._media&&(this._media.context.off("refresh",this.refresh,this),this._media.context.off("refreshPaused",this.refreshPaused,this),this._media=null)}toString(){return`[HTMLAudioInstance id=${this.id}]`}},ha=zl;ha.PADDING=.1;var Co=class extends S.EventEmitter{init(t){this.parent=t,this._source=t.options.source||new Audio,t.url&&(this._source.src=t.url)}create(){return new ha(this)}get isPlayable(){return!!this._source&&this._source.readyState===4}get duration(){return this._source.duration}get context(){return this.parent.context}get filters(){return null}set filters(t){console.warn("HTML Audio does not support filters")}destroy(){this.removeAllListeners(),this.parent=null,this._source&&(this._source.src="",this._source.load(),this._source=null)}get source(){return this._source}load(t){let e=this._source,i=this.parent;if(e.readyState===4){i.isLoaded=!0;let h=i.autoPlayStart();t&&setTimeout(()=>{t(null,i,h)},0);return}if(!i.url){t(new Error("sound.url or sound.source must be set"));return}e.src=i.url;let s=()=>{a(),i.isLoaded=!0;let h=i.autoPlayStart();t&&t(null,i,h)},o=()=>{a(),t&&t(new Error("Sound loading has been aborted"))},n=()=>{a();let h=`Failed to load audio element (code: ${e.error.code})`;t?t(new Error(h)):console.error(h)},a=()=>{e.removeEventListener("canplaythrough",s),e.removeEventListener("load",s),e.removeEventListener("abort",o),e.removeEventListener("error",n)};e.addEventListener("canplaythrough",s,!1),e.addEventListener("load",s,!1),e.addEventListener("abort",o,!1),e.addEventListener("error",n,!1),e.load()}};var Po=class{constructor(t,e){this.parent=t,Object.assign(this,e),this.duration=this.end-this.start,console.assert(this.duration>0,"End time must be after start time")}play(t){return this.parent.play({complete:t,speed:this.speed||this.parent.speed,end:this.end,start:this.start,loop:this.loop})}destroy(){this.parent=null}};var li=["ogg","oga","opus","m4a","mp3","mpeg","wav","aiff","wma","mid","caf"],jl=["audio/mpeg","audio/ogg"],ui={};function uf(r){let t={m4a:"audio/mp4",oga:"audio/ogg",opus:'audio/ogg; codecs="opus"',caf:'audio/x-caf; codecs="opus"',...r||{}},e=document.createElement("audio"),i={},s=/^no$/;li.forEach(o=>{let n=e.canPlayType(`audio/${o}`).replace(s,""),a=t[o]?e.canPlayType(t[o]).replace(s,""):"";i[o]=!!n||!!a}),Object.assign(ui,i)}uf();var se=class{static setParamValue(t,e){if(t.setValueAtTime){let i=Ft().context;t.setValueAtTime(e,i.audioContext.currentTime)}else t.value=e;return e}};var U_=0,Io=class extends S.EventEmitter{constructor(t){super(),this.id=U_++,this._media=null,this._paused=!1,this._muted=!1,this._elapsed=0,this.init(t)}set(t,e){if(this[t]===void 0)throw new Error(`Property with name ${t} does not exist.`);switch(t){case"speed":this.speed=e;break;case"volume":this.volume=e;break;case"muted":this.muted=e;break;case"loop":this.loop=e;break;case"paused":this.paused=e;break}return this}stop(){this._source&&(this._internalStop(),this.emit("stop"))}get speed(){return this._speed}set speed(t){this._speed=t,this.refresh(),this._update(!0)}get volume(){return this._volume}set volume(t){this._volume=t,this.refresh()}get muted(){return this._muted}set muted(t){this._muted=t,this.refresh()}get loop(){return this._loop}set loop(t){this._loop=t,this.refresh()}get filters(){return this._filters}set filters(t){this._filters&&(this._filters?.filter(e=>e).forEach(e=>e.disconnect()),this._filters=null,this._source.connect(this._gain)),this._filters=t?.length?t.slice(0):null,this.refresh()}refresh(){if(!this._source)return;let t=this._media.context,e=this._media.parent;this._source.loop=this._loop||e.loop;let i=t.volume*(t.muted?0:1),s=e.volume*(e.muted?0:1),o=this._volume*(this._muted?0:1);se.setParamValue(this._gain.gain,o*s*i),se.setParamValue(this._source.playbackRate,this._speed*e.speed*t.speed),this.applyFilters()}applyFilters(){if(this._filters?.length){this._source.disconnect();let t=this._source;this._filters.forEach(e=>{t.connect(e.destination),t=e}),t.connect(this._gain)}}refreshPaused(){let t=this._media.context,e=this._media.parent,i=this._paused||e.paused||t.paused;i!==this._pausedReal&&(this._pausedReal=i,i?(this._internalStop(),this.emit("paused")):(this.emit("resumed"),this.play({start:this._elapsed%this._duration,end:this._end,speed:this._speed,loop:this._loop,volume:this._volume})),this.emit("pause",i))}play(t){let{start:e,end:i,speed:s,loop:o,volume:n,muted:a,filters:h}=t;i&&console.assert(i>e,"End time is before start time"),this._paused=!1;let{source:l,gain:u}=this._media.nodes.cloneBufferSource();this._source=l,this._gain=u,this._speed=s,this._volume=n,this._loop=!!o,this._muted=a,this._filters=h,this.refresh();let c=this._source.buffer.duration;this._duration=c,this._end=i,this._lastUpdate=this._now(),this._elapsed=e,this._source.onended=this._onComplete.bind(this),this._loop?(this._source.loopEnd=i,this._source.loopStart=e,this._source.start(0,e)):i?this._source.start(0,e,i-e):this._source.start(0,e),this.emit("start"),this._update(!0),this.enableTicker(!0)}enableTicker(t){st.shared.remove(this._updateListener,this),t&&st.shared.add(this._updateListener,this)}get progress(){return this._progress}get paused(){return this._paused}set paused(t){this._paused=t,this.refreshPaused()}destroy(){this.removeAllListeners(),this._internalStop(),this._gain&&(this._gain.disconnect(),this._gain=null),this._media&&(this._media.context.events.off("refresh",this.refresh,this),this._media.context.events.off("refreshPaused",this.refreshPaused,this),this._media=null),this._filters?.forEach(t=>t.disconnect()),this._filters=null,this._end=null,this._speed=1,this._volume=1,this._loop=!1,this._elapsed=0,this._duration=0,this._paused=!1,this._muted=!1,this._pausedReal=!1}toString(){return`[WebAudioInstance id=${this.id}]`}_now(){return this._media.context.audioContext.currentTime}_updateListener(){this._update()}_update(t=!1){if(this._source){let e=this._now(),i=e-this._lastUpdate;if(i>0||t){let s=this._source.playbackRate.value;this._elapsed+=i*s,this._lastUpdate=e;let o=this._duration,n;if(this._source.loopStart){let a=this._source.loopEnd-this._source.loopStart;n=(this._source.loopStart+this._elapsed%a)/o}else n=this._elapsed%o/o;this._progress=n,this.emit("progress",this._progress,o)}}}init(t){this._media=t,t.context.events.on("refresh",this.refresh,this),t.context.events.on("refreshPaused",this.refreshPaused,this)}_internalStop(){if(this._source){this.enableTicker(!1),this._source.onended=null,this._source.stop(0),this._source.disconnect();try{this._source.buffer=null}catch(t){console.warn("Failed to set AudioBufferSourceNode.buffer to null:",t)}this._source=null}}_onComplete(){if(this._source){this.enableTicker(!1),this._source.onended=null,this._source.disconnect();try{this._source.buffer=null}catch(t){console.warn("Failed to set AudioBufferSourceNode.buffer to null:",t)}}this._source=null,this._progress=1,this.emit("progress",1,this._duration),this.emit("end",this)}};var ci=class{constructor(t,e){this._output=e,this._input=t}get destination(){return this._input}get filters(){return this._filters}set filters(t){if(this._filters&&(this._filters.forEach(e=>{e&&e.disconnect()}),this._filters=null,this._input.connect(this._output)),t&&t.length){this._filters=t.slice(0),this._input.disconnect();let e=null;t.forEach(i=>{e===null?this._input.connect(i.destination):e.connect(i.destination),e=i}),e.connect(this._output)}}destroy(){this.filters=null,this._input=null,this._output=null}};var cf=class extends ci{constructor(r){let t=r.audioContext,e=t.createBufferSource(),i=t.createGain(),s=t.createAnalyser();e.connect(s),s.connect(i),i.connect(r.destination),super(s,i),this.context=r,this.bufferSource=e,this.gain=i,this.analyser=s}get script(){return this._script||(this._script=this.context.audioContext.createScriptProcessor(cf.BUFFER_SIZE),this._script.connect(this.context.destination)),this._script}destroy(){super.destroy(),this.bufferSource.disconnect(),this._script&&this._script.disconnect(),this.gain.disconnect(),this.analyser.disconnect(),this.bufferSource=null,this._script=null,this.gain=null,this.analyser=null,this.context=null}cloneBufferSource(){let r=this.bufferSource,t=this.context.audioContext.createBufferSource();t.buffer=r.buffer,se.setParamValue(t.playbackRate,r.playbackRate.value),t.loop=r.loop;let e=this.context.audioContext.createGain();return t.connect(e),e.connect(this.destination),{source:t,gain:e}}get bufferSize(){return this.script.bufferSize}},la=cf;la.BUFFER_SIZE=0;var di=class{init(t){this.parent=t,this._nodes=new la(this.context),this._source=this._nodes.bufferSource,this.source=t.options.source}destroy(){this.parent=null,this._nodes.destroy(),this._nodes=null;try{this._source.buffer=null}catch(t){console.warn("Failed to set AudioBufferSourceNode.buffer to null:",t)}this._source=null,this.source=null}create(){return new Io(this)}get context(){return this.parent.context}get isPlayable(){return!!this._source&&!!this._source.buffer}get filters(){return this._nodes.filters}set filters(t){this._nodes.filters=t}get duration(){return console.assert(this.isPlayable,"Sound not yet playable, no duration"),this._source.buffer.duration}get buffer(){return this._source.buffer}set buffer(t){this._source.buffer=t}get nodes(){return this._nodes}load(t){this.source?this._decode(this.source,t):this.parent.url?this._loadUrl(t):t?t(new Error("sound.url or sound.source must be set")):console.error("sound.url or sound.source must be set")}async _loadUrl(t){let e=this.parent.url,i=await E.ADAPTER.fetch(e);this._decode(await i.arrayBuffer(),t)}_decode(t,e){let i=(s,o)=>{if(s)e&&e(s);else{this.parent.isLoaded=!0,this.buffer=o;let n=this.parent.autoPlayStart();e&&e(null,this.parent,n)}};t instanceof AudioBuffer?i(null,t):this.parent.context.decode(t,i)}};var cs=class{static from(r){let t={};typeof r=="string"?t.url=r:r instanceof ArrayBuffer||r instanceof AudioBuffer||r instanceof HTMLAudioElement?t.source=r:Array.isArray(r)?t.url=r:t=r,t={autoPlay:!1,singleInstance:!1,url:null,source:null,preload:!1,volume:1,speed:1,complete:null,loaded:null,loop:!1,...t},Object.freeze(t);let e=Ft().useLegacy?new Co:new di;return new cs(e,t)}constructor(r,t){this.media=r,this.options=t,this._instances=[],this._sprites={},this.media.init(this);let e=t.complete;this._autoPlayOptions=e?{complete:e}:null,this.isLoaded=!1,this._preloadQueue=null,this.isPlaying=!1,this.autoPlay=t.autoPlay,this.singleInstance=t.singleInstance,this.preload=t.preload||this.autoPlay,this.url=Array.isArray(t.url)?this.preferUrl(t.url):t.url,this.speed=t.speed,this.volume=t.volume,this.loop=t.loop,t.sprites&&this.addSprites(t.sprites),this.preload&&this._preload(t.loaded)}preferUrl(r){let[t]=r.map(e=>({url:e,ext:S.path.extname(e).slice(1)})).filter(({ext:e})=>ui[e]).sort((e,i)=>li.indexOf(e.ext)-li.indexOf(i.ext));if(!t)throw new Error("No supported file type found");return t.url}get context(){return Ft().context}pause(){return this.isPlaying=!1,this.paused=!0,this}resume(){return this.isPlaying=this._instances.length>0,this.paused=!1,this}get paused(){return this._paused}set paused(r){this._paused=r,this.refreshPaused()}get speed(){return this._speed}set speed(r){this._speed=r,this.refresh()}get filters(){return this.media.filters}set filters(r){this.media.filters=r}addSprites(r,t){if(typeof r=="object"){let i={};for(let s in r)i[s]=this.addSprites(s,r[s]);return i}console.assert(!this._sprites[r],`Alias ${r} is already taken`);let e=new Po(this,t);return this._sprites[r]=e,e}destroy(){this._removeInstances(),this.removeSprites(),this.media.destroy(),this.media=null,this._sprites=null,this._instances=null}removeSprites(r){if(r){let t=this._sprites[r];t!==void 0&&(t.destroy(),delete this._sprites[r])}else for(let t in this._sprites)this.removeSprites(t);return this}get isPlayable(){return this.isLoaded&&this.media&&this.media.isPlayable}stop(){if(!this.isPlayable)return this.autoPlay=!1,this._autoPlayOptions=null,this;this.isPlaying=!1;for(let r=this._instances.length-1;r>=0;r--)this._instances[r].stop();return this}play(r,t){let e;if(typeof r=="string"?e={sprite:r,loop:this.loop,complete:t}:typeof r=="function"?(e={},e.complete=r):e=r,e={complete:null,loaded:null,sprite:null,end:null,start:0,volume:1,speed:1,muted:!1,loop:!1,...e||{}},e.sprite){let s=e.sprite;console.assert(!!this._sprites[s],`Alias ${s} is not available`);let o=this._sprites[s];e.start=o.start+(e.start||0),e.end=o.end,e.speed=o.speed||1,e.loop=o.loop||e.loop,delete e.sprite}if(e.offset&&(e.start=e.offset),!this.isLoaded)return this._preloadQueue?new Promise(s=>{this._preloadQueue.push(()=>{s(this.play(e))})}):(this._preloadQueue=[],this.autoPlay=!0,this._autoPlayOptions=e,new Promise((s,o)=>{this._preload((n,a,h)=>{this._preloadQueue.forEach(l=>l()),this._preloadQueue=null,n?o(n):(e.loaded&&e.loaded(n,a,h),s(h))})}));(this.singleInstance||e.singleInstance)&&this._removeInstances();let i=this._createInstance();return this._instances.push(i),this.isPlaying=!0,i.once("end",()=>{e.complete&&e.complete(this),this._onComplete(i)}),i.once("stop",()=>{this._onComplete(i)}),i.play(e),i}refresh(){let r=this._instances.length;for(let t=0;t<r;t++)this._instances[t].refresh()}refreshPaused(){let r=this._instances.length;for(let t=0;t<r;t++)this._instances[t].refreshPaused()}get volume(){return this._volume}set volume(r){this._volume=r,this.refresh()}get muted(){return this._muted}set muted(r){this._muted=r,this.refresh()}get loop(){return this._loop}set loop(r){this._loop=r,this.refresh()}_preload(r){this.media.load(r)}get instances(){return this._instances}get sprites(){return this._sprites}get duration(){return this.media.duration}autoPlayStart(){let r;return this.autoPlay&&(r=this.play(this._autoPlayOptions)),r}_removeInstances(){for(let r=this._instances.length-1;r>=0;r--)this._poolInstance(this._instances[r]);this._instances.length=0}_onComplete(r){if(this._instances){let t=this._instances.indexOf(r);t>-1&&this._instances.splice(t,1),this.isPlaying=this._instances.length>0}this._poolInstance(r)}_createInstance(){if(cs._pool.length>0){let r=cs._pool.pop();return r.init(this.media),r}return this.media.create()}_poolInstance(r){r.destroy(),cs._pool.indexOf(r)<0&&cs._pool.push(r)}},Ie=cs;Ie._pool=[];var Ro=class extends S.EventEmitter{constructor(){super(...arguments),this.speed=1,this.muted=!1,this.volume=1,this.paused=!1}refresh(){this.emit("refresh")}refreshPaused(){this.emit("refreshPaused")}get filters(){return console.warn("HTML Audio does not support filters"),null}set filters(t){console.warn("HTML Audio does not support filters")}get audioContext(){return console.warn("HTML Audio does not support audioContext"),null}toggleMute(){return this.muted=!this.muted,this.refresh(),this.muted}togglePause(){return this.paused=!this.paused,this.refreshPaused(),this.paused}destroy(){this.removeAllListeners()}};var ds=class r extends ci{constructor(){let t=window,e=new r.AudioContext,i=e.createDynamicsCompressor(),s=e.createAnalyser();s.connect(i),i.connect(e.destination),super(s,i),this.autoPause=!0,this._ctx=e,this._offlineCtx=new r.OfflineAudioContext(1,2,t.OfflineAudioContext?Math.max(8e3,Math.min(96e3,e.sampleRate)):44100),this.compressor=i,this.analyser=s,this.events=new S.EventEmitter,this.volume=1,this.speed=1,this.muted=!1,this.paused=!1,this._locked=e.state==="suspended"&&("ontouchstart"in globalThis||"onclick"in globalThis),this._locked&&(this._unlock(),this._unlock=this._unlock.bind(this),document.addEventListener("mousedown",this._unlock,!0),document.addEventListener("touchstart",this._unlock,!0),document.addEventListener("touchend",this._unlock,!0)),this.onFocus=this.onFocus.bind(this),this.onBlur=this.onBlur.bind(this),globalThis.addEventListener("focus",this.onFocus),globalThis.addEventListener("blur",this.onBlur)}onFocus(){if(!this.autoPause)return;let t=this._ctx.state;(t==="suspended"||t==="interrupted"||!this._locked)&&(this.paused=this._pausedOnBlur,this.refreshPaused())}onBlur(){this.autoPause&&(this._locked||(this._pausedOnBlur=this._paused,this.paused=!0,this.refreshPaused()))}_unlock(){this._locked&&(this.playEmptySound(),this._ctx.state==="running"&&(document.removeEventListener("mousedown",this._unlock,!0),document.removeEventListener("touchend",this._unlock,!0),document.removeEventListener("touchstart",this._unlock,!0),this._locked=!1))}playEmptySound(){let t=this._ctx.createBufferSource();t.buffer=this._ctx.createBuffer(1,1,22050),t.connect(this._ctx.destination),t.start(0,0,0),t.context.state==="suspended"&&t.context.resume()}static get AudioContext(){let t=window;return t.AudioContext||t.webkitAudioContext||null}static get OfflineAudioContext(){let t=window;return t.OfflineAudioContext||t.webkitOfflineAudioContext||null}destroy(){super.destroy();let t=this._ctx;typeof t.close<"u"&&t.close(),globalThis.removeEventListener("focus",this.onFocus),globalThis.removeEventListener("blur",this.onBlur),this.events.removeAllListeners(),this.analyser.disconnect(),this.compressor.disconnect(),this.analyser=null,this.compressor=null,this.events=null,this._offlineCtx=null,this._ctx=null}get audioContext(){return this._ctx}get offlineContext(){return this._offlineCtx}set paused(t){t&&this._ctx.state==="running"?this._ctx.suspend():!t&&this._ctx.state==="suspended"&&this._ctx.resume(),this._paused=t}get paused(){return this._paused}refresh(){this.events.emit("refresh")}refreshPaused(){this.events.emit("refreshPaused")}toggleMute(){return this.muted=!this.muted,this.refresh(),this.muted}togglePause(){return this.paused=!this.paused,this.refreshPaused(),this._paused}decode(t,e){let i=o=>{e(new Error(o?.message||"Unable to decode file"))},s=this._offlineCtx.decodeAudioData(t,o=>{e(null,o)},i);s&&s.catch(i)}};var ua=class{constructor(){this.init()}init(){return this.supported&&(this._webAudioContext=new ds),this._htmlAudioContext=new Ro,this._sounds={},this.useLegacy=!this.supported,this}get context(){return this._context}get filtersAll(){return this.useLegacy?[]:this._context.filters}set filtersAll(t){this.useLegacy||(this._context.filters=t)}get supported(){return ds.AudioContext!==null}add(t,e){if(typeof t=="object"){let o={};for(let n in t){let a=this._getOptions(t[n],e);o[n]=this.add(n,a)}return o}if(console.assert(!this._sounds[t],`Sound with alias ${t} already exists.`),e instanceof Ie)return this._sounds[t]=e,e;let i=this._getOptions(e),s=Ie.from(i);return this._sounds[t]=s,s}_getOptions(t,e){let i;return typeof t=="string"?i={url:t}:Array.isArray(t)?i={url:t}:t instanceof ArrayBuffer||t instanceof AudioBuffer||t instanceof HTMLAudioElement?i={source:t}:i=t,i={...i,...e||{}},i}get useLegacy(){return this._useLegacy}set useLegacy(t){this._useLegacy=t,this._context=!t&&this.supported?this._webAudioContext:this._htmlAudioContext}get disableAutoPause(){return!this._webAudioContext.autoPause}set disableAutoPause(t){this._webAudioContext.autoPause=!t}remove(t){return this.exists(t,!0),this._sounds[t].destroy(),delete this._sounds[t],this}get volumeAll(){return this._context.volume}set volumeAll(t){this._context.volume=t,this._context.refresh()}get speedAll(){return this._context.speed}set speedAll(t){this._context.speed=t,this._context.refresh()}togglePauseAll(){return this._context.togglePause()}pauseAll(){return this._context.paused=!0,this._context.refreshPaused(),this}resumeAll(){return this._context.paused=!1,this._context.refreshPaused(),this}toggleMuteAll(){return this._context.toggleMute()}muteAll(){return this._context.muted=!0,this._context.refresh(),this}unmuteAll(){return this._context.muted=!1,this._context.refresh(),this}removeAll(){for(let t in this._sounds)this._sounds[t].destroy(),delete this._sounds[t];return this}stopAll(){for(let t in this._sounds)this._sounds[t].stop();return this}exists(t,e=!1){let i=!!this._sounds[t];return e&&console.assert(i,`No sound matching alias '${t}'.`),i}isPlaying(){for(let t in this._sounds)if(this._sounds[t].isPlaying)return!0;return!1}find(t){return this.exists(t,!0),this._sounds[t]}play(t,e){return this.find(t).play(e)}stop(t){return this.find(t).stop()}pause(t){return this.find(t).pause()}resume(t){return this.find(t).resume()}volume(t,e){let i=this.find(t);return e!==void 0&&(i.volume=e),i.volume}speed(t,e){let i=this.find(t);return e!==void 0&&(i.speed=e),i.speed}duration(t){return this.find(t).duration}close(){return this.removeAll(),this._sounds=null,this._webAudioContext&&(this._webAudioContext.destroy(),this._webAudioContext=null),this._htmlAudioContext&&(this._htmlAudioContext.destroy(),this._htmlAudioContext=null),this._context=null,this}};var Re=class{constructor(t,e){this.init(t,e)}init(t,e){this.destination=t,this.source=e||t}connect(t){this.source?.connect(t)}disconnect(){this.source?.disconnect()}destroy(){this.disconnect(),this.destination=null,this.source=null}};var ot=class extends Re{constructor(r=0,t=0,e=0,i=0,s=0,o=0,n=0,a=0,h=0,l=0){let u=[],c=[{f:ot.F32,type:"lowshelf",gain:r},{f:ot.F64,type:"peaking",gain:t},{f:ot.F125,type:"peaking",gain:e},{f:ot.F250,type:"peaking",gain:i},{f:ot.F500,type:"peaking",gain:s},{f:ot.F1K,type:"peaking",gain:o},{f:ot.F2K,type:"peaking",gain:n},{f:ot.F4K,type:"peaking",gain:a},{f:ot.F8K,type:"peaking",gain:h},{f:ot.F16K,type:"highshelf",gain:l}];Ft().useLegacy||(u=c.map(d=>{let p=Ft().context.audioContext.createBiquadFilter();return p.type=d.type,se.setParamValue(p.Q,1),p.frequency.value=d.f,se.setParamValue(p.gain,d.gain),p})),super(u[0],u[u.length-1]),this.bands=u,this.bandsMap={};for(let d=0;d<this.bands.length;d++){let p=this.bands[d];d>0&&this.bands[d-1].connect(p),this.bandsMap[p.frequency.value]=p}}setGain(r,t=0){if(!this.bandsMap[r])throw new Error(`No band found for frequency ${r}`);se.setParamValue(this.bandsMap[r].gain,t)}getGain(r){if(!this.bandsMap[r])throw new Error(`No band found for frequency ${r}`);return this.bandsMap[r].gain.value}set f32(r){this.setGain(ot.F32,r)}get f32(){return this.getGain(ot.F32)}set f64(r){this.setGain(ot.F64,r)}get f64(){return this.getGain(ot.F64)}set f125(r){this.setGain(ot.F125,r)}get f125(){return this.getGain(ot.F125)}set f250(r){this.setGain(ot.F250,r)}get f250(){return this.getGain(ot.F250)}set f500(r){this.setGain(ot.F500,r)}get f500(){return this.getGain(ot.F500)}set f1k(r){this.setGain(ot.F1K,r)}get f1k(){return this.getGain(ot.F1K)}set f2k(r){this.setGain(ot.F2K,r)}get f2k(){return this.getGain(ot.F2K)}set f4k(r){this.setGain(ot.F4K,r)}get f4k(){return this.getGain(ot.F4K)}set f8k(r){this.setGain(ot.F8K,r)}get f8k(){return this.getGain(ot.F8K)}set f16k(r){this.setGain(ot.F16K,r)}get f16k(){return this.getGain(ot.F16K)}reset(){this.bands.forEach(r=>{se.setParamValue(r.gain,0)})}destroy(){this.bands.forEach(r=>{r.disconnect()}),this.bands=null,this.bandsMap=null}},Xe=ot;Xe.F32=32;Xe.F64=64;Xe.F125=125;Xe.F250=250;Xe.F500=500;Xe.F1K=1e3;Xe.F2K=2e3;Xe.F4K=4e3;Xe.F8K=8e3;Xe.F16K=16e3;var df={loader:T.LoadParser,resolver:T.ResolveParser,cache:T.CacheParser,detection:T.DetectionParser};w.handle(T.Asset,r=>{let t=r.ref;Object.entries(df).filter(([e])=>!!t[e]).forEach(([e,i])=>w.add(Object.assign(t[e],{extension:t[e].extension??i})))},r=>{let t=r.ref;Object.keys(df).filter(e=>!!t[e]).forEach(e=>w.remove(t[e]))});var ca=class{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach(e=>{this._assetList.push(e)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;let t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let i=0;i<e;i++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}};function pe(r,t){if(Array.isArray(t)){for(let e of t)if(r.startsWith(`data:${e}`))return!0;return!1}return r.startsWith(`data:${t}`)}function Dt(r,t){let e=r.split("?")[0],i=S.path.extname(e).toLowerCase();return Array.isArray(t)?t.includes(i):i===t}var Vt=(r,t,e=!1)=>(Array.isArray(r)||(r=[r]),t?r.map(i=>typeof i=="string"||e?t(i):i):r);var pi=(r,t)=>{let e=t.split("?")[1];return e&&(r+=`?${e}`),r};function pf(r,t,e,i,s){let o=t[e];for(let n=0;n<o.length;n++){let a=o[n];e<t.length-1?pf(r.replace(i[e],a),t,e+1,i,s):s.push(r.replace(i[e],a))}}function da(r){let t=/\{(.*?)\}/g,e=r.match(t),i=[];if(e){let s=[];e.forEach(o=>{let n=o.substring(1,o.length-1).split(",");s.push(n)}),pf(r,s,0,e,i)}else i.push(r);return i}var yr=r=>!Array.isArray(r);var $l=class{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){let e=this._cache.get(t);return e||console.warn(`[Assets] Asset id ${t} was not found in the Cache`),e}set(t,e){let i=Vt(t),s;for(let a=0;a<this.parsers.length;a++){let h=this.parsers[a];if(h.test(e)){s=h.getCacheableAssets(i,e);break}}s||(s={},i.forEach(a=>{s[a]=e}));let o=Object.keys(s),n={cacheKeys:o,keys:i};if(i.forEach(a=>{this._cacheMap.set(a,n)}),o.forEach(a=>{this._cache.has(a)&&this._cache.get(a)!==e&&console.warn("[Cache] already has key:",a),this._cache.set(a,s[a])}),e instanceof b){let a=e;i.forEach(h=>{a.baseTexture!==b.EMPTY.baseTexture&&W.addToCache(a.baseTexture,h),b.addToCache(a,h)})}}remove(t){if(!this._cacheMap.has(t)){console.warn(`[Assets] Asset id ${t} was not found in the Cache`);return}let e=this._cacheMap.get(t);e.cacheKeys.forEach(i=>{this._cache.delete(i)}),e.keys.forEach(i=>{this._cacheMap.delete(i)})}get parsers(){return this._parsers}},We=new $l;var pa=class{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(t,e,i)=>(this._parsersValidated=!1,t[e]=i,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(t,e){let i={promise:null,parser:null};return i.promise=(async()=>{let s=null,o=null;if(e.loadParser&&(o=this._parserHash[e.loadParser],o||console.warn(`[Assets] specified load parser "${e.loadParser}" not found while loading ${t}`)),!o){for(let n=0;n<this.parsers.length;n++){let a=this.parsers[n];if(a.load&&a.test?.(t,e,this)){o=a;break}}if(!o)return console.warn(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}s=await o.load(t,e,this),i.parser=o;for(let n=0;n<this.parsers.length;n++){let a=this.parsers[n];a.parse&&a.parse&&await a.testParse?.(s,e,this)&&(s=await a.parse(s,e,this)||s,i.parser=a)}return s})(),i}async load(t,e){this._parsersValidated||this._validateParsers();let i=0,s={},o=yr(t),n=Vt(t,l=>({alias:[l],src:l})),a=n.length,h=n.map(async l=>{let u=S.path.toAbsolute(l.src);if(!s[l.src])try{this.promiseCache[u]||(this.promiseCache[u]=this._getLoadPromiseAndParser(u,l)),s[l.src]=await this.promiseCache[u].promise,e&&e(++i/a)}catch(c){throw delete this.promiseCache[u],delete s[l.src],new Error(`[Loader.load] Failed to load ${u}.
${c}`)}});return await Promise.all(h),o?s[n[0].src]:s}async unload(t){let e=Vt(t,i=>({alias:[i],src:i})).map(async i=>{let s=S.path.toAbsolute(i.src),o=this.promiseCache[s];if(o){let n=await o.promise;delete this.promiseCache[s],o.parser?.unload?.(n,i,this)}});await Promise.all(e)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(t=>t.name).reduce((t,e)=>(t[e.name]&&console.warn(`[Assets] loadParser name conflict "${e.name}"`),{...t,[e.name]:e}),{})}};var gt=(r=>(r[r.Low=0]="Low",r[r.Normal=1]="Normal",r[r.High=2]="High",r))(gt||{});var W_=".json",z_="application/json",Yl={extension:{type:T.LoadParser,priority:gt.Low},name:"loadJson",test(r){return pe(r,z_)||Dt(r,W_)},async load(r){return await(await E.ADAPTER.fetch(r)).json()}};w.add(Yl);var j_=".txt",$_="text/plain",ql={name:"loadTxt",extension:{type:T.LoadParser,priority:gt.Low},test(r){return pe(r,$_)||Dt(r,j_)},async load(r){return await(await E.ADAPTER.fetch(r)).text()}};w.add(ql);var Y_=["normal","bold","100","200","300","400","500","600","700","800","900"],q_=[".ttf",".otf",".woff",".woff2"],K_=["font/ttf","font/otf","font/woff","font/woff2"],Z_=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function Kl(r){let t=S.path.extname(r),e=S.path.basename(r,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(o=>o.charAt(0).toUpperCase()+o.slice(1)),i=e.length>0;for(let o of e)if(!o.match(Z_)){i=!1;break}let s=e.join(" ");return i||(s=`"${s.replace(/[\\"]/g,"\\$&")}"`),s}var Q_=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function J_(r){return Q_.test(r)?r:encodeURI(r)}var Zl={extension:{type:T.LoadParser,priority:gt.Low},name:"loadWebFont",test(r){return pe(r,K_)||Dt(r,q_)},async load(r,t){let e=E.ADAPTER.getFontFaceSet();if(e){let i=[],s=t.data?.family??Kl(r),o=t.data?.weights?.filter(a=>Y_.includes(a))??["normal"],n=t.data??{};for(let a=0;a<o.length;a++){let h=o[a],l=new FontFace(s,`url(${J_(r)})`,{...n,weight:h});await l.load(),e.add(l),i.push(l)}return i.length===1?i[0]:i}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(r){(Array.isArray(r)?r:[r]).forEach(t=>E.ADAPTER.getFontFaceSet().delete(t))}};w.add(Zl);var ff=0,Ql,tx="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=",ex={id:"checkImageBitmap",code:`
    async function checkImageBitmap()
    {
        try
        {
            if (typeof createImageBitmap !== 'function') return false;

            const response = await fetch('${tx}');
            const imageBlob =  await response.blob();
            const imageBitmap = await createImageBitmap(imageBlob);

            return imageBitmap.width === 1 && imageBitmap.height === 1;
        }
        catch (e)
        {
            return false;
        }
    }
    checkImageBitmap().then((result) => { self.postMessage(result); });
    `},rx={id:"loadImageBitmap",code:`
    async function loadImageBitmap(url)
    {
        const response = await fetch(url);

        if (!response.ok)
        {
            throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \`
                + \`\${response.status} \${response.statusText}\`);
        }

        const imageBlob =  await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);

        return imageBitmap;
    }
    self.onmessage = async (event) =>
    {
        try
        {
            const imageBitmap = await loadImageBitmap(event.data.data[0]);

            self.postMessage({
                data: imageBitmap,
                uuid: event.data.uuid,
                id: event.data.id,
            }, [imageBitmap]);
        }
        catch(e)
        {
            self.postMessage({
                error: e,
                uuid: event.data.uuid,
                id: event.data.id,
            });
        }
    };`},Jl,tu=class{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(t=>{let e=URL.createObjectURL(new Blob([ex.code],{type:"application/javascript"})),i=new Worker(e);i.addEventListener("message",s=>{i.terminate(),URL.revokeObjectURL(e),t(s.data)})}),this._isImageBitmapSupported)}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){Ql===void 0&&(Ql=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<Ql&&(Jl||(Jl=URL.createObjectURL(new Blob([rx.code],{type:"application/javascript"}))),this._createdWorkers++,t=new Worker(Jl),t.addEventListener("message",e=>{this.complete(e.data),this.returnWorker(e.target),this.next()})),t}returnWorker(t){this.workerPool.push(t)}complete(t){t.error!==void 0?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}async _run(t,e){await this._initWorkers();let i=new Promise((s,o)=>{this.queue.push({id:t,arguments:e,resolve:s,reject:o})});return this.next(),i}next(){if(!this.queue.length)return;let t=this.getWorker();if(!t)return;let e=this.queue.pop(),i=e.id;this.resolveHash[ff]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:ff++,id:i})}},eu=new tu;function Me(r,t,e){r.resource.internal=!0;let i=new b(r),s=()=>{delete t.promiseCache[e],We.has(e)&&We.remove(e)};return i.baseTexture.once("destroyed",()=>{e in t.promiseCache&&(console.warn("[Assets] A BaseTexture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the BaseTexture."),s())}),i.once("destroyed",()=>{r.destroyed||(console.warn("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),s())}),i}var ix=[".jpeg",".jpg",".png",".webp",".avif"],sx=["image/jpeg","image/png","image/webp","image/avif"];async function ru(r){let t=await E.ADAPTER.fetch(r);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${r}: ${t.status} ${t.statusText}`);let e=await t.blob();return await createImageBitmap(e)}var _r={name:"loadTextures",extension:{type:T.LoadParser,priority:gt.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(r){return pe(r,sx)||Dt(r,ix)},async load(r,t,e){let i=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap,s;i?this.config.preferWorkers&&await eu.isImageBitmapSupported()?s=await eu.loadImageBitmap(r):s=await ru(r):s=await new Promise((a,h)=>{let l=new Image;l.crossOrigin=this.config.crossOrigin,l.src=r,l.complete?a(l):(l.onload=()=>a(l),l.onerror=u=>h(u))});let o={...t.data};o.resolution??(o.resolution=S.getResolutionOfUrl(r)),i&&o.resourceOptions?.ownsImageBitmap===void 0&&(o.resourceOptions={...o.resourceOptions},o.resourceOptions.ownsImageBitmap=!0);let n=new W(s,o);return n.resource.src=r,Me(n,e,r)},unload(r){r.destroy(!0)}};w.add(_r);var ox=".svg",nx="image/svg+xml",iu={extension:{type:T.LoadParser,priority:gt.High},name:"loadSVG",test(r){return pe(r,nx)||Dt(r,ox)},async testParse(r){return us.test(r)},async parse(r,t,e){let i=new us(r,t?.data?.resourceOptions);await i.load();let s=new W(i,{resolution:S.getResolutionOfUrl(r),...t?.data});return s.resource.src=t.src,Me(s,e,t.src)},async load(r,t){return(await E.ADAPTER.fetch(r)).text()},unload:_r.unload};w.add(iu);var ax=[".mp4",".m4v",".webm",".ogv"],hx=["video/mp4","video/webm","video/ogg"],su={name:"loadVideo",extension:{type:T.LoadParser,priority:gt.High},config:{defaultAutoPlay:!0},test(r){return pe(r,hx)||Dt(r,ax)},async load(r,t,e){let i,s=await(await E.ADAPTER.fetch(r)).blob(),o=URL.createObjectURL(s);try{let n={autoPlay:this.config.defaultAutoPlay,...t?.data?.resourceOptions},a=new So(o,n);await a.load();let h=new W(a,{alphaMode:await S.detectVideoAlphaMode(),resolution:S.getResolutionOfUrl(r),...t?.data});h.resource.src=r,i=Me(h,e,r),i.baseTexture.once("destroyed",()=>{URL.revokeObjectURL(o)})}catch(n){throw URL.revokeObjectURL(o),n}return i},unload(r){r.destroy(!0)}};w.add(su);var fa=class{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,e)=>`${t}${this._bundleIdConnector}${e}`,extractAssetIdFromBundle:(t,e)=>e.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach(e=>{this._preferredOrder.push(e),e.priority||(e.priority=Object.keys(e.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if(typeof t=="string")this._defaultSearchParams=t;else{let e=t;this._defaultSearchParams=Object.keys(e).map(i=>`${encodeURIComponent(i)}=${encodeURIComponent(e[i])}`).join("&")}}getAlias(t){let{alias:e,name:i,src:s,srcs:o}=t;return Vt(e||i||s||o,n=>typeof n=="string"?n:Array.isArray(n)?n.map(a=>a?.src??a?.srcs??a):n?.src||n?.srcs?n.src??n.srcs:n,!0)}addManifest(t){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach(e=>{this.addBundle(e.name,e.assets)})}addBundle(t,e){let i=[];Array.isArray(e)?e.forEach(s=>{let o=s.src??s.srcs,n=s.alias??s.name,a;if(typeof n=="string"){let h=this._createBundleAssetId(t,n);i.push(h),a=[n,h]}else{let h=n.map(l=>this._createBundleAssetId(t,l));i.push(...h),a=[...n,...h]}this.add({...s,alias:a,src:o})}):Object.keys(e).forEach(s=>{let o=[s,this._createBundleAssetId(t,s)];if(typeof e[s]=="string")this.add({alias:o,src:e[s]});else if(Array.isArray(e[s]))this.add({alias:o,src:e[s]});else{let n=e[s],a=n.src??n.srcs;this.add({...n,alias:o,src:Array.isArray(a)?a:[a]})}i.push(...o)}),this._bundles[t]=i}add(t,e,i,s,o){let n=[];typeof t=="string"||Array.isArray(t)&&typeof t[0]=="string"?(S.deprecation("7.2.0",`Assets.add now uses an object instead of individual parameters.
Please use Assets.add({ alias, src, data, format, loadParser }) instead.`),n.push({alias:t,src:e,data:i,format:s,loadParser:o})):Array.isArray(t)?n.push(...t):n.push(t);let a;a=h=>{this.hasKey(h)&&console.warn(`[Resolver] already has key: ${h} overwriting`)},Vt(n).forEach(h=>{let{src:l,srcs:u}=h,{data:c,format:d,loadParser:p}=h,f=Vt(l||u).map(y=>typeof y=="string"?da(y):Array.isArray(y)?y:[y]),m=this.getAlias(h);Array.isArray(m)?m.forEach(a):a(m);let g=[];f.forEach(y=>{y.forEach(v=>{let _={};if(typeof v!="object"){_.src=v;for(let x=0;x<this._parsers.length;x++){let M=this._parsers[x];if(M.test(v)){_=M.parse(v);break}}}else c=v.data??c,d=v.format??d,p=v.loadParser??p,_={..._,...v};if(!m)throw new Error(`[Resolver] alias is undefined for this asset: ${_.src}`);_=this.buildResolvedAsset(_,{aliases:m,data:c,format:d,loadParser:p}),g.push(_)})}),m.forEach(y=>{this._assetMap[y]=g})})}resolveBundle(t){let e=yr(t);t=Vt(t);let i={};return t.forEach(s=>{let o=this._bundles[s];if(o){let n=this.resolve(o),a={};for(let h in n){let l=n[h];a[this._extractAssetIdFromBundle(s,h)]=l}i[s]=a}}),e?i[t[0]]:i}resolveUrl(t){let e=this.resolve(t);if(typeof t!="string"){let i={};for(let s in e)i[s]=e[s].src;return i}return e.src}resolve(t){let e=yr(t);t=Vt(t);let i={};return t.forEach(s=>{if(!this._resolverHash[s])if(this._assetMap[s]){let o=this._assetMap[s],n=o[0],a=this._getPreferredOrder(o);a?.priority.forEach(h=>{a.params[h].forEach(l=>{let u=o.filter(c=>c[h]?c[h]===l:!1);u.length&&(o=u)})}),this._resolverHash[s]=o[0]??n}else this._resolverHash[s]=this.buildResolvedAsset({alias:[s],src:s},{});i[s]=this._resolverHash[s]}),e?i[t[0]]:i}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let e=0;e<t.length;e++){let i=t[0],s=this._preferredOrder.find(o=>o.params.format.includes(i.format));if(s)return s}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;let e=/\?/.test(t)?"&":"?";return`${t}${e}${this._defaultSearchParams}`}buildResolvedAsset(t,e){let{aliases:i,data:s,loadParser:o,format:n}=e;return(this._basePath||this._rootPath)&&(t.src=S.path.toAbsolute(t.src,this._basePath,this._rootPath)),t.alias=i??t.alias??[t.src],t.src=this._appendDefaultSearchParams(t.src),t.data={...s||{},...t.data},t.loadParser=o??t.loadParser,t.format=n??S.path.extname(t.src).slice(1),t.srcs=t.src,t.name=t.alias,t}};var ma=class{constructor(){this._detections=[],this._initialized=!1,this.resolver=new fa,this.loader=new pa,this.cache=We,this._backgroundLoader=new ca(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){if(this._initialized){console.warn("[Assets]AssetManager already initialized, did you load before calling this Asset.init()?");return}if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let o=t.manifest;typeof o=="string"&&(o=await this.load(o)),this.resolver.addManifest(o)}let e=t.texturePreference?.resolution??1,i=typeof e=="number"?[e]:e,s=await this._detectFormats({preferredFormats:t.texturePreference?.format,skipDetections:t.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:s,resolution:i}}),t.preferences&&this.setPreferences(t.preferences)}add(t,e,i,s,o){this.resolver.add(t,e,i,s,o)}async load(t,e){this._initialized||await this.init();let i=yr(t),s=Vt(t).map(a=>{if(typeof a!="string"){let h=this.resolver.getAlias(a);return h.some(l=>!this.resolver.hasKey(l))&&this.add(a),Array.isArray(h)?h[0]:h}return this.resolver.hasKey(a)||this.add({alias:a,src:a}),a}),o=this.resolver.resolve(s),n=await this._mapLoadToResolve(o,e);return i?n[s[0]]:n}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let i=!1;typeof t=="string"&&(i=!0,t=[t]);let s=this.resolver.resolveBundle(t),o={},n=Object.keys(s),a=0,h=0,l=()=>{e?.(++a/h)},u=n.map(c=>{let d=s[c];return h+=Object.keys(d).length,this._mapLoadToResolve(d,l).then(p=>{o[c]=p})});return await Promise.all(u),i?o[t[0]]:o}async backgroundLoad(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);let e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);let e=this.resolver.resolveBundle(t);Object.values(e).forEach(i=>{this._backgroundLoader.add(Object.values(i))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if(typeof t=="string")return We.get(t);let e={};for(let i=0;i<t.length;i++)e[i]=We.get(t[i]);return e}async _mapLoadToResolve(t,e){let i=Object.values(t),s=Object.keys(t);this._backgroundLoader.active=!1;let o=await this.loader.load(i,e);this._backgroundLoader.active=!0;let n={};return i.forEach((a,h)=>{let l=o[a.src],u=[a.src];a.alias&&u.push(...a.alias),n[s[h]]=l,We.set(u,l)}),n}async unload(t){this._initialized||await this.init();let e=Vt(t).map(s=>typeof s!="string"?s.src:s),i=this.resolver.resolve(e);await this._unloadFromResolved(i)}async unloadBundle(t){this._initialized||await this.init(),t=Vt(t);let e=this.resolver.resolveBundle(t),i=Object.keys(e).map(s=>this._unloadFromResolved(e[s]));await Promise.all(i)}async _unloadFromResolved(t){let e=Object.values(t);e.forEach(i=>{We.remove(i.src)}),await this.loader.unload(e)}async _detectFormats(t){let e=[];t.preferredFormats&&(e=Array.isArray(t.preferredFormats)?t.preferredFormats:[t.preferredFormats]);for(let i of t.detections)t.skipDetections||await i.test()?e=await i.add(e):t.skipDetections||(e=await i.remove(e));return e=e.filter((i,s)=>e.indexOf(i)===s),e}get detections(){return this._detections}get preferWorkers(){return _r.config.preferWorkers}set preferWorkers(t){S.deprecation("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:t})}setPreferences(t){this.loader.parsers.forEach(e=>{e.config&&Object.keys(e.config).filter(i=>i in t).forEach(i=>{e.config[i]=t[i]})})}},Be=new ma;w.handleByList(T.LoadParser,Be.loader.parsers).handleByList(T.ResolveParser,Be.resolver.parsers).handleByList(T.CacheParser,Be.cache.parsers).handleByList(T.DetectionParser,Be.detections);var ou={extension:T.CacheParser,test:r=>Array.isArray(r)&&r.every(t=>t instanceof b),getCacheableAssets:(r,t)=>{let e={};return r.forEach(i=>{t.forEach((s,o)=>{e[i+(o===0?"":o+1)]=s})}),e}};w.add(ou);async function ga(r){if("Image"in globalThis)return new Promise(t=>{let e=new Image;e.onload=()=>{t(!0)},e.onerror=()=>{t(!1)},e.src=r});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{let t=await(await fetch(r)).blob();await createImageBitmap(t)}catch{return!1}return!0}return!1}var nu={extension:{type:T.DetectionParser,priority:1},test:async()=>ga("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async r=>[...r,"avif"],remove:async r=>r.filter(t=>t!=="avif")};w.add(nu);var au={extension:{type:T.DetectionParser,priority:0},test:async()=>ga("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async r=>[...r,"webp"],remove:async r=>r.filter(t=>t!=="webp")};w.add(au);var mf=["png","jpg","jpeg"],hu={extension:{type:T.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async r=>[...r,...mf],remove:async r=>r.filter(t=>!mf.includes(t))};w.add(hu);var lx="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function ps(r){return lx?!1:document.createElement("video").canPlayType(r)!==""}var lu={extension:{type:T.DetectionParser,priority:0},test:async()=>ps("video/webm"),add:async r=>[...r,"webm"],remove:async r=>r.filter(t=>t!=="webm")};w.add(lu);var uu={extension:{type:T.DetectionParser,priority:0},test:async()=>ps("video/mp4"),add:async r=>[...r,"mp4","m4v"],remove:async r=>r.filter(t=>t!=="mp4"&&t!=="m4v")};w.add(uu);var cu={extension:{type:T.DetectionParser,priority:0},test:async()=>ps("video/ogg"),add:async r=>[...r,"ogv"],remove:async r=>r.filter(t=>t!=="ogv")};w.add(cu);var du={extension:T.ResolveParser,test:_r.test,parse:r=>({resolution:parseFloat(E.RETINA_PREFIX.exec(r)?.[1]??"1"),format:S.path.extname(r).slice(1),src:r})};w.add(du);var gf=r=>{let t=r.src;return r?.alias?.[0]??S.path.basename(t,S.path.extname(t))},yf={extension:T.Asset,detection:{test:async()=>!0,add:async r=>[...r,...li.filter(t=>ui[t])],remove:async r=>r.filter(t=>r.includes(t))},loader:{extension:{type:[T.LoadParser],priority:gt.High},test(r){let t=S.path.extname(r).slice(1);return!!ui[t]||jl.some(e=>r.startsWith(`data:${e}`))},async load(r,t){let e=await new Promise((i,s)=>Ie.from({...t.data,url:r,preload:!0,loaded(o,n){o?s(o):i(n),t.data?.loaded?.(o,n)}}));return Ft().add(gf(t),e),e},async unload(r,t){Ft().remove(gf(t))}}};w.add(yf);var TL=lf(new ua);var _f={engine_start_1:{start:0,end:1.8995918367346938,loop:!1},engine_start_2:{start:3,end:5,loop:!1},engine_start_3:{start:6,end:8,loop:!1},explosion_1:{start:9,end:11,loop:!1},explosion_2:{start:12,end:13.5,loop:!1},explosion_3:{start:15,end:17,loop:!1},explosion_4:{start:18,end:19.5,loop:!1},money_collect_2:{start:21,end:21.5,loop:!1},money_collect_3:{start:23,end:23.82,loop:!1},money_collect_4:{start:25,end:25.82,loop:!1},player_car_crash:{start:27,end:31,loop:!1},power_up_4:{start:32,end:33.5,loop:!1},power_up_5:{start:35,end:36.5,loop:!1},projectile:{start:38,end:38.5,loop:!1},rocket_spawn_1:{start:40,end:41.08335600907029,loop:!1},rocket_spawn_2:{start:43,end:44.08335600907029,loop:!1},rocket_spawn_3:{start:46,end:47.5,loop:!1},ui_click_1:{start:49,end:49.51,loop:!1},ui_menu_whoosh:{start:51,end:51.5,loop:!1},upgrade_3:{start:53,end:55.5,loop:!1}};var Fe=class{active=!0;memorize=!1;bindings=[];prevParameters=[];dispatch(t){this.active&&(this.memorize&&this.prevParameters.push(t),this.bindings.slice().forEach(e=>e.execute(t)))}add(t,e){return this.addBinding(new ya(this,t,e,!1))}addOnce(t,e){return this.addBinding(new ya(this,t,e,!0))}addBinding(t){return this.bindings.push(t),this.memorize&&this.prevParameters.forEach(e=>t.execute(e)),t}remove(t){this.bindings=this.bindings.filter(e=>e!=t),t.destroy()}removeAll(){this.bindings.slice().forEach(t=>t.destroy()),this.bindings.length=0}},ya=class{active=!0;once=!1;callback;filter;signal;constructor(t,e,i=null,s=!1){this.signal=t,this.callback=e,this.filter=i,this.once=s}execute(t){if(!this.signal||!this.callback||!this.active||this.filter&&!this.filter(t))return;let e=this.callback;e(t),this.once&&this.detach()}detach(){this.signal&&this.signal.remove(this)}destroy(){this.signal=null,this.callback=null,this.filter=null}};var Mo=class{onChange=new Fe;reasons=[];add(t){let e=this.isEmpty();this.reasons.push(t),e&&this.onChange.dispatch(!0)}remove(t){let e=this.isEmpty();this.reasons=this.reasons.filter(i=>i!==t),!e&&this.isEmpty()&&this.onChange.dispatch(!1)}isEmpty(){return this.reasons.length===0}};var _a=class{soundEnabled=!0;musicEnabled=!0;sound;music;musicTrack;musicContext;soundMuteReasons=new Mo;musicMuteReasons=new Mo;musicAvailable=!1;constructor(){this.sound=Ie.from({url:"assets/sounds/sounds.mp3",sprites:_f}),this.music={calm:Ie.from("assets/music/calm.mp3"),active:Ie.from("assets/music/active.mp3")},this.musicContext="calm",this.musicTrack=this.music.calm,this.soundMuteReasons.onChange.add(t=>{this.sound.volume=t?0:1,this.soundEnabled=!t}),this.musicMuteReasons.onChange.add(t=>{Object.values(this.music).forEach(e=>e.volume=t?0:1),this.musicEnabled=!t})}init(t,e){this.setSoundEnabled(t,"UserAction"),this.setMusicEnabled(e,"UserAction")}playSound(t){this.sound.play(t)}stopMusic(){this.musicTrack.stop()}setMusicContext(t){this.musicContext!=t&&(this.musicContext=t,this.playMusic(t))}playMusic(t){this.musicTrack.stop(),this.music[t].play({loop:!0}),this.musicTrack=this.music[t]}getSoundEnabled(){return this.soundEnabled}setSoundEnabled(t,e){t?this.soundMuteReasons.remove(e):this.soundMuteReasons.add(e)}getMusicEnabled(){return this.musicEnabled}setMusicEnabled(t,e){console.log(`Music enabled: ${t}, reason: ${e}`),t?this.musicMuteReasons.remove(e):this.musicMuteReasons.add(e)}};var xf="car-shooter",vf={money:0,reputation:0,selectedCar:0,cars:[{id:0,unlocked:!0,upgrades:{armor:0,damage:0,guns:0}},{id:1,unlocked:!1,upgrades:{armor:0,damage:0,guns:0}},{id:2,unlocked:!1,upgrades:{armor:0,damage:0,guns:0}}]},xa=class{data;constructor(){this.data=this.loadLocal()}loadLocal(){let t=localStorage.getItem(xf);return t?JSON.parse(t):Object.assign({},vf)}reset(){this.data=Object.assign({},vf),this.saveLocal()}saveLocal(){localStorage.setItem(xf,JSON.stringify(this.data))}upgradeCar(t,e){this.data.cars[t].upgrades[e]++,this.saveLocal()}getCarUpgrades(t){return this.data.cars[t||this.data.selectedCar].upgrades}getCarUpgrade(t,e){return this.data.cars[e||this.data.selectedCar].upgrades[t]}};var Bo=new K,cx=new Uint16Array([0,1,2,0,2,3]),B=class r extends O{constructor(t){super(),this._anchor=new be(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new Q(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=Y.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||b.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=cx,this.pluginName="batch",this.isSprite=!0,this._roundPixels=E.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=S.sign(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=S.sign(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){let t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;let e=this.transform.worldTransform,i=e.a,s=e.b,o=e.c,n=e.d,a=e.tx,h=e.ty,l=this.vertexData,u=t.trim,c=t.orig,d=this._anchor,p=0,f=0,m=0,g=0;if(u?(f=u.x-d._x*c.width,p=f+u.width,g=u.y-d._y*c.height,m=g+u.height):(f=-d._x*c.width,p=f+c.width,g=-d._y*c.height,m=g+c.height),l[0]=i*f+o*g+a,l[1]=n*g+s*f+h,l[2]=i*p+o*g+a,l[3]=n*g+s*p+h,l[4]=i*p+o*m+a,l[5]=n*m+s*p+h,l[6]=i*f+o*m+a,l[7]=n*m+s*f+h,this._roundPixels){let y=E.RESOLUTION;for(let v=0;v<l.length;++v)l[v]=Math.round(l[v]*y)/y}}calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;let t=this._texture,e=this.vertexTrimmedData,i=t.orig,s=this._anchor,o=this.transform.worldTransform,n=o.a,a=o.b,h=o.c,l=o.d,u=o.tx,c=o.ty,d=-s._x*i.width,p=d+i.width,f=-s._y*i.height,m=f+i.height;if(e[0]=n*d+h*f+u,e[1]=l*f+a*d+c,e[2]=n*p+h*f+u,e[3]=l*f+a*p+c,e[4]=n*p+h*m+u,e[5]=l*m+a*p+c,e[6]=n*d+h*m+u,e[7]=l*m+a*d+c,this._roundPixels){let g=E.RESOLUTION;for(let y=0;y<e.length;++y)e[y]=Math.round(e[y]*g)/g}}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){let t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return this.children.length===0?(this._localBounds||(this._localBounds=new er),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new z),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,Bo);let e=this._texture.orig.width,i=this._texture.orig.height,s=-e*this.anchor.x,o=0;return Bo.x>=s&&Bo.x<s+e&&(o=-i*this.anchor.y,Bo.y>=o&&Bo.y<o+i)}destroy(t){if(super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof t=="boolean"?t:t?.texture){let e=typeof t=="boolean"?t:t?.baseTexture;this._texture.destroy(!!e)}this._texture=null}static from(t,e){let i=t instanceof b?t:b.from(t,e);return new r(i)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1,this._transformTrimmedID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){let e=S.sign(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){let e=S.sign(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||b.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}};var Nr=class extends O{halfWidth=.5;roadX=0;lane;body;health=100;constructor(){super(),this.scale.set(.8)}};var Lt=class{inactiveInstances=[];activeInstances=[];createFunction;resetFunction;destroyFunction;constructor(t,e,i){this.createFunction=t,this.resetFunction=e,this.destroyFunction=i}getInstance(){let t=this.inactiveInstances.pop()||this.createFunction();return this.activeInstances.push(t),this.resetFunction(t),t}release(t){t.parent&&t.parent.removeChild(t),this.activeInstances=this.activeInstances.filter(e=>e!=t),this.inactiveInstances.push(t)}destroy(){[...this.activeInstances,...this.inactiveInstances].forEach(t=>this.destroyFunction(t))}};var Fo;typeof self>"u"&&typeof process<"u"&&process.hrtime?Fo=function(){let r=process.hrtime();return r[0]*1e3+r[1]/1e6}:typeof self<"u"&&self.performance!==void 0&&self.performance.now!==void 0?Fo=self.performance.now.bind(self.performance):Date.now!==void 0?Fo=Date.now:Fo=function(){return new Date().getTime()};var fi=class r{constructor(){r.prototype.__init.call(this),r.prototype.__init2.call(this),r.prototype.__init3.call(this),r.prototype.__init4.call(this)}__init(){this._tweens={}}static get shared(){return r._shared||(r._shared=new r),r._shared}__init2(){this._paused=!1}isPaused(){return this._paused}pause(){this._paused=!0}resume(){this._paused=!1}__init3(){this._lastUpdateTime=void 0}__init4(){this.now=Fo}getAll(){return Object.keys(this._tweens).map(t=>this._tweens[t])}removeAll(){this._tweens={}}add(t){this._tweens[t.getId()]=t}remove(t){delete this._tweens[t.getId()]}update(t,e=!1){if(t==null&&(this._lastUpdateTime==null?(this._lastUpdateTime=this.now(),t=0):t=this.now()-this._lastUpdateTime),this._lastUpdateTime=this.now(),this._paused)return!1;let i=Object.keys(this._tweens);if(i.length==0)return!1;for(let s=0;s<i.length;s++){let o=this._tweens[i[s]];o&&o.update(t,!0)==!1&&!e&&delete this._tweens[i[s]]}return!0}},Ot={Step:{None(r){return r<.5?0:1}},Linear:{None(r){return r}},Quadratic:{In(r){return r*r},Out(r){return r*(2-r)},InOut(r){return(r*=2)<1?.5*r*r:-.5*(--r*(r-2)-1)}},Cubic:{In(r){return r*r*r},Out(r){return--r*r*r+1},InOut(r){return(r*=2)<1?.5*r*r*r:.5*((r-=2)*r*r+2)}},Quartic:{In(r){return r*r*r*r},Out(r){return 1- --r*r*r*r},InOut(r){return(r*=2)<1?.5*r*r*r*r:-.5*((r-=2)*r*r*r-2)}},Quintic:{In(r){return r*r*r*r*r},Out(r){return--r*r*r*r*r+1},InOut(r){return(r*=2)<1?.5*r*r*r*r*r:.5*((r-=2)*r*r*r*r+2)}},Sinusoidal:{In(r){return 1-Math.cos(r*Math.PI/2)},Out(r){return Math.sin(r*Math.PI/2)},InOut(r){return .5*(1-Math.cos(Math.PI*r))}},Exponential:{In(r){return r==0?0:Math.pow(1024,r-1)},Out(r){return r==1?1:1-Math.pow(2,-10*r)},InOut(r){return r==0?0:r==1?1:(r*=2)<1?.5*Math.pow(1024,r-1):.5*(-Math.pow(2,-10*(r-1))+2)}},Circular:{In(r){return 1-Math.sqrt(1-r*r)},Out(r){return Math.sqrt(1- --r*r)},InOut(r){return(r*=2)<1?-.5*(Math.sqrt(1-r*r)-1):.5*(Math.sqrt(1-(r-=2)*r)+1)}},Elastic:{In(r){return r==0?0:r==1?1:-Math.pow(2,10*(r-1))*Math.sin((r-1.1)*5*Math.PI)},Out(r){return r==0?0:r==1?1:Math.pow(2,-10*r)*Math.sin((r-.1)*5*Math.PI)+1},InOut(r){return r==0?0:r==1?1:(r*=2,r<1?-.5*Math.pow(2,10*(r-1))*Math.sin((r-1.1)*5*Math.PI):.5*Math.pow(2,-10*(r-1))*Math.sin((r-1.1)*5*Math.PI)+1)}},Back:{In(r){return r*r*((1.70158+1)*r-1.70158)},Out(r){return--r*r*((1.70158+1)*r+1.70158)+1},InOut(r){let t=2.5949095;return(r*=2)<1?.5*(r*r*((t+1)*r-t)):.5*((r-=2)*r*((t+1)*r+t)+2)}},Bounce:{In(r){return 1-Ot.Bounce.Out(1-r)},Out(r){return r<1/2.75?7.5625*r*r:r<2/2.75?7.5625*(r-=1.5/2.75)*r+.75:r<2.5/2.75?7.5625*(r-=2.25/2.75)*r+.9375:7.5625*(r-=2.625/2.75)*r+.984375},InOut(r){return r<.5?Ot.Bounce.In(r*2)*.5:Ot.Bounce.Out(r*2-1)*.5+.5}}},tt={Geom:{Linear(r,t){let e=r.length-1,i=e*t,s=Math.floor(i),o=tt.Utils.Linear;return t<0?o(r[0],r[1],i):t>1?o(r[e],r[e-1],e-i):o(r[s],r[s+1>e?e:s+1],i-s)},Bezier(r,t){let e=0,i=r.length-1,s=Math.pow,o=tt.Utils.Bernstein;for(let n=0;n<=i;n++)e+=o(i,n)*s(1-t,i-n)*s(t,n)*r[n];return e},QuadraticBezier(r,t){let e=0,i=r.length-1;if(t==1)return r[i];let s=Math.pow,o=tt.Utils.Bernstein,n=i*t,a=Math.floor(n),h=(n-a)*.5+.5*(a%2),l=a-a%2,u=l+1,c=l+2;return e+=o(2,0)*s(1-h,2)*s(h,0)*r[l],e+=o(2,1)*s(1-h,1)*s(h,1)*r[u],e+=o(2,2)*s(1-h,0)*s(h,2)*r[c],e},CubicBezier(r,t){let e=0,i=r.length-1;if(t==1)return r[i];let s=Math.pow,o=tt.Utils.Bernstein,n=i*t,a=Math.floor(n),h=(n-a)*(1/3)+1/3*(a%3),l=a-a%3,u=l+1,c=l+2,d=l+3;return e+=o(3,0)*s(1-h,3)*s(h,0)*r[l],e+=o(3,1)*s(1-h,2)*s(h,1)*r[u],e+=o(3,2)*s(1-h,1)*s(h,2)*r[c],e+=o(3,3)*s(1-h,0)*s(h,3)*r[d],e},CatmullRom(r,t){let e=r.length-1,i=e*t,s=Math.floor(i),o=tt.Utils.CatmullRom;return r[0]==r[e]?(t<0&&(s=Math.floor(i=e*(1+t))),o(r[(s-1+e)%e],r[s],r[(s+1)%e],r[(s+2)%e],i-s)):t<0?r[0]-(o(r[0],r[0],r[1],r[1],-i)-r[0]):t>1?r[e]-(o(r[e],r[e],r[e-1],r[e-1],i-e)-r[e]):o(r[s?s-1:0],r[s],r[e<s+1?e:s+1],r[e<s+2?e:s+2],i-s)}},Angle:{Radians(r,t){let e=r.length-1,i=e*t,s=Math.floor(i),o=tt.Utils.WrapLinear;return t<0?o(r[0],r[1],i,2*Math.PI):t>1?o(r[e],r[e-1],e-i,2*Math.PI):o(r[s],r[s+1>e?e:s+1],i-s,2*Math.PI)},Degrees(r,t){let e=r.length-1,i=e*t,s=Math.floor(i),o=tt.Utils.WrapLinear;return t<0?o(r[0],r[1],i,360):t>1?o(r[e],r[e-1],e-i,360):o(r[s],r[s+1>e?e:s+1],i-s,360)}},Color:{RGB(r,t){let e=r.length-1,i=e*t,s=Math.floor(i),o=tt.Utils.RGBLinear;return t<0?o(r[0],r[1],i):t>1?o(r[e],r[e-1],e-i):o(r[s],r[s+1>e?e:s+1],i-s)},HSV(r,t){let e=r.length-1,i=e*t,s=Math.floor(i),o=tt.Utils.HSVLinear;return t<0?o(r[0],r[1],i):t>1?o(r[e],r[e-1],e-i):o(r[s],r[s+1>e?e:s+1],i-s)},HCL(r,t){let e=r.length-1,i=e*t,s=Math.floor(i),o=tt.Utils.HCLLinear;return t<0?o(r[0],r[1],i):t>1?o(r[e],r[e-1],e-i):o(r[s],r[s+1>e?e:s+1],i-s)}},Utils:{RGBsplit(r){let t=r>>24&255,e=r>>16&255,i=r>>8&255,s=r&255;return{a:t,r:e,g:i,b:s}},HSVsplit(r){let t=tt.Utils.RGBsplit(r);t.r/=255,t.g/=255,t.b/=255;let e=Math.max(t.r,t.g,t.b),i=Math.min(t.r,t.g,t.b),s,o=e,n=e-i,a=e==0?0:n/e;if(e==i)s=0;else{switch(e){case t.r:s=(t.g-t.b)/n+(t.g<t.b?6:0);break;case t.g:s=(t.b-t.r)/n+2;break;case t.b:s=(t.r-t.g)/n+4;break}s/=6}return{a:t.a,h:s,s:a,v:o}},HSVJoin(r){let t,e,i,s=Math.floor(r.h*6),o=r.h*6-s,n=r.v*(1-r.s),a=r.v*(1-o*r.s),h=r.v*(1-(1-o)*r.s);switch(s%6){case 0:t=r.v,e=h,i=n;break;case 1:t=a,e=r.v,i=n;break;case 2:t=n,e=r.v,i=h;break;case 3:t=n,e=a,i=r.v;break;case 4:t=h,e=n,i=r.v;break;case 5:t=r.v,e=n,i=a;break}return r.a<<24|t<<16|e<<8|i},HCLSplit(r){let i=.530454533953517,s=tt.Utils.RGBsplit(r),o={a:s.a,h:0,c:0,l:0},n=0,a=Math.min(s.r,Math.min(s.g,s.b)),h=Math.max(s.r,Math.max(s.g,s.b)),l=3/100;return o.c=h-a,o.c!=0&&(n=Math.atan2(s.g-s.b,s.r-s.g)/Math.PI,l*=a/h),l=Math.exp(l),o.h=(n/2-Math.min(n%1,-n%1)/6)%1,o.c*=l,o.l=tt.Utils.Linear(-a,h,l)/(i*2),o},HCLJoin(r){let i=.530454533953517,s={a:r.a,r:0,g:0,b:0};if(r.l!=0){let o=r.h,n=r.c,a=r.l*i,h=Math.exp((1-n/(2*a))*(3/100)),l=(2*a-n)/(2*h-1),u=n/h,c=(o+Math.min(2*o%1/4,-2*o%1/8))*Math.PI*2,d;o*=6,o<=.999?(d=Math.tan(c),s.r=1,s.g=d/(1+d)):o<=1.001?(s.r=1,s.g=1):o<=2?(d=Math.tan(c),s.r=(1+d)/d,s.g=1):o<=3?(d=Math.tan(c),s.g=1,s.b=1+d):o<=3.999?(d=Math.tan(c),s.g=1/(1+d),s.b=1):o<=4.001?(s.g=0,s.b=1):o<=5?(d=Math.tan(c),s.r=-1/d,s.b=1):(d=Math.tan(c),s.r=1,s.b=-d),s.r=s.r*u+l,s.g=s.g*u+l,s.b=s.b*u+l}return s.a<<24|s.r<<16|s.g<<8|s.b},WrapLinear(r,t,e,i){let s;return r=(r+i*Math.trunc(Math.abs(r/i)))%i,t=(t+i*Math.trunc(Math.abs(t/i)))%i,Math.abs(r-t)<=.5*i?s=tt.Utils.Linear(r,t,e):(r<t?s=tt.Utils.Linear(r+i,t,e):s=tt.Utils.Linear(r,t+i,e),s=s%i),s},RGBLinear(r,t,e){let i=tt.Utils.RGBsplit(r),s=tt.Utils.RGBsplit(t),o=tt.Utils.Linear(i.a,s.a,e),n=tt.Utils.Linear(i.r,s.r,e),a=tt.Utils.Linear(i.g,s.g,e),h=tt.Utils.Linear(i.b,s.b,e);return o<<24|n<<16|a<<8|h},HSVLinear(r,t,e){let i=tt.Utils.HSVsplit(r),s=tt.Utils.HSVsplit(t),o;Math.abs(i.h-s.h)<=.5?o=tt.Utils.Linear(i.h,s.h,e):(i.h<s.h?o=tt.Utils.Linear(i.h+1,s.h,e):o=tt.Utils.Linear(i.h,s.h+1,e),o=o%1);let n=tt.Utils.Linear(i.s,s.s,e),a=tt.Utils.Linear(i.v,s.v,e),h=tt.Utils.Linear(i.a,s.a,e);return tt.Utils.HSVJoin({a:h,h:o,s:n,v:a})},HCLLinear(r,t,e){let i=tt.Utils.HCLSplit(r),s=tt.Utils.HCLSplit(t),o;Math.abs(i.h-s.h)<=.5?o=tt.Utils.Linear(i.h,s.h,e):(i.h<s.h?o=tt.Utils.Linear(i.h+1,s.h,e):o=tt.Utils.Linear(i.h,s.h+1,e),o=o%1);let n=tt.Utils.Linear(i.c,s.c,e),a=tt.Utils.Linear(i.l,s.l,e),h=tt.Utils.Linear(i.a,s.a,e);return tt.Utils.HSVJoin({a:h,h:o,s:n,v:a})},Linear(r,t,e){return(t-r)*e+r},Bernstein(r,t){let e=tt.Utils.Factorial;return e(r)/e(t)/e(r-t)},Factorial:function(){let r=[1];return function(t){let e=1;if(r[t])return r[t];for(let i=t;i>1;i--)e*=i;return r[t]=e,e}}(),CatmullRom(r,t,e,i,s){let o=(e-r)*.5,n=(i-t)*.5,a=s*s,h=s*a;return(2*t-2*e+o+n)*h+(-3*t+3*e-2*o-n)*a+o*s+t}}},ba=class r{static __initStatic(){this._nextId=0}static nextId(){return r._nextId++}};ba.__initStatic();var va={safetyCheckFunction:r=>!0,easingFunction:Ot.Linear.None,yoyoEasingFunction:void 0,interpolationFunction:tt.Geom.Linear},Nt=class r{__init(){this._isPaused=!1}__init2(){this._valuesStart={}}__init3(){this._valuesEnd={}}__init4(){this._valuesStartRepeat={}}__init5(){this._duration=0}__init6(){this._repeatCount=0}__init7(){this._repeat=0}__init8(){this._yoyo=!1}__init9(){this._isPlaying=!1}get _reversed(){return this.yoyo&&this._repeatCount%2!==0}__init10(){this._delayTime=0}__init11(){this._startTime=0}__init12(){this._elapsedTime=0}__init13(){this._timescale=1}__init14(){this._safetyCheckFunction=va.safetyCheckFunction}__init15(){this._easingFunction=va.easingFunction}__init16(){this._yoyoEasingFunction=va.yoyoEasingFunction}__init17(){this._interpolationFunction=va.interpolationFunction}__init18(){this._chainedTweens=[]}__init19(){this._onStartCallbackFired=!1}__init20(){this._onAfterDelayCallbackFired=!1}__init21(){this._id=ba.nextId()}__init22(){this._isChainStopped=!1}get _group(){return this._groupRef?this._groupRef:fi.shared}set _group(t){this._groupRef=t}constructor(t,e){r.prototype.__init.call(this),r.prototype.__init2.call(this),r.prototype.__init3.call(this),r.prototype.__init4.call(this),r.prototype.__init5.call(this),r.prototype.__init6.call(this),r.prototype.__init7.call(this),r.prototype.__init8.call(this),r.prototype.__init9.call(this),r.prototype.__init10.call(this),r.prototype.__init11.call(this),r.prototype.__init12.call(this),r.prototype.__init13.call(this),r.prototype.__init14.call(this),r.prototype.__init15.call(this),r.prototype.__init16.call(this),r.prototype.__init17.call(this),r.prototype.__init18.call(this),r.prototype.__init19.call(this),r.prototype.__init20.call(this),r.prototype.__init21.call(this),r.prototype.__init22.call(this),this._object=t,this._group=e}getId(){return this._id}getGroup(){return this._group}getTimescale(){return this._timescale}isPlaying(){return this._isPlaying}isPaused(){return this._isPaused}from(t){try{JSON.stringify(t)}catch{throw new Error("The object you provided to the from() method has a circular reference!")}return this._setupProperties(t,this._valuesStart,t,this._valuesStartRepeat,!0),this}to(t,e){try{this._valuesEnd=JSON.parse(JSON.stringify(t))}catch{return console.warn("The object you provided to the to() method has a circular reference!. It can't be cloned. Falling back to dynamic targeting"),this.dynamicTo(t,e)}return e!==void 0&&(this._duration=e),this}dynamicTo(t,e){return this._valuesEnd=t,e!==void 0&&(this._duration=e),this}duration(t){return this._duration=t,this}start(t){return this._isPlaying?this:(t!=null&&(this._delayTime=t),this._group.add(this),this._reversed&&(this._swapEndStartRepeatValues(this._valuesStartRepeat,this._valuesEnd),this._valuesStart=JSON.parse(JSON.stringify(this._valuesStartRepeat))),this._repeatCount=0,this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onAfterDelayCallbackFired=!1,this._isChainStopped=!1,this._startTime=-this._delayTime,this._elapsedTime=0,this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,!1),this)}restart(t){return this.reset(),this.start(t)}reset(){return this._isPlaying&&this.stop(),this._valuesStart={},this._valuesStartRepeat={},this}rewind(){this._isPlaying&&this.stop(),this._reversed&&this._swapEndStartRepeatValues(this._valuesStartRepeat,this._valuesEnd);let t=this._easingFunction(0);return this._updateProperties(this._object,this._valuesStart,this._valuesEnd,t),this}_setupProperties(t,e,i,s,o){for(let n in i){let a=t[n],h=Array.isArray(a),l=!Number.isNaN(Number(a)),u=h?"array":typeof a,c=u=="object",d=typeof i[n]=="object",p=!h&&Array.isArray(i[n]);u=="undefined"||u=="function"||i[n]==null||!h&&!l&&!c||((c||h||d)&&a&&!p?(typeof e[n]>"u"&&(e[n]=h?[]:{}),typeof s[n]>"u"&&(s[n]=h?[]:{}),this._setupProperties(a,e[n],i[n],s[n],o)):((typeof e[n]>"u"||o)&&(e[n]=a),(typeof s[n]>"u"||o)&&(p?s[n]=i[n].slice().reverse()[0]:s[n]=e[n]||0)))}}stop(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object,this),this):this}end(t=!1){let e=[];if(t||(e=this._chainedTweens,this._chainedTweens=[]),this.resume(),this.update(1/0),!t){this._chainedTweens=e;for(let i=0,s=this._chainedTweens.length;i<s;i++)this._chainedTweens[i].start()}return this}skip(t,e=!1){return this.resume(),this.update(t*this._duration-(e?this._elapsedTime:0)),this}pause(){return this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._group.remove(this),this)}resume(){return!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._group.add(this),this)}stopChainedTweens(){for(let t=0,e=this._chainedTweens.length;t<e;t++)this._chainedTweens[t].stop();return this}startChainedTweens(t=!1){t&&this.stop();for(let e=0,i=this._chainedTweens.length;e<i;e++)this._chainedTweens[e].start();return this}group(t){return this._group=t,this}delay(t){return this._delayTime=t,this}timescale(t){return this._timescale=t,this}repeat(t=1/0){return this._repeat=t,this}repeatDelay(t){return this._repeatDelayTime=t,this}yoyo(t=!0){return this._yoyo=t,this}easing(t){return this._easingFunction=t,this}safetyCheck(t){return this._safetyCheckFunction=t,this}yoyoEasing(t){return this._yoyoEasingFunction=t,this}interpolation(t){return this._interpolationFunction=t,this}chain(...t){return this._chainedTweens=t,this}onStart(t){return this._onStartCallback=t,this}onAfterDelay(t){return this._onAfterDelayCallback=t,this}onUpdate(t){return this._onUpdateCallback=t,this}onRepeat(t){return this._onRepeatCallback=t,this}onComplete(t){return this._onCompleteCallback=t,this}onStop(t){return this._onStopCallback=t,this}update(t,e=!1){let i=this._internalUpdate(t);return!i&&!e&&this._group.remove(this),i}_internalUpdate(t){if(!this._safetyCheckFunction(this._object)||this._isPaused)return!1;t*=this._timescale;let e;this._elapsedTime+=t;let i=this._duration,s=this._startTime+this._elapsedTime;if(s>i&&!this._isPlaying)return!1;this.isPlaying||this.start(),this._onStartCallbackFired==!1&&(this._onStartCallback&&this._onStartCallback(this._object,this),this._onStartCallbackFired=!0),this._onAfterDelayCallbackFired==!1&&s>=0&&(this._onAfterDelayCallback&&this._onAfterDelayCallback(this._object,this),this._onAfterDelayCallbackFired=!0),e=s/this._duration,this._duration==0&&(s>=0?e=1:e=0),e=Math.min(1,e),e=Math.max(0,e);let o=Number.isFinite(s)?s%this._duration:s;Number.isNaN(o)&&(o=0);let n=Math.floor(s/this._duration),a;if(this._reversed&&this._yoyoEasingFunction?a=this._yoyoEasingFunction(e):a=this._easingFunction(e),this._updateProperties(this._object,this._valuesStart,this._valuesEnd,a),this._onUpdateCallback&&(e!=1||this._repeat-this._repeatCount<=0)&&this._onUpdateCallback(this._object,e,this),e==1){if(this._repeat-this._repeatCount>0){let h=this._repeatCount;if(this._repeatCount=Math.min(this._repeat+1,this._repeatCount+n),this._onUpdateCallback&&(this._repeat-this._repeatCount<0||o<=0)&&this._onUpdateCallback(this._object,e,this),this._yoyo?this._swapEndStartRepeatValues(this._valuesStartRepeat,this._valuesEnd):this._moveForwardStartRepeatValues(this._valuesStartRepeat,this._valuesEnd),this._valuesStart=JSON.parse(JSON.stringify(this._valuesStartRepeat)),this._repeatDelayTime!==void 0?this._startTime=-this._repeatDelayTime:this._startTime=0,this._onRepeatCallback){let l=1;Number.isFinite(n)?l=this._repeatCount-h:Number.isFinite(this._repeat)&&(l=this._repeat-h);for(let u=0;u<l;u++)this._onRepeatCallback(this._object,h+1+u,this)}if(this._elapsedTime=0,this._repeat-this._repeatCount>=0)return o>0&&Number.isFinite(this._repeat)&&this._internalUpdate(o),!0}this._onCompleteCallback&&this._onCompleteCallback(this._object,this);for(let h=0,l=this._chainedTweens.length;h<l;h++)this._chainedTweens[h].start(),o>0&&this._chainedTweens[h].update(o);return this._isPlaying=!1,!1}return!0}_updateProperties(t,e,i,s){for(let o in i){if(e[o]==null)continue;let n=e[o],a=i[o],h=Array.isArray(t[o]),l=Array.isArray(a);!h&&l?this._reversed?t[o]=this._interpolationFunction(a.concat([n]),s):t[o]=this._interpolationFunction([n].concat(a),s):typeof a=="object"&&a?this._updateProperties(t[o],n,a,s):(a=this._handleRelativeValue(n,a),typeof a=="number"&&(typeof n=="number"||typeof n=="string")&&(t[o]=Number(n)+(a-Number(n))*s,typeof n=="string"&&(t[o]=String(t[o]))))}}_handleRelativeValue(t,e){return typeof e!="string"?e:e.charAt(0)=="+"||e.charAt(0)=="-"?t+Number(e):Number(e)}_swapEndStartRepeatValues(t,e){for(let i in t){let s=!Array.isArray(t[i])&&Array.isArray(e[i]);if(typeof t[i]=="object")this._swapEndStartRepeatValues(t[i],e[i]);else{let o=t[i];if(typeof e[i]=="string")t[i]=Number(t[i])+Number(e[i]),e[i]=o;else if(s){let n=e[i].slice().reverse();t[i]=n[0],e[i]=n}else t[i]=e[i],e[i]=o}}}_moveForwardStartRepeatValues(t,e){for(let i in t)typeof e[i]=="object"?this._moveForwardStartRepeatValues(t[i],e[i]):typeof e[i]=="string"&&(t[i]=Number(t[i])+Number(e[i]))}};var dx={firePeriodMS:300,projectileSpeed:1},fe=class{lastFiredMS;config;onFire=new Fe;projectiles;body;flashes;flashTween;canFire=!1;constructor(t,e){this.config=Object.assign({},dx,t||{}),this.body=new B,this.projectiles=e,this.flashes=new O,this.lastFiredMS=this.config.firePeriodMS,this.flashTween=new Nt(this.flashes),this.flashes.alpha=0}update(t){this.canFire&&(this.lastFiredMS+=t,this.lastFiredMS>this.config.firePeriodMS&&(this.lastFiredMS-=this.config.firePeriodMS,this.fire())),this.projectiles.activeInstances.forEach(e=>{this.updateProjectile(e,t)})}fire(){this.flashes.alpha=1,this.flashTween.to({alpha:0},200).easing(Ot.Sinusoidal.Out).start()}updateProjectile(t,e){t.y+=this.config.projectileSpeed*Math.sin(t.rotation-Math.PI/2)*e,t.x+=this.config.projectileSpeed*Math.cos(t.rotation-Math.PI/2)*e,(t.y>V.height||t.y<t.height)&&this.projectiles.release(t)}static resetProjectile(t){t.rotation=0}static destroyProjectile(t){t.destroy()}};var kr=[{gun:"Weapon-1-Yellow",flash:"Fire-Exit-1-Yellow",projectile:"Fire-1-Yellow",projectileCount:1},{gun:"Weapon-1-Green",flash:"Fire-Exit-1-Green",projectile:"Fire-1-Green",projectileCount:1},{gun:"Weapon-1-Blue",flash:"Fire-Exit-1-Blue",projectile:"Fire-1-Blue",projectileCount:1},{gun:"Weapon-2-Yellow",flash:"Fire-Exit-1-Yellow",projectile:"Fire-1-Yellow",projectileCount:2},{gun:"Weapon-2-Green",flash:"Fire-Exit-1-Green",projectile:"Fire-1-Green",projectileCount:2},{gun:"Weapon-2-Blue",flash:"Fire-Exit-1-Blue",projectile:"Fire-1-Blue",projectileCount:2},{gun:"Weapon-2-Pink",flash:"Fire-Exit-1-Pink",projectile:"Fire-1-Pink",projectileCount:2},{gun:"Weapon-3-Standart",flash:"Fire-Exit-3-Yellow",projectile:"Fire-1-Yellow",projectileCount:3},{gun:"Weapon-3-Standart",flash:"Fire-Exit-3-Green",projectile:"Fire-1-Green",projectileCount:3},{gun:"Weapon-3-Standart",flash:"Fire-Exit-3-Blue",projectile:"Fire-1-Blue",projectileCount:3},{gun:"Weapon-3-Standart",flash:"Fire-Exit-3-Pink",projectile:"Fire-1-Pink",projectileCount:3}],fs=class r extends fe{level;constructor(t,e=1){super(t||{},new Lt(()=>r.createProjectile(e),fe.resetProjectile,fe.destroyProjectile)),this.level=e,this.body.texture=b.from(kr[this.level].gun),this.body.anchor.set(.5,.85),this.body.scale.set(.5),this.upgrade(this.level)}fire(){if(super.fire(),this.level<3){let t=this.projectiles.getInstance();t.position.set(0,-65),this.onFire.dispatch([t])}else if(this.level<7){let t=this.projectiles.getInstance(),e=this.projectiles.getInstance();t.position.set(-14,-65),e.position.set(14,-65),this.onFire.dispatch([t,e])}else{let t=this.projectiles.getInstance(),e=this.projectiles.getInstance(),i=this.projectiles.getInstance();t.position.set(-14,-60),e.position.set(0,-65),i.position.set(14,-60),this.onFire.dispatch([t,e,i])}}setupMuzzleFlash(t){this.flashes.removeChildren(),t<3?this.addMuzzleFlash(t,{x:0,y:-120}):t<7?(this.addMuzzleFlash(t,{x:-16,y:-120}),this.addMuzzleFlash(t,{x:16,y:-120})):this.addMuzzleFlash(t,{x:0,y:-120}),this.flashes.children.forEach(e=>e.texture=b.from(kr[t].flash))}addMuzzleFlash(t,e){let i=new B(b.from(kr[t].flash));i.anchor.set(.5),i.position.copyFrom(e),this.flashes.addChild(i)}upgrade(t){this.body.texture=b.from(kr[t].gun),this.setupMuzzleFlash(t)}getProjectileDamage(){return(this.level*2+20)/kr[this.level].projectileCount}static createProjectile(t){let e=new B(b.from(kr[t].projectile));return e.anchor.set(.5),e}};var bf=new et;at.prototype._cacheAsBitmap=!1;at.prototype._cacheData=null;at.prototype._cacheAsBitmapResolution=null;at.prototype._cacheAsBitmapMultisample=null;var pu=class{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}};Object.defineProperties(at.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(r){r!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=r,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(r){r!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=r,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(r){if(this._cacheAsBitmap===r)return;this._cacheAsBitmap=r;let t;r?(this._cacheData||(this._cacheData=new pu),t=this._cacheData,t.originalRender=this.render,t.originalRenderCanvas=this.renderCanvas,t.originalUpdateTransform=this.updateTransform,t.originalCalculateBounds=this.calculateBounds,t.originalGetLocalBounds=this.getLocalBounds,t.originalDestroy=this.destroy,t.originalContainsPoint=this.containsPoint,t.originalMask=this._mask,t.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(t=this._cacheData,t.sprite&&this._destroyCachedDisplayObject(),this.render=t.originalRender,this.renderCanvas=t.originalRenderCanvas,this.calculateBounds=t.originalCalculateBounds,this.getLocalBounds=t.originalGetLocalBounds,this.destroy=t.originalDestroy,this.updateTransform=t.originalUpdateTransform,this.containsPoint=t.originalContainsPoint,this._mask=t.originalMask,this.filterArea=t.originalFilterArea)}}});at.prototype._renderCached=function(r){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(r),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(r))};at.prototype._initCachedDisplayObject=function(r){if(this._cacheData?.sprite)return;let t=this.alpha;this.alpha=1,r.batch.flush();let e=this.getLocalBounds(new z,!0);if(this.filters?.length){let d=this.filters[0].padding;e.pad(d)}let i=this.cacheAsBitmapResolution||r.resolution;e.ceil(i),e.width=Math.max(e.width,1/i),e.height=Math.max(e.height,1/i);let s=r.renderTexture.current,o=r.renderTexture.sourceFrame.clone(),n=r.renderTexture.destinationFrame.clone(),a=r.projection.transform,h=Pe.create({width:e.width,height:e.height,resolution:i,multisample:this.cacheAsBitmapMultisample??r.multisample}),l=`cacheAsBitmap_${S.uid()}`;this._cacheData.textureCacheId=l,W.addToCache(h.baseTexture,l),b.addToCache(h,l);let u=this.transform.localTransform.copyTo(bf).invert().translate(-e.x,-e.y);this.render=this._cacheData.originalRender,r.render(this,{renderTexture:h,clear:!0,transform:u,skipUpdateTransform:!1}),r.framebuffer.blit(),r.projection.transform=a,r.renderTexture.bind(s,o,n),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=t;let c=new B(h);c.transform.worldTransform=this.transform.worldTransform,c.anchor.x=-(e.x/e.width),c.anchor.y=-(e.y/e.height),c.alpha=t,c._bounds=this._bounds,this._cacheData.sprite=c,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=c.containsPoint.bind(c)};at.prototype._renderCachedCanvas=function(r){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(r),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(r))};at.prototype._initCachedDisplayObjectCanvas=function(r){if(this._cacheData?.sprite)return;let t=this.getLocalBounds(new z,!0),e=this.alpha;this.alpha=1;let i=r.canvasContext.activeContext,s=r._projTransform,o=this.cacheAsBitmapResolution||r.resolution;t.ceil(o),t.width=Math.max(t.width,1/o),t.height=Math.max(t.height,1/o);let n=Pe.create({width:t.width,height:t.height,resolution:o}),a=`cacheAsBitmap_${S.uid()}`;this._cacheData.textureCacheId=a,W.addToCache(n.baseTexture,a),b.addToCache(n,a);let h=bf;this.transform.localTransform.copyTo(h),h.invert(),h.tx-=t.x,h.ty-=t.y,this.renderCanvas=this._cacheData.originalRenderCanvas,r.render(this,{renderTexture:n,clear:!0,transform:h,skipUpdateTransform:!1}),r.canvasContext.activeContext=i,r._projTransform=s,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=e;let l=new B(n);l.transform.worldTransform=this.transform.worldTransform,l.anchor.x=-(t.x/t.width),l.anchor.y=-(t.y/t.height),l.alpha=e,l._bounds=this._bounds,this._cacheData.sprite=l,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=r._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=l.containsPoint.bind(l)};at.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};at.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};at.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,W.removeFromCache(this._cacheData.textureCacheId),b.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};at.prototype._cacheAsBitmapDestroy=function(r){this.cacheAsBitmap=!1,this.destroy(r)};at.prototype.name=null;O.prototype.getChildByName=function(r,t){for(let e=0,i=this.children.length;e<i;e++)if(this.children[e].name===r)return this.children[e];if(t)for(let e=0,i=this.children.length;e<i;e++){let s=this.children[e];if(!s.getChildByName)continue;let o=s.getChildByName(r,!0);if(o)return o}return null};at.prototype.getGlobalPosition=function(r=new K,t=!1){return this.parent?this.parent.toGlobal(this.position,r,t):(r.x=this.position.x,r.y=this.position.y),r};var Tf=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uAlpha;

void main(void)
{
   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;
}
`;var Do=class extends pt{constructor(t=1){super(Nl,Tf,{uAlpha:1}),this.alpha=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}};var px={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},fx=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join(`
`);function Ef(r){let t=px[r],e=t.length,i=fx,s="",o="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;",n;for(let a=0;a<r;a++){let h=o.replace("%index%",a.toString());n=a,a>=e&&(n=r-a-1),h=h.replace("%value%",t[n].toString()),s+=h,s+=`
`}return i=i.replace("%blur%",s),i=i.replace("%size%",r.toString()),i}var mx=`
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function wf(r,t){let e=Math.ceil(r/2),i=mx,s="",o;t?o="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":o="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let n=0;n<r;n++){let a=o.replace("%index%",n.toString());a=a.replace("%sampleIndex%",`${n-(e-1)}.0`),s+=a,s+=`
`}return i=i.replace("%blur%",s),i=i.replace("%size%",r.toString()),i}var Ur=class extends pt{constructor(t,e=8,i=4,s=pt.defaultResolution,o=5){let n=wf(o,t),a=Ef(o);super(n,a),this.horizontal=t,this.resolution=s,this._quality=0,this.quality=i,this.blur=e}apply(t,e,i,s){if(i?this.horizontal?this.uniforms.strength=1/i.width*(i.width/e.width):this.uniforms.strength=1/i.height*(i.height/e.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/e.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/e.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)t.applyFilter(this,e,i,s);else{let o=t.getFilterTexture(),n=t.renderer,a=e,h=o;this.state.blend=!1,t.applyFilter(this,a,h,_e.CLEAR);for(let l=1;l<this.passes-1;l++){t.bindAndClear(a,_e.BLIT),this.uniforms.uSampler=h;let u=h;h=a,a=u,n.shader.bind(this),n.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,h,i,s),t.returnFilterTexture(o)}}get blur(){return this.strength}set blur(t){this.padding=1+Math.abs(t)*2,this.strength=t}get quality(){return this._quality}set quality(t){this._quality=t,this.passes=t}};var Lo=class extends pt{constructor(t=8,e=4,i=pt.defaultResolution,s=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new Ur(!0,t,e,i,s),this.blurYFilter=new Ur(!1,t,e,i,s),this.resolution=i,this.quality=e,this.blur=t,this.repeatEdgePixels=!1}apply(t,e,i,s){let o=Math.abs(this.blurXFilter.strength),n=Math.abs(this.blurYFilter.strength);if(o&&n){let a=t.getFilterTexture();this.blurXFilter.apply(t,e,a,_e.CLEAR),this.blurYFilter.apply(t,a,i,s),t.returnFilterTexture(a)}else n?this.blurYFilter.apply(t,e,i,s):this.blurXFilter.apply(t,e,i,s)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2}get blur(){return this.blurXFilter.blur}set blur(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(t){this.blurXFilter.quality=this.blurYFilter.quality=t}get blurX(){return this.blurXFilter.blur}set blurX(t){this.blurXFilter.blur=t,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(t){this.blurYFilter.blur=t,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(t){this.blurYFilter.blendMode=t}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(t){this._repeatEdgePixels=t,this.updatePadding()}};var Sf=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;var mi=class extends pt{constructor(){let t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(yo,Sf,t),this.alpha=1}_loadMatrix(t,e=!1){let i=t;e&&(this._multiply(i,this.uniforms.m,t),i=this._colorMatrix(i)),this.uniforms.m=i}_multiply(t,e,i){return t[0]=e[0]*i[0]+e[1]*i[5]+e[2]*i[10]+e[3]*i[15],t[1]=e[0]*i[1]+e[1]*i[6]+e[2]*i[11]+e[3]*i[16],t[2]=e[0]*i[2]+e[1]*i[7]+e[2]*i[12]+e[3]*i[17],t[3]=e[0]*i[3]+e[1]*i[8]+e[2]*i[13]+e[3]*i[18],t[4]=e[0]*i[4]+e[1]*i[9]+e[2]*i[14]+e[3]*i[19]+e[4],t[5]=e[5]*i[0]+e[6]*i[5]+e[7]*i[10]+e[8]*i[15],t[6]=e[5]*i[1]+e[6]*i[6]+e[7]*i[11]+e[8]*i[16],t[7]=e[5]*i[2]+e[6]*i[7]+e[7]*i[12]+e[8]*i[17],t[8]=e[5]*i[3]+e[6]*i[8]+e[7]*i[13]+e[8]*i[18],t[9]=e[5]*i[4]+e[6]*i[9]+e[7]*i[14]+e[8]*i[19]+e[9],t[10]=e[10]*i[0]+e[11]*i[5]+e[12]*i[10]+e[13]*i[15],t[11]=e[10]*i[1]+e[11]*i[6]+e[12]*i[11]+e[13]*i[16],t[12]=e[10]*i[2]+e[11]*i[7]+e[12]*i[12]+e[13]*i[17],t[13]=e[10]*i[3]+e[11]*i[8]+e[12]*i[13]+e[13]*i[18],t[14]=e[10]*i[4]+e[11]*i[9]+e[12]*i[14]+e[13]*i[19]+e[14],t[15]=e[15]*i[0]+e[16]*i[5]+e[17]*i[10]+e[18]*i[15],t[16]=e[15]*i[1]+e[16]*i[6]+e[17]*i[11]+e[18]*i[16],t[17]=e[15]*i[2]+e[16]*i[7]+e[17]*i[12]+e[18]*i[17],t[18]=e[15]*i[3]+e[16]*i[8]+e[17]*i[13]+e[18]*i[18],t[19]=e[15]*i[4]+e[16]*i[9]+e[17]*i[14]+e[18]*i[19]+e[19],t}_colorMatrix(t){let e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e}brightness(t,e){let i=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(i,e)}tint(t,e){let[i,s,o]=Q.shared.setValue(t).toArray(),n=[i,0,0,0,0,0,s,0,0,0,0,0,o,0,0,0,0,0,1,0];this._loadMatrix(n,e)}greyscale(t,e){let i=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(i,e)}blackAndWhite(t){let e=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(e,t)}hue(t,e){t=(t||0)/180*Math.PI;let i=Math.cos(t),s=Math.sin(t),o=Math.sqrt,n=1/3,a=o(n),h=i+(1-i)*n,l=n*(1-i)-a*s,u=n*(1-i)+a*s,c=n*(1-i)+a*s,d=i+n*(1-i),p=n*(1-i)-a*s,f=n*(1-i)-a*s,m=n*(1-i)+a*s,g=i+n*(1-i),y=[h,l,u,0,0,c,d,p,0,0,f,m,g,0,0,0,0,0,1,0];this._loadMatrix(y,e)}contrast(t,e){let i=(t||0)+1,s=-.5*(i-1),o=[i,0,0,0,s,0,i,0,0,s,0,0,i,0,s,0,0,0,1,0];this._loadMatrix(o,e)}saturate(t=0,e){let i=t*2/3+1,s=(i-1)*-.5,o=[i,s,s,0,0,s,i,s,0,0,s,s,i,0,0,0,0,0,1,0];this._loadMatrix(o,e)}desaturate(){this.saturate(-1)}negative(t){let e=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(e,t)}sepia(t){let e=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(e,t)}technicolor(t){let e=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(e,t)}polaroid(t){let e=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(e,t)}toBGR(t){let e=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(e,t)}kodachrome(t){let e=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(e,t)}browni(t){let e=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(e,t)}vintage(t){let e=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(e,t)}colorTone(t,e,i,s,o){t=t||.2,e=e||.15,i=i||16770432,s=s||3375104;let n=Q.shared,[a,h,l]=n.setValue(i).toArray(),[u,c,d]=n.setValue(s).toArray(),p=[.3,.59,.11,0,0,a,h,l,t,0,u,c,d,e,0,a-u,h-c,l-d,0,0];this._loadMatrix(p,o)}night(t,e){t=t||.1;let i=[t*-2,-t,0,0,0,-t,0,t,0,0,0,t,t*2,0,0,0,0,0,1,0];this._loadMatrix(i,e)}predator(t,e){let i=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(i,e)}lsd(t){let e=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(e,t)}reset(){let t=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(t,!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}};mi.prototype.grayscale=mi.prototype.greyscale;var Af=`varying vec2 vFilterCoord;
varying vec2 vTextureCoord;

uniform vec2 scale;
uniform mat2 rotation;
uniform sampler2D uSampler;
uniform sampler2D mapSampler;

uniform highp vec4 inputSize;
uniform vec4 inputClamp;

void main(void)
{
  vec4 map =  texture2D(mapSampler, vFilterCoord);

  map -= 0.5;
  map.xy = scale * inputSize.zw * (rotation * map.xy);

  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));
}
`;var Cf=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;
uniform mat3 filterMatrix;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
	gl_Position = filterVertexPosition();
	vTextureCoord = filterTextureCoord();
	vFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;
}
`;var Oo=class extends pt{constructor(t,e){let i=new et;t.renderable=!1,super(Cf,Af,{mapSampler:t._texture,filterMatrix:i,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=t,this.maskMatrix=i,e==null&&(e=20),this.scale=new K(e,e)}apply(t,e,i,s){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;let o=this.maskSprite.worldTransform,n=Math.sqrt(o.a*o.a+o.b*o.b),a=Math.sqrt(o.c*o.c+o.d*o.d);n!==0&&a!==0&&(this.uniforms.rotation[0]=o.a/n,this.uniforms.rotation[1]=o.b/n,this.uniforms.rotation[2]=o.c/a,this.uniforms.rotation[3]=o.d/a),t.applyFilter(this,e,i,s)}get map(){return this.uniforms.mapSampler}set map(t){this.uniforms.mapSampler=t}};var Pf=`varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;
uniform sampler2D uSampler;
uniform highp vec4 inputSize;


/**
 Basic FXAA implementation based on the code on geeks3d.com with the
 modification that the texture2DLod stuff was removed since it's
 unsupported by WebGL.

 --

 From:
 https://github.com/mitsuhiko/webgl-meincraft

 Copyright (c) 2011 by Armin Ronacher.

 Some rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are
 met:

 * Redistributions of source code must retain the above copyright
 notice, this list of conditions and the following disclaimer.

 * Redistributions in binary form must reproduce the above
 copyright notice, this list of conditions and the following
 disclaimer in the documentation and/or other materials provided
 with the distribution.

 * The names of the contributors may not be used to endorse or
 promote products derived from this software without specific
 prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef FXAA_REDUCE_MIN
#define FXAA_REDUCE_MIN   (1.0/ 128.0)
#endif
#ifndef FXAA_REDUCE_MUL
#define FXAA_REDUCE_MUL   (1.0 / 8.0)
#endif
#ifndef FXAA_SPAN_MAX
#define FXAA_SPAN_MAX     8.0
#endif

//optimized version for mobile, where dependent
//texture reads can be a bottleneck
vec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,
          vec2 v_rgbNW, vec2 v_rgbNE,
          vec2 v_rgbSW, vec2 v_rgbSE,
          vec2 v_rgbM) {
    vec4 color;
    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;
    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;
    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;
    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;
    vec4 texColor = texture2D(tex, v_rgbM);
    vec3 rgbM  = texColor.xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    mediump vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
                  dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +
                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, texColor.a);
    else
        color = vec4(rgbB, texColor.a);
    return color;
}

void main() {

      vec4 color;

      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);

      gl_FragColor = color;
}
`;var If=`
attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

void texcoords(vec2 fragCoord, vec2 inverseVP,
               out vec2 v_rgbNW, out vec2 v_rgbNE,
               out vec2 v_rgbSW, out vec2 v_rgbSE,
               out vec2 v_rgbM) {
    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;
    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;
    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;
    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;
    v_rgbM = vec2(fragCoord * inverseVP);
}

void main(void) {

   gl_Position = filterVertexPosition();

   vFragCoord = aVertexPosition * outputFrame.zw;

   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);
}
`;var No=class extends pt{constructor(){super(If,Pf)}};var Rf=`precision highp float;

varying vec2 vTextureCoord;
varying vec4 vColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * uSeed);
    float diff = (randomValue - 0.5) * uNoise;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    gl_FragColor = color;
}
`;var ko=class extends pt{constructor(t=.5,e=Math.random()){super(yo,Rf,{uNoise:0,uSeed:0}),this.noise=t,this.seed=e}get noise(){return this.uniforms.uNoise}set noise(t){this.uniforms.uNoise=t}get seed(){return this.uniforms.uSeed}set seed(t){this.uniforms.uSeed=t}};var fu={AlphaFilter:Do,BlurFilter:Lo,BlurFilterPass:Ur,ColorMatrixFilter:mi,DisplacementFilter:Oo,FXAAFilter:No,NoiseFilter:ko};Object.entries(fu).forEach(([r,t])=>{Object.defineProperty(fu,r,{get(){return S.deprecation("7.1.0",`filters.${r} has moved to ${r}`),t}})});var mu=class{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(t){this.removeTickerListener(),this.events=t,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(t){this._pauseUpdate=t}addTickerListener(){this.tickerAdded||!this.domElement||(st.system.add(this.tickerUpdate,this,de.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(st.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove){this._didMove=!1;return}let t=this.events.rootPointerEvent;this.events.supportsTouchEvents&&t.pointerType==="touch"||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:t.clientX,clientY:t.clientY}))}tickerUpdate(t){this._deltaTime+=t,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())}},rr=new mu;var xr=class r{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=r.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new K,this.page=new K,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,e,i){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,e,i,s,o){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}};var ir=class extends xr{constructor(){super(...arguments),this.client=new K,this.movement=new K,this.offset=new K,this.global=new K,this.screen=new K}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(t,e,i){return t.worldTransform.applyInverse(i||this.global,e)}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,i,s,o,n,a,h,l,u,c,d,p,f,m){throw new Error("Method not implemented.")}};var Kt=class extends ir{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}};var ze=class extends ir{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}};ze.DOM_DELTA_PIXEL=0,ze.DOM_DELTA_LINE=1,ze.DOM_DELTA_PAGE=2;var gx=2048,yx=new K,gu=new K,Uo=class{constructor(t){this.dispatch=new S.EventEmitter,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort((i,s)=>i.priority-s.priority)}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){if(!this.rootTarget)return;let e=this.mappingTable[t.type];if(e)for(let i=0,s=e.length;i<s;i++)e[i].fn(t);else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,e){rr.pauseUpdate=!0;let i=this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive",s=this[i](this.rootTarget,this.rootTarget.eventMode,yx.set(t,e),this.hitTestFn,this.hitPruneFn);return s&&s[0]}propagate(t,e){if(!t.target)return;let i=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let s=0,o=i.length-1;s<o;s++)if(t.currentTarget=i[s],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!(t.propagationStopped||t.propagationImmediatelyStopped)){t.eventPhase=t.BUBBLING_PHASE;for(let s=i.length-2;s>=0;s--)if(t.currentTarget=i[s],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,e,i=this._allInteractiveElements){if(i.length===0)return;t.eventPhase=t.BUBBLING_PHASE;let s=Array.isArray(e)?e:[e];for(let o=i.length-1;o>=0;o--)s.forEach(n=>{t.currentTarget=i[o],this.notifyTarget(t,n)})}propagationPath(t){let e=[t];for(let i=0;i<gx&&t!==this.rootTarget;i++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}hitTestMoveRecursive(t,e,i,s,o,n=!1){let a=!1;if(this._interactivePrune(t))return null;if((t.eventMode==="dynamic"||e==="dynamic")&&(rr.pauseUpdate=!1),t.interactiveChildren&&t.children){let u=t.children;for(let c=u.length-1;c>=0;c--){let d=u[c],p=this.hitTestMoveRecursive(d,this._isInteractive(e)?e:d.eventMode,i,s,o,n||o(t,i));if(p){if(p.length>0&&!p[p.length-1].parent)continue;let f=t.isInteractive();(p.length>0||f)&&(f&&this._allInteractiveElements.push(t),p.push(t)),this._hitElements.length===0&&(this._hitElements=p),a=!0}}}let h=this._isInteractive(e),l=t.isInteractive();return h&&l&&this._allInteractiveElements.push(t),n||this._hitElements.length>0?null:a?this._hitElements:h&&!o(t,i)&&s(t,i)?l?[t]:[]:null}hitTestRecursive(t,e,i,s,o){if(this._interactivePrune(t)||o(t,i))return null;if((t.eventMode==="dynamic"||e==="dynamic")&&(rr.pauseUpdate=!1),t.interactiveChildren&&t.children){let h=t.children;for(let l=h.length-1;l>=0;l--){let u=h[l],c=this.hitTestRecursive(u,this._isInteractive(e)?e:u.eventMode,i,s,o);if(c){if(c.length>0&&!c[c.length-1].parent)continue;let d=t.isInteractive();return(c.length>0||d)&&c.push(t),c}}}let n=this._isInteractive(e),a=t.isInteractive();return n&&s(t,i)?a?[t]:[]:null}_isInteractive(t){return t==="static"||t==="dynamic"}_interactivePrune(t){return!!(!t||t.isMask||!t.visible||!t.renderable||t.eventMode==="none"||t.eventMode==="passive"&&!t.interactiveChildren||t.isMask)}hitPruneFn(t,e){if(t.hitArea&&(t.worldTransform.applyInverse(e,gu),!t.hitArea.contains(gu.x,gu.y)))return!0;if(t._mask){let i=t._mask.isMaskData?t._mask.maskObject:t._mask;if(i&&!i.containsPoint?.(e))return!0}return!1}hitTestFn(t,e){return t.eventMode==="passive"?!1:t.hitArea?!0:t.containsPoint?t.containsPoint(e):!1}notifyTarget(t,e){e=e??t.type;let i=`on${e}`;t.currentTarget[i]?.(t);let s=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this.notifyListeners(t,s),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}mapPointerDown(t){if(!(t instanceof Kt)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}let e=this.createPointerEvent(t);if(this.dispatchEvent(e,"pointerdown"),e.pointerType==="touch")this.dispatchEvent(e,"touchstart");else if(e.pointerType==="mouse"||e.pointerType==="pen"){let s=e.button===2;this.dispatchEvent(e,s?"rightdown":"mousedown")}let i=this.trackingData(t.pointerId);i.pressTargetsByButton[t.button]=e.composedPath(),this.freeEvent(e)}mapPointerMove(t){if(!(t instanceof Kt)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;let e=this.createPointerEvent(t);this._isPointerMoveEvent=!1;let i=e.pointerType==="mouse"||e.pointerType==="pen",s=this.trackingData(t.pointerId),o=this.findMountedTarget(s.overTargets);if(s.overTargets?.length>0&&o!==e.target){let h=t.type==="mousemove"?"mouseout":"pointerout",l=this.createPointerEvent(t,h,o);if(this.dispatchEvent(l,"pointerout"),i&&this.dispatchEvent(l,"mouseout"),!e.composedPath().includes(o)){let u=this.createPointerEvent(t,"pointerleave",o);for(u.eventPhase=u.AT_TARGET;u.target&&!e.composedPath().includes(u.target);)u.currentTarget=u.target,this.notifyTarget(u),i&&this.notifyTarget(u,"mouseleave"),u.target=u.target.parent;this.freeEvent(u)}this.freeEvent(l)}if(o!==e.target){let h=t.type==="mousemove"?"mouseover":"pointerover",l=this.clonePointerEvent(e,h);this.dispatchEvent(l,"pointerover"),i&&this.dispatchEvent(l,"mouseover");let u=o?.parent;for(;u&&u!==this.rootTarget.parent&&u!==e.target;)u=u.parent;if(!u||u===this.rootTarget.parent){let c=this.clonePointerEvent(e,"pointerenter");for(c.eventPhase=c.AT_TARGET;c.target&&c.target!==o&&c.target!==this.rootTarget.parent;)c.currentTarget=c.target,this.notifyTarget(c),i&&this.notifyTarget(c,"mouseenter"),c.target=c.target.parent;this.freeEvent(c)}this.freeEvent(l)}let n=[],a=this.enableGlobalMoveEvents??!0;this.moveOnAll?n.push("pointermove"):this.dispatchEvent(e,"pointermove"),a&&n.push("globalpointermove"),e.pointerType==="touch"&&(this.moveOnAll?n.splice(1,0,"touchmove"):this.dispatchEvent(e,"touchmove"),a&&n.push("globaltouchmove")),i&&(this.moveOnAll?n.splice(1,0,"mousemove"):this.dispatchEvent(e,"mousemove"),a&&n.push("globalmousemove"),this.cursor=e.target?.cursor),n.length>0&&this.all(e,n),this._allInteractiveElements.length=0,this._hitElements.length=0,s.overTargets=e.composedPath(),this.freeEvent(e)}mapPointerOver(t){if(!(t instanceof Kt)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}let e=this.trackingData(t.pointerId),i=this.createPointerEvent(t),s=i.pointerType==="mouse"||i.pointerType==="pen";this.dispatchEvent(i,"pointerover"),s&&this.dispatchEvent(i,"mouseover"),i.pointerType==="mouse"&&(this.cursor=i.target?.cursor);let o=this.clonePointerEvent(i,"pointerenter");for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==this.rootTarget.parent;)o.currentTarget=o.target,this.notifyTarget(o),s&&this.notifyTarget(o,"mouseenter"),o.target=o.target.parent;e.overTargets=i.composedPath(),this.freeEvent(i),this.freeEvent(o)}mapPointerOut(t){if(!(t instanceof Kt)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}let e=this.trackingData(t.pointerId);if(e.overTargets){let i=t.pointerType==="mouse"||t.pointerType==="pen",s=this.findMountedTarget(e.overTargets),o=this.createPointerEvent(t,"pointerout",s);this.dispatchEvent(o),i&&this.dispatchEvent(o,"mouseout");let n=this.createPointerEvent(t,"pointerleave",s);for(n.eventPhase=n.AT_TARGET;n.target&&n.target!==this.rootTarget.parent;)n.currentTarget=n.target,this.notifyTarget(n),i&&this.notifyTarget(n,"mouseleave"),n.target=n.target.parent;e.overTargets=null,this.freeEvent(o),this.freeEvent(n)}this.cursor=null}mapPointerUp(t){if(!(t instanceof Kt)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}let e=performance.now(),i=this.createPointerEvent(t);if(this.dispatchEvent(i,"pointerup"),i.pointerType==="touch")this.dispatchEvent(i,"touchend");else if(i.pointerType==="mouse"||i.pointerType==="pen"){let a=i.button===2;this.dispatchEvent(i,a?"rightup":"mouseup")}let s=this.trackingData(t.pointerId),o=this.findMountedTarget(s.pressTargetsByButton[t.button]),n=o;if(o&&!i.composedPath().includes(o)){let a=o;for(;a&&!i.composedPath().includes(a);){if(i.currentTarget=a,this.notifyTarget(i,"pointerupoutside"),i.pointerType==="touch")this.notifyTarget(i,"touchendoutside");else if(i.pointerType==="mouse"||i.pointerType==="pen"){let h=i.button===2;this.notifyTarget(i,h?"rightupoutside":"mouseupoutside")}a=a.parent}delete s.pressTargetsByButton[t.button],n=a}if(n){let a=this.clonePointerEvent(i,"click");a.target=n,a.path=null,s.clicksByButton[t.button]||(s.clicksByButton[t.button]={clickCount:0,target:a.target,timeStamp:e});let h=s.clicksByButton[t.button];if(h.target===a.target&&e-h.timeStamp<200?++h.clickCount:h.clickCount=1,h.target=a.target,h.timeStamp=e,a.detail=h.clickCount,a.pointerType==="mouse"){let l=a.button===2;this.dispatchEvent(a,l?"rightclick":"click")}else a.pointerType==="touch"&&this.dispatchEvent(a,"tap");this.dispatchEvent(a,"pointertap"),this.freeEvent(a)}this.freeEvent(i)}mapPointerUpOutside(t){if(!(t instanceof Kt)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}let e=this.trackingData(t.pointerId),i=this.findMountedTarget(e.pressTargetsByButton[t.button]),s=this.createPointerEvent(t);if(i){let o=i;for(;o;)s.currentTarget=o,this.notifyTarget(s,"pointerupoutside"),s.pointerType==="touch"?this.notifyTarget(s,"touchendoutside"):(s.pointerType==="mouse"||s.pointerType==="pen")&&this.notifyTarget(s,s.button===2?"rightupoutside":"mouseupoutside"),o=o.parent;delete e.pressTargetsByButton[t.button]}this.freeEvent(s)}mapWheel(t){if(!(t instanceof ze)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}let e=this.createWheelEvent(t);this.dispatchEvent(e),this.freeEvent(e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let i=1;i<t.length&&t[i].parent===e;i++)e=t[i];return e}createPointerEvent(t,e,i){let s=this.allocateEvent(Kt);return this.copyPointerData(t,s),this.copyMouseData(t,s),this.copyData(t,s),s.nativeEvent=t.nativeEvent,s.originalEvent=t,s.target=i??this.hitTest(s.global.x,s.global.y)??this._hitElements[0],typeof e=="string"&&(s.type=e),s}createWheelEvent(t){let e=this.allocateEvent(ze);return this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.hitTest(e.global.x,e.global.y),e}clonePointerEvent(t,e){let i=this.allocateEvent(Kt);return i.nativeEvent=t.nativeEvent,i.originalEvent=t.originalEvent,this.copyPointerData(t,i),this.copyMouseData(t,i),this.copyData(t,i),i.target=t.target,i.path=t.composedPath().slice(),i.type=e??i.type,i}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof Kt&&e instanceof Kt&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof ir&&e instanceof ir&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.copyFrom(t.client),e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.copyFrom(t.movement),e.screen.copyFrom(t.screen),e.shiftKey=t.shiftKey,e.global.copyFrom(t.global))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.copyFrom(t.layer),e.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);let e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.path=null,e.target=null,e}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");let e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t)}notifyListeners(t,e){let i=t.currentTarget._events[e];if(i&&t.currentTarget.isInteractive())if("fn"in i)i.once&&t.currentTarget.removeListener(e,i.fn,void 0,!0),i.fn.call(i.context,t);else for(let s=0,o=i.length;s<o&&!t.propagationImmediatelyStopped;s++)i[s].once&&t.currentTarget.removeListener(e,i[s].fn,void 0,!0),i[s].fn.call(i[s].context,t)}};var _x=1,xx={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},yu=class _u{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new Uo(null),rr.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new Kt(null),this.rootWheelEvent=new ze(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({..._u.defaultEventFeatures},{set:(e,i,s)=>(i==="globalMove"&&(this.rootBoundary.enableGlobalMoveEvents=s),e[i]=s,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(t){let{view:e,resolution:i}=this.renderer;this.setTargetElement(e),this.resolution=i,_u._defaultEventMode=t.eventMode??"auto",Object.assign(this.features,t.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(t){t=t||"default";let e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this.currentCursor===t)return;this.currentCursor=t;let i=this.cursorStyles[t];if(i)switch(typeof i){case"string":e&&(this.domElement.style.cursor=i);break;case"function":i(t);break;case"object":e&&Object.assign(this.domElement.style,i);break}else e&&typeof t=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}get pointer(){return this.rootPointerEvent}onPointerDown(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let i=0,s=e.length;i<s;i++){let o=e[i],n=this.bootstrapEvent(this.rootPointerEvent,o);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(t){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,rr.pointerMoved();let e=this.normalizeToPointerData(t);for(let i=0,s=e.length;i<s;i++){let o=this.bootstrapEvent(this.rootPointerEvent,e[i]);this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let e=t.target;t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]);let i=e!==this.domElement?"outside":"",s=this.normalizeToPointerData(t);for(let o=0,n=s.length;o<n;o++){let a=this.bootstrapEvent(this.rootPointerEvent,s[o]);a.type+=i,this.rootBoundary.mapEvent(a)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let e=this.normalizeToPointerData(t);for(let i=0,s=e.length;i<s;i++){let o=this.bootstrapEvent(this.rootPointerEvent,e[i]);this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){if(!this.features.wheel)return;let e=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e)}setTargetElement(t){this.removeEvents(),this.domElement=t,rr.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;rr.addTickerListener();let t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0))),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;rr.removeTickerListener();let t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0))),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(t,e,i){let s=this.domElement.isConnected?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0},o=1/this.resolution;t.x=(e-s.left)*(this.domElement.width/s.width)*o,t.y=(i-s.top)*(this.domElement.height/s.height)*o}normalizeToPointerData(t){let e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let i=0,s=t.changedTouches.length;i<s;i++){let o=t.changedTouches[i];typeof o.button>"u"&&(o.button=0),typeof o.buttons>"u"&&(o.buttons=1),typeof o.isPrimary>"u"&&(o.isPrimary=t.touches.length===1&&t.type==="touchstart"),typeof o.width>"u"&&(o.width=o.radiusX||1),typeof o.height>"u"&&(o.height=o.radiusY||1),typeof o.tiltX>"u"&&(o.tiltX=0),typeof o.tiltY>"u"&&(o.tiltY=0),typeof o.pointerType>"u"&&(o.pointerType="touch"),typeof o.pointerId>"u"&&(o.pointerId=o.identifier||0),typeof o.pressure>"u"&&(o.pressure=o.force||.5),typeof o.twist>"u"&&(o.twist=0),typeof o.tangentialPressure>"u"&&(o.tangentialPressure=0),typeof o.layerX>"u"&&(o.layerX=o.offsetX=o.clientX),typeof o.layerY>"u"&&(o.layerY=o.offsetY=o.clientY),o.isNormalized=!0,o.type=t.type,e.push(o)}else if(!globalThis.MouseEvent||t instanceof MouseEvent&&(!this.supportsPointerEvents||!(t instanceof globalThis.PointerEvent))){let i=t;typeof i.isPrimary>"u"&&(i.isPrimary=!0),typeof i.width>"u"&&(i.width=1),typeof i.height>"u"&&(i.height=1),typeof i.tiltX>"u"&&(i.tiltX=0),typeof i.tiltY>"u"&&(i.tiltY=0),typeof i.pointerType>"u"&&(i.pointerType="mouse"),typeof i.pointerId>"u"&&(i.pointerId=_x),typeof i.pressure>"u"&&(i.pressure=.5),typeof i.twist>"u"&&(i.twist=0),typeof i.tangentialPressure>"u"&&(i.tangentialPressure=0),i.isNormalized=!0,e.push(i)}else e.push(t);return e}normalizeWheelEvent(t){let e=this.rootWheelEvent;return this.transferMouseData(e,t),e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ,e.deltaMode=t.deltaMode,this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){return t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e),this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=e.isTrusted,t.type==="pointerleave"&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=xx[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null,t.shiftKey=e.shiftKey}};yu.extension={name:"events",type:[T.RendererSystem,T.CanvasRendererSystem]},yu.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};var Go=yu;w.add(Go);function Mf(r){return r==="dynamic"||r==="static"}var Bf={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){return this._internalInteractive??Mf(Go.defaultEventMode)},set interactive(r){S.deprecation("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=r,this.eventMode=r?"static":"auto"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??Go.defaultEventMode},set eventMode(r){this._internalInteractive=Mf(r),this._internalEventMode=r},isInteractive(){return this.eventMode==="static"||this.eventMode==="dynamic"},interactiveChildren:!0,hitArea:null,addEventListener(r,t,e){let i=typeof e=="boolean"&&e||typeof e=="object"&&e.capture,s=typeof t=="function"?void 0:t;r=i?`${r}capture`:r,t=typeof t=="function"?t:t.handleEvent,this.on(r,t,s)},removeEventListener(r,t,e){let i=typeof e=="boolean"&&e||typeof e=="object"&&e.capture,s=typeof t=="function"?void 0:t;r=i?`${r}capture`:r,t=typeof t=="function"?t:t.handleEvent,this.off(r,t,s)},dispatchEvent(r){if(!(r instanceof xr))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return r.defaultPrevented=!1,r.path=null,r.target=this,r.manager.dispatchEvent(r),!r.defaultPrevented}};at.mixin(Bf);var xu={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};at.mixin(xu);var vx=9,Ta=100,bx=0,Tx=0,Ff=2,Df=1,Ex=-1e3,wx=-1e3,Sx=2,Ho=class{constructor(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(S.isMobile.tablet||S.isMobile.phone)&&this.createTouchHook();let e=document.createElement("div");e.style.width=`${Ta}px`,e.style.height=`${Ta}px`,e.style.position="absolute",e.style.top=`${bx}px`,e.style.left=`${Tx}px`,e.style.zIndex=Ff.toString(),this.div=e,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){let t=document.createElement("button");t.style.width=`${Df}px`,t.style.height=`${Df}px`,t.style.position="absolute",t.style.top=`${Ex}px`,t.style.left=`${wx}px`,t.style.zIndex=Sx.toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(t),this._hookDiv=t}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode?.appendChild(this.div))}deactivate(){!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode?.removeChild(this.div))}updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.isInteractive()&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);let e=t.children;if(e)for(let i=0;i<e.length;i++)this.updateAccessibleObjects(e[i])}update(){let t=performance.now();if(S.isMobile.android.device&&t<this.androidUpdateCount||(this.androidUpdateCount=t+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);let{x:e,y:i,width:s,height:o}=this.renderer.view.getBoundingClientRect(),{width:n,height:a,resolution:h}=this.renderer,l=s/n*h,u=o/a*h,c=this.div;c.style.left=`${e}px`,c.style.top=`${i}px`,c.style.width=`${n}px`,c.style.height=`${a}px`;for(let d=0;d<this.children.length;d++){let p=this.children[d];if(p.renderId!==this.renderId)p._accessibleActive=!1,S.removeItems(this.children,d,1),this.div.removeChild(p._accessibleDiv),this.pool.push(p._accessibleDiv),p._accessibleDiv=null,d--;else{c=p._accessibleDiv;let f=p.hitArea,m=p.worldTransform;p.hitArea?(c.style.left=`${(m.tx+f.x*m.a)*l}px`,c.style.top=`${(m.ty+f.y*m.d)*u}px`,c.style.width=`${f.width*m.a*l}px`,c.style.height=`${f.height*m.d*u}px`):(f=p.getBounds(),this.capHitArea(f),c.style.left=`${f.x*l}px`,c.style.top=`${f.y*u}px`,c.style.width=`${f.width*l}px`,c.style.height=`${f.height*u}px`,c.title!==p.accessibleTitle&&p.accessibleTitle!==null&&(c.title=p.accessibleTitle),c.getAttribute("aria-label")!==p.accessibleHint&&p.accessibleHint!==null&&c.setAttribute("aria-label",p.accessibleHint)),(p.accessibleTitle!==c.title||p.tabIndex!==c.tabIndex)&&(c.title=p.accessibleTitle,c.tabIndex=p.tabIndex,this.debug&&this.updateDebugHTML(c))}}this.renderId++}updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);let{width:e,height:i}=this.renderer;t.x+t.width>e&&(t.width=e-t.x),t.y+t.height>i&&(t.height=i-t.y)}addChild(t){let e=this.pool.pop();e||(e=document.createElement("button"),e.style.width=`${Ta}px`,e.style.height=`${Ta}px`,e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=Ff.toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&t.accessibleTitle!==null?e.title=t.accessibleTitle:(!t.accessibleHint||t.accessibleHint===null)&&(e.title=`displayObject ${t.tabIndex}`),t.accessibleHint&&t.accessibleHint!==null&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex}_dispatchEvent(t,e){let{displayObject:i}=t.target,s=this.renderer.events.rootBoundary,o=Object.assign(new xr(s),{target:i});s.rootTarget=this.renderer.lastObjectRendered,e.forEach(n=>s.dispatchEvent(o,n))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){t.keyCode===vx&&this.activate()}_onMouseMove(t){t.movementX===0&&t.movementY===0||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}};Ho.extension={name:"accessibility",type:[T.RendererPlugin,T.CanvasRendererPlugin]};w.add(Ho);var oe=(r=>(r[r.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",r[r.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",r[r.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",r[r.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",r[r.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",r[r.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",r[r.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",r[r.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",r[r.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",r[r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",r[r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",r[r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",r[r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",r[r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",r[r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",r[r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",r[r.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",r[r.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",r[r.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",r[r.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",r[r.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",r))(oe||{}),Gr={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35986:1,34798:1,37808:1};var vr,ms;function Lf(){ms={s3tc:vr.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:vr.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:vr.getExtension("WEBGL_compressed_texture_etc"),etc1:vr.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:vr.getExtension("WEBGL_compressed_texture_pvrtc")||vr.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:vr.getExtension("WEBGL_compressed_texture_atc"),astc:vr.getExtension("WEBGL_compressed_texture_astc")}}var vu={extension:{type:T.DetectionParser,priority:2},test:async()=>{let r=E.ADAPTER.createCanvas().getContext("webgl");return r?(vr=r,!0):(console.warn("WebGL not available for compressed textures."),!1)},add:async r=>{ms||Lf();let t=[];for(let e in ms)ms[e]&&t.push(e);return[...t,...r]},remove:async r=>(ms||Lf(),r.filter(t=>!(t in ms)))};w.add(vu);var gs=class extends Ge{constructor(t,e={width:1,height:1,autoLoad:!0}){let i,s;typeof t=="string"?(i=t,s=new Uint8Array):(i=null,s=t),super(s,e),this.origin=i,this.buffer=s?new Rr(s):null,this._load=null,this.loaded=!1,this.origin!==null&&e.autoLoad!==!1&&this.load(),this.origin===null&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(t){}load(){return this._load?this._load:(this._load=fetch(this.origin).then(t=>t.blob()).then(t=>t.arrayBuffer()).then(t=>(this.data=new Uint32Array(t),this.buffer=new Rr(t),this.loaded=!0,this.onBlobLoaded(t),this.update(),this)),this._load)}};var br=class r extends gs{constructor(t,e){super(t,e),this.format=e.format,this.levels=e.levels||1,this._width=e.width,this._height=e.height,this._extension=r._formatToExtension(this.format),(e.levelBuffers||this.buffer)&&(this._levelBuffers=e.levelBuffers||r._createLevelBuffers(t instanceof Uint8Array?t:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(t,e,i){let s=t.gl;if(!t.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;s.pixelStorei(s.UNPACK_ALIGNMENT,4);for(let o=0,n=this.levels;o<n;o++){let{levelID:a,levelWidth:h,levelHeight:l,levelBuffer:u}=this._levelBuffers[o];s.compressedTexImage2D(s.TEXTURE_2D,a,this.format,h,l,0,u)}return!0}onBlobLoaded(){this._levelBuffers=r._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t>=36196)return"etc1";if(t>=35986&&t<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")}static _createLevelBuffers(t,e,i,s,o,n,a){let h=new Array(i),l=t.byteOffset,u=n,c=a,d=u+s-1&~(s-1),p=c+o-1&~(o-1),f=d*p*Gr[e];for(let m=0;m<i;m++)h[m]={levelID:m,levelWidth:i>1?u:d,levelHeight:i>1?c:p,levelBuffer:new Uint8Array(t.buffer,l,f)},l+=f,u=u>>1||1,c=c>>1||1,d=u+s-1&~(s-1),p=c+o-1&~(o-1),f=d*p*Gr[e];return h}};var bu=4,Ea=124,Ax=32,Of=20,Cx=542327876,wa={SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},Px={SIZE:0,FLAGS:1,FOURCC:2,RGB_BITCOUNT:3,R_BIT_MASK:4,G_BIT_MASK:5,B_BIT_MASK:6,A_BIT_MASK:7},Sa={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4},Ix=1,Rx=2,Mx=4,Bx=64,Fx=512,Dx=131072,Lx=827611204,Ox=861165636,Nx=894720068,kx=808540228,Ux=4,Gx={[Lx]:oe.COMPRESSED_RGBA_S3TC_DXT1_EXT,[Ox]:oe.COMPRESSED_RGBA_S3TC_DXT3_EXT,[Nx]:oe.COMPRESSED_RGBA_S3TC_DXT5_EXT},Hx={70:oe.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:oe.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:oe.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:oe.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:oe.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:oe.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:oe.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:oe.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:oe.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT};function Aa(r){let t=new Uint32Array(r);if(t[0]!==Cx)throw new Error("Invalid DDS file magic word");let e=new Uint32Array(r,0,Ea/Uint32Array.BYTES_PER_ELEMENT),i=e[wa.HEIGHT],s=e[wa.WIDTH],o=e[wa.MIPMAP_COUNT],n=new Uint32Array(r,wa.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,Ax/Uint32Array.BYTES_PER_ELEMENT),a=n[Ix];if(a&Mx){let h=n[Px.FOURCC];if(h!==kx){let v=Gx[h],_=bu+Ea,x=new Uint8Array(r,_);return[new br(x,{format:v,width:s,height:i,levels:o})]}let l=bu+Ea,u=new Uint32Array(t.buffer,l,Of/Uint32Array.BYTES_PER_ELEMENT),c=u[Sa.DXGI_FORMAT],d=u[Sa.RESOURCE_DIMENSION],p=u[Sa.MISC_FLAG],f=u[Sa.ARRAY_SIZE],m=Hx[c];if(m===void 0)throw new Error(`DDSParser cannot parse texture data with DXGI format ${c}`);if(p===Ux)throw new Error("DDSParser does not support cubemap textures");if(d===6)throw new Error("DDSParser does not supported 3D texture data");let g=new Array,y=bu+Ea+Of;if(f===1)g.push(new Uint8Array(r,y));else{let v=Gr[m],_=0,x=s,M=i;for(let I=0;I<o;I++){let R=Math.max(1,x+3&-4),N=Math.max(1,M+3&-4),q=R*N*v;_+=q,x=x>>>1,M=M>>>1}let G=y;for(let I=0;I<f;I++)g.push(new Uint8Array(r,G,_)),G+=_}return g.map(v=>new br(v,{format:m,width:s,height:i,levels:o}))}throw a&Bx?new Error("DDSParser does not support uncompressed texture data."):a&Fx?new Error("DDSParser does not supported YUV uncompressed texture data."):a&Dx?new Error("DDSParser does not support single-channel (lumninance) texture data!"):a&Rx?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}var Nf=[171,75,84,88,32,49,49,187,13,10,26,10],Vx=67305985,je={FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},Tu=64,Ca={[U.UNSIGNED_BYTE]:1,[U.UNSIGNED_SHORT]:2,[U.INT]:4,[U.UNSIGNED_INT]:4,[U.FLOAT]:4,[U.HALF_FLOAT]:8},Eu={[P.RGBA]:4,[P.RGB]:3,[P.RG]:2,[P.RED]:1,[P.LUMINANCE]:1,[P.LUMINANCE_ALPHA]:2,[P.ALPHA]:1},wu={[U.UNSIGNED_SHORT_4_4_4_4]:2,[U.UNSIGNED_SHORT_5_5_5_1]:2,[U.UNSIGNED_SHORT_5_6_5]:2};function Pa(r,t,e=!1){let i=new DataView(t);if(!Xx(r,i))return null;let s=i.getUint32(je.ENDIANNESS,!0)===Vx,o=i.getUint32(je.GL_TYPE,s),n=i.getUint32(je.GL_FORMAT,s),a=i.getUint32(je.GL_INTERNAL_FORMAT,s),h=i.getUint32(je.PIXEL_WIDTH,s),l=i.getUint32(je.PIXEL_HEIGHT,s)||1,u=i.getUint32(je.PIXEL_DEPTH,s)||1,c=i.getUint32(je.NUMBER_OF_ARRAY_ELEMENTS,s)||1,d=i.getUint32(je.NUMBER_OF_FACES,s),p=i.getUint32(je.NUMBER_OF_MIPMAP_LEVELS,s),f=i.getUint32(je.BYTES_OF_KEY_VALUE_DATA,s);if(l===0||u!==1)throw new Error("Only 2D textures are supported");if(d!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(c!==1)throw new Error("WebGL does not support array textures");let m=4,g=4,y=h+3&-4,v=l+3&-4,_=new Array(c),x=h*l;o===0&&(x=y*v);let M;if(o!==0?Ca[o]?M=Ca[o]*Eu[n]:M=wu[o]:M=Gr[a],M===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");let G=e?zx(i,f,s):null,I=x*M,R=h,N=l,q=y,D=v,F=Tu+f;for(let A=0;A<p;A++){let C=i.getUint32(F,s),J=F+4;for(let rt=0;rt<c;rt++){let X=_[rt];X||(X=_[rt]=new Array(p)),X[A]={levelID:A,levelWidth:p>1||o!==0?R:q,levelHeight:p>1||o!==0?N:D,levelBuffer:new Uint8Array(t,J,I)},J+=I}F+=C+4,F=F%4!==0?F+4-F%4:F,R=R>>1||1,N=N>>1||1,q=R+m-1&~(m-1),D=N+g-1&~(g-1),I=q*D*M}return o!==0?{uncompressed:_.map(A=>{let C=A[0].levelBuffer,J=!1;return o===U.FLOAT?C=new Float32Array(A[0].levelBuffer.buffer,A[0].levelBuffer.byteOffset,A[0].levelBuffer.byteLength/4):o===U.UNSIGNED_INT?(J=!0,C=new Uint32Array(A[0].levelBuffer.buffer,A[0].levelBuffer.byteOffset,A[0].levelBuffer.byteLength/4)):o===U.INT&&(J=!0,C=new Int32Array(A[0].levelBuffer.buffer,A[0].levelBuffer.byteOffset,A[0].levelBuffer.byteLength/4)),{resource:new Ge(C,{width:A[0].levelWidth,height:A[0].levelHeight}),type:o,format:J?Wx(n):n}}),kvData:G}:{compressed:_.map(A=>new br(null,{format:a,width:h,height:l,levels:p,levelBuffers:A})),kvData:G}}function Xx(r,t){for(let e=0;e<Nf.length;e++)if(t.getUint8(e)!==Nf[e])return console.error(`${r} is not a valid *.ktx file!`),!1;return!0}function Wx(r){switch(r){case P.RGBA:return P.RGBA_INTEGER;case P.RGB:return P.RGB_INTEGER;case P.RG:return P.RG_INTEGER;case P.RED:return P.RED_INTEGER;default:return r}}function zx(r,t,e){let i=new Map,s=0;for(;s<t;){let o=r.getUint32(Tu+s,e),n=Tu+s+4,a=3-(o+3)%4;if(o===0||o>t-s){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let h=0;for(;h<o&&r.getUint8(n+h)!==0;h++);if(h===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}let l=new TextDecoder().decode(new Uint8Array(r.buffer,n,h)),u=new DataView(r.buffer,n+h+1,o-h-1);i.set(l,u),s+=4+o+a}return i}var Su={extension:{type:T.LoadParser,priority:gt.High},name:"loadDDS",test(r){return Dt(r,".dds")},async load(r,t,e){let i=await(await E.ADAPTER.fetch(r)).arrayBuffer(),s=Aa(i).map(o=>{let n=new W(o,{mipmap:Ut.OFF,alphaMode:xt.NO_PREMULTIPLIED_ALPHA,resolution:S.getResolutionOfUrl(r),...t.data});return Me(n,e,r)});return s.length===1?s[0]:s},unload(r){Array.isArray(r)?r.forEach(t=>t.destroy(!0)):r.destroy(!0)}};w.add(Su);var Au={extension:{type:T.LoadParser,priority:gt.High},name:"loadKTX",test(r){return Dt(r,".ktx")},async load(r,t,e){let i=await(await E.ADAPTER.fetch(r)).arrayBuffer(),{compressed:s,uncompressed:o,kvData:n}=Pa(r,i),a=s??o,h={mipmap:Ut.OFF,alphaMode:xt.NO_PREMULTIPLIED_ALPHA,resolution:S.getResolutionOfUrl(r),...t.data},l=a.map(u=>{a===o&&Object.assign(h,{type:u.type,format:u.format});let c=u.resource??u,d=new W(c,h);return d.ktxKeyValueData=n,Me(d,e,r)});return l.length===1?l[0]:l},unload(r){Array.isArray(r)?r.forEach(t=>t.destroy(!0)):r.destroy(!0)}};w.add(Au);var Cu={extension:T.ResolveParser,test:r=>{let t=S.path.extname(r).slice(1);return["basis","ktx","dds"].includes(t)},parse:r=>{let t=S.path.extname(r).slice(1);if(t==="ktx"){let e=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx"];if(e.some(i=>r.endsWith(i)))return{resolution:parseFloat(E.RETINA_PREFIX.exec(r)?.[1]??"1"),format:e.find(i=>r.endsWith(i)),src:r}}return{resolution:parseFloat(E.RETINA_PREFIX.exec(r)?.[1]??"1"),format:t,src:r}}};w.add(Cu);var Ia=new z,jx=4,kf=class Vo{constructor(t){this.renderer=t,this._rendererPremultipliedAlpha=!1}contextChange(){let t=this.renderer?.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}async image(t,e,i,s){let o=new Image;return o.src=await this.base64(t,e,i,s),o}async base64(t,e,i,s){let o=this.canvas(t,s);if(o.toBlob!==void 0)return new Promise((n,a)=>{o.toBlob(h=>{if(!h){a(new Error("ICanvas.toBlob failed!"));return}let l=new FileReader;l.onload=()=>n(l.result),l.onerror=a,l.readAsDataURL(h)},e,i)});if(o.toDataURL!==void 0)return o.toDataURL(e,i);if(o.convertToBlob!==void 0){let n=await o.convertToBlob({type:e,quality:i});return new Promise((a,h)=>{let l=new FileReader;l.onload=()=>a(l.result),l.onerror=h,l.readAsDataURL(n)})}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(t,e){let{pixels:i,width:s,height:o,flipY:n,premultipliedAlpha:a}=this._rawPixels(t,e);n&&Vo._flipY(i,s,o),a&&Vo._unpremultiplyAlpha(i);let h=new S.CanvasRenderTarget(s,o,1),l=new ImageData(new Uint8ClampedArray(i.buffer),s,o);return h.context.putImageData(l,0,0),h.canvas}pixels(t,e){let{pixels:i,width:s,height:o,flipY:n,premultipliedAlpha:a}=this._rawPixels(t,e);return n&&Vo._flipY(i,s,o),a&&Vo._unpremultiplyAlpha(i),i}_rawPixels(t,e){let i=this.renderer;if(!i)throw new Error("The Extract has already been destroyed");let s,o=!1,n=!1,a,h=!1;t&&(t instanceof Pe?a=t:(a=i.generateTexture(t,{region:e,resolution:i.resolution,multisample:i.multisample}),h=!0,e&&(Ia.width=e.width,Ia.height=e.height,e=Ia)));let l=i.gl;if(a){if(s=a.baseTexture.resolution,e=e??a.frame,o=!1,n=a.baseTexture.alphaMode>0&&a.baseTexture.format===P.RGBA,!h){i.renderTexture.bind(a);let p=a.framebuffer.glFramebuffers[i.CONTEXT_UID];p.blitFramebuffer&&i.framebuffer.bind(p.blitFramebuffer)}}else s=i.resolution,e||(e=Ia,e.width=i.width/s,e.height=i.height/s),o=!0,n=this._rendererPremultipliedAlpha,i.renderTexture.bind();let u=Math.max(Math.round(e.width*s),1),c=Math.max(Math.round(e.height*s),1),d=new Uint8Array(jx*u*c);return l.readPixels(Math.round(e.x*s),Math.round(e.y*s),u,c,l.RGBA,l.UNSIGNED_BYTE,d),h&&a?.destroy(!0),{pixels:d,width:u,height:c,flipY:o,premultipliedAlpha:n}}destroy(){this.renderer=null}static _flipY(t,e,i){let s=e<<2,o=i>>1,n=new Uint8Array(s);for(let a=0;a<o;a++){let h=a*s,l=(i-a-1)*s;n.set(t.subarray(h,h+s)),t.copyWithin(h,l,l+s),t.set(n,l)}}static _unpremultiplyAlpha(t){t instanceof Uint8ClampedArray&&(t=new Uint8Array(t.buffer));let e=t.length;for(let i=0;i<e;i+=4){let s=t[i+3];if(s!==0){let o=255.001/s;t[i]=t[i]*o+.5,t[i+1]=t[i+1]*o+.5,t[i+2]=t[i+2]*o+.5}}}};kf.extension={name:"extract",type:T.RendererSystem};var Uf=kf;w.add(Uf);var gi={build(r){let t=r.points,e,i,s,o,n,a;if(r.type===dt.CIRC){let f=r.shape;e=f.x,i=f.y,n=a=f.radius,s=o=0}else if(r.type===dt.ELIP){let f=r.shape;e=f.x,i=f.y,n=f.width,a=f.height,s=o=0}else{let f=r.shape,m=f.width/2,g=f.height/2;e=f.x+m,i=f.y+g,n=a=Math.max(0,Math.min(f.radius,Math.min(m,g))),s=m-n,o=g-a}if(!(n>=0&&a>=0&&s>=0&&o>=0)){t.length=0;return}let h=Math.ceil(2.3*Math.sqrt(n+a)),l=h*8+(s?4:0)+(o?4:0);if(t.length=l,l===0)return;if(h===0){t.length=8,t[0]=t[6]=e+s,t[1]=t[3]=i+o,t[2]=t[4]=e-s,t[5]=t[7]=i-o;return}let u=0,c=h*4+(s?2:0)+2,d=c,p=l;{let f=s+n,m=o,g=e+f,y=e-f,v=i+m;if(t[u++]=g,t[u++]=v,t[--c]=v,t[--c]=y,o){let _=i-m;t[d++]=y,t[d++]=_,t[--p]=_,t[--p]=g}}for(let f=1;f<h;f++){let m=Math.PI/2*(f/h),g=s+Math.cos(m)*n,y=o+Math.sin(m)*a,v=e+g,_=e-g,x=i+y,M=i-y;t[u++]=v,t[u++]=x,t[--c]=x,t[--c]=_,t[d++]=_,t[d++]=M,t[--p]=M,t[--p]=v}{let f=s,m=o+a,g=e+f,y=e-f,v=i+m,_=i-m;t[u++]=g,t[u++]=v,t[--p]=_,t[--p]=g,s&&(t[u++]=y,t[u++]=v,t[--p]=_,t[--p]=y)}},triangulate(r,t){let e=r.points,i=t.points,s=t.indices;if(e.length===0)return;let o=i.length/2,n=o,a,h;if(r.type!==dt.RREC){let u=r.shape;a=u.x,h=u.y}else{let u=r.shape;a=u.x+u.width/2,h=u.y+u.height/2}let l=r.matrix;i.push(r.matrix?l.a*a+l.c*h+l.tx:a,r.matrix?l.b*a+l.d*h+l.ty:h),o++,i.push(e[0],e[1]);for(let u=2;u<e.length;u+=2)i.push(e[u],e[u+1]),s.push(o++,n,o);s.push(n+1,n,o)}};function Gf(r,t=!1){let e=r.length;if(e<6)return;let i=0;for(let s=0,o=r[e-2],n=r[e-1];s<e;s+=2){let a=r[s],h=r[s+1];i+=(a-o)*(h+n),o=a,n=h}if(!t&&i>0||t&&i<=0){let s=e/2;for(let o=s+s%2;o<e;o+=2){let n=e-o-2,a=e-o-1,h=o,l=o+1;[r[n],r[h]]=[r[h],r[n]],[r[a],r[l]]=[r[l],r[a]]}}}var Xo={build(r){r.points=r.shape.points.slice()},triangulate(r,t){let e=r.points,i=r.holes,s=t.points,o=t.indices;if(e.length>=6){Gf(e,!1);let n=[];for(let l=0;l<i.length;l++){let u=i[l];Gf(u.points,!0),n.push(e.length/2),e=e.concat(u.points)}let a=S.earcut(e,n,2);if(!a)return;let h=s.length/2;for(let l=0;l<a.length;l+=3)o.push(a[l]+h),o.push(a[l+1]+h),o.push(a[l+2]+h);for(let l=0;l<e.length;l++)s.push(e[l])}}};var Pu={build(r){let t=r.shape,e=t.x,i=t.y,s=t.width,o=t.height,n=r.points;n.length=0,s>=0&&o>=0&&n.push(e,i,e+s,i,e+s,i+o,e,i+o)},triangulate(r,t){let e=r.points,i=t.points;if(e.length===0)return;let s=i.length/2;i.push(e[0],e[1],e[2],e[3],e[6],e[7],e[4],e[5]),t.indices.push(s,s+1,s+2,s+1,s+2,s+3)}};var Iu={build(r){gi.build(r)},triangulate(r,t){gi.triangulate(r,t)}};var Zt=(r=>(r.MITER="miter",r.BEVEL="bevel",r.ROUND="round",r))(Zt||{}),De=(r=>(r.BUTT="butt",r.ROUND="round",r.SQUARE="square",r))(De||{}),Le={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(r,t=20){if(!this.adaptive||!r||isNaN(r))return t;let e=Math.ceil(r/this.maxLength);return e<this.minSegments?e=this.minSegments:e>this.maxSegments&&(e=this.maxSegments),e}};var yi=class{static curveTo(t,e,i,s,o,n){let a=n[n.length-2],h=n[n.length-1]-e,l=a-t,u=s-e,c=i-t,d=Math.abs(h*c-l*u);if(d<1e-8||o===0)return(n[n.length-2]!==t||n[n.length-1]!==e)&&n.push(t,e),null;let p=h*h+l*l,f=u*u+c*c,m=h*u+l*c,g=o*Math.sqrt(p)/d,y=o*Math.sqrt(f)/d,v=g*m/p,_=y*m/f,x=g*c+y*l,M=g*u+y*h,G=l*(y+v),I=h*(y+v),R=c*(g+_),N=u*(g+_),q=Math.atan2(I-M,G-x),D=Math.atan2(N-M,R-x);return{cx:x+t,cy:M+e,radius:o,startAngle:q,endAngle:D,anticlockwise:l*u>c*h}}static arc(t,e,i,s,o,n,a,h,l){let u=a-n,c=Le._segmentsCount(Math.abs(u)*o,Math.ceil(Math.abs(u)/Br)*40),d=u/(c*2),p=d*2,f=Math.cos(d),m=Math.sin(d),g=c-1,y=g%1/g;for(let v=0;v<=g;++v){let _=v+y*v,x=d+n+p*_,M=Math.cos(x),G=-Math.sin(x);l.push((f*M+m*G)*o+i,(f*-G+m*M)*o+s)}}};var ys=class{constructor(){this.reset()}begin(t,e,i){this.reset(),this.style=t,this.start=e,this.attribStart=i}end(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}};var _s=class r{static curveLength(t,e,i,s,o,n,a,h){let l=0,u=0,c=0,d=0,p=0,f=0,m=0,g=0,y=0,v=0,_=0,x=t,M=e;for(let G=1;G<=10;++G)u=G/10,c=u*u,d=c*u,p=1-u,f=p*p,m=f*p,g=m*t+3*f*u*i+3*p*c*o+d*a,y=m*e+3*f*u*s+3*p*c*n+d*h,v=x-g,_=M-y,x=g,M=y,l+=Math.sqrt(v*v+_*_);return l}static curveTo(t,e,i,s,o,n,a){let h=a[a.length-2],l=a[a.length-1];a.length-=2;let u=Le._segmentsCount(r.curveLength(h,l,t,e,i,s,o,n)),c=0,d=0,p=0,f=0,m=0;a.push(h,l);for(let g=1,y=0;g<=u;++g)y=g/u,c=1-y,d=c*c,p=d*c,f=y*y,m=f*y,a.push(p*h+3*d*y*t+3*c*f*i+m*o,p*l+3*d*y*e+3*c*f*s+m*n)}};function Hf(r,t,e,i,s,o,n,a){let h=r-e*s,l=t-i*s,u=r+e*o,c=t+i*o,d,p;n?(d=i,p=-e):(d=-i,p=e);let f=h+d,m=l+p,g=u+d,y=c+p;return a.push(f,m,g,y),2}function _i(r,t,e,i,s,o,n,a){let h=e-r,l=i-t,u=Math.atan2(h,l),c=Math.atan2(s-r,o-t);a&&u<c?u+=Math.PI*2:!a&&u>c&&(c+=Math.PI*2);let d=u,p=c-u,f=Math.abs(p),m=Math.sqrt(h*h+l*l),g=(15*f*Math.sqrt(m)/Math.PI>>0)+1,y=p/g;if(d+=y,a){n.push(r,t,e,i);for(let v=1,_=d;v<g;v++,_+=y)n.push(r,t,r+Math.sin(_)*m,t+Math.cos(_)*m);n.push(r,t,s,o)}else{n.push(e,i,r,t);for(let v=1,_=d;v<g;v++,_+=y)n.push(r+Math.sin(_)*m,t+Math.cos(_)*m,r,t);n.push(s,o,r,t)}return g*2}function $x(r,t){let e=r.shape,i=r.points||e.points.slice(),s=t.closePointEps;if(i.length===0)return;let o=r.lineStyle,n=new K(i[0],i[1]),a=new K(i[i.length-2],i[i.length-1]),h=e.type!==dt.POLY||e.closeStroke,l=Math.abs(n.x-a.x)<s&&Math.abs(n.y-a.y)<s;if(h){i=i.slice(),l&&(i.pop(),i.pop(),a.set(i[i.length-2],i[i.length-1]));let X=(n.x+a.x)*.5,L=(a.y+n.y)*.5;i.unshift(X,L),i.push(X,L)}let u=t.points,c=i.length/2,d=i.length,p=u.length/2,f=o.width/2,m=f*f,g=o.miterLimit*o.miterLimit,y=i[0],v=i[1],_=i[2],x=i[3],M=0,G=0,I=-(v-x),R=y-_,N=0,q=0,D=Math.sqrt(I*I+R*R);I/=D,R/=D,I*=f,R*=f;let F=o.alignment,A=(1-F)*2,C=F*2;h||(o.cap===De.ROUND?d+=_i(y-I*(A-C)*.5,v-R*(A-C)*.5,y-I*A,v-R*A,y+I*C,v+R*C,u,!0)+2:o.cap===De.SQUARE&&(d+=Hf(y,v,I,R,A,C,!0,u))),u.push(y-I*A,v-R*A,y+I*C,v+R*C);for(let X=1;X<c-1;++X){y=i[(X-1)*2],v=i[(X-1)*2+1],_=i[X*2],x=i[X*2+1],M=i[(X+1)*2],G=i[(X+1)*2+1],I=-(v-x),R=y-_,D=Math.sqrt(I*I+R*R),I/=D,R/=D,I*=f,R*=f,N=-(x-G),q=_-M,D=Math.sqrt(N*N+q*q),N/=D,q/=D,N*=f,q*=f;let L=_-y,j=v-x,H=_-M,ht=G-x,yt=L*H+j*ht,Et=j*H-ht*L,_t=Et<0;if(Math.abs(Et)<.001*Math.abs(yt)){u.push(_-I*A,x-R*A,_+I*C,x+R*C),yt>=0&&(o.join===Zt.ROUND?d+=_i(_,x,_-I*A,x-R*A,_-N*A,x-q*A,u,!1)+4:d+=2,u.push(_-N*C,x-q*C,_+N*A,x+q*A));continue}let Wt=(-I+y)*(-R+x)-(-I+_)*(-R+v),ae=(-N+M)*(-q+x)-(-N+_)*(-q+G),Qt=(L*ae-H*Wt)/Et,he=(ht*Wt-j*ae)/Et,At=(Qt-_)*(Qt-_)+(he-x)*(he-x),wt=_+(Qt-_)*A,Ct=x+(he-x)*A,zt=_-(Qt-_)*C,Jt=x-(he-x)*C,Ms=Math.min(L*L+j*j,H*H+ht*ht),Yu=_t?A:C,vm=Ms+Yu*Yu*m,bm=At<=vm,cn=o.join;if(cn===Zt.MITER&&At/m>g&&(cn=Zt.BEVEL),bm)switch(cn){case Zt.MITER:{u.push(wt,Ct,zt,Jt);break}case Zt.BEVEL:{_t?u.push(wt,Ct,_+I*C,x+R*C,wt,Ct,_+N*C,x+q*C):u.push(_-I*A,x-R*A,zt,Jt,_-N*A,x-q*A,zt,Jt),d+=2;break}case Zt.ROUND:{_t?(u.push(wt,Ct,_+I*C,x+R*C),d+=_i(_,x,_+I*C,x+R*C,_+N*C,x+q*C,u,!0)+4,u.push(wt,Ct,_+N*C,x+q*C)):(u.push(_-I*A,x-R*A,zt,Jt),d+=_i(_,x,_-I*A,x-R*A,_-N*A,x-q*A,u,!1)+4,u.push(_-N*A,x-q*A,zt,Jt));break}}else{switch(u.push(_-I*A,x-R*A,_+I*C,x+R*C),cn){case Zt.MITER:{_t?u.push(zt,Jt,zt,Jt):u.push(wt,Ct,wt,Ct),d+=2;break}case Zt.ROUND:{_t?d+=_i(_,x,_+I*C,x+R*C,_+N*C,x+q*C,u,!0)+2:d+=_i(_,x,_-I*A,x-R*A,_-N*A,x-q*A,u,!1)+2;break}}u.push(_-N*A,x-q*A,_+N*C,x+q*C),d+=2}}y=i[(c-2)*2],v=i[(c-2)*2+1],_=i[(c-1)*2],x=i[(c-1)*2+1],I=-(v-x),R=y-_,D=Math.sqrt(I*I+R*R),I/=D,R/=D,I*=f,R*=f,u.push(_-I*A,x-R*A,_+I*C,x+R*C),h||(o.cap===De.ROUND?d+=_i(_-I*(A-C)*.5,x-R*(A-C)*.5,_-I*A,x-R*A,_+I*C,x+R*C,u,!1)+2:o.cap===De.SQUARE&&(d+=Hf(_,x,I,R,A,C,!1,u)));let J=t.indices,rt=Le.epsilon*Le.epsilon;for(let X=p;X<d+p-2;++X)y=u[X*2],v=u[X*2+1],_=u[(X+1)*2],x=u[(X+1)*2+1],M=u[(X+2)*2],G=u[(X+2)*2+1],!(Math.abs(y*(x-G)+_*(G-v)+M*(v-x))<rt)&&J.push(X,X+1,X+2)}function Yx(r,t){let e=0,i=r.shape,s=r.points||i.points,o=i.type!==dt.POLY||i.closeStroke;if(s.length===0)return;let n=t.points,a=t.indices,h=s.length/2,l=n.length/2,u=l;for(n.push(s[0],s[1]),e=1;e<h;e++)n.push(s[e*2],s[e*2+1]),a.push(u,u+1),u++;o&&a.push(u,l)}function Wo(r,t){r.lineStyle.native?Yx(r,t):$x(r,t)}var xs=class r{static curveLength(t,e,i,s,o,n){let a=t-2*i+o,h=e-2*s+n,l=2*i-2*t,u=2*s-2*e,c=4*(a*a+h*h),d=4*(a*l+h*u),p=l*l+u*u,f=2*Math.sqrt(c+d+p),m=Math.sqrt(c),g=2*c*m,y=2*Math.sqrt(p),v=d/m;return(g*f+m*d*(f-y)+(4*p*c-d*d)*Math.log((2*m+v+f)/(v+y)))/(4*g)}static curveTo(t,e,i,s,o){let n=o[o.length-2],a=o[o.length-1],h=Le._segmentsCount(r.curveLength(n,a,t,e,i,s)),l=0,u=0;for(let c=1;c<=h;++c){let d=c/h;l=n+(t-n)*d,u=a+(e-a)*d,o.push(l+(t+(i-t)*d-l)*d,u+(e+(s-e)*d-u)*d)}}};var zo={[dt.POLY]:Xo,[dt.CIRC]:gi,[dt.ELIP]:gi,[dt.RECT]:Pu,[dt.RREC]:Iu},Ra=[],vs=[];var bs=class r{constructor(t,e=null,i=null,s=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=i,this.fillStyle=e,this.matrix=s,this.type=t.type}clone(){return new r(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}};var Ts=new K,Vf=class Xf extends Zr{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new er,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),vs.push(this.drawCalls[t]);this.drawCalls.length=0;for(let t=0;t<this.batches.length;t++){let e=this.batches[t];e.reset(),Ra.push(e)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(t,e=null,i=null,s=null){let o=new bs(t,e,i,s);return this.graphicsData.push(o),this.dirty++,this}drawHole(t,e=null){if(!this.graphicsData.length)return null;let i=new bs(t,null,null,e),s=this.graphicsData[this.graphicsData.length-1];return i.lineStyle=s.lineStyle,s.holes.push(i),this.dirty++,this}destroy(){super.destroy();for(let t=0;t<this.graphicsData.length;++t)this.graphicsData[t].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(t){let e=this.graphicsData;for(let i=0;i<e.length;++i){let s=e[i];if(s.fillStyle.visible&&s.shape&&(s.matrix?s.matrix.applyInverse(t,Ts):Ts.copyFrom(t),s.shape.contains(Ts.x,Ts.y))){let o=!1;if(s.holes){for(let n=0;n<s.holes.length;n++)if(s.holes[n].shape.contains(Ts.x,Ts.y)){o=!0;break}}if(!o)return!0}}return!1}updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return}if(!this.validateBatching())return;this.cacheDirty=this.dirty;let t=this.uvs,e=this.graphicsData,i=null,s=null;this.batches.length>0&&(i=this.batches[this.batches.length-1],s=i.style);for(let h=this.shapeIndex;h<e.length;h++){this.shapeIndex++;let l=e[h],u=l.fillStyle,c=l.lineStyle;zo[l.type].build(l),l.matrix&&this.transformPoints(l.points,l.matrix),(u.visible||c.visible)&&this.processHoles(l.holes);for(let d=0;d<2;d++){let p=d===0?u:c;if(!p.visible)continue;let f=p.texture.baseTexture,m=this.indices.length,g=this.points.length/2;f.wrapMode=ye.REPEAT,d===0?this.processFill(l):this.processLine(l);let y=this.points.length/2-g;y!==0&&(i&&!this._compareStyles(s,p)&&(i.end(m,g),i=null),i||(i=Ra.pop()||new ys,i.begin(p,m,g),this.batches.push(i),s=p),this.addUvs(this.points,t,p.texture,g,y,p.matrix))}}let o=this.indices.length,n=this.points.length/2;if(i&&i.end(o,n),this.batches.length===0){this.batchable=!0;return}let a=n>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&a===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=a?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(t,e){return!(!t||!e||t.texture.baseTexture!==e.texture.baseTexture||t.color+t.alpha!==e.color+e.alpha||!!t.native!=!!e.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let t=0,e=this.graphicsData.length;t<e;t++){let i=this.graphicsData[t],s=i.fillStyle,o=i.lineStyle;if(s&&!s.texture.baseTexture.valid||o&&!o.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);let t=this.batches;for(let e=0,i=t.length;e<i;e++){let s=t[e];for(let o=0;o<s.size;o++){let n=s.start+o;this.indicesUint16[n]=this.indicesUint16[n]-s.attribStart}}}isBatchable(){if(this.points.length>65535*2)return!1;let t=this.batches;for(let e=0;e<t.length;e++)if(t[e].style.native)return!1;return this.points.length<Xf.BATCHABLE_SIZE*2}buildDrawCalls(){let t=++W._globalBatch;for(let c=0;c<this.drawCalls.length;c++)this.drawCalls[c].texArray.clear(),vs.push(this.drawCalls[c]);this.drawCalls.length=0;let e=this.colors,i=this.textureIds,s=vs.pop();s||(s=new Mr,s.texArray=new Fr),s.texArray.count=0,s.start=0,s.size=0,s.type=le.TRIANGLES;let o=0,n=null,a=0,h=!1,l=le.TRIANGLES,u=0;this.drawCalls.push(s);for(let c=0;c<this.batches.length;c++){let d=this.batches[c],p=8,f=d.style,m=f.texture.baseTexture;h!==!!f.native&&(h=!!f.native,l=h?le.LINES:le.TRIANGLES,n=null,o=p,t++),n!==m&&(n=m,m._batchEnabled!==t&&(o===p&&(t++,o=0,s.size>0&&(s=vs.pop(),s||(s=new Mr,s.texArray=new Fr),this.drawCalls.push(s)),s.start=u,s.size=0,s.texArray.count=0,s.type=l),m.touched=1,m._batchEnabled=t,m._batchLocation=o,m.wrapMode=ye.REPEAT,s.texArray.elements[s.texArray.count++]=m,o++)),s.size+=d.size,u+=d.size,a=m._batchLocation,this.addColors(e,f.color,f.alpha,d.attribSize,d.attribStart),this.addTextureIds(i,a,d.attribSize,d.attribStart)}W._globalBatch=t,this.packAttributes()}packAttributes(){let t=this.points,e=this.uvs,i=this.colors,s=this.textureIds,o=new ArrayBuffer(t.length*3*4),n=new Float32Array(o),a=new Uint32Array(o),h=0;for(let l=0;l<t.length/2;l++)n[h++]=t[l*2],n[h++]=t[l*2+1],n[h++]=e[l*2],n[h++]=e[l*2+1],a[h++]=i[l],n[h++]=s[l];this._buffer.update(o),this._indexBuffer.update(this.indicesUint16)}processFill(t){t.holes.length?Xo.triangulate(t,this):zo[t.type].triangulate(t,this)}processLine(t){Wo(t,this);for(let e=0;e<t.holes.length;e++)Wo(t.holes[e],this)}processHoles(t){for(let e=0;e<t.length;e++){let i=t[e];zo[i.type].build(i),i.matrix&&this.transformPoints(i.points,i.matrix)}}calculateBounds(){let t=this._bounds;t.clear(),t.addVertexData(this.points,0,this.points.length),t.pad(this.boundsPadding,this.boundsPadding)}transformPoints(t,e){for(let i=0;i<t.length/2;i++){let s=t[i*2],o=t[i*2+1];t[i*2]=e.a*s+e.c*o+e.tx,t[i*2+1]=e.b*s+e.d*o+e.ty}}addColors(t,e,i,s,o=0){let n=Q.shared.setValue(e).toLittleEndianNumber(),a=Q.shared.setValue(n).toPremultiplied(i);t.length=Math.max(t.length,o+s);for(let h=0;h<s;h++)t[o+h]=a}addTextureIds(t,e,i,s=0){t.length=Math.max(t.length,s+i);for(let o=0;o<i;o++)t[s+o]=e}addUvs(t,e,i,s,o,n=null){let a=0,h=e.length,l=i.frame;for(;a<o;){let c=t[(s+a)*2],d=t[(s+a)*2+1];if(n){let p=n.a*c+n.c*d+n.tx;d=n.b*c+n.d*d+n.ty,c=p}a++,e.push(c/l.width,d/l.height)}let u=i.baseTexture;(l.width<u.width||l.height<u.height)&&this.adjustUvs(e,i,h,o)}adjustUvs(t,e,i,s){let o=e.baseTexture,n=1e-6,a=i+s*2,h=e.frame,l=h.width/o.width,u=h.height/o.height,c=h.x/h.width,d=h.y/h.height,p=Math.floor(t[i]+n),f=Math.floor(t[i+1]+n);for(let m=i+2;m<a;m+=2)p=Math.min(p,Math.floor(t[m]+n)),f=Math.min(f,Math.floor(t[m+1]+n));c-=p,d-=f;for(let m=i;m<a;m+=2)t[m]=(t[m]+c)*l,t[m+1]=(t[m+1]+d)*u}};Vf.BATCHABLE_SIZE=100;var Ru=Vf;var xi=class r{constructor(){this.color=16777215,this.alpha=1,this.texture=b.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){let t=new r;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=b.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}};var jo=class r extends xi{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=De.BUTT,this.join=Zt.MITER,this.miterLimit=10}clone(){let t=new r;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1,this.cap=De.BUTT,this.join=Zt.MITER,this.miterLimit=10}};var Mu={},Bu=class Ma extends O{constructor(t=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new xi,this._lineStyle=new jo,this._matrix=null,this._holeMode=!1,this.state=Bt.for2d(),this._geometry=t||new Ru,this._geometry.refCount++,this._transformID=-1,this._tintColor=new Q(16777215),this.blendMode=Y.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new Ma(this._geometry)}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(t=null,e=0,i,s=.5,o=!1){return typeof t=="number"&&(t={width:t,color:e,alpha:i,alignment:s,native:o}),this.lineTextureStyle(t)}lineTextureStyle(t){let e={width:0,texture:b.WHITE,color:t?.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:De.BUTT,join:Zt.MITER,miterLimit:10};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();let i=t.width>0&&t.alpha>0;return i?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:i},t)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){let t=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new Qe,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[e-2],t[e-1]))}else this.currentPath=new Qe,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(t,e){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=e,this}lineTo(t,e){this.currentPath||this.moveTo(0,0);let i=this.currentPath.points,s=i[i.length-2],o=i[i.length-1];return(s!==t||o!==e)&&i.push(t,e),this}_initCurve(t=0,e=0){this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[t,e]):this.moveTo(t,e)}quadraticCurveTo(t,e,i,s){this._initCurve();let o=this.currentPath.points;return o.length===0&&this.moveTo(0,0),xs.curveTo(t,e,i,s,o),this}bezierCurveTo(t,e,i,s,o,n){return this._initCurve(),_s.curveTo(t,e,i,s,o,n,this.currentPath.points),this}arcTo(t,e,i,s,o){this._initCurve(t,e);let n=this.currentPath.points,a=yi.curveTo(t,e,i,s,o,n);if(a){let{cx:h,cy:l,radius:u,startAngle:c,endAngle:d,anticlockwise:p}=a;this.arc(h,l,u,c,d,p)}return this}arc(t,e,i,s,o,n=!1){if(s===o)return this;if(!n&&o<=s?o+=Br:n&&s<=o&&(s+=Br),o-s===0)return this;let a=t+Math.cos(s)*i,h=e+Math.sin(s)*i,l=this._geometry.closePointEps,u=this.currentPath?this.currentPath.points:null;if(u){let c=Math.abs(u[u.length-2]-a),d=Math.abs(u[u.length-1]-h);c<l&&d<l||u.push(a,h)}else this.moveTo(a,h),u=this.currentPath.points;return yi.arc(a,h,t,e,i,s,o,n,u),this}beginFill(t=0,e){return this.beginTextureFill({texture:b.WHITE,color:t,alpha:e})}normalizeColor(t){let e=Q.shared.setValue(t.color??0);t.color=e.toNumber(),t.alpha??(t.alpha=e.alpha)}beginTextureFill(t){let e={texture:b.WHITE,color:16777215,matrix:null};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();let i=t.alpha>0;return i?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:i},t)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(t,e,i,s){return this.drawShape(new z(t,e,i,s))}drawRoundedRect(t,e,i,s,o){return this.drawShape(new zi(t,e,i,s,o))}drawCircle(t,e,i){return this.drawShape(new Xi(t,e,i))}drawEllipse(t,e,i,s){return this.drawShape(new Wi(t,e,i,s))}drawPolygon(...t){let e,i=!0,s=t[0];s.points?(i=s.closeStroke,e=s.points):Array.isArray(t[0])?e=t[0]:e=t;let o=new Qe(e);return o.closeStroke=i,this.drawShape(o),this}drawShape(t){return this._holeMode?this._geometry.drawHole(t,this._matrix):this._geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){let t=this._geometry.graphicsData;return t.length===1&&t[0].shape.type===dt.RECT&&!t[0].matrix&&!t[0].holes.length&&!(t[0].lineStyle.visible&&t[0].lineStyle.width)}_render(t){this.finishPoly();let e=this._geometry;e.updateBatches(),e.batchable?(this.batchDirty!==e.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))}_populateBatches(){let t=this._geometry,e=this.blendMode,i=t.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.batches.length=i,this.vertexData=new Float32Array(t.points);for(let s=0;s<i;s++){let o=t.batches[s],n=o.style.color,a=new Float32Array(this.vertexData.buffer,o.attribStart*4*2,o.attribSize*2),h=new Float32Array(t.uvsFloat32.buffer,o.attribStart*4*2,o.attribSize*2),l=new Uint16Array(t.indicesUint16.buffer,o.start*2,o.size),u={vertexData:a,blendMode:e,indices:l,uvs:h,_batchRGB:Q.shared.setValue(n).toRgbArray(),_tintRGB:n,_texture:o.style.texture,alpha:o.style.alpha,worldAlpha:1};this.batches[s]=u}}_renderBatched(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let e=0,i=this.batches.length;e<i;e++){let s=this.batches[e];s.worldAlpha=this.worldAlpha*s.alpha,t.plugins[this.pluginName].render(s)}}}_renderDirect(t){let e=this._resolveDirectShader(t),i=this._geometry,s=this.worldAlpha,o=e.uniforms,n=i.drawCalls;o.translationMatrix=this.transform.worldTransform,Q.shared.setValue(this._tintColor).premultiply(s).toArray(o.tint),t.shader.bind(e),t.geometry.bind(i,e),t.state.set(this.state);for(let a=0,h=n.length;a<h;a++)this._renderDrawCallDirect(t,i.drawCalls[a])}_renderDrawCallDirect(t,e){let{texArray:i,type:s,size:o,start:n}=e,a=i.count;for(let h=0;h<a;h++)t.texture.bind(i.elements[h],h);t.geometry.draw(s,o,n)}_resolveDirectShader(t){let e=this.shader,i=this.pluginName;if(!e){if(!Mu[i]){let{maxTextures:s}=t.plugins[i],o=new Int32Array(s);for(let h=0;h<s;h++)o[h]=h;let n={tint:new Float32Array([1,1,1,1]),translationMatrix:new et,default:ie.from({uSamplers:o},!0)},a=t.plugins[i]._shader.program;Mu[i]=new Gt(a,n)}e=Mu[i]}return e}_calculateBounds(){this.finishPoly();let t=this._geometry;if(!t.graphicsData.length)return;let{minX:e,minY:i,maxX:s,maxY:o}=t.bounds;this._bounds.addFrame(this.transform,e,i,s,o)}containsPoint(t){return this.worldTransform.applyInverse(t,Ma._TEMP_POINT),this._geometry.containsPoint(Ma._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let t=0;t<this.batches.length;t++){let e=this.batches[t];e._tintRGB=Q.shared.setValue(this._tintColor).multiply(e._batchRGB).toLittleEndianNumber()}}}calculateVertices(){let t=this.transform._worldID;if(this._transformID===t)return;this._transformID=t;let e=this.transform.worldTransform,i=e.a,s=e.b,o=e.c,n=e.d,a=e.tx,h=e.ty,l=this._geometry.points,u=this.vertexData,c=0;for(let d=0;d<l.length;d+=2){let p=l[d],f=l[d+1];u[c++]=i*p+o*f+a,u[c++]=n*f+s*p+h}}closePath(){let t=this.currentPath;return t&&(t.closeStroke=!0,this.finishPoly()),this}setMatrix(t){return this._matrix=t,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(t){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(t)}};Bu.curves=Le,Bu._TEMP_POINT=new K;var Hr=Bu;var $o=class{constructor(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;let e=this.uvBuffer.data;(!this.data||this.data.length!==e.length)&&(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}};var Fu=new K,Wf=new Qe,zf=class jf extends O{constructor(t,e,i,s=le.TRIANGLES){super(),this.geometry=t,this.shader=e,this.state=i||Bt.for2d(),this.drawMode=s,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=E.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(t){this._geometry!==t&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=t,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(t){this.shader=t}get material(){return this.shader}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(t){this.shader.tint=t}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(t){this.shader.texture=t}_render(t){let e=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===le.TRIANGLES&&e.length<jf.BATCHABLE_SIZE*2?this._renderToBatch(t):this._renderDefault(t)}_renderDefault(t){let e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),t.shader.bind(e),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(t){let e=this.geometry,i=this.shader;i.uvMatrix&&(i.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=i._tintRGB,this._texture=i.texture;let s=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[s]),t.plugins[s].render(this)}calculateVertices(){let t=this.geometry.buffers[0],e=t.data,i=t._updateID;if(i===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));let s=this.transform.worldTransform,o=s.a,n=s.b,a=s.c,h=s.d,l=s.tx,u=s.ty,c=this.vertexData;for(let d=0;d<c.length/2;d++){let p=e[d*2],f=e[d*2+1];c[d*2]=o*p+a*f+l,c[d*2+1]=n*p+h*f+u}if(this._roundPixels){let d=E.RESOLUTION;for(let p=0;p<c.length;++p)c[p]=Math.round(c[p]*d)/d}this.vertexDirty=i}calculateUvs(){let t=this.geometry.buffers[1],e=this.shader;e.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new $o(t,e.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,Fu);let e=this.geometry.getBuffer("aVertexPosition").data,i=Wf.points,s=this.geometry.getIndex().data,o=s.length,n=this.drawMode===4?3:1;for(let a=0;a+2<o;a+=n){let h=s[a]*2,l=s[a+1]*2,u=s[a+2]*2;if(i[0]=e[h],i[1]=e[h+1],i[2]=e[l],i[3]=e[l+1],i[4]=e[u],i[5]=e[u+1],Wf.contains(Fu.x,Fu.y))return!0}return!1}destroy(t){super.destroy(t),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};zf.BATCHABLE_SIZE=100;var vi=zf;var Vr=class extends ve{constructor(t,e,i){super();let s=new ut(t),o=new ut(e,!0),n=new ut(i,!0,!0);this.addAttribute("aVertexPosition",s,2,!1,U.FLOAT).addAttribute("aTextureCoord",o,2,!1,U.FLOAT).addIndex(n),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}};var $f=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`;var Yf=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`;var Tr=class extends Gt{constructor(t,e){let i={uSampler:t,alpha:1,uTextureMatrix:et.IDENTITY,uColor:new Float32Array([1,1,1,1])};e=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},e),e.uniforms&&Object.assign(i,e.uniforms),super(e.program||qt.from(Yf,$f),i),this._colorDirty=!1,this.uvMatrix=new Lr(t),this.batchable=e.program===void 0,this.pluginName=e.pluginName,this._tintColor=new Q(e.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=e.alpha}get texture(){return this.uniforms.uSampler}set texture(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)}set alpha(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(t){t!==this.tint&&(this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;let t=this.texture.baseTexture.alphaMode;Q.shared.setValue(this._tintColor).premultiply(this._alpha,t).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}};var Yo=class{constructor(t,e,i){this.geometry=new ve,this.indexBuffer=null,this.size=i,this.dynamicProperties=[],this.staticProperties=[];for(let s=0;s<t.length;++s){let o=t[s];o={attributeName:o.attributeName,size:o.size,uploadFunction:o.uploadFunction,type:o.type||U.FLOAT,offset:o.offset},e[s]?this.dynamicProperties.push(o):this.staticProperties.push(o)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){let t=this.geometry,e=0;this.indexBuffer=new ut(S.createIndicesForQuads(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(let n=0;n<this.dynamicProperties.length;++n){let a=this.dynamicProperties[n];a.offset=e,e+=a.size,this.dynamicStride+=a.size}let i=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(i),this.dynamicDataUint32=new Uint32Array(i),this.dynamicBuffer=new ut(this.dynamicData,!1,!1);let s=0;this.staticStride=0;for(let n=0;n<this.staticProperties.length;++n){let a=this.staticProperties[n];a.offset=s,s+=a.size,this.staticStride+=a.size}let o=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(o),this.staticDataUint32=new Uint32Array(o),this.staticBuffer=new ut(this.staticData,!0,!1);for(let n=0;n<this.dynamicProperties.length;++n){let a=this.dynamicProperties[n];t.addAttribute(a.attributeName,this.dynamicBuffer,0,a.type===U.UNSIGNED_BYTE,a.type,this.dynamicStride*4,a.offset*4)}for(let n=0;n<this.staticProperties.length;++n){let a=this.staticProperties[n];t.addAttribute(a.attributeName,this.staticBuffer,0,a.type===U.UNSIGNED_BYTE,a.type,this.staticStride*4,a.offset*4)}}uploadDynamic(t,e,i){for(let s=0;s<this.dynamicProperties.length;s++){let o=this.dynamicProperties[s];o.uploadFunction(t,e,i,o.type===U.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,o.offset)}this.dynamicBuffer._updateID++}uploadStatic(t,e,i){for(let s=0;s<this.staticProperties.length;s++){let o=this.staticProperties[s];o.uploadFunction(t,e,i,o.type===U.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,o.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}};var qf=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`;var Kf=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`;var qo=class extends He{constructor(t){super(t),this.shader=null,this.properties=null,this.tempMatrix=new et,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:U.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=Gt.from(Kf,qf,{}),this.state=Bt.for2d()}render(t){let e=t.children,i=t._maxSize,s=t._batchSize,o=this.renderer,n=e.length;if(n===0)return;n>i&&!t.autoResize&&(n=i);let a=t._buffers;a||(a=t._buffers=this.generateBuffers(t));let h=e[0]._texture.baseTexture,l=h.alphaMode>0;this.state.blendMode=S.correctBlendMode(t.blendMode,l),o.state.set(this.state);let u=o.gl,c=t.worldTransform.copyTo(this.tempMatrix);c.prepend(o.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=c.toArray(!0),this.shader.uniforms.uColor=Q.shared.setValue(t.tintRgb).premultiply(t.worldAlpha,l).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=h,this.renderer.shader.bind(this.shader);let d=!1;for(let p=0,f=0;p<n;p+=s,f+=1){let m=n-p;m>s&&(m=s),f>=a.length&&a.push(this._generateOneMoreBuffer(t));let g=a[f];g.uploadDynamic(e,p,m);let y=t._bufferUpdateIDs[f]||0;d=d||g._updateID<y,d&&(g._updateID=t._updateID,g.uploadStatic(e,p,m)),o.geometry.bind(g.geometry),u.drawElements(u.TRIANGLES,m*6,u.UNSIGNED_SHORT,0)}}generateBuffers(t){let e=[],i=t._maxSize,s=t._batchSize,o=t._properties;for(let n=0;n<i;n+=s)e.push(new Yo(this.properties,o,s));return e}_generateOneMoreBuffer(t){let e=t._batchSize,i=t._properties;return new Yo(this.properties,i,e)}uploadVertices(t,e,i,s,o,n){let a=0,h=0,l=0,u=0;for(let c=0;c<i;++c){let d=t[e+c],p=d._texture,f=d.scale.x,m=d.scale.y,g=p.trim,y=p.orig;g?(h=g.x-d.anchor.x*y.width,a=h+g.width,u=g.y-d.anchor.y*y.height,l=u+g.height):(a=y.width*(1-d.anchor.x),h=y.width*-d.anchor.x,l=y.height*(1-d.anchor.y),u=y.height*-d.anchor.y),s[n]=h*f,s[n+1]=u*m,s[n+o]=a*f,s[n+o+1]=u*m,s[n+o*2]=a*f,s[n+o*2+1]=l*m,s[n+o*3]=h*f,s[n+o*3+1]=l*m,n+=o*4}}uploadPosition(t,e,i,s,o,n){for(let a=0;a<i;a++){let h=t[e+a].position;s[n]=h.x,s[n+1]=h.y,s[n+o]=h.x,s[n+o+1]=h.y,s[n+o*2]=h.x,s[n+o*2+1]=h.y,s[n+o*3]=h.x,s[n+o*3+1]=h.y,n+=o*4}}uploadRotation(t,e,i,s,o,n){for(let a=0;a<i;a++){let h=t[e+a].rotation;s[n]=h,s[n+o]=h,s[n+o*2]=h,s[n+o*3]=h,n+=o*4}}uploadUvs(t,e,i,s,o,n){for(let a=0;a<i;++a){let h=t[e+a]._texture._uvs;h?(s[n]=h.x0,s[n+1]=h.y0,s[n+o]=h.x1,s[n+o+1]=h.y1,s[n+o*2]=h.x2,s[n+o*2+1]=h.y2,s[n+o*3]=h.x3,s[n+o*3+1]=h.y3,n+=o*4):(s[n]=0,s[n+1]=0,s[n+o]=0,s[n+o+1]=0,s[n+o*2]=0,s[n+o*2+1]=0,s[n+o*3]=0,s[n+o*3+1]=0,n+=o*4)}}uploadTint(t,e,i,s,o,n){for(let a=0;a<i;++a){let h=t[e+a],l=Q.shared.setValue(h._tintRGB).toPremultiplied(h.alpha,h.texture.baseTexture.alphaMode>0);s[n]=l,s[n+o]=l,s[n+o*2]=l,s[n+o*3]=l,n+=o*4}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}};qo.extension={name:"particle",type:T.RendererPlugin};w.add(qo);var Xr=(r=>(r[r.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",r[r.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",r))(Xr||{});var Ba={willReadFrequently:!0},sr=class ${static get experimentalLetterSpacingSupported(){let t=$._experimentalLetterSpacingSupported;if(t!==void 0){let e=E.ADAPTER.getCanvasRenderingContext2D().prototype;t=$._experimentalLetterSpacingSupported="letterSpacing"in e||"textLetterSpacing"in e}return t}constructor(t,e,i,s,o,n,a,h,l){this.text=t,this.style=e,this.width=i,this.height=s,this.lines=o,this.lineWidths=n,this.lineHeight=a,this.maxLineWidth=h,this.fontProperties=l}static measureText(t,e,i,s=$._canvas){i=i??e.wordWrap;let o=e.toFontString(),n=$.measureFont(o);n.fontSize===0&&(n.fontSize=e.fontSize,n.ascent=e.fontSize);let a=s.getContext("2d",Ba);a.font=o;let h=(i?$.wordWrap(t,e,s):t).split(/(?:\r\n|\r|\n)/),l=new Array(h.length),u=0;for(let f=0;f<h.length;f++){let m=$._measureText(h[f],e.letterSpacing,a);l[f]=m,u=Math.max(u,m)}let c=u+e.strokeThickness;e.dropShadow&&(c+=e.dropShadowDistance);let d=e.lineHeight||n.fontSize+e.strokeThickness,p=Math.max(d,n.fontSize+e.strokeThickness*2)+e.leading+(h.length-1)*(d+e.leading);return e.dropShadow&&(p+=e.dropShadowDistance),new $(t,e,c,p,h,l,d+e.leading,u,n)}static _measureText(t,e,i){let s=!1;$.experimentalLetterSpacingSupported&&($.experimentalLetterSpacing?(i.letterSpacing=`${e}px`,i.textLetterSpacing=`${e}px`,s=!0):(i.letterSpacing="0px",i.textLetterSpacing="0px"));let o=i.measureText(t).width;return o>0&&(s?o-=e:o+=($.graphemeSegmenter(t).length-1)*e),o}static wordWrap(t,e,i=$._canvas){let s=i.getContext("2d",Ba),o=0,n="",a="",h=Object.create(null),{letterSpacing:l,whiteSpace:u}=e,c=$.collapseSpaces(u),d=$.collapseNewlines(u),p=!c,f=e.wordWrapWidth+l,m=$.tokenize(t);for(let g=0;g<m.length;g++){let y=m[g];if($.isNewline(y)){if(!d){a+=$.addLine(n),p=!c,n="",o=0;continue}y=" "}if(c){let _=$.isBreakingSpace(y),x=$.isBreakingSpace(n[n.length-1]);if(_&&x)continue}let v=$.getFromCache(y,l,h,s);if(v>f)if(n!==""&&(a+=$.addLine(n),n="",o=0),$.canBreakWords(y,e.breakWords)){let _=$.wordWrapSplit(y);for(let x=0;x<_.length;x++){let M=_[x],G=M,I=1;for(;_[x+I];){let N=_[x+I];if(!$.canBreakChars(G,N,y,x,e.breakWords))M+=N;else break;G=N,I++}x+=I-1;let R=$.getFromCache(M,l,h,s);R+o>f&&(a+=$.addLine(n),p=!1,n="",o=0),n+=M,o+=R}}else{n.length>0&&(a+=$.addLine(n),n="",o=0);let _=g===m.length-1;a+=$.addLine(y,!_),p=!1,n="",o=0}else v+o>f&&(p=!1,a+=$.addLine(n),n="",o=0),(n.length>0||!$.isBreakingSpace(y)||p)&&(n+=y,o+=v)}return a+=$.addLine(n,!1),a}static addLine(t,e=!0){return t=$.trimRight(t),t=e?`${t}
`:t,t}static getFromCache(t,e,i,s){let o=i[t];return typeof o!="number"&&(o=$._measureText(t,e,s)+e,i[t]=o),o}static collapseSpaces(t){return t==="normal"||t==="pre-line"}static collapseNewlines(t){return t==="normal"}static trimRight(t){if(typeof t!="string")return"";for(let e=t.length-1;e>=0;e--){let i=t[e];if(!$.isBreakingSpace(i))break;t=t.slice(0,-1)}return t}static isNewline(t){return typeof t!="string"?!1:$._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,e){return typeof t!="string"?!1:$._breakingSpaces.includes(t.charCodeAt(0))}static tokenize(t){let e=[],i="";if(typeof t!="string")return e;for(let s=0;s<t.length;s++){let o=t[s],n=t[s+1];if($.isBreakingSpace(o,n)||$.isNewline(o)){i!==""&&(e.push(i),i=""),e.push(o);continue}i+=o}return i!==""&&e.push(i),e}static canBreakWords(t,e){return e}static canBreakChars(t,e,i,s,o){return!0}static wordWrapSplit(t){return $.graphemeSegmenter(t)}static measureFont(t){if($._fonts[t])return $._fonts[t];let e={ascent:0,descent:0,fontSize:0},i=$._canvas,s=$._context;s.font=t;let o=$.METRICS_STRING+$.BASELINE_SYMBOL,n=Math.ceil(s.measureText(o).width),a=Math.ceil(s.measureText($.BASELINE_SYMBOL).width),h=Math.ceil($.HEIGHT_MULTIPLIER*a);if(a=a*$.BASELINE_MULTIPLIER|0,n===0||h===0)return $._fonts[t]=e,e;i.width=n,i.height=h,s.fillStyle="#f00",s.fillRect(0,0,n,h),s.font=t,s.textBaseline="alphabetic",s.fillStyle="#000",s.fillText(o,0,a);let l=s.getImageData(0,0,n,h).data,u=l.length,c=n*4,d=0,p=0,f=!1;for(d=0;d<a;++d){for(let m=0;m<c;m+=4)if(l[p+m]!==255){f=!0;break}if(!f)p+=c;else break}for(e.ascent=a-d,p=u-c,f=!1,d=h;d>a;--d){for(let m=0;m<c;m+=4)if(l[p+m]!==255){f=!0;break}if(!f)p-=c;else break}return e.descent=d-a,e.fontSize=e.ascent+e.descent,$._fonts[t]=e,e}static clearMetrics(t=""){t?delete $._fonts[t]:$._fonts={}}static get _canvas(){if(!$.__canvas){let t;try{let e=new OffscreenCanvas(0,0);if(e.getContext("2d",Ba)?.measureText)return $.__canvas=e,e;t=E.ADAPTER.createCanvas()}catch{t=E.ADAPTER.createCanvas()}t.width=t.height=10,$.__canvas=t}return $.__canvas}static get _context(){return $.__context||($.__context=$._canvas.getContext("2d",Ba)),$.__context}};sr.METRICS_STRING="|\xC9q\xC5",sr.BASELINE_SYMBOL="M",sr.BASELINE_MULTIPLIER=1.4,sr.HEIGHT_MULTIPLIER=2,sr.graphemeSegmenter=(()=>{if(typeof Intl?.Segmenter=="function"){let r=new Intl.Segmenter;return t=>[...r.segment(t)].map(e=>e.segment)}return r=>[...r]})(),sr.experimentalLetterSpacing=!1,sr._fonts={},sr._newlines=[10,13],sr._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];var Oe=sr;var Qx=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],Zf=class Ko{constructor(t){this.styleID=0,this.reset(),Lu(this,t,t)}clone(){let t={};return Lu(t,this,Ko.defaultStyle),new Ko(t)}reset(){Lu(this,Ko.defaultStyle,Ko.defaultStyle)}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(t){let e=Du(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)}get fill(){return this._fill}set fill(t){let e=Du(t);this._fill!==e&&(this._fill=e,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(t){Jx(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)}get leading(){return this._leading}set leading(t){this._leading!==t&&(this._leading=t,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)}get padding(){return this._padding}set padding(t){this._padding!==t&&(this._padding=t,this.styleID++)}get stroke(){return this._stroke}set stroke(t){let e=Du(t);this._stroke!==e&&(this._stroke=e,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)}get trim(){return this._trim}set trim(t){this._trim!==t&&(this._trim=t,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)}toFontString(){let t=typeof this.fontSize=="number"?`${this.fontSize}px`:this.fontSize,e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(let i=e.length-1;i>=0;i--){let s=e[i].trim();!/([\"\'])[^\'\"]+\1/.test(s)&&!Qx.includes(s)&&(s=`"${s}"`),e[i]=s}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${t} ${e.join(",")}`}};Zf.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:Xr.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};var me=Zf;function Du(r){let t=Q.shared,e=i=>{let s=t.setValue(i);return s.alpha===1?s.toHex():s.toRgbaString()};return Array.isArray(r)?r.map(e):e(r)}function Jx(r,t){if(!Array.isArray(r)||!Array.isArray(t)||r.length!==t.length)return!1;for(let e=0;e<r.length;++e)if(r[e]!==t[e])return!1;return!0}function Lu(r,t,e){for(let i in e)Array.isArray(t[i])?r[i]=t[i].slice():r[i]=t[i]}var t0={texture:!0,children:!1,baseTexture:!0},Qf=class Ou extends B{constructor(t,e,i){let s=!1;i||(i=E.ADAPTER.createCanvas(),s=!0),i.width=3,i.height=3;let o=b.from(i);o.orig=new z,o.trim=new z,super(o),this._ownCanvas=s,this.canvas=i,this.context=i.getContext("2d",{willReadFrequently:!0}),this._resolution=Ou.defaultResolution??E.RESOLUTION,this._autoResolution=Ou.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=t,this.style=e,this.localStyleID=-1}static get experimentalLetterSpacing(){return Oe.experimentalLetterSpacing}static set experimentalLetterSpacing(t){S.deprecation("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),Oe.experimentalLetterSpacing=t}updateText(t){let e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;this._font=this._style.toFontString();let i=this.context,s=Oe.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),o=s.width,n=s.height,a=s.lines,h=s.lineHeight,l=s.lineWidths,u=s.maxLineWidth,c=s.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,o)+e.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,n)+e.padding*2)*this._resolution),i.scale(this._resolution,this._resolution),i.clearRect(0,0,this.canvas.width,this.canvas.height),i.font=this._font,i.lineWidth=e.strokeThickness,i.textBaseline=e.textBaseline,i.lineJoin=e.lineJoin,i.miterLimit=e.miterLimit;let d,p,f=e.dropShadow?2:1;for(let m=0;m<f;++m){let g=e.dropShadow&&m===0,y=g?Math.ceil(Math.max(1,n)+e.padding*2):0,v=y*this._resolution;if(g){i.fillStyle="black",i.strokeStyle="black";let x=e.dropShadowColor,M=e.dropShadowBlur*this._resolution,G=e.dropShadowDistance*this._resolution;i.shadowColor=Q.shared.setValue(x).setAlpha(e.dropShadowAlpha).toRgbaString(),i.shadowBlur=M,i.shadowOffsetX=Math.cos(e.dropShadowAngle)*G,i.shadowOffsetY=Math.sin(e.dropShadowAngle)*G+v}else i.fillStyle=this._generateFillStyle(e,a,s),i.strokeStyle=e.stroke,i.shadowColor="black",i.shadowBlur=0,i.shadowOffsetX=0,i.shadowOffsetY=0;let _=(h-c.fontSize)/2;h-c.fontSize<0&&(_=0);for(let x=0;x<a.length;x++)d=e.strokeThickness/2,p=e.strokeThickness/2+x*h+c.ascent+_,e.align==="right"?d+=u-l[x]:e.align==="center"&&(d+=(u-l[x])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(a[x],d+e.padding,p+e.padding-y,!0),e.fill&&this.drawLetterSpacing(a[x],d+e.padding,p+e.padding-y)}this.updateTexture()}drawLetterSpacing(t,e,i,s=!1){let o=this._style.letterSpacing,n=!1;if(Oe.experimentalLetterSpacingSupported&&(Oe.experimentalLetterSpacing?(this.context.letterSpacing=`${o}px`,this.context.textLetterSpacing=`${o}px`,n=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),o===0||n){s?this.context.strokeText(t,e,i):this.context.fillText(t,e,i);return}let a=e,h=Oe.graphemeSegmenter(t),l=this.context.measureText(t).width,u=0;for(let c=0;c<h.length;++c){let d=h[c];s?this.context.strokeText(d,a,i):this.context.fillText(d,a,i);let p="";for(let f=c+1;f<h.length;++f)p+=h[f];u=this.context.measureText(p).width,a+=l-u+o,l=u}}updateTexture(){let t=this.canvas;if(this._style.trim){let n=S.trimCanvas(t);n.data&&(t.width=n.width,t.height=n.height,this.context.putImageData(n.data,0,0))}let e=this._texture,i=this._style,s=i.trim?0:i.padding,o=e.baseTexture;e.trim.width=e._frame.width=t.width/this._resolution,e.trim.height=e._frame.height=t.height/this._resolution,e.trim.x=-s,e.trim.y=-s,e.orig.width=e._frame.width-s*2,e.orig.height=e._frame.height-s*2,this._onTextureUpdate(),o.setRealSize(t.width,t.height,this._resolution),e.updateUvs(),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(t,e){return this.updateText(!0),this._textureID===-1&&(t=!1),super.getBounds(t,e)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds.call(this,t)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(t,e,i){let s=t.fill;if(Array.isArray(s)){if(s.length===1)return s[0]}else return s;let o,n=t.dropShadow?t.dropShadowDistance:0,a=t.padding||0,h=this.canvas.width/this._resolution-n-a*2,l=this.canvas.height/this._resolution-n-a*2,u=s.slice(),c=t.fillGradientStops.slice();if(!c.length){let d=u.length+1;for(let p=1;p<d;++p)c.push(p/d)}if(u.unshift(s[0]),c.unshift(0),u.push(s[s.length-1]),c.push(1),t.fillGradientType===Xr.LINEAR_VERTICAL){o=this.context.createLinearGradient(h/2,a,h/2,l+a);let d=i.fontProperties.fontSize+t.strokeThickness;for(let p=0;p<e.length;p++){let f=i.lineHeight*(p-1)+d,m=i.lineHeight*p,g=m;p>0&&f>m&&(g=(m+f)/2);let y=m+d,v=i.lineHeight*(p+1),_=y;p+1<e.length&&v<y&&(_=(y+v)/2);let x=(_-g)/l;for(let M=0;M<u.length;M++){let G=0;typeof c[M]=="number"?G=c[M]:G=M/u.length;let I=Math.min(1,Math.max(0,g/l+G*x));I=Number(I.toFixed(5)),o.addColorStop(I,u[M])}}}else{o=this.context.createLinearGradient(a,l/2,h+a,l/2);let d=u.length+1,p=1;for(let f=0;f<u.length;f++){let m;typeof c[f]=="number"?m=c[f]:m=p/d,o.addColorStop(m,u[f]),p++}}return o}destroy(t){typeof t=="boolean"&&(t={children:t}),t=Object.assign({},t0,t),super.destroy(t),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(t){this.updateText(!0);let e=S.sign(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(t){this.updateText(!0);let e=S.sign(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get style(){return this._style}set style(t){t=t||{},t instanceof me?this._style=t:this._style=new me(t),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(t){t=String(t??""),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}};Qf.defaultAutoResolution=!0;var ct=Qf;var Zo=class{constructor(t){this.maxItemsPerFrame=t,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}};function e0(r,t){let e=!1;if(r?._textures?.length){for(let i=0;i<r._textures.length;i++)if(r._textures[i]instanceof b){let s=r._textures[i].baseTexture;t.includes(s)||(t.push(s),e=!0)}}return e}function r0(r,t){if(r.baseTexture instanceof W){let e=r.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function i0(r,t){if(r._texture&&r._texture instanceof b){let e=r._texture.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function s0(r,t){return t instanceof ct?(t.updateText(!0),!0):!1}function o0(r,t){if(t instanceof me){let e=t.toFontString();return Oe.measureFont(e),!0}return!1}function n0(r,t){if(r instanceof ct){t.includes(r.style)||t.push(r.style),t.includes(r)||t.push(r);let e=r._texture.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function a0(r,t){return r instanceof me?(t.includes(r)||t.push(r),!0):!1}var Jf=class tm{constructor(t){this.limiter=new Zo(tm.uploadsPerFrame),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(n0),this.registerFindHook(a0),this.registerFindHook(e0),this.registerFindHook(r0),this.registerFindHook(i0),this.registerUploadHook(s0),this.registerUploadHook(o0)}upload(t){return new Promise(e=>{t&&this.add(t),this.queue.length?(this.completes.push(e),this.ticking||(this.ticking=!0,st.system.addOnce(this.tick,this,de.UTILITY))):e()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){let t=this.queue[0],e=!1;if(t&&!t._destroyed){for(let i=0,s=this.uploadHooks.length;i<s;i++)if(this.uploadHooks[i](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}}e||this.queue.shift()}if(this.queue.length)st.system.addOnce(this.tick,this,de.UTILITY);else{this.ticking=!1;let t=this.completes.slice(0);this.completes.length=0;for(let e=0,i=t.length;e<i;e++)t[e]()}}registerFindHook(t){return t&&this.addHooks.push(t),this}registerUploadHook(t){return t&&this.uploadHooks.push(t),this}add(t){for(let e=0,i=this.addHooks.length;e<i&&!this.addHooks[e](t,this.queue);e++);if(t instanceof O)for(let e=t.children.length-1;e>=0;e--)this.add(t.children[e]);return this}destroy(){this.ticking&&st.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};Jf.uploadsPerFrame=4;var Es=Jf;Object.defineProperties(E,{UPLOADS_PER_FRAME:{get(){return Es.uploadsPerFrame},set(r){S.deprecation("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),Es.uploadsPerFrame=r}}});function em(r,t){return t instanceof W?(t._glTextures[r.CONTEXT_UID]||r.texture.bind(t),!0):!1}function h0(r,t){if(!(t instanceof Hr))return!1;let{geometry:e}=t;t.finishPoly(),e.updateBatches();let{batches:i}=e;for(let s=0;s<i.length;s++){let{texture:o}=i[s].style;o&&em(r,o.baseTexture)}return e.batchable||r.geometry.bind(e,t._resolveDirectShader(r)),!0}function l0(r,t){return r instanceof Hr?(t.push(r),!0):!1}var Qo=class extends Es{constructor(t){super(t),this.uploadHookHelper=this.renderer,this.registerFindHook(l0),this.registerUploadHook(em),this.registerUploadHook(h0)}};Qo.extension={name:"prepare",type:T.RendererSystem};w.add(Qo);var Jo=class r extends B{constructor(t,e=!0){super(t[0]instanceof b?t[0]:t[0].texture),this._textures=null,this._durations=null,this._autoUpdate=e,this._isConnectedToTicker=!1,this.animationSpeed=1,this.loop=!0,this.updateAnchor=!1,this.onComplete=null,this.onFrameChange=null,this.onLoop=null,this._currentTime=0,this._playing=!1,this._previousFrame=null,this.textures=t}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(st.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(st.shared.add(this.update,this,de.HIGH),this._isConnectedToTicker=!0))}gotoAndStop(t){this.stop(),this.currentFrame=t}gotoAndPlay(t){this.currentFrame=t,this.play()}update(t){if(!this._playing)return;let e=this.animationSpeed*t,i=this.currentFrame;if(this._durations!==null){let s=this._currentTime%1*this._durations[this.currentFrame];for(s+=e/60*1e3;s<0;)this._currentTime--,s+=this._durations[this.currentFrame];let o=Math.sign(this.animationSpeed*t);for(this._currentTime=Math.floor(this._currentTime);s>=this._durations[this.currentFrame];)s-=this._durations[this.currentFrame]*o,this._currentTime+=o;this._currentTime+=s/this._durations[this.currentFrame]}else this._currentTime+=e;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):i!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<i||this.animationSpeed<0&&this.currentFrame>i)&&this.onLoop(),this.updateTexture())}updateTexture(){let t=this.currentFrame;this._previousFrame!==t&&(this._previousFrame=t,this._texture=this._textures[t],this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this.uvs=this._texture._uvs.uvsFloat32,this.updateAnchor&&this._anchor.copyFrom(this._texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))}destroy(t){this.stop(),super.destroy(t),this.onComplete=null,this.onFrameChange=null,this.onLoop=null}static fromFrames(t){let e=[];for(let i=0;i<t.length;++i)e.push(b.from(t[i]));return new r(e)}static fromImages(t){let e=[];for(let i=0;i<t.length;++i)e.push(b.from(t[i]));return new r(e)}get totalFrames(){return this._textures.length}get textures(){return this._textures}set textures(t){if(t[0]instanceof b)this._textures=t,this._durations=null;else{this._textures=[],this._durations=[];for(let e=0;e<t.length;e++)this._textures.push(t[e].texture),this._durations.push(t[e].time)}this._previousFrame=null,this.gotoAndStop(0),this.updateTexture()}get currentFrame(){let t=Math.floor(this._currentTime)%this._textures.length;return t<0&&(t+=this._textures.length),t}set currentFrame(t){if(t<0||t>this.totalFrames-1)throw new Error(`[AnimatedSprite]: Invalid frame index value ${t}, expected to be between 0 and totalFrames ${this.totalFrames}.`);let e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this.updateTexture()}get playing(){return this._playing}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(st.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(st.shared.add(this.update,this),this._isConnectedToTicker=!0))}};var S5=new K;var rm=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`;var im=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`;var sm=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`;var Nu=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`;var om=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`;var Fa=new et,tn=class extends He{constructor(t){super(t),t.runners.contextChange.add(this),this.quad=new ni,this.state=Bt.for2d()}contextChange(){let t=this.renderer,e={globals:t.globalUniforms};this.simpleShader=Gt.from(Nu,om,e),this.shader=t.context.webGLVersion>1?Gt.from(im,rm,e):Gt.from(Nu,sm,e)}render(t){let e=this.renderer,i=this.quad,s=i.vertices;s[0]=s[6]=t._width*-t.anchor.x,s[1]=s[3]=t._height*-t.anchor.y,s[2]=s[4]=t._width*(1-t.anchor.x),s[5]=s[7]=t._height*(1-t.anchor.y);let o=t.uvRespectAnchor?t.anchor.x:0,n=t.uvRespectAnchor?t.anchor.y:0;s=i.uvs,s[0]=s[6]=-o,s[1]=s[3]=-n,s[2]=s[4]=1-o,s[5]=s[7]=1-n,i.invalidate();let a=t._texture,h=a.baseTexture,l=h.alphaMode>0,u=t.tileTransform.localTransform,c=t.uvMatrix,d=h.isPowerOfTwo&&a.frame.width===h.width&&a.frame.height===h.height;d&&(h._glTextures[e.CONTEXT_UID]?d=h.wrapMode!==ye.CLAMP:h.wrapMode===ye.CLAMP&&(h.wrapMode=ye.REPEAT));let p=d?this.simpleShader:this.shader,f=a.width,m=a.height,g=t._width,y=t._height;Fa.set(u.a*f/g,u.b*f/y,u.c*m/g,u.d*m/y,u.tx/g,u.ty/y),Fa.invert(),d?Fa.prepend(c.mapCoord):(p.uniforms.uMapCoord=c.mapCoord.toArray(!0),p.uniforms.uClampFrame=c.uClampFrame,p.uniforms.uClampOffset=c.uClampOffset),p.uniforms.uTransform=Fa.toArray(!0),p.uniforms.uColor=Q.shared.setValue(t.tint).premultiply(t.worldAlpha,l).toArray(p.uniforms.uColor),p.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),p.uniforms.uSampler=a,e.shader.bind(p),e.geometry.bind(i),this.state.blendMode=S.correctBlendMode(t.blendMode,l),e.state.set(this.state),e.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}};tn.extension={name:"tilingSprite",type:T.RendererPlugin};w.add(tn);var nm=class en{constructor(t,e,i=null){this.linkedSheets=[],this._texture=t instanceof b?t:null,this.baseTexture=t instanceof W?t:this._texture.baseTexture,this.textures={},this.animations={},this.data=e;let s=this.baseTexture.resource;this.resolution=this._updateResolution(i||(s?s.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(t=null){let{scale:e}=this.data.meta,i=S.getResolutionOfUrl(t,null);return i===null&&(i=parseFloat(e??"1")),i!==1&&this.baseTexture.setResolution(i),i}parse(){return new Promise(t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=en.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(t){let e=t,i=en.BATCH_SIZE;for(;e-t<i&&e<this._frameKeys.length;){let s=this._frameKeys[e],o=this._frames[s],n=o.frame;if(n){let a=null,h=null,l=o.trimmed!==!1&&o.sourceSize?o.sourceSize:o.frame,u=new z(0,0,Math.floor(l.w)/this.resolution,Math.floor(l.h)/this.resolution);o.rotated?a=new z(Math.floor(n.x)/this.resolution,Math.floor(n.y)/this.resolution,Math.floor(n.h)/this.resolution,Math.floor(n.w)/this.resolution):a=new z(Math.floor(n.x)/this.resolution,Math.floor(n.y)/this.resolution,Math.floor(n.w)/this.resolution,Math.floor(n.h)/this.resolution),o.trimmed!==!1&&o.spriteSourceSize&&(h=new z(Math.floor(o.spriteSourceSize.x)/this.resolution,Math.floor(o.spriteSourceSize.y)/this.resolution,Math.floor(n.w)/this.resolution,Math.floor(n.h)/this.resolution)),this.textures[s]=new b(this.baseTexture,a,u,h,o.rotated?2:0,o.anchor,o.borders),b.addToCache(this.textures[s],s.toString())}e++}}_processAnimations(){let t=this.data.animations||{};for(let e in t){this.animations[e]=[];for(let i=0;i<t[e].length;i++){let s=t[e][i];this.animations[e].push(this.textures[s])}}}_parseComplete(){let t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*en.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*en.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(t=!1){for(let e in this.textures)this.textures[e].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&(this._texture?.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};nm.BATCH_SIZE=1e3;var Da=nm;var u0=["jpg","png","jpeg","avif","webp"];function am(r,t,e){let i={};if(r.forEach(s=>{i[s]=t}),Object.keys(t.textures).forEach(s=>{i[s]=t.textures[s]}),!e){let s=S.path.dirname(r[0]);t.linkedSheets.forEach((o,n)=>{let a=am([`${s}/${t.data.meta.related_multi_packs[n]}`],o,!0);Object.assign(i,a)})}return i}var La={extension:T.Asset,cache:{test:r=>r instanceof Da,getCacheableAssets:(r,t)=>am(r,t,!1)},resolver:{test:r=>{let t=r.split("?")[0].split("."),e=t.pop(),i=t.pop();return e==="json"&&u0.includes(i)},parse:r=>{let t=r.split(".");return{resolution:parseFloat(E.RETINA_PREFIX.exec(r)?.[1]??"1"),format:t[t.length-2],src:r}}},loader:{name:"spritesheetLoader",extension:{type:T.LoadParser,priority:gt.Normal},async testParse(r,t){return S.path.extname(t.src).toLowerCase()===".json"&&!!r.frames},async parse(r,t,e){let i=S.path.dirname(t.src);i&&i.lastIndexOf("/")!==i.length-1&&(i+="/");let s=i+r.meta.image;s=pi(s,t.src);let o=(await e.load([s]))[s],n=new Da(o.baseTexture,r,t.src);await n.parse();let a=r?.meta?.related_multi_packs;if(Array.isArray(a)){let h=[];for(let u of a){if(typeof u!="string")continue;let c=i+u;t.data?.ignoreMultiPack||(c=pi(c,t.src),h.push(e.load({src:c,data:{ignoreMultiPack:!0}})))}let l=await Promise.all(h);n.linkedSheets=l,l.forEach(u=>{u.linkedSheets=[n].concat(n.linkedSheets.filter(c=>c!==u))})}return n},unload(r){r.destroy(!0)}}};w.add(La);var or=class{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}};var Er=class{static test(t){return typeof t=="string"&&t.startsWith("info face=")}static parse(t){let e=t.match(/^[a-z]+\s+.+$/gm),i={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(let o in e){let n=e[o].match(/^[a-z]+/gm)[0],a=e[o].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),h={};for(let l in a){let u=a[l].split("="),c=u[0],d=u[1].replace(/"/gm,""),p=parseFloat(d),f=isNaN(p)?d:p;h[c]=f}i[n].push(h)}let s=new or;return i.info.forEach(o=>s.info.push({face:o.face,size:parseInt(o.size,10)})),i.common.forEach(o=>s.common.push({lineHeight:parseInt(o.lineHeight,10)})),i.page.forEach(o=>s.page.push({id:parseInt(o.id,10),file:o.file})),i.char.forEach(o=>s.char.push({id:parseInt(o.id,10),page:parseInt(o.page,10),x:parseInt(o.x,10),y:parseInt(o.y,10),width:parseInt(o.width,10),height:parseInt(o.height,10),xoffset:parseInt(o.xoffset,10),yoffset:parseInt(o.yoffset,10),xadvance:parseInt(o.xadvance,10)})),i.kerning.forEach(o=>s.kerning.push({first:parseInt(o.first,10),second:parseInt(o.second,10),amount:parseInt(o.amount,10)})),i.distanceField.forEach(o=>s.distanceField.push({distanceRange:parseInt(o.distanceRange,10),fieldType:o.fieldType})),s}};var Wr=class{static test(t){let e=t;return typeof t!="string"&&"getElementsByTagName"in t&&e.getElementsByTagName("page").length&&e.getElementsByTagName("info")[0].getAttribute("face")!==null}static parse(t){let e=new or,i=t.getElementsByTagName("info"),s=t.getElementsByTagName("common"),o=t.getElementsByTagName("page"),n=t.getElementsByTagName("char"),a=t.getElementsByTagName("kerning"),h=t.getElementsByTagName("distanceField");for(let l=0;l<i.length;l++)e.info.push({face:i[l].getAttribute("face"),size:parseInt(i[l].getAttribute("size"),10)});for(let l=0;l<s.length;l++)e.common.push({lineHeight:parseInt(s[l].getAttribute("lineHeight"),10)});for(let l=0;l<o.length;l++)e.page.push({id:parseInt(o[l].getAttribute("id"),10)||0,file:o[l].getAttribute("file")});for(let l=0;l<n.length;l++){let u=n[l];e.char.push({id:parseInt(u.getAttribute("id"),10),page:parseInt(u.getAttribute("page"),10)||0,x:parseInt(u.getAttribute("x"),10),y:parseInt(u.getAttribute("y"),10),width:parseInt(u.getAttribute("width"),10),height:parseInt(u.getAttribute("height"),10),xoffset:parseInt(u.getAttribute("xoffset"),10),yoffset:parseInt(u.getAttribute("yoffset"),10),xadvance:parseInt(u.getAttribute("xadvance"),10)})}for(let l=0;l<a.length;l++)e.kerning.push({first:parseInt(a[l].getAttribute("first"),10),second:parseInt(a[l].getAttribute("second"),10),amount:parseInt(a[l].getAttribute("amount"),10)});for(let l=0;l<h.length;l++)e.distanceField.push({fieldType:h[l].getAttribute("fieldType"),distanceRange:parseInt(h[l].getAttribute("distanceRange"),10)});return e}};var zr=class{static test(t){return typeof t=="string"&&t.includes("<font>")?Wr.test(E.ADAPTER.parseXML(t)):!1}static parse(t){return Wr.parse(E.ADAPTER.parseXML(t))}};var ku=[Er,Wr,zr];function Uu(r){for(let t=0;t<ku.length;t++)if(ku[t].test(r))return ku[t];return null}function Gu(r,t,e,i,s,o){let n=e.fill;if(Array.isArray(n)){if(n.length===1)return n[0]}else return n;let a,h=e.dropShadow?e.dropShadowDistance:0,l=e.padding||0,u=r.width/i-h-l*2,c=r.height/i-h-l*2,d=n.slice(),p=e.fillGradientStops.slice();if(!p.length){let f=d.length+1;for(let m=1;m<f;++m)p.push(m/f)}if(d.unshift(n[0]),p.unshift(0),d.push(n[n.length-1]),p.push(1),e.fillGradientType===Xr.LINEAR_VERTICAL){a=t.createLinearGradient(u/2,l,u/2,c+l);let f=0,m=(o.fontProperties.fontSize+e.strokeThickness)/c;for(let g=0;g<s.length;g++){let y=o.lineHeight*g;for(let v=0;v<d.length;v++){let _=0;typeof p[v]=="number"?_=p[v]:_=v/d.length;let x=y/c+_*m,M=Math.max(f,x);M=Math.min(M,1),a.addColorStop(M,d[v]),f=M}}}else{a=t.createLinearGradient(l,c/2,u+l,c/2);let f=d.length+1,m=1;for(let g=0;g<d.length;g++){let y;typeof p[g]=="number"?y=p[g]:y=m/f,a.addColorStop(y,d[g]),m++}}return a}function Hu(r,t,e,i,s,o,n){let a=e.text,h=e.fontProperties;t.translate(i,s),t.scale(o,o);let l=n.strokeThickness/2,u=-(n.strokeThickness/2);if(t.font=n.toFontString(),t.lineWidth=n.strokeThickness,t.textBaseline=n.textBaseline,t.lineJoin=n.lineJoin,t.miterLimit=n.miterLimit,t.fillStyle=Gu(r,t,n,o,[a],e),t.strokeStyle=n.stroke,n.dropShadow){let c=n.dropShadowColor,d=n.dropShadowBlur*o,p=n.dropShadowDistance*o;t.shadowColor=Q.shared.setValue(c).setAlpha(n.dropShadowAlpha).toRgbaString(),t.shadowBlur=d,t.shadowOffsetX=Math.cos(n.dropShadowAngle)*p,t.shadowOffsetY=Math.sin(n.dropShadowAngle)*p}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0;n.stroke&&n.strokeThickness&&t.strokeText(a,l,u+e.lineHeight-h.descent),n.fill&&t.fillText(a,l,u+e.lineHeight-h.descent),t.setTransform(1,0,0,1,0,0),t.fillStyle="rgba(0, 0, 0, 0)"}function bi(r){return r.codePointAt?r.codePointAt(0):r.charCodeAt(0)}function rn(r){return Array.from?Array.from(r):r.split("")}function Vu(r){typeof r=="string"&&(r=[r]);let t=[];for(let e=0,i=r.length;e<i;e++){let s=r[e];if(Array.isArray(s)){if(s.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${s.length}.`);let o=s[0].charCodeAt(0),n=s[1].charCodeAt(0);if(n<o)throw new Error("[BitmapFont]: Invalid character range.");for(let a=o,h=n;a<=h;a++)t.push(String.fromCharCode(a))}else t.push(...rn(s))}if(t.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}var jr=class nr{constructor(t,e,i){let[s]=t.info,[o]=t.common,[n]=t.page,[a]=t.distanceField,h=S.getResolutionOfUrl(n.file),l={};this._ownsTextures=i,this.font=s.face,this.size=s.size,this.lineHeight=o.lineHeight/h,this.chars={},this.pageTextures=l;for(let u=0;u<t.page.length;u++){let{id:c,file:d}=t.page[u];l[c]=e instanceof Array?e[u]:e[d],a?.fieldType&&a.fieldType!=="none"&&(l[c].baseTexture.alphaMode=xt.NO_PREMULTIPLIED_ALPHA,l[c].baseTexture.mipmap=Ut.OFF)}for(let u=0;u<t.char.length;u++){let{id:c,page:d}=t.char[u],{x:p,y:f,width:m,height:g,xoffset:y,yoffset:v,xadvance:_}=t.char[u];p/=h,f/=h,m/=h,g/=h,y/=h,v/=h,_/=h;let x=new z(p+l[d].frame.x/h,f+l[d].frame.y/h,m,g);this.chars[c]={xOffset:y,yOffset:v,xAdvance:_,kerning:{},texture:new b(l[d].baseTexture,x),page:d}}for(let u=0;u<t.kerning.length;u++){let{first:c,second:d,amount:p}=t.kerning[u];c/=h,d/=h,p/=h,this.chars[d]&&(this.chars[d].kerning[c]=p)}this.distanceFieldRange=a?.distanceRange,this.distanceFieldType=a?.fieldType?.toLowerCase()??"none"}destroy(){for(let t in this.chars)this.chars[t].texture.destroy(),this.chars[t].texture=null;for(let t in this.pageTextures)this._ownsTextures&&this.pageTextures[t].destroy(!0),this.pageTextures[t]=null;this.chars=null,this.pageTextures=null}static install(t,e,i){let s;if(t instanceof or)s=t;else{let n=Uu(t);if(!n)throw new Error("Unrecognized data format for font.");s=n.parse(t)}e instanceof b&&(e=[e]);let o=new nr(s,e,i);return nr.available[o.font]=o,o}static uninstall(t){let e=nr.available[t];if(!e)throw new Error(`No font found named '${t}'`);e.destroy(),delete nr.available[t]}static from(t,e,i){if(!t)throw new Error("[BitmapFont] Property `name` is required.");let{chars:s,padding:o,resolution:n,textureWidth:a,textureHeight:h,...l}=Object.assign({},nr.defaultOptions,i),u=Vu(s),c=e instanceof me?e:new me(e),d=a,p=new or;p.info[0]={face:c.fontFamily,size:c.fontSize},p.common[0]={lineHeight:c.fontSize};let f=0,m=0,g,y,v,_=0,x=[],M=[];for(let I=0;I<u.length;I++){g||(g=E.ADAPTER.createCanvas(),g.width=a,g.height=h,y=g.getContext("2d"),v=new W(g,{resolution:n,...l}),x.push(v),M.push(new b(v)),p.page.push({id:M.length-1,file:""}));let R=u[I],N=Oe.measureText(R,c,!1,g),q=N.width,D=Math.ceil(N.height),F=Math.ceil((c.fontStyle==="italic"?2:1)*q);if(m>=h-D*n){if(m===0)throw new Error(`[BitmapFont] textureHeight ${h}px is too small (fontFamily: '${c.fontFamily}', fontSize: ${c.fontSize}px, char: '${R}')`);--I,g=null,y=null,v=null,m=0,f=0,_=0;continue}if(_=Math.max(D+N.fontProperties.descent,_),F*n+f>=d){if(f===0)throw new Error(`[BitmapFont] textureWidth ${a}px is too small (fontFamily: '${c.fontFamily}', fontSize: ${c.fontSize}px, char: '${R}')`);--I,m+=_*n,m=Math.ceil(m),f=0,_=0;continue}Hu(g,y,N,f,m,n,c);let A=bi(N.text);p.char.push({id:A,page:M.length-1,x:f/n,y:m/n,width:F,height:D,xoffset:0,yoffset:0,xadvance:q-(c.dropShadow?c.dropShadowDistance:0)-(c.stroke?c.strokeThickness:0)}),f+=(F+2*o)*n,f=Math.ceil(f)}if(!i?.skipKerning)for(let I=0,R=u.length;I<R;I++){let N=u[I];for(let q=0;q<R;q++){let D=u[q],F=y.measureText(N).width,A=y.measureText(D).width,C=y.measureText(N+D).width-(F+A);C&&p.kerning.push({first:bi(N),second:bi(D),amount:C})}}let G=new nr(p,M,!0);return nr.available[t]!==void 0&&nr.uninstall(t),nr.available[t]=G,G}};jr.ALPHA=[["a","z"],["A","Z"]," "],jr.NUMERIC=[["0","9"]],jr.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],jr.ASCII=[[" ","~"]],jr.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:jr.ALPHANUMERIC},jr.available={};var $e=jr;var hm=`// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
  if (median < 0.01) {\r
    alpha = 0.0;\r
  } else if (median > 0.99) {\r
    alpha = 1.0;\r
  }\r
\r
  // Gamma correction for coverage-like alpha\r
  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r
  float gamma = mix(1.0, 1.0 / 2.2, luma);\r
  float coverage = pow(uColor.a * alpha, gamma);  \r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, coverage);\r
}\r
`;var lm=`// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`;var um=[],cm=[],dm=[],c0=class pm extends O{constructor(t,e={}){super();let{align:i,tint:s,maxWidth:o,letterSpacing:n,fontName:a,fontSize:h}=Object.assign({},pm.styleDefaults,e);if(!$e.available[a])throw new Error(`Missing BitmapFont "${a}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=i,this._tintColor=new Q(s),this._font=void 0,this._fontName=a,this._fontSize=h,this.text=t,this._maxWidth=o,this._maxLineHeight=0,this._letterSpacing=n,this._anchor=new be(()=>{this.dirty=!0},this,0,0),this._roundPixels=E.ROUND_PIXELS,this.dirty=!0,this._resolution=E.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){let t=$e.available[this._fontName],e=this.fontSize,i=e/t.size,s=new K,o=[],n=[],a=[],h=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",l=rn(h),u=this._maxWidth*t.size/e,c=t.distanceFieldType==="none"?um:cm,d=null,p=0,f=0,m=0,g=-1,y=0,v=0,_=0,x=0;for(let D=0;D<l.length;D++){let F=l[D],A=bi(F);if(/(?:\s)/.test(F)&&(g=D,y=p,x++),F==="\r"||F===`
`){n.push(p),a.push(-1),f=Math.max(f,p),++m,++v,s.x=0,s.y+=t.lineHeight,d=null,x=0;continue}let C=t.chars[A];if(!C)continue;d&&C.kerning[d]&&(s.x+=C.kerning[d]);let J=dm.pop()||{texture:b.EMPTY,line:0,charCode:0,prevSpaces:0,position:new K};J.texture=C.texture,J.line=m,J.charCode=A,J.position.x=Math.round(s.x+C.xOffset+this._letterSpacing/2),J.position.y=Math.round(s.y+C.yOffset),J.prevSpaces=x,o.push(J),p=J.position.x+Math.max(C.xAdvance-C.xOffset,C.texture.orig.width),s.x+=C.xAdvance+this._letterSpacing,_=Math.max(_,C.yOffset+C.texture.height),d=A,g!==-1&&u>0&&s.x>u&&(++v,S.removeItems(o,1+g-v,1+D-g),D=g,g=-1,n.push(y),a.push(o.length>0?o[o.length-1].prevSpaces:0),f=Math.max(f,y),m++,s.x=0,s.y+=t.lineHeight,d=null,x=0)}let M=l[l.length-1];M!=="\r"&&M!==`
`&&(/(?:\s)/.test(M)&&(p=y),n.push(p),f=Math.max(f,p),a.push(-1));let G=[];for(let D=0;D<=m;D++){let F=0;this._align==="right"?F=f-n[D]:this._align==="center"?F=(f-n[D])/2:this._align==="justify"&&(F=a[D]<0?0:(f-n[D])/a[D]),G.push(F)}let I=o.length,R={},N=[],q=this._activePagesMeshData;c.push(...q);for(let D=0;D<I;D++){let F=o[D].texture,A=F.baseTexture.uid;if(!R[A]){let C=c.pop();if(!C){let rt=new Vr,X,L;t.distanceFieldType==="none"?(X=new Tr(b.EMPTY),L=Y.NORMAL):(X=new Tr(b.EMPTY,{program:qt.from(lm,hm),uniforms:{uFWidth:0}}),L=Y.NORMAL_NPM);let j=new vi(rt,X);j.blendMode=L,C={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:j,vertices:null,uvs:null,indices:null}}C.index=0,C.indexCount=0,C.vertexCount=0,C.uvsCount=0,C.total=0;let{_textureCache:J}=this;J[A]=J[A]||new b(F.baseTexture),C.mesh.texture=J[A],C.mesh.tint=this._tintColor.value,N.push(C),R[A]=C}R[A].total++}for(let D=0;D<q.length;D++)N.includes(q[D])||this.removeChild(q[D].mesh);for(let D=0;D<N.length;D++)N[D].mesh.parent!==this&&this.addChild(N[D].mesh);this._activePagesMeshData=N;for(let D in R){let F=R[D],A=F.total;if(!(F.indices?.length>6*A)||F.vertices.length<vi.BATCHABLE_SIZE*2)F.vertices=new Float32Array(4*2*A),F.uvs=new Float32Array(4*2*A),F.indices=new Uint16Array(6*A);else{let C=F.total,J=F.vertices;for(let rt=C*4*2;rt<J.length;rt++)J[rt]=0}F.mesh.size=6*A}for(let D=0;D<I;D++){let F=o[D],A=F.position.x+G[F.line]*(this._align==="justify"?F.prevSpaces:1);this._roundPixels&&(A=Math.round(A));let C=A*i,J=F.position.y*i,rt=F.texture,X=R[rt.baseTexture.uid],L=rt.frame,j=rt._uvs,H=X.index++;X.indices[H*6+0]=0+H*4,X.indices[H*6+1]=1+H*4,X.indices[H*6+2]=2+H*4,X.indices[H*6+3]=0+H*4,X.indices[H*6+4]=2+H*4,X.indices[H*6+5]=3+H*4,X.vertices[H*8+0]=C,X.vertices[H*8+1]=J,X.vertices[H*8+2]=C+L.width*i,X.vertices[H*8+3]=J,X.vertices[H*8+4]=C+L.width*i,X.vertices[H*8+5]=J+L.height*i,X.vertices[H*8+6]=C,X.vertices[H*8+7]=J+L.height*i,X.uvs[H*8+0]=j.x0,X.uvs[H*8+1]=j.y0,X.uvs[H*8+2]=j.x1,X.uvs[H*8+3]=j.y1,X.uvs[H*8+4]=j.x2,X.uvs[H*8+5]=j.y2,X.uvs[H*8+6]=j.x3,X.uvs[H*8+7]=j.y3}this._textWidth=f*i,this._textHeight=(s.y+t.lineHeight)*i;for(let D in R){let F=R[D];if(this.anchor.x!==0||this.anchor.y!==0){let rt=0,X=this._textWidth*this.anchor.x,L=this._textHeight*this.anchor.y;for(let j=0;j<F.total;j++)F.vertices[rt++]-=X,F.vertices[rt++]-=L,F.vertices[rt++]-=X,F.vertices[rt++]-=L,F.vertices[rt++]-=X,F.vertices[rt++]-=L,F.vertices[rt++]-=X,F.vertices[rt++]-=L}this._maxLineHeight=_*i;let A=F.mesh.geometry.getBuffer("aVertexPosition"),C=F.mesh.geometry.getBuffer("aTextureCoord"),J=F.mesh.geometry.getIndex();A.data=F.vertices,C.data=F.uvs,J.data=F.indices,A.update(),C.update(),J.update()}for(let D=0;D<o.length;D++)dm.push(o[D]);this._font=t,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0);let{distanceFieldRange:e,distanceFieldType:i,size:s}=$e.available[this._fontName];if(i!=="none"){let{a:o,b:n,c:a,d:h}=this.worldTransform,l=Math.sqrt(o*o+n*n),u=Math.sqrt(a*a+h*h),c=(Math.abs(l)+Math.abs(u))/2,d=this.fontSize/s,p=t._view.resolution;for(let f of this._activePagesMeshData)f.mesh.shader.uniforms.uFWidth=c*e*d*p}super._render(t)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){let t=$e.available[this._fontName];if(!t)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==t&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(t){if(this.tint!==t){this._tintColor.setValue(t);for(let e=0;e<this._activePagesMeshData.length;e++)this._activePagesMeshData[e].mesh.tint=t}}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.dirty=!0)}get fontName(){return this._fontName}set fontName(t){if(!$e.available[t])throw new Error(`Missing BitmapFont "${t}"`);this._fontName!==t&&(this._fontName=t,this.dirty=!0)}get fontSize(){return this._fontSize??$e.available[this._fontName].size}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.dirty=!0)}get anchor(){return this._anchor}set anchor(t){typeof t=="number"?this._anchor.set(t):this._anchor.copyFrom(t)}get text(){return this._text}set text(t){t=String(t??""),this._text!==t&&(this._text=t,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(t){t!==this._roundPixels&&(this._roundPixels=t,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}destroy(t){let{_textureCache:e}=this,i=$e.available[this._fontName].distanceFieldType==="none"?um:cm;i.push(...this._activePagesMeshData);for(let s of this._activePagesMeshData)this.removeChild(s.mesh);this._activePagesMeshData=[],i.filter(s=>e[s.mesh.texture.baseTexture.uid]).forEach(s=>{s.mesh.texture=b.EMPTY});for(let s in e)e[s].destroy(),delete e[s];this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(t)}};c0.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};var d0=[".xml",".fnt"],fm={extension:{type:T.LoadParser,priority:gt.Normal},name:"loadBitmapFont",test(r){return d0.includes(S.path.extname(r).toLowerCase())},async testParse(r){return Er.test(r)||zr.test(r)},async parse(r,t,e){let i=Er.test(r)?Er.parse(r):zr.parse(r),{src:s}=t,{page:o}=i,n=[];for(let l=0;l<o.length;++l){let u=o[l].file,c=S.path.join(S.path.dirname(s),u);c=pi(c,s),n.push(c)}let a=await e.load(n),h=n.map(l=>a[l]);return $e.install(i,h,!0)},async load(r,t){return(await E.ADAPTER.fetch(r)).text()},unload(r){r.destroy()}};w.add(fm);var Xu=class ws extends me{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(t){return new ws(Object.keys(ws.defaultOptions).reduce((e,i)=>({...e,[i]:t[i]}),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach(t=>{URL.revokeObjectURL(t.src),t.refs--,t.refs===0&&(t.fontFace&&document.fonts.delete(t.fontFace),delete ws.availableFonts[t.originalUrl])}),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(t,e={}){let{availableFonts:i}=ws;if(i[t]){let s=i[t];return this._fonts.push(s),s.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return E.ADAPTER.fetch(t).then(s=>s.blob()).then(async s=>new Promise((o,n)=>{let a=URL.createObjectURL(s),h=new FileReader;h.onload=()=>o([a,h.result]),h.onerror=n,h.readAsDataURL(s)})).then(async([s,o])=>{let n=Object.assign({family:S.path.basename(t,S.path.extname(t)),weight:"normal",style:"normal",display:"auto",src:s,dataSrc:o,refs:1,originalUrl:t,fontFace:null},e);i[t]=n,this._fonts.push(n),this.styleID++;let a=new FontFace(n.family,`url(${n.src})`,{weight:n.weight,style:n.style,display:n.display});n.fontFace=a,await a.load(),document.fonts.add(a),await document.fonts.ready,this.styleID++,this.fontsDirty=!0})}addOverride(...t){let e=t.filter(i=>!this._overrides.includes(i));e.length>0&&(this._overrides.push(...e),this.styleID++)}removeOverride(...t){let e=t.filter(i=>this._overrides.includes(i));e.length>0&&(this._overrides=this._overrides.filter(i=>!e.includes(i)),this.styleID++)}toCSS(t){return[`transform: scale(${t})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?[`word-wrap: ${this.breakWords?"break-all":"break-word"}`,`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce((t,e)=>`${t}
            @font-face {
                font-family: "${e.family}";
                src: url('${e.dataSrc}');
                font-weight: ${e.weight};
                font-style: ${e.style};
                font-display: ${e.display};
            }`,this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(t){this._stylesheet!==t&&(this._stylesheet=t,this.styleID++)}normalizeColor(t){return Array.isArray(t)&&(t=S.rgb2hex(t)),typeof t=="number"?S.hex2string(t):t}dropShadowToCSS(){let t=this.normalizeColor(this.dropShadowColor),e=this.dropShadowAlpha,i=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),s=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);t.startsWith("#")&&e<1&&(t+=(e*255|0).toString(16).padStart(2,"0"));let o=`${i}px ${s}px`;return this.dropShadowBlur>0?`text-shadow: ${o} ${this.dropShadowBlur}px ${t}`:`text-shadow: ${o} ${t}`}reset(){Object.assign(this,ws.defaultOptions)}onBeforeDraw(){let{fontsDirty:t}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&t?new Promise(e=>setTimeout(e,100)):Promise.resolve()}get isSafari(){let{userAgent:t}=E.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(t)}set fillGradientStops(t){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(t){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(t){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(t){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(t){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(t){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(t){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}};Xu.availableFonts={},Xu.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};var sn=Xu;var Oa=class Ss extends B{constructor(t="",e={}){super(b.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this.localStyleID=-1,this.dirty=!1,this._updateID=0,this.ownsStyle=!1;let i=new Image,s=b.from(i,{scaleMode:E.SCALE_MODE,resourceOptions:{autoLoad:!1}});s.orig=new z,s.trim=new z,this.texture=s;let o="http://www.w3.org/2000/svg",n="http://www.w3.org/1999/xhtml",a=document.createElementNS(o,"svg"),h=document.createElementNS(o,"foreignObject"),l=document.createElementNS(n,"div"),u=document.createElementNS(n,"style");h.setAttribute("width","10000"),h.setAttribute("height","10000"),h.style.overflow="hidden",a.appendChild(h),this.maxWidth=Ss.defaultMaxWidth,this.maxHeight=Ss.defaultMaxHeight,this._domElement=l,this._styleElement=u,this._svgRoot=a,this._foreignObject=h,this._foreignObject.appendChild(u),this._foreignObject.appendChild(l),this._image=i,this._loadImage=new Image,this._autoResolution=Ss.defaultAutoResolution,this._resolution=Ss.defaultResolution??E.RESOLUTION,this.text=t,this.style=e}measureText(t){let{text:e,style:i,resolution:s}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},t);Object.assign(this._domElement,{innerHTML:e,style:i.toCSS(s)}),this._styleElement.textContent=i.toGlobalCSS(),document.body.appendChild(this._svgRoot);let o=this._domElement.getBoundingClientRect();this._svgRoot.remove();let{width:n,height:a}=o;(n>this.maxWidth||a>this.maxHeight)&&console.warn("[HTMLText] Large expanse of text, increase HTMLText.maxWidth or HTMLText.maxHeight property.");let h=Math.min(this.maxWidth,Math.ceil(n)),l=Math.min(this.maxHeight,Math.ceil(a));return this._svgRoot.setAttribute("width",h.toString()),this._svgRoot.setAttribute("height",l.toString()),e!==this._text&&(this._domElement.innerHTML=this._text),i!==this._style&&(Object.assign(this._domElement,{style:this._style?.toCSS(s)}),this._styleElement.textContent=this._style?.toGlobalCSS()),{width:h+i.padding*2,height:l+i.padding*2}}async updateText(t=!0){let{style:e,_image:i,_loadImage:s}=this;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;let{width:o,height:n}=this.measureText();i.width=s.width=Math.ceil(Math.max(1,o)),i.height=s.height=Math.ceil(Math.max(1,n)),this._updateID++;let a=this._updateID;await new Promise(h=>{s.onload=async()=>{if(a<this._updateID){h();return}await e.onBeforeDraw(),i.src=s.src,s.onload=null,s.src="",this.updateTexture(),h()};let l=new XMLSerializer().serializeToString(this._svgRoot);s.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(l)}`})}get source(){return this._image}updateTexture(){let{style:t,texture:e,_image:i,resolution:s}=this,{padding:o}=t,{baseTexture:n}=e;e.trim.width=e._frame.width=i.width/s,e.trim.height=e._frame.height=i.height/s,e.trim.x=-o,e.trim.y=-o,e.orig.width=e._frame.width-o*2,e.orig.height=e._frame.height-o*2,this._onTextureUpdate(),n.setRealSize(i.width,i.height,s),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}_renderCanvas(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(t)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds(t)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(t){typeof t=="boolean"&&(t={children:t}),t=Object.assign({},Ss.defaultDestroyOptions,t),super.destroy(t);let e=null;this.ownsStyle&&this._style?.cleanFonts(),this._style=e,this._svgRoot?.remove(),this._svgRoot=e,this._domElement?.remove(),this._domElement=e,this._foreignObject?.remove(),this._foreignObject=e,this._styleElement?.remove(),this._styleElement=e,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=e,this._image.src="",this._image=e}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(t){this.updateText(!0);let e=S.sign(this.scale.x)||1;this.scale.x=e*t/this._image.width/this.resolution,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(t){this.updateText(!0);let e=S.sign(this.scale.y)||1;this.scale.y=e*t/this._image.height/this.resolution,this._height=t}get style(){return this._style}set style(t){this._style!==t&&(t=t||{},t instanceof sn?(this.ownsStyle=!1,this._style=t):t instanceof me?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=sn.from(t)):(this.ownsStyle=!0,this._style=new sn(t)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(t){t=String(t===""||t===null||t===void 0?" ":t),t=this.sanitiseText(t),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}sanitiseText(t){return t.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};Oa.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},Oa.defaultMaxWidth=2024,Oa.defaultMaxHeight=2024,Oa.defaultAutoResolution=!0;var on=class extends fe{side;level;constructor(t,e,i){super(t,new Lt(()=>{let s=new B(b.from(kr[i].projectile));return s.anchor.set(.5),s},fe.resetProjectile,fe.destroyProjectile)),this.level=i,this.side=e,this.body.texture=b.from("Weapon-Side"),this.body.anchor.set(.5),this.body.scale.set(.5),e=="Right"&&(this.body.scale.x*=-1),this.body.visible=this.level!=0}fire(){if(console.log(this.level),this.level==0)return;super.fire();let t=this.projectiles.getInstance();t.position.set(this.side=="Left"?18:-18,-20),this.onFire.dispatch([t])}upgrade(t){this.level=t,this.body.visible=this.level!=0}};var p0={maxHealth:100,baseHealth:45},As=class extends Nr{leftGun;mainGun;rightGun;guns=[];constructor(t,e){super(),console.log(`Car ${t}, upgrades`,e);let i=`Player-Car-${t+1}`;this.body=new B(b.from(i)),this.body.anchor.set(.5),this.mainGun=new fs({firePeriodMS:150},e.damage),this.guns.push(this.mainGun),this.resetHP(e.armor),this.addChild(this.body),this.addChild(this.mainGun.body),this.addChild(this.mainGun.flashes),this.addSideGuns(e.guns)}addSideGuns(t){this.leftGun=new on({},"Left",t),this.rightGun=new on({},"Right",t),this.leftGun.body.x=-this.body.width/2,this.rightGun.body.x=this.body.width/2,this.guns.push(this.leftGun),this.guns.push(this.rightGun),this.addChild(this.leftGun.body),this.addChild(this.leftGun.flashes),this.addChild(this.rightGun.body),this.addChild(this.rightGun.flashes)}resetHP(t){this.health=this.getMaxHealth(t)}getMaxHealth(t){return p0.baseHealth+t*4}updateGuns(t){this.guns.forEach(e=>e.update(t))}setFiringPermission(t){this.guns.forEach(e=>e.canFire=t)}};var Wu={en:{Race:"Race"},ru:{Race:"\u0413\u043E\u043D\u043A\u0430"}};var nt=class r{static locale="en";static font="rajdhani";static setLocale(t){Object.keys(Wu).includes(t)&&(r.locale=t),r.locale=="ru"&&(r.font="rubik")}static getText(t){return Wu[r.locale][t]||t}};var ne=new Ze.default;var kt=class extends O{bg;text;constructor(t,e,i){super(),this.bg=new B(e||b.WHITE),this.bg.anchor.set(.5),this.eventMode="static",this.on("pointerdown",()=>ne.emit("BUTTON_PRESS")),this.text=new ct(t,i),this.text.style.align="center",this.text.anchor.set(.5),this.addChild(this.bg),this.addChild(this.text)}};var Ee=class extends O{type;text;constructor(t){super(),this.type=t;let e=new B(b.from("panel-currency")),i=new B(this.getIconTexture(this.type));this.text=new ct("0",{fontFamily:nt.font,fontSize:42,fill:16777215}),this.text.y=-1,i.position.set(-e.width/2,-3),[e,i,this.text].forEach(s=>{s.anchor.set(.5)}),this.addChild(e),this.addChild(i),this.addChild(this.text)}updateValue(t){this.text.text=t.toString()}getIconTexture(t){switch(t){case"Money":return b.from("icon-money")}}};var Cs=class extends B{constructor(t){super(b.from(t,{scaleMode:ue.NEAREST})),this.anchor.set(.5,0),this.scale.set(V.width/this.texture.width+4,1)}};var m0=10,Na=class extends O{bg;marks;constructor(t){super(),this.bg=new B(b.from("panel-upgrade")),this.bg.anchor.set(.5),this.addChild(this.bg),this.marks=[];let e=this.bg.getBounds().left+5;for(let i=0;i<m0;i++){let s=new B(b.from("upgrade-mark"));s.anchor.set(.5),s.x=e+s.width/2+i*(s.width+8),this.marks.push(s),this.addChild(s)}this.setLevel(t)}setLevel(t){this.marks.forEach((e,i)=>{e.visible=i<t})}};var mm=["armor","damage","guns"],ka={armor:{color:"blue",name:"Armor",basePrice:[50,70,90,110,160,180,230,290,360,550],priceWeight:1},damage:{color:"orange",name:"Machine gun",basePrice:[80,120,150,170,250,290,370,460,580,870],priceWeight:1.6},guns:{color:"purple",name:"Extra guns",basePrice:[60,90,120,140,190,230,290,360,450,680],priceWeight:1.25}},zu={total:[0,7800,29200],coefs:[.07,.15,.25,.38,.54,.75,1,1.3,1.7,2.3]},Ua=class extends O{kind;level;state;bg;label;button;icon;progressBar;maxedText;price;onPress;constructor(t,e,i){super(),this.state="default",this.kind=e,this.level=i;let s=ka[e];this.onPress=new Fe,this.bg=new B(b.from(`box-${s.color}`)),this.bg.anchor.set(.5),this.label=new ct(nt.getText(s.name).toUpperCase(),{fontFamily:nt.font,fontSize:48,fill:16777215}),this.label.anchor.set(.5),this.label.y=-205,this.icon=new B(b.from(`icon-${e}`)),this.icon.anchor.set(.5),this.icon.y=-50,this.progressBar=new Na(this.level),this.progressBar.y=100,this.button=new kt("",b.from("btn-orange-2")),this.price=new Ee("Money"),this.price.text.style.fontSize=48,this.price.x+=10,this.button.addChild(this.price),this.setupButtonAction(t),this.maxedText=new ct(nt.getText("Max"),{fontFamily:nt.font,fill:16777215,fontSize:54}),this.maxedText.anchor.set(.5),this.button.addChild(this.maxedText),this.maxedText.visible=!1,this.button.y=190,this.setLevel(t,this.level),this.addChild(this.bg),this.addChild(this.label),this.addChild(this.icon),this.addChild(this.progressBar),this.addChild(this.button)}increaseLevel(t){this.setLevel(t,++this.level)}setLevel(t,e){this.level=e;let i=ka[this.kind].basePrice.length;this.level<i?(this.state=="maxed"&&(this.button.bg.visible=!0,this.state="default",this.button.addChild(this.price),this.maxedText.visible=!1,this.setupButtonAction(t)),this.price.updateValue(this.getPrice(t,this.level))):this.state!="maxed"&&(this.button.removeAllListeners(),this.button.removeChild(this.price),this.button.bg.visible=!1,this.maxedText.visible=!0,this.state="maxed"),this.progressBar.setLevel(e)}setupButtonAction(t){this.button.on("pointerdown",()=>{this.onPress.dispatch({kind:this.kind,price:this.getPrice(t,this.level)})})}getPrice(t,e){let i=ka[this.kind];if(t==0)return i.basePrice[e];let s=zu.total[t],o=Math.round(s*zu.coefs[e]/100)*100;e>0&&(o-=s*zu.coefs[e-1]),o=Math.round(o/100)*100;let n=Object.values(ka).map(h=>h.priceWeight).reduce((h,l)=>h+l);return Math.round(o*i.priceWeight/n/10)*10}};function Ga(){return new kt(nt.getText("Race").toUpperCase(),b.from("btn-orange"),{fontFamily:nt.font,fontSize:96,fill:8928518})}var nn={carSkins:["Player-Car-1","Player-Car-2","Player-Car-3"],carPrices:[0,1e4,3e4]},Ha=class extends O{game;progress;bg;bottomShadow;playerCar;selectedCarId;btnBack;moneyCounter;btnNextCar;btnPrevCar;btnSelectCar;upgrades;btnPurchaseCar;carPurchasePrice;btnStartRace;constructor(t,e){super(),this.game=t,this.progress=e,this.bg=new B(b.from("garage")),this.bg.scale.set(V.height/this.bg.height),this.bg.anchor.x=.5,this.bg.x=V.width/2,this.bottomShadow=new Cs("shadow-blue"),this.selectedCarId=e.data.selectedCar,this.playerCar=new As(this.selectedCarId,this.progress.getCarUpgrades(this.selectedCarId)),this.playerCar.scale.set(2),this.btnBack=new kt("",b.from("btn-back")),this.btnBack.on("pointerdown",()=>{this.progress.data.cars.find(i=>i.id==this.selectedCarId)?.unlocked&&(this.progress.data.selectedCar=this.selectedCarId,this.progress.saveLocal()),this.game.audio.playSound("ui_menu_whoosh"),ne.emit("START_MENU")}),this.moneyCounter=new Ee("Money"),this.moneyCounter.updateValue(e.data.money),this.btnPrevCar=new kt("",b.from("btn-arrow")),this.btnPrevCar.scale.x=-1,this.btnPrevCar.on("pointerdown",()=>{this.selectedCarId>0&&(this.selectedCarId--,this.game.audio.playSound("ui_menu_whoosh"),this.reloadPlayerCar(this.selectedCarId),this.updateGarageUI(this.selectedCarId))}),this.btnNextCar=new kt("",b.from("btn-arrow")),this.btnNextCar.on("pointerdown",()=>{this.selectedCarId<nn.carSkins.length-1&&(this.selectedCarId++,this.game.audio.playSound("ui_menu_whoosh"),this.reloadPlayerCar(this.selectedCarId),this.updateGarageUI(this.selectedCarId))}),this.btnSelectCar=new kt("Select",b.from("btn-green"),{fontFamily:nt.font,fill:16777215,fontSize:48}),this.btnSelectCar.on("pointerdown",()=>{this.progress.data.selectedCar=this.selectedCarId,this.progress.saveLocal()}),this.upgrades=new O,this.addUpgradeButtons(),this.btnPurchaseCar=new kt("",b.from("btn-orange"),{fontFamily:nt.font,fill:16777215,fontSize:48}),this.carPurchasePrice=new Ee("Money"),this.carPurchasePrice.scale.set(1.5),this.carPurchasePrice.updateValue(nn.carPrices[this.selectedCarId]),this.btnPurchaseCar.addChild(this.carPurchasePrice),this.carPurchasePrice.x=10,this.btnPurchaseCar.on("pointerdown",()=>{let i=nn.carPrices[this.selectedCarId];i<=this.progress.data.money&&(this.progress.data.cars[this.selectedCarId].unlocked=!0,this.progress.data.money-=i,this.moneyCounter.updateValue(this.progress.data.money),this.progress.saveLocal(),this.updateGarageUI(this.selectedCarId))}),this.btnStartRace=Ga(),this.btnStartRace.on("pointerdown",()=>{ne.emit("START_RACE")}),this.updateGarageUI(this.selectedCarId),this.addChild(this.bg),this.addChild(this.bottomShadow),this.addChild(this.btnBack),this.addChild(this.moneyCounter),this.addChild(this.playerCar),this.addChild(this.btnPrevCar),this.addChild(this.btnNextCar),this.addChild(this.upgrades),this.addChild(this.btnPurchaseCar),this.positionElements()}positionElements(){this.bottomShadow.position.set(V.width/2,V.height-this.bottomShadow.height),this.moneyCounter.position.set(V.width/2+400,80),this.playerCar.position.set(V.width/2,this.height/2-200),this.btnPrevCar.position.set(V.width/2-380,this.playerCar.y),this.btnNextCar.position.set(V.width/2+380,this.playerCar.y),this.btnBack.position.set(100,80),this.btnStartRace.position.set(V.width/2,this.height-this.btnSelectCar.height),this.btnSelectCar.position.set(V.width/2,this.btnStartRace.y-this.btnStartRace.height),this.btnPurchaseCar.position.set(V.width/2,this.playerCar.y+800),this.upgrades.position.set(V.width/2,this.playerCar.y+700)}reloadPlayerCar(t){this.playerCar.body.texture=b.from(nn.carSkins[t])}addUpgradeButtons(){[...mm].forEach((t,e)=>{let i=new Ua(this.selectedCarId,t,this.progress.getCarUpgrade(t,this.selectedCarId));i.onPress.add(s=>{(s.price<this.progress.data.money||Ti.freeUpgrades)&&(this.game.audio.playSound("upgrade_3"),this.progress.upgradeCar(this.selectedCarId,s.kind),this.progress.data.money-=Ti.freeUpgrades?0:s.price,this.progress.saveLocal(),this.moneyCounter.updateValue(this.progress.data.money),i.increaseLevel(this.selectedCarId),s.kind=="guns"&&(this.playerCar.leftGun.upgrade(this.progress.getCarUpgrade("guns",this.selectedCarId)),this.playerCar.rightGun.upgrade(this.progress.getCarUpgrade("guns",this.selectedCarId))),s.kind=="damage"&&this.playerCar.mainGun.upgrade(this.progress.getCarUpgrade("damage",this.selectedCarId)))}),i.position.x=(e-1)*320,this.upgrades.addChild(i)})}updateGarageUI(t){let e=this.progress.data.cars[t].unlocked;this.upgrades.visible=e,this.btnPurchaseCar.visible=!e,this.playerCar.mainGun.upgrade(this.progress.getCarUpgrade("damage",this.selectedCarId)),this.playerCar.leftGun.upgrade(this.progress.getCarUpgrade("guns",this.selectedCarId)),this.playerCar.rightGun.upgrade(this.progress.getCarUpgrade("guns",this.selectedCarId)),e?this.upgrades.children.forEach(i=>{i.setLevel(t,this.progress.getCarUpgrade(i.kind,t))}):this.carPurchasePrice.updateValue(nn.carPrices[t])}};var ju=["MoneyBill","MoneyStack","Health","Magnet","MoneyX2"],Xa={MoneyBill:{textureKey:"MoneyBill"},MoneyStack:{textureKey:"MoneyStack"},Health:{textureKey:"Heal"},Magnet:{textureKey:"Magnet",durationMS:1e4},MoneyX2:{textureKey:"X2",durationMS:1e4}},ar={maxVerticalVelocity:1,maxHorizVelocity:.3,spinVelocity:.1,gravity:.0025,magnetPower:100},Va=class extends B{kind;velocity;constructor(t){super(),this.velocity=new K,this.anchor.set(.5),this.reset(t)}reset(t){this.kind=t,this.texture=b.from(Xa[t].textureKey),this.velocity.set(Math.random()*ar.maxHorizVelocity*2-ar.maxHorizVelocity,-Math.random()*.5)}applyGravity(t){this.velocity.y=Math.min(ar.maxVerticalVelocity,this.velocity.y+ar.gravity*t)}applyMagnet(t,e){let i=t.x-this.x,s=t.y-this.y,o=i*i+s*s,n=ar.magnetPower/o;this.velocity.x+=n*Math.sign(i)*e,this.velocity.x<-ar.maxHorizVelocity&&(this.velocity.x=-ar.maxHorizVelocity),this.velocity.x>ar.maxHorizVelocity&&(this.velocity.x=ar.maxHorizVelocity)}move(t){this.y+=this.velocity.y*t,this.x+=this.velocity.x*t}spin(t){this.angle+=ar.spinVelocity*t*Math.sign(this.velocity.x)}bounceOffRoadBorders(t,e){e.left<t.left&&(this.velocity.x=-this.velocity.x,this.x+=t.left-e.left),e.right>t.right&&(this.velocity.x=-this.velocity.x,this.x-=e.right-t.right)}};function we(r,t){let e=t.reduce((s,o)=>s+o),i=Math.floor(Math.random()*e);for(let s=0;s<t.length;s++){if(i-t[s]<0)return r[s];i-=t[s]}}var Wa=class r{static recentChoice=0;pickups=new Lt(()=>{let t=r.getNextKind([...ju]);return new Va(t)},t=>{let e=r.getNextKind([...ju]);t.reset(e)},t=>{t.destroy()});constructor(){}getFromEnemy(t){let e=this.pickups.getInstance();if(t.extraLoot&&Math.random()<t.extraLoot.chance){let i=we(t.extraLoot.drop,Array(t.extraLoot.drop.length).fill(1));return e.reset(i),e}if(t.regularLoot){let i=we(Object.keys(t.regularLoot),Object.values(t.regularLoot));return e.reset(i),e}}static getNextKind(t){return t[r.recentChoice++%t.length]}};var za=class{target;_active=!1;initialTargetCoord;initialPointerCoord;leftBound;rightBound;factor=.02;constructor(t){this.target=t}start(t){this.initialPointerCoord=t.x,this.initialTargetCoord=this.target.roadX,this._active=!0}stop(){this._active=!1}update(t){if(!this.active)return;let e=t.x-this.initialPointerCoord,i=this.initialTargetCoord+e*this.factor;this.target.roadX=Math.min(this.rightBound,Math.max(this.leftBound,i))}setBounds(t,e){this.leftBound=t,this.rightBound=e}get active(){return this._active}};var ja=["regular","fuel","taxi","hpvan","moneyvan"],$a={regular:{gfx:"Enemy-Car",hp:60,regularLoot:{MoneyBill:.8,MoneyStack:.2},extraLoot:{chance:.05,drop:["Health","Magnet","MoneyX2"]}},fuel:{gfx:"Gas-Car",hp:90,regularLoot:{MoneyBill:.6,MoneyStack:.4},extraLoot:{chance:.1,drop:["Health","Magnet","MoneyX2"]}},taxi:{gfx:"Taxi-Car",hp:120,regularLoot:{MoneyBill:.6,MoneyStack:.4},extraLoot:{chance:.1,drop:["Health","Magnet","MoneyX2"]}},hpvan:{gfx:"Heal-Car",hp:120,extraLoot:{chance:1,drop:["Health"]}},moneyvan:{gfx:"Money-Car",hp:120,extraLoot:{chance:1,drop:["MoneyStack"]}}};var g0={spawnPeriodMS:1e3},Ya=class r{static lastid=0;config;lastSpawnedMS;cars=new Lt(()=>{let t=new Nr,e=new B;return e.anchor.set(.5),t.body=e,t.addChild(t.body),r.loadNextCar(t),t},t=>{r.loadNextCar(t)},t=>{t.destroy({children:!0})});onSpawn=new Fe;constructor(t){this.config=Object.assign({},g0,t||{}),this.lastSpawnedMS=0}spawn(){let t=this.cars.getInstance();this.onSpawn.dispatch(t)}update(t){this.lastSpawnedMS+=t,this.lastSpawnedMS>this.config.spawnPeriodMS&&(this.lastSpawnedMS-=this.config.spawnPeriodMS,this.spawn())}static randomizeCar(t){let e=we([...ja],[0,1,0,0,0]);r.changeCarKind(t,e)}static changeCarKind(t,e){let i=$a[e];t.kind=e,t.body.texture=b.from(i.gfx),t.health=i.hp}static loadNextCar(t){let e=ja[r.lastid++%ja.length];t.kind=e,console.log("Spawning enemy of type",e),this.changeCarKind(t,e)}};var y0=[1,2,4],qa={hitboxPadding:20},Ps=class r extends O{hitbox;roadMark;items;lane;constructor(){super(),this.roadMark=new B(b.from("Obs-11")),this.roadMark.anchor.set(.5,0),this.items=new O,this.hitbox=new Hr,this.scale.set(.5),this.addChild(this.roadMark),this.addChild(this.hitbox),this.addChild(this.items)}static create(){let t=new r;return r.reset(t),t}static reset(t){let e=r.getRandomId(),i=Math.floor(Math.random()*3)+4;t.items.removeChildren();let s=0,o=0;for(let n=0;n<i;n++){let a=new B(b.from(`Obs-${e}`));a.position.set(s,o),s+=a.width,s>t.roadMark.width-2*qa.hitboxPadding&&(s=0,o+=a.width),t.items.addChild(a)}t.items.pivot.x=t.items.width/2,t.hitbox.clear(),t.hitbox.beginFill(16777215,.5),t.hitbox.drawRect(-t.items.width/2+qa.hitboxPadding,qa.hitboxPadding,t.items.width-qa.hitboxPadding*2,t.items.height*.9),t.hitbox.endFill(),t.hitbox.visible=!1}static destroyObstacle(t){t.destroy({children:!0})}static getRandomId(){return we([...y0],[1,1,1])}};var _0={spawnPeriodMS:5e3},Ka=class{config;lastSpawnedMS;road;obstacles=new Lt(Ps.create,Ps.reset,Ps.destroyObstacle);onSpawn=new Fe;constructor(t,e){this.config=Object.assign({},_0,e||{}),this.road=t,this.lastSpawnedMS=0}spawn(){this.onSpawn.dispatch(this.obstacles.getInstance())}update(t){this.lastSpawnedMS+=t,this.lastSpawnedMS>this.config.spawnPeriodMS&&(this.lastSpawnedMS-=this.config.spawnPeriodMS,this.spawn())}};var Za=class{road;enemySpawner;obstacleSpawner;container;enemyContainer;obstacleContainer;constructor(t,e){this.road=e,this.enemySpawner=new Ya,this.obstacleSpawner=new Ka(this.road),this.container=new O,this.enemyContainer=new O,this.obstacleContainer=new O,this.container.addChild(this.obstacleContainer),this.container.addChild(this.enemyContainer),this.enemySpawner.onSpawn.add(i=>{let s=e.getFreeLane();i.lane=s,e.increaseLaneOccupancy(s),i.position.set(e.getLaneX(s),-i.height),this.enemyContainer.addChild(i)}),this.obstacleSpawner.onSpawn.add(i=>{let s=e.getFreeLane();i.lane=s,e.increaseLaneOccupancy(s),i.position.set(e.getLaneX(s),-i.height),this.obstacleContainer.addChild(i)})}update(t){this.enemySpawner.update(t),this.obstacleSpawner.update(t)}releaseEnemy(t){this.road.decreaseLaneOccupancy(t.lane),this.enemySpawner.cars.release(t)}releaseObstacle(t){this.road.decreaseLaneOccupancy(t.lane),this.obstacleSpawner.obstacles.release(t)}get enemies(){return this.enemySpawner.cars}get activeEnemies(){return this.enemySpawner.cars.activeInstances}get obstacles(){return this.obstacleSpawner.obstacles}get activeObstacles(){return this.obstacleSpawner.obstacles.activeInstances}clearSignals(){this.enemySpawner.onSpawn.removeAll(),this.obstacleSpawner.onSpawn.removeAll()}};var Qa={projectileOffsetX:30,projectileOffsetY:-120},Ja=class extends fe{rotation=0;body;constructor(t){super(t||{},new Lt(()=>fs.createProjectile(2),fe.resetProjectile,fe.destroyProjectile)),this.lastFiredMS=0,this.body=new B(b.from("Boss_Weapon_Front")),this.body.scale.set(.5),this.body.anchor.set(.5,.7)}aim(t){this.rotation=Math.atan2(t.y-this.body.parent.y,t.x-this.body.parent.x),this.body.rotation=this.rotation+Math.PI/2}fire(){let t=this.projectiles.getInstance();t.rotation=this.rotation+Math.PI/2,this.body.addChild(t),t.position.set(-Qa.projectileOffsetX,Qa.projectileOffsetY),this.onFire.dispatch([t]);let e=this.projectiles.getInstance();e.rotation=this.rotation+Math.PI/2,this.body.addChild(e),e.position.set(Qa.projectileOffsetX,Qa.projectileOffsetY),this.onFire.dispatch([e])}};function gm(r){return r<.5?2*r*r:1-Math.pow(-2*r+2,2)/2}var x0={threshold:.2,moveTime:1e3,checkPeriodMS:2e3},th=class{config;checkTime;steeredCar;targetCar;oldX;targetX;movementTime;constructor(t,e,i){this.config=Object.assign({},x0,t),this.steeredCar=e,this.targetCar=i,this.oldX=this.steeredCar.roadX,this.targetX=this.targetCar.roadX,this.checkTime=0}update(t){this.checkTime+=t,this.checkTime>=this.config.checkPeriodMS&&Math.abs(this.steeredCar.roadX-this.targetCar.roadX)>this.config.threshold&&(this.checkTime-=this.config.checkPeriodMS,this.startMoving(this.targetCar.roadX)),this.movementTime<this.config.moveTime&&this.adjustPosition(t)}startMoving(t){this.oldX=this.steeredCar.roadX,this.targetX=t,this.movementTime=0}adjustPosition(t){this.movementTime+=t,this.steeredCar.roadX=this.oldX+(this.targetX-this.oldX)*gm(this.movementTime/this.config.moveTime)}};var eh=class extends Nr{target;steering;gun;constructor(){super(),this.body=new B(b.from("Boss-Car")),this.body.anchor.set(.5),this.body.scale.set(.75),this.gun=new Ja({firePeriodMS:1e3,projectileSpeed:.7}),this.addChild(this.body),this.addChild(this.gun.body),this.scale.set(1.5),this.reset()}reset(){this.health=500}setTarget(t){this.target=t,this.steering=new th({},this,this.target)}update(t){this.gun.aim(this.target.position),this.gun.update(t),this.steering&&this.steering.update(t)}};var rh=class extends O{icon;bg;fill;fillMask;tween;constructor(){super(),this.icon=new B(b.from("icon-health")),this.bg=new B(b.from("health-progress-back")),this.fill=new B(b.from("health-progress-full")),[this.bg,this.fill,this.icon].forEach(t=>t.anchor.set(.5)),this.icon.position.x-=this.bg.width/2,this.tween=new Nt(this.fill).easing(Ot.Cubic.InOut).duration(300),this.updateValue(1),this.fillMask=new Hr,this.fillMask.beginFill(16777215),this.fillMask.drawRect(-this.bg.width/2+4,-this.bg.height/2,this.bg.width,this.bg.height),this.fill.mask=this.fillMask,this.addChild(this.fillMask),this.addChild(this.bg),this.addChild(this.fill),this.addChild(this.icon)}updateValue(t){this.tween.dynamicTo({x:-this.bg.width*(1-t)}).restart()}};var Is=class extends O{text;constructor(){super();let t=new B(b.from("panel-profile")),e=new B(b.from("icon-rep")),i=new B(b.from("icon-profile")),s=new ct("0",{fontFamily:nt.font,fontSize:54,fill:16777215});[t,i,e].forEach(o=>{o.anchor.set(.5)}),s.anchor.set(0,.5),i.position.set(-145,-15),e.position.set(-30,0),s.position.set(30,0),this.addChild(t),this.addChild(i),this.addChild(e),this.text=this.addChild(s)}updateValue(t){this.text.text=t.toString()}};var Xt={width:300,height:30},ih=class extends O{start;finish;fullBar;currentProgress;currentMarker;duration;g;progressValue=0;constructor(){super(),this.fullBar=new B(b.WHITE),this.fullBar.scale.set(Xt.width/16,Xt.height/16),this.fullBar.alpha=.5,this.fullBar.anchor.set(.5),this.currentProgress=new B(b.WHITE),this.currentProgress.scale.set(Xt.width/16*this.progressValue,Xt.height/16),this.currentProgress.anchor.set(0,.5),this.currentProgress.x=-Xt.width/2,this.currentProgress.tint=2017783,this.start=new B(b.from("progress-meter-start")),this.finish=new B(b.from("progress-meter-finish")),this.currentMarker=new B(b.from("icon-car")),[this.start,this.finish,this.currentMarker].forEach(t=>t.anchor.set(.5)),this.start.x=-Xt.width/2,this.currentMarker.position.set(this.start.x,-35),this.finish.x=Xt.width/2,this.addChild(this.fullBar),this.addChild(this.currentProgress),this.addChild(this.currentMarker),this.addChild(this.start),this.addChild(this.finish)}drawBar(){this.g.clear(),this.g.beginFill(Q.shared.setValue({r:255,g:255,b:255,a:.5})),this.g.drawRect(-Xt.width/2,-Xt.height/2,Xt.width,Xt.height),this.g.endFill(),this.g.beginFill(2217723),this.g.drawRect(-Xt.width/2,-Xt.height/2,Xt.width*this.progressValue,Xt.height)}updateValue(t){this.progressValue=t,this.currentMarker.x=Xt.width*(t-.5),this.currentProgress.scale.x=Xt.width/16*this.progressValue}};var sh=class extends O{playerHealth;progress;money;reputation;constructor(){super(),this.money=new Ee("Money"),this.reputation=new Is,this.progress=new ih,this.playerHealth=new rh,this.addChild(this.progress),this.addChild(this.money),this.addChild(this.reputation),this.addChild(this.playerHealth),this.positionElements()}setMoney(t){this.money.updateValue(t)}setReputation(t){this.reputation.updateValue(t)}setProgress(t){this.progress.updateValue(t)}setHealth(t){this.playerHealth.updateValue(t)}positionElements(){this.reputation.position.set(V.width/2-300,80),this.progress.position.set(V.width/2,80),this.money.position.set(V.width/2+400,80),this.playerHealth.position.set(this.reputation.position.x-20,this.reputation.getBounds().bottom+5)}};function an(r,t){return r=Math.ceil(r),t=Math.floor(t),Math.floor(Math.random()*(t-r+1))+r}var oh=class extends O{dimmer;text;tween;constructor(){super(),this.tween=new Nt(this).from({alpha:0}).to({alpha:1},300).easing(Ot.Quadratic.InOut),this.dimmer=new B(b.WHITE),this.dimmer.scale.set(V.width/this.dimmer.texture.width,V.height/this.dimmer.texture.height),this.dimmer.tint=0,this.dimmer.alpha=.7,this.text=new ct(`Tap and hold
to play`,{fontFamily:nt.font,fontSize:108,fill:16777215,align:"center"}),this.text.anchor.set(.5),this.text.position.set(V.width/2,V.height*.7),this.alpha=0,this.addChild(this.dimmer),this.addChild(this.text)}tweenShow(){this.tween.start()}};var nh=class extends O{text;constructor(){super();let t=new B(b.from("panel-end-rep")),e=new B(b.from("icon-rep"));e.scale.set(1.5);let i=new ct("REP:",{fontFamily:nt.font,fontSize:64,fill:16777215}),s=new ct("0",{fontFamily:nt.font,fontSize:64,fill:16777215});[t].forEach(o=>{o.anchor.set(.5)}),[i,e,s].forEach(o=>{o.anchor.set(0,.5)}),i.position.set(-t.width/2+40,0),e.position.set(i.getBounds().right+40,0),s.position.set(e.getBounds().right+40,0),this.addChild(t),this.addChild(i),this.addChild(e),this.text=this.addChild(s)}updateValue(t){this.text.text=t.toString()}};var ah=class extends O{titleContainer;titleBg;titleText;repCounter;moneyCounter;continueButton;constructor(t,e,i){super(),this.titleContainer=new O,this.titleBg=new B(b.from("panel-end")),this.titleBg.anchor.set(.5,0),this.titleText=new ct(t?"VICTORY!":"DEFEAT!",{fontFamily:nt.font,fontSize:144,fill:16777215,align:"center",strokeThickness:4,stroke:4134513}),this.titleText.anchor.set(.5),this.titleText.y=this.titleBg.height/2,this.repCounter=new nh,this.repCounter.updateValue(i.data.reputation),this.moneyCounter=new Ee("Money"),this.moneyCounter.scale.set(1.5),this.moneyCounter.updateValue(i.data.money),this.continueButton=new kt("Continue".toUpperCase(),b.from("btn-green"),{fontFamily:nt.font,fontSize:72,fill:84798,align:"center"}),this.continueButton.on("pointerdown",()=>{ne.emit("START_MENU")}),this.titleContainer.addChild(this.titleBg),this.titleContainer.addChild(this.titleText),this.addChild(this.repCounter),this.addChild(this.moneyCounter),this.addChild(this.titleContainer),this.addChild(this.continueButton),this.positionElements()}positionElements(){this.titleContainer.position.set(V.width/2,0),this.repCounter.position.set(V.width/2,V.height/2),this.moneyCounter.position.set(V.width/2,V.height-550),this.continueButton.position.set(V.width/2,V.height-250)}};var St={roadWidth:5,timeDilation:8,enemySpeed:.1,scrollSpeed:.6,repToBoss:50,raceDurationMS:6e4,collisionDamageToPlayer:10,projectileDamageToPlayer:15},hh=class extends O{game;slowed=!0;paused=!0;time=0;race;road;projectiles;explosions;pickups;threatSpawner;pickupSpawner;bossCar;playerCar;steering;globalMousePos;progress;ui;pauseScreen;bossMode=!1;bossDefeated=!1;isOver=!1;moneyMultiplier=1;moneyMultiplierRemainingTimeMS=0;magnetRemainingTimeMS=0;constructor(t,e,i){super(),this.game=t,this.progress=e,this.game.audio.playSound(`engine_start_${an(1,3)}`),this.race=new O,this.projectiles=new O,this.explosions=new O,this.pickups=new O,this.road=i||new Rs,this.playerCar=new As(e.data.selectedCar,e.getCarUpgrades()),this.threatSpawner=new Za(this.game,this.road),this.pickupSpawner=new Wa,this.bossCar=new eh,this.bossCar.setTarget(this.playerCar),this.bossCar.visible=!1,this.ui=new sh,this.ui.setMoney(this.progress.data.money),this.ui.setReputation(this.progress.data.reputation),this.pauseScreen=new oh,this.playerCar.guns.forEach(n=>n.onFire.add(a=>{this.game.audio.playSound("projectile"),console.log("firing gun",n),a.forEach(h=>{let l=this.toLocal({x:this.playerCar.position.x+n.body.x+h.x,y:this.playerCar.position.y+n.body.y+h.y});this.projectiles.addChild(h),h.position.set(l.x*this.scale.x,l.y*this.scale.y)})})),this.bossCar.gun.onFire.add(n=>{n.forEach(a=>{a.position.copyFrom(this.toLocal(this.position,a)),this.projectiles.addChild(a)})}),this.addChild(this.race),this.race.addChild(this.road),this.race.addChild(this.threatSpawner.container),this.race.addChild(this.playerCar),this.race.addChild(this.bossCar),this.race.addChild(this.explosions),this.race.addChild(this.pickups),this.race.addChild(this.projectiles),this.addChild(this.ui),this.steering=new za(this.playerCar);let s=St.roadWidth/2,o=this.playerCar.width/this.getRoadPxPerUnit()/2;this.steering.setBounds(-s+o,s-o),this.eventMode="static",this.on("pointerdown",n=>{n.preventDefault(),this.globalMousePos=n.global,this.steering.start(n.global),this.unpause(),this.playerCar.setFiringPermission(!Ti.disablePlayerGun)}),this.on("pointermove",n=>{n.preventDefault(),this.globalMousePos=n.global}),this.on("pointerup",n=>{n.preventDefault(),this.steering.stop(),this.pause(),this.playerCar.setFiringPermission(!1)}),this.on("pointerupoutside",n=>{n.preventDefault(),this.steering.stop(),this.pause(),this.playerCar.setFiringPermission(!1)}),t.ticker.add(this.update,this),Ti.manualRaceEnd&&document.addEventListener("keydown",this.debugControls.bind(this)),new Nt(this.playerCar).from({y:V.height+this.playerCar.height}).to({y:this.getPlayerCarDefaultY()},600).easing(Ot.Quadratic.Out).onComplete(()=>{this.pause(!0)}).start()}debugControls(t){switch(t.key){case"o":this.gameOver();break}}resize(){this.pickups.position.x=this.road.x,this.explosions.position.x=this.road.x,this.threatSpawner.container.x=this.road.x}pause(t=!1){(!this.paused||t)&&(this.paused=!0,this.slowed=!0,this.pauseScreen.tweenShow(),this.addChild(this.pauseScreen))}unpause(){this.paused&&(this.paused=!1,this.slowed=!1,this.removeChild(this.pauseScreen))}update(){fi.shared.update(this.game.ticker.deltaMS),this.steering.active&&this.steering.update(this.globalMousePos);let t=this.slowed?this.game.ticker.deltaMS/St.timeDilation:this.game.ticker.deltaMS;this.moneyMultiplier!=1&&(this.moneyMultiplierRemainingTimeMS-=t,this.moneyMultiplierRemainingTimeMS<=0&&(this.moneyMultiplier=1)),this.magnetRemainingTimeMS>0&&(this.magnetRemainingTimeMS-=t),this.isOver||(this.road.update(t),this.explosions.children.forEach(i=>{i.y+=St.scrollSpeed*t})),this.threatSpawner.activeObstacles.forEach(i=>{if(i.y+=St.scrollSpeed*t,i.getBounds().top>V.height){this.threatSpawner.releaseObstacle(i);return}this.isOver||this.detectOverlap(i.hitbox.getBounds(),this.playerCar.getBounds())&&(this.setPlayerHealth(0),this.isOver=!0)}),this.bossMode?(this.bossCar.update(t),this.bossDefeated||(this.playerCar.mainGun.projectiles.activeInstances.forEach(i=>{this.detectOverlap(i.getBounds(),this.bossCar.getBounds())&&(this.playerCar.mainGun.projectiles.release(i),this.bossCar.health-=this.playerCar.mainGun.getProjectileDamage(),this.bossCar.health<=0&&(this.defeatBoss(),this.gameOver()))}),this.updateBossCarPosition())):(this.time>=St.raceDurationMS?(this.time=St.raceDurationMS,this.enableBossMode()):this.time+=t,this.ui.setProgress(this.time/St.raceDurationMS),this.threatSpawner.update(t),this.bossCar.gun.update(t),this.threatSpawner.activeEnemies.forEach(i=>{if(i.position.y+=(St.scrollSpeed-St.enemySpeed)*t,i.position.y>V.height+i.height){this.threatSpawner.releaseEnemy(i);return}this.playerCar.mainGun.projectiles.activeInstances.forEach(s=>{this.detectOverlap(s.getBounds(),i.getBounds())&&(this.playerCar.mainGun.projectiles.release(s),i.health-=this.playerCar.mainGun.getProjectileDamage(),i.health<=0&&this.onPlayerKillEnemy(i))}),this.isOver||this.detectOverlap(i.getBounds(),this.playerCar.getBounds())&&(this.onPlayerKillEnemy(i),this.setPlayerHealth(this.playerCar.health-St.collisionDamageToPlayer))})),this.bossCar.gun.projectiles.activeInstances.forEach(i=>{this.detectOverlap(i.getBounds(),this.playerCar.getBounds())&&(this.bossCar.gun.projectiles.release(i),this.setPlayerHealth(this.playerCar.health-St.projectileDamageToPlayer))}),this.pickupSpawner.pickups.activeInstances.forEach(i=>{i.applyGravity(t),this.magnetRemainingTimeMS>0&&i.applyMagnet(this.playerCar,t),i.move(t)});let e=this.road.getBounds();this.pickupSpawner.pickups.activeInstances.forEach(i=>{let s=i.getBounds();if(i.bounceOffRoadBorders(e,s),s.top>V.height&&this.pickupSpawner.pickups.release(i),this.detectOverlap(this.playerCar.getBounds(),s)){switch(i.kind){case"MoneyBill":this.collectMoney(1*this.moneyMultiplier);break;case"MoneyStack":this.collectMoney(10*this.moneyMultiplier);break;case"Health":this.game.audio.playSound("power_up_4"),this.playerCar.resetHP(this.progress.getCarUpgrade("armor")),this.onPlayerHealthUpdate();break;case"Magnet":this.game.audio.playSound("power_up_5"),this.magnetRemainingTimeMS=Xa.Magnet.durationMS;break;case"MoneyX2":this.game.audio.playSound("power_up_4"),this.moneyMultiplier=2,this.moneyMultiplierRemainingTimeMS=Xa.MoneyX2.durationMS;break}this.pickupSpawner.pickups.release(i)}}),this.playerCar.updateGuns(t),this.isOver||this.updatePlayerCarPosition()}detectOverlap(t,e){let i=t.right>=e.left&&e.right>=t.left,s=t.bottom>=e.top&&e.bottom>=t.top;return i&&s}onPlayerKillEnemy(t){let e=this.pickupSpawner.getFromEnemy($a[t.kind]);e&&(e.position.copyFrom(t.position),this.pickups.addChild(e)),this.game.audio.playSound(`explosion_${an(1,4)}`),this.showExplosion(t.position),this.threatSpawner.releaseEnemy(t),this.increaseReputation(1)}setPlayerHealth(t){console.log("Setting player health to",t),this.playerCar.health=Math.max(0,t),this.onPlayerHealthUpdate()}onPlayerHealthUpdate(){console.log("Player health updated",this.playerCar.health),this.ui.setHealth(this.playerCar.health/this.playerCar.getMaxHealth(this.progress.getCarUpgrade("armor"))),this.playerCar.health<=0&&(this.playerCar.body.visible=!1,this.game.audio.playSound("player_car_crash"),this.showExplosion(this.playerCar.body.position,this.playerCar),this.gameOver())}collectMoney(t){this.game.audio.playSound(`money_collect_${an(2,4)}`),this.progress.data.money+=t,this.progress.saveLocal(),this.ui.setMoney(this.progress.data.money)}increaseReputation(t){this.progress.data.reputation+=t,this.progress.saveLocal(),this.ui.setReputation(this.progress.data.reputation)}enableBossMode(){this.bossMode||(this.bossMode=!0,this.bossCar.reset(),this.bossCar.visible=!0,this.updateBossCarPosition(),this.bossCar.gun.canFire=!0,this.threatSpawner.activeEnemies.forEach(t=>this.threatSpawner.releaseEnemy(t)))}disableBossMode(){this.bossMode&&(this.bossMode=!1,this.defeatBoss())}defeatBoss(){this.bossDefeated=!0,this.game.audio.playSound(`explosion_${an(1,4)}`),this.showExplosion(this.bossCar.position),this.bossCar.visible=!1,this.bossCar.gun.canFire=!1}updatePlayerCarPosition(){let e=V.width/2+this.playerCar.roadX*this.getRoadPxPerUnit();this.playerCar.position.x=e}getPlayerCarDefaultY(){return V.height-this.playerCar.height/2-50}updateBossCarPosition(){let e=V.width/2+this.bossCar.roadX*this.getRoadPxPerUnit(),i=this.bossCar.height/2+50;this.bossCar.position.set(e,i)}getRoadPxPerUnit(){return this.road.width*.75/St.roadWidth}showExplosion(t,e){let i=e||this.explosions,s=Be.get("explosion"),o=new Jo(s.animations.explosion);o.anchor.set(.5),o.position.copyFrom(t),o.loop=!1,o.animationSpeed=.5,o.play(),i.addChild(o),o.onComplete=()=>{i.removeChild(o)}}gameOver(){this.isOver=!0,this.removeChild(this.ui),this.removeListeners(),this.removeChild(this.pauseScreen);let t=V.width/2,e=V.height/2;this.steering.stop(),this.race.pivot.set(t,e),this.race.position.set(this.race.position.x+t,this.race.position.y+e),this.bossDefeated&&new Nt(this.playerCar).to({roadX:this.steering.rightBound,y:this.race.pivot.y},600).start(),new Nt(this.race.scale).to({x:this.race.scale.x*2,y:this.race.scale.y*2},600).start(),new Nt(this.race).to({angle:-30},600).easing(Ot.Sinusoidal.InOut).onComplete(()=>{this.game.ticker.remove(this.update,this),this.game.audio.stopMusic(),this.game.audio.playSound("ui_menu_whoosh"),this.addChild(new ah(this.bossDefeated,this.game,this.progress))}).start()}destroy(t){this.game.ticker.remove(this.update,this),this.removeListeners(),this.playerCar.mainGun.onFire.removeAll(),this.bossCar.gun.onFire.removeAll(),this.threatSpawner.clearSignals(),super.destroy(t)}removeListeners(){this.off("pointerdown"),this.off("pointerup"),this.off("pointermove"),this.off("pointeroutside"),document.removeEventListener("keydown",this.debugControls)}};var v0=["Crack-Left","Crack-Right","Crack-Center"],hn=class r extends B{type;constructor(){super()}static create(){let t=new r;return t.anchor.set(.5),r.reset(t),t}static reset(t){switch(t.type=r.getRandomType(),t.texture=b.from(t.type),t.type){case"Crack-Left":t.x=-320;break;case"Crack-Right":t.x=320;break;case"Crack-Center":{t.x=Math.random()*500-500/2;break}}t.y=0}static getRandomType(){return we([...v0],[30,30,40])}};var b0=[1,2,3,4,9,10],ln=class r extends B{constructor(){super()}static create(){let t=new r;return t.anchor.set(.5),t.scale.set(.5),r.reset(t),t}static reset(t){let e=r.getRandomId();r.resetGraphics(t,e),r.resetPosition(t,e)}static resetGraphics(t,e){t.texture=b.from(`Obs-${e}`)}static resetPosition(t,e){Math.random()>.5?(t.x=-475,e==10&&(t.scale.x=-Math.abs(t.scale.x),t.x+=25)):(t.x=475,e==10&&(t.x-=25)),t.y=-t.height}static getRandomId(){return we([...b0],[1,1,1,1,1,1])}};var Ne={laneCount:5,heightOffset:10,minCrackPeriod:2e3,maxCrackPeriod:4e3,linePeriod:350,driveable:.75},Rs=class extends O{lanes;bgPt1;bgPt2;crackTimer=0;lineTimer=0;timeTillCrack=Ne.minCrackPeriod;cracks=new Lt(hn.create,hn.reset,t=>{});lines=new Lt(()=>{let t=new B(b.from("Road-Lines"));return t.anchor.set(.5,0),t.position.set(0,-t.height),t.alpha=Math.random()*.8+.1,t},t=>{t.position.set(0,-t.height),t.alpha=Math.random()*.6+.2},t=>{t.destroy()});obstacles=new Lt(ln.create,ln.reset,t=>{});constructor(){super(),this.lanes=new Array(Ne.laneCount).fill(0),this.bgPt1=new B(b.from("road")),this.bgPt2=new B(b.from("road")),this.bgPt1.anchor.set(.5),this.bgPt2.anchor.set(.5),this.bgPt2.y+=this.bgPt1.height,this.addChild(this.bgPt1),this.addChild(this.bgPt2),this.addChild(this.cracks.getInstance());for(let t=0;t<6;t++){let e=this.lines.getInstance();e.position.y+=t*400,this.addChild(e)}}listObstacles(){let t=0,e=0,i=0;for(let s=1;s<=11;s++){let o=new B(b.from(`Obs-${s}`));o.scale.set(.5),o.position.set(t,e),o.height>i&&(i=o.height),t+=o.width,t>500&&(t=0,e+=i,i=0),this.addChild(o)}}update(t){this.bgPt1.y+=St.scrollSpeed*t,this.bgPt2.y+=St.scrollSpeed*t,this.crackTimer+=t,this.crackTimer>this.timeTillCrack&&(this.crackTimer-=this.timeTillCrack,this.timeTillCrack=Math.random()*(Ne.maxCrackPeriod-Ne.minCrackPeriod)+Ne.minCrackPeriod,this.addChild(this.cracks.getInstance()),this.addChild(this.obstacles.getInstance())),this.lineTimer+=t,this.lineTimer>Ne.linePeriod&&(this.lineTimer-=Ne.linePeriod,this.addChild(this.lines.getInstance())),this.lines.activeInstances.forEach(i=>{i.y+=St.scrollSpeed*t});let e=ym().height;this.obstacles.activeInstances.forEach(i=>{i.y+=St.scrollSpeed*t,i.getBounds().top>e&&this.obstacles.release(i)}),this.cracks.activeInstances.forEach(i=>{i.y+=St.scrollSpeed*t,i.getBounds().top>e&&this.cracks.release(i)}),this.bgPt1.getBounds().top>e&&(this.bgPt1.y=this.bgPt2.getBounds().top-this.bgPt1.height/2+Ne.heightOffset),this.bgPt2.getBounds().top>e&&(this.bgPt2.y=this.bgPt1.getBounds().top-this.bgPt2.height/2+Ne.heightOffset)}decreaseLaneOccupancy(t){this.lanes[t]--}increaseLaneOccupancy(t){this.lanes[t]++}getFreeLane(){let t=this.lanes.map((s,o)=>o),e=this.lanes.map(s=>s>0?0:1);return we(t,e)}getRandomLane(){return Math.floor(Math.random()*Ne.laneCount)}getLaneX(t){t=t||this.getRandomLane();let e=V.width*Ne.driveable,i=(V.width-e)/2,s=e/Ne.laneCount;return i+t*s+s/2}};var lh=class extends O{bg;rankText;nameText;repIcon;repCountText;constructor(t,e,i,s,o=!1){super(),this.bg=new B(b.from("panel-lb-entry")),this.bg.tint=o?16774656:s;let n=Intl.NumberFormat("en",{notation:"compact"}),a={fontFamily:nt.font,fill:o?65793:16777215,fontSize:54};this.rankText=new ct(t.toString(),a),this.nameText=new ct(o?"You":e.toString(),a),this.repIcon=new B(b.from("icon-rep")),this.repCountText=new ct(n.format(i),a),this.bg.anchor.set(.5),this.rankText.anchor.set(.5,.5),this.nameText.anchor.set(0,.5),this.repIcon.anchor.set(.5,.5),this.repCountText.anchor.set(0,.5);let h=this.bg.getBounds().left,l=this.bg.getBounds().right;this.rankText.x=h+70,this.nameText.x=h+150,this.repCountText.x=l-200,this.repIcon.x=this.repCountText.x-80,this.addChild(this.bg),this.addChild(this.rankText),this.addChild(this.nameText),this.addChild(this.repIcon),this.addChild(this.repCountText)}};var uh=class extends O{bg;rankLabel;nameLabel;repLabel;constructor(){super(),this.bg=new B(b.from("panel-lb-entry")),this.bg.scale.y=.8,this.bg.tint=926265;let t={fontFamily:nt.font,fill:16777215,fontSize:48};this.rankLabel=new ct("Rank".toUpperCase(),t),this.nameLabel=new ct("Name".toUpperCase(),t),this.repLabel=new ct("Rep".toUpperCase(),t),this.bg.anchor.set(.5),this.rankLabel.anchor.set(.5,.5),this.nameLabel.anchor.set(0,.5),this.repLabel.anchor.set(0,.5);let e=this.bg.getBounds().left,i=this.bg.getBounds().right;this.rankLabel.x=e+70,this.nameLabel.x=e+150,this.repLabel.x=i-200,this.addChild(this.bg),this.addChild(this.rankLabel),this.addChild(this.nameLabel),this.addChild(this.repLabel)}};var ch={rows:5,maxNameLength:15,evenRowColor:1323346,oddRowColor:1787253,playerRowColor:16774656},dh=class extends O{header;entries;constructor(){super(),this.header=new uh,this.addChild(this.header);let t=[{name:"A Long-named Person",rep:987654321},{name:"Some Other Player",rep:87654321},{name:"Another One",rep:7654321},{name:"Player 4",rep:654321},{name:"Player 5",rep:54321},{name:"Player 6",rep:4321},{name:"Player 7",rep:321},{name:"Player 8",rep:21}];this.displayEntries(t)}displayEntries(t){this.entries=[];for(let e=0;e<ch.rows;e++){let i=e%2==0?ch.oddRowColor:ch.evenRowColor,s=new lh(e+1,this.formatDisplayName(t[e].name),t[e].rep,i,e==3);s.y=this.header.getBounds().bottom+s.height/2+s.height*e,this.entries.push(s),this.addChild(s)}}formatDisplayName(t){let e=0,i="";for(let s of t.split(" ")){if(e+=s.length+1,e>ch.maxNameLength)return i+=" "+s.substring(0,1)+".",i;i+=" "+s}return i}};var T0={fontFamily:nt.font,fontSize:36,fill:16777215,stroke:1849961,strokeThickness:8};function $u(r,t){let e=new kt(t,b.from("btn-blue"),T0);e.text.position.set(-5,40);let i=new B(b.from(r));return i.anchor.set(.5),i.y=-60,e.addChild(i),e}var un=class extends O{game;road;header;leaderboard;bottomShadow;repCounter;moneyCounter;settingsButton;raceButton;garageButton;moreGamesButton;constructor(t,e){super(),this.game=t,this.header=new B(b.from("panel-header")),this.header.anchor.set(.5,0),this.leaderboard=new dh,this.repCounter=new Is,this.repCounter.updateValue(e.data.reputation),this.moneyCounter=new Ee("Money"),this.moneyCounter.updateValue(e.data.money),this.settingsButton=new kt("",b.from("btn-settings")),this.road=new Rs,this.raceButton=Ga(),this.raceButton.on("pointerdown",()=>{new Nt(this.raceButton).to({y:-this.raceButton.height},300).easing(Ot.Back.In).start(),new Nt(this.garageButton).to({y:V.height+this.garageButton.height},300).easing(Ot.Back.In).start(),new Nt(this.moreGamesButton).to({y:V.height+this.garageButton.height},300).easing(Ot.Back.In).start(),new Nt(this.bottomShadow).to({alpha:0},300).easing(Ot.Quadratic.In).onComplete(()=>{ne.emit("START_RACE",this.road)}).start()}),this.garageButton=$u("icon-upgrade","Upgrade"),this.garageButton.on("pointerdown",()=>{this.game.audio.playSound("ui_menu_whoosh"),ne.emit("START_GARAGE")}),this.moreGamesButton=$u("icon-more-games","More games"),this.bottomShadow=new Cs("shadow"),this.addChild(this.road),this.addChild(this.bottomShadow),this.addChild(this.header),this.addChild(this.repCounter),this.addChild(this.moneyCounter),this.addChild(this.settingsButton),this.addChild(this.leaderboard),this.addChild(this.raceButton),this.addChild(this.garageButton),this.addChild(this.moreGamesButton),this.positionElements(),this.game.ticker.add(this.update,this)}positionElements(){this.header.position.set(V.width/2,0),this.settingsButton.position.set(V.width-this.settingsButton.width-20,this.header.height/2),this.repCounter.position.set(250,this.header.height/2),this.moneyCounter.position.set(V.width/2+200,this.header.height/2),this.road.pivot.x=-this.road.width/2,this.bottomShadow.position.set(V.width/2,V.height-this.bottomShadow.height),this.leaderboard.position.set(V.width/2,400),this.leaderboard.scale.set(this.leaderboard.width/this.road.width),this.raceButton.position.set(V.width/2,1300),this.garageButton.position.set(V.width/2-170,1700),this.moreGamesButton.position.set(V.width/2+170,1700)}update(){fi.shared.update(this.game.ticker.deltaMS),this.road.update(this.game.ticker.deltaMS/St.timeDilation)}destroy(t){this.game.ticker.remove(this.update,this),super.destroy(t)}};var Ti={disablePlayerGun:!1,manualRaceEnd:!0,cheats:!0,freeUpgrades:!1},V={width:1080,height:1920},ph=class extends aa{scene;progress;audio;constructor(){super({view:document.getElementById("pixi-canvas"),resolution:window.devicePixelRatio||1,width:V.width,height:V.height,autoDensity:!0,backgroundColor:0}),this.progress=new xa,this.audio=new _a,this.audio.init(!0,!0),window.addEventListener("blur",()=>{this.audio.setMusicEnabled(!1,"AppPaused")}),window.addEventListener("focus",()=>{this.audio.setMusicEnabled(!0,"AppPaused")}),ne.on("BUTTON_PRESS",()=>{this.audio.playSound("ui_click_1")}),Ti.cheats&&document.addEventListener("keydown",this.cheats.bind(this)),this.switchScene(new un(this,this.progress)),this.audio.playMusic("calm"),ne.on("START_RACE",t=>{this.switchScene(new hh(this,this.progress,t)),this.audio.setMusicContext("active")}),ne.on("START_GARAGE",()=>{this.switchScene(new Ha(this,this.progress)),this.audio.setMusicContext("calm")}),ne.on("START_MENU",()=>{this.switchScene(new un(this,this.progress)),this.audio.setMusicContext("calm")})}switchScene(t){this.stage.removeChildren(),this.scene&&this.scene.destroy({children:!0}),this.scene=t,this.onresize(),this.stage.addChild(t)}cheats(t){switch(t.key){case"r":this.progress.reset(),console.log("Game progress dropped",this.progress.data);break;case"m":this.progress.data.money+=1e4,this.progress.saveLocal,console.log(`Free money! ${this.progress.data.money}`);break}}onresize(){let t=this.getGameScale();console.log("Scale",t),this.renderer.resize(V.width*t,V.height*t),this.scene.scale.set(t)}getGameScale(){let t=window.innerHeight/V.height,e=window.innerWidth/V.width;return Math.min(e,t)}};var _m={bundles:[{name:"main",assets:{cars:"./assets/atlases/cars.json",weapons:"./assets/atlases/weapons.json",projectiles:"./assets/atlases/projectiles.json",explosion:"./assets/atlases/explosion.json",pickups:"./assets/atlases/pickups.json",road:"./assets/road.jpg",garage:"./assets/garage.jpg",bg:"./assets/atlases/bg.json",obstacles:"./assets/atlases/obstacles.json",ui:"./assets/atlases/ui.json",rajdhani:"./assets/fonts/rajdhani.ttf",rubik:"./assets/fonts/rubik.ttf"}},{name:"audio",assets:{calm:"./assets/music/calm.mp3",sounds:"./assets/sounds/sounds.mp3",active:"./assets/music/active.mp3"}}]};async function xm(r){w.add(La),await Be.init({manifest:_m}),await Be.loadBundle("main",r),await Be.loadBundle("audio",r),console.log("assets loaded",Be.cache)}var fh;xm(r=>{console.log(`Loading: ${Math.floor(r)}%`)}).then(()=>{fh=new ph,window.addEventListener("resize",()=>{fh.onresize()}),globalThis.__PIXI_APP__=fh});function ym(){return fh.screen}})();
/*! Bundled license information:

punycode/punycode.js:
  (*! https://mths.be/punycode v1.4.1 by @mathias *)

tweedle.js/dist/tweedle.es.js:
  (*!
   * tweedle.js - v2.1.0
   * Compiled Wed, 05 Apr 2023 15:21:25 UTC
   *
   * tweedle.js is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   * 
   * Copyright 2019-2021, Milton Candelero <miltoncandelero@gmail.com>, All Rights Reserved
   *)
*/
