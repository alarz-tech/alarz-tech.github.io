(()=>{var vg=Object.create;var bh=Object.defineProperty;var wg=Object.getOwnPropertyDescriptor;var Tg=Object.getOwnPropertyNames;var Eg=Object.getPrototypeOf,Sg=Object.prototype.hasOwnProperty;var dt=(r,t)=>()=>(t||r((t={exports:{}}).exports,t),t.exports),Ag=(r,t)=>{for(var e in t)bh(r,e,{get:t[e],enumerable:!0})},Cg=(r,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of Tg(t))!Sg.call(r,s)&&s!==e&&bh(r,s,{get:()=>t[s],enumerable:!(i=wg(t,s))||i.enumerable});return r};var _h=(r,t,e)=>(e=r!=null?vg(Eg(r)):{},Cg(t||!r||!r.__esModule?bh(e,"default",{value:r,enumerable:!0}):e,r));var Gu=dt((_T,Eh)=>{"use strict";var Rg=Object.prototype.hasOwnProperty,Jt="~";function ks(){}Object.create&&(ks.prototype=Object.create(null),new ks().__proto__||(Jt=!1));function Mg(r,t,e){this.fn=r,this.context=t,this.once=e||!1}function Uu(r,t,e,i,s){if(typeof e!="function")throw new TypeError("The listener must be a function");var n=new Mg(e,i||r,s),o=Jt?Jt+t:t;return r._events[o]?r._events[o].fn?r._events[o]=[r._events[o],n]:r._events[o].push(n):(r._events[o]=n,r._eventsCount++),r}function uo(r,t){--r._eventsCount===0?r._events=new ks:delete r._events[t]}function jt(){this._events=new ks,this._eventsCount=0}jt.prototype.eventNames=function(){var t=[],e,i;if(this._eventsCount===0)return t;for(i in e=this._events)Rg.call(e,i)&&t.push(Jt?i.slice(1):i);return Object.getOwnPropertySymbols?t.concat(Object.getOwnPropertySymbols(e)):t};jt.prototype.listeners=function(t){var e=Jt?Jt+t:t,i=this._events[e];if(!i)return[];if(i.fn)return[i.fn];for(var s=0,n=i.length,o=new Array(n);s<n;s++)o[s]=i[s].fn;return o};jt.prototype.listenerCount=function(t){var e=Jt?Jt+t:t,i=this._events[e];return i?i.fn?1:i.length:0};jt.prototype.emit=function(t,e,i,s,n,o){var a=Jt?Jt+t:t;if(!this._events[a])return!1;var h=this._events[a],l=arguments.length,c,u;if(h.fn){switch(h.once&&this.removeListener(t,h.fn,void 0,!0),l){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,e),!0;case 3:return h.fn.call(h.context,e,i),!0;case 4:return h.fn.call(h.context,e,i,s),!0;case 5:return h.fn.call(h.context,e,i,s,n),!0;case 6:return h.fn.call(h.context,e,i,s,n,o),!0}for(u=1,c=new Array(l-1);u<l;u++)c[u-1]=arguments[u];h.fn.apply(h.context,c)}else{var d=h.length,p;for(u=0;u<d;u++)switch(h[u].once&&this.removeListener(t,h[u].fn,void 0,!0),l){case 1:h[u].fn.call(h[u].context);break;case 2:h[u].fn.call(h[u].context,e);break;case 3:h[u].fn.call(h[u].context,e,i);break;case 4:h[u].fn.call(h[u].context,e,i,s);break;default:if(!c)for(p=1,c=new Array(l-1);p<l;p++)c[p-1]=arguments[p];h[u].fn.apply(h[u].context,c)}}return!0};jt.prototype.on=function(t,e,i){return Uu(this,t,e,i,!1)};jt.prototype.once=function(t,e,i){return Uu(this,t,e,i,!0)};jt.prototype.removeListener=function(t,e,i,s){var n=Jt?Jt+t:t;if(!this._events[n])return this;if(!e)return uo(this,n),this;var o=this._events[n];if(o.fn)o.fn===e&&(!s||o.once)&&(!i||o.context===i)&&uo(this,n);else{for(var a=0,h=[],l=o.length;a<l;a++)(o[a].fn!==e||s&&!o[a].once||i&&o[a].context!==i)&&h.push(o[a]);h.length?this._events[n]=h.length===1?h[0]:h:uo(this,n)}return this};jt.prototype.removeAllListeners=function(t){var e;return t?(e=Jt?Jt+t:t,this._events[e]&&uo(this,e)):(this._events=new ks,this._eventsCount=0),this};jt.prototype.off=jt.prototype.removeListener;jt.prototype.addListener=jt.prototype.on;jt.prefixed=Jt;jt.EventEmitter=jt;typeof Eh<"u"&&(Eh.exports=jt)});var zu=dt((xT,Ih)=>{"use strict";Ih.exports=mo;Ih.exports.default=mo;function mo(r,t,e){e=e||2;var i=t&&t.length,s=i?t[0]*e:r.length,n=Vu(r,0,s,e,!0),o=[];if(!n||n.next===n.prev)return o;var a,h,l,c,u,d,p;if(i&&(n=Og(r,t,n,e)),r.length>80*e){a=l=r[0],h=c=r[1];for(var f=e;f<s;f+=e)u=r[f],d=r[f+1],u<a&&(a=u),d<h&&(h=d),u>l&&(l=u),d>c&&(c=d);p=Math.max(l-a,c-h),p=p!==0?32767/p:0}return Os(n,o,e,a,h,p,0),o}function Vu(r,t,e,i,s){var n,o;if(s===Ch(r,t,e,i)>0)for(n=t;n<e;n+=i)o=Hu(n,r[n],r[n+1],o);else for(n=e-i;n>=t;n-=i)o=Hu(n,r[n],r[n+1],o);return o&&go(o,o.next)&&(Ds(o),o=o.next),o}function Vr(r,t){if(!r)return r;t||(t=r);var e=r,i;do if(i=!1,!e.steiner&&(go(e,e.next)||bt(e.prev,e,e.next)===0)){if(Ds(e),e=t=e.prev,e===e.next)break;i=!0}else e=e.next;while(i||e!==t);return t}function Os(r,t,e,i,s,n,o){if(r){!o&&n&&Hg(r,i,s,n);for(var a=r,h,l;r.prev!==r.next;){if(h=r.prev,l=r.next,n?Bg(r,i,s,n):Fg(r)){t.push(h.i/e|0),t.push(r.i/e|0),t.push(l.i/e|0),Ds(r),r=l.next,a=l.next;continue}if(r=l,r===a){o?o===1?(r=Lg(Vr(r),t,e),Os(r,t,e,i,s,n,2)):o===2&&kg(r,t,e,i,s,n):Os(Vr(r),t,e,i,s,n,1);break}}}}function Fg(r){var t=r.prev,e=r,i=r.next;if(bt(t,e,i)>=0)return!1;for(var s=t.x,n=e.x,o=i.x,a=t.y,h=e.y,l=i.y,c=s<n?s<o?s:o:n<o?n:o,u=a<h?a<l?a:l:h<l?h:l,d=s>n?s>o?s:o:n>o?n:o,p=a>h?a>l?a:l:h>l?h:l,f=i.next;f!==t;){if(f.x>=c&&f.x<=d&&f.y>=u&&f.y<=p&&Ei(s,a,n,h,o,l,f.x,f.y)&&bt(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function Bg(r,t,e,i){var s=r.prev,n=r,o=r.next;if(bt(s,n,o)>=0)return!1;for(var a=s.x,h=n.x,l=o.x,c=s.y,u=n.y,d=o.y,p=a<h?a<l?a:l:h<l?h:l,f=c<u?c<d?c:d:u<d?u:d,m=a>h?a>l?a:l:h>l?h:l,b=c>u?c>d?c:d:u>d?u:d,y=Sh(p,f,t,e,i),v=Sh(m,b,t,e,i),g=r.prevZ,_=r.nextZ;g&&g.z>=y&&_&&_.z<=v;){if(g.x>=p&&g.x<=m&&g.y>=f&&g.y<=b&&g!==s&&g!==o&&Ei(a,c,h,u,l,d,g.x,g.y)&&bt(g.prev,g,g.next)>=0||(g=g.prevZ,_.x>=p&&_.x<=m&&_.y>=f&&_.y<=b&&_!==s&&_!==o&&Ei(a,c,h,u,l,d,_.x,_.y)&&bt(_.prev,_,_.next)>=0))return!1;_=_.nextZ}for(;g&&g.z>=y;){if(g.x>=p&&g.x<=m&&g.y>=f&&g.y<=b&&g!==s&&g!==o&&Ei(a,c,h,u,l,d,g.x,g.y)&&bt(g.prev,g,g.next)>=0)return!1;g=g.prevZ}for(;_&&_.z<=v;){if(_.x>=p&&_.x<=m&&_.y>=f&&_.y<=b&&_!==s&&_!==o&&Ei(a,c,h,u,l,d,_.x,_.y)&&bt(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function Lg(r,t,e){var i=r;do{var s=i.prev,n=i.next.next;!go(s,n)&&ju(s,i,i.next,n)&&Ns(s,n)&&Ns(n,s)&&(t.push(s.i/e|0),t.push(i.i/e|0),t.push(n.i/e|0),Ds(i),Ds(i.next),i=r=n),i=i.next}while(i!==r);return Vr(i)}function kg(r,t,e,i,s,n){var o=r;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&$g(o,a)){var h=$u(o,a);o=Vr(o,o.next),h=Vr(h,h.next),Os(o,t,e,i,s,n,0),Os(h,t,e,i,s,n,0);return}a=a.next}o=o.next}while(o!==r)}function Og(r,t,e,i){var s=[],n,o,a,h,l;for(n=0,o=t.length;n<o;n++)a=t[n]*i,h=n<o-1?t[n+1]*i:r.length,l=Vu(r,a,h,i,!1),l===l.next&&(l.steiner=!0),s.push(jg(l));for(s.sort(Ng),n=0;n<s.length;n++)e=Dg(s[n],e);return e}function Ng(r,t){return r.x-t.x}function Dg(r,t){var e=Ug(r,t);if(!e)return t;var i=$u(e,r);return Vr(i,i.next),Vr(e,e.next)}function Ug(r,t){var e=t,i=r.x,s=r.y,n=-1/0,o;do{if(s<=e.y&&s>=e.next.y&&e.next.y!==e.y){var a=e.x+(s-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(a<=i&&a>n&&(n=a,o=e.x<e.next.x?e:e.next,a===i))return o}e=e.next}while(e!==t);if(!o)return null;var h=o,l=o.x,c=o.y,u=1/0,d;e=o;do i>=e.x&&e.x>=l&&i!==e.x&&Ei(s<c?i:n,s,l,c,s<c?n:i,s,e.x,e.y)&&(d=Math.abs(s-e.y)/(i-e.x),Ns(e,r)&&(d<u||d===u&&(e.x>o.x||e.x===o.x&&Gg(o,e)))&&(o=e,u=d)),e=e.next;while(e!==h);return o}function Gg(r,t){return bt(r.prev,r,t.prev)<0&&bt(t.next,r,r.next)<0}function Hg(r,t,e,i){var s=r;do s.z===0&&(s.z=Sh(s.x,s.y,t,e,i)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==r);s.prevZ.nextZ=null,s.prevZ=null,Vg(s)}function Vg(r){var t,e,i,s,n,o,a,h,l=1;do{for(e=r,r=null,n=null,o=0;e;){for(o++,i=e,a=0,t=0;t<l&&(a++,i=i.nextZ,!!i);t++);for(h=l;a>0||h>0&&i;)a!==0&&(h===0||!i||e.z<=i.z)?(s=e,e=e.nextZ,a--):(s=i,i=i.nextZ,h--),n?n.nextZ=s:r=s,s.prevZ=n,n=s;e=i}n.nextZ=null,l*=2}while(o>1);return r}function Sh(r,t,e,i,s){return r=(r-e)*s|0,t=(t-i)*s|0,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,r|t<<1}function jg(r){var t=r,e=r;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==r);return e}function Ei(r,t,e,i,s,n,o,a){return(s-o)*(t-a)>=(r-o)*(n-a)&&(r-o)*(i-a)>=(e-o)*(t-a)&&(e-o)*(n-a)>=(s-o)*(i-a)}function $g(r,t){return r.next.i!==t.i&&r.prev.i!==t.i&&!zg(r,t)&&(Ns(r,t)&&Ns(t,r)&&Wg(r,t)&&(bt(r.prev,r,t.prev)||bt(r,t.prev,t))||go(r,t)&&bt(r.prev,r,r.next)>0&&bt(t.prev,t,t.next)>0)}function bt(r,t,e){return(t.y-r.y)*(e.x-t.x)-(t.x-r.x)*(e.y-t.y)}function go(r,t){return r.x===t.x&&r.y===t.y}function ju(r,t,e,i){var s=fo(bt(r,t,e)),n=fo(bt(r,t,i)),o=fo(bt(e,i,r)),a=fo(bt(e,i,t));return!!(s!==n&&o!==a||s===0&&po(r,e,t)||n===0&&po(r,i,t)||o===0&&po(e,r,i)||a===0&&po(e,t,i))}function po(r,t,e){return t.x<=Math.max(r.x,e.x)&&t.x>=Math.min(r.x,e.x)&&t.y<=Math.max(r.y,e.y)&&t.y>=Math.min(r.y,e.y)}function fo(r){return r>0?1:r<0?-1:0}function zg(r,t){var e=r;do{if(e.i!==r.i&&e.next.i!==r.i&&e.i!==t.i&&e.next.i!==t.i&&ju(e,e.next,r,t))return!0;e=e.next}while(e!==r);return!1}function Ns(r,t){return bt(r.prev,r,r.next)<0?bt(r,t,r.next)>=0&&bt(r,r.prev,t)>=0:bt(r,t,r.prev)<0||bt(r,r.next,t)<0}function Wg(r,t){var e=r,i=!1,s=(r.x+t.x)/2,n=(r.y+t.y)/2;do e.y>n!=e.next.y>n&&e.next.y!==e.y&&s<(e.next.x-e.x)*(n-e.y)/(e.next.y-e.y)+e.x&&(i=!i),e=e.next;while(e!==r);return i}function $u(r,t){var e=new Ah(r.i,r.x,r.y),i=new Ah(t.i,t.x,t.y),s=r.next,n=t.prev;return r.next=t,t.prev=r,e.next=s,s.prev=e,i.next=e,e.prev=i,n.next=i,i.prev=n,i}function Hu(r,t,e,i){var s=new Ah(r,t,e);return i?(s.next=i.next,s.prev=i,i.next.prev=s,i.next=s):(s.prev=s,s.next=s),s}function Ds(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Ah(r,t,e){this.i=r,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}mo.deviation=function(r,t,e,i){var s=t&&t.length,n=s?t[0]*e:r.length,o=Math.abs(Ch(r,0,n,e));if(s)for(var a=0,h=t.length;a<h;a++){var l=t[a]*e,c=a<h-1?t[a+1]*e:r.length;o-=Math.abs(Ch(r,l,c,e))}var u=0;for(a=0;a<i.length;a+=3){var d=i[a]*e,p=i[a+1]*e,f=i[a+2]*e;u+=Math.abs((r[d]-r[f])*(r[p+1]-r[d+1])-(r[d]-r[p])*(r[f+1]-r[d+1]))}return o===0&&u===0?0:Math.abs((u-o)/o)};function Ch(r,t,e,i){for(var s=0,n=t,o=e-i;n<e;n+=i)s+=(r[o]-r[n])*(r[n+1]+r[o+1]),o=n;return s}mo.flatten=function(r){for(var t=r[0][0].length,e={vertices:[],holes:[],dimensions:t},i=0,s=0;s<r.length;s++){for(var n=0;n<r[s].length;n++)for(var o=0;o<t;o++)e.vertices.push(r[s][n][o]);s>0&&(i+=r[s-1].length,e.holes.push(i))}return e}});var Wu=dt((Si,Ai)=>{(function(r){var t=typeof Si=="object"&&Si&&!Si.nodeType&&Si,e=typeof Ai=="object"&&Ai&&!Ai.nodeType&&Ai,i=typeof global=="object"&&global;(i.global===i||i.window===i||i.self===i)&&(r=i);var s,n=2147483647,o=36,a=1,h=26,l=38,c=700,u=72,d=128,p="-",f=/^xn--/,m=/[^\x20-\x7E]/,b=/[\x2E\u3002\uFF0E\uFF61]/g,y={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},v=o-a,g=Math.floor,_=String.fromCharCode,L;function G(O){throw new RangeError(y[O])}function F(O,z){for(var Z=O.length,nt=[];Z--;)nt[Z]=z(O[Z]);return nt}function B(O,z){var Z=O.split("@"),nt="";Z.length>1&&(nt=Z[0]+"@",O=Z[1]),O=O.replace(b,".");var ft=O.split("."),wt=F(ft,z).join(".");return nt+wt}function $(O){for(var z=[],Z=0,nt=O.length,ft,wt;Z<nt;)ft=O.charCodeAt(Z++),ft>=55296&&ft<=56319&&Z<nt?(wt=O.charCodeAt(Z++),(wt&64512)==56320?z.push(((ft&1023)<<10)+(wt&1023)+65536):(z.push(ft),Z--)):z.push(ft);return z}function q(O){return F(O,function(z){var Z="";return z>65535&&(z-=65536,Z+=_(z>>>10&1023|55296),z=56320|z&1023),Z+=_(z),Z}).join("")}function ut(O){return O-48<10?O-22:O-65<26?O-65:O-97<26?O-97:o}function St(O,z){return O+22+75*(O<26)-((z!=0)<<5)}function k(O,z,Z){var nt=0;for(O=Z?g(O/c):O>>1,O+=g(O/z);O>v*h>>1;nt+=o)O=g(O/v);return g(nt+(v+1)*O/(O+l))}function U(O){var z=[],Z=O.length,nt,ft=0,wt=d,yt=u,Ht,ie,Kt,se,At,Tt,Ct,Vt,Zt;for(Ht=O.lastIndexOf(p),Ht<0&&(Ht=0),ie=0;ie<Ht;++ie)O.charCodeAt(ie)>=128&&G("not-basic"),z.push(O.charCodeAt(ie));for(Kt=Ht>0?Ht+1:0;Kt<Z;){for(se=ft,At=1,Tt=o;Kt>=Z&&G("invalid-input"),Ct=ut(O.charCodeAt(Kt++)),(Ct>=o||Ct>g((n-ft)/At))&&G("overflow"),ft+=Ct*At,Vt=Tt<=yt?a:Tt>=yt+h?h:Tt-yt,!(Ct<Vt);Tt+=o)Zt=o-Vt,At>g(n/Zt)&&G("overflow"),At*=Zt;nt=z.length+1,yt=k(ft-se,nt,se==0),g(ft/nt)>n-wt&&G("overflow"),wt+=g(ft/nt),ft%=nt,z.splice(ft++,0,wt)}return q(z)}function pe(O){var z,Z,nt,ft,wt,yt,Ht,ie,Kt,se,At,Tt=[],Ct,Vt,Zt,Bs;for(O=$(O),Ct=O.length,z=d,Z=0,wt=u,yt=0;yt<Ct;++yt)At=O[yt],At<128&&Tt.push(_(At));for(nt=ft=Tt.length,ft&&Tt.push(p);nt<Ct;){for(Ht=n,yt=0;yt<Ct;++yt)At=O[yt],At>=z&&At<Ht&&(Ht=At);for(Vt=nt+1,Ht-z>g((n-Z)/Vt)&&G("overflow"),Z+=(Ht-z)*Vt,z=Ht,yt=0;yt<Ct;++yt)if(At=O[yt],At<z&&++Z>n&&G("overflow"),At==z){for(ie=Z,Kt=o;se=Kt<=wt?a:Kt>=wt+h?h:Kt-wt,!(ie<se);Kt+=o)Bs=ie-se,Zt=o-se,Tt.push(_(St(se+Bs%Zt,0))),ie=g(Bs/Zt);Tt.push(_(St(ie,0))),wt=k(Z,Vt,nt==ft),Z=0,++nt}++Z,++z}return Tt.join("")}function qt(O){return B(O,function(z){return f.test(z)?U(z.slice(4).toLowerCase()):z})}function at(O){return B(O,function(z){return m.test(z)?"xn--"+pe(z):z})}if(s={version:"1.4.1",ucs2:{decode:$,encode:q},decode:U,encode:pe,toASCII:at,toUnicode:qt},typeof define=="function"&&typeof define.amd=="object"&&define.amd)define("punycode",function(){return s});else if(t&&e)if(Ai.exports==t)e.exports=s;else for(L in s)s.hasOwnProperty(L)&&(t[L]=s[L]);else r.punycode=s})(Si)});var Yu=dt((vT,Xu)=>{"use strict";Xu.exports=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var t={},e=Symbol("test"),i=Object(e);if(typeof e=="string"||Object.prototype.toString.call(e)!=="[object Symbol]"||Object.prototype.toString.call(i)!=="[object Symbol]")return!1;var s=42;t[e]=s;for(e in t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var n=Object.getOwnPropertySymbols(t);if(n.length!==1||n[0]!==e||!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var o=Object.getOwnPropertyDescriptor(t,e);if(o.value!==s||o.enumerable!==!0)return!1}return!0}});var Zu=dt((wT,Ku)=>{"use strict";var qu=typeof Symbol<"u"&&Symbol,Xg=Yu();Ku.exports=function(){return typeof qu!="function"||typeof Symbol!="function"||typeof qu("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:Xg()}});var td=dt((TT,Ju)=>{"use strict";var Qu={foo:{}},Yg=Object;Ju.exports=function(){return{__proto__:Qu}.foo===Qu.foo&&!({__proto__:null}instanceof Yg)}});var id=dt((ET,rd)=>{"use strict";var qg="Function.prototype.bind called on incompatible ",Kg=Object.prototype.toString,Zg=Math.max,Qg="[object Function]",ed=function(t,e){for(var i=[],s=0;s<t.length;s+=1)i[s]=t[s];for(var n=0;n<e.length;n+=1)i[n+t.length]=e[n];return i},Jg=function(t,e){for(var i=[],s=e||0,n=0;s<t.length;s+=1,n+=1)i[n]=t[s];return i},ty=function(r,t){for(var e="",i=0;i<r.length;i+=1)e+=r[i],i+1<r.length&&(e+=t);return e};rd.exports=function(t){var e=this;if(typeof e!="function"||Kg.apply(e)!==Qg)throw new TypeError(qg+e);for(var i=Jg(arguments,1),s,n=function(){if(this instanceof s){var c=e.apply(this,ed(i,arguments));return Object(c)===c?c:this}return e.apply(t,ed(i,arguments))},o=Zg(0,e.length-i.length),a=[],h=0;h<o;h++)a[h]="$"+h;if(s=Function("binder","return function ("+ty(a,",")+"){ return binder.apply(this,arguments); }")(n),e.prototype){var l=function(){};l.prototype=e.prototype,s.prototype=new l,l.prototype=null}return s}});var yo=dt((ST,sd)=>{"use strict";var ey=id();sd.exports=Function.prototype.bind||ey});var od=dt((AT,nd)=>{"use strict";var ry=Function.prototype.call,iy=Object.prototype.hasOwnProperty,sy=yo();nd.exports=sy.call(ry,iy)});var xr=dt((CT,ud)=>{"use strict";var Q,Ri=SyntaxError,cd=Function,Pi=TypeError,Ph=function(r){try{return cd('"use strict"; return ('+r+").constructor;")()}catch{}},jr=Object.getOwnPropertyDescriptor;if(jr)try{jr({},"")}catch{jr=null}var Rh=function(){throw new Pi},ny=jr?function(){try{return arguments.callee,Rh}catch{try{return jr(arguments,"callee").get}catch{return Rh}}}():Rh,Ci=Zu()(),oy=td()(),Pt=Object.getPrototypeOf||(oy?function(r){return r.__proto__}:null),Ii={},ay=typeof Uint8Array>"u"||!Pt?Q:Pt(Uint8Array),$r={"%AggregateError%":typeof AggregateError>"u"?Q:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?Q:ArrayBuffer,"%ArrayIteratorPrototype%":Ci&&Pt?Pt([][Symbol.iterator]()):Q,"%AsyncFromSyncIteratorPrototype%":Q,"%AsyncFunction%":Ii,"%AsyncGenerator%":Ii,"%AsyncGeneratorFunction%":Ii,"%AsyncIteratorPrototype%":Ii,"%Atomics%":typeof Atomics>"u"?Q:Atomics,"%BigInt%":typeof BigInt>"u"?Q:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?Q:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?Q:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?Q:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":typeof Float32Array>"u"?Q:Float32Array,"%Float64Array%":typeof Float64Array>"u"?Q:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?Q:FinalizationRegistry,"%Function%":cd,"%GeneratorFunction%":Ii,"%Int8Array%":typeof Int8Array>"u"?Q:Int8Array,"%Int16Array%":typeof Int16Array>"u"?Q:Int16Array,"%Int32Array%":typeof Int32Array>"u"?Q:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":Ci&&Pt?Pt(Pt([][Symbol.iterator]())):Q,"%JSON%":typeof JSON=="object"?JSON:Q,"%Map%":typeof Map>"u"?Q:Map,"%MapIteratorPrototype%":typeof Map>"u"||!Ci||!Pt?Q:Pt(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?Q:Promise,"%Proxy%":typeof Proxy>"u"?Q:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":typeof Reflect>"u"?Q:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?Q:Set,"%SetIteratorPrototype%":typeof Set>"u"||!Ci||!Pt?Q:Pt(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?Q:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":Ci&&Pt?Pt(""[Symbol.iterator]()):Q,"%Symbol%":Ci?Symbol:Q,"%SyntaxError%":Ri,"%ThrowTypeError%":ny,"%TypedArray%":ay,"%TypeError%":Pi,"%Uint8Array%":typeof Uint8Array>"u"?Q:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?Q:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?Q:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?Q:Uint32Array,"%URIError%":URIError,"%WeakMap%":typeof WeakMap>"u"?Q:WeakMap,"%WeakRef%":typeof WeakRef>"u"?Q:WeakRef,"%WeakSet%":typeof WeakSet>"u"?Q:WeakSet};if(Pt)try{null.error}catch(r){ad=Pt(Pt(r)),$r["%Error.prototype%"]=ad}var ad,hy=function r(t){var e;if(t==="%AsyncFunction%")e=Ph("async function () {}");else if(t==="%GeneratorFunction%")e=Ph("function* () {}");else if(t==="%AsyncGeneratorFunction%")e=Ph("async function* () {}");else if(t==="%AsyncGenerator%"){var i=r("%AsyncGeneratorFunction%");i&&(e=i.prototype)}else if(t==="%AsyncIteratorPrototype%"){var s=r("%AsyncGenerator%");s&&Pt&&(e=Pt(s.prototype))}return $r[t]=e,e},hd={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Us=yo(),bo=od(),ly=Us.call(Function.call,Array.prototype.concat),cy=Us.call(Function.apply,Array.prototype.splice),ld=Us.call(Function.call,String.prototype.replace),_o=Us.call(Function.call,String.prototype.slice),uy=Us.call(Function.call,RegExp.prototype.exec),dy=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,py=/\\(\\)?/g,fy=function(t){var e=_o(t,0,1),i=_o(t,-1);if(e==="%"&&i!=="%")throw new Ri("invalid intrinsic syntax, expected closing `%`");if(i==="%"&&e!=="%")throw new Ri("invalid intrinsic syntax, expected opening `%`");var s=[];return ld(t,dy,function(n,o,a,h){s[s.length]=a?ld(h,py,"$1"):o||n}),s},my=function(t,e){var i=t,s;if(bo(hd,i)&&(s=hd[i],i="%"+s[0]+"%"),bo($r,i)){var n=$r[i];if(n===Ii&&(n=hy(i)),typeof n>"u"&&!e)throw new Pi("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:s,name:i,value:n}}throw new Ri("intrinsic "+t+" does not exist!")};ud.exports=function(t,e){if(typeof t!="string"||t.length===0)throw new Pi("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof e!="boolean")throw new Pi('"allowMissing" argument must be a boolean');if(uy(/^%?[^%]*%?$/,t)===null)throw new Ri("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var i=fy(t),s=i.length>0?i[0]:"",n=my("%"+s+"%",e),o=n.name,a=n.value,h=!1,l=n.alias;l&&(s=l[0],cy(i,ly([0,1],l)));for(var c=1,u=!0;c<i.length;c+=1){var d=i[c],p=_o(d,0,1),f=_o(d,-1);if((p==='"'||p==="'"||p==="`"||f==='"'||f==="'"||f==="`")&&p!==f)throw new Ri("property names with quotes must have matching quotes");if((d==="constructor"||!u)&&(h=!0),s+="."+d,o="%"+s+"%",bo($r,o))a=$r[o];else if(a!=null){if(!(d in a)){if(!e)throw new Pi("base intrinsic for "+t+" exists, but the property is not available.");return}if(jr&&c+1>=i.length){var m=jr(a,d);u=!!m,u&&"get"in m&&!("originalValue"in m.get)?a=m.get:a=a[d]}else u=bo(a,d),a=a[d];u&&!h&&($r[o]=a)}}return a}});var Bh=dt((IT,dd)=>{"use strict";var gy=xr(),Mh=gy("%Object.defineProperty%",!0),Fh=function(){if(Mh)try{return Mh({},"a",{value:1}),!0}catch{return!1}return!1};Fh.hasArrayLengthDefineBug=function(){if(!Fh())return null;try{return Mh([],"length",{value:1}).length!==1}catch{return!0}};dd.exports=Fh});var Lh=dt((PT,pd)=>{"use strict";var yy=xr(),xo=yy("%Object.getOwnPropertyDescriptor%",!0);if(xo)try{xo([],"length")}catch{xo=null}pd.exports=xo});var gd=dt((RT,md)=>{"use strict";var by=Bh()(),kh=xr(),Gs=by&&kh("%Object.defineProperty%",!0);if(Gs)try{Gs({},"a",{value:1})}catch{Gs=!1}var _y=kh("%SyntaxError%"),Mi=kh("%TypeError%"),fd=Lh();md.exports=function(t,e,i){if(!t||typeof t!="object"&&typeof t!="function")throw new Mi("`obj` must be an object or a function`");if(typeof e!="string"&&typeof e!="symbol")throw new Mi("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new Mi("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new Mi("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new Mi("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new Mi("`loose`, if provided, must be a boolean");var s=arguments.length>3?arguments[3]:null,n=arguments.length>4?arguments[4]:null,o=arguments.length>5?arguments[5]:null,a=arguments.length>6?arguments[6]:!1,h=!!fd&&fd(t,e);if(Gs)Gs(t,e,{configurable:o===null&&h?h.configurable:!o,enumerable:s===null&&h?h.enumerable:!s,value:i,writable:n===null&&h?h.writable:!n});else if(a||!s&&!n&&!o)t[e]=i;else throw new _y("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")}});var wd=dt((MT,vd)=>{"use strict";var xd=xr(),yd=gd(),xy=Bh()(),bd=Lh(),_d=xd("%TypeError%"),vy=xd("%Math.floor%");vd.exports=function(t,e){if(typeof t!="function")throw new _d("`fn` is not a function");if(typeof e!="number"||e<0||e>4294967295||vy(e)!==e)throw new _d("`length` must be a positive 32-bit integer");var i=arguments.length>2&&!!arguments[2],s=!0,n=!0;if("length"in t&&bd){var o=bd(t,"length");o&&!o.configurable&&(s=!1),o&&!o.writable&&(n=!1)}return(s||n||!i)&&(xy?yd(t,"length",e,!0,!0):yd(t,"length",e)),t}});var Cd=dt((FT,vo)=>{"use strict";var Oh=yo(),Fi=xr(),wy=wd(),Ty=Fi("%TypeError%"),Ed=Fi("%Function.prototype.apply%"),Sd=Fi("%Function.prototype.call%"),Ad=Fi("%Reflect.apply%",!0)||Oh.call(Sd,Ed),Hs=Fi("%Object.defineProperty%",!0),Ey=Fi("%Math.max%");if(Hs)try{Hs({},"a",{value:1})}catch{Hs=null}vo.exports=function(t){if(typeof t!="function")throw new Ty("a function is required");var e=Ad(Oh,Sd,arguments);return wy(e,1+Ey(0,t.length-(arguments.length-1)),!0)};var Td=function(){return Ad(Oh,Ed,arguments)};Hs?Hs(vo.exports,"apply",{value:Td}):vo.exports.apply=Td});var Md=dt((BT,Rd)=>{"use strict";var Id=xr(),Pd=Cd(),Sy=Pd(Id("String.prototype.indexOf"));Rd.exports=function(t,e){var i=Id(t,!!e);return typeof i=="function"&&Sy(t,".prototype.")>-1?Pd(i):i}});var Fd=dt(()=>{});var Qd=dt((OT,Zd)=>{var Wh=typeof Map=="function"&&Map.prototype,Nh=Object.getOwnPropertyDescriptor&&Wh?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,To=Wh&&Nh&&typeof Nh.get=="function"?Nh.get:null,Bd=Wh&&Map.prototype.forEach,Xh=typeof Set=="function"&&Set.prototype,Dh=Object.getOwnPropertyDescriptor&&Xh?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,Eo=Xh&&Dh&&typeof Dh.get=="function"?Dh.get:null,Ld=Xh&&Set.prototype.forEach,Ay=typeof WeakMap=="function"&&WeakMap.prototype,js=Ay?WeakMap.prototype.has:null,Cy=typeof WeakSet=="function"&&WeakSet.prototype,$s=Cy?WeakSet.prototype.has:null,Iy=typeof WeakRef=="function"&&WeakRef.prototype,kd=Iy?WeakRef.prototype.deref:null,Py=Boolean.prototype.valueOf,Ry=Object.prototype.toString,My=Function.prototype.toString,Fy=String.prototype.match,Yh=String.prototype.slice,wr=String.prototype.replace,By=String.prototype.toUpperCase,Od=String.prototype.toLowerCase,zd=RegExp.prototype.test,Nd=Array.prototype.concat,Ue=Array.prototype.join,Ly=Array.prototype.slice,Dd=Math.floor,Hh=typeof BigInt=="function"?BigInt.prototype.valueOf:null,Uh=Object.getOwnPropertySymbols,Vh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,Bi=typeof Symbol=="function"&&typeof Symbol.iterator=="object",$t=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===Bi||!0)?Symbol.toStringTag:null,Wd=Object.prototype.propertyIsEnumerable,Ud=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(r){return r.__proto__}:null);function Gd(r,t){if(r===1/0||r===-1/0||r!==r||r&&r>-1e3&&r<1e3||zd.call(/e/,t))return t;var e=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof r=="number"){var i=r<0?-Dd(-r):Dd(r);if(i!==r){var s=String(i),n=Yh.call(t,s.length+1);return wr.call(s,e,"$&_")+"."+wr.call(wr.call(n,/([0-9]{3})/g,"$&_"),/_$/,"")}}return wr.call(t,e,"$&_")}var jh=Fd(),Hd=jh.custom,Vd=Yd(Hd)?Hd:null;Zd.exports=function r(t,e,i,s){var n=e||{};if(vr(n,"quoteStyle")&&n.quoteStyle!=="single"&&n.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(vr(n,"maxStringLength")&&(typeof n.maxStringLength=="number"?n.maxStringLength<0&&n.maxStringLength!==1/0:n.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var o=vr(n,"customInspect")?n.customInspect:!0;if(typeof o!="boolean"&&o!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(vr(n,"indent")&&n.indent!==null&&n.indent!=="	"&&!(parseInt(n.indent,10)===n.indent&&n.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(vr(n,"numericSeparator")&&typeof n.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var a=n.numericSeparator;if(typeof t>"u")return"undefined";if(t===null)return"null";if(typeof t=="boolean")return t?"true":"false";if(typeof t=="string")return Kd(t,n);if(typeof t=="number"){if(t===0)return 1/0/t>0?"0":"-0";var h=String(t);return a?Gd(t,h):h}if(typeof t=="bigint"){var l=String(t)+"n";return a?Gd(t,l):l}var c=typeof n.depth>"u"?5:n.depth;if(typeof i>"u"&&(i=0),i>=c&&c>0&&typeof t=="object")return $h(t)?"[Array]":"[Object]";var u=Qy(n,i);if(typeof s>"u")s=[];else if(qd(s,t)>=0)return"[Circular]";function d(k,U,pe){if(U&&(s=Ly.call(s),s.push(U)),pe){var qt={depth:n.depth};return vr(n,"quoteStyle")&&(qt.quoteStyle=n.quoteStyle),r(k,qt,i+1,s)}return r(k,n,i+1,s)}if(typeof t=="function"&&!jd(t)){var p=jy(t),f=wo(t,d);return"[Function"+(p?": "+p:" (anonymous)")+"]"+(f.length>0?" { "+Ue.call(f,", ")+" }":"")}if(Yd(t)){var m=Bi?wr.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):Vh.call(t);return typeof t=="object"&&!Bi?Vs(m):m}if(qy(t)){for(var b="<"+Od.call(String(t.nodeName)),y=t.attributes||[],v=0;v<y.length;v++)b+=" "+y[v].name+"="+Xd(ky(y[v].value),"double",n);return b+=">",t.childNodes&&t.childNodes.length&&(b+="..."),b+="</"+Od.call(String(t.nodeName))+">",b}if($h(t)){if(t.length===0)return"[]";var g=wo(t,d);return u&&!Zy(g)?"["+zh(g,u)+"]":"[ "+Ue.call(g,", ")+" ]"}if(Ny(t)){var _=wo(t,d);return!("cause"in Error.prototype)&&"cause"in t&&!Wd.call(t,"cause")?"{ ["+String(t)+"] "+Ue.call(Nd.call("[cause]: "+d(t.cause),_),", ")+" }":_.length===0?"["+String(t)+"]":"{ ["+String(t)+"] "+Ue.call(_,", ")+" }"}if(typeof t=="object"&&o){if(Vd&&typeof t[Vd]=="function"&&jh)return jh(t,{depth:c-i});if(o!=="symbol"&&typeof t.inspect=="function")return t.inspect()}if($y(t)){var L=[];return Bd&&Bd.call(t,function(k,U){L.push(d(U,t,!0)+" => "+d(k,t))}),$d("Map",To.call(t),L,u)}if(Xy(t)){var G=[];return Ld&&Ld.call(t,function(k){G.push(d(k,t))}),$d("Set",Eo.call(t),G,u)}if(zy(t))return Gh("WeakMap");if(Yy(t))return Gh("WeakSet");if(Wy(t))return Gh("WeakRef");if(Uy(t))return Vs(d(Number(t)));if(Hy(t))return Vs(d(Hh.call(t)));if(Gy(t))return Vs(Py.call(t));if(Dy(t))return Vs(d(String(t)));if(typeof window<"u"&&t===window)return"{ [object Window] }";if(t===global)return"{ [object globalThis] }";if(!Oy(t)&&!jd(t)){var F=wo(t,d),B=Ud?Ud(t)===Object.prototype:t instanceof Object||t.constructor===Object,$=t instanceof Object?"":"null prototype",q=!B&&$t&&Object(t)===t&&$t in t?Yh.call(Tr(t),8,-1):$?"Object":"",ut=B||typeof t.constructor!="function"?"":t.constructor.name?t.constructor.name+" ":"",St=ut+(q||$?"["+Ue.call(Nd.call([],q||[],$||[]),": ")+"] ":"");return F.length===0?St+"{}":u?St+"{"+zh(F,u)+"}":St+"{ "+Ue.call(F,", ")+" }"}return String(t)};function Xd(r,t,e){var i=(e.quoteStyle||t)==="double"?'"':"'";return i+r+i}function ky(r){return wr.call(String(r),/"/g,"&quot;")}function $h(r){return Tr(r)==="[object Array]"&&(!$t||!(typeof r=="object"&&$t in r))}function Oy(r){return Tr(r)==="[object Date]"&&(!$t||!(typeof r=="object"&&$t in r))}function jd(r){return Tr(r)==="[object RegExp]"&&(!$t||!(typeof r=="object"&&$t in r))}function Ny(r){return Tr(r)==="[object Error]"&&(!$t||!(typeof r=="object"&&$t in r))}function Dy(r){return Tr(r)==="[object String]"&&(!$t||!(typeof r=="object"&&$t in r))}function Uy(r){return Tr(r)==="[object Number]"&&(!$t||!(typeof r=="object"&&$t in r))}function Gy(r){return Tr(r)==="[object Boolean]"&&(!$t||!(typeof r=="object"&&$t in r))}function Yd(r){if(Bi)return r&&typeof r=="object"&&r instanceof Symbol;if(typeof r=="symbol")return!0;if(!r||typeof r!="object"||!Vh)return!1;try{return Vh.call(r),!0}catch{}return!1}function Hy(r){if(!r||typeof r!="object"||!Hh)return!1;try{return Hh.call(r),!0}catch{}return!1}var Vy=Object.prototype.hasOwnProperty||function(r){return r in this};function vr(r,t){return Vy.call(r,t)}function Tr(r){return Ry.call(r)}function jy(r){if(r.name)return r.name;var t=Fy.call(My.call(r),/^function\s*([\w$]+)/);return t?t[1]:null}function qd(r,t){if(r.indexOf)return r.indexOf(t);for(var e=0,i=r.length;e<i;e++)if(r[e]===t)return e;return-1}function $y(r){if(!To||!r||typeof r!="object")return!1;try{To.call(r);try{Eo.call(r)}catch{return!0}return r instanceof Map}catch{}return!1}function zy(r){if(!js||!r||typeof r!="object")return!1;try{js.call(r,js);try{$s.call(r,$s)}catch{return!0}return r instanceof WeakMap}catch{}return!1}function Wy(r){if(!kd||!r||typeof r!="object")return!1;try{return kd.call(r),!0}catch{}return!1}function Xy(r){if(!Eo||!r||typeof r!="object")return!1;try{Eo.call(r);try{To.call(r)}catch{return!0}return r instanceof Set}catch{}return!1}function Yy(r){if(!$s||!r||typeof r!="object")return!1;try{$s.call(r,$s);try{js.call(r,js)}catch{return!0}return r instanceof WeakSet}catch{}return!1}function qy(r){return!r||typeof r!="object"?!1:typeof HTMLElement<"u"&&r instanceof HTMLElement?!0:typeof r.nodeName=="string"&&typeof r.getAttribute=="function"}function Kd(r,t){if(r.length>t.maxStringLength){var e=r.length-t.maxStringLength,i="... "+e+" more character"+(e>1?"s":"");return Kd(Yh.call(r,0,t.maxStringLength),t)+i}var s=wr.call(wr.call(r,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,Ky);return Xd(s,"single",t)}function Ky(r){var t=r.charCodeAt(0),e={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return e?"\\"+e:"\\x"+(t<16?"0":"")+By.call(t.toString(16))}function Vs(r){return"Object("+r+")"}function Gh(r){return r+" { ? }"}function $d(r,t,e,i){var s=i?zh(e,i):Ue.call(e,", ");return r+" ("+t+") {"+s+"}"}function Zy(r){for(var t=0;t<r.length;t++)if(qd(r[t],`
`)>=0)return!1;return!0}function Qy(r,t){var e;if(r.indent==="	")e="	";else if(typeof r.indent=="number"&&r.indent>0)e=Ue.call(Array(r.indent+1)," ");else return null;return{base:e,prev:Ue.call(Array(t+1),e)}}function zh(r,t){if(r.length===0)return"";var e=`
`+t.prev+t.base;return e+Ue.call(r,","+e)+`
`+t.prev}function wo(r,t){var e=$h(r),i=[];if(e){i.length=r.length;for(var s=0;s<r.length;s++)i[s]=vr(r,s)?t(r[s],r):""}var n=typeof Uh=="function"?Uh(r):[],o;if(Bi){o={};for(var a=0;a<n.length;a++)o["$"+n[a]]=n[a]}for(var h in r)vr(r,h)&&(e&&String(Number(h))===h&&h<r.length||Bi&&o["$"+h]instanceof Symbol||(zd.call(/[^\w$]/,h)?i.push(t(h,r)+": "+t(r[h],r)):i.push(h+": "+t(r[h],r))));if(typeof Uh=="function")for(var l=0;l<n.length;l++)Wd.call(r,n[l])&&i.push("["+t(n[l])+"]: "+t(r[n[l]],r));return i}});var tp=dt((NT,Jd)=>{"use strict";var qh=xr(),Li=Md(),Jy=Qd(),tb=qh("%TypeError%"),So=qh("%WeakMap%",!0),Ao=qh("%Map%",!0),eb=Li("WeakMap.prototype.get",!0),rb=Li("WeakMap.prototype.set",!0),ib=Li("WeakMap.prototype.has",!0),sb=Li("Map.prototype.get",!0),nb=Li("Map.prototype.set",!0),ob=Li("Map.prototype.has",!0),Kh=function(r,t){for(var e=r,i;(i=e.next)!==null;e=i)if(i.key===t)return e.next=i.next,i.next=r.next,r.next=i,i},ab=function(r,t){var e=Kh(r,t);return e&&e.value},hb=function(r,t,e){var i=Kh(r,t);i?i.value=e:r.next={key:t,next:r.next,value:e}},lb=function(r,t){return!!Kh(r,t)};Jd.exports=function(){var t,e,i,s={assert:function(n){if(!s.has(n))throw new tb("Side channel does not contain "+Jy(n))},get:function(n){if(So&&n&&(typeof n=="object"||typeof n=="function")){if(t)return eb(t,n)}else if(Ao){if(e)return sb(e,n)}else if(i)return ab(i,n)},has:function(n){if(So&&n&&(typeof n=="object"||typeof n=="function")){if(t)return ib(t,n)}else if(Ao){if(e)return ob(e,n)}else if(i)return lb(i,n);return!1},set:function(n,o){So&&n&&(typeof n=="object"||typeof n=="function")?(t||(t=new So),rb(t,n,o)):Ao?(e||(e=new Ao),nb(e,n,o)):(i||(i={key:{},next:null}),hb(i,n,o))}};return s}});var Co=dt((DT,ep)=>{"use strict";var cb=String.prototype.replace,ub=/%20/g,Zh={RFC1738:"RFC1738",RFC3986:"RFC3986"};ep.exports={default:Zh.RFC3986,formatters:{RFC1738:function(r){return cb.call(r,ub,"+")},RFC3986:function(r){return String(r)}},RFC1738:Zh.RFC1738,RFC3986:Zh.RFC3986}});var Jh=dt((UT,ip)=>{"use strict";var db=Co(),Qh=Object.prototype.hasOwnProperty,zr=Array.isArray,Ge=function(){for(var r=[],t=0;t<256;++t)r.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return r}(),pb=function(t){for(;t.length>1;){var e=t.pop(),i=e.obj[e.prop];if(zr(i)){for(var s=[],n=0;n<i.length;++n)typeof i[n]<"u"&&s.push(i[n]);e.obj[e.prop]=s}}},rp=function(t,e){for(var i=e&&e.plainObjects?Object.create(null):{},s=0;s<t.length;++s)typeof t[s]<"u"&&(i[s]=t[s]);return i},fb=function r(t,e,i){if(!e)return t;if(typeof e!="object"){if(zr(t))t.push(e);else if(t&&typeof t=="object")(i&&(i.plainObjects||i.allowPrototypes)||!Qh.call(Object.prototype,e))&&(t[e]=!0);else return[t,e];return t}if(!t||typeof t!="object")return[t].concat(e);var s=t;return zr(t)&&!zr(e)&&(s=rp(t,i)),zr(t)&&zr(e)?(e.forEach(function(n,o){if(Qh.call(t,o)){var a=t[o];a&&typeof a=="object"&&n&&typeof n=="object"?t[o]=r(a,n,i):t.push(n)}else t[o]=n}),t):Object.keys(e).reduce(function(n,o){var a=e[o];return Qh.call(n,o)?n[o]=r(n[o],a,i):n[o]=a,n},s)},mb=function(t,e){return Object.keys(e).reduce(function(i,s){return i[s]=e[s],i},t)},gb=function(r,t,e){var i=r.replace(/\+/g," ");if(e==="iso-8859-1")return i.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(i)}catch{return i}},yb=function(t,e,i,s,n){if(t.length===0)return t;var o=t;if(typeof t=="symbol"?o=Symbol.prototype.toString.call(t):typeof t!="string"&&(o=String(t)),i==="iso-8859-1")return escape(o).replace(/%u[0-9a-f]{4}/gi,function(c){return"%26%23"+parseInt(c.slice(2),16)+"%3B"});for(var a="",h=0;h<o.length;++h){var l=o.charCodeAt(h);if(l===45||l===46||l===95||l===126||l>=48&&l<=57||l>=65&&l<=90||l>=97&&l<=122||n===db.RFC1738&&(l===40||l===41)){a+=o.charAt(h);continue}if(l<128){a=a+Ge[l];continue}if(l<2048){a=a+(Ge[192|l>>6]+Ge[128|l&63]);continue}if(l<55296||l>=57344){a=a+(Ge[224|l>>12]+Ge[128|l>>6&63]+Ge[128|l&63]);continue}h+=1,l=65536+((l&1023)<<10|o.charCodeAt(h)&1023),a+=Ge[240|l>>18]+Ge[128|l>>12&63]+Ge[128|l>>6&63]+Ge[128|l&63]}return a},bb=function(t){for(var e=[{obj:{o:t},prop:"o"}],i=[],s=0;s<e.length;++s)for(var n=e[s],o=n.obj[n.prop],a=Object.keys(o),h=0;h<a.length;++h){var l=a[h],c=o[l];typeof c=="object"&&c!==null&&i.indexOf(c)===-1&&(e.push({obj:o,prop:l}),i.push(c))}return pb(e),t},_b=function(t){return Object.prototype.toString.call(t)==="[object RegExp]"},xb=function(t){return!t||typeof t!="object"?!1:!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))},vb=function(t,e){return[].concat(t,e)},wb=function(t,e){if(zr(t)){for(var i=[],s=0;s<t.length;s+=1)i.push(e(t[s]));return i}return e(t)};ip.exports={arrayToObject:rp,assign:mb,combine:vb,compact:bb,decode:gb,encode:yb,isBuffer:xb,isRegExp:_b,maybeMap:wb,merge:fb}});var lp=dt((GT,hp)=>{"use strict";var op=tp(),Io=Jh(),zs=Co(),Tb=Object.prototype.hasOwnProperty,sp={brackets:function(t){return t+"[]"},comma:"comma",indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},sr=Array.isArray,Eb=Array.prototype.push,ap=function(r,t){Eb.apply(r,sr(t)?t:[t])},Sb=Date.prototype.toISOString,np=zs.default,zt={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:Io.encode,encodeValuesOnly:!1,format:np,formatter:zs.formatters[np],indices:!1,serializeDate:function(t){return Sb.call(t)},skipNulls:!1,strictNullHandling:!1},Ab=function(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||typeof t=="symbol"||typeof t=="bigint"},tl={},Cb=function r(t,e,i,s,n,o,a,h,l,c,u,d,p,f,m,b){for(var y=t,v=b,g=0,_=!1;(v=v.get(tl))!==void 0&&!_;){var L=v.get(t);if(g+=1,typeof L<"u"){if(L===g)throw new RangeError("Cyclic object value");_=!0}typeof v.get(tl)>"u"&&(g=0)}if(typeof h=="function"?y=h(e,y):y instanceof Date?y=u(y):i==="comma"&&sr(y)&&(y=Io.maybeMap(y,function(qt){return qt instanceof Date?u(qt):qt})),y===null){if(n)return a&&!f?a(e,zt.encoder,m,"key",d):e;y=""}if(Ab(y)||Io.isBuffer(y)){if(a){var G=f?e:a(e,zt.encoder,m,"key",d);return[p(G)+"="+p(a(y,zt.encoder,m,"value",d))]}return[p(e)+"="+p(String(y))]}var F=[];if(typeof y>"u")return F;var B;if(i==="comma"&&sr(y))f&&a&&(y=Io.maybeMap(y,a)),B=[{value:y.length>0?y.join(",")||null:void 0}];else if(sr(h))B=h;else{var $=Object.keys(y);B=l?$.sort(l):$}for(var q=s&&sr(y)&&y.length===1?e+"[]":e,ut=0;ut<B.length;++ut){var St=B[ut],k=typeof St=="object"&&typeof St.value<"u"?St.value:y[St];if(!(o&&k===null)){var U=sr(y)?typeof i=="function"?i(q,St):q:q+(c?"."+St:"["+St+"]");b.set(t,g);var pe=op();pe.set(tl,b),ap(F,r(k,U,i,s,n,o,i==="comma"&&f&&sr(y)?null:a,h,l,c,u,d,p,f,m,pe))}}return F},Ib=function(t){if(!t)return zt;if(t.encoder!==null&&typeof t.encoder<"u"&&typeof t.encoder!="function")throw new TypeError("Encoder has to be a function.");var e=t.charset||zt.charset;if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var i=zs.default;if(typeof t.format<"u"){if(!Tb.call(zs.formatters,t.format))throw new TypeError("Unknown format option provided.");i=t.format}var s=zs.formatters[i],n=zt.filter;return(typeof t.filter=="function"||sr(t.filter))&&(n=t.filter),{addQueryPrefix:typeof t.addQueryPrefix=="boolean"?t.addQueryPrefix:zt.addQueryPrefix,allowDots:typeof t.allowDots>"u"?zt.allowDots:!!t.allowDots,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:zt.charsetSentinel,delimiter:typeof t.delimiter>"u"?zt.delimiter:t.delimiter,encode:typeof t.encode=="boolean"?t.encode:zt.encode,encoder:typeof t.encoder=="function"?t.encoder:zt.encoder,encodeValuesOnly:typeof t.encodeValuesOnly=="boolean"?t.encodeValuesOnly:zt.encodeValuesOnly,filter:n,format:i,formatter:s,serializeDate:typeof t.serializeDate=="function"?t.serializeDate:zt.serializeDate,skipNulls:typeof t.skipNulls=="boolean"?t.skipNulls:zt.skipNulls,sort:typeof t.sort=="function"?t.sort:null,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:zt.strictNullHandling}};hp.exports=function(r,t){var e=r,i=Ib(t),s,n;typeof i.filter=="function"?(n=i.filter,e=n("",e)):sr(i.filter)&&(n=i.filter,s=n);var o=[];if(typeof e!="object"||e===null)return"";var a;t&&t.arrayFormat in sp?a=t.arrayFormat:t&&"indices"in t?a=t.indices?"indices":"repeat":a="indices";var h=sp[a];if(t&&"commaRoundTrip"in t&&typeof t.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var l=h==="comma"&&t&&t.commaRoundTrip;s||(s=Object.keys(e)),i.sort&&s.sort(i.sort);for(var c=op(),u=0;u<s.length;++u){var d=s[u];i.skipNulls&&e[d]===null||ap(o,Cb(e[d],d,h,l,i.strictNullHandling,i.skipNulls,i.encode?i.encoder:null,i.filter,i.sort,i.allowDots,i.serializeDate,i.format,i.formatter,i.encodeValuesOnly,i.charset,c))}var p=o.join(i.delimiter),f=i.addQueryPrefix===!0?"?":"";return i.charsetSentinel&&(i.charset==="iso-8859-1"?f+="utf8=%26%2310003%3B&":f+="utf8=%E2%9C%93&"),p.length>0?f+p:""}});var dp=dt((HT,up)=>{"use strict";var ki=Jh(),el=Object.prototype.hasOwnProperty,Pb=Array.isArray,Rt={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:ki.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},Rb=function(r){return r.replace(/&#(\d+);/g,function(t,e){return String.fromCharCode(parseInt(e,10))})},cp=function(r,t){return r&&typeof r=="string"&&t.comma&&r.indexOf(",")>-1?r.split(","):r},Mb="utf8=%26%2310003%3B",Fb="utf8=%E2%9C%93",Bb=function(t,e){var i={__proto__:null},s=e.ignoreQueryPrefix?t.replace(/^\?/,""):t,n=e.parameterLimit===1/0?void 0:e.parameterLimit,o=s.split(e.delimiter,n),a=-1,h,l=e.charset;if(e.charsetSentinel)for(h=0;h<o.length;++h)o[h].indexOf("utf8=")===0&&(o[h]===Fb?l="utf-8":o[h]===Mb&&(l="iso-8859-1"),a=h,h=o.length);for(h=0;h<o.length;++h)if(h!==a){var c=o[h],u=c.indexOf("]="),d=u===-1?c.indexOf("="):u+1,p,f;d===-1?(p=e.decoder(c,Rt.decoder,l,"key"),f=e.strictNullHandling?null:""):(p=e.decoder(c.slice(0,d),Rt.decoder,l,"key"),f=ki.maybeMap(cp(c.slice(d+1),e),function(m){return e.decoder(m,Rt.decoder,l,"value")})),f&&e.interpretNumericEntities&&l==="iso-8859-1"&&(f=Rb(f)),c.indexOf("[]=")>-1&&(f=Pb(f)?[f]:f),el.call(i,p)?i[p]=ki.combine(i[p],f):i[p]=f}return i},Lb=function(r,t,e,i){for(var s=i?t:cp(t,e),n=r.length-1;n>=0;--n){var o,a=r[n];if(a==="[]"&&e.parseArrays)o=[].concat(s);else{o=e.plainObjects?Object.create(null):{};var h=a.charAt(0)==="["&&a.charAt(a.length-1)==="]"?a.slice(1,-1):a,l=parseInt(h,10);!e.parseArrays&&h===""?o={0:s}:!isNaN(l)&&a!==h&&String(l)===h&&l>=0&&e.parseArrays&&l<=e.arrayLimit?(o=[],o[l]=s):h!=="__proto__"&&(o[h]=s)}s=o}return s},kb=function(t,e,i,s){if(t){var n=i.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,o=/(\[[^[\]]*])/,a=/(\[[^[\]]*])/g,h=i.depth>0&&o.exec(n),l=h?n.slice(0,h.index):n,c=[];if(l){if(!i.plainObjects&&el.call(Object.prototype,l)&&!i.allowPrototypes)return;c.push(l)}for(var u=0;i.depth>0&&(h=a.exec(n))!==null&&u<i.depth;){if(u+=1,!i.plainObjects&&el.call(Object.prototype,h[1].slice(1,-1))&&!i.allowPrototypes)return;c.push(h[1])}return h&&c.push("["+n.slice(h.index)+"]"),Lb(c,e,i,s)}},Ob=function(t){if(!t)return Rt;if(t.decoder!==null&&t.decoder!==void 0&&typeof t.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var e=typeof t.charset>"u"?Rt.charset:t.charset;return{allowDots:typeof t.allowDots>"u"?Rt.allowDots:!!t.allowDots,allowPrototypes:typeof t.allowPrototypes=="boolean"?t.allowPrototypes:Rt.allowPrototypes,allowSparse:typeof t.allowSparse=="boolean"?t.allowSparse:Rt.allowSparse,arrayLimit:typeof t.arrayLimit=="number"?t.arrayLimit:Rt.arrayLimit,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:Rt.charsetSentinel,comma:typeof t.comma=="boolean"?t.comma:Rt.comma,decoder:typeof t.decoder=="function"?t.decoder:Rt.decoder,delimiter:typeof t.delimiter=="string"||ki.isRegExp(t.delimiter)?t.delimiter:Rt.delimiter,depth:typeof t.depth=="number"||t.depth===!1?+t.depth:Rt.depth,ignoreQueryPrefix:t.ignoreQueryPrefix===!0,interpretNumericEntities:typeof t.interpretNumericEntities=="boolean"?t.interpretNumericEntities:Rt.interpretNumericEntities,parameterLimit:typeof t.parameterLimit=="number"?t.parameterLimit:Rt.parameterLimit,parseArrays:t.parseArrays!==!1,plainObjects:typeof t.plainObjects=="boolean"?t.plainObjects:Rt.plainObjects,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:Rt.strictNullHandling}};up.exports=function(r,t){var e=Ob(t);if(r===""||r===null||typeof r>"u")return e.plainObjects?Object.create(null):{};for(var i=typeof r=="string"?Bb(r,e):r,s=e.plainObjects?Object.create(null):{},n=Object.keys(i),o=0;o<n.length;++o){var a=n[o],h=kb(a,i[a],e,typeof r=="string");s=ki.merge(s,h,e)}return e.allowSparse===!0?s:ki.compact(s)}});var fp=dt((VT,pp)=>{"use strict";var Nb=lp(),Db=dp(),Ub=Co();pp.exports={formats:Ub,parse:Db,stringify:Nb}});var bp=dt(Ni=>{"use strict";var Gb=Wu();function _e(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var Hb=/^([a-z0-9.+-]+:)/i,Vb=/:[0-9]*$/,jb=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,$b=["<",">",'"',"`"," ","\r",`
`,"	"],zb=["{","}","|","\\","^","`"].concat($b),rl=["'"].concat(zb),mp=["%","/","?",";","#"].concat(rl),gp=["/","?","#"],Wb=255,yp=/^[+a-z0-9A-Z_-]{0,63}$/,Xb=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,Yb={javascript:!0,"javascript:":!0},il={javascript:!0,"javascript:":!0},Oi={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},sl=fp();function Ws(r,t,e){if(r&&typeof r=="object"&&r instanceof _e)return r;var i=new _e;return i.parse(r,t,e),i}_e.prototype.parse=function(r,t,e){if(typeof r!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof r);var i=r.indexOf("?"),s=i!==-1&&i<r.indexOf("#")?"?":"#",n=r.split(s),o=/\\/g;n[0]=n[0].replace(o,"/"),r=n.join(s);var a=r;if(a=a.trim(),!e&&r.split("#").length===1){var h=jb.exec(a);if(h)return this.path=a,this.href=a,this.pathname=h[1],h[2]?(this.search=h[2],t?this.query=sl.parse(this.search.substr(1)):this.query=this.search.substr(1)):t&&(this.search="",this.query={}),this}var l=Hb.exec(a);if(l){l=l[0];var c=l.toLowerCase();this.protocol=c,a=a.substr(l.length)}if(e||l||a.match(/^\/\/[^@/]+@[^@/]+/)){var u=a.substr(0,2)==="//";u&&!(l&&il[l])&&(a=a.substr(2),this.slashes=!0)}if(!il[l]&&(u||l&&!Oi[l])){for(var d=-1,p=0;p<gp.length;p++){var f=a.indexOf(gp[p]);f!==-1&&(d===-1||f<d)&&(d=f)}var m,b;d===-1?b=a.lastIndexOf("@"):b=a.lastIndexOf("@",d),b!==-1&&(m=a.slice(0,b),a=a.slice(b+1),this.auth=decodeURIComponent(m)),d=-1;for(var p=0;p<mp.length;p++){var f=a.indexOf(mp[p]);f!==-1&&(d===-1||f<d)&&(d=f)}d===-1&&(d=a.length),this.host=a.slice(0,d),a=a.slice(d),this.parseHost(),this.hostname=this.hostname||"";var y=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!y)for(var v=this.hostname.split(/\./),p=0,g=v.length;p<g;p++){var _=v[p];if(_&&!_.match(yp)){for(var L="",G=0,F=_.length;G<F;G++)_.charCodeAt(G)>127?L+="x":L+=_[G];if(!L.match(yp)){var B=v.slice(0,p),$=v.slice(p+1),q=_.match(Xb);q&&(B.push(q[1]),$.unshift(q[2])),$.length&&(a="/"+$.join(".")+a),this.hostname=B.join(".");break}}}this.hostname.length>Wb?this.hostname="":this.hostname=this.hostname.toLowerCase(),y||(this.hostname=Gb.toASCII(this.hostname));var ut=this.port?":"+this.port:"",St=this.hostname||"";this.host=St+ut,this.href+=this.host,y&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),a[0]!=="/"&&(a="/"+a))}if(!Yb[c])for(var p=0,g=rl.length;p<g;p++){var k=rl[p];if(a.indexOf(k)!==-1){var U=encodeURIComponent(k);U===k&&(U=escape(k)),a=a.split(k).join(U)}}var pe=a.indexOf("#");pe!==-1&&(this.hash=a.substr(pe),a=a.slice(0,pe));var qt=a.indexOf("?");if(qt!==-1?(this.search=a.substr(qt),this.query=a.substr(qt+1),t&&(this.query=sl.parse(this.query)),a=a.slice(0,qt)):t&&(this.search="",this.query={}),a&&(this.pathname=a),Oi[c]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var ut=this.pathname||"",at=this.search||"";this.path=ut+at}return this.href=this.format(),this};function qb(r){return typeof r=="string"&&(r=Ws(r)),r instanceof _e?r.format():_e.prototype.format.call(r)}_e.prototype.format=function(){var r=this.auth||"";r&&(r=encodeURIComponent(r),r=r.replace(/%3A/i,":"),r+="@");var t=this.protocol||"",e=this.pathname||"",i=this.hash||"",s=!1,n="";this.host?s=r+this.host:this.hostname&&(s=r+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(s+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(n=sl.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var o=this.search||n&&"?"+n||"";return t&&t.substr(-1)!==":"&&(t+=":"),this.slashes||(!t||Oi[t])&&s!==!1?(s="//"+(s||""),e&&e.charAt(0)!=="/"&&(e="/"+e)):s||(s=""),i&&i.charAt(0)!=="#"&&(i="#"+i),o&&o.charAt(0)!=="?"&&(o="?"+o),e=e.replace(/[?#]/g,function(a){return encodeURIComponent(a)}),o=o.replace("#","%23"),t+s+e+o+i};function Kb(r,t){return Ws(r,!1,!0).resolve(t)}_e.prototype.resolve=function(r){return this.resolveObject(Ws(r,!1,!0)).format()};function Zb(r,t){return r?Ws(r,!1,!0).resolveObject(t):t}_e.prototype.resolveObject=function(r){if(typeof r=="string"){var t=new _e;t.parse(r,!1,!0),r=t}for(var e=new _e,i=Object.keys(this),s=0;s<i.length;s++){var n=i[s];e[n]=this[n]}if(e.hash=r.hash,r.href==="")return e.href=e.format(),e;if(r.slashes&&!r.protocol){for(var o=Object.keys(r),a=0;a<o.length;a++){var h=o[a];h!=="protocol"&&(e[h]=r[h])}return Oi[e.protocol]&&e.hostname&&!e.pathname&&(e.pathname="/",e.path=e.pathname),e.href=e.format(),e}if(r.protocol&&r.protocol!==e.protocol){if(!Oi[r.protocol]){for(var l=Object.keys(r),c=0;c<l.length;c++){var u=l[c];e[u]=r[u]}return e.href=e.format(),e}if(e.protocol=r.protocol,!r.host&&!il[r.protocol]){for(var g=(r.pathname||"").split("/");g.length&&!(r.host=g.shift()););r.host||(r.host=""),r.hostname||(r.hostname=""),g[0]!==""&&g.unshift(""),g.length<2&&g.unshift(""),e.pathname=g.join("/")}else e.pathname=r.pathname;if(e.search=r.search,e.query=r.query,e.host=r.host||"",e.auth=r.auth,e.hostname=r.hostname||r.host,e.port=r.port,e.pathname||e.search){var d=e.pathname||"",p=e.search||"";e.path=d+p}return e.slashes=e.slashes||r.slashes,e.href=e.format(),e}var f=e.pathname&&e.pathname.charAt(0)==="/",m=r.host||r.pathname&&r.pathname.charAt(0)==="/",b=m||f||e.host&&r.pathname,y=b,v=e.pathname&&e.pathname.split("/")||[],g=r.pathname&&r.pathname.split("/")||[],_=e.protocol&&!Oi[e.protocol];if(_&&(e.hostname="",e.port=null,e.host&&(v[0]===""?v[0]=e.host:v.unshift(e.host)),e.host="",r.protocol&&(r.hostname=null,r.port=null,r.host&&(g[0]===""?g[0]=r.host:g.unshift(r.host)),r.host=null),b=b&&(g[0]===""||v[0]==="")),m)e.host=r.host||r.host===""?r.host:e.host,e.hostname=r.hostname||r.hostname===""?r.hostname:e.hostname,e.search=r.search,e.query=r.query,v=g;else if(g.length)v||(v=[]),v.pop(),v=v.concat(g),e.search=r.search,e.query=r.query;else if(r.search!=null){if(_){e.host=v.shift(),e.hostname=e.host;var L=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;L&&(e.auth=L.shift(),e.hostname=L.shift(),e.host=e.hostname)}return e.search=r.search,e.query=r.query,(e.pathname!==null||e.search!==null)&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.href=e.format(),e}if(!v.length)return e.pathname=null,e.search?e.path="/"+e.search:e.path=null,e.href=e.format(),e;for(var G=v.slice(-1)[0],F=(e.host||r.host||v.length>1)&&(G==="."||G==="..")||G==="",B=0,$=v.length;$>=0;$--)G=v[$],G==="."?v.splice($,1):G===".."?(v.splice($,1),B++):B&&(v.splice($,1),B--);if(!b&&!y)for(;B--;B)v.unshift("..");b&&v[0]!==""&&(!v[0]||v[0].charAt(0)!=="/")&&v.unshift(""),F&&v.join("/").substr(-1)!=="/"&&v.push("");var q=v[0]===""||v[0]&&v[0].charAt(0)==="/";if(_){e.hostname=q?"":v.length?v.shift():"",e.host=e.hostname;var L=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;L&&(e.auth=L.shift(),e.hostname=L.shift(),e.host=e.hostname)}return b=b||e.host&&v.length,b&&!q&&v.unshift(""),v.length>0?e.pathname=v.join("/"):(e.pathname=null,e.path=null),(e.pathname!==null||e.search!==null)&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.auth=r.auth||e.auth,e.slashes=e.slashes||r.slashes,e.href=e.format(),e};_e.prototype.parseHost=function(){var r=this.host,t=Vb.exec(r);t&&(t=t[0],t!==":"&&(this.port=t.substr(1)),r=r.substr(0,r.length-t.length)),r&&(this.hostname=r)};Ni.parse=Ws;Ni.resolve=Kb;Ni.resolveObject=Zb;Ni.format=qb;Ni.Url=_e});var fe=(r=>(r[r.WEBGL_LEGACY=0]="WEBGL_LEGACY",r[r.WEBGL=1]="WEBGL",r[r.WEBGL2=2]="WEBGL2",r))(fe||{}),xh=(r=>(r[r.UNKNOWN=0]="UNKNOWN",r[r.WEBGL=1]="WEBGL",r[r.CANVAS=2]="CANVAS",r))(xh||{}),ho=(r=>(r[r.COLOR=16384]="COLOR",r[r.DEPTH=256]="DEPTH",r[r.STENCIL=1024]="STENCIL",r))(ho||{}),D=(r=>(r[r.NORMAL=0]="NORMAL",r[r.ADD=1]="ADD",r[r.MULTIPLY=2]="MULTIPLY",r[r.SCREEN=3]="SCREEN",r[r.OVERLAY=4]="OVERLAY",r[r.DARKEN=5]="DARKEN",r[r.LIGHTEN=6]="LIGHTEN",r[r.COLOR_DODGE=7]="COLOR_DODGE",r[r.COLOR_BURN=8]="COLOR_BURN",r[r.HARD_LIGHT=9]="HARD_LIGHT",r[r.SOFT_LIGHT=10]="SOFT_LIGHT",r[r.DIFFERENCE=11]="DIFFERENCE",r[r.EXCLUSION=12]="EXCLUSION",r[r.HUE=13]="HUE",r[r.SATURATION=14]="SATURATION",r[r.COLOR=15]="COLOR",r[r.LUMINOSITY=16]="LUMINOSITY",r[r.NORMAL_NPM=17]="NORMAL_NPM",r[r.ADD_NPM=18]="ADD_NPM",r[r.SCREEN_NPM=19]="SCREEN_NPM",r[r.NONE=20]="NONE",r[r.SRC_OVER=0]="SRC_OVER",r[r.SRC_IN=21]="SRC_IN",r[r.SRC_OUT=22]="SRC_OUT",r[r.SRC_ATOP=23]="SRC_ATOP",r[r.DST_OVER=24]="DST_OVER",r[r.DST_IN=25]="DST_IN",r[r.DST_OUT=26]="DST_OUT",r[r.DST_ATOP=27]="DST_ATOP",r[r.ERASE=26]="ERASE",r[r.SUBTRACT=28]="SUBTRACT",r[r.XOR=29]="XOR",r))(D||{}),Ie=(r=>(r[r.POINTS=0]="POINTS",r[r.LINES=1]="LINES",r[r.LINE_LOOP=2]="LINE_LOOP",r[r.LINE_STRIP=3]="LINE_STRIP",r[r.TRIANGLES=4]="TRIANGLES",r[r.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",r[r.TRIANGLE_FAN=6]="TRIANGLE_FAN",r))(Ie||{}),I=(r=>(r[r.RGBA=6408]="RGBA",r[r.RGB=6407]="RGB",r[r.RG=33319]="RG",r[r.RED=6403]="RED",r[r.RGBA_INTEGER=36249]="RGBA_INTEGER",r[r.RGB_INTEGER=36248]="RGB_INTEGER",r[r.RG_INTEGER=33320]="RG_INTEGER",r[r.RED_INTEGER=36244]="RED_INTEGER",r[r.ALPHA=6406]="ALPHA",r[r.LUMINANCE=6409]="LUMINANCE",r[r.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",r[r.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",r[r.DEPTH_STENCIL=34041]="DEPTH_STENCIL",r))(I||{}),rr=(r=>(r[r.TEXTURE_2D=3553]="TEXTURE_2D",r[r.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",r[r.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",r[r.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",r[r.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",r[r.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",r[r.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",r))(rr||{}),W=(r=>(r[r.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",r[r.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",r[r.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",r[r.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",r[r.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",r[r.UNSIGNED_INT=5125]="UNSIGNED_INT",r[r.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",r[r.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",r[r.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",r[r.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",r[r.BYTE=5120]="BYTE",r[r.SHORT=5122]="SHORT",r[r.INT=5124]="INT",r[r.FLOAT=5126]="FLOAT",r[r.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",r[r.HALF_FLOAT=36193]="HALF_FLOAT",r))(W||{}),P=(r=>(r[r.FLOAT=0]="FLOAT",r[r.INT=1]="INT",r[r.UINT=2]="UINT",r))(P||{}),ne=(r=>(r[r.NEAREST=0]="NEAREST",r[r.LINEAR=1]="LINEAR",r))(ne||{}),br=(r=>(r[r.CLAMP=33071]="CLAMP",r[r.REPEAT=10497]="REPEAT",r[r.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",r))(br||{}),Pe=(r=>(r[r.OFF=0]="OFF",r[r.POW2=1]="POW2",r[r.ON=2]="ON",r[r.ON_MANUAL=3]="ON_MANUAL",r))(Pe||{}),kt=(r=>(r[r.NPM=0]="NPM",r[r.UNPACK=1]="UNPACK",r[r.PMA=2]="PMA",r[r.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",r[r.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",r[r.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",r))(kt||{}),_r=(r=>(r[r.NO=0]="NO",r[r.YES=1]="YES",r[r.AUTO=2]="AUTO",r[r.BLEND=0]="BLEND",r[r.CLEAR=1]="CLEAR",r[r.BLIT=2]="BLIT",r))(_r||{}),lo=(r=>(r[r.AUTO=0]="AUTO",r[r.MANUAL=1]="MANUAL",r))(lo||{}),Qt=(r=>(r.LOW="lowp",r.MEDIUM="mediump",r.HIGH="highp",r))(Qt||{}),_t=(r=>(r[r.NONE=0]="NONE",r[r.SCISSOR=1]="SCISSOR",r[r.STENCIL=2]="STENCIL",r[r.SPRITE=3]="SPRITE",r[r.COLOR=4]="COLOR",r))(_t||{});var ot=(r=>(r[r.NONE=0]="NONE",r[r.LOW=2]="LOW",r[r.MEDIUM=4]="MEDIUM",r[r.HIGH=8]="HIGH",r))(ot||{}),oe=(r=>(r[r.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",r[r.ARRAY_BUFFER=34962]="ARRAY_BUFFER",r[r.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",r))(oe||{});var vh={createCanvas:(r,t)=>{let e=document.createElement("canvas");return e.width=r,e.height=t,e},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(r,t)=>fetch(r,t),parseXML:r=>new DOMParser().parseFromString(r,"text/xml")};var S={ADAPTER:vh,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var wh=/iPhone/i,Iu=/iPod/i,Pu=/iPad/i,Ru=/\biOS-universal(?:.+)Mac\b/i,Th=/\bAndroid(?:.+)Mobile\b/i,Mu=/Android/i,Ti=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,co=/Silk/i,ir=/Windows Phone/i,Fu=/\bWindows(?:.+)ARM\b/i,Bu=/BlackBerry/i,Lu=/BB10/i,ku=/Opera Mini/i,Ou=/\b(CriOS|Chrome)(?:.+)Mobile/i,Nu=/Mobile(?:.+)Firefox\b/i,Du=function(r){return typeof r<"u"&&r.platform==="MacIntel"&&typeof r.maxTouchPoints=="number"&&r.maxTouchPoints>1&&typeof MSStream>"u"};function Ig(r){return function(t){return t.test(r)}}function Ls(r){var t={userAgent:"",platform:"",maxTouchPoints:0};!r&&typeof navigator<"u"?t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof r=="string"?t.userAgent=r:r&&r.userAgent&&(t={userAgent:r.userAgent,platform:r.platform,maxTouchPoints:r.maxTouchPoints||0});var e=t.userAgent,i=e.split("[FBAN");typeof i[1]<"u"&&(e=i[0]),i=e.split("Twitter"),typeof i[1]<"u"&&(e=i[0]);var s=Ig(e),n={apple:{phone:s(wh)&&!s(ir),ipod:s(Iu),tablet:!s(wh)&&(s(Pu)||Du(t))&&!s(ir),universal:s(Ru),device:(s(wh)||s(Iu)||s(Pu)||s(Ru)||Du(t))&&!s(ir)},amazon:{phone:s(Ti),tablet:!s(Ti)&&s(co),device:s(Ti)||s(co)},android:{phone:!s(ir)&&s(Ti)||!s(ir)&&s(Th),tablet:!s(ir)&&!s(Ti)&&!s(Th)&&(s(co)||s(Mu)),device:!s(ir)&&(s(Ti)||s(co)||s(Th)||s(Mu))||s(/\bokhttp\b/i)},windows:{phone:s(ir),tablet:s(Fu),device:s(ir)||s(Fu)},other:{blackberry:s(Bu),blackberry10:s(Lu),opera:s(ku),firefox:s(Nu),chrome:s(Ou),device:s(Bu)||s(Lu)||s(ku)||s(Nu)||s(Ou)},any:!1,phone:!1,tablet:!1};return n.any=n.apple.device||n.android.device||n.windows.device||n.other.device,n.phone=n.apple.phone||n.android.phone||n.windows.phone,n.tablet=n.apple.tablet||n.android.tablet||n.windows.tablet,n}var Pg=Ls.default??Ls,be=Pg(globalThis.navigator);var M={};Ag(M,{BaseTextureCache:()=>te,BoundingBox:()=>Qs,CanvasRenderTarget:()=>Lo,DATA_URI:()=>Fo,EventEmitter:()=>Ve.default,ProgramCache:()=>Js,TextureCache:()=>Ft,clearTextureCache:()=>Yp,correctBlendMode:()=>Gp,createIndicesForQuads:()=>$p,decomposeDataUri:()=>Qp,deprecation:()=>V,destroyTextureCache:()=>Xp,detectVideoAlphaMode:()=>vp,determineCrossOrigin:()=>Oo,earcut:()=>Jp.default,getBufferType:()=>Er,getCanvasBoundingBox:()=>ko,getResolutionOfUrl:()=>tn,hex2rgb:()=>Op,hex2string:()=>Np,interleaveTypedArrays:()=>zp,isMobile:()=>be,isPow2:()=>Ks,isWebGLSupported:()=>Po,log2:()=>Zs,nextPow2:()=>Sr,path:()=>nl,premultiplyBlendMode:()=>qs,premultiplyRgba:()=>Hp,premultiplyTint:()=>Vp,premultiplyTintToRgba:()=>jp,removeItems:()=>Bo,rgb2hex:()=>Up,sayHello:()=>Tp,sign:()=>Wp,skipHello:()=>wp,string2hex:()=>Dp,trimCanvas:()=>Zp,uid:()=>He,url:()=>xp});S.RETINA_PREFIX=/@([0-9\.]+)x/;S.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var Ve=_h(Gu(),1),Jp=_h(zu(),1);var Di=_h(bp(),1);var _p={};function V(r,t,e=3){if(_p[t])return;let i=new Error().stack;typeof i>"u"?console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${r}`):(i=i.split(`
`).splice(e).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${t}
Deprecated since v${r}`),console.warn(i),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${r}`),console.warn(i))),_p[t]=!0}var xp={get parse(){return V("7.3.0","utils.url.parse is deprecated, use native URL API instead."),Di.parse},get format(){return V("7.3.0","utils.url.format is deprecated, use native URL API instead."),Di.format},get resolve(){return V("7.3.0","utils.url.resolve is deprecated, use native URL API instead."),Di.resolve}};function Re(r){if(typeof r!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(r)}`)}function Xs(r){return r.split("?")[0].split("#")[0]}function Qb(r){return r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Jb(r,t,e){return r.replace(new RegExp(Qb(t),"g"),e)}function t_(r,t){let e="",i=0,s=-1,n=0,o=-1;for(let a=0;a<=r.length;++a){if(a<r.length)o=r.charCodeAt(a);else{if(o===47)break;o=47}if(o===47){if(!(s===a-1||n===1))if(s!==a-1&&n===2){if(e.length<2||i!==2||e.charCodeAt(e.length-1)!==46||e.charCodeAt(e.length-2)!==46){if(e.length>2){let h=e.lastIndexOf("/");if(h!==e.length-1){h===-1?(e="",i=0):(e=e.slice(0,h),i=e.length-1-e.lastIndexOf("/")),s=a,n=0;continue}}else if(e.length===2||e.length===1){e="",i=0,s=a,n=0;continue}}t&&(e.length>0?e+="/..":e="..",i=2)}else e.length>0?e+=`/${r.slice(s+1,a)}`:e=r.slice(s+1,a),i=a-s-1;s=a,n=0}else o===46&&n!==-1?++n:n=-1}return e}var nl={toPosix(r){return Jb(r,"\\","/")},isUrl(r){return/^https?:/.test(this.toPosix(r))},isDataUrl(r){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(r)},isBlobUrl(r){return r.startsWith("blob:")},hasProtocol(r){return/^[^/:]+:/.test(this.toPosix(r))},getProtocol(r){Re(r),r=this.toPosix(r);let t=/^file:\/\/\//.exec(r);if(t)return t[0];let e=/^[^/:]+:\/{0,2}/.exec(r);return e?e[0]:""},toAbsolute(r,t,e){if(Re(r),this.isDataUrl(r)||this.isBlobUrl(r))return r;let i=Xs(this.toPosix(t??S.ADAPTER.getBaseUrl())),s=Xs(this.toPosix(e??this.rootname(i)));return r=this.toPosix(r),r.startsWith("/")?nl.join(s,r.slice(1)):this.isAbsolute(r)?r:this.join(i,r)},normalize(r){if(Re(r),r.length===0)return".";if(this.isDataUrl(r)||this.isBlobUrl(r))return r;r=this.toPosix(r);let t="",e=r.startsWith("/");this.hasProtocol(r)&&(t=this.rootname(r),r=r.slice(t.length));let i=r.endsWith("/");return r=t_(r,!1),r.length>0&&i&&(r+="/"),e?`/${r}`:t+r},isAbsolute(r){return Re(r),r=this.toPosix(r),this.hasProtocol(r)?!0:r.startsWith("/")},join(...r){if(r.length===0)return".";let t;for(let e=0;e<r.length;++e){let i=r[e];if(Re(i),i.length>0)if(t===void 0)t=i;else{let s=r[e-1]??"";this.extname(s)?t+=`/../${i}`:t+=`/${i}`}}return t===void 0?".":this.normalize(t)},dirname(r){if(Re(r),r.length===0)return".";r=this.toPosix(r);let t=r.charCodeAt(0),e=t===47,i=-1,s=!0,n=this.getProtocol(r),o=r;r=r.slice(n.length);for(let a=r.length-1;a>=1;--a)if(t=r.charCodeAt(a),t===47){if(!s){i=a;break}}else s=!1;return i===-1?e?"/":this.isUrl(o)?n+r:n:e&&i===1?"//":n+r.slice(0,i)},rootname(r){Re(r),r=this.toPosix(r);let t="";if(r.startsWith("/")?t="/":t=this.getProtocol(r),this.isUrl(r)){let e=r.indexOf("/",t.length);e!==-1?t=r.slice(0,e):t=r,t.endsWith("/")||(t+="/")}return t},basename(r,t){Re(r),t&&Re(t),r=Xs(this.toPosix(r));let e=0,i=-1,s=!0,n;if(t!==void 0&&t.length>0&&t.length<=r.length){if(t.length===r.length&&t===r)return"";let o=t.length-1,a=-1;for(n=r.length-1;n>=0;--n){let h=r.charCodeAt(n);if(h===47){if(!s){e=n+1;break}}else a===-1&&(s=!1,a=n+1),o>=0&&(h===t.charCodeAt(o)?--o===-1&&(i=n):(o=-1,i=a))}return e===i?i=a:i===-1&&(i=r.length),r.slice(e,i)}for(n=r.length-1;n>=0;--n)if(r.charCodeAt(n)===47){if(!s){e=n+1;break}}else i===-1&&(s=!1,i=n+1);return i===-1?"":r.slice(e,i)},extname(r){Re(r),r=Xs(this.toPosix(r));let t=-1,e=0,i=-1,s=!0,n=0;for(let o=r.length-1;o>=0;--o){let a=r.charCodeAt(o);if(a===47){if(!s){e=o+1;break}continue}i===-1&&(s=!1,i=o+1),a===46?t===-1?t=o:n!==1&&(n=1):t!==-1&&(n=-1)}return t===-1||i===-1||n===0||n===1&&t===i-1&&t===e+1?"":r.slice(t,i)},parse(r){Re(r);let t={root:"",dir:"",base:"",ext:"",name:""};if(r.length===0)return t;r=Xs(this.toPosix(r));let e=r.charCodeAt(0),i=this.isAbsolute(r),s,n="";t.root=this.rootname(r),i||this.hasProtocol(r)?s=1:s=0;let o=-1,a=0,h=-1,l=!0,c=r.length-1,u=0;for(;c>=s;--c){if(e=r.charCodeAt(c),e===47){if(!l){a=c+1;break}continue}h===-1&&(l=!1,h=c+1),e===46?o===-1?o=c:u!==1&&(u=1):o!==-1&&(u=-1)}return o===-1||h===-1||u===0||u===1&&o===h-1&&o===a+1?h!==-1&&(a===0&&i?t.base=t.name=r.slice(1,h):t.base=t.name=r.slice(a,h)):(a===0&&i?(t.name=r.slice(1,o),t.base=r.slice(1,h)):(t.name=r.slice(a,o),t.base=r.slice(a,h)),t.ext=r.slice(o,h)),t.dir=this.dirname(r),n&&(t.dir=n+t.dir),t},sep:"/",delimiter:":"};var ol;async function vp(){return ol??(ol=(async()=>{let r=document.createElement("canvas").getContext("webgl");if(!r)return kt.UNPACK;let t=await new Promise(n=>{let o=document.createElement("video");o.onloadeddata=()=>n(o),o.onerror=()=>n(null),o.autoplay=!1,o.crossOrigin="anonymous",o.preload="auto",o.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",o.load()});if(!t)return kt.UNPACK;let e=r.createTexture();r.bindTexture(r.TEXTURE_2D,e);let i=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,i),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,r.NONE),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t);let s=new Uint8Array(4);return r.readPixels(0,0,1,1,r.RGBA,r.UNSIGNED_BYTE,s),r.deleteFramebuffer(i),r.deleteTexture(e),r.getExtension("WEBGL_lose_context")?.loseContext(),s[0]<=s[3]?kt.PMA:kt.UNPACK})()),ol}function wp(){V("7.0.0","skipHello is deprecated, please use settings.RENDER_OPTIONS.hello")}function Tp(){V("7.0.0",`sayHello is deprecated, please use Renderer's "hello" option`)}var al;function Po(){return typeof al>"u"&&(al=function(){let r={stencil:!0,failIfMajorPerformanceCaveat:S.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!S.ADAPTER.getWebGLRenderingContext())return!1;let t=S.ADAPTER.createCanvas(),e=t.getContext("webgl",r)||t.getContext("experimental-webgl",r),i=!!e?.getContextAttributes()?.stencil;if(e){let s=e.getExtension("WEBGL_lose_context");s&&s.loseContext()}return e=null,i}catch{return!1}}()),al}var e_={grad:.9,turn:360,rad:360/(2*Math.PI)},nr=function(r){return typeof r=="string"?r.length>0:typeof r=="number"},Mt=function(r,t,e){return t===void 0&&(t=0),e===void 0&&(e=Math.pow(10,t)),Math.round(e*r)/e+0},xe=function(r,t,e){return t===void 0&&(t=0),e===void 0&&(e=1),r>e?e:r>t?r:t},Mp=function(r){return(r=isFinite(r)?r%360:0)>0?r:r+360},Ep=function(r){return{r:xe(r.r,0,255),g:xe(r.g,0,255),b:xe(r.b,0,255),a:xe(r.a)}},hl=function(r){return{r:Mt(r.r),g:Mt(r.g),b:Mt(r.b),a:Mt(r.a,3)}},r_=/^#([0-9a-f]{3,8})$/i,Ro=function(r){var t=r.toString(16);return t.length<2?"0"+t:t},Fp=function(r){var t=r.r,e=r.g,i=r.b,s=r.a,n=Math.max(t,e,i),o=n-Math.min(t,e,i),a=o?n===t?(e-i)/o:n===e?2+(i-t)/o:4+(t-e)/o:0;return{h:60*(a<0?a+6:a),s:n?o/n*100:0,v:n/255*100,a:s}},Bp=function(r){var t=r.h,e=r.s,i=r.v,s=r.a;t=t/360*6,e/=100,i/=100;var n=Math.floor(t),o=i*(1-e),a=i*(1-(t-n)*e),h=i*(1-(1-t+n)*e),l=n%6;return{r:255*[i,a,o,o,h,i][l],g:255*[h,i,i,a,o,o][l],b:255*[o,o,h,i,i,a][l],a:s}},Sp=function(r){return{h:Mp(r.h),s:xe(r.s,0,100),l:xe(r.l,0,100),a:xe(r.a)}},Ap=function(r){return{h:Mt(r.h),s:Mt(r.s),l:Mt(r.l),a:Mt(r.a,3)}},Cp=function(r){return Bp((e=(t=r).s,{h:t.h,s:(e*=((i=t.l)<50?i:100-i)/100)>0?2*e/(i+e)*100:0,v:i+e,a:t.a}));var t,e,i},Ys=function(r){return{h:(t=Fp(r)).h,s:(s=(200-(e=t.s))*(i=t.v)/100)>0&&s<200?e*i/100/(s<=100?s:200-s)*100:0,l:s/2,a:t.a};var t,e,i,s},i_=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,s_=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,n_=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,o_=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,ul={string:[[function(r){var t=r_.exec(r);return t?(r=t[1]).length<=4?{r:parseInt(r[0]+r[0],16),g:parseInt(r[1]+r[1],16),b:parseInt(r[2]+r[2],16),a:r.length===4?Mt(parseInt(r[3]+r[3],16)/255,2):1}:r.length===6||r.length===8?{r:parseInt(r.substr(0,2),16),g:parseInt(r.substr(2,2),16),b:parseInt(r.substr(4,2),16),a:r.length===8?Mt(parseInt(r.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(r){var t=n_.exec(r)||o_.exec(r);return t?t[2]!==t[4]||t[4]!==t[6]?null:Ep({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:t[7]===void 0?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(r){var t=i_.exec(r)||s_.exec(r);if(!t)return null;var e,i,s=Sp({h:(e=t[1],i=t[2],i===void 0&&(i="deg"),Number(e)*(e_[i]||1)),s:Number(t[3]),l:Number(t[4]),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)});return Cp(s)},"hsl"]],object:[[function(r){var t=r.r,e=r.g,i=r.b,s=r.a,n=s===void 0?1:s;return nr(t)&&nr(e)&&nr(i)?Ep({r:Number(t),g:Number(e),b:Number(i),a:Number(n)}):null},"rgb"],[function(r){var t=r.h,e=r.s,i=r.l,s=r.a,n=s===void 0?1:s;if(!nr(t)||!nr(e)||!nr(i))return null;var o=Sp({h:Number(t),s:Number(e),l:Number(i),a:Number(n)});return Cp(o)},"hsl"],[function(r){var t=r.h,e=r.s,i=r.v,s=r.a,n=s===void 0?1:s;if(!nr(t)||!nr(e)||!nr(i))return null;var o=function(a){return{h:Mp(a.h),s:xe(a.s,0,100),v:xe(a.v,0,100),a:xe(a.a)}}({h:Number(t),s:Number(e),v:Number(i),a:Number(n)});return Bp(o)},"hsv"]]},Ip=function(r,t){for(var e=0;e<t.length;e++){var i=t[e][0](r);if(i)return[i,t[e][1]]}return[null,void 0]},a_=function(r){return typeof r=="string"?Ip(r.trim(),ul.string):typeof r=="object"&&r!==null?Ip(r,ul.object):[null,void 0]};var ll=function(r,t){var e=Ys(r);return{h:e.h,s:xe(e.s+100*t,0,100),l:e.l,a:e.a}},cl=function(r){return(299*r.r+587*r.g+114*r.b)/1e3/255},Pp=function(r,t){var e=Ys(r);return{h:e.h,s:e.s,l:xe(e.l+100*t,0,100),a:e.a}},dl=function(){function r(t){this.parsed=a_(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return r.prototype.isValid=function(){return this.parsed!==null},r.prototype.brightness=function(){return Mt(cl(this.rgba),2)},r.prototype.isDark=function(){return cl(this.rgba)<.5},r.prototype.isLight=function(){return cl(this.rgba)>=.5},r.prototype.toHex=function(){return t=hl(this.rgba),e=t.r,i=t.g,s=t.b,o=(n=t.a)<1?Ro(Mt(255*n)):"","#"+Ro(e)+Ro(i)+Ro(s)+o;var t,e,i,s,n,o},r.prototype.toRgb=function(){return hl(this.rgba)},r.prototype.toRgbString=function(){return t=hl(this.rgba),e=t.r,i=t.g,s=t.b,(n=t.a)<1?"rgba("+e+", "+i+", "+s+", "+n+")":"rgb("+e+", "+i+", "+s+")";var t,e,i,s,n},r.prototype.toHsl=function(){return Ap(Ys(this.rgba))},r.prototype.toHslString=function(){return t=Ap(Ys(this.rgba)),e=t.h,i=t.s,s=t.l,(n=t.a)<1?"hsla("+e+", "+i+"%, "+s+"%, "+n+")":"hsl("+e+", "+i+"%, "+s+"%)";var t,e,i,s,n},r.prototype.toHsv=function(){return t=Fp(this.rgba),{h:Mt(t.h),s:Mt(t.s),v:Mt(t.v),a:Mt(t.a,3)};var t},r.prototype.invert=function(){return Me({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},r.prototype.saturate=function(t){return t===void 0&&(t=.1),Me(ll(this.rgba,t))},r.prototype.desaturate=function(t){return t===void 0&&(t=.1),Me(ll(this.rgba,-t))},r.prototype.grayscale=function(){return Me(ll(this.rgba,-1))},r.prototype.lighten=function(t){return t===void 0&&(t=.1),Me(Pp(this.rgba,t))},r.prototype.darken=function(t){return t===void 0&&(t=.1),Me(Pp(this.rgba,-t))},r.prototype.rotate=function(t){return t===void 0&&(t=15),this.hue(this.hue()+t)},r.prototype.alpha=function(t){return typeof t=="number"?Me({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):Mt(this.rgba.a,3);var e},r.prototype.hue=function(t){var e=Ys(this.rgba);return typeof t=="number"?Me({h:t,s:e.s,l:e.l,a:e.a}):Mt(e.h)},r.prototype.isEqual=function(t){return this.toHex()===Me(t).toHex()},r}(),Me=function(r){return r instanceof dl?r:new dl(r)},Rp=[],Lp=function(r){r.forEach(function(t){Rp.indexOf(t)<0&&(t(dl,ul),Rp.push(t))})};function kp(r,t){var e={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},i={};for(var s in e)i[e[s]]=s;var n={};r.prototype.toName=function(o){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var a,h,l=i[this.toHex()];if(l)return l;if(o?.closest){var c=this.toRgb(),u=1/0,d="black";if(!n.length)for(var p in e)n[p]=new r(e[p]).toRgb();for(var f in e){var m=(a=c,h=n[f],Math.pow(a.r-h.r,2)+Math.pow(a.g-h.g,2)+Math.pow(a.b-h.b,2));m<u&&(u=m,d=f)}return d}},t.string.push([function(o){var a=o.toLowerCase(),h=a==="transparent"?"#0000":e[a];return h?new r(h).toRgb():null},"name"])}Lp([kp]);var Ui=class Mo{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(t){if(t instanceof Mo)this._value=this.cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(t===null)throw new Error("Cannot set PIXI.Color#value to null");(this._value===null||!this.isSourceEqual(this._value,t))&&(this.normalize(t),this._value=this.cloneSource(t))}}get value(){return this._value}cloneSource(t){return typeof t=="string"||typeof t=="number"||t instanceof Number||t===null?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):typeof t=="object"&&t!==null?{...t}:t}isSourceEqual(t,e){let i=typeof t;if(i!==typeof e)return!1;if(i==="number"||i==="string"||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length!==e.length?!1:t.every((s,n)=>s===e[n]);if(t!==null&&e!==null){let s=Object.keys(t),n=Object.keys(e);return s.length!==n.length?!1:s.every(o=>t[o]===e[o])}return t===e}toRgba(){let[t,e,i,s]=this._components;return{r:t,g:e,b:i,a:s}}toRgb(){let[t,e,i]=this._components;return{r:t,g:e,b:i}}toRgbaString(){let[t,e,i]=this.toUint8RgbArray();return`rgba(${t},${e},${i},${this.alpha})`}toUint8RgbArray(t){let[e,i,s]=this._components;return t=t??[],t[0]=Math.round(e*255),t[1]=Math.round(i*255),t[2]=Math.round(s*255),t}toRgbArray(t){t=t??[];let[e,i,s]=this._components;return t[0]=e,t[1]=i,t[2]=s,t}toNumber(){return this._int}toLittleEndianNumber(){let t=this._int;return(t>>16)+(t&65280)+((t&255)<<16)}multiply(t){let[e,i,s,n]=Mo.temp.setValue(t)._components;return this._components[0]*=e,this._components[1]*=i,this._components[2]*=s,this._components[3]*=n,this.refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this.refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(t===1)return(255<<24)+this._int;if(t===0)return e?0:this._int;let i=this._int>>16&255,s=this._int>>8&255,n=this._int&255;return e&&(i=i*t+.5|0,s=s*t+.5|0,n=n*t+.5|0),(t*255<<24)+(i<<16)+(s<<8)+n}toHex(){let t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){let t=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-t.length)+t}setAlpha(t){return this._components[3]=this._clamp(t),this}round(t){let[e,i,s]=this._components;return this._components[0]=Math.round(e*t)/t,this._components[1]=Math.round(i*t)/t,this._components[2]=Math.round(s*t)/t,this.refreshInt(),this._value=null,this}toArray(t){t=t??[];let[e,i,s,n]=this._components;return t[0]=e,t[1]=i,t[2]=s,t[3]=n,t}normalize(t){let e,i,s,n;if((typeof t=="number"||t instanceof Number)&&t>=0&&t<=16777215){let o=t;e=(o>>16&255)/255,i=(o>>8&255)/255,s=(o&255)/255,n=1}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[e,i,s,n=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[e,i,s,n=255]=t,e/=255,i/=255,s/=255,n/=255;else if(typeof t=="string"||typeof t=="object"){if(typeof t=="string"){let a=Mo.HEX_PATTERN.exec(t);a&&(t=`#${a[2]}`)}let o=Me(t);o.isValid()&&({r:e,g:i,b:s,a:n}=o.rgba,e/=255,i/=255,s/=255)}if(e!==void 0)this._components[0]=e,this._components[1]=i,this._components[2]=s,this._components[3]=n,this.refreshInt();else throw new Error(`Unable to convert color ${t}`)}refreshInt(){this._clamp(this._components);let[t,e,i]=this._components;this._int=(t*255<<16)+(e*255<<8)+(i*255|0)}_clamp(t,e=0,i=1){return typeof t=="number"?Math.min(Math.max(t,e),i):(t.forEach((s,n)=>{t[n]=Math.min(Math.max(s,e),i)}),t)}};Ui.shared=new Ui,Ui.temp=new Ui,Ui.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;var J=Ui;function Op(r,t=[]){return V("7.2.0","utils.hex2rgb is deprecated, use Color#toRgbArray instead"),J.shared.setValue(r).toRgbArray(t)}function Np(r){return V("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),J.shared.setValue(r).toHex()}function Dp(r){return V("7.2.0","utils.string2hex is deprecated, use Color#toNumber instead"),J.shared.setValue(r).toNumber()}function Up(r){return V("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),J.shared.setValue(r).toNumber()}function h_(){let r=[],t=[];for(let i=0;i<32;i++)r[i]=i,t[i]=i;r[D.NORMAL_NPM]=D.NORMAL,r[D.ADD_NPM]=D.ADD,r[D.SCREEN_NPM]=D.SCREEN,t[D.NORMAL]=D.NORMAL_NPM,t[D.ADD]=D.ADD_NPM,t[D.SCREEN]=D.SCREEN_NPM;let e=[];return e.push(t),e.push(r),e}var qs=h_();function Gp(r,t){return qs[t?1:0][r]}function Hp(r,t,e,i=!0){return V("7.2.0","utils.premultiplyRgba has moved to Color.premultiply"),J.shared.setValue(r).premultiply(t,i).toArray(e??new Float32Array(4))}function Vp(r,t){return V("7.2.0","utils.premultiplyTint has moved to Color.toPremultiplied"),J.shared.setValue(r).toPremultiplied(t)}function jp(r,t,e,i=!0){return V("7.2.0","utils.premultiplyTintToRgba has moved to Color.premultiply"),J.shared.setValue(r).premultiply(t,i).toArray(e??new Float32Array(4))}var Fo=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i;function $p(r,t=null){let e=r*6;if(t=t||new Uint16Array(e),t.length!==e)throw new Error(`Out buffer length is incorrect, got ${t.length} and expected ${e}`);for(let i=0,s=0;i<e;i+=6,s+=4)t[i+0]=s+0,t[i+1]=s+1,t[i+2]=s+2,t[i+3]=s+0,t[i+4]=s+2,t[i+5]=s+3;return t}function Er(r){if(r.BYTES_PER_ELEMENT===4)return r instanceof Float32Array?"Float32Array":r instanceof Uint32Array?"Uint32Array":"Int32Array";if(r.BYTES_PER_ELEMENT===2){if(r instanceof Uint16Array)return"Uint16Array"}else if(r.BYTES_PER_ELEMENT===1&&r instanceof Uint8Array)return"Uint8Array";return null}var l_={Float32Array,Uint32Array,Int32Array,Uint8Array};function zp(r,t){let e=0,i=0,s={};for(let h=0;h<r.length;h++)i+=t[h],e+=r[h].length;let n=new ArrayBuffer(e*4),o=null,a=0;for(let h=0;h<r.length;h++){let l=t[h],c=r[h],u=Er(c);s[u]||(s[u]=new l_[u](n)),o=s[u];for(let d=0;d<c.length;d++){let p=(d/l|0)*i+a,f=d%l;o[p+f]=c[d]}a+=l}return new Float32Array(n)}function Sr(r){return r+=r===0?1:0,--r,r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,r|=r>>>16,r+1}function Ks(r){return!(r&r-1)&&!!r}function Zs(r){let t=(r>65535?1:0)<<4;r>>>=t;let e=(r>255?1:0)<<3;return r>>>=e,t|=e,e=(r>15?1:0)<<2,r>>>=e,t|=e,e=(r>3?1:0)<<1,r>>>=e,t|=e,t|r>>1}function Bo(r,t,e){let i=r.length,s;if(t>=i||e===0)return;e=t+e>i?i-t:e;let n=i-e;for(s=t;s<n;++s)r[s]=r[s+e];r.length=n}function Wp(r){return r===0?0:r<0?-1:1}var c_=0;function He(){return++c_}var pl=class{constructor(r,t,e,i){this.left=r,this.top=t,this.right=e,this.bottom=i}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};pl.EMPTY=new pl(0,0,0,0);var Qs=pl;var Js={},Ft=Object.create(null),te=Object.create(null);function Xp(){let r;for(r in Ft)Ft[r].destroy();for(r in te)te[r].destroy()}function Yp(){let r;for(r in Ft)delete Ft[r];for(r in te)delete te[r]}var Lo=class{constructor(t,e,i){this._canvas=S.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=i||S.RESOLUTION,this.resize(t,e)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(t,e){this._checkDestroyed(),this._canvas.width=Math.round(t*this.resolution),this._canvas.height=Math.round(e*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(t){this._checkDestroyed(),this._canvas.width=Math.round(t)}get height(){return this._checkDestroyed(),this._canvas.height}set height(t){this._checkDestroyed(),this._canvas.height=Math.round(t)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(this._canvas===null)throw new TypeError("The CanvasRenderTarget has already been destroyed")}};function qp(r,t,e){for(let i=0,s=4*e*t;i<t;++i,s+=4)if(r[s+3]!==0)return!1;return!0}function Kp(r,t,e,i,s){let n=4*t;for(let o=i,a=i*n+4*e;o<=s;++o,a+=n)if(r[a+3]!==0)return!1;return!0}function ko(r){let{width:t,height:e}=r,i=r.getContext("2d",{willReadFrequently:!0});if(i===null)throw new TypeError("Failed to get canvas 2D context");let s=i.getImageData(0,0,t,e).data,n=0,o=0,a=t-1,h=e-1;for(;o<e&&qp(s,t,o);)++o;if(o===e)return Qs.EMPTY;for(;qp(s,t,h);)--h;for(;Kp(s,t,n,o,h);)++n;for(;Kp(s,t,a,o,h);)--a;return++a,++h,new Qs(n,o,a,h)}function Zp(r){let t=ko(r),{width:e,height:i}=t,s=null;if(!t.isEmpty()){let n=r.getContext("2d");if(n===null)throw new TypeError("Failed to get canvas 2D context");s=n.getImageData(t.left,t.top,e,i)}return{width:e,height:i,data:s}}function Qp(r){let t=Fo.exec(r);if(t)return{mediaType:t[1]?t[1].toLowerCase():void 0,subType:t[2]?t[2].toLowerCase():void 0,charset:t[3]?t[3].toLowerCase():void 0,encoding:t[4]?t[4].toLowerCase():void 0,data:t[5]}}function Oo(r,t=globalThis.location){if(r.startsWith("data:"))return"";t=t||globalThis.location;let e=new URL(r,document.baseURI);return e.hostname!==t.hostname||e.port!==t.port||e.protocol!==t.protocol?"anonymous":""}function tn(r,t=1){let e=S.RETINA_PREFIX?.exec(r);return e?parseFloat(e[1]):t}var w=(r=>(r.Renderer="renderer",r.Application="application",r.RendererSystem="renderer-webgl-system",r.RendererPlugin="renderer-webgl-plugin",r.CanvasRendererSystem="renderer-canvas-system",r.CanvasRendererPlugin="renderer-canvas-plugin",r.Asset="asset",r.LoadParser="load-parser",r.ResolveParser="resolve-parser",r.CacheParser="cache-parser",r.DetectionParser="detection-parser",r))(w||{}),fl=r=>{if(typeof r=="function"||typeof r=="object"&&r.extension){if(!r.extension)throw new Error("Extension class must have an extension object");r={...typeof r.extension!="object"?{type:r.extension}:r.extension,ref:r}}if(typeof r=="object")r={...r};else throw new Error("Invalid extension type");return typeof r.type=="string"&&(r.type=[r.type]),r},tf=(r,t)=>fl(r).priority??t,T={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...r){return r.map(fl).forEach(t=>{t.type.forEach(e=>this._removeHandlers[e]?.(t))}),this},add(...r){return r.map(fl).forEach(t=>{t.type.forEach(e=>{let i=this._addHandlers,s=this._queue;i[e]?i[e](t):(s[e]=s[e]||[],s[e].push(t))})}),this},handle(r,t,e){let i=this._addHandlers,s=this._removeHandlers;if(i[r]||s[r])throw new Error(`Extension type ${r} already has a handler`);i[r]=t,s[r]=e;let n=this._queue;return n[r]&&(n[r].forEach(o=>t(o)),delete n[r]),this},handleByMap(r,t){return this.handle(r,e=>{t[e.name]=e.ref},e=>{delete t[e.name]})},handleByList(r,t,e=-1){return this.handle(r,i=>{t.includes(i.ref)||(t.push(i.ref),t.sort((s,n)=>tf(n,e)-tf(s,e)))},i=>{let s=t.indexOf(i.ref);s!==-1&&t.splice(s,1)})}};var en=class{constructor(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}};var u_=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function d_(r){let t="";for(let e=0;e<r;++e)e>0&&(t+=`
else `),e<r-1&&(t+=`if(test == ${e}.0){}`);return t}function No(r,t){if(r===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");let e=t.createShader(t.FRAGMENT_SHADER);for(;;){let i=u_.replace(/%forloop%/gi,d_(r));if(t.shaderSource(e,i),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))r=r/2|0;else break}return r}var ml=0,gl=1,yl=2,bl=3,_l=4,xl=5,ve=class r{constructor(){this.data=0,this.blendMode=D.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<ml)}set blend(t){!!(this.data&1<<ml)!==t&&(this.data^=1<<ml)}get offsets(){return!!(this.data&1<<gl)}set offsets(t){!!(this.data&1<<gl)!==t&&(this.data^=1<<gl)}get culling(){return!!(this.data&1<<yl)}set culling(t){!!(this.data&1<<yl)!==t&&(this.data^=1<<yl)}get depthTest(){return!!(this.data&1<<bl)}set depthTest(t){!!(this.data&1<<bl)!==t&&(this.data^=1<<bl)}get depthMask(){return!!(this.data&1<<xl)}set depthMask(t){!!(this.data&1<<xl)!==t&&(this.data^=1<<xl)}get clockwiseFrontFace(){return!!(this.data&1<<_l)}set clockwiseFrontFace(t){!!(this.data&1<<_l)!==t&&(this.data^=1<<_l)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==D.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}static for2d(){let t=new r;return t.depthTest=!1,t.blend=!0,t}};ve.prototype.toString=function(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`};var rn=[];function Gi(r,t){if(!r)return null;let e="";if(typeof r=="string"){let i=/\.(\w{3,4})(?:$|\?|#)/i.exec(r);i&&(e=i[1].toLowerCase())}for(let i=rn.length-1;i>=0;--i){let s=rn[i];if(s.test&&s.test(r,e))return new s(r,t)}throw new Error("Unrecognized source type to auto-detect Resource")}var xt=class{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,e,i,s,n,o,a,h){if(arguments.length>8)throw new Error("max arguments reached");let{name:l,items:c}=this;this._aliasCount++;for(let u=0,d=c.length;u<d;u++)c[u][l](t,e,i,s,n,o,a,h);return c===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){let e=this.items.indexOf(t);return e!==-1&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}};Object.defineProperties(xt.prototype,{dispatch:{value:xt.prototype.emit},run:{value:xt.prototype.emit}});var me=class{constructor(t=0,e=0){this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new xt("setRealSize"),this.onUpdate=new xt("update"),this.onError=new xt("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,e){(t!==this._width||e!==this._height)&&(this._width=t,this._height=e,this.onResize.emit(t,e))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,e,i){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,e){return!1}};var Wr=class extends me{constructor(t,e){let{width:i,height:s}=e||{};if(!i||!s)throw new Error("BufferResource width or height invalid");super(i,s),this.data=t,this.unpackAlignment=e.unpackAlignment??4}upload(t,e,i){let s=t.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,this.unpackAlignment),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===kt.UNPACK);let n=e.realWidth,o=e.realHeight;return i.width===n&&i.height===o?s.texSubImage2D(e.target,0,0,0,n,o,e.format,i.type,this.data):(i.width=n,i.height=o,s.texImage2D(e.target,0,i.internalFormat,n,o,0,e.format,i.type,this.data)),!0}dispose(){this.data=null}static test(t){return t===null||t instanceof Int8Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array}};var p_={scaleMode:ne.NEAREST,alphaMode:kt.NPM},vl=class Hi extends Ve.default{constructor(t=null,e=null){super(),e=Object.assign({},Hi.defaultOptions,e);let{alphaMode:i,mipmap:s,anisotropicLevel:n,scaleMode:o,width:a,height:h,wrapMode:l,format:c,type:u,target:d,resolution:p,resourceOptions:f}=e;t&&!(t instanceof me)&&(t=Gi(t,f),t.internal=!0),this.resolution=p||S.RESOLUTION,this.width=Math.round((a||0)*this.resolution)/this.resolution,this.height=Math.round((h||0)*this.resolution)/this.resolution,this._mipmap=s,this.anisotropicLevel=n,this._wrapMode=l,this._scaleMode=o,this.format=c,this.type=u,this.target=d,this.alphaMode=i,this.uid=He(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=a>0&&h>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(t)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(t){this._mipmap!==t&&(this._mipmap=t,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(t){this._scaleMode!==t&&(this._scaleMode=t,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(t){this._wrapMode!==t&&(this._wrapMode=t,this.dirtyStyleId++)}setStyle(t,e){let i;return t!==void 0&&t!==this.scaleMode&&(this.scaleMode=t,i=!0),e!==void 0&&e!==this.mipmap&&(this.mipmap=e,i=!0),i&&this.dirtyStyleId++,this}setSize(t,e,i){return i=i||this.resolution,this.setRealSize(t*i,e*i,i)}setRealSize(t,e,i){return this.resolution=i||this.resolution,this.width=Math.round(t)/this.resolution,this.height=Math.round(e)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=Ks(this.realWidth)&&Ks(this.realHeight)}setResolution(t){let e=this.resolution;return e===t?this:(this.resolution=t,this.valid&&(this.width=Math.round(this.width*e)/t,this.height=Math.round(this.height*e)/t,this.emit("update",this)),this._refreshPOT(),this)}setResource(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(t){this.emit("error",this,t)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete te[this.cacheId],delete Ft[this.cacheId],this.cacheId=null),this.valid=!1,this.dispose(),Hi.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(t,e,i=S.STRICT_TEXTURE_CACHE){let s=typeof t=="string",n=null;if(s)n=t;else{if(!t._pixiId){let a=e?.pixiIdPrefix||"pixiid";t._pixiId=`${a}_${He()}`}n=t._pixiId}let o=te[n];if(s&&i&&!o)throw new Error(`The cacheId "${n}" does not exist in BaseTextureCache.`);return o||(o=new Hi(t,e),o.cacheId=n,Hi.addToCache(o,n)),o}static fromBuffer(t,e,i,s){t=t||new Float32Array(e*i*4);let n=new Wr(t,{width:e,height:i,...s?.resourceOptions}),o,a;return t instanceof Float32Array?(o=I.RGBA,a=W.FLOAT):t instanceof Int32Array?(o=I.RGBA_INTEGER,a=W.INT):t instanceof Uint32Array?(o=I.RGBA_INTEGER,a=W.UNSIGNED_INT):t instanceof Int16Array?(o=I.RGBA_INTEGER,a=W.SHORT):t instanceof Uint16Array?(o=I.RGBA_INTEGER,a=W.UNSIGNED_SHORT):t instanceof Int8Array?(o=I.RGBA,a=W.BYTE):(o=I.RGBA,a=W.UNSIGNED_BYTE),n.internal=!0,new Hi(n,Object.assign({},p_,{type:a,format:o},s))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),te[e]&&te[e]!==t&&console.warn(`BaseTexture added to the cache with an id [${e}] that already had an entry`),te[e]=t)}static removeFromCache(t){if(typeof t=="string"){let e=te[t];if(e){let i=e.textureCacheIds.indexOf(t);return i>-1&&e.textureCacheIds.splice(i,1),delete te[t],e}}else if(t?.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)delete te[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}};vl.defaultOptions={mipmap:Pe.POW2,anisotropicLevel:0,scaleMode:ne.LINEAR,wrapMode:br.CLAMP,alphaMode:kt.UNPACK,target:rr.TEXTURE_2D,format:I.RGBA,type:W.UNSIGNED_BYTE},vl._globalBatch=0;var j=vl;var Ar=class{constructor(){this.texArray=null,this.blend=0,this.type=Ie.TRIANGLES,this.start=0,this.size=0,this.data=null}};var f_=0,Et=class r{constructor(t,e=!0,i=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=i,this.static=e,this.id=f_++,this.disposeRunner=new xt("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?oe.ELEMENT_ARRAY_BUFFER:oe.ARRAY_BUFFER}get index(){return this.type===oe.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new r(t)}};var Vi=class r{constructor(t,e=0,i=!1,s=W.FLOAT,n,o,a,h=1){this.buffer=t,this.size=e,this.normalized=i,this.type=s,this.stride=n,this.start=o,this.instance=a,this.divisor=h}destroy(){this.buffer=null}static from(t,e,i,s,n){return new r(t,e,i,s,n)}};var m_={Float32Array,Uint32Array,Int32Array,Uint8Array};function ef(r,t){let e=0,i=0,s={};for(let h=0;h<r.length;h++)i+=t[h],e+=r[h].length;let n=new ArrayBuffer(e*4),o=null,a=0;for(let h=0;h<r.length;h++){let l=t[h],c=r[h],u=Er(c);s[u]||(s[u]=new m_[u](n)),o=s[u];for(let d=0;d<c.length;d++){let p=(d/l|0)*i+a,f=d%l;o[p+f]=c[d]}a+=l}return new Float32Array(n)}var rf={5126:4,5123:2,5121:1},g_=0,y_={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array},or=class r{constructor(t=[],e={}){this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=g_++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new xt("disposeGeometry"),this.refCount=0}addAttribute(t,e,i=0,s=!1,n,o,a,h=!1){if(!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof Et||(e instanceof Array&&(e=new Float32Array(e)),e=new Et(e));let l=t.split("|");if(l.length>1){for(let u=0;u<l.length;u++)this.addAttribute(l[u],e,i,s,n);return this}let c=this.buffers.indexOf(e);return c===-1&&(this.buffers.push(e),c=this.buffers.length-1),this.attributes[t]=new Vi(c,i,s,n,o,a,h),this.instanced=this.instanced||h,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof Et||(t instanceof Array&&(t=new Uint16Array(t)),t=new Et(t)),t.type=oe.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;let t=[],e=[],i=new Et,s;for(s in this.attributes){let n=this.attributes[s],o=this.buffers[n.buffer];t.push(o.data),e.push(n.size*rf[n.type]/4),n.buffer=0}for(i.data=ef(t,e),s=0;s<this.buffers.length;s++)this.buffers[s]!==this.indexBuffer&&this.buffers[s].destroy();return this.buffers=[i],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(let t in this.attributes){let e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){let t=new r;for(let e=0;e<this.buffers.length;e++)t.buffers[e]=new Et(this.buffers[e].data.slice(0));for(let e in this.attributes){let i=this.attributes[e];t.attributes[e]=new Vi(i.buffer,i.size,i.normalized,i.type,i.stride,i.start,i.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=oe.ELEMENT_ARRAY_BUFFER),t}static merge(t){let e=new r,i=[],s=[],n=[],o;for(let a=0;a<t.length;a++){o=t[a];for(let h=0;h<o.buffers.length;h++)s[h]=s[h]||0,s[h]+=o.buffers[h].data.length,n[h]=0}for(let a=0;a<o.buffers.length;a++)i[a]=new y_[Er(o.buffers[a].data)](s[a]),e.buffers[a]=new Et(i[a]);for(let a=0;a<t.length;a++){o=t[a];for(let h=0;h<o.buffers.length;h++)i[h].set(o.buffers[h].data,n[h]),n[h]+=o.buffers[h].data.length}if(e.attributes=o.attributes,o.indexBuffer){e.indexBuffer=e.buffers[o.buffers.indexOf(o.indexBuffer)],e.indexBuffer.type=oe.ELEMENT_ARRAY_BUFFER;let a=0,h=0,l=0,c=0;for(let u=0;u<o.buffers.length;u++)if(o.buffers[u]!==o.indexBuffer){c=u;break}for(let u in o.attributes){let d=o.attributes[u];(d.buffer|0)===c&&(h+=d.size*rf[d.type]/4)}for(let u=0;u<t.length;u++){let d=t[u].indexBuffer.data;for(let p=0;p<d.length;p++)e.indexBuffer.data[p+l]+=a;a+=t[u].buffers[c].data.length/h,l+=d.length}}return e}};var Xr=class extends or{constructor(t=!1){super(),this._buffer=new Et(null,t,!1),this._indexBuffer=new Et(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,W.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,W.FLOAT).addAttribute("aColor",this._buffer,4,!0,W.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,W.FLOAT).addIndex(this._indexBuffer)}};var Cr=Math.PI*2,wl=180/Math.PI,Tl=Math.PI/180,ht=(r=>(r[r.POLY=0]="POLY",r[r.RECT=1]="RECT",r[r.CIRC=2]="CIRC",r[r.ELIP=3]="ELIP",r[r.RREC=4]="RREC",r))(ht||{});var X=class r{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new r(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}};X.prototype.toString=function(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`};var Do=[new X,new X,new X,new X],H=class r{constructor(t=0,e=0,i=0,s=0){this.x=Number(t),this.y=Number(e),this.width=Number(i),this.height=Number(s),this.type=ht.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new r(0,0,0,0)}clone(){return new r(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}intersects(t,e){if(!e){let B=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=B)return!1;let $=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>$}let i=this.left,s=this.right,n=this.top,o=this.bottom;if(s<=i||o<=n)return!1;let a=Do[0].set(t.left,t.top),h=Do[1].set(t.left,t.bottom),l=Do[2].set(t.right,t.top),c=Do[3].set(t.right,t.bottom);if(l.x<=a.x||h.y<=a.y)return!1;let u=Math.sign(e.a*e.d-e.b*e.c);if(u===0||(e.apply(a,a),e.apply(h,h),e.apply(l,l),e.apply(c,c),Math.max(a.x,h.x,l.x,c.x)<=i||Math.min(a.x,h.x,l.x,c.x)>=s||Math.max(a.y,h.y,l.y,c.y)<=n||Math.min(a.y,h.y,l.y,c.y)>=o))return!1;let d=u*(h.y-a.y),p=u*(a.x-h.x),f=d*i+p*n,m=d*s+p*n,b=d*i+p*o,y=d*s+p*o;if(Math.max(f,m,b,y)<=d*a.x+p*a.y||Math.min(f,m,b,y)>=d*c.x+p*c.y)return!1;let v=u*(a.y-l.y),g=u*(l.x-a.x),_=v*i+g*n,L=v*s+g*n,G=v*i+g*o,F=v*s+g*o;return!(Math.max(_,L,G,F)<=v*a.x+g*a.y||Math.min(_,L,G,F)>=v*c.x+g*c.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2,this}fit(t){let e=Math.max(this.x,t.x),i=Math.min(this.x+this.width,t.x+t.width),s=Math.max(this.y,t.y),n=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(i-e,0),this.y=s,this.height=Math.max(n-s,0),this}ceil(t=1,e=.001){let i=Math.ceil((this.x+this.width-e)*t)/t,s=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=i-this.x,this.height=s-this.y,this}enlarge(t){let e=Math.min(this.x,t.x),i=Math.max(this.x+this.width,t.x+t.width),s=Math.min(this.y,t.y),n=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=i-e,this.y=s,this.height=n-s,this}};H.prototype.toString=function(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};var ji=class r{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.radius=i,this.type=ht.CIRC}clone(){return new r(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;let i=this.radius*this.radius,s=this.x-t,n=this.y-e;return s*=s,n*=n,s+n<=i}getBounds(){return new H(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)}};ji.prototype.toString=function(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`};var $i=class r{constructor(t=0,e=0,i=0,s=0){this.x=t,this.y=e,this.width=i,this.height=s,this.type=ht.ELIP}clone(){return new r(this.x,this.y,this.width,this.height)}contains(t,e){if(this.width<=0||this.height<=0)return!1;let i=(t-this.x)/this.width,s=(e-this.y)/this.height;return i*=i,s*=s,i+s<=1}getBounds(){return new H(this.x-this.width,this.y-this.height,this.width,this.height)}};$i.prototype.toString=function(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};var Ir=class r{constructor(...t){let e=Array.isArray(t[0])?t[0]:t;if(typeof e[0]!="number"){let i=[];for(let s=0,n=e.length;s<n;s++)i.push(e[s].x,e[s].y);e=i}this.points=e,this.type=ht.POLY,this.closeStroke=!0}clone(){let t=this.points.slice(),e=new r(t);return e.closeStroke=this.closeStroke,e}contains(t,e){let i=!1,s=this.points.length/2;for(let n=0,o=s-1;n<s;o=n++){let a=this.points[n*2],h=this.points[n*2+1],l=this.points[o*2],c=this.points[o*2+1];h>e!=c>e&&t<(l-a)*((e-h)/(c-h))+a&&(i=!i)}return i}};Ir.prototype.toString=function(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce((r,t)=>`${r}, ${t}`,"")}]`};var zi=class r{constructor(t=0,e=0,i=0,s=0,n=20){this.x=t,this.y=e,this.width=i,this.height=s,this.radius=n,this.type=ht.RREC}clone(){return new r(this.x,this.y,this.width,this.height,this.radius)}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){let i=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+i&&e<=this.y+this.height-i||t>=this.x+i&&t<=this.x+this.width-i)return!0;let s=t-(this.x+i),n=e-(this.y+i),o=i*i;if(s*s+n*n<=o||(s=t-(this.x+this.width-i),s*s+n*n<=o)||(n=e-(this.y+this.height-i),s*s+n*n<=o)||(s=t-(this.x+i),s*s+n*n<=o))return!0}return!1}};zi.prototype.toString=function(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`};var tt=class r{constructor(t=1,e=0,i=0,s=1,n=0,o=0){this.array=null,this.a=t,this.b=e,this.c=i,this.d=s,this.tx=n,this.ty=o}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,i,s,n,o){return this.a=t,this.b=e,this.c=i,this.d=s,this.tx=n,this.ty=o,this}toArray(t,e){this.array||(this.array=new Float32Array(9));let i=e||this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i}apply(t,e){e=e||new X;let i=t.x,s=t.y;return e.x=this.a*i+this.c*s+this.tx,e.y=this.b*i+this.d*s+this.ty,e}applyInverse(t,e){e=e||new X;let i=1/(this.a*this.d+this.c*-this.b),s=t.x,n=t.y;return e.x=this.d*i*s+-this.c*i*n+(this.ty*this.c-this.tx*this.d)*i,e.y=this.a*i*n+-this.b*i*s+(-this.ty*this.a+this.tx*this.b)*i,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){let e=Math.cos(t),i=Math.sin(t),s=this.a,n=this.c,o=this.tx;return this.a=s*e-this.b*i,this.b=s*i+this.b*e,this.c=n*e-this.d*i,this.d=n*i+this.d*e,this.tx=o*e-this.ty*i,this.ty=o*i+this.ty*e,this}append(t){let e=this.a,i=this.b,s=this.c,n=this.d;return this.a=t.a*e+t.b*s,this.b=t.a*i+t.b*n,this.c=t.c*e+t.d*s,this.d=t.c*i+t.d*n,this.tx=t.tx*e+t.ty*s+this.tx,this.ty=t.tx*i+t.ty*n+this.ty,this}setTransform(t,e,i,s,n,o,a,h,l){return this.a=Math.cos(a+l)*n,this.b=Math.sin(a+l)*n,this.c=-Math.sin(a-h)*o,this.d=Math.cos(a-h)*o,this.tx=t-(i*this.a+s*this.c),this.ty=e-(i*this.b+s*this.d),this}prepend(t){let e=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){let i=this.a,s=this.c;this.a=i*t.a+this.b*t.c,this.b=i*t.b+this.b*t.d,this.c=s*t.a+this.d*t.c,this.d=s*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){let e=this.a,i=this.b,s=this.c,n=this.d,o=t.pivot,a=-Math.atan2(-s,n),h=Math.atan2(i,e),l=Math.abs(a+h);return l<1e-5||Math.abs(Cr-l)<1e-5?(t.rotation=h,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=a,t.skew.y=h),t.scale.x=Math.sqrt(e*e+i*i),t.scale.y=Math.sqrt(s*s+n*n),t.position.x=this.tx+(o.x*e+o.y*s),t.position.y=this.ty+(o.x*i+o.y*n),t}invert(){let t=this.a,e=this.b,i=this.c,s=this.d,n=this.tx,o=t*s-e*i;return this.a=s/o,this.b=-e/o,this.c=-i/o,this.d=t/o,this.tx=(i*this.ty-s*n)/o,this.ty=-(t*this.ty-e*n)/o,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){let t=new r;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}static get IDENTITY(){return new r}static get TEMP_MATRIX(){return new r}};tt.prototype.toString=function(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`};var Yr=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],qr=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],Kr=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Zr=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],El=[],sf=[],Uo=Math.sign;function b_(){for(let r=0;r<16;r++){let t=[];El.push(t);for(let e=0;e<16;e++){let i=Uo(Yr[r]*Yr[e]+Kr[r]*qr[e]),s=Uo(qr[r]*Yr[e]+Zr[r]*qr[e]),n=Uo(Yr[r]*Kr[e]+Kr[r]*Zr[e]),o=Uo(qr[r]*Kr[e]+Zr[r]*Zr[e]);for(let a=0;a<16;a++)if(Yr[a]===i&&qr[a]===s&&Kr[a]===n&&Zr[a]===o){t.push(a);break}}}for(let r=0;r<16;r++){let t=new tt;t.set(Yr[r],qr[r],Kr[r],Zr[r],0,0),sf.push(t)}}b_();var pt={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:r=>Yr[r],uY:r=>qr[r],vX:r=>Kr[r],vY:r=>Zr[r],inv:r=>r&8?r&15:-r&7,add:(r,t)=>El[r][t],sub:(r,t)=>El[r][pt.inv(t)],rotate180:r=>r^4,isVertical:r=>(r&3)===2,byDirection:(r,t)=>Math.abs(r)*2<=Math.abs(t)?t>=0?pt.S:pt.N:Math.abs(t)*2<=Math.abs(r)?r>0?pt.E:pt.W:t>0?r>0?pt.SE:pt.SW:r>0?pt.NE:pt.NW,matrixAppendRotationInv:(r,t,e=0,i=0)=>{let s=sf[pt.inv(t)];s.tx=e,s.ty=i,r.append(s)}};var Fe=class r{constructor(t,e,i=0,s=0){this._x=i,this._y=s,this.cb=t,this.scope=e}clone(t=this.cb,e=this.scope){return new r(t,e,this._x,this._y)}set(t=0,e=t){return(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this.cb.call(this.scope)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}};Fe.prototype.toString=function(){return`[@pixi/math:ObservablePoint x=${this.x} y=${this.y} scope=${this.scope}]`};var Sl=class{constructor(){this.worldTransform=new tt,this.localTransform=new tt,this.position=new Fe(this.onChange,this,0,0),this.scale=new Fe(this.onChange,this,1,1),this.pivot=new Fe(this.onChange,this,0,0),this.skew=new Fe(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){let r=this.localTransform;this._localID!==this._currentLocalID&&(r.a=this._cx*this.scale.x,r.b=this._sx*this.scale.x,r.c=this._cy*this.scale.y,r.d=this._sy*this.scale.y,r.tx=this.position.x-(this.pivot.x*r.a+this.pivot.y*r.c),r.ty=this.position.y-(this.pivot.x*r.b+this.pivot.y*r.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(r){let t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==r._worldID){let e=r.worldTransform,i=this.worldTransform;i.a=t.a*e.a+t.b*e.c,i.b=t.a*e.b+t.b*e.d,i.c=t.c*e.a+t.d*e.c,i.d=t.c*e.b+t.d*e.d,i.tx=t.tx*e.a+t.ty*e.c+e.tx,i.ty=t.tx*e.b+t.ty*e.d+e.ty,this._parentID=r._worldID,this._worldID++}}setFromMatrix(r){r.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(r){this._rotation!==r&&(this._rotation=r,this.updateSkew())}};Sl.IDENTITY=new Sl;var Wi=Sl;Wi.prototype.toString=function(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`};var nf=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`;var of=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function Go(r,t,e){let i=r.createShader(t);return r.shaderSource(i,e),r.compileShader(i),i}function Al(r){let t=new Array(r);for(let e=0;e<t.length;e++)t[e]=!1;return t}function sn(r,t){switch(r){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return Al(2*t);case"bvec3":return Al(3*t);case"bvec4":return Al(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}var je=[{test:r=>r.type==="float"&&r.size===1&&!r.isArray,code:r=>`
            if(uv["${r}"] !== ud["${r}"].value)
            {
                ud["${r}"].value = uv["${r}"]
                gl.uniform1f(ud["${r}"].location, uv["${r}"])
            }
            `},{test:(r,t)=>(r.type==="sampler2D"||r.type==="samplerCube"||r.type==="sampler2DArray")&&r.size===1&&!r.isArray&&(t==null||t.castToBaseTexture!==void 0),code:r=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${r}"], t);

            if(ud["${r}"].value !== t)
            {
                ud["${r}"].value = t;
                gl.uniform1i(ud["${r}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(r,t)=>r.type==="mat3"&&r.size===1&&!r.isArray&&t.a!==void 0,code:r=>`
            gl.uniformMatrix3fv(ud["${r}"].location, false, uv["${r}"].toArray(true));
            `,codeUbo:r=>`
                var ${r}_matrix = uv.${r}.toArray(true);

                data[offset] = ${r}_matrix[0];
                data[offset+1] = ${r}_matrix[1];
                data[offset+2] = ${r}_matrix[2];
        
                data[offset + 4] = ${r}_matrix[3];
                data[offset + 5] = ${r}_matrix[4];
                data[offset + 6] = ${r}_matrix[5];
        
                data[offset + 8] = ${r}_matrix[6];
                data[offset + 9] = ${r}_matrix[7];
                data[offset + 10] = ${r}_matrix[8];
            `},{test:(r,t)=>r.type==="vec2"&&r.size===1&&!r.isArray&&t.x!==void 0,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${r}"].location, v.x, v.y);
                }`,codeUbo:r=>`
                v = uv.${r};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:r=>r.type==="vec2"&&r.size===1&&!r.isArray,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${r}"].location, v[0], v[1]);
                }
            `},{test:(r,t)=>r.type==="vec4"&&r.size===1&&!r.isArray&&t.width!==void 0,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${r}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:r=>`
                    v = uv.${r};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:(r,t)=>r.type==="vec4"&&r.size===1&&!r.isArray&&t.red!==void 0,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
                    cv[3] = v.alpha;
                    gl.uniform4f(ud["${r}"].location, v.red, v.green, v.blue, v.alpha)
                }`,codeUbo:r=>`
                    v = uv.${r};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                    data[offset+3] = v.alpha;
                `},{test:(r,t)=>r.type==="vec3"&&r.size===1&&!r.isArray&&t.red!==void 0,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
    
                    gl.uniform3f(ud["${r}"].location, v.red, v.green, v.blue)
                }`,codeUbo:r=>`
                    v = uv.${r};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                `},{test:r=>r.type==="vec4"&&r.size===1&&!r.isArray,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${r}"].location, v[0], v[1], v[2], v[3])
                }`}];var __={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},x_={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function Cl(r,t){let e=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(let i in r.uniforms){let s=t[i];if(!s){r.uniforms[i]?.group===!0&&(r.uniforms[i].ubo?e.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${i}, '${i}');
                    `):e.push(`
                        renderer.shader.syncUniformGroup(uv.${i}, syncData);
                    `));continue}let n=r.uniforms[i],o=!1;for(let a=0;a<je.length;a++)if(je[a].test(s,n)){e.push(je[a].code(i,n)),o=!0;break}if(!o){let a=(s.size===1&&!s.isArray?__:x_)[s.type].replace("location",`ud["${i}"].location`);e.push(`
            cu = ud["${i}"];
            cv = cu.value;
            v = uv["${i}"];
            ${a};`)}}return new Function("ud","uv","renderer","syncData",e.join(`
`))}var af={},Ho=af;function Vo(){if(Ho===af||Ho?.isContextLost()){let r=S.ADAPTER.createCanvas(),t;S.PREFER_ENV>=fe.WEBGL2&&(t=r.getContext("webgl2",{})),t||(t=r.getContext("webgl",{})||r.getContext("experimental-webgl",{}),t?t.getExtension("WEBGL_draw_buffers"):t=null),Ho=t}return Ho}var jo;function Il(){if(!jo){jo=Qt.MEDIUM;let r=Vo();if(r&&r.getShaderPrecisionFormat){let t=r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT);t&&(jo=t.precision?Qt.HIGH:Qt.MEDIUM)}}return jo}function hf(r,t){let e=r.getShaderSource(t).split(`
`).map((l,c)=>`${c}: ${l}`),i=r.getShaderInfoLog(t),s=i.split(`
`),n={},o=s.map(l=>parseFloat(l.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(l=>l&&!n[l]?(n[l]=!0,!0):!1),a=[""];o.forEach(l=>{e[l-1]=`%c${e[l-1]}%c`,a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});let h=e.join(`
`);a[0]=h,console.error(i),console.groupCollapsed("click to view full shader code"),console.warn(...a),console.groupEnd()}function Pl(r,t,e,i){r.getProgramParameter(t,r.LINK_STATUS)||(r.getShaderParameter(e,r.COMPILE_STATUS)||hf(r,e),r.getShaderParameter(i,r.COMPILE_STATUS)||hf(r,i),console.error("PixiJS Error: Could not initialize shader."),r.getProgramInfoLog(t)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",r.getProgramInfoLog(t)))}var v_={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function nn(r){return v_[r]}var $o=null,lf={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function on(r,t){if(!$o){let e=Object.keys(lf);$o={};for(let i=0;i<e.length;++i){let s=e[i];$o[r[s]]=lf[s]}}return $o[t]}function zo(r,t,e){if(r.substring(0,9)!=="precision"){let i=t;return t===Qt.HIGH&&e!==Qt.HIGH&&(i=Qt.MEDIUM),`precision ${i} float;
${r}`}else if(e!==Qt.HIGH&&r.substring(0,15)==="precision highp")return r.replace("precision highp","precision mediump");return r}var an;function Wo(){if(typeof an=="boolean")return an;try{an=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{an=!1}return an}var w_=0,Xo={},Rl=class Xi{constructor(t,e,i="pixi-shader",s={}){this.extra={},this.id=w_++,this.vertexSrc=t||Xi.defaultVertexSrc,this.fragmentSrc=e||Xi.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=s,this.vertexSrc.substring(0,8)!=="#version"&&(i=i.replace(/\s+/g,"-"),Xo[i]?(Xo[i]++,i+=`-${Xo[i]}`):Xo[i]=1,this.vertexSrc=`#define SHADER_NAME ${i}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${i}
${this.fragmentSrc}`,this.vertexSrc=zo(this.vertexSrc,Xi.defaultVertexPrecision,Qt.HIGH),this.fragmentSrc=zo(this.fragmentSrc,Xi.defaultFragmentPrecision,Il())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return of}static get defaultFragmentSrc(){return nf}static from(t,e,i){let s=t+e,n=Js[s];return n||(Js[s]=n=new Xi(t,e,i)),n}};Rl.defaultVertexPrecision=Qt.HIGH,Rl.defaultFragmentPrecision=be.apple.device?Qt.HIGH:Qt.MEDIUM;var we=Rl;var T_=0,ee=class r{constructor(t,e,i){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=T_++,this.static=!!e,this.ubo=!!i,t instanceof Et?(this.buffer=t,this.buffer.type=oe.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new Et(new Float32Array(1)),this.buffer.type=oe.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,e,i){if(!this.ubo)this.uniforms[t]=new r(e,i);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(t,e,i){return new r(t,e,i)}static uboFrom(t,e){return new r(t,e??!0,!0)}};var ar=class r{constructor(t,e){this.uniformBindCount=0,this.program=t,e?e instanceof ee?this.uniformGroup=e:this.uniformGroup=new ee(e):this.uniformGroup=new ee({}),this.disposeRunner=new xt("disposeShader")}checkUniformExists(t,e){if(e.uniforms[t])return!0;for(let i in e.uniforms){let s=e.uniforms[i];if(s.group===!0&&this.checkUniformExists(t,s))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,e,i){let s=we.from(t,e);return new r(s,i)}};var hn=class{constructor(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},!e.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!e.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){let i=new Int32Array(t);for(let n=0;n<t;n++)i[n]=n;this.defaultGroupCache[t]=ee.from({uSamplers:i},!0);let s=this.fragTemplate;s=s.replace(/%count%/gi,`${t}`),s=s.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new we(this.vertexSrc,s)}let e={tint:new Float32Array([1,1,1,1]),translationMatrix:new tt,default:this.defaultGroupCache[t]};return new ar(this.programCache[t],e)}generateSampleSrc(t){let e="";e+=`
`,e+=`
`;for(let i=0;i<t;i++)i>0&&(e+=`
else `),i<t-1&&(e+=`if(vTextureId < ${i}.5)`),e+=`
{`,e+=`
	color = texture2D(uSamplers[${i}], vTextureCoord);`,e+=`
}`;return e+=`
`,e+=`
`,e}};var Pr=class{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}};function cf(){return!be.apple.device}function uf(r){let t=!0,e=S.ADAPTER.getNavigator();if(be.tablet||be.phone){if(be.apple.device){let i=e.userAgent.match(/OS (\d+)_(\d+)?/);i&&parseInt(i[1],10)<11&&(t=!1)}if(be.android.device){let i=e.userAgent.match(/Android\s([0-9.]*)/);i&&parseInt(i[1],10)<7&&(t=!1)}}return t?r:4}var Qr=class{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}};var df=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`;var pf=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;var ln=class Be extends Qr{constructor(t){super(t),this.setShaderGenerator(),this.geometryClass=Xr,this.vertexSize=6,this.state=ve.for2d(),this.size=Be.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),t.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??uf(32),this._defaultMaxTextures}static set defaultMaxTextures(t){this._defaultMaxTextures=t}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??cf(),this._canUploadSameBuffer}static set canUploadSameBuffer(t){this._canUploadSameBuffer=t}get MAX_TEXTURES(){return V("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return pf}static get defaultFragmentTemplate(){return df}setShaderGenerator({vertex:t=Be.defaultVertexSrc,fragment:e=Be.defaultFragmentTemplate}={}){this.shaderGenerator=new hn(t,e)}contextChange(){let t=this.renderer.gl;S.PREFER_ENV===fe.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),Be.defaultMaxTextures),this.maxTextures=No(this.maxTextures,t)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){let{_drawCallPool:t,_textureArrayPool:e}=Be,i=this.size/4,s=Math.floor(i/this.maxTextures)+1;for(;t.length<i;)t.push(new Ar);for(;e.length<s;)e.push(new Pr);for(let n=0;n<this.maxTextures;n++)this._tempBoundTextures[n]=null}onPrerender(){this._flushId=0}render(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)}buildTexturesAndDrawCalls(){let{_bufferedTextures:t,maxTextures:e}=this,i=Be._textureArrayPool,s=this.renderer.batch,n=this._tempBoundTextures,o=this.renderer.textureGC.count,a=++j._globalBatch,h=0,l=i[0],c=0;s.copyBoundTextures(n,e);for(let u=0;u<this._bufferSize;++u){let d=t[u];t[u]=null,d._batchEnabled!==a&&(l.count>=e&&(s.boundArray(l,n,a,e),this.buildDrawCalls(l,c,u),c=u,l=i[++h],++a),d._batchEnabled=a,d.touched=o,l.elements[l.count++]=d)}l.count>0&&(s.boundArray(l,n,a,e),this.buildDrawCalls(l,c,this._bufferSize),++h,++a);for(let u=0;u<n.length;u++)n[u]=null;j._globalBatch=a}buildDrawCalls(t,e,i){let{_bufferedElements:s,_attributeBuffer:n,_indexBuffer:o,vertexSize:a}=this,h=Be._drawCallPool,l=this._dcIndex,c=this._aIndex,u=this._iIndex,d=h[l];d.start=this._iIndex,d.texArray=t;for(let p=e;p<i;++p){let f=s[p],m=f._texture.baseTexture,b=qs[m.alphaMode?1:0][f.blendMode];s[p]=null,e<p&&d.blend!==b&&(d.size=u-d.start,e=p,d=h[++l],d.texArray=t,d.start=u),this.packInterleavedGeometry(f,n,o,c,u),c+=f.vertexData.length/2*a,u+=f.indices.length,d.blend=b}e<i&&(d.size=u-d.start,++l),this._dcIndex=l,this._aIndex=c,this._iIndex=u}bindAndClearTexArray(t){let e=this.renderer.texture;for(let i=0;i<t.count;i++)e.bind(t.elements[i],t.ids[i]),t.elements[i]=null;t.count=0}updateGeometry(){let{_packedGeometries:t,_attributeBuffer:e,_indexBuffer:i}=this;Be.canUploadSameBuffer?(t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(i),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,t[this._flushId]=new this.geometryClass),t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(i),this.renderer.geometry.bind(t[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){let t=this._dcIndex,{gl:e,state:i}=this.renderer,s=Be._drawCallPool,n=null;for(let o=0;o<t;o++){let{texArray:a,type:h,size:l,start:c,blend:u}=s[o];n!==a&&(n=a,this.bindAndClearTexArray(a)),this.state.blendMode=u,i.set(this.state),e.drawElements(h,l,e.UNSIGNED_SHORT,c*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),Be.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(t){let e=Sr(Math.ceil(t/8)),i=Zs(e),s=e*8;this._aBuffers.length<=i&&(this._iBuffers.length=i+1);let n=this._aBuffers[s];return n||(this._aBuffers[s]=n=new en(s*this.vertexSize*4)),n}getIndexBuffer(t){let e=Sr(Math.ceil(t/12)),i=Zs(e),s=e*12;this._iBuffers.length<=i&&(this._iBuffers.length=i+1);let n=this._iBuffers[i];return n||(this._iBuffers[i]=n=new Uint16Array(s)),n}packInterleavedGeometry(t,e,i,s,n){let{uint32View:o,float32View:a}=e,h=s/this.vertexSize,l=t.uvs,c=t.indices,u=t.vertexData,d=t._texture.baseTexture._batchLocation,p=Math.min(t.worldAlpha,1),f=J.shared.setValue(t._tintRGB).toPremultiplied(p,t._texture.baseTexture.alphaMode>0);for(let m=0;m<u.length;m+=2)a[s++]=u[m],a[s++]=u[m+1],a[s++]=l[m],a[s++]=l[m+1],o[s++]=f,a[s++]=d;for(let m=0;m<c.length;m++)i[n++]=h+c[m]}};ln.defaultBatchSize=4096,ln.extension={name:"batch",type:w.RendererPlugin},ln._drawCallPool=[],ln._textureArrayPool=[];var hr=ln;T.add(hr);var ff=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`;var mf=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;var Ml=class cn extends ar{constructor(t,e,i){let s=we.from(t||cn.defaultVertexSrc,e||cn.defaultFragmentSrc);super(s,i),this.padding=0,this.resolution=cn.defaultResolution,this.multisample=cn.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new ve}apply(t,e,i,s,n){t.applyFilter(this,e,i,s)}get blendMode(){return this.state.blendMode}set blendMode(t){this.state.blendMode=t}get resolution(){return this._resolution}set resolution(t){this._resolution=t}static get defaultVertexSrc(){return mf}static get defaultFragmentSrc(){return ff}};Ml.defaultResolution=1,Ml.defaultMultisample=ot.NONE;var $e=Ml;var lr=class{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new J(0),this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender;let{backgroundColor:e,background:i,backgroundAlpha:s}=t,n=i??e;n!==void 0&&(this.color=n),this.alpha=s}get color(){return this._backgroundColor.value}set color(t){this._backgroundColor.setValue(t)}get alpha(){return this._backgroundColor.alpha}set alpha(t){this._backgroundColor.setAlpha(t)}get backgroundColor(){return this._backgroundColor}destroy(){}};lr.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},lr.extension={type:[w.RendererSystem,w.CanvasRendererSystem],name:"background"};T.add(lr);var Yi=class{constructor(t){this.renderer=t,this.emptyRenderer=new Qr(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,e){let{boundTextures:i}=this.renderer.texture;for(let s=e-1;s>=0;--s)t[s]=i[s]||null,t[s]&&(t[s]._batchLocation=s)}boundArray(t,e,i,s){let{elements:n,ids:o,count:a}=t,h=0;for(let l=0;l<a;l++){let c=n[l],u=c._batchLocation;if(u>=0&&u<s&&e[u]===c){o[l]=u;continue}for(;h<s;){let d=e[h];if(d&&d._batchEnabled===i&&d._batchLocation===h){h++;continue}o[l]=h,c._batchLocation=h,e[h]=c;break}}}destroy(){this.renderer=null}};Yi.extension={type:w.RendererSystem,name:"batch"};T.add(Yi);var gf=0,cr=class{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=gf++}init(t){if(t.context)this.initFromContext(t.context);else{let e=this.renderer.background.alpha<1,i=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:e,premultipliedAlpha:i,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=gf++,this.renderer.runners.contextChange.emit(t);let e=this.renderer.view;e.addEventListener!==void 0&&(e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){let e=this.createContext(this.renderer.view,t);this.initFromContext(e)}createContext(t,e){let i;if(S.PREFER_ENV>=fe.WEBGL2&&(i=t.getContext("webgl2",e)),i)this.webGLVersion=2;else if(this.webGLVersion=1,i=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),!i)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=i,this.getExtensions(),this.gl}getExtensions(){let{gl:t}=this,e={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};this.webGLVersion===1?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){let t=this.renderer.view;this.renderer=null,t.removeEventListener!==void 0&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){let e=t.getContextAttributes(),i="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;i&&(this.webGLVersion=2),e&&!e.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");let s=i||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=s,s||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}};cr.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},cr.extension={type:w.RendererSystem,name:"context"};T.add(cr);var Rr=class{constructor(t,e){if(this.width=Math.round(t),this.height=Math.round(e),!this.width||!this.height)throw new Error("Framebuffer width or height is zero");this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new xt("disposeFramebuffer"),this.multisample=ot.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,e){return this.colorTextures[t]=e||new j(null,{scaleMode:ne.NEAREST,resolution:1,mipmap:Pe.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new j(null,{scaleMode:ne.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:Pe.OFF,format:I.DEPTH_COMPONENT,type:W.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,e){if(t=Math.round(t),e=Math.round(e),!t||!e)throw new Error("Framebuffer width and height must not be zero");if(!(t===this.width&&e===this.height)){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(let i=0;i<this.colorTextures.length;i++){let s=this.colorTextures[i],n=s.resolution;s.setSize(t/n,e/n)}if(this.depthTexture){let i=this.depthTexture.resolution;this.depthTexture.setSize(t/i,e/i)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}};var Jr=class extends j{constructor(t={}){if(typeof t=="number"){let e=arguments[0],i=arguments[1],s=arguments[2],n=arguments[3];t={width:e,height:i,scaleMode:s,resolution:n}}t.width=t.width??100,t.height=t.height??100,t.multisample??(t.multisample=ot.NONE),super(null,t),this.mipmap=Pe.OFF,this.valid=!0,this._clear=new J([0,0,0,0]),this.framebuffer=new Rr(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(t){this._clear.setValue(t)}get clearColor(){return this._clear.value}get clear(){return this._clear}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}};var Ot=class extends me{constructor(t){let e=t,i=e.naturalWidth||e.videoWidth||e.width,s=e.naturalHeight||e.videoHeight||e.height;super(i,s),this.source=t,this.noSubImage=!1}static crossOrigin(t,e,i){i===void 0&&!e.startsWith("data:")?t.crossOrigin=Oo(e):i!==!1&&(t.crossOrigin=typeof i=="string"?i:"anonymous")}upload(t,e,i,s){let n=t.gl,o=e.realWidth,a=e.realHeight;if(s=s||this.source,typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement){if(!s.complete||s.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&s instanceof HTMLVideoElement&&s.readyState<=1)return!1;return n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===kt.UNPACK),!this.noSubImage&&e.target===n.TEXTURE_2D&&i.width===o&&i.height===a?n.texSubImage2D(n.TEXTURE_2D,0,0,0,e.format,i.type,s):(i.width=o,i.height=a,n.texImage2D(e.target,0,i.internalFormat,e.format,i.type,s)),!0}update(){if(this.destroyed)return;let t=this.source,e=t.naturalWidth||t.videoWidth||t.width,i=t.naturalHeight||t.videoHeight||t.height;this.resize(e,i),super.update()}dispose(){this.source=null}};var ti=class extends Ot{constructor(t,e){if(e=e||{},typeof t=="string"){let i=new Image;Ot.crossOrigin(i,t,e.crossorigin),i.src=t,t=i}super(t),!t.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(e.createBitmap??S.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this.bitmap=null,this._load=null,e.autoLoad!==!1&&this.load()}load(t){return this._load?this._load:(t!==void 0&&(this.createBitmap=t),this._load=new Promise((e,i)=>{let s=this.source;this.url=s.src;let n=()=>{this.destroyed||(s.onload=null,s.onerror=null,this.update(),this._load=null,this.createBitmap?e(this.process()):e(this))};s.complete&&s.src?n():(s.onload=n,s.onerror=o=>{i(o),this.onError.emit(o)})}),this._load)}process(){let t=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);let e=globalThis.createImageBitmap,i=!t.crossOrigin||t.crossOrigin==="anonymous";return this._process=fetch(t.src,{mode:i?"cors":"no-cors"}).then(s=>s.blob()).then(s=>e(s,0,0,t.width,t.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===kt.UNPACK?"premultiply":"none"})).then(s=>this.destroyed?Promise.reject():(this.bitmap=s,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(t,e,i){if(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,e,i);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,e,i,this.bitmap),!this.preserveBitmap){let s=!0,n=e._glTextures;for(let o in n){let a=n[o];if(a!==i&&a.dirtyId!==e.dirtyId){s=!1;break}}s&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return typeof HTMLImageElement<"u"&&(typeof t=="string"||t instanceof HTMLImageElement)}};var ei=class{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,e,i){let s=e.width,n=e.height;if(i){let o=t.width/2/s,a=t.height/2/n,h=t.x/s+o,l=t.y/n+a;i=pt.add(i,pt.NW),this.x0=h+o*pt.uX(i),this.y0=l+a*pt.uY(i),i=pt.add(i,2),this.x1=h+o*pt.uX(i),this.y1=l+a*pt.uY(i),i=pt.add(i,2),this.x2=h+o*pt.uX(i),this.y2=l+a*pt.uY(i),i=pt.add(i,2),this.x3=h+o*pt.uX(i),this.y3=l+a*pt.uY(i)}else this.x0=t.x/s,this.y0=t.y/n,this.x1=(t.x+t.width)/s,this.y1=t.y/n,this.x2=(t.x+t.width)/s,this.y2=(t.y+t.height)/n,this.x3=t.x/s,this.y3=(t.y+t.height)/n;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}};ei.prototype.toString=function(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`};var yf=new ei;function Yo(r){r.destroy=function(){},r.on=function(){},r.once=function(){},r.emit=function(){}}var x=class r extends Ve.default{constructor(t,e,i,s,n,o,a){if(super(),this.noFrame=!1,e||(this.noFrame=!0,e=new H(0,0,1,1)),t instanceof r&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.trim=s,this.valid=!1,this.destroyed=!1,this._uvs=yf,this.uvMatrix=null,this.orig=i||e,this._rotate=Number(n||0),n===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=o?new X(o.x,o.y):new X(0,0),this.defaultBorders=a,this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=e:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){let{resource:e}=this.baseTexture;e?.url&&Ft[e.url]&&r.removeFromCache(e.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,r.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}clone(){let t=this._frame.clone(),e=this._frame===this.orig?t:this.orig.clone(),i=new r(this.baseTexture,!this.noFrame&&t,e,this.trim?.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(i._frame=t),i}updateUvs(){this._uvs===yf&&(this._uvs=new ei),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,e={},i=S.STRICT_TEXTURE_CACHE){let s=typeof t=="string",n=null;if(s)n=t;else if(t instanceof j){if(!t.cacheId){let a=e?.pixiIdPrefix||"pixiid";t.cacheId=`${a}-${He()}`,j.addToCache(t,t.cacheId)}n=t.cacheId}else{if(!t._pixiId){let a=e?.pixiIdPrefix||"pixiid";t._pixiId=`${a}_${He()}`}n=t._pixiId}let o=Ft[n];if(s&&i&&!o)throw new Error(`The cacheId "${n}" does not exist in TextureCache.`);return!o&&!(t instanceof j)?(e.resolution||(e.resolution=tn(t)),o=new r(new j(t,e)),o.baseTexture.cacheId=n,j.addToCache(o.baseTexture,n),r.addToCache(o,n)):!o&&t instanceof j&&(o=new r(t),r.addToCache(o,n)),o}static fromURL(t,e){let i=Object.assign({autoLoad:!1},e?.resourceOptions),s=r.from(t,Object.assign({resourceOptions:i},e),!1),n=s.baseTexture.resource;return s.baseTexture.valid?Promise.resolve(s):n.load().then(()=>Promise.resolve(s))}static fromBuffer(t,e,i,s){return new r(j.fromBuffer(t,e,i,s))}static fromLoader(t,e,i,s){let n=new j(t,Object.assign({scaleMode:j.defaultOptions.scaleMode,resolution:tn(e)},s)),{resource:o}=n;o instanceof ti&&(o.url=e);let a=new r(n);return i||(i=e),j.addToCache(a.baseTexture,i),r.addToCache(a,i),i!==e&&(j.addToCache(a.baseTexture,e),r.addToCache(a,e)),a.baseTexture.valid?Promise.resolve(a):new Promise(h=>{a.baseTexture.once("loaded",()=>h(a))})}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),Ft[e]&&Ft[e]!==t&&console.warn(`Texture added to the cache with an id [${e}] that already had an entry`),Ft[e]=t)}static removeFromCache(t){if(typeof t=="string"){let e=Ft[t];if(e){let i=e.textureCacheIds.indexOf(t);return i>-1&&e.textureCacheIds.splice(i,1),delete Ft[t],e}}else if(t?.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)Ft[t.textureCacheIds[e]]===t&&delete Ft[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;let{x:e,y:i,width:s,height:n}=t,o=e+s>this.baseTexture.width,a=i+n>this.baseTexture.height;if(o||a){let h=o&&a?"and":"or",l=`X: ${e} + ${s} = ${e+s} > ${this.baseTexture.width}`,c=`Y: ${i} + ${n} = ${i+n} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${l} ${h} ${c}`)}this.valid=s&&n&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return r._EMPTY||(r._EMPTY=new r(new j),Yo(r._EMPTY),Yo(r._EMPTY.baseTexture)),r._EMPTY}static get WHITE(){if(!r._WHITE){let t=S.ADAPTER.createCanvas(16,16),e=t.getContext("2d");t.width=16,t.height=16,e.fillStyle="white",e.fillRect(0,0,16,16),r._WHITE=new r(j.from(t)),Yo(r._WHITE),Yo(r._WHITE.baseTexture)}return r._WHITE}};var ri=class r extends x{constructor(t,e){super(t,e),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e,i=!0){let s=this.baseTexture.resolution,n=Math.round(t*s)/s,o=Math.round(e*s)/s;this.valid=n>0&&o>0,this._frame.width=this.orig.width=n,this._frame.height=this.orig.height=o,i&&this.baseTexture.resize(n,o),this.updateUvs()}setResolution(t){let{baseTexture:e}=this;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))}static create(t){return new r(new Jr(t))}};var qi=class{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,e,i=ot.NONE){let s=new Jr(Object.assign({width:t,height:e,resolution:1,multisample:i},this.textureOptions));return new ri(s)}getOptimalTexture(t,e,i=1,s=ot.NONE){let n;t=Math.max(Math.ceil(t*i-1e-6),1),e=Math.max(Math.ceil(e*i-1e-6),1),!this.enableFullScreen||t!==this._pixelsWidth||e!==this._pixelsHeight?(t=Sr(t),e=Sr(e),n=((t&65535)<<16|e&65535)>>>0,s>1&&(n+=s*4294967296)):n=s>1?-s:-1,this.texturePool[n]||(this.texturePool[n]=[]);let o=this.texturePool[n].pop();return o||(o=this.createTexture(t,e,s)),o.filterPoolKey=n,o.setResolution(i),o}getFilterTexture(t,e,i){let s=this.getOptimalTexture(t.width,t.height,e||t.resolution,i||ot.NONE);return s.filterFrame=t.filterFrame,s}returnTexture(t){let e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=t!==!1,t)for(let e in this.texturePool){let i=this.texturePool[e];if(i)for(let s=0;s<i.length;s++)i[s].destroy(!0)}this.texturePool={}}setScreenSize(t){if(!(t.width===this._pixelsWidth&&t.height===this._pixelsHeight)){this.enableFullScreen=t.width>0&&t.height>0;for(let e in this.texturePool){if(!(Number(e)<0))continue;let i=this.texturePool[e];if(i)for(let s=0;s<i.length;s++)i[s].destroy(!0);this.texturePool[e]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}};qi.SCREEN_KEY=-1;var un=class extends or{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}};var dn=class extends or{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new Et(this.vertices),this.uvBuffer=new Et(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,e){let i=0,s=0;return this.uvs[0]=i,this.uvs[1]=s,this.uvs[2]=i+e.width/t.width,this.uvs[3]=s,this.uvs[4]=i+e.width/t.width,this.uvs[5]=s+e.height/t.height,this.uvs[6]=i,this.uvs[7]=s+e.height/t.height,i=e.x,s=e.y,this.vertices[0]=i,this.vertices[1]=s,this.vertices[2]=i+e.width,this.vertices[3]=s,this.vertices[4]=i+e.width,this.vertices[5]=s+e.height,this.vertices[6]=i,this.vertices[7]=s+e.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}};var pn=class{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=ot.NONE,this.sourceFrame=new H,this.destinationFrame=new H,this.bindingSourceFrame=new H,this.bindingDestinationFrame=new H,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}};var qo=[new X,new X,new X,new X],Fl=new tt,Ki=class{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new qi,this.statePool=[],this.quad=new un,this.quadUv=new dn,this.tempRect=new H,this.activeState={},this.globalUniforms=new ee({outputFrame:new H,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,e){let i=this.renderer,s=this.defaultFilterStack,n=this.statePool.pop()||new pn,o=i.renderTexture,a,h;if(o.current){let b=o.current;a=b.resolution,h=b.multisample}else a=i.resolution,h=i.multisample;let l=e[0].resolution||a,c=e[0].multisample??h,u=e[0].padding,d=e[0].autoFit,p=e[0].legacy??!0;for(let b=1;b<e.length;b++){let y=e[b];l=Math.min(l,y.resolution||a),c=Math.min(c,y.multisample??h),u=this.useMaxPadding?Math.max(u,y.padding):u+y.padding,d=d&&y.autoFit,p=p||(y.legacy??!0)}s.length===1&&(this.defaultFilterStack[0].renderTexture=o.current),s.push(n),n.resolution=l,n.multisample=c,n.legacy=p,n.target=t,n.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),n.sourceFrame.pad(u);let f=this.tempRect.copyFrom(o.sourceFrame);i.projection.transform&&this.transformAABB(Fl.copyFrom(i.projection.transform).invert(),f),d?(n.sourceFrame.fit(f),(n.sourceFrame.width<=0||n.sourceFrame.height<=0)&&(n.sourceFrame.width=0,n.sourceFrame.height=0)):n.sourceFrame.intersects(f)||(n.sourceFrame.width=0,n.sourceFrame.height=0),this.roundFrame(n.sourceFrame,o.current?o.current.resolution:i.resolution,o.sourceFrame,o.destinationFrame,i.projection.transform),n.renderTexture=this.getOptimalFilterTexture(n.sourceFrame.width,n.sourceFrame.height,l,c),n.filters=e,n.destinationFrame.width=n.renderTexture.width,n.destinationFrame.height=n.renderTexture.height;let m=this.tempRect;m.x=0,m.y=0,m.width=n.sourceFrame.width,m.height=n.sourceFrame.height,n.renderTexture.filterFrame=n.sourceFrame,n.bindingSourceFrame.copyFrom(o.sourceFrame),n.bindingDestinationFrame.copyFrom(o.destinationFrame),n.transform=i.projection.transform,i.projection.transform=null,o.bind(n.renderTexture,n.sourceFrame,m),i.framebuffer.clear(0,0,0,0)}pop(){let t=this.defaultFilterStack,e=t.pop(),i=e.filters;this.activeState=e;let s=this.globalUniforms.uniforms;s.outputFrame=e.sourceFrame,s.resolution=e.resolution;let n=s.inputSize,o=s.inputPixel,a=s.inputClamp;if(n[0]=e.destinationFrame.width,n[1]=e.destinationFrame.height,n[2]=1/n[0],n[3]=1/n[1],o[0]=Math.round(n[0]*e.resolution),o[1]=Math.round(n[1]*e.resolution),o[2]=1/o[0],o[3]=1/o[1],a[0]=.5*o[2],a[1]=.5*o[3],a[2]=e.sourceFrame.width*n[2]-.5*o[2],a[3]=e.sourceFrame.height*n[3]-.5*o[3],e.legacy){let l=s.filterArea;l[0]=e.destinationFrame.width,l[1]=e.destinationFrame.height,l[2]=e.sourceFrame.x,l[3]=e.sourceFrame.y,s.filterClamp=s.inputClamp}this.globalUniforms.update();let h=t[t.length-1];if(this.renderer.framebuffer.blit(),i.length===1)i[0].apply(this,e.renderTexture,h.renderTexture,_r.BLEND,e),this.returnFilterTexture(e.renderTexture);else{let l=e.renderTexture,c=this.getOptimalFilterTexture(l.width,l.height,e.resolution);c.filterFrame=l.filterFrame;let u=0;for(u=0;u<i.length-1;++u){u===1&&e.multisample>1&&(c=this.getOptimalFilterTexture(l.width,l.height,e.resolution),c.filterFrame=l.filterFrame),i[u].apply(this,l,c,_r.CLEAR,e);let d=l;l=c,c=d}i[u].apply(this,l,h.renderTexture,_r.BLEND,e),u>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(l),this.returnFilterTexture(c)}e.clear(),this.statePool.push(e)}bindAndClear(t,e=_r.CLEAR){let{renderTexture:i,state:s}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t?.filterFrame){let o=this.tempRect;o.x=0,o.y=0,o.width=t.filterFrame.width,o.height=t.filterFrame.height,i.bind(t,t.filterFrame,o)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?i.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);let n=s.stateId&1||this.forceClear;(e===_r.CLEAR||e===_r.BLIT&&n)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,e,i,s){let n=this.renderer;n.state.set(t.state),this.bindAndClear(i,s),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,n.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),n.geometry.bind(this.quadUv),n.geometry.draw(Ie.TRIANGLES)):(n.geometry.bind(this.quad),n.geometry.draw(Ie.TRIANGLE_STRIP))}calculateSpriteMatrix(t,e){let{sourceFrame:i,destinationFrame:s}=this.activeState,{orig:n}=e._texture,o=t.set(s.width,0,0,s.height,i.x,i.y),a=e.worldTransform.copyTo(tt.TEMP_MATRIX);return a.invert(),o.prepend(a),o.scale(1/n.width,1/n.height),o.translate(e.anchor.x,e.anchor.y),o}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,e,i=1,s=ot.NONE){return this.texturePool.getOptimalTexture(t,e,i,s)}getFilterTexture(t,e,i){if(typeof t=="number"){let n=t;t=e,e=n}t=t||this.activeState.renderTexture;let s=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,i||ot.NONE);return s.filterFrame=t.filterFrame,s}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,e){let i=qo[0],s=qo[1],n=qo[2],o=qo[3];i.set(e.left,e.top),s.set(e.left,e.bottom),n.set(e.right,e.top),o.set(e.right,e.bottom),t.apply(i,i),t.apply(s,s),t.apply(n,n),t.apply(o,o);let a=Math.min(i.x,s.x,n.x,o.x),h=Math.min(i.y,s.y,n.y,o.y),l=Math.max(i.x,s.x,n.x,o.x),c=Math.max(i.y,s.y,n.y,o.y);e.x=a,e.y=h,e.width=l-a,e.height=c-h}roundFrame(t,e,i,s,n){if(!(t.width<=0||t.height<=0||i.width<=0||i.height<=0)){if(n){let{a:o,b:a,c:h,d:l}=n;if((Math.abs(a)>1e-4||Math.abs(h)>1e-4)&&(Math.abs(o)>1e-4||Math.abs(l)>1e-4))return}n=n?Fl.copyFrom(n):Fl.identity(),n.translate(-i.x,-i.y).scale(s.width/i.width,s.height/i.height).translate(s.x,s.y),this.transformAABB(n,t),t.ceil(e),this.transformAABB(n.invert(),t)}}};Ki.extension={type:w.RendererSystem,name:"filter"};T.add(Ki);var fn=class{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=ot.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}};var E_=new H,Zi=class{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new Rr(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);let t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new H,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let e=this.renderer.context.extensions.drawBuffers,i=this.renderer.context.extensions.depthTexture;S.PREFER_ENV===fe.WEBGL_LEGACY&&(e=null,i=null),e?t.drawBuffers=s=>e.drawBuffersWEBGL(s):(this.hasMRT=!1,t.drawBuffers=()=>{}),i||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,e,i=0){let{gl:s}=this;if(t){let n=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,s.bindFramebuffer(s.FRAMEBUFFER,n.framebuffer)),n.mipLevel!==i&&(t.dirtyId++,t.dirtyFormat++,n.mipLevel=i),n.dirtyId!==t.dirtyId&&(n.dirtyId=t.dirtyId,n.dirtyFormat!==t.dirtyFormat?(n.dirtyFormat=t.dirtyFormat,n.dirtySize=t.dirtySize,this.updateFramebuffer(t,i)):n.dirtySize!==t.dirtySize&&(n.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let o=0;o<t.colorTextures.length;o++){let a=t.colorTextures[o];this.renderer.texture.unbind(a.parentTextureArray||a)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){let o=e.width>>i,a=e.height>>i,h=o/e.width;this.setViewport(e.x*h,e.y*h,o,a)}else{let o=t.width>>i,a=t.height>>i;this.setViewport(0,0,o,a)}}else this.current&&(this.current=null,s.bindFramebuffer(s.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,e,i,s){let n=this.viewport;t=Math.round(t),e=Math.round(e),i=Math.round(i),s=Math.round(s),(n.width!==i||n.height!==s||n.x!==t||n.y!==e)&&(n.x=t,n.y=e,n.width=i,n.height=s,this.gl.viewport(t,e,i,s))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,e,i,s,n=ho.COLOR|ho.DEPTH){let{gl:o}=this;o.clearColor(t,e,i,s),o.clear(n)}initFramebuffer(t){let{gl:e}=this,i=new fn(e.createFramebuffer());return i.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=i,this.managedFramebuffers.push(t),t.disposeRunner.add(this),i}resizeFramebuffer(t){let{gl:e}=this,i=t.glFramebuffers[this.CONTEXT_UID];if(i.stencil){e.bindRenderbuffer(e.RENDERBUFFER,i.stencil);let o;this.renderer.context.webGLVersion===1?o=e.DEPTH_STENCIL:t.depth&&t.stencil?o=e.DEPTH24_STENCIL8:t.depth?o=e.DEPTH_COMPONENT24:o=e.STENCIL_INDEX8,i.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,o,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,o,t.width,t.height)}let s=t.colorTextures,n=s.length;e.drawBuffers||(n=Math.min(n,1));for(let o=0;o<n;o++){let a=s[o],h=a.parentTextureArray||a;this.renderer.texture.bind(h,0),o===0&&i.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,i.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,h._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,e){let{gl:i}=this,s=t.glFramebuffers[this.CONTEXT_UID],n=t.colorTextures,o=n.length;i.drawBuffers||(o=Math.min(o,1)),s.multisample>1&&this.canMultisampleFramebuffer(t)?s.msaaBuffer=s.msaaBuffer||i.createRenderbuffer():s.msaaBuffer&&(i.deleteRenderbuffer(s.msaaBuffer),s.msaaBuffer=null,s.blitFramebuffer&&(s.blitFramebuffer.dispose(),s.blitFramebuffer=null));let a=[];for(let h=0;h<o;h++){let l=n[h],c=l.parentTextureArray||l;this.renderer.texture.bind(c,0),h===0&&s.msaaBuffer?(i.bindRenderbuffer(i.RENDERBUFFER,s.msaaBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,s.multisample,c._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,s.msaaBuffer)):(i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+h,l.target,c._glTextures[this.CONTEXT_UID].texture,e),a.push(i.COLOR_ATTACHMENT0+h))}if(a.length>1&&i.drawBuffers(a),t.depthTexture&&this.writeDepthTexture){let h=t.depthTexture;this.renderer.texture.bind(h,0),i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,h._glTextures[this.CONTEXT_UID].texture,e)}if((t.stencil||t.depth)&&!(t.depthTexture&&this.writeDepthTexture)){s.stencil=s.stencil||i.createRenderbuffer();let h,l;this.renderer.context.webGLVersion===1?(h=i.DEPTH_STENCIL_ATTACHMENT,l=i.DEPTH_STENCIL):t.depth&&t.stencil?(h=i.DEPTH_STENCIL_ATTACHMENT,l=i.DEPTH24_STENCIL8):t.depth?(h=i.DEPTH_ATTACHMENT,l=i.DEPTH_COMPONENT24):(h=i.STENCIL_ATTACHMENT,l=i.STENCIL_INDEX8),i.bindRenderbuffer(i.RENDERBUFFER,s.stencil),s.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,s.multisample,l,t.width,t.height):i.renderbufferStorage(i.RENDERBUFFER,l,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,h,i.RENDERBUFFER,s.stencil)}else s.stencil&&(i.deleteRenderbuffer(s.stencil),s.stencil=null)}canMultisampleFramebuffer(t){return this.renderer.context.webGLVersion!==1&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){let{msaaSamples:e}=this,i=ot.NONE;if(t<=1||e===null)return i;for(let s=0;s<e.length;s++)if(e[s]<=t){i=e[s];break}return i===1&&(i=ot.NONE),i}blit(t,e,i){let{current:s,renderer:n,gl:o,CONTEXT_UID:a}=this;if(n.context.webGLVersion!==2||!s)return;let h=s.glFramebuffers[a];if(!h)return;if(!t){if(!h.msaaBuffer)return;let c=s.colorTextures[0];if(!c)return;h.blitFramebuffer||(h.blitFramebuffer=new Rr(s.width,s.height),h.blitFramebuffer.addColorTexture(0,c)),t=h.blitFramebuffer,t.colorTextures[0]!==c&&(t.colorTextures[0]=c,t.dirtyId++,t.dirtyFormat++),(t.width!==s.width||t.height!==s.height)&&(t.width=s.width,t.height=s.height,t.dirtyId++,t.dirtySize++)}e||(e=E_,e.width=s.width,e.height=s.height),i||(i=e);let l=e.width===i.width&&e.height===i.height;this.bind(t),o.bindFramebuffer(o.READ_FRAMEBUFFER,h.framebuffer),o.blitFramebuffer(e.left,e.top,e.right,e.bottom,i.left,i.top,i.right,i.bottom,o.COLOR_BUFFER_BIT,l?o.NEAREST:o.LINEAR),o.bindFramebuffer(o.READ_FRAMEBUFFER,t.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(t,e){let i=t.glFramebuffers[this.CONTEXT_UID],s=this.gl;if(!i)return;delete t.glFramebuffers[this.CONTEXT_UID];let n=this.managedFramebuffers.indexOf(t);n>=0&&this.managedFramebuffers.splice(n,1),t.disposeRunner.remove(this),e||(s.deleteFramebuffer(i.framebuffer),i.msaaBuffer&&s.deleteRenderbuffer(i.msaaBuffer),i.stencil&&s.deleteRenderbuffer(i.stencil)),i.blitFramebuffer&&this.disposeFramebuffer(i.blitFramebuffer,e)}disposeAll(t){let e=this.managedFramebuffers;this.managedFramebuffers=[];for(let i=0;i<e.length;i++)this.disposeFramebuffer(e[i],t)}forceStencil(){let t=this.current;if(!t)return;let e=t.glFramebuffers[this.CONTEXT_UID];if(!e||e.stencil&&t.stencil)return;t.stencil=!0;let i=t.width,s=t.height,n=this.gl,o=e.stencil=n.createRenderbuffer();n.bindRenderbuffer(n.RENDERBUFFER,o);let a,h;this.renderer.context.webGLVersion===1?(a=n.DEPTH_STENCIL_ATTACHMENT,h=n.DEPTH_STENCIL):t.depth?(a=n.DEPTH_STENCIL_ATTACHMENT,h=n.DEPTH24_STENCIL8):(a=n.STENCIL_ATTACHMENT,h=n.STENCIL_INDEX8),e.msaaBuffer?n.renderbufferStorageMultisample(n.RENDERBUFFER,e.multisample,h,i,s):n.renderbufferStorage(n.RENDERBUFFER,h,i,s),n.framebufferRenderbuffer(n.FRAMEBUFFER,a,n.RENDERBUFFER,o)}reset(){this.current=this.unknownFramebuffer,this.viewport=new H}destroy(){this.renderer=null}};Zi.extension={type:w.RendererSystem,name:"framebuffer"};T.add(Zi);var Bl={5126:4,5123:2,5121:1},Qi=class{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);let t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,e.webGLVersion!==2){let i=this.renderer.context.extensions.vertexArrayObject;S.PREFER_ENV===fe.WEBGL_LEGACY&&(i=null),i?(t.createVertexArray=()=>i.createVertexArrayOES(),t.bindVertexArray=s=>i.bindVertexArrayOES(s),t.deleteVertexArray=s=>i.deleteVertexArrayOES(s)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(e.webGLVersion!==2){let i=t.getExtension("ANGLE_instanced_arrays");i?(t.vertexAttribDivisor=(s,n)=>i.vertexAttribDivisorANGLE(s,n),t.drawElementsInstanced=(s,n,o,a,h)=>i.drawElementsInstancedANGLE(s,n,o,a,h),t.drawArraysInstanced=(s,n,o,a)=>i.drawArraysInstancedANGLE(s,n,o,a)):this.hasInstance=!1}this.canUseUInt32ElementIndex=e.webGLVersion===2||!!e.extensions.uint32ElementIndex}bind(t,e){e=e||this.renderer.shader.shader;let{gl:i}=this,s=t.glVertexArrayObjects[this.CONTEXT_UID],n=!1;s||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=s={},n=!0);let o=s[e.program.id]||this.initGeometryVao(t,e,n);this._activeGeometry=t,this._activeVao!==o&&(this._activeVao=o,this.hasVao?i.bindVertexArray(o):this.activateVao(t,e.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){let t=this._activeGeometry,e=this.renderer.buffer;for(let i=0;i<t.buffers.length;i++){let s=t.buffers[i];e.update(s)}}checkCompatibility(t,e){let i=t.attributes,s=e.attributeData;for(let n in s)if(!i[n])throw new Error(`shader and geometry incompatible, geometry missing the "${n}" attribute`)}getSignature(t,e){let i=t.attributes,s=e.attributeData,n=["g",t.id];for(let o in i)s[o]&&n.push(o,s[o].location);return n.join("-")}initGeometryVao(t,e,i=!0){let s=this.gl,n=this.CONTEXT_UID,o=this.renderer.buffer,a=e.program;a.glPrograms[n]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,a);let h=this.getSignature(t,a),l=t.glVertexArrayObjects[this.CONTEXT_UID],c=l[h];if(c)return l[a.id]=c,c;let u=t.buffers,d=t.attributes,p={},f={};for(let m in u)p[m]=0,f[m]=0;for(let m in d)!d[m].size&&a.attributeData[m]?d[m].size=a.attributeData[m].size:d[m].size||console.warn(`PIXI Geometry attribute '${m}' size cannot be determined (likely the bound shader does not have the attribute)`),p[d[m].buffer]+=d[m].size*Bl[d[m].type];for(let m in d){let b=d[m],y=b.size;b.stride===void 0&&(p[b.buffer]===y*Bl[b.type]?b.stride=0:b.stride=p[b.buffer]),b.start===void 0&&(b.start=f[b.buffer],f[b.buffer]+=y*Bl[b.type])}c=s.createVertexArray(),s.bindVertexArray(c);for(let m=0;m<u.length;m++){let b=u[m];o.bind(b),i&&b._glBuffers[n].refCount++}return this.activateVao(t,a),l[a.id]=c,l[h]=c,s.bindVertexArray(null),o.unbind(oe.ARRAY_BUFFER),c}disposeGeometry(t,e){if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];let i=t.glVertexArrayObjects[this.CONTEXT_UID],s=this.gl,n=t.buffers,o=this.renderer?.buffer;if(t.disposeRunner.remove(this),!!i){if(o)for(let a=0;a<n.length;a++){let h=n[a]._glBuffers[this.CONTEXT_UID];h&&(h.refCount--,h.refCount===0&&!e&&o.dispose(n[a],e))}if(!e){for(let a in i)if(a[0]==="g"){let h=i[a];this._activeVao===h&&this.unbind(),s.deleteVertexArray(h)}}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){let e=Object.keys(this.managedGeometries);for(let i=0;i<e.length;i++)this.disposeGeometry(this.managedGeometries[e[i]],t)}activateVao(t,e){let i=this.gl,s=this.CONTEXT_UID,n=this.renderer.buffer,o=t.buffers,a=t.attributes;t.indexBuffer&&n.bind(t.indexBuffer);let h=null;for(let l in a){let c=a[l],u=o[c.buffer],d=u._glBuffers[s];if(e.attributeData[l]){h!==d&&(n.bind(u),h=d);let p=e.attributeData[l].location;if(i.enableVertexAttribArray(p),i.vertexAttribPointer(p,c.size,c.type||i.FLOAT,c.normalized,c.stride,c.start),c.instance)if(this.hasInstance)i.vertexAttribDivisor(p,c.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(t,e,i,s){let{gl:n}=this,o=this._activeGeometry;if(o.indexBuffer){let a=o.indexBuffer.data.BYTES_PER_ELEMENT,h=a===2?n.UNSIGNED_SHORT:n.UNSIGNED_INT;a===2||a===4&&this.canUseUInt32ElementIndex?o.instanced?n.drawElementsInstanced(t,e||o.indexBuffer.data.length,h,(i||0)*a,s||1):n.drawElements(t,e||o.indexBuffer.data.length,h,(i||0)*a):console.warn("unsupported index buffer type: uint32")}else o.instanced?n.drawArraysInstanced(t,i,e||o.getSize(),s||1):n.drawArrays(t,i,e||o.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}};Qi.extension={type:w.RendererSystem,name:"geometry"};T.add(Qi);var bf=new tt,mn=class{constructor(t,e){this._texture=t,this.mapCoord=new tt,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof e>"u"?.5:e,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,e){e===void 0&&(e=t);let i=this.mapCoord;for(let s=0;s<t.length;s+=2){let n=t[s],o=t[s+1];e[s]=n*i.a+o*i.c+i.tx,e[s+1]=n*i.b+o*i.d+i.ty}return e}update(t){let e=this._texture;if(!e||!e.valid||!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;let i=e._uvs;this.mapCoord.set(i.x1-i.x0,i.y1-i.y0,i.x3-i.x0,i.y3-i.y0,i.x0,i.y0);let s=e.orig,n=e.trim;n&&(bf.set(s.width/n.width,0,0,s.height/n.height,-n.x/n.width,-n.y/n.height),this.mapCoord.append(bf));let o=e.baseTexture,a=this.uClampFrame,h=this.clampMargin/o.resolution,l=this.clampOffset;return a[0]=(e._frame.x+h+l)/o.width,a[1]=(e._frame.y+h+l)/o.height,a[2]=(e._frame.x+e._frame.width-h+l)/o.width,a[3]=(e._frame.y+e._frame.height-h+l)/o.height,this.uClampOffset[0]=l/o.realWidth,this.uClampOffset[1]=l/o.realHeight,this.isSimple=e._frame.width===o.width&&e._frame.height===o.height&&e.rotate===0,!0}};var _f=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`;var xf=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;var gn=class extends $e{constructor(t,e,i){let s=null;typeof t!="string"&&e===void 0&&i===void 0&&(s=t,t=void 0,e=void 0,i=void 0),super(t||xf,e||_f,i),this.maskSprite=s,this.maskMatrix=new tt}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,e,i,s){let n=this._maskSprite,o=n._texture;o.valid&&(o.uvMatrix||(o.uvMatrix=new mn(o,0)),o.uvMatrix.update(),this.uniforms.npmAlpha=o.baseTexture.alphaMode?0:1,this.uniforms.mask=o,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,n).prepend(o.uvMatrix.mapCoord),this.uniforms.alpha=n.worldAlpha,this.uniforms.maskClamp=o.uvMatrix.uClampFrame,t.applyFilter(this,e,i,s))}};var yn=class{constructor(t=null){this.type=_t.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=$e.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=_t.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}};var Ji=class{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,e){let i=e;if(!i.isMaskData){let n=this.maskDataPool.pop()||new yn;n.pooled=!0,n.maskObject=e,i=n}let s=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(i.copyCountersOrReset(s),i._colorMask=s?s._colorMask:15,i.autoDetect&&this.detect(i),i._target=t,i.type!==_t.SPRITE&&this.maskStack.push(i),i.enabled)switch(i.type){case _t.SCISSOR:this.renderer.scissor.push(i);break;case _t.STENCIL:this.renderer.stencil.push(i);break;case _t.SPRITE:i.copyCountersOrReset(null),this.pushSpriteMask(i);break;case _t.COLOR:this.pushColorMask(i);break;default:break}i.type===_t.SPRITE&&this.maskStack.push(i)}pop(t){let e=this.maskStack.pop();if(!(!e||e._target!==t)){if(e.enabled)switch(e.type){case _t.SCISSOR:this.renderer.scissor.pop(e);break;case _t.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case _t.SPRITE:this.popSpriteMask(e);break;case _t.COLOR:this.popColorMask(e);break;default:break}if(e.reset(),e.pooled&&this.maskDataPool.push(e),this.maskStack.length!==0){let i=this.maskStack[this.maskStack.length-1];i.type===_t.SPRITE&&i._filters&&(i._filters[0].maskSprite=i.maskObject)}}}detect(t){let e=t.maskObject;e?e.isSprite?t.type=_t.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=_t.SCISSOR:t.type=_t.STENCIL:t.type=_t.COLOR}pushSpriteMask(t){let{maskObject:e}=t,i=t._target,s=t._filters;s||(s=this.alphaMaskPool[this.alphaMaskIndex],s||(s=this.alphaMaskPool[this.alphaMaskIndex]=[new gn])),s[0].resolution=t.resolution,s[0].multisample=t.multisample,s[0].maskSprite=e;let n=i.filterArea;i.filterArea=e.getBounds(!0),this.renderer.filter.push(i,s),i.filterArea=n,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){let e=t._colorMask,i=t._colorMask=e&t.colorMask;i!==e&&this.renderer.gl.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)}popColorMask(t){let e=t._colorMask,i=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;i!==e&&this.renderer.gl.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)}destroy(){this.renderer=null}};Ji.extension={type:w.RendererSystem,name:"mask"};T.add(Ji);var ts=class{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){let{gl:e}=this.renderer,i=this.getStackLength();this.maskStack=t;let s=this.getStackLength();s!==i&&(s===0?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}};var vf=new tt,wf=[],Tf=class Ko extends ts{constructor(t){super(t),this.glConst=S.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){let t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0}calcScissorRect(t){if(t._scissorRectLocal)return;let e=t._scissorRect,{maskObject:i}=t,{renderer:s}=this,n=s.renderTexture,o=i.getBounds(!0,wf.pop()??new H);this.roundFrameToPixels(o,n.current?n.current.resolution:s.resolution,n.sourceFrame,n.destinationFrame,s.projection.transform),e&&o.fit(e),t._scissorRectLocal=o}static isMatrixRotated(t){if(!t)return!1;let{a:e,b:i,c:s,d:n}=t;return(Math.abs(i)>1e-4||Math.abs(s)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(n)>1e-4)}testScissor(t){let{maskObject:e}=t;if(!e.isFastRect||!e.isFastRect()||Ko.isMatrixRotated(e.worldTransform)||Ko.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(t);let i=t._scissorRectLocal;return i.width>0&&i.height>0}roundFrameToPixels(t,e,i,s,n){Ko.isMatrixRotated(n)||(n=n?vf.copyFrom(n):vf.identity(),n.translate(-i.x,-i.y).scale(s.width/i.width,s.height/i.height).translate(s.x,s.y),this.renderer.filter.transformAABB(n,t),t.fit(s),t.x=Math.round(t.x*e),t.y=Math.round(t.y*e),t.width=Math.round(t.width*e),t.height=Math.round(t.height*e))}push(t){t._scissorRectLocal||this.calcScissorRect(t);let{gl:e}=this.renderer;t._scissorRect||e.enable(e.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=t._scissorRectLocal,this._useCurrent()}pop(t){let{gl:e}=this.renderer;t&&wf.push(t._scissorRectLocal),this.getStackLength()>0?this._useCurrent():e.disable(e.SCISSOR_TEST)}_useCurrent(){let t=this.maskStack[this.maskStack.length-1]._scissorRect,e;this.renderer.renderTexture.current?e=t.y:e=this.renderer.height-t.height-t.y,this.renderer.gl.scissor(t.x,e,t.width,t.height)}};Tf.extension={type:w.RendererSystem,name:"scissor"};var Ll=Tf;T.add(Ll);var es=class extends ts{constructor(t){super(t),this.glConst=S.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){let t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){let e=t.maskObject,{gl:i}=this.renderer,s=t._stencilCounter;s===0&&(this.renderer.framebuffer.forceStencil(),i.clearStencil(0),i.clear(i.STENCIL_BUFFER_BIT),i.enable(i.STENCIL_TEST)),t._stencilCounter++;let n=t._colorMask;n!==0&&(t._colorMask=0,i.colorMask(!1,!1,!1,!1)),i.stencilFunc(i.EQUAL,s,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,n!==0&&(t._colorMask=n,i.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)),this._useCurrent()}pop(t){let e=this.renderer.gl;if(this.getStackLength()===0)e.disable(e.STENCIL_TEST);else{let i=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,s=i?i._colorMask:15;s!==0&&(i._colorMask=0,e.colorMask(!1,!1,!1,!1)),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,s!==0&&(i._colorMask=s,e.colorMask((s&1)!==0,(s&2)!==0,(s&4)!==0,(s&8)!==0)),this._useCurrent()}}_useCurrent(){let t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}};es.extension={type:w.RendererSystem,name:"stencil"};T.add(es);var rs=class{constructor(t){this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return V("7.0.0","renderer.plugins.extract has moved to renderer.extract"),t.extract}},prepare:{enumerable:!1,get(){return V("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),t.prepare}},interaction:{enumerable:!1,get(){return V("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),t.events}}})}init(){let t=this.rendererPlugins;for(let e in t)this.plugins[e]=new t[e](this.renderer)}destroy(){for(let t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}};rs.extension={type:[w.RendererSystem,w.CanvasRendererSystem],name:"_plugin"};T.add(rs);var is=class{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new tt,this.transform=null}update(t,e,i,s){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,i,s),this.transform&&this.projectionMatrix.append(this.transform);let n=this.renderer;n.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,n.globalUniforms.update(),n.shader.shader&&n.shader.syncUniformGroup(n.shader.shader.uniforms.globals)}calculateProjection(t,e,i,s){let n=this.projectionMatrix,o=s?-1:1;n.identity(),n.a=1/e.width*2,n.d=o*(1/e.height*2),n.tx=-1-e.x*n.a,n.ty=-o-e.y*n.d}setTransform(t){}destroy(){this.renderer=null}};is.extension={type:w.RendererSystem,name:"projection"};T.add(is);var S_=new Wi,Ef=new H,ss=class{constructor(t){this.renderer=t,this._tempMatrix=new tt}generateTexture(t,e){let{region:i,...s}=e||{},n=i?.copyTo(Ef)||t.getLocalBounds(Ef,!0),o=s.resolution||this.renderer.resolution;n.width=Math.max(n.width,1/o),n.height=Math.max(n.height,1/o),s.width=n.width,s.height=n.height,s.resolution=o,s.multisample??(s.multisample=this.renderer.multisample);let a=ri.create(s);this._tempMatrix.tx=-n.x,this._tempMatrix.ty=-n.y;let h=t.transform;return t.transform=S_,this.renderer.render(t,{renderTexture:a,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=h,a}destroy(){}};ss.extension={type:[w.RendererSystem,w.CanvasRendererSystem],name:"textureGenerator"};T.add(ss);var ii=new H,bn=new H,ns=class{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new H,this.destinationFrame=new H,this.viewportFrame=new H}contextChange(){let t=this.renderer?.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}bind(t=null,e,i){let s=this.renderer;this.current=t;let n,o,a;t?(n=t.baseTexture,a=n.resolution,e||(ii.width=t.frame.width,ii.height=t.frame.height,e=ii),i||(bn.x=t.frame.x,bn.y=t.frame.y,bn.width=e.width,bn.height=e.height,i=bn),o=n.framebuffer):(a=s.resolution,e||(ii.width=s._view.screen.width,ii.height=s._view.screen.height,e=ii),i||(i=ii,i.width=e.width,i.height=e.height));let h=this.viewportFrame;h.x=i.x*a,h.y=i.y*a,h.width=i.width*a,h.height=i.height*a,t||(h.y=s.view.height-(h.y+h.height)),h.ceil(),this.renderer.framebuffer.bind(o,h),this.renderer.projection.update(i,e,a,!o),t?this.renderer.mask.setMaskStack(n.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(i)}clear(t,e){let i=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,s=J.shared.setValue(t||i);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&s.premultiply(s.alpha);let n=this.destinationFrame,o=this.current?this.current.baseTexture:this.renderer._view.screen,a=n.width!==o.width||n.height!==o.height;if(a){let{x:h,y:l,width:c,height:u}=this.viewportFrame;h=Math.round(h),l=Math.round(l),c=Math.round(c),u=Math.round(u),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(h,l,c,u)}this.renderer.framebuffer.clear(s.red,s.green,s.blue,s.alpha,e),a&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}};ns.extension={type:w.RendererSystem,name:"renderTexture"};T.add(ns);var _n=class{constructor(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}};function Sf(r,t){let e={},i=t.getProgramParameter(r,t.ACTIVE_ATTRIBUTES);for(let s=0;s<i;s++){let n=t.getActiveAttrib(r,s);if(n.name.startsWith("gl_"))continue;let o=on(t,n.type),a={type:o,name:n.name,size:nn(o),location:t.getAttribLocation(r,n.name)};e[n.name]=a}return e}function Af(r,t){let e={},i=t.getProgramParameter(r,t.ACTIVE_UNIFORMS);for(let s=0;s<i;s++){let n=t.getActiveUniform(r,s),o=n.name.replace(/\[.*?\]$/,""),a=!!n.name.match(/\[.*?\]$/),h=on(t,n.type);e[o]={name:o,index:s,type:h,size:n.size,isArray:a,value:sn(h,n.size)}}return e}function kl(r,t){let e=Go(r,r.VERTEX_SHADER,t.vertexSrc),i=Go(r,r.FRAGMENT_SHADER,t.fragmentSrc),s=r.createProgram();r.attachShader(s,e),r.attachShader(s,i);let n=t.extra?.transformFeedbackVaryings;if(n&&(typeof r.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):r.transformFeedbackVaryings(s,n.names,n.bufferMode==="separate"?r.SEPARATE_ATTRIBS:r.INTERLEAVED_ATTRIBS)),r.linkProgram(s),r.getProgramParameter(s,r.LINK_STATUS)||Pl(r,s,e,i),t.attributeData=Sf(s,r),t.uniformData=Af(s,r),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){let a=Object.keys(t.attributeData);a.sort((h,l)=>h>l?1:-1);for(let h=0;h<a.length;h++)t.attributeData[a[h]].location=h,r.bindAttribLocation(s,h,a[h]);r.linkProgram(s)}r.deleteShader(e),r.deleteShader(i);let o={};for(let a in t.uniformData){let h=t.uniformData[a];o[a]={location:r.getUniformLocation(s,a),value:sn(h.type,h.size)}}return new _n(s,o)}function A_(r,t,e,i,s){e.buffer.update(s)}var C_={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},Cf={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function If(r){let t=r.map(n=>({data:n,offset:0,dataLen:0,dirty:0})),e=0,i=0,s=0;for(let n=0;n<t.length;n++){let o=t[n];if(e=Cf[o.data.type],o.data.size>1&&(e=Math.max(e,16)*o.data.size),o.dataLen=e,i%e!==0&&i<16){let a=i%e%16;i+=a,s+=a}i+e>16?(s=Math.ceil(s/16)*16,o.offset=s,s+=e,i=e):(o.offset=s,i+=e,s+=e)}return s=Math.ceil(s/16)*16,{uboElements:t,size:s}}function Pf(r,t){let e=[];for(let i in r)t[i]&&e.push(t[i]);return e.sort((i,s)=>i.index-s.index),e}function Ol(r,t){if(!r.autoManage)return{size:0,syncFunc:A_};let e=Pf(r.uniforms,t),{uboElements:i,size:s}=If(e),n=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let o=0;o<i.length;o++){let a=i[o],h=r.uniforms[a.data.name],l=a.data.name,c=!1;for(let u=0;u<je.length;u++){let d=je[u];if(d.codeUbo&&d.test(a.data,h)){n.push(`offset = ${a.offset/4};`,je[u].codeUbo(a.data.name,h)),c=!0;break}}if(!c)if(a.data.size>1){let u=nn(a.data.type),d=Math.max(Cf[a.data.type]/16,1),p=u/d,f=(4-p%4)%4;n.push(`
                cv = ud.${l}.value;
                v = uv.${l};
                offset = ${a.offset/4};

                t = 0;

                for(var i=0; i < ${a.data.size*d}; i++)
                {
                    for(var j = 0; j < ${p}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${f};
                }

                `)}else{let u=C_[a.data.type];n.push(`
                cv = ud.${l}.value;
                v = uv.${l};
                offset = ${a.offset/4};
                ${u};
                `)}}return n.push(`
       renderer.buffer.update(buffer);
    `),{size:s,syncFunc:new Function("ud","uv","renderer","syncData","buffer",n.join(`
`))}}var I_=0,Zo={textureCount:0,uboCount:0},os=class{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=I_++}systemCheck(){if(!Wo())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;let i=t.program,s=i.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==i&&(this.program=i,this.gl.useProgram(s.program)),e||(Zo.textureCount=0,Zo.uboCount=0,this.syncUniformGroup(t.uniformGroup,Zo)),s}setUniforms(t){let e=this.shader.program,i=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(i.uniformData,t,this.renderer)}syncUniformGroup(t,e){let i=this.getGlProgram();(!t.static||t.dirtyId!==i.uniformDirtyGroups[t.id])&&(i.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,i,e))}syncUniforms(t,e,i){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,i)}createSyncGroups(t){let e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=Cl(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,e){let i=this.getGlProgram();if(!t.static||t.dirtyId!==0||!i.uniformGroups[t.id]){t.dirtyId=0;let s=i.uniformGroups[t.id]||this.createSyncBufferGroup(t,i,e);t.buffer.update(),s(i.uniformData,t.uniforms,this.renderer,Zo,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,i.uniformBufferBindings[e])}createSyncBufferGroup(t,e,i){let{gl:s}=this.renderer;this.renderer.buffer.bind(t.buffer);let n=this.gl.getUniformBlockIndex(e.program,i);e.uniformBufferBindings[i]=this.shader.uniformBindCount,s.uniformBlockBinding(e.program,n,this.shader.uniformBindCount),this.shader.uniformBindCount++;let o=this.getSignature(t,this.shader.program.uniformData,"ubo"),a=this._uboCache[o];if(a||(a=this._uboCache[o]=Ol(t,this.shader.program.uniformData)),t.autoManage){let h=new Float32Array(a.size/4);t.buffer.update(h)}return e.uniformGroups[t.id]=a.syncFunc,e.uniformGroups[t.id]}getSignature(t,e,i){let s=t.uniforms,n=[`${i}-`];for(let o in s)n.push(o),e[o]&&n.push(e[o].type);return n.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){let e=this.gl,i=t.program,s=kl(e,i);return i.glPrograms[this.renderer.CONTEXT_UID]=s,s}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}};os.extension={type:w.RendererSystem,name:"shader"};T.add(os);var ur=class{constructor(t){this.renderer=t}run(t){let{renderer:e}=this;e.runners.init.emit(e.options),t.hello&&console.log(`PixiJS 7.3.2 - ${e.rendererLogId} - https://pixijs.com`),e.resize(e.screen.width,e.screen.height)}destroy(){}};ur.defaultOptions={hello:!1},ur.extension={type:[w.RendererSystem,w.CanvasRendererSystem],name:"startup"};T.add(ur);function Rf(r,t=[]){return t[D.NORMAL]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[D.ADD]=[r.ONE,r.ONE],t[D.MULTIPLY]=[r.DST_COLOR,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA],t[D.SCREEN]=[r.ONE,r.ONE_MINUS_SRC_COLOR,r.ONE,r.ONE_MINUS_SRC_ALPHA],t[D.OVERLAY]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[D.DARKEN]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[D.LIGHTEN]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[D.COLOR_DODGE]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[D.COLOR_BURN]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[D.HARD_LIGHT]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[D.SOFT_LIGHT]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[D.DIFFERENCE]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[D.EXCLUSION]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[D.HUE]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[D.SATURATION]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[D.COLOR]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[D.LUMINOSITY]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[D.NONE]=[0,0],t[D.NORMAL_NPM]=[r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA],t[D.ADD_NPM]=[r.SRC_ALPHA,r.ONE,r.ONE,r.ONE],t[D.SCREEN_NPM]=[r.SRC_ALPHA,r.ONE_MINUS_SRC_COLOR,r.ONE,r.ONE_MINUS_SRC_ALPHA],t[D.SRC_IN]=[r.DST_ALPHA,r.ZERO],t[D.SRC_OUT]=[r.ONE_MINUS_DST_ALPHA,r.ZERO],t[D.SRC_ATOP]=[r.DST_ALPHA,r.ONE_MINUS_SRC_ALPHA],t[D.DST_OVER]=[r.ONE_MINUS_DST_ALPHA,r.ONE],t[D.DST_IN]=[r.ZERO,r.SRC_ALPHA],t[D.DST_OUT]=[r.ZERO,r.ONE_MINUS_SRC_ALPHA],t[D.DST_ATOP]=[r.ONE_MINUS_DST_ALPHA,r.SRC_ALPHA],t[D.XOR]=[r.ONE_MINUS_DST_ALPHA,r.ONE_MINUS_SRC_ALPHA],t[D.SUBTRACT]=[r.ONE,r.ONE,r.ONE,r.ONE,r.FUNC_REVERSE_SUBTRACT,r.FUNC_ADD],t}var P_=0,R_=1,M_=2,F_=3,B_=4,L_=5,Mf=class Nl{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=D.NONE,this._blendEq=!1,this.map=[],this.map[P_]=this.setBlend,this.map[R_]=this.setOffset,this.map[M_]=this.setCullFace,this.map[F_]=this.setDepthTest,this.map[B_]=this.setFrontFace,this.map[L_]=this.setDepthMask,this.checks=[],this.defaultState=new ve,this.defaultState.blend=!0}contextChange(t){this.gl=t,this.blendModes=Rf(t),this.set(this.defaultState),this.reset()}set(t){if(t=t||this.defaultState,this.stateId!==t.data){let e=this.stateId^t.data,i=0;for(;e;)e&1&&this.map[i].call(this,!!(t.data&1<<i)),e=e>>1,i++;this.stateId=t.data}for(let e=0;e<this.checks.length;e++)this.checks[e](this,t)}forceState(t){t=t||this.defaultState;for(let e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(let e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data}setBlend(t){this.updateCheck(Nl.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)}setOffset(t){this.updateCheck(Nl.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(t){this.gl.depthMask(t)}setCullFace(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])}setBlendMode(t){if(t===this.blendMode)return;this.blendMode=t;let e=this.blendModes[t],i=this.gl;e.length===2?i.blendFunc(e[0],e[1]):i.blendFuncSeparate(e[0],e[1],e[2],e[3]),e.length===6?(this._blendEq=!0,i.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD))}setPolygonOffset(t,e){this.gl.polygonOffset(t,e)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(t,e){let i=this.checks.indexOf(t);e&&i===-1?this.checks.push(t):!e&&i!==-1&&this.checks.splice(i,1)}static checkBlendMode(t,e){t.setBlendMode(e.blendMode)}static checkPolygonOffset(t,e){t.setPolygonOffset(1,e.polygonOffset)}destroy(){this.gl=null}};Mf.extension={type:w.RendererSystem,name:"state"};var Dl=Mf;T.add(Dl);var as=class extends Ve.default{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){this.addRunners(...t.runners);let e=(t.priority??[]).filter(s=>t.systems[s]),i=[...e,...Object.keys(t.systems).filter(s=>!e.includes(s))];for(let s of i)this.addSystem(t.systems[s],s)}addRunners(...t){t.forEach(e=>{this.runners[e]=new xt(e)})}addSystem(t,e){let i=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=i,this._systemsHash[e]=i;for(let s in this.runners)this.runners[s].add(i);return this}emitWithCustomOptions(t,e){let i=Object.keys(this._systemsHash);t.items.forEach(s=>{let n=i.find(o=>this._systemsHash[o]===s);s[t.name](e[n])})}destroy(){Object.values(this.runners).forEach(t=>{t.destroy()}),this._systemsHash={}}};var xn=class Qo{constructor(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=Qo.defaultMaxIdle,this.checkCountMax=Qo.defaultCheckCountMax,this.mode=Qo.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==lo.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){let t=this.renderer.texture,e=t.managedTextures,i=!1;for(let s=0;s<e.length;s++){let n=e[s];n.resource&&this.count-n.touched>this.maxIdle&&(t.destroyTexture(n,!0),e[s]=null,i=!0)}if(i){let s=0;for(let n=0;n<e.length;n++)e[n]!==null&&(e[s++]=e[n]);e.length=s}}unload(t){let e=this.renderer.texture,i=t._texture;i&&!i.framebuffer&&e.destroyTexture(i);for(let s=t.children.length-1;s>=0;s--)this.unload(t.children[s])}destroy(){this.renderer=null}};xn.defaultMode=lo.AUTO,xn.defaultMaxIdle=60*60,xn.defaultCheckCountMax=60*10,xn.extension={type:w.RendererSystem,name:"textureGC"};var ze=xn;T.add(ze);var si=class{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=W.UNSIGNED_BYTE,this.internalFormat=I.RGBA,this.samplerType=0}};function Ff(r){let t;return"WebGL2RenderingContext"in globalThis&&r instanceof globalThis.WebGL2RenderingContext?t={[r.RGB]:P.FLOAT,[r.RGBA]:P.FLOAT,[r.ALPHA]:P.FLOAT,[r.LUMINANCE]:P.FLOAT,[r.LUMINANCE_ALPHA]:P.FLOAT,[r.R8]:P.FLOAT,[r.R8_SNORM]:P.FLOAT,[r.RG8]:P.FLOAT,[r.RG8_SNORM]:P.FLOAT,[r.RGB8]:P.FLOAT,[r.RGB8_SNORM]:P.FLOAT,[r.RGB565]:P.FLOAT,[r.RGBA4]:P.FLOAT,[r.RGB5_A1]:P.FLOAT,[r.RGBA8]:P.FLOAT,[r.RGBA8_SNORM]:P.FLOAT,[r.RGB10_A2]:P.FLOAT,[r.RGB10_A2UI]:P.FLOAT,[r.SRGB8]:P.FLOAT,[r.SRGB8_ALPHA8]:P.FLOAT,[r.R16F]:P.FLOAT,[r.RG16F]:P.FLOAT,[r.RGB16F]:P.FLOAT,[r.RGBA16F]:P.FLOAT,[r.R32F]:P.FLOAT,[r.RG32F]:P.FLOAT,[r.RGB32F]:P.FLOAT,[r.RGBA32F]:P.FLOAT,[r.R11F_G11F_B10F]:P.FLOAT,[r.RGB9_E5]:P.FLOAT,[r.R8I]:P.INT,[r.R8UI]:P.UINT,[r.R16I]:P.INT,[r.R16UI]:P.UINT,[r.R32I]:P.INT,[r.R32UI]:P.UINT,[r.RG8I]:P.INT,[r.RG8UI]:P.UINT,[r.RG16I]:P.INT,[r.RG16UI]:P.UINT,[r.RG32I]:P.INT,[r.RG32UI]:P.UINT,[r.RGB8I]:P.INT,[r.RGB8UI]:P.UINT,[r.RGB16I]:P.INT,[r.RGB16UI]:P.UINT,[r.RGB32I]:P.INT,[r.RGB32UI]:P.UINT,[r.RGBA8I]:P.INT,[r.RGBA8UI]:P.UINT,[r.RGBA16I]:P.INT,[r.RGBA16UI]:P.UINT,[r.RGBA32I]:P.INT,[r.RGBA32UI]:P.UINT,[r.DEPTH_COMPONENT16]:P.FLOAT,[r.DEPTH_COMPONENT24]:P.FLOAT,[r.DEPTH_COMPONENT32F]:P.FLOAT,[r.DEPTH_STENCIL]:P.FLOAT,[r.DEPTH24_STENCIL8]:P.FLOAT,[r.DEPTH32F_STENCIL8]:P.FLOAT}:t={[r.RGB]:P.FLOAT,[r.RGBA]:P.FLOAT,[r.ALPHA]:P.FLOAT,[r.LUMINANCE]:P.FLOAT,[r.LUMINANCE_ALPHA]:P.FLOAT,[r.DEPTH_STENCIL]:P.FLOAT},t}function Bf(r){let t;return"WebGL2RenderingContext"in globalThis&&r instanceof globalThis.WebGL2RenderingContext?t={[W.UNSIGNED_BYTE]:{[I.RGBA]:r.RGBA8,[I.RGB]:r.RGB8,[I.RG]:r.RG8,[I.RED]:r.R8,[I.RGBA_INTEGER]:r.RGBA8UI,[I.RGB_INTEGER]:r.RGB8UI,[I.RG_INTEGER]:r.RG8UI,[I.RED_INTEGER]:r.R8UI,[I.ALPHA]:r.ALPHA,[I.LUMINANCE]:r.LUMINANCE,[I.LUMINANCE_ALPHA]:r.LUMINANCE_ALPHA},[W.BYTE]:{[I.RGBA]:r.RGBA8_SNORM,[I.RGB]:r.RGB8_SNORM,[I.RG]:r.RG8_SNORM,[I.RED]:r.R8_SNORM,[I.RGBA_INTEGER]:r.RGBA8I,[I.RGB_INTEGER]:r.RGB8I,[I.RG_INTEGER]:r.RG8I,[I.RED_INTEGER]:r.R8I},[W.UNSIGNED_SHORT]:{[I.RGBA_INTEGER]:r.RGBA16UI,[I.RGB_INTEGER]:r.RGB16UI,[I.RG_INTEGER]:r.RG16UI,[I.RED_INTEGER]:r.R16UI,[I.DEPTH_COMPONENT]:r.DEPTH_COMPONENT16},[W.SHORT]:{[I.RGBA_INTEGER]:r.RGBA16I,[I.RGB_INTEGER]:r.RGB16I,[I.RG_INTEGER]:r.RG16I,[I.RED_INTEGER]:r.R16I},[W.UNSIGNED_INT]:{[I.RGBA_INTEGER]:r.RGBA32UI,[I.RGB_INTEGER]:r.RGB32UI,[I.RG_INTEGER]:r.RG32UI,[I.RED_INTEGER]:r.R32UI,[I.DEPTH_COMPONENT]:r.DEPTH_COMPONENT24},[W.INT]:{[I.RGBA_INTEGER]:r.RGBA32I,[I.RGB_INTEGER]:r.RGB32I,[I.RG_INTEGER]:r.RG32I,[I.RED_INTEGER]:r.R32I},[W.FLOAT]:{[I.RGBA]:r.RGBA32F,[I.RGB]:r.RGB32F,[I.RG]:r.RG32F,[I.RED]:r.R32F,[I.DEPTH_COMPONENT]:r.DEPTH_COMPONENT32F},[W.HALF_FLOAT]:{[I.RGBA]:r.RGBA16F,[I.RGB]:r.RGB16F,[I.RG]:r.RG16F,[I.RED]:r.R16F},[W.UNSIGNED_SHORT_5_6_5]:{[I.RGB]:r.RGB565},[W.UNSIGNED_SHORT_4_4_4_4]:{[I.RGBA]:r.RGBA4},[W.UNSIGNED_SHORT_5_5_5_1]:{[I.RGBA]:r.RGB5_A1},[W.UNSIGNED_INT_2_10_10_10_REV]:{[I.RGBA]:r.RGB10_A2,[I.RGBA_INTEGER]:r.RGB10_A2UI},[W.UNSIGNED_INT_10F_11F_11F_REV]:{[I.RGB]:r.R11F_G11F_B10F},[W.UNSIGNED_INT_5_9_9_9_REV]:{[I.RGB]:r.RGB9_E5},[W.UNSIGNED_INT_24_8]:{[I.DEPTH_STENCIL]:r.DEPTH24_STENCIL8},[W.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[I.DEPTH_STENCIL]:r.DEPTH32F_STENCIL8}}:t={[W.UNSIGNED_BYTE]:{[I.RGBA]:r.RGBA,[I.RGB]:r.RGB,[I.ALPHA]:r.ALPHA,[I.LUMINANCE]:r.LUMINANCE,[I.LUMINANCE_ALPHA]:r.LUMINANCE_ALPHA},[W.UNSIGNED_SHORT_5_6_5]:{[I.RGB]:r.RGB},[W.UNSIGNED_SHORT_4_4_4_4]:{[I.RGBA]:r.RGBA},[W.UNSIGNED_SHORT_5_5_5_1]:{[I.RGBA]:r.RGBA}},t}var hs=class{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new j,this.hasIntegerTextures=!1}contextChange(){let t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=Bf(t),this.samplerTypes=Ff(t);let e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(let s=0;s<e;s++)this.boundTextures[s]=null;this.emptyTextures={};let i=new si(t.createTexture());t.bindTexture(t.TEXTURE_2D,i.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=i,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new si(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let s=0;s<6;s++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let s=0;s<this.boundTextures.length;s++)this.bind(null,s)}bind(t,e=0){let{gl:i}=this;if(t=t?.castToBaseTexture(),t?.valid&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;let s=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(t.target,s.texture)),s.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),this.updateTexture(t)):s.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(i.TEXTURE_2D,this.emptyTextures[i.TEXTURE_2D].texture),this.boundTextures[e]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){let{gl:e,boundTextures:i}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let s=0;s<i.length;s++)i[s]===this.unknownTexture&&this.bind(null,s)}for(let s=0;s<i.length;s++)i[s]===t&&(this.currentLocation!==s&&(e.activeTexture(e.TEXTURE0+s),this.currentLocation=s),e.bindTexture(t.target,this.emptyTextures[t.target].texture),i[s]=null)}ensureSamplerType(t){let{boundTextures:e,hasIntegerTextures:i,CONTEXT_UID:s}=this;if(i)for(let n=t-1;n>=0;--n){let o=e[n];o&&o._glTextures[s].samplerType!==P.FLOAT&&this.renderer.texture.unbind(o)}}initTexture(t){let e=new si(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e}initTextureType(t,e){e.internalFormat=this.internalFormats[t.type]?.[t.format]??t.format,e.samplerType=this.samplerTypes[e.internalFormat]??P.FLOAT,this.webGLVersion===2&&t.type===W.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type}updateTexture(t){let e=t._glTextures[this.CONTEXT_UID];if(!e)return;let i=this.renderer;if(this.initTextureType(t,e),t.resource?.upload(i,t,e))e.samplerType!==P.FLOAT&&(this.hasIntegerTextures=!0);else{let s=t.realWidth,n=t.realHeight,o=i.gl;(e.width!==s||e.height!==n||e.dirtyId<0)&&(e.width=s,e.height=n,o.texImage2D(t.target,0,e.internalFormat,s,n,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}destroyTexture(t,e){let{gl:i}=this;if(t=t.castToBaseTexture(),t._glTextures[this.CONTEXT_UID]&&(this.unbind(t),i.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){let s=this.managedTextures.indexOf(t);s!==-1&&Bo(this.managedTextures,s,1)}}updateTextureStyle(t){let e=t._glTextures[this.CONTEXT_UID];e&&((t.mipmap===Pe.POW2||this.webGLVersion!==2)&&!t.isPowerOfTwo?e.mipmap=!1:e.mipmap=t.mipmap>=1,this.webGLVersion!==2&&!t.isPowerOfTwo?e.wrapMode=br.CLAMP:e.wrapMode=t.wrapMode,t.resource?.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)}setStyle(t,e){let i=this.gl;if(e.mipmap&&t.mipmap!==Pe.ON_MANUAL&&i.generateMipmap(t.target),i.texParameteri(t.target,i.TEXTURE_WRAP_S,e.wrapMode),i.texParameteri(t.target,i.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===ne.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST);let s=this.renderer.context.extensions.anisotropicFiltering;if(s&&t.anisotropicLevel>0&&t.scaleMode===ne.LINEAR){let n=Math.min(t.anisotropicLevel,i.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY_EXT));i.texParameterf(t.target,s.TEXTURE_MAX_ANISOTROPY_EXT,n)}}else i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===ne.LINEAR?i.LINEAR:i.NEAREST);i.texParameteri(t.target,i.TEXTURE_MAG_FILTER,t.scaleMode===ne.LINEAR?i.LINEAR:i.NEAREST)}destroy(){this.renderer=null}};hs.extension={type:w.RendererSystem,name:"texture"};T.add(hs);var ls=class{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){let{gl:e,CONTEXT_UID:i}=this,s=t._glTransformFeedbacks[i]||this.createGLTransformFeedback(t);e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,s)}unbind(){let{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,e){let{gl:i,renderer:s}=this;e&&s.shader.bind(e),i.beginTransformFeedback(t)}endTransformFeedback(){let{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){let{gl:e,renderer:i,CONTEXT_UID:s}=this,n=e.createTransformFeedback();t._glTransformFeedbacks[s]=n,e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,n);for(let o=0;o<t.buffers.length;o++){let a=t.buffers[o];a&&(i.buffer.update(a),a._glBuffers[s].refCount++,e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,o,a._glBuffers[s].buffer||null))}return e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),n}disposeTransformFeedback(t,e){let i=t._glTransformFeedbacks[this.CONTEXT_UID],s=this.gl;t.disposeRunner.remove(this);let n=this.renderer.buffer;if(n)for(let o=0;o<t.buffers.length;o++){let a=t.buffers[o];if(!a)continue;let h=a._glBuffers[this.CONTEXT_UID];h&&(h.refCount--,h.refCount===0&&!e&&n.dispose(a,e))}i&&(e||s.deleteTransformFeedback(i),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}};ls.extension={type:w.RendererSystem,name:"transformFeedback"};T.add(ls);var dr=class{constructor(t){this.renderer=t}init(t){this.screen=new H(0,0,t.width,t.height),this.element=t.view||S.ADAPTER.createCanvas(),this.resolution=t.resolution||S.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,e){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(e*this.resolution);let i=this.element.width/this.resolution,s=this.element.height/this.resolution;this.screen.width=i,this.screen.height=s,this.autoDensity&&(this.element.style.width=`${i}px`,this.element.style.height=`${s}px`),this.renderer.emit("resize",i,s),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){t&&this.element.parentNode?.removeChild(this.element),this.renderer=null,this.element=null,this.screen=null}};dr.defaultOptions={width:800,height:600,resolution:void 0,autoDensity:!1},dr.extension={type:[w.RendererSystem,w.CanvasRendererSystem],name:"_view"};T.add(dr);S.PREFER_ENV=fe.WEBGL2;S.STRICT_TEXTURE_CACHE=!1;S.RENDER_OPTIONS={...cr.defaultOptions,...lr.defaultOptions,...dr.defaultOptions,...ur.defaultOptions};Object.defineProperties(S,{WRAP_MODE:{get(){return j.defaultOptions.wrapMode},set(r){V("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),j.defaultOptions.wrapMode=r}},SCALE_MODE:{get(){return j.defaultOptions.scaleMode},set(r){V("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),j.defaultOptions.scaleMode=r}},MIPMAP_TEXTURES:{get(){return j.defaultOptions.mipmap},set(r){V("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),j.defaultOptions.mipmap=r}},ANISOTROPIC_LEVEL:{get(){return j.defaultOptions.anisotropicLevel},set(r){V("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),j.defaultOptions.anisotropicLevel=r}},FILTER_RESOLUTION:{get(){return V("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),$e.defaultResolution},set(r){$e.defaultResolution=r}},FILTER_MULTISAMPLE:{get(){return V("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),$e.defaultMultisample},set(r){$e.defaultMultisample=r}},SPRITE_MAX_TEXTURES:{get(){return hr.defaultMaxTextures},set(r){V("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),hr.defaultMaxTextures=r}},SPRITE_BATCH_SIZE:{get(){return hr.defaultBatchSize},set(r){V("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),hr.defaultBatchSize=r}},CAN_UPLOAD_SAME_BUFFER:{get(){return hr.canUploadSameBuffer},set(r){V("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),hr.canUploadSameBuffer=r}},GC_MODE:{get(){return ze.defaultMode},set(r){V("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),ze.defaultMode=r}},GC_MAX_IDLE:{get(){return ze.defaultMaxIdle},set(r){V("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),ze.defaultMaxIdle=r}},GC_MAX_CHECK_COUNT:{get(){return ze.defaultCheckCountMax},set(r){V("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),ze.defaultCheckCountMax=r}},PRECISION_VERTEX:{get(){return we.defaultVertexPrecision},set(r){V("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),we.defaultVertexPrecision=r}},PRECISION_FRAGMENT:{get(){return we.defaultFragmentPrecision},set(r){V("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),we.defaultFragmentPrecision=r}}});var Le=(r=>(r[r.INTERACTION=50]="INTERACTION",r[r.HIGH=25]="HIGH",r[r.NORMAL=0]="NORMAL",r[r.LOW=-25]="LOW",r[r.UTILITY=-50]="UTILITY",r))(Le||{});var cs=class{constructor(t,e=null,i=0,s=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=i,this.once=s}match(t,e=null){return this.fn===t&&this.context===e}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));let e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);let e=this.next;return this.next=t?null:e,this.previous=null,e}};var Lf=class ge{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new cs(null,null,1/0),this.deltaMS=1/ge.targetFPMS,this.elapsedMS=1/ge.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,i=Le.NORMAL){return this._addListener(new cs(t,e,i))}addOnce(t,e,i=Le.NORMAL){return this._addListener(new cs(t,e,i,!0))}_addListener(t){let e=this._head.next,i=this._head;if(!e)t.connect(i);else{for(;e;){if(t.priority>e.priority){t.connect(i);break}i=e,e=e.next}t.previous||t.connect(i)}return this._startIfPossible(),this}remove(t,e){let i=this._head.next;for(;i;)i.match(t,e)?i=i.destroy():i=i.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){let n=t-this._lastFrame|0;if(n<this._minElapsedMS)return;this._lastFrame=t-n%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*ge.targetFPMS;let i=this._head,s=i.next;for(;s;)s=s.emit(this.deltaTime);i.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){let e=Math.min(this.maxFPS,t),i=Math.min(Math.max(0,e)/1e3,ge.targetFPMS);this._maxElapsedMS=1/i}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(t===0)this._minElapsedMS=0;else{let e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!ge._shared){let t=ge._shared=new ge;t.autoStart=!0,t._protected=!0}return ge._shared}static get system(){if(!ge._system){let t=ge._system=new ge;t.autoStart=!0,t._protected=!0}return ge._system}};Lf.targetFPMS=.06;var lt=Lf;Object.defineProperties(S,{TARGET_FPMS:{get(){return lt.targetFPMS},set(r){V("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),lt.targetFPMS=r}}});var vn=class{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,Le.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?lt.shared:new lt,t.autoStart&&this.start()}static destroy(){if(this._ticker){let t=this._ticker;this.ticker=null,t.destroy()}}};vn.extension=w.Application;T.add(vn);var kf=[];T.handleByList(w.Renderer,kf);function Ul(r){for(let t of kf)if(t.test(r))return new t(r);throw new Error("Unable to auto-detect a suitable renderer.")}var wn=class{constructor(t){this.renderer=t}contextChange(t){let e;if(this.renderer.context.webGLVersion===1){let i=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,i)}else{let i=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,i)}e>=ot.HIGH?this.multisample=ot.HIGH:e>=ot.MEDIUM?this.multisample=ot.MEDIUM:e>=ot.LOW?this.multisample=ot.LOW:this.multisample=ot.NONE}destroy(){}};wn.extension={type:w.RendererSystem,name:"_multisample"};T.add(wn);var Jo=class{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}};var Tn=class{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){let{gl:e,CONTEXT_UID:i}=this,s=t._glBuffers[i]||this.createGLBuffer(t);e.bindBuffer(t.type,s.buffer)}unbind(t){let{gl:e}=this;e.bindBuffer(t,null)}bindBufferBase(t,e){let{gl:i,CONTEXT_UID:s}=this;if(this.boundBufferBases[e]!==t){let n=t._glBuffers[s]||this.createGLBuffer(t);this.boundBufferBases[e]=t,i.bindBufferBase(i.UNIFORM_BUFFER,e,n.buffer)}}bindBufferRange(t,e,i){let{gl:s,CONTEXT_UID:n}=this;i=i||0;let o=t._glBuffers[n]||this.createGLBuffer(t);s.bindBufferRange(s.UNIFORM_BUFFER,e||0,o.buffer,i*256,256)}update(t){let{gl:e,CONTEXT_UID:i}=this,s=t._glBuffers[i]||this.createGLBuffer(t);if(t._updateID!==s.updateID)if(s.updateID=t._updateID,e.bindBuffer(t.type,s.buffer),s.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{let n=t.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;s.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,n)}}dispose(t,e){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];let i=t._glBuffers[this.CONTEXT_UID],s=this.gl;t.disposeRunner.remove(this),i&&(e||s.deleteBuffer(i.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){let e=Object.keys(this.managedBuffers);for(let i=0;i<e.length;i++)this.dispose(this.managedBuffers[e[i]],t)}createGLBuffer(t){let{CONTEXT_UID:e,gl:i}=this;return t._glBuffers[e]=new Jo(i.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e]}};Tn.extension={type:w.RendererSystem,name:"buffer"};T.add(Tn);var En=class{constructor(t){this.renderer=t}render(t,e){let i=this.renderer,s,n,o,a;if(e&&(s=e.renderTexture,n=e.clear,o=e.transform,a=e.skipUpdateTransform),this.renderingToScreen=!s,i.runners.prerender.emit(),i.emit("prerender"),i.projection.transform=o,!i.context.isLost){if(s||(this.lastObjectRendered=t),!a){let h=t.enableTempParent();t.updateTransform(),t.disableTempParent(h)}i.renderTexture.bind(s),i.batch.currentRenderer.start(),(n??i.background.clearBeforeRender)&&i.renderTexture.clear(),t.render(i),i.batch.currentRenderer.flush(),s&&(e.blit&&i.framebuffer.blit(),s.baseTexture.update()),i.runners.postrender.emit(),i.projection.transform=null,i.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}};En.extension={type:w.RendererSystem,name:"objectRenderer"};T.add(En);var ta=class Gl extends as{constructor(t){super(),this.type=xh.WEBGL,t=Object.assign({},S.RENDER_OPTIONS,t),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new ee({projectionMatrix:new tt},!0);let e={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:Gl.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(e),"useContextAlpha"in t&&(V("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),t.premultipliedAlpha=t.useContextAlpha&&t.useContextAlpha!=="notMultiplied",t.backgroundAlpha=t.useContextAlpha===!1?1:t.backgroundAlpha),this._plugin.rendererPlugins=Gl.__plugins,this.options=t,this.startup.run(this.options)}static test(t){return t?.forceCanvas?!1:Po()}render(t,e){this.objectRenderer.render(t,e)}resize(t,e){this._view.resizeView(t,e)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(t=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:t}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(t){this._view.resolution=t,this.runners.resolutionChange.emit(t)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return V("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return V("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return V("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return V("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(t){V("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=t}get backgroundAlpha(){return V("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(t){V("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=t}get powerPreference(){return V("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(t,e){return this.textureGenerator.generateTexture(t,e)}};ta.extension={type:w.Renderer,priority:1},ta.__plugins={},ta.__systems={};var ea=ta;T.handleByMap(w.RendererPlugin,ea.__plugins);T.handleByMap(w.RendererSystem,ea.__systems);T.add(ea);var Mr=class extends me{constructor(t,e){let{width:i,height:s}=e||{};super(i,s),this.items=[],this.itemDirtyIds=[];for(let n=0;n<t;n++){let o=new j;this.items.push(o),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,e){for(let i=0;i<this.length;i++)t[i]&&(t[i].castToBaseTexture?this.addBaseTextureAt(t[i].castToBaseTexture(),i):t[i]instanceof me?this.addResourceAt(t[i],i):this.addResourceAt(Gi(t[i],e),i))}dispose(){for(let t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,e){if(!this.items[e])throw new Error(`Index ${e} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this}bind(t){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=t,this.items[e].on("update",t.update,t)}unbind(t){super.unbind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=null,this.items[e].off("update",t.update,t)}load(){if(this._load)return this._load;let t=this.items.map(e=>e.resource).filter(e=>e).map(e=>e.load());return this._load=Promise.all(t).then(()=>{let{realWidth:e,realHeight:i}=this.items[0];return this.resize(e,i),this.update(),Promise.resolve(this)}),this._load}};var Sn=class extends Mr{constructor(t,e){let{width:i,height:s}=e||{},n,o;Array.isArray(t)?(n=t,o=t.length):o=t,super(o,{width:i,height:s}),n&&this.initFromArray(n,e)}addBaseTextureAt(t,e){if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(t){super.bind(t),t.target=rr.TEXTURE_2D_ARRAY}upload(t,e,i){let{length:s,itemDirtyIds:n,items:o}=this,{gl:a}=t;i.dirtyId<0&&a.texImage3D(a.TEXTURE_2D_ARRAY,0,i.internalFormat,this._width,this._height,s,0,e.format,i.type,null);for(let h=0;h<s;h++){let l=o[h];n[h]<l.dirtyId&&(n[h]=l.dirtyId,l.valid&&a.texSubImage3D(a.TEXTURE_2D_ARRAY,0,0,0,h,l.resource.width,l.resource.height,1,e.format,i.type,l.resource.source))}return!0}};var An=class extends Ot{constructor(t){super(t)}static test(t){let{OffscreenCanvas:e}=globalThis;return e&&t instanceof e?!0:globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}};var Of=class Cn extends Mr{constructor(t,e){let{width:i,height:s,autoLoad:n,linkBaseTexture:o}=e||{};if(t&&t.length!==Cn.SIDES)throw new Error(`Invalid length. Got ${t.length}, expected 6`);super(6,{width:i,height:s});for(let a=0;a<Cn.SIDES;a++)this.items[a].target=rr.TEXTURE_CUBE_MAP_POSITIVE_X+a;this.linkBaseTexture=o!==!1,t&&this.initFromArray(t,e),n!==!1&&this.load()}bind(t){super.bind(t),t.target=rr.TEXTURE_CUBE_MAP}addBaseTextureAt(t,e,i){if(i===void 0&&(i=this.linkBaseTexture),!this.items[e])throw new Error(`Index ${e} is out of bounds`);if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0)if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("CubeResource does not support copying of renderTexture.");else t.target=rr.TEXTURE_CUBE_MAP_POSITIVE_X+e,t.parentTextureArray=this.baseTexture,this.items[e]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[e]=t,this}upload(t,e,i){let s=this.itemDirtyIds;for(let n=0;n<Cn.SIDES;n++){let o=this.items[n];(s[n]<o.dirtyId||i.dirtyId<e.dirtyId)&&(o.valid&&o.resource?(o.resource.upload(t,o,i),s[n]=o.dirtyId):s[n]<-1&&(t.gl.texImage2D(o.target,0,i.internalFormat,e.realWidth,e.realHeight,0,e.format,i.type,null),s[n]=-1))}return!0}static test(t){return Array.isArray(t)&&t.length===Cn.SIDES}};Of.SIDES=6;var Hl=Of;var In=class r extends Ot{constructor(t,e){e=e||{};let i,s,n;typeof t=="string"?(i=r.EMPTY,s=t,n=!0):(i=t,s=null,n=!1),super(i),this.url=s,this.crossOrigin=e.crossOrigin??!0,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this.ownsImageBitmap=e.ownsImageBitmap??n,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(t,e)=>{if(this.url===null){t(this);return}try{let i=await S.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;let s=await i.blob();if(this.destroyed)return;let n=await createImageBitmap(s,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===kt.UNPACK?"premultiply":"none"});if(this.destroyed){n.close();return}this.source=n,this.update(),t(this)}catch(i){if(this.destroyed)return;e(i),this.onError.emit(i)}}),this._load)}upload(t,e,i){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),super.upload(t,e,i)):(this.load(),!1)}dispose(){this.ownsImageBitmap&&this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof t=="string"||t instanceof ImageBitmap)}static get EMPTY(){return r._EMPTY=r._EMPTY??S.ADAPTER.createCanvas(0,0),r._EMPTY}};var Vl=class ra extends Ot{constructor(t,e){e=e||{},super(S.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=t,this.scale=e.scale||1,this._overrideWidth=e.width,this._overrideHeight=e.height,this._resolve=null,this._crossorigin=e.crossorigin,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(t=>{if(this._resolve=()=>{this.update(),t(this)},ra.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){let t=new Image;Ot.crossOrigin(t,this.svg,this._crossorigin),t.src=this.svg,t.onerror=e=>{this._resolve&&(t.onerror=null,this.onError.emit(e))},t.onload=()=>{if(!this._resolve)return;let e=t.width,i=t.height;if(!e||!i)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let s=e*this.scale,n=i*this.scale;(this._overrideWidth||this._overrideHeight)&&(s=this._overrideWidth||this._overrideHeight/i*e,n=this._overrideHeight||this._overrideWidth/e*i),s=Math.round(s),n=Math.round(n);let o=this.source;o.width=s,o.height=n,o._pixiId=`canvas_${He()}`,o.getContext("2d").drawImage(t,0,0,e,i,0,0,s,n),this._resolve(),this._resolve=null}}static getSize(t){let e=ra.SVG_SIZE.exec(t),i={};return e&&(i[e[1]]=Math.round(parseFloat(e[3])),i[e[5]]=Math.round(parseFloat(e[7]))),i}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(t,e){return e==="svg"||typeof t=="string"&&t.startsWith("data:image/svg+xml")||typeof t=="string"&&ra.SVG_XML.test(t)}};Vl.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,Vl.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;var us=Vl;var jl=class $l extends Ot{constructor(t,e){if(e=e||{},!(t instanceof HTMLVideoElement)){let i=document.createElement("video");e.autoLoad!==!1&&i.setAttribute("preload","auto"),e.playsinline!==!1&&(i.setAttribute("webkit-playsinline",""),i.setAttribute("playsinline","")),e.muted===!0&&(i.setAttribute("muted",""),i.muted=!0),e.loop===!0&&i.setAttribute("loop",""),e.autoPlay!==!1&&i.setAttribute("autoplay",""),typeof t=="string"&&(t=[t]);let s=t[0].src||t[0];Ot.crossOrigin(i,s,e.crossorigin);for(let n=0;n<t.length;++n){let o=document.createElement("source"),{src:a,mime:h}=t[n];if(a=a||t[n],a.startsWith("data:"))h=a.slice(5,a.indexOf(";"));else if(!a.startsWith("blob:")){let l=a.split("?").shift().toLowerCase(),c=l.slice(l.lastIndexOf(".")+1);h=h||$l.MIME_TYPES[c]||`video/${c}`}o.src=a,h&&(o.type=h),i.appendChild(o)}t=i}super(t),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=e.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=e.autoPlay!==!1,this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),e.autoLoad!==!1&&this.load()}update(t=0){if(!this.destroyed){if(this._updateFPS){let e=lt.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-e)}(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}_videoFrameRequestCallback(){this.update(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback)}load(){if(this._load)return this._load;let t=this.source;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart),t.addEventListener("pause",this._onPlayStop),t.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._onCanPlay():(t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("error",this._onError,!0)),this._load=new Promise((e,i)=>{this.valid?e(this):(this._resolve=e,this._reject=i,t.load())}),this._load}_onError(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t),this._reject&&(this._reject(t),this._reject=null,this._resolve=null)}_isSourcePlaying(){let t=this.source;return!t.paused&&!t.ended}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0)}_onCanPlay(){let t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);let e=this.valid;this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0,!e&&this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()}dispose(){this._configureAutoUpdate();let t=this.source;t&&(t.removeEventListener("play",this._onPlayStart),t.removeEventListener("pause",this._onPlayStop),t.removeEventListener("seeked",this._onSeeked),t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay),t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.source.requestVideoFrameCallback?(this._isConnectedToTicker&&(lt.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(lt.shared.add(this.update,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(lt.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(t,e){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement||$l.TYPES.includes(e)}};jl.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],jl.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};var Pn=jl;rn.push(In,ti,An,Pn,us,Wr,Hl,Sn);var We=class{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?H.EMPTY:(t=t||new H(0,0,1,1),t.x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,e){let{a:i,b:s,c:n,d:o,tx:a,ty:h}=t,l=i*e.x+n*e.y+a,c=s*e.x+o*e.y+h;this.minX=Math.min(this.minX,l),this.maxX=Math.max(this.maxX,l),this.minY=Math.min(this.minY,c),this.maxY=Math.max(this.maxY,c)}addQuad(t){let e=this.minX,i=this.minY,s=this.maxX,n=this.maxY,o=t[0],a=t[1];e=o<e?o:e,i=a<i?a:i,s=o>s?o:s,n=a>n?a:n,o=t[2],a=t[3],e=o<e?o:e,i=a<i?a:i,s=o>s?o:s,n=a>n?a:n,o=t[4],a=t[5],e=o<e?o:e,i=a<i?a:i,s=o>s?o:s,n=a>n?a:n,o=t[6],a=t[7],e=o<e?o:e,i=a<i?a:i,s=o>s?o:s,n=a>n?a:n,this.minX=e,this.minY=i,this.maxX=s,this.maxY=n}addFrame(t,e,i,s,n){this.addFrameMatrix(t.worldTransform,e,i,s,n)}addFrameMatrix(t,e,i,s,n){let o=t.a,a=t.b,h=t.c,l=t.d,c=t.tx,u=t.ty,d=this.minX,p=this.minY,f=this.maxX,m=this.maxY,b=o*e+h*i+c,y=a*e+l*i+u;d=b<d?b:d,p=y<p?y:p,f=b>f?b:f,m=y>m?y:m,b=o*s+h*i+c,y=a*s+l*i+u,d=b<d?b:d,p=y<p?y:p,f=b>f?b:f,m=y>m?y:m,b=o*e+h*n+c,y=a*e+l*n+u,d=b<d?b:d,p=y<p?y:p,f=b>f?b:f,m=y>m?y:m,b=o*s+h*n+c,y=a*s+l*n+u,d=b<d?b:d,p=y<p?y:p,f=b>f?b:f,m=y>m?y:m,this.minX=d,this.minY=p,this.maxX=f,this.maxY=m}addVertexData(t,e,i){let s=this.minX,n=this.minY,o=this.maxX,a=this.maxY;for(let h=e;h<i;h+=2){let l=t[h],c=t[h+1];s=l<s?l:s,n=c<n?c:n,o=l>o?l:o,a=c>a?c:a}this.minX=s,this.minY=n,this.maxX=o,this.maxY=a}addVertices(t,e,i,s){this.addVerticesMatrix(t.worldTransform,e,i,s)}addVerticesMatrix(t,e,i,s,n=0,o=n){let a=t.a,h=t.b,l=t.c,c=t.d,u=t.tx,d=t.ty,p=this.minX,f=this.minY,m=this.maxX,b=this.maxY;for(let y=i;y<s;y+=2){let v=e[y],g=e[y+1],_=a*v+l*g+u,L=c*g+h*v+d;p=Math.min(p,_-n),m=Math.max(m,_+n),f=Math.min(f,L-o),b=Math.max(b,L+o)}this.minX=p,this.minY=f,this.maxX=m,this.maxY=b}addBounds(t){let e=this.minX,i=this.minY,s=this.maxX,n=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<i?t.minY:i,this.maxX=t.maxX>s?t.maxX:s,this.maxY=t.maxY>n?t.maxY:n}addBoundsMask(t,e){let i=t.minX>e.minX?t.minX:e.minX,s=t.minY>e.minY?t.minY:e.minY,n=t.maxX<e.maxX?t.maxX:e.maxX,o=t.maxY<e.maxY?t.maxY:e.maxY;if(i<=n&&s<=o){let a=this.minX,h=this.minY,l=this.maxX,c=this.maxY;this.minX=i<a?i:a,this.minY=s<h?s:h,this.maxX=n>l?n:l,this.maxY=o>c?o:c}}addBoundsMatrix(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,e){let i=t.minX>e.x?t.minX:e.x,s=t.minY>e.y?t.minY:e.y,n=t.maxX<e.x+e.width?t.maxX:e.x+e.width,o=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(i<=n&&s<=o){let a=this.minX,h=this.minY,l=this.maxX,c=this.maxY;this.minX=i<a?i:a,this.minY=s<h?s:h,this.maxX=n>l?n:l,this.maxY=o>c?o:c}}pad(t=0,e=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)}addFramePad(t,e,i,s,n,o){t-=n,e-=o,i+=n,s+=o,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>i?this.maxX:i,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>s?this.maxY:s}};var Xe=class r extends M.EventEmitter{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new Wi,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new We,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){let e=Object.keys(t);for(let i=0;i<e.length;++i){let s=e[i];Object.defineProperty(r.prototype,s,Object.getOwnPropertyDescriptor(t,s))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new H),e=this._boundsRect),this._bounds.getRectangle(e)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new H),t=this._localBoundsRect),this._localBounds||(this._localBounds=new We);let e=this.transform,i=this.parent;this.parent=null,this._tempDisplayObjectParent.worldAlpha=i?.worldAlpha??1,this.transform=this._tempDisplayObjectParent.transform;let s=this._bounds,n=this._boundsID;this._bounds=this._localBounds;let o=this.getBounds(!1,t);return this.parent=i,this.transform=e,this._bounds=s,this._bounds.updateID+=this._boundsID-n,o}toGlobal(t,e,i=!1){return i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)}toLocal(t,e,i,s){return e&&(t=e.toGlobal(t,i,s)),s||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,i)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){this.parent?.removeChild(this)}setTransform(t=0,e=0,i=1,s=1,n=0,o=0,a=0,h=0,l=0){return this.position.x=t,this.position.y=e,this.scale.x=i||1,this.scale.y=s||1,this.rotation=n,this.skew.x=o,this.skew.y=a,this.pivot.x=h,this.pivot.y=l,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new ia),this.tempDisplayObjectParent}enableTempParent(){let t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*wl}set angle(t){this.transform.rotation=t*Tl}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){let e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount--,e._maskRefCount===0&&(e.renderable=!0,e.isMask=!1))}if(this._mask=t,this._mask){let e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount===0&&(e.renderable=!1,e.isMask=!0),e._maskRefCount++)}}}},ia=class extends Xe{constructor(){super(...arguments),this.sortDirty=null}};Xe.prototype.displayObjectUpdateTransform=Xe.prototype.updateTransform;var k_=new tt;function O_(r,t){return r.zIndex===t.zIndex?r._lastSortedIndex-t._lastSortedIndex:r.zIndex-t.zIndex}var Nf=class zl extends Xe{constructor(){super(),this.children=[],this.sortableChildren=zl.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(t){}addChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.addChild(t[e]);else{let e=t[0];e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.push(e),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this)}return t[0]}addChildAt(t,e){if(e<0||e>this.children.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${this.children.length}`);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t}swapChildren(t,e){if(t===e)return;let i=this.getChildIndex(t),s=this.getChildIndex(e);this.children[i]=e,this.children[s]=t,this.onChildrenChange(i<s?i:s)}getChildIndex(t){let e=this.children.indexOf(t);if(e===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return e}setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);let i=this.getChildIndex(t);M.removeItems(this.children,i,1),this.children.splice(e,0,t),this.onChildrenChange(e)}getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]}removeChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.removeChild(t[e]);else{let e=t[0],i=this.children.indexOf(e);if(i===-1)return null;e.parent=null,e.transform._parentID=-1,M.removeItems(this.children,i,1),this._boundsID++,this.onChildrenChange(i),e.emit("removed",this),this.emit("childRemoved",e,this,i)}return t[0]}removeChildAt(t){let e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,M.removeItems(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e}removeChildren(t=0,e=this.children.length){let i=t,s=e,n=s-i,o;if(n>0&&n<=s){o=this.children.splice(i,n);for(let a=0;a<o.length;++a)o[a].parent=null,o[a].transform&&(o[a].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(let a=0;a<o.length;++a)o[a].emit("removed",this),this.emit("childRemoved",o[a],this,a);return o}else if(n===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let t=!1;for(let e=0,i=this.children.length;e<i;++e){let s=this.children[e];s._lastSortedIndex=e,!t&&s.zIndex!==0&&(t=!0)}t&&this.children.length>1&&this.children.sort(O_),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let t=0,e=this.children.length;t<e;++t){let i=this.children[t];i.visible&&i.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let t=0;t<this.children.length;t++){let e=this.children[t];if(!(!e.visible||!e.renderable))if(e.calculateBounds(),e._mask){let i=e._mask.isMaskData?e._mask.maskObject:e._mask;i?(i.calculateBounds(),this._bounds.addBoundsMask(e._bounds,i._bounds)):this._bounds.addBounds(e._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(t,e=!1){let i=super.getLocalBounds(t);if(!e)for(let s=0,n=this.children.length;s<n;++s){let o=this.children[s];o.visible&&o.updateTransform()}return i}_calculateBounds(){}_renderWithCulling(t){let e=t.renderTexture.sourceFrame;if(!(e.width>0&&e.height>0))return;let i,s;this.cullArea?(i=this.cullArea,s=this.worldTransform):this._render!==zl.prototype._render&&(i=this.getBounds(!0));let n=t.projection.transform;if(n&&(s?(s=k_.copyFrom(s),s.prepend(n)):s=n),i&&e.intersects(i,s))this._render(t);else if(this.cullArea)return;for(let o=0,a=this.children.length;o<a;++o){let h=this.children[o],l=h.cullable;h.cullable=l||!this.cullArea,h.render(t),h.cullable=l}}render(t){if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||this.filters?.length)this.renderAdvanced(t);else if(this.cullable)this._renderWithCulling(t);else{this._render(t);for(let e=0,i=this.children.length;e<i;++e)this.children[e].render(t)}}renderAdvanced(t){let e=this.filters,i=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let n=0;n<e.length;n++)e[n].enabled&&this._enabledFilters.push(e[n])}let s=e&&this._enabledFilters?.length||i&&(!i.isMaskData||i.enabled&&(i.autoDetect||i.type!==_t.NONE));if(s&&t.batch.flush(),e&&this._enabledFilters?.length&&t.filter.push(this,this._enabledFilters),i&&t.mask.push(this,this._mask),this.cullable)this._renderWithCulling(t);else{this._render(t);for(let n=0,o=this.children.length;n<o;++n)this.children[n].render(t)}s&&t.batch.flush(),i&&t.mask.pop(this),e&&this._enabledFilters?.length&&t.filter.pop()}_render(t){}destroy(t){super.destroy(),this.sortDirty=!1;let e=typeof t=="boolean"?t:t?.children,i=this.removeChildren(0,this.children.length);if(e)for(let s=0;s<i.length;++s)i[s].destroy(t)}get width(){return this.scale.x*this.getLocalBounds().width}set width(t){let e=this.getLocalBounds().width;e!==0?this.scale.x=t/e:this.scale.x=1,this._width=t}get height(){return this.scale.y*this.getLocalBounds().height}set height(t){let e=this.getLocalBounds().height;e!==0?this.scale.y=t/e:this.scale.y=1,this._height=t}};Nf.defaultSortableChildren=!1;var A=Nf;A.prototype.containerUpdateTransform=A.prototype.updateTransform;Object.defineProperties(S,{SORTABLE_CHILDREN:{get(){return A.defaultSortableChildren},set(r){M.deprecation("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),A.defaultSortableChildren=r}}});var Df=class Wl{constructor(t){this.stage=new A,t=Object.assign({forceCanvas:!1},t),this.renderer=Ul(t),Wl._plugins.forEach(e=>{e.init.call(this,t)})}render(){this.renderer.render(this.stage)}get view(){return this.renderer?.view}get screen(){return this.renderer?.screen}destroy(t,e){let i=Wl._plugins.slice(0);i.reverse(),i.forEach(s=>{s.destroy.call(this)}),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null}};Df._plugins=[];var sa=Df;T.handleByList(w.Application,sa._plugins);var Rn=class{static init(t){Object.defineProperty(this,"resizeTo",{set(e){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=e,e&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let e,i;if(this._resizeTo===globalThis.window)e=globalThis.innerWidth,i=globalThis.innerHeight;else{let{clientWidth:s,clientHeight:n}=this._resizeTo;e=s,i=n}this.renderer.resize(e,i),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}};Rn.extension=w.Application;T.add(Rn);var et=new Ve.default;var na=class{ysdk;constructor(t){this.ysdk=t}showInterstitial(){console.log("Interstitial"),this.ysdk.adv.showFullscreenAdv({callbacks:{onOpen:()=>{et.emit("AD_STARTED")},onClose:()=>{et.emit("AD_FINISHED")},onError:()=>{},onOffline:()=>{}}})}showRewarded(t,e){this.ysdk.adv.showRewardedVideo({callbacks:{onOpen:()=>{et.emit("AD_STARTED")},onClose:()=>{et.emit("AD_FINISHED"),t()},onRewarded:e,onError:()=>{}}})}};var Uf;function Gf(r){return Uf=r,r}function Bt(){return Uf}var N_=0,Xl=class extends M.EventEmitter{constructor(r){super(),this.id=N_++,this.init(r)}set(r,t){if(this[r]===void 0)throw new Error(`Property with name ${r} does not exist.`);switch(r){case"speed":this.speed=t;break;case"volume":this.volume=t;break;case"paused":this.paused=t;break;case"loop":this.loop=t;break;case"muted":this.muted=t;break}return this}get progress(){let{currentTime:r}=this._source;return r/this._duration}get paused(){return this._paused}set paused(r){this._paused=r,this.refreshPaused()}_onPlay(){this._playing=!0}_onPause(){this._playing=!1}init(r){this._playing=!1,this._duration=r.source.duration;let t=this._source=r.source.cloneNode(!1);t.src=r.parent.url,t.onplay=this._onPlay.bind(this),t.onpause=this._onPause.bind(this),r.context.on("refresh",this.refresh,this),r.context.on("refreshPaused",this.refreshPaused,this),this._media=r}_internalStop(){this._source&&this._playing&&(this._source.onended=null,this._source.pause())}stop(){this._internalStop(),this._source&&this.emit("stop")}get speed(){return this._speed}set speed(r){this._speed=r,this.refresh()}get volume(){return this._volume}set volume(r){this._volume=r,this.refresh()}get loop(){return this._loop}set loop(r){this._loop=r,this.refresh()}get muted(){return this._muted}set muted(r){this._muted=r,this.refresh()}get filters(){return console.warn("HTML Audio does not support filters"),null}set filters(r){console.warn("HTML Audio does not support filters")}refresh(){let r=this._media.context,t=this._media.parent;this._source.loop=this._loop||t.loop;let e=r.volume*(r.muted?0:1),i=t.volume*(t.muted?0:1),s=this._volume*(this._muted?0:1);this._source.volume=s*e*i,this._source.playbackRate=this._speed*r.speed*t.speed}refreshPaused(){let r=this._media.context,t=this._media.parent,e=this._paused||t.paused||r.paused;e!==this._pausedReal&&(this._pausedReal=e,e?(this._internalStop(),this.emit("paused")):(this.emit("resumed"),this.play({start:this._source.currentTime,end:this._end,volume:this._volume,speed:this._speed,loop:this._loop})),this.emit("pause",e))}play(r){let{start:t,end:e,speed:i,loop:s,volume:n,muted:o}=r;e&&console.assert(e>t,"End time is before start time"),this._speed=i,this._volume=n,this._loop=!!s,this._muted=o,this.refresh(),this.loop&&e!==null&&(console.warn('Looping not support when specifying an "end" time'),this.loop=!1),this._start=t,this._end=e||this._duration,this._start=Math.max(0,this._start-Xl.PADDING),this._end=Math.min(this._end+Xl.PADDING,this._duration),this._source.onloadedmetadata=()=>{this._source&&(this._source.currentTime=t,this._source.onloadedmetadata=null,this.emit("progress",t,this._duration),lt.shared.add(this._onUpdate,this))},this._source.onended=this._onComplete.bind(this),this._source.play(),this.emit("start")}_onUpdate(){this.emit("progress",this.progress,this._duration),this._source.currentTime>=this._end&&!this._source.loop&&this._onComplete()}_onComplete(){lt.shared.remove(this._onUpdate,this),this._internalStop(),this.emit("progress",1,this._duration),this.emit("end",this)}destroy(){lt.shared.remove(this._onUpdate,this),this.removeAllListeners();let r=this._source;r&&(r.onended=null,r.onplay=null,r.onpause=null,this._internalStop()),this._source=null,this._speed=1,this._volume=1,this._loop=!1,this._end=null,this._start=0,this._duration=0,this._playing=!1,this._pausedReal=!1,this._paused=!1,this._muted=!1,this._media&&(this._media.context.off("refresh",this.refresh,this),this._media.context.off("refreshPaused",this.refreshPaused,this),this._media=null)}toString(){return`[HTMLAudioInstance id=${this.id}]`}},oa=Xl;oa.PADDING=.1;var Mn=class extends M.EventEmitter{init(t){this.parent=t,this._source=t.options.source||new Audio,t.url&&(this._source.src=t.url)}create(){return new oa(this)}get isPlayable(){return!!this._source&&this._source.readyState===4}get duration(){return this._source.duration}get context(){return this.parent.context}get filters(){return null}set filters(t){console.warn("HTML Audio does not support filters")}destroy(){this.removeAllListeners(),this.parent=null,this._source&&(this._source.src="",this._source.load(),this._source=null)}get source(){return this._source}load(t){let e=this._source,i=this.parent;if(e.readyState===4){i.isLoaded=!0;let h=i.autoPlayStart();t&&setTimeout(()=>{t(null,i,h)},0);return}if(!i.url){t(new Error("sound.url or sound.source must be set"));return}e.src=i.url;let s=()=>{a(),i.isLoaded=!0;let h=i.autoPlayStart();t&&t(null,i,h)},n=()=>{a(),t&&t(new Error("Sound loading has been aborted"))},o=()=>{a();let h=`Failed to load audio element (code: ${e.error.code})`;t?t(new Error(h)):console.error(h)},a=()=>{e.removeEventListener("canplaythrough",s),e.removeEventListener("load",s),e.removeEventListener("abort",n),e.removeEventListener("error",o)};e.addEventListener("canplaythrough",s,!1),e.addEventListener("load",s,!1),e.addEventListener("abort",n,!1),e.addEventListener("error",o,!1),e.load()}};var Fn=class{constructor(t,e){this.parent=t,Object.assign(this,e),this.duration=this.end-this.start,console.assert(this.duration>0,"End time must be after start time")}play(t){return this.parent.play({complete:t,speed:this.speed||this.parent.speed,end:this.end,start:this.start,loop:this.loop})}destroy(){this.parent=null}};var ni=["ogg","oga","opus","m4a","mp3","mpeg","wav","aiff","wma","mid","caf"],Yl=["audio/mpeg","audio/ogg"],oi={};function Hf(r){let t={m4a:"audio/mp4",oga:"audio/ogg",opus:'audio/ogg; codecs="opus"',caf:'audio/x-caf; codecs="opus"',...r||{}},e=document.createElement("audio"),i={},s=/^no$/;ni.forEach(n=>{let o=e.canPlayType(`audio/${n}`).replace(s,""),a=t[n]?e.canPlayType(t[n]).replace(s,""):"";i[n]=!!o||!!a}),Object.assign(oi,i)}Hf();var re=class{static setParamValue(t,e){if(t.setValueAtTime){let i=Bt().context;t.setValueAtTime(e,i.audioContext.currentTime)}else t.value=e;return e}};var D_=0,Bn=class extends M.EventEmitter{constructor(t){super(),this.id=D_++,this._media=null,this._paused=!1,this._muted=!1,this._elapsed=0,this.init(t)}set(t,e){if(this[t]===void 0)throw new Error(`Property with name ${t} does not exist.`);switch(t){case"speed":this.speed=e;break;case"volume":this.volume=e;break;case"muted":this.muted=e;break;case"loop":this.loop=e;break;case"paused":this.paused=e;break}return this}stop(){this._source&&(this._internalStop(),this.emit("stop"))}get speed(){return this._speed}set speed(t){this._speed=t,this.refresh(),this._update(!0)}get volume(){return this._volume}set volume(t){this._volume=t,this.refresh()}get muted(){return this._muted}set muted(t){this._muted=t,this.refresh()}get loop(){return this._loop}set loop(t){this._loop=t,this.refresh()}get filters(){return this._filters}set filters(t){this._filters&&(this._filters?.filter(e=>e).forEach(e=>e.disconnect()),this._filters=null,this._source.connect(this._gain)),this._filters=t?.length?t.slice(0):null,this.refresh()}refresh(){if(!this._source)return;let t=this._media.context,e=this._media.parent;this._source.loop=this._loop||e.loop;let i=t.volume*(t.muted?0:1),s=e.volume*(e.muted?0:1),n=this._volume*(this._muted?0:1);re.setParamValue(this._gain.gain,n*s*i),re.setParamValue(this._source.playbackRate,this._speed*e.speed*t.speed),this.applyFilters()}applyFilters(){if(this._filters?.length){this._source.disconnect();let t=this._source;this._filters.forEach(e=>{t.connect(e.destination),t=e}),t.connect(this._gain)}}refreshPaused(){let t=this._media.context,e=this._media.parent,i=this._paused||e.paused||t.paused;i!==this._pausedReal&&(this._pausedReal=i,i?(this._internalStop(),this.emit("paused")):(this.emit("resumed"),this.play({start:this._elapsed%this._duration,end:this._end,speed:this._speed,loop:this._loop,volume:this._volume})),this.emit("pause",i))}play(t){let{start:e,end:i,speed:s,loop:n,volume:o,muted:a,filters:h}=t;i&&console.assert(i>e,"End time is before start time"),this._paused=!1;let{source:l,gain:c}=this._media.nodes.cloneBufferSource();this._source=l,this._gain=c,this._speed=s,this._volume=o,this._loop=!!n,this._muted=a,this._filters=h,this.refresh();let u=this._source.buffer.duration;this._duration=u,this._end=i,this._lastUpdate=this._now(),this._elapsed=e,this._source.onended=this._onComplete.bind(this),this._loop?(this._source.loopEnd=i,this._source.loopStart=e,this._source.start(0,e)):i?this._source.start(0,e,i-e):this._source.start(0,e),this.emit("start"),this._update(!0),this.enableTicker(!0)}enableTicker(t){lt.shared.remove(this._updateListener,this),t&&lt.shared.add(this._updateListener,this)}get progress(){return this._progress}get paused(){return this._paused}set paused(t){this._paused=t,this.refreshPaused()}destroy(){this.removeAllListeners(),this._internalStop(),this._gain&&(this._gain.disconnect(),this._gain=null),this._media&&(this._media.context.events.off("refresh",this.refresh,this),this._media.context.events.off("refreshPaused",this.refreshPaused,this),this._media=null),this._filters?.forEach(t=>t.disconnect()),this._filters=null,this._end=null,this._speed=1,this._volume=1,this._loop=!1,this._elapsed=0,this._duration=0,this._paused=!1,this._muted=!1,this._pausedReal=!1}toString(){return`[WebAudioInstance id=${this.id}]`}_now(){return this._media.context.audioContext.currentTime}_updateListener(){this._update()}_update(t=!1){if(this._source){let e=this._now(),i=e-this._lastUpdate;if(i>0||t){let s=this._source.playbackRate.value;this._elapsed+=i*s,this._lastUpdate=e;let n=this._duration,o;if(this._source.loopStart){let a=this._source.loopEnd-this._source.loopStart;o=(this._source.loopStart+this._elapsed%a)/n}else o=this._elapsed%n/n;this._progress=o,this.emit("progress",this._progress,n)}}}init(t){this._media=t,t.context.events.on("refresh",this.refresh,this),t.context.events.on("refreshPaused",this.refreshPaused,this)}_internalStop(){if(this._source){this.enableTicker(!1),this._source.onended=null,this._source.stop(0),this._source.disconnect();try{this._source.buffer=null}catch(t){console.warn("Failed to set AudioBufferSourceNode.buffer to null:",t)}this._source=null}}_onComplete(){if(this._source){this.enableTicker(!1),this._source.onended=null,this._source.disconnect();try{this._source.buffer=null}catch(t){console.warn("Failed to set AudioBufferSourceNode.buffer to null:",t)}}this._source=null,this._progress=1,this.emit("progress",1,this._duration),this.emit("end",this)}};var ai=class{constructor(t,e){this._output=e,this._input=t}get destination(){return this._input}get filters(){return this._filters}set filters(t){if(this._filters&&(this._filters.forEach(e=>{e&&e.disconnect()}),this._filters=null,this._input.connect(this._output)),t&&t.length){this._filters=t.slice(0),this._input.disconnect();let e=null;t.forEach(i=>{e===null?this._input.connect(i.destination):e.connect(i.destination),e=i}),e.connect(this._output)}}destroy(){this.filters=null,this._input=null,this._output=null}};var Vf=class extends ai{constructor(r){let t=r.audioContext,e=t.createBufferSource(),i=t.createGain(),s=t.createAnalyser();e.connect(s),s.connect(i),i.connect(r.destination),super(s,i),this.context=r,this.bufferSource=e,this.gain=i,this.analyser=s}get script(){return this._script||(this._script=this.context.audioContext.createScriptProcessor(Vf.BUFFER_SIZE),this._script.connect(this.context.destination)),this._script}destroy(){super.destroy(),this.bufferSource.disconnect(),this._script&&this._script.disconnect(),this.gain.disconnect(),this.analyser.disconnect(),this.bufferSource=null,this._script=null,this.gain=null,this.analyser=null,this.context=null}cloneBufferSource(){let r=this.bufferSource,t=this.context.audioContext.createBufferSource();t.buffer=r.buffer,re.setParamValue(t.playbackRate,r.playbackRate.value),t.loop=r.loop;let e=this.context.audioContext.createGain();return t.connect(e),e.connect(this.destination),{source:t,gain:e}}get bufferSize(){return this.script.bufferSize}},aa=Vf;aa.BUFFER_SIZE=0;var hi=class{init(t){this.parent=t,this._nodes=new aa(this.context),this._source=this._nodes.bufferSource,this.source=t.options.source}destroy(){this.parent=null,this._nodes.destroy(),this._nodes=null;try{this._source.buffer=null}catch(t){console.warn("Failed to set AudioBufferSourceNode.buffer to null:",t)}this._source=null,this.source=null}create(){return new Bn(this)}get context(){return this.parent.context}get isPlayable(){return!!this._source&&!!this._source.buffer}get filters(){return this._nodes.filters}set filters(t){this._nodes.filters=t}get duration(){return console.assert(this.isPlayable,"Sound not yet playable, no duration"),this._source.buffer.duration}get buffer(){return this._source.buffer}set buffer(t){this._source.buffer=t}get nodes(){return this._nodes}load(t){this.source?this._decode(this.source,t):this.parent.url?this._loadUrl(t):t?t(new Error("sound.url or sound.source must be set")):console.error("sound.url or sound.source must be set")}async _loadUrl(t){let e=this.parent.url,i=await S.ADAPTER.fetch(e);this._decode(await i.arrayBuffer(),t)}_decode(t,e){let i=(s,n)=>{if(s)e&&e(s);else{this.parent.isLoaded=!0,this.buffer=n;let o=this.parent.autoPlayStart();e&&e(null,this.parent,o)}};t instanceof AudioBuffer?i(null,t):this.parent.context.decode(t,i)}};var ds=class{static from(r){let t={};typeof r=="string"?t.url=r:r instanceof ArrayBuffer||r instanceof AudioBuffer||r instanceof HTMLAudioElement?t.source=r:Array.isArray(r)?t.url=r:t=r,t={autoPlay:!1,singleInstance:!1,url:null,source:null,preload:!1,volume:1,speed:1,complete:null,loaded:null,loop:!1,...t},Object.freeze(t);let e=Bt().useLegacy?new Mn:new hi;return new ds(e,t)}constructor(r,t){this.media=r,this.options=t,this._instances=[],this._sprites={},this.media.init(this);let e=t.complete;this._autoPlayOptions=e?{complete:e}:null,this.isLoaded=!1,this._preloadQueue=null,this.isPlaying=!1,this.autoPlay=t.autoPlay,this.singleInstance=t.singleInstance,this.preload=t.preload||this.autoPlay,this.url=Array.isArray(t.url)?this.preferUrl(t.url):t.url,this.speed=t.speed,this.volume=t.volume,this.loop=t.loop,t.sprites&&this.addSprites(t.sprites),this.preload&&this._preload(t.loaded)}preferUrl(r){let[t]=r.map(e=>({url:e,ext:M.path.extname(e).slice(1)})).filter(({ext:e})=>oi[e]).sort((e,i)=>ni.indexOf(e.ext)-ni.indexOf(i.ext));if(!t)throw new Error("No supported file type found");return t.url}get context(){return Bt().context}pause(){return this.isPlaying=!1,this.paused=!0,this}resume(){return this.isPlaying=this._instances.length>0,this.paused=!1,this}get paused(){return this._paused}set paused(r){this._paused=r,this.refreshPaused()}get speed(){return this._speed}set speed(r){this._speed=r,this.refresh()}get filters(){return this.media.filters}set filters(r){this.media.filters=r}addSprites(r,t){if(typeof r=="object"){let i={};for(let s in r)i[s]=this.addSprites(s,r[s]);return i}console.assert(!this._sprites[r],`Alias ${r} is already taken`);let e=new Fn(this,t);return this._sprites[r]=e,e}destroy(){this._removeInstances(),this.removeSprites(),this.media.destroy(),this.media=null,this._sprites=null,this._instances=null}removeSprites(r){if(r){let t=this._sprites[r];t!==void 0&&(t.destroy(),delete this._sprites[r])}else for(let t in this._sprites)this.removeSprites(t);return this}get isPlayable(){return this.isLoaded&&this.media&&this.media.isPlayable}stop(){if(!this.isPlayable)return this.autoPlay=!1,this._autoPlayOptions=null,this;this.isPlaying=!1;for(let r=this._instances.length-1;r>=0;r--)this._instances[r].stop();return this}play(r,t){let e;if(typeof r=="string"?e={sprite:r,loop:this.loop,complete:t}:typeof r=="function"?(e={},e.complete=r):e=r,e={complete:null,loaded:null,sprite:null,end:null,start:0,volume:1,speed:1,muted:!1,loop:!1,...e||{}},e.sprite){let s=e.sprite;console.assert(!!this._sprites[s],`Alias ${s} is not available`);let n=this._sprites[s];e.start=n.start+(e.start||0),e.end=n.end,e.speed=n.speed||1,e.loop=n.loop||e.loop,delete e.sprite}if(e.offset&&(e.start=e.offset),!this.isLoaded)return this._preloadQueue?new Promise(s=>{this._preloadQueue.push(()=>{s(this.play(e))})}):(this._preloadQueue=[],this.autoPlay=!0,this._autoPlayOptions=e,new Promise((s,n)=>{this._preload((o,a,h)=>{this._preloadQueue.forEach(l=>l()),this._preloadQueue=null,o?n(o):(e.loaded&&e.loaded(o,a,h),s(h))})}));(this.singleInstance||e.singleInstance)&&this._removeInstances();let i=this._createInstance();return this._instances.push(i),this.isPlaying=!0,i.once("end",()=>{e.complete&&e.complete(this),this._onComplete(i)}),i.once("stop",()=>{this._onComplete(i)}),i.play(e),i}refresh(){let r=this._instances.length;for(let t=0;t<r;t++)this._instances[t].refresh()}refreshPaused(){let r=this._instances.length;for(let t=0;t<r;t++)this._instances[t].refreshPaused()}get volume(){return this._volume}set volume(r){this._volume=r,this.refresh()}get muted(){return this._muted}set muted(r){this._muted=r,this.refresh()}get loop(){return this._loop}set loop(r){this._loop=r,this.refresh()}_preload(r){this.media.load(r)}get instances(){return this._instances}get sprites(){return this._sprites}get duration(){return this.media.duration}autoPlayStart(){let r;return this.autoPlay&&(r=this.play(this._autoPlayOptions)),r}_removeInstances(){for(let r=this._instances.length-1;r>=0;r--)this._poolInstance(this._instances[r]);this._instances.length=0}_onComplete(r){if(this._instances){let t=this._instances.indexOf(r);t>-1&&this._instances.splice(t,1),this.isPlaying=this._instances.length>0}this._poolInstance(r)}_createInstance(){if(ds._pool.length>0){let r=ds._pool.pop();return r.init(this.media),r}return this.media.create()}_poolInstance(r){r.destroy(),ds._pool.indexOf(r)<0&&ds._pool.push(r)}},Te=ds;Te._pool=[];var Ln=class extends M.EventEmitter{constructor(){super(...arguments),this.speed=1,this.muted=!1,this.volume=1,this.paused=!1}refresh(){this.emit("refresh")}refreshPaused(){this.emit("refreshPaused")}get filters(){return console.warn("HTML Audio does not support filters"),null}set filters(t){console.warn("HTML Audio does not support filters")}get audioContext(){return console.warn("HTML Audio does not support audioContext"),null}toggleMute(){return this.muted=!this.muted,this.refresh(),this.muted}togglePause(){return this.paused=!this.paused,this.refreshPaused(),this.paused}destroy(){this.removeAllListeners()}};var ps=class r extends ai{constructor(){let t=window,e=new r.AudioContext,i=e.createDynamicsCompressor(),s=e.createAnalyser();s.connect(i),i.connect(e.destination),super(s,i),this.autoPause=!0,this._ctx=e,this._offlineCtx=new r.OfflineAudioContext(1,2,t.OfflineAudioContext?Math.max(8e3,Math.min(96e3,e.sampleRate)):44100),this.compressor=i,this.analyser=s,this.events=new M.EventEmitter,this.volume=1,this.speed=1,this.muted=!1,this.paused=!1,this._locked=e.state==="suspended"&&("ontouchstart"in globalThis||"onclick"in globalThis),this._locked&&(this._unlock(),this._unlock=this._unlock.bind(this),document.addEventListener("mousedown",this._unlock,!0),document.addEventListener("touchstart",this._unlock,!0),document.addEventListener("touchend",this._unlock,!0)),this.onFocus=this.onFocus.bind(this),this.onBlur=this.onBlur.bind(this),globalThis.addEventListener("focus",this.onFocus),globalThis.addEventListener("blur",this.onBlur)}onFocus(){if(!this.autoPause)return;let t=this._ctx.state;(t==="suspended"||t==="interrupted"||!this._locked)&&(this.paused=this._pausedOnBlur,this.refreshPaused())}onBlur(){this.autoPause&&(this._locked||(this._pausedOnBlur=this._paused,this.paused=!0,this.refreshPaused()))}_unlock(){this._locked&&(this.playEmptySound(),this._ctx.state==="running"&&(document.removeEventListener("mousedown",this._unlock,!0),document.removeEventListener("touchend",this._unlock,!0),document.removeEventListener("touchstart",this._unlock,!0),this._locked=!1))}playEmptySound(){let t=this._ctx.createBufferSource();t.buffer=this._ctx.createBuffer(1,1,22050),t.connect(this._ctx.destination),t.start(0,0,0),t.context.state==="suspended"&&t.context.resume()}static get AudioContext(){let t=window;return t.AudioContext||t.webkitAudioContext||null}static get OfflineAudioContext(){let t=window;return t.OfflineAudioContext||t.webkitOfflineAudioContext||null}destroy(){super.destroy();let t=this._ctx;typeof t.close<"u"&&t.close(),globalThis.removeEventListener("focus",this.onFocus),globalThis.removeEventListener("blur",this.onBlur),this.events.removeAllListeners(),this.analyser.disconnect(),this.compressor.disconnect(),this.analyser=null,this.compressor=null,this.events=null,this._offlineCtx=null,this._ctx=null}get audioContext(){return this._ctx}get offlineContext(){return this._offlineCtx}set paused(t){t&&this._ctx.state==="running"?this._ctx.suspend():!t&&this._ctx.state==="suspended"&&this._ctx.resume(),this._paused=t}get paused(){return this._paused}refresh(){this.events.emit("refresh")}refreshPaused(){this.events.emit("refreshPaused")}toggleMute(){return this.muted=!this.muted,this.refresh(),this.muted}togglePause(){return this.paused=!this.paused,this.refreshPaused(),this._paused}decode(t,e){let i=n=>{e(new Error(n?.message||"Unable to decode file"))},s=this._offlineCtx.decodeAudioData(t,n=>{e(null,n)},i);s&&s.catch(i)}};var ha=class{constructor(){this.init()}init(){return this.supported&&(this._webAudioContext=new ps),this._htmlAudioContext=new Ln,this._sounds={},this.useLegacy=!this.supported,this}get context(){return this._context}get filtersAll(){return this.useLegacy?[]:this._context.filters}set filtersAll(t){this.useLegacy||(this._context.filters=t)}get supported(){return ps.AudioContext!==null}add(t,e){if(typeof t=="object"){let n={};for(let o in t){let a=this._getOptions(t[o],e);n[o]=this.add(o,a)}return n}if(console.assert(!this._sounds[t],`Sound with alias ${t} already exists.`),e instanceof Te)return this._sounds[t]=e,e;let i=this._getOptions(e),s=Te.from(i);return this._sounds[t]=s,s}_getOptions(t,e){let i;return typeof t=="string"?i={url:t}:Array.isArray(t)?i={url:t}:t instanceof ArrayBuffer||t instanceof AudioBuffer||t instanceof HTMLAudioElement?i={source:t}:i=t,i={...i,...e||{}},i}get useLegacy(){return this._useLegacy}set useLegacy(t){this._useLegacy=t,this._context=!t&&this.supported?this._webAudioContext:this._htmlAudioContext}get disableAutoPause(){return!this._webAudioContext.autoPause}set disableAutoPause(t){this._webAudioContext.autoPause=!t}remove(t){return this.exists(t,!0),this._sounds[t].destroy(),delete this._sounds[t],this}get volumeAll(){return this._context.volume}set volumeAll(t){this._context.volume=t,this._context.refresh()}get speedAll(){return this._context.speed}set speedAll(t){this._context.speed=t,this._context.refresh()}togglePauseAll(){return this._context.togglePause()}pauseAll(){return this._context.paused=!0,this._context.refreshPaused(),this}resumeAll(){return this._context.paused=!1,this._context.refreshPaused(),this}toggleMuteAll(){return this._context.toggleMute()}muteAll(){return this._context.muted=!0,this._context.refresh(),this}unmuteAll(){return this._context.muted=!1,this._context.refresh(),this}removeAll(){for(let t in this._sounds)this._sounds[t].destroy(),delete this._sounds[t];return this}stopAll(){for(let t in this._sounds)this._sounds[t].stop();return this}exists(t,e=!1){let i=!!this._sounds[t];return e&&console.assert(i,`No sound matching alias '${t}'.`),i}isPlaying(){for(let t in this._sounds)if(this._sounds[t].isPlaying)return!0;return!1}find(t){return this.exists(t,!0),this._sounds[t]}play(t,e){return this.find(t).play(e)}stop(t){return this.find(t).stop()}pause(t){return this.find(t).pause()}resume(t){return this.find(t).resume()}volume(t,e){let i=this.find(t);return e!==void 0&&(i.volume=e),i.volume}speed(t,e){let i=this.find(t);return e!==void 0&&(i.speed=e),i.speed}duration(t){return this.find(t).duration}close(){return this.removeAll(),this._sounds=null,this._webAudioContext&&(this._webAudioContext.destroy(),this._webAudioContext=null),this._htmlAudioContext&&(this._htmlAudioContext.destroy(),this._htmlAudioContext=null),this._context=null,this}};var Ee=class{constructor(t,e){this.init(t,e)}init(t,e){this.destination=t,this.source=e||t}connect(t){this.source?.connect(t)}disconnect(){this.source?.disconnect()}destroy(){this.disconnect(),this.destination=null,this.source=null}};var rt=class extends Ee{constructor(r=0,t=0,e=0,i=0,s=0,n=0,o=0,a=0,h=0,l=0){let c=[],u=[{f:rt.F32,type:"lowshelf",gain:r},{f:rt.F64,type:"peaking",gain:t},{f:rt.F125,type:"peaking",gain:e},{f:rt.F250,type:"peaking",gain:i},{f:rt.F500,type:"peaking",gain:s},{f:rt.F1K,type:"peaking",gain:n},{f:rt.F2K,type:"peaking",gain:o},{f:rt.F4K,type:"peaking",gain:a},{f:rt.F8K,type:"peaking",gain:h},{f:rt.F16K,type:"highshelf",gain:l}];Bt().useLegacy||(c=u.map(d=>{let p=Bt().context.audioContext.createBiquadFilter();return p.type=d.type,re.setParamValue(p.Q,1),p.frequency.value=d.f,re.setParamValue(p.gain,d.gain),p})),super(c[0],c[c.length-1]),this.bands=c,this.bandsMap={};for(let d=0;d<this.bands.length;d++){let p=this.bands[d];d>0&&this.bands[d-1].connect(p),this.bandsMap[p.frequency.value]=p}}setGain(r,t=0){if(!this.bandsMap[r])throw new Error(`No band found for frequency ${r}`);re.setParamValue(this.bandsMap[r].gain,t)}getGain(r){if(!this.bandsMap[r])throw new Error(`No band found for frequency ${r}`);return this.bandsMap[r].gain.value}set f32(r){this.setGain(rt.F32,r)}get f32(){return this.getGain(rt.F32)}set f64(r){this.setGain(rt.F64,r)}get f64(){return this.getGain(rt.F64)}set f125(r){this.setGain(rt.F125,r)}get f125(){return this.getGain(rt.F125)}set f250(r){this.setGain(rt.F250,r)}get f250(){return this.getGain(rt.F250)}set f500(r){this.setGain(rt.F500,r)}get f500(){return this.getGain(rt.F500)}set f1k(r){this.setGain(rt.F1K,r)}get f1k(){return this.getGain(rt.F1K)}set f2k(r){this.setGain(rt.F2K,r)}get f2k(){return this.getGain(rt.F2K)}set f4k(r){this.setGain(rt.F4K,r)}get f4k(){return this.getGain(rt.F4K)}set f8k(r){this.setGain(rt.F8K,r)}get f8k(){return this.getGain(rt.F8K)}set f16k(r){this.setGain(rt.F16K,r)}get f16k(){return this.getGain(rt.F16K)}reset(){this.bands.forEach(r=>{re.setParamValue(r.gain,0)})}destroy(){this.bands.forEach(r=>{r.disconnect()}),this.bands=null,this.bandsMap=null}},ke=rt;ke.F32=32;ke.F64=64;ke.F125=125;ke.F250=250;ke.F500=500;ke.F1K=1e3;ke.F2K=2e3;ke.F4K=4e3;ke.F8K=8e3;ke.F16K=16e3;var jf={loader:w.LoadParser,resolver:w.ResolveParser,cache:w.CacheParser,detection:w.DetectionParser};T.handle(w.Asset,r=>{let t=r.ref;Object.entries(jf).filter(([e])=>!!t[e]).forEach(([e,i])=>T.add(Object.assign(t[e],{extension:t[e].extension??i})))},r=>{let t=r.ref;Object.keys(jf).filter(e=>!!t[e]).forEach(e=>T.remove(t[e]))});var la=class{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach(e=>{this._assetList.push(e)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;let t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let i=0;i<e;i++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}};function ae(r,t){if(Array.isArray(t)){for(let e of t)if(r.startsWith(`data:${e}`))return!0;return!1}return r.startsWith(`data:${t}`)}function he(r,t){let e=r.split("?")[0],i=M.path.extname(e).toLowerCase();return Array.isArray(t)?t.includes(i):i===t}var Nt=(r,t,e=!1)=>(Array.isArray(r)||(r=[r]),t?r.map(i=>typeof i=="string"||e?t(i):i):r);var kn=(r,t)=>{let e=t.split("?")[1];return e&&(r+=`?${e}`),r};function $f(r,t,e,i,s){let n=t[e];for(let o=0;o<n.length;o++){let a=n[o];e<t.length-1?$f(r.replace(i[e],a),t,e+1,i,s):s.push(r.replace(i[e],a))}}function ca(r){let t=/\{(.*?)\}/g,e=r.match(t),i=[];if(e){let s=[];e.forEach(n=>{let o=n.substring(1,n.length-1).split(",");s.push(o)}),$f(r,s,0,e,i)}else i.push(r);return i}var pr=r=>!Array.isArray(r);var ql=class{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){let e=this._cache.get(t);return e||console.warn(`[Assets] Asset id ${t} was not found in the Cache`),e}set(t,e){let i=Nt(t),s;for(let a=0;a<this.parsers.length;a++){let h=this.parsers[a];if(h.test(e)){s=h.getCacheableAssets(i,e);break}}s||(s={},i.forEach(a=>{s[a]=e}));let n=Object.keys(s),o={cacheKeys:n,keys:i};if(i.forEach(a=>{this._cacheMap.set(a,o)}),n.forEach(a=>{this._cache.has(a)&&this._cache.get(a)!==e&&console.warn("[Cache] already has key:",a),this._cache.set(a,s[a])}),e instanceof x){let a=e;i.forEach(h=>{a.baseTexture!==x.EMPTY.baseTexture&&j.addToCache(a.baseTexture,h),x.addToCache(a,h)})}}remove(t){if(!this._cacheMap.has(t)){console.warn(`[Assets] Asset id ${t} was not found in the Cache`);return}let e=this._cacheMap.get(t);e.cacheKeys.forEach(i=>{this._cache.delete(i)}),e.keys.forEach(i=>{this._cacheMap.delete(i)})}get parsers(){return this._parsers}},Oe=new ql;var ua=class{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(t,e,i)=>(this._parsersValidated=!1,t[e]=i,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(t,e){let i={promise:null,parser:null};return i.promise=(async()=>{let s=null,n=null;if(e.loadParser&&(n=this._parserHash[e.loadParser],n||console.warn(`[Assets] specified load parser "${e.loadParser}" not found while loading ${t}`)),!n){for(let o=0;o<this.parsers.length;o++){let a=this.parsers[o];if(a.load&&a.test?.(t,e,this)){n=a;break}}if(!n)return console.warn(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}s=await n.load(t,e,this),i.parser=n;for(let o=0;o<this.parsers.length;o++){let a=this.parsers[o];a.parse&&a.parse&&await a.testParse?.(s,e,this)&&(s=await a.parse(s,e,this)||s,i.parser=a)}return s})(),i}async load(t,e){this._parsersValidated||this._validateParsers();let i=0,s={},n=pr(t),o=Nt(t,l=>({alias:[l],src:l})),a=o.length,h=o.map(async l=>{let c=M.path.toAbsolute(l.src);if(!s[l.src])try{this.promiseCache[c]||(this.promiseCache[c]=this._getLoadPromiseAndParser(c,l)),s[l.src]=await this.promiseCache[c].promise,e&&e(++i/a)}catch(u){throw delete this.promiseCache[c],delete s[l.src],new Error(`[Loader.load] Failed to load ${c}.
${u}`)}});return await Promise.all(h),n?s[o[0].src]:s}async unload(t){let e=Nt(t,i=>({alias:[i],src:i})).map(async i=>{let s=M.path.toAbsolute(i.src),n=this.promiseCache[s];if(n){let o=await n.promise;delete this.promiseCache[s],n.parser?.unload?.(o,i,this)}});await Promise.all(e)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(t=>t.name).reduce((t,e)=>(t[e.name]&&console.warn(`[Assets] loadParser name conflict "${e.name}"`),{...t,[e.name]:e}),{})}};var It=(r=>(r[r.Low=0]="Low",r[r.Normal=1]="Normal",r[r.High=2]="High",r))(It||{});var j_=".json",$_="application/json",Kl={extension:{type:w.LoadParser,priority:It.Low},name:"loadJson",test(r){return ae(r,$_)||he(r,j_)},async load(r){return await(await S.ADAPTER.fetch(r)).json()}};T.add(Kl);var z_=".txt",W_="text/plain",Zl={name:"loadTxt",extension:{type:w.LoadParser,priority:It.Low},test(r){return ae(r,W_)||he(r,z_)},async load(r){return await(await S.ADAPTER.fetch(r)).text()}};T.add(Zl);var X_=["normal","bold","100","200","300","400","500","600","700","800","900"],Y_=[".ttf",".otf",".woff",".woff2"],q_=["font/ttf","font/otf","font/woff","font/woff2"],K_=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function Ql(r){let t=M.path.extname(r),e=M.path.basename(r,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(n=>n.charAt(0).toUpperCase()+n.slice(1)),i=e.length>0;for(let n of e)if(!n.match(K_)){i=!1;break}let s=e.join(" ");return i||(s=`"${s.replace(/[\\"]/g,"\\$&")}"`),s}var Z_=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function Q_(r){return Z_.test(r)?r:encodeURI(r)}var Jl={extension:{type:w.LoadParser,priority:It.Low},name:"loadWebFont",test(r){return ae(r,q_)||he(r,Y_)},async load(r,t){let e=S.ADAPTER.getFontFaceSet();if(e){let i=[],s=t.data?.family??Ql(r),n=t.data?.weights?.filter(a=>X_.includes(a))??["normal"],o=t.data??{};for(let a=0;a<n.length;a++){let h=n[a],l=new FontFace(s,`url(${Q_(r)})`,{...o,weight:h});await l.load(),e.add(l),i.push(l)}return i.length===1?i[0]:i}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(r){(Array.isArray(r)?r:[r]).forEach(t=>S.ADAPTER.getFontFaceSet().delete(t))}};T.add(Jl);var zf=0,tc,J_="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=",tx={id:"checkImageBitmap",code:`
    async function checkImageBitmap()
    {
        try
        {
            if (typeof createImageBitmap !== 'function') return false;

            const response = await fetch('${J_}');
            const imageBlob =  await response.blob();
            const imageBitmap = await createImageBitmap(imageBlob);

            return imageBitmap.width === 1 && imageBitmap.height === 1;
        }
        catch (e)
        {
            return false;
        }
    }
    checkImageBitmap().then((result) => { self.postMessage(result); });
    `},ex={id:"loadImageBitmap",code:`
    async function loadImageBitmap(url)
    {
        const response = await fetch(url);

        if (!response.ok)
        {
            throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \`
                + \`\${response.status} \${response.statusText}\`);
        }

        const imageBlob =  await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);

        return imageBitmap;
    }
    self.onmessage = async (event) =>
    {
        try
        {
            const imageBitmap = await loadImageBitmap(event.data.data[0]);

            self.postMessage({
                data: imageBitmap,
                uuid: event.data.uuid,
                id: event.data.id,
            }, [imageBitmap]);
        }
        catch(e)
        {
            self.postMessage({
                error: e,
                uuid: event.data.uuid,
                id: event.data.id,
            });
        }
    };`},ec,rc=class{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(t=>{let e=URL.createObjectURL(new Blob([tx.code],{type:"application/javascript"})),i=new Worker(e);i.addEventListener("message",s=>{i.terminate(),URL.revokeObjectURL(e),t(s.data)})}),this._isImageBitmapSupported)}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){tc===void 0&&(tc=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<tc&&(ec||(ec=URL.createObjectURL(new Blob([ex.code],{type:"application/javascript"}))),this._createdWorkers++,t=new Worker(ec),t.addEventListener("message",e=>{this.complete(e.data),this.returnWorker(e.target),this.next()})),t}returnWorker(t){this.workerPool.push(t)}complete(t){t.error!==void 0?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}async _run(t,e){await this._initWorkers();let i=new Promise((s,n)=>{this.queue.push({id:t,arguments:e,resolve:s,reject:n})});return this.next(),i}next(){if(!this.queue.length)return;let t=this.getWorker();if(!t)return;let e=this.queue.pop(),i=e.id;this.resolveHash[zf]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:zf++,id:i})}},ic=new rc;function Fr(r,t,e){r.resource.internal=!0;let i=new x(r),s=()=>{delete t.promiseCache[e],Oe.has(e)&&Oe.remove(e)};return i.baseTexture.once("destroyed",()=>{e in t.promiseCache&&(console.warn("[Assets] A BaseTexture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the BaseTexture."),s())}),i.once("destroyed",()=>{r.destroyed||(console.warn("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),s())}),i}var rx=[".jpeg",".jpg",".png",".webp",".avif"],ix=["image/jpeg","image/png","image/webp","image/avif"];async function sc(r){let t=await S.ADAPTER.fetch(r);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${r}: ${t.status} ${t.statusText}`);let e=await t.blob();return await createImageBitmap(e)}var fr={name:"loadTextures",extension:{type:w.LoadParser,priority:It.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(r){return ae(r,ix)||he(r,rx)},async load(r,t,e){let i=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap,s;i?this.config.preferWorkers&&await ic.isImageBitmapSupported()?s=await ic.loadImageBitmap(r):s=await sc(r):s=await new Promise((a,h)=>{let l=new Image;l.crossOrigin=this.config.crossOrigin,l.src=r,l.complete?a(l):(l.onload=()=>a(l),l.onerror=c=>h(c))});let n={...t.data};n.resolution??(n.resolution=M.getResolutionOfUrl(r)),i&&n.resourceOptions?.ownsImageBitmap===void 0&&(n.resourceOptions={...n.resourceOptions},n.resourceOptions.ownsImageBitmap=!0);let o=new j(s,n);return o.resource.src=r,Fr(o,e,r)},unload(r){r.destroy(!0)}};T.add(fr);var sx=".svg",nx="image/svg+xml",nc={extension:{type:w.LoadParser,priority:It.High},name:"loadSVG",test(r){return ae(r,nx)||he(r,sx)},async testParse(r){return us.test(r)},async parse(r,t,e){let i=new us(r,t?.data?.resourceOptions);await i.load();let s=new j(i,{resolution:M.getResolutionOfUrl(r),...t?.data});return s.resource.src=t.src,Fr(s,e,t.src)},async load(r,t){return(await S.ADAPTER.fetch(r)).text()},unload:fr.unload};T.add(nc);var ox=[".mp4",".m4v",".webm",".ogv"],ax=["video/mp4","video/webm","video/ogg"],oc={name:"loadVideo",extension:{type:w.LoadParser,priority:It.High},config:{defaultAutoPlay:!0},test(r){return ae(r,ax)||he(r,ox)},async load(r,t,e){let i,s=await(await S.ADAPTER.fetch(r)).blob(),n=URL.createObjectURL(s);try{let o={autoPlay:this.config.defaultAutoPlay,...t?.data?.resourceOptions},a=new Pn(n,o);await a.load();let h=new j(a,{alphaMode:await M.detectVideoAlphaMode(),resolution:M.getResolutionOfUrl(r),...t?.data});h.resource.src=r,i=Fr(h,e,r),i.baseTexture.once("destroyed",()=>{URL.revokeObjectURL(n)})}catch(o){throw URL.revokeObjectURL(n),o}return i},unload(r){r.destroy(!0)}};T.add(oc);var da=class{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,e)=>`${t}${this._bundleIdConnector}${e}`,extractAssetIdFromBundle:(t,e)=>e.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach(e=>{this._preferredOrder.push(e),e.priority||(e.priority=Object.keys(e.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if(typeof t=="string")this._defaultSearchParams=t;else{let e=t;this._defaultSearchParams=Object.keys(e).map(i=>`${encodeURIComponent(i)}=${encodeURIComponent(e[i])}`).join("&")}}getAlias(t){let{alias:e,name:i,src:s,srcs:n}=t;return Nt(e||i||s||n,o=>typeof o=="string"?o:Array.isArray(o)?o.map(a=>a?.src??a?.srcs??a):o?.src||o?.srcs?o.src??o.srcs:o,!0)}addManifest(t){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach(e=>{this.addBundle(e.name,e.assets)})}addBundle(t,e){let i=[];Array.isArray(e)?e.forEach(s=>{let n=s.src??s.srcs,o=s.alias??s.name,a;if(typeof o=="string"){let h=this._createBundleAssetId(t,o);i.push(h),a=[o,h]}else{let h=o.map(l=>this._createBundleAssetId(t,l));i.push(...h),a=[...o,...h]}this.add({...s,alias:a,src:n})}):Object.keys(e).forEach(s=>{let n=[s,this._createBundleAssetId(t,s)];if(typeof e[s]=="string")this.add({alias:n,src:e[s]});else if(Array.isArray(e[s]))this.add({alias:n,src:e[s]});else{let o=e[s],a=o.src??o.srcs;this.add({...o,alias:n,src:Array.isArray(a)?a:[a]})}i.push(...n)}),this._bundles[t]=i}add(t,e,i,s,n){let o=[];typeof t=="string"||Array.isArray(t)&&typeof t[0]=="string"?(M.deprecation("7.2.0",`Assets.add now uses an object instead of individual parameters.
Please use Assets.add({ alias, src, data, format, loadParser }) instead.`),o.push({alias:t,src:e,data:i,format:s,loadParser:n})):Array.isArray(t)?o.push(...t):o.push(t);let a;a=h=>{this.hasKey(h)&&console.warn(`[Resolver] already has key: ${h} overwriting`)},Nt(o).forEach(h=>{let{src:l,srcs:c}=h,{data:u,format:d,loadParser:p}=h,f=Nt(l||c).map(y=>typeof y=="string"?ca(y):Array.isArray(y)?y:[y]),m=this.getAlias(h);Array.isArray(m)?m.forEach(a):a(m);let b=[];f.forEach(y=>{y.forEach(v=>{let g={};if(typeof v!="object"){g.src=v;for(let _=0;_<this._parsers.length;_++){let L=this._parsers[_];if(L.test(v)){g=L.parse(v);break}}}else u=v.data??u,d=v.format??d,p=v.loadParser??p,g={...g,...v};if(!m)throw new Error(`[Resolver] alias is undefined for this asset: ${g.src}`);g=this.buildResolvedAsset(g,{aliases:m,data:u,format:d,loadParser:p}),b.push(g)})}),m.forEach(y=>{this._assetMap[y]=b})})}resolveBundle(t){let e=pr(t);t=Nt(t);let i={};return t.forEach(s=>{let n=this._bundles[s];if(n){let o=this.resolve(n),a={};for(let h in o){let l=o[h];a[this._extractAssetIdFromBundle(s,h)]=l}i[s]=a}}),e?i[t[0]]:i}resolveUrl(t){let e=this.resolve(t);if(typeof t!="string"){let i={};for(let s in e)i[s]=e[s].src;return i}return e.src}resolve(t){let e=pr(t);t=Nt(t);let i={};return t.forEach(s=>{if(!this._resolverHash[s])if(this._assetMap[s]){let n=this._assetMap[s],o=n[0],a=this._getPreferredOrder(n);a?.priority.forEach(h=>{a.params[h].forEach(l=>{let c=n.filter(u=>u[h]?u[h]===l:!1);c.length&&(n=c)})}),this._resolverHash[s]=n[0]??o}else this._resolverHash[s]=this.buildResolvedAsset({alias:[s],src:s},{});i[s]=this._resolverHash[s]}),e?i[t[0]]:i}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let e=0;e<t.length;e++){let i=t[0],s=this._preferredOrder.find(n=>n.params.format.includes(i.format));if(s)return s}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;let e=/\?/.test(t)?"&":"?";return`${t}${e}${this._defaultSearchParams}`}buildResolvedAsset(t,e){let{aliases:i,data:s,loadParser:n,format:o}=e;return(this._basePath||this._rootPath)&&(t.src=M.path.toAbsolute(t.src,this._basePath,this._rootPath)),t.alias=i??t.alias??[t.src],t.src=this._appendDefaultSearchParams(t.src),t.data={...s||{},...t.data},t.loadParser=n??t.loadParser,t.format=o??M.path.extname(t.src).slice(1),t.srcs=t.src,t.name=t.alias,t}};var pa=class{constructor(){this._detections=[],this._initialized=!1,this.resolver=new da,this.loader=new ua,this.cache=Oe,this._backgroundLoader=new la(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){if(this._initialized){console.warn("[Assets]AssetManager already initialized, did you load before calling this Asset.init()?");return}if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let n=t.manifest;typeof n=="string"&&(n=await this.load(n)),this.resolver.addManifest(n)}let e=t.texturePreference?.resolution??1,i=typeof e=="number"?[e]:e,s=await this._detectFormats({preferredFormats:t.texturePreference?.format,skipDetections:t.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:s,resolution:i}}),t.preferences&&this.setPreferences(t.preferences)}add(t,e,i,s,n){this.resolver.add(t,e,i,s,n)}async load(t,e){this._initialized||await this.init();let i=pr(t),s=Nt(t).map(a=>{if(typeof a!="string"){let h=this.resolver.getAlias(a);return h.some(l=>!this.resolver.hasKey(l))&&this.add(a),Array.isArray(h)?h[0]:h}return this.resolver.hasKey(a)||this.add({alias:a,src:a}),a}),n=this.resolver.resolve(s),o=await this._mapLoadToResolve(n,e);return i?o[s[0]]:o}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let i=!1;typeof t=="string"&&(i=!0,t=[t]);let s=this.resolver.resolveBundle(t),n={},o=Object.keys(s),a=0,h=0,l=()=>{e?.(++a/h)},c=o.map(u=>{let d=s[u];return h+=Object.keys(d).length,this._mapLoadToResolve(d,l).then(p=>{n[u]=p})});return await Promise.all(c),i?n[t[0]]:n}async backgroundLoad(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);let e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);let e=this.resolver.resolveBundle(t);Object.values(e).forEach(i=>{this._backgroundLoader.add(Object.values(i))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if(typeof t=="string")return Oe.get(t);let e={};for(let i=0;i<t.length;i++)e[i]=Oe.get(t[i]);return e}async _mapLoadToResolve(t,e){let i=Object.values(t),s=Object.keys(t);this._backgroundLoader.active=!1;let n=await this.loader.load(i,e);this._backgroundLoader.active=!0;let o={};return i.forEach((a,h)=>{let l=n[a.src],c=[a.src];a.alias&&c.push(...a.alias),o[s[h]]=l,Oe.set(c,l)}),o}async unload(t){this._initialized||await this.init();let e=Nt(t).map(s=>typeof s!="string"?s.src:s),i=this.resolver.resolve(e);await this._unloadFromResolved(i)}async unloadBundle(t){this._initialized||await this.init(),t=Nt(t);let e=this.resolver.resolveBundle(t),i=Object.keys(e).map(s=>this._unloadFromResolved(e[s]));await Promise.all(i)}async _unloadFromResolved(t){let e=Object.values(t);e.forEach(i=>{Oe.remove(i.src)}),await this.loader.unload(e)}async _detectFormats(t){let e=[];t.preferredFormats&&(e=Array.isArray(t.preferredFormats)?t.preferredFormats:[t.preferredFormats]);for(let i of t.detections)t.skipDetections||await i.test()?e=await i.add(e):t.skipDetections||(e=await i.remove(e));return e=e.filter((i,s)=>e.indexOf(i)===s),e}get detections(){return this._detections}get preferWorkers(){return fr.config.preferWorkers}set preferWorkers(t){M.deprecation("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:t})}setPreferences(t){this.loader.parsers.forEach(e=>{e.config&&Object.keys(e.config).filter(i=>i in t).forEach(i=>{e.config[i]=t[i]})})}},le=new pa;T.handleByList(w.LoadParser,le.loader.parsers).handleByList(w.ResolveParser,le.resolver.parsers).handleByList(w.CacheParser,le.cache.parsers).handleByList(w.DetectionParser,le.detections);var ac={extension:w.CacheParser,test:r=>Array.isArray(r)&&r.every(t=>t instanceof x),getCacheableAssets:(r,t)=>{let e={};return r.forEach(i=>{t.forEach((s,n)=>{e[i+(n===0?"":n+1)]=s})}),e}};T.add(ac);async function fa(r){if("Image"in globalThis)return new Promise(t=>{let e=new Image;e.onload=()=>{t(!0)},e.onerror=()=>{t(!1)},e.src=r});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{let t=await(await fetch(r)).blob();await createImageBitmap(t)}catch{return!1}return!0}return!1}var hc={extension:{type:w.DetectionParser,priority:1},test:async()=>fa("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async r=>[...r,"avif"],remove:async r=>r.filter(t=>t!=="avif")};T.add(hc);var lc={extension:{type:w.DetectionParser,priority:0},test:async()=>fa("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async r=>[...r,"webp"],remove:async r=>r.filter(t=>t!=="webp")};T.add(lc);var Wf=["png","jpg","jpeg"],cc={extension:{type:w.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async r=>[...r,...Wf],remove:async r=>r.filter(t=>!Wf.includes(t))};T.add(cc);var hx="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function fs(r){return hx?!1:document.createElement("video").canPlayType(r)!==""}var uc={extension:{type:w.DetectionParser,priority:0},test:async()=>fs("video/webm"),add:async r=>[...r,"webm"],remove:async r=>r.filter(t=>t!=="webm")};T.add(uc);var dc={extension:{type:w.DetectionParser,priority:0},test:async()=>fs("video/mp4"),add:async r=>[...r,"mp4","m4v"],remove:async r=>r.filter(t=>t!=="mp4"&&t!=="m4v")};T.add(dc);var pc={extension:{type:w.DetectionParser,priority:0},test:async()=>fs("video/ogg"),add:async r=>[...r,"ogv"],remove:async r=>r.filter(t=>t!=="ogv")};T.add(pc);var fc={extension:w.ResolveParser,test:fr.test,parse:r=>({resolution:parseFloat(S.RETINA_PREFIX.exec(r)?.[1]??"1"),format:M.path.extname(r).slice(1),src:r})};T.add(fc);var Xf=r=>{let t=r.src;return r?.alias?.[0]??M.path.basename(t,M.path.extname(t))},Yf={extension:w.Asset,detection:{test:async()=>!0,add:async r=>[...r,...ni.filter(t=>oi[t])],remove:async r=>r.filter(t=>r.includes(t))},loader:{extension:{type:[w.LoadParser],priority:It.High},test(r){let t=M.path.extname(r).slice(1);return!!oi[t]||Yl.some(e=>r.startsWith(`data:${e}`))},async load(r,t){let e=await new Promise((i,s)=>Te.from({...t.data,url:r,preload:!0,loaded(n,o){n?s(n):i(o),t.data?.loaded?.(n,o)}}));return Bt().add(Xf(t),e),e},async unload(r,t){Bt().remove(Xf(t))}}};T.add(Yf);var hU=Gf(new ha);var qf={engine_start_1:{start:0,end:1.8995918367346938,loop:!1},engine_start_2:{start:3,end:5,loop:!1},engine_start_3:{start:6,end:8,loop:!1},explosion_1:{start:9,end:11,loop:!1},explosion_2:{start:12,end:13.5,loop:!1},explosion_3:{start:15,end:17,loop:!1},explosion_4:{start:18,end:19.5,loop:!1},money_collect_2:{start:21,end:21.5,loop:!1},money_collect_3:{start:23,end:23.82,loop:!1},money_collect_4:{start:25,end:25.82,loop:!1},player_car_crash:{start:27,end:31,loop:!1},power_up_4:{start:32,end:33.5,loop:!1},power_up_5:{start:35,end:36.5,loop:!1},projectile:{start:38,end:38.5,loop:!1},rocket_spawn_1:{start:40,end:41.08335600907029,loop:!1},rocket_spawn_2:{start:43,end:44.08335600907029,loop:!1},rocket_spawn_3:{start:46,end:47.5,loop:!1},ui_click_1:{start:49,end:49.51,loop:!1},ui_menu_whoosh:{start:51,end:51.5,loop:!1},upgrade_3:{start:53,end:55.5,loop:!1}};var Se=class{active=!0;memorize=!1;bindings=[];prevParameters=[];dispatch(t){this.active&&(this.memorize&&this.prevParameters.push(t),this.bindings.slice().forEach(e=>e.execute(t)))}add(t,e){return this.addBinding(new ma(this,t,e,!1))}addOnce(t,e){return this.addBinding(new ma(this,t,e,!0))}addBinding(t){return this.bindings.push(t),this.memorize&&this.prevParameters.forEach(e=>t.execute(e)),t}remove(t){this.bindings=this.bindings.filter(e=>e!=t),t.destroy()}removeAll(){this.bindings.slice().forEach(t=>t.destroy()),this.bindings.length=0}},ma=class{active=!0;once=!1;callback;filter;signal;constructor(t,e,i=null,s=!1){this.signal=t,this.callback=e,this.filter=i,this.once=s}execute(t){if(!this.signal||!this.callback||!this.active||this.filter&&!this.filter(t))return;let e=this.callback;e(t),this.once&&this.detach()}detach(){this.signal&&this.signal.remove(this)}destroy(){this.signal=null,this.callback=null,this.filter=null}};var On=class{onChange=new Se;reasons=[];add(t){let e=this.isEmpty();this.reasons.push(t),e&&this.onChange.dispatch(!0)}remove(t){let e=this.isEmpty();this.reasons=this.reasons.filter(i=>i!==t),!e&&this.isEmpty()&&this.onChange.dispatch(!1)}isEmpty(){return this.reasons.length===0}};var ga=class{soundEnabled=!0;musicEnabled=!0;sound;music;musicTrack;musicContext;soundMuteReasons=new On;musicMuteReasons=new On;musicAvailable=!1;constructor(){this.sound=Te.from({url:"assets/sounds/sounds.mp3",sprites:qf}),this.music={calm:Te.from("assets/music/calm.mp3"),active:Te.from("assets/music/active.mp3")},this.musicContext="calm",this.musicTrack=this.music.calm,this.soundMuteReasons.onChange.add(t=>{this.sound.volume=t?0:1,this.soundEnabled=!t}),this.musicMuteReasons.onChange.add(t=>{Object.values(this.music).forEach(e=>e.volume=t?0:1),this.musicEnabled=!t})}init(t,e){this.setSoundEnabled(t,"UserAction"),this.setMusicEnabled(e,"UserAction")}playSound(t){this.sound.play(t)}stopMusic(){this.musicTrack.stop()}setMusicContext(t){this.musicContext!=t&&(this.musicContext=t,this.playMusic(t))}playMusic(t){this.musicTrack.stop(),this.music[t].play({loop:!0}),this.musicTrack=this.music[t]}getSoundEnabled(){return this.soundEnabled}setSoundEnabled(t,e){console.log(`Setting sound to ${t}, reason: ${e}`),t?this.soundMuteReasons.remove(e):this.soundMuteReasons.add(e)}getMusicEnabled(){return this.musicEnabled}setMusicEnabled(t,e){console.log(`Setting music to ${t}, reason: ${e}`),t?this.musicMuteReasons.remove(e):this.musicMuteReasons.add(e)}};var ya=class{ysdk;constructor(t){this.ysdk=t}async getLeaderboards(){return await this.ysdk.getLeaderboards()}async setPlayerEntry(t,e,i){if(!await this.ysdk.isAvailableMethod("leaderboards.setLeaderboardScore"))return;i&&await this.ysdk.getPlayer({scopes:!0});let o=(await this.ysdk.getLeaderboards()).setLeaderboardScore(t,e);return console.log("Score setting result",o),o}async getPlayerEntry(t){if(!await this.ysdk.isAvailableMethod("leaderboards.getLeaderboardPlayerEntry")){console.log("leaderboards.getLeaderboardPlayerEntry method not available");return}return await(await this.ysdk.getLeaderboards()).getLeaderboardPlayerEntry(t)}async getLeaderboardEntries(t,e){return await(await this.ysdk.getLeaderboards()).getLeaderboardEntries(t,{quantityTop:e,includeUser:!0,quantityAround:1})}};var Kf="car-shooter",Zf={music:!0,sounds:!0,money:0,reputation:0,selectedCar:0,cars:[{id:0,unlocked:!0,upgrades:{armor:0,damage:0,guns:0}},{id:1,unlocked:!1,upgrades:{armor:0,damage:0,guns:0}},{id:2,unlocked:!1,upgrades:{armor:0,damage:0,guns:0}}]},ba=class{data;constructor(){this.data=this.loadLocal()}loadLocal(){let t=localStorage.getItem(Kf);return t?JSON.parse(t):Object.assign({},Zf)}reset(){this.data=Object.assign({},Zf),this.saveLocal()}saveLocal(){localStorage.setItem(Kf,JSON.stringify(this.data))}upgradeCar(t,e){this.data.cars[t].upgrades[e]++,this.saveLocal()}getCarUpgrades(t){return this.data.cars[t||this.data.selectedCar].upgrades}getCarUpgrade(t,e){return this.data.cars[e||this.data.selectedCar].upgrades[t]}};var Nn=new X,cx=new Uint16Array([0,1,2,0,2,3]),E=class r extends A{constructor(t){super(),this._anchor=new Fe(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new J(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=D.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||x.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=cx,this.pluginName="batch",this.isSprite=!0,this._roundPixels=S.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=M.sign(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=M.sign(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){let t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;let e=this.transform.worldTransform,i=e.a,s=e.b,n=e.c,o=e.d,a=e.tx,h=e.ty,l=this.vertexData,c=t.trim,u=t.orig,d=this._anchor,p=0,f=0,m=0,b=0;if(c?(f=c.x-d._x*u.width,p=f+c.width,b=c.y-d._y*u.height,m=b+c.height):(f=-d._x*u.width,p=f+u.width,b=-d._y*u.height,m=b+u.height),l[0]=i*f+n*b+a,l[1]=o*b+s*f+h,l[2]=i*p+n*b+a,l[3]=o*b+s*p+h,l[4]=i*p+n*m+a,l[5]=o*m+s*p+h,l[6]=i*f+n*m+a,l[7]=o*m+s*f+h,this._roundPixels){let y=S.RESOLUTION;for(let v=0;v<l.length;++v)l[v]=Math.round(l[v]*y)/y}}calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;let t=this._texture,e=this.vertexTrimmedData,i=t.orig,s=this._anchor,n=this.transform.worldTransform,o=n.a,a=n.b,h=n.c,l=n.d,c=n.tx,u=n.ty,d=-s._x*i.width,p=d+i.width,f=-s._y*i.height,m=f+i.height;if(e[0]=o*d+h*f+c,e[1]=l*f+a*d+u,e[2]=o*p+h*f+c,e[3]=l*f+a*p+u,e[4]=o*p+h*m+c,e[5]=l*m+a*p+u,e[6]=o*d+h*m+c,e[7]=l*m+a*d+u,this._roundPixels){let b=S.RESOLUTION;for(let y=0;y<e.length;++y)e[y]=Math.round(e[y]*b)/b}}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){let t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return this.children.length===0?(this._localBounds||(this._localBounds=new We),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new H),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,Nn);let e=this._texture.orig.width,i=this._texture.orig.height,s=-e*this.anchor.x,n=0;return Nn.x>=s&&Nn.x<s+e&&(n=-i*this.anchor.y,Nn.y>=n&&Nn.y<n+i)}destroy(t){if(super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof t=="boolean"?t:t?.texture){let e=typeof t=="boolean"?t:t?.baseTexture;this._texture.destroy(!!e)}this._texture=null}static from(t,e){let i=t instanceof x?t:x.from(t,e);return new r(i)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1,this._transformTrimmedID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){let e=M.sign(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){let e=M.sign(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||x.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}};var Dn;typeof self>"u"&&typeof process<"u"&&process.hrtime?Dn=function(){let r=process.hrtime();return r[0]*1e3+r[1]/1e6}:typeof self<"u"&&self.performance!==void 0&&self.performance.now!==void 0?Dn=self.performance.now.bind(self.performance):Date.now!==void 0?Dn=Date.now:Dn=function(){return new Date().getTime()};var li=class r{constructor(){r.prototype.__init.call(this),r.prototype.__init2.call(this),r.prototype.__init3.call(this),r.prototype.__init4.call(this)}__init(){this._tweens={}}static get shared(){return r._shared||(r._shared=new r),r._shared}__init2(){this._paused=!1}isPaused(){return this._paused}pause(){this._paused=!0}resume(){this._paused=!1}__init3(){this._lastUpdateTime=void 0}__init4(){this.now=Dn}getAll(){return Object.keys(this._tweens).map(t=>this._tweens[t])}removeAll(){this._tweens={}}add(t){this._tweens[t.getId()]=t}remove(t){delete this._tweens[t.getId()]}update(t,e=!1){if(t==null&&(this._lastUpdateTime==null?(this._lastUpdateTime=this.now(),t=0):t=this.now()-this._lastUpdateTime),this._lastUpdateTime=this.now(),this._paused)return!1;let i=Object.keys(this._tweens);if(i.length==0)return!1;for(let s=0;s<i.length;s++){let n=this._tweens[i[s]];n&&n.update(t,!0)==!1&&!e&&delete this._tweens[i[s]]}return!0}},it={Step:{None(r){return r<.5?0:1}},Linear:{None(r){return r}},Quadratic:{In(r){return r*r},Out(r){return r*(2-r)},InOut(r){return(r*=2)<1?.5*r*r:-.5*(--r*(r-2)-1)}},Cubic:{In(r){return r*r*r},Out(r){return--r*r*r+1},InOut(r){return(r*=2)<1?.5*r*r*r:.5*((r-=2)*r*r+2)}},Quartic:{In(r){return r*r*r*r},Out(r){return 1- --r*r*r*r},InOut(r){return(r*=2)<1?.5*r*r*r*r:-.5*((r-=2)*r*r*r-2)}},Quintic:{In(r){return r*r*r*r*r},Out(r){return--r*r*r*r*r+1},InOut(r){return(r*=2)<1?.5*r*r*r*r*r:.5*((r-=2)*r*r*r*r+2)}},Sinusoidal:{In(r){return 1-Math.cos(r*Math.PI/2)},Out(r){return Math.sin(r*Math.PI/2)},InOut(r){return .5*(1-Math.cos(Math.PI*r))}},Exponential:{In(r){return r==0?0:Math.pow(1024,r-1)},Out(r){return r==1?1:1-Math.pow(2,-10*r)},InOut(r){return r==0?0:r==1?1:(r*=2)<1?.5*Math.pow(1024,r-1):.5*(-Math.pow(2,-10*(r-1))+2)}},Circular:{In(r){return 1-Math.sqrt(1-r*r)},Out(r){return Math.sqrt(1- --r*r)},InOut(r){return(r*=2)<1?-.5*(Math.sqrt(1-r*r)-1):.5*(Math.sqrt(1-(r-=2)*r)+1)}},Elastic:{In(r){return r==0?0:r==1?1:-Math.pow(2,10*(r-1))*Math.sin((r-1.1)*5*Math.PI)},Out(r){return r==0?0:r==1?1:Math.pow(2,-10*r)*Math.sin((r-.1)*5*Math.PI)+1},InOut(r){return r==0?0:r==1?1:(r*=2,r<1?-.5*Math.pow(2,10*(r-1))*Math.sin((r-1.1)*5*Math.PI):.5*Math.pow(2,-10*(r-1))*Math.sin((r-1.1)*5*Math.PI)+1)}},Back:{In(r){return r*r*((1.70158+1)*r-1.70158)},Out(r){return--r*r*((1.70158+1)*r+1.70158)+1},InOut(r){let t=2.5949095;return(r*=2)<1?.5*(r*r*((t+1)*r-t)):.5*((r-=2)*r*((t+1)*r+t)+2)}},Bounce:{In(r){return 1-it.Bounce.Out(1-r)},Out(r){return r<1/2.75?7.5625*r*r:r<2/2.75?7.5625*(r-=1.5/2.75)*r+.75:r<2.5/2.75?7.5625*(r-=2.25/2.75)*r+.9375:7.5625*(r-=2.625/2.75)*r+.984375},InOut(r){return r<.5?it.Bounce.In(r*2)*.5:it.Bounce.Out(r*2-1)*.5+.5}}},Y={Geom:{Linear(r,t){let e=r.length-1,i=e*t,s=Math.floor(i),n=Y.Utils.Linear;return t<0?n(r[0],r[1],i):t>1?n(r[e],r[e-1],e-i):n(r[s],r[s+1>e?e:s+1],i-s)},Bezier(r,t){let e=0,i=r.length-1,s=Math.pow,n=Y.Utils.Bernstein;for(let o=0;o<=i;o++)e+=n(i,o)*s(1-t,i-o)*s(t,o)*r[o];return e},QuadraticBezier(r,t){let e=0,i=r.length-1;if(t==1)return r[i];let s=Math.pow,n=Y.Utils.Bernstein,o=i*t,a=Math.floor(o),h=(o-a)*.5+.5*(a%2),l=a-a%2,c=l+1,u=l+2;return e+=n(2,0)*s(1-h,2)*s(h,0)*r[l],e+=n(2,1)*s(1-h,1)*s(h,1)*r[c],e+=n(2,2)*s(1-h,0)*s(h,2)*r[u],e},CubicBezier(r,t){let e=0,i=r.length-1;if(t==1)return r[i];let s=Math.pow,n=Y.Utils.Bernstein,o=i*t,a=Math.floor(o),h=(o-a)*(1/3)+1/3*(a%3),l=a-a%3,c=l+1,u=l+2,d=l+3;return e+=n(3,0)*s(1-h,3)*s(h,0)*r[l],e+=n(3,1)*s(1-h,2)*s(h,1)*r[c],e+=n(3,2)*s(1-h,1)*s(h,2)*r[u],e+=n(3,3)*s(1-h,0)*s(h,3)*r[d],e},CatmullRom(r,t){let e=r.length-1,i=e*t,s=Math.floor(i),n=Y.Utils.CatmullRom;return r[0]==r[e]?(t<0&&(s=Math.floor(i=e*(1+t))),n(r[(s-1+e)%e],r[s],r[(s+1)%e],r[(s+2)%e],i-s)):t<0?r[0]-(n(r[0],r[0],r[1],r[1],-i)-r[0]):t>1?r[e]-(n(r[e],r[e],r[e-1],r[e-1],i-e)-r[e]):n(r[s?s-1:0],r[s],r[e<s+1?e:s+1],r[e<s+2?e:s+2],i-s)}},Angle:{Radians(r,t){let e=r.length-1,i=e*t,s=Math.floor(i),n=Y.Utils.WrapLinear;return t<0?n(r[0],r[1],i,2*Math.PI):t>1?n(r[e],r[e-1],e-i,2*Math.PI):n(r[s],r[s+1>e?e:s+1],i-s,2*Math.PI)},Degrees(r,t){let e=r.length-1,i=e*t,s=Math.floor(i),n=Y.Utils.WrapLinear;return t<0?n(r[0],r[1],i,360):t>1?n(r[e],r[e-1],e-i,360):n(r[s],r[s+1>e?e:s+1],i-s,360)}},Color:{RGB(r,t){let e=r.length-1,i=e*t,s=Math.floor(i),n=Y.Utils.RGBLinear;return t<0?n(r[0],r[1],i):t>1?n(r[e],r[e-1],e-i):n(r[s],r[s+1>e?e:s+1],i-s)},HSV(r,t){let e=r.length-1,i=e*t,s=Math.floor(i),n=Y.Utils.HSVLinear;return t<0?n(r[0],r[1],i):t>1?n(r[e],r[e-1],e-i):n(r[s],r[s+1>e?e:s+1],i-s)},HCL(r,t){let e=r.length-1,i=e*t,s=Math.floor(i),n=Y.Utils.HCLLinear;return t<0?n(r[0],r[1],i):t>1?n(r[e],r[e-1],e-i):n(r[s],r[s+1>e?e:s+1],i-s)}},Utils:{RGBsplit(r){let t=r>>24&255,e=r>>16&255,i=r>>8&255,s=r&255;return{a:t,r:e,g:i,b:s}},HSVsplit(r){let t=Y.Utils.RGBsplit(r);t.r/=255,t.g/=255,t.b/=255;let e=Math.max(t.r,t.g,t.b),i=Math.min(t.r,t.g,t.b),s,n=e,o=e-i,a=e==0?0:o/e;if(e==i)s=0;else{switch(e){case t.r:s=(t.g-t.b)/o+(t.g<t.b?6:0);break;case t.g:s=(t.b-t.r)/o+2;break;case t.b:s=(t.r-t.g)/o+4;break}s/=6}return{a:t.a,h:s,s:a,v:n}},HSVJoin(r){let t,e,i,s=Math.floor(r.h*6),n=r.h*6-s,o=r.v*(1-r.s),a=r.v*(1-n*r.s),h=r.v*(1-(1-n)*r.s);switch(s%6){case 0:t=r.v,e=h,i=o;break;case 1:t=a,e=r.v,i=o;break;case 2:t=o,e=r.v,i=h;break;case 3:t=o,e=a,i=r.v;break;case 4:t=h,e=o,i=r.v;break;case 5:t=r.v,e=o,i=a;break}return r.a<<24|t<<16|e<<8|i},HCLSplit(r){let i=.530454533953517,s=Y.Utils.RGBsplit(r),n={a:s.a,h:0,c:0,l:0},o=0,a=Math.min(s.r,Math.min(s.g,s.b)),h=Math.max(s.r,Math.max(s.g,s.b)),l=3/100;return n.c=h-a,n.c!=0&&(o=Math.atan2(s.g-s.b,s.r-s.g)/Math.PI,l*=a/h),l=Math.exp(l),n.h=(o/2-Math.min(o%1,-o%1)/6)%1,n.c*=l,n.l=Y.Utils.Linear(-a,h,l)/(i*2),n},HCLJoin(r){let i=.530454533953517,s={a:r.a,r:0,g:0,b:0};if(r.l!=0){let n=r.h,o=r.c,a=r.l*i,h=Math.exp((1-o/(2*a))*(3/100)),l=(2*a-o)/(2*h-1),c=o/h,u=(n+Math.min(2*n%1/4,-2*n%1/8))*Math.PI*2,d;n*=6,n<=.999?(d=Math.tan(u),s.r=1,s.g=d/(1+d)):n<=1.001?(s.r=1,s.g=1):n<=2?(d=Math.tan(u),s.r=(1+d)/d,s.g=1):n<=3?(d=Math.tan(u),s.g=1,s.b=1+d):n<=3.999?(d=Math.tan(u),s.g=1/(1+d),s.b=1):n<=4.001?(s.g=0,s.b=1):n<=5?(d=Math.tan(u),s.r=-1/d,s.b=1):(d=Math.tan(u),s.r=1,s.b=-d),s.r=s.r*c+l,s.g=s.g*c+l,s.b=s.b*c+l}return s.a<<24|s.r<<16|s.g<<8|s.b},WrapLinear(r,t,e,i){let s;return r=(r+i*Math.trunc(Math.abs(r/i)))%i,t=(t+i*Math.trunc(Math.abs(t/i)))%i,Math.abs(r-t)<=.5*i?s=Y.Utils.Linear(r,t,e):(r<t?s=Y.Utils.Linear(r+i,t,e):s=Y.Utils.Linear(r,t+i,e),s=s%i),s},RGBLinear(r,t,e){let i=Y.Utils.RGBsplit(r),s=Y.Utils.RGBsplit(t),n=Y.Utils.Linear(i.a,s.a,e),o=Y.Utils.Linear(i.r,s.r,e),a=Y.Utils.Linear(i.g,s.g,e),h=Y.Utils.Linear(i.b,s.b,e);return n<<24|o<<16|a<<8|h},HSVLinear(r,t,e){let i=Y.Utils.HSVsplit(r),s=Y.Utils.HSVsplit(t),n;Math.abs(i.h-s.h)<=.5?n=Y.Utils.Linear(i.h,s.h,e):(i.h<s.h?n=Y.Utils.Linear(i.h+1,s.h,e):n=Y.Utils.Linear(i.h,s.h+1,e),n=n%1);let o=Y.Utils.Linear(i.s,s.s,e),a=Y.Utils.Linear(i.v,s.v,e),h=Y.Utils.Linear(i.a,s.a,e);return Y.Utils.HSVJoin({a:h,h:n,s:o,v:a})},HCLLinear(r,t,e){let i=Y.Utils.HCLSplit(r),s=Y.Utils.HCLSplit(t),n;Math.abs(i.h-s.h)<=.5?n=Y.Utils.Linear(i.h,s.h,e):(i.h<s.h?n=Y.Utils.Linear(i.h+1,s.h,e):n=Y.Utils.Linear(i.h,s.h+1,e),n=n%1);let o=Y.Utils.Linear(i.c,s.c,e),a=Y.Utils.Linear(i.l,s.l,e),h=Y.Utils.Linear(i.a,s.a,e);return Y.Utils.HSVJoin({a:h,h:n,s:o,v:a})},Linear(r,t,e){return(t-r)*e+r},Bernstein(r,t){let e=Y.Utils.Factorial;return e(r)/e(t)/e(r-t)},Factorial:function(){let r=[1];return function(t){let e=1;if(r[t])return r[t];for(let i=t;i>1;i--)e*=i;return r[t]=e,e}}(),CatmullRom(r,t,e,i,s){let n=(e-r)*.5,o=(i-t)*.5,a=s*s,h=s*a;return(2*t-2*e+n+o)*h+(-3*t+3*e-2*n-o)*a+n*s+t}}},xa=class r{static __initStatic(){this._nextId=0}static nextId(){return r._nextId++}};xa.__initStatic();var _a={safetyCheckFunction:r=>!0,easingFunction:it.Linear.None,yoyoEasingFunction:void 0,interpolationFunction:Y.Geom.Linear},st=class r{__init(){this._isPaused=!1}__init2(){this._valuesStart={}}__init3(){this._valuesEnd={}}__init4(){this._valuesStartRepeat={}}__init5(){this._duration=0}__init6(){this._repeatCount=0}__init7(){this._repeat=0}__init8(){this._yoyo=!1}__init9(){this._isPlaying=!1}get _reversed(){return this.yoyo&&this._repeatCount%2!==0}__init10(){this._delayTime=0}__init11(){this._startTime=0}__init12(){this._elapsedTime=0}__init13(){this._timescale=1}__init14(){this._safetyCheckFunction=_a.safetyCheckFunction}__init15(){this._easingFunction=_a.easingFunction}__init16(){this._yoyoEasingFunction=_a.yoyoEasingFunction}__init17(){this._interpolationFunction=_a.interpolationFunction}__init18(){this._chainedTweens=[]}__init19(){this._onStartCallbackFired=!1}__init20(){this._onAfterDelayCallbackFired=!1}__init21(){this._id=xa.nextId()}__init22(){this._isChainStopped=!1}get _group(){return this._groupRef?this._groupRef:li.shared}set _group(t){this._groupRef=t}constructor(t,e){r.prototype.__init.call(this),r.prototype.__init2.call(this),r.prototype.__init3.call(this),r.prototype.__init4.call(this),r.prototype.__init5.call(this),r.prototype.__init6.call(this),r.prototype.__init7.call(this),r.prototype.__init8.call(this),r.prototype.__init9.call(this),r.prototype.__init10.call(this),r.prototype.__init11.call(this),r.prototype.__init12.call(this),r.prototype.__init13.call(this),r.prototype.__init14.call(this),r.prototype.__init15.call(this),r.prototype.__init16.call(this),r.prototype.__init17.call(this),r.prototype.__init18.call(this),r.prototype.__init19.call(this),r.prototype.__init20.call(this),r.prototype.__init21.call(this),r.prototype.__init22.call(this),this._object=t,this._group=e}getId(){return this._id}getGroup(){return this._group}getTimescale(){return this._timescale}isPlaying(){return this._isPlaying}isPaused(){return this._isPaused}from(t){try{JSON.stringify(t)}catch{throw new Error("The object you provided to the from() method has a circular reference!")}return this._setupProperties(t,this._valuesStart,t,this._valuesStartRepeat,!0),this}to(t,e){try{this._valuesEnd=JSON.parse(JSON.stringify(t))}catch{return console.warn("The object you provided to the to() method has a circular reference!. It can't be cloned. Falling back to dynamic targeting"),this.dynamicTo(t,e)}return e!==void 0&&(this._duration=e),this}dynamicTo(t,e){return this._valuesEnd=t,e!==void 0&&(this._duration=e),this}duration(t){return this._duration=t,this}start(t){return this._isPlaying?this:(t!=null&&(this._delayTime=t),this._group.add(this),this._reversed&&(this._swapEndStartRepeatValues(this._valuesStartRepeat,this._valuesEnd),this._valuesStart=JSON.parse(JSON.stringify(this._valuesStartRepeat))),this._repeatCount=0,this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onAfterDelayCallbackFired=!1,this._isChainStopped=!1,this._startTime=-this._delayTime,this._elapsedTime=0,this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,!1),this)}restart(t){return this.reset(),this.start(t)}reset(){return this._isPlaying&&this.stop(),this._valuesStart={},this._valuesStartRepeat={},this}rewind(){this._isPlaying&&this.stop(),this._reversed&&this._swapEndStartRepeatValues(this._valuesStartRepeat,this._valuesEnd);let t=this._easingFunction(0);return this._updateProperties(this._object,this._valuesStart,this._valuesEnd,t),this}_setupProperties(t,e,i,s,n){for(let o in i){let a=t[o],h=Array.isArray(a),l=!Number.isNaN(Number(a)),c=h?"array":typeof a,u=c=="object",d=typeof i[o]=="object",p=!h&&Array.isArray(i[o]);c=="undefined"||c=="function"||i[o]==null||!h&&!l&&!u||((u||h||d)&&a&&!p?(typeof e[o]>"u"&&(e[o]=h?[]:{}),typeof s[o]>"u"&&(s[o]=h?[]:{}),this._setupProperties(a,e[o],i[o],s[o],n)):((typeof e[o]>"u"||n)&&(e[o]=a),(typeof s[o]>"u"||n)&&(p?s[o]=i[o].slice().reverse()[0]:s[o]=e[o]||0)))}}stop(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object,this),this):this}end(t=!1){let e=[];if(t||(e=this._chainedTweens,this._chainedTweens=[]),this.resume(),this.update(1/0),!t){this._chainedTweens=e;for(let i=0,s=this._chainedTweens.length;i<s;i++)this._chainedTweens[i].start()}return this}skip(t,e=!1){return this.resume(),this.update(t*this._duration-(e?this._elapsedTime:0)),this}pause(){return this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._group.remove(this),this)}resume(){return!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._group.add(this),this)}stopChainedTweens(){for(let t=0,e=this._chainedTweens.length;t<e;t++)this._chainedTweens[t].stop();return this}startChainedTweens(t=!1){t&&this.stop();for(let e=0,i=this._chainedTweens.length;e<i;e++)this._chainedTweens[e].start();return this}group(t){return this._group=t,this}delay(t){return this._delayTime=t,this}timescale(t){return this._timescale=t,this}repeat(t=1/0){return this._repeat=t,this}repeatDelay(t){return this._repeatDelayTime=t,this}yoyo(t=!0){return this._yoyo=t,this}easing(t){return this._easingFunction=t,this}safetyCheck(t){return this._safetyCheckFunction=t,this}yoyoEasing(t){return this._yoyoEasingFunction=t,this}interpolation(t){return this._interpolationFunction=t,this}chain(...t){return this._chainedTweens=t,this}onStart(t){return this._onStartCallback=t,this}onAfterDelay(t){return this._onAfterDelayCallback=t,this}onUpdate(t){return this._onUpdateCallback=t,this}onRepeat(t){return this._onRepeatCallback=t,this}onComplete(t){return this._onCompleteCallback=t,this}onStop(t){return this._onStopCallback=t,this}update(t,e=!1){let i=this._internalUpdate(t);return!i&&!e&&this._group.remove(this),i}_internalUpdate(t){if(!this._safetyCheckFunction(this._object)||this._isPaused)return!1;t*=this._timescale;let e;this._elapsedTime+=t;let i=this._duration,s=this._startTime+this._elapsedTime;if(s>i&&!this._isPlaying)return!1;this.isPlaying||this.start(),this._onStartCallbackFired==!1&&(this._onStartCallback&&this._onStartCallback(this._object,this),this._onStartCallbackFired=!0),this._onAfterDelayCallbackFired==!1&&s>=0&&(this._onAfterDelayCallback&&this._onAfterDelayCallback(this._object,this),this._onAfterDelayCallbackFired=!0),e=s/this._duration,this._duration==0&&(s>=0?e=1:e=0),e=Math.min(1,e),e=Math.max(0,e);let n=Number.isFinite(s)?s%this._duration:s;Number.isNaN(n)&&(n=0);let o=Math.floor(s/this._duration),a;if(this._reversed&&this._yoyoEasingFunction?a=this._yoyoEasingFunction(e):a=this._easingFunction(e),this._updateProperties(this._object,this._valuesStart,this._valuesEnd,a),this._onUpdateCallback&&(e!=1||this._repeat-this._repeatCount<=0)&&this._onUpdateCallback(this._object,e,this),e==1){if(this._repeat-this._repeatCount>0){let h=this._repeatCount;if(this._repeatCount=Math.min(this._repeat+1,this._repeatCount+o),this._onUpdateCallback&&(this._repeat-this._repeatCount<0||n<=0)&&this._onUpdateCallback(this._object,e,this),this._yoyo?this._swapEndStartRepeatValues(this._valuesStartRepeat,this._valuesEnd):this._moveForwardStartRepeatValues(this._valuesStartRepeat,this._valuesEnd),this._valuesStart=JSON.parse(JSON.stringify(this._valuesStartRepeat)),this._repeatDelayTime!==void 0?this._startTime=-this._repeatDelayTime:this._startTime=0,this._onRepeatCallback){let l=1;Number.isFinite(o)?l=this._repeatCount-h:Number.isFinite(this._repeat)&&(l=this._repeat-h);for(let c=0;c<l;c++)this._onRepeatCallback(this._object,h+1+c,this)}if(this._elapsedTime=0,this._repeat-this._repeatCount>=0)return n>0&&Number.isFinite(this._repeat)&&this._internalUpdate(n),!0}this._onCompleteCallback&&this._onCompleteCallback(this._object,this);for(let h=0,l=this._chainedTweens.length;h<l;h++)this._chainedTweens[h].start(),n>0&&this._chainedTweens[h].update(n);return this._isPlaying=!1,!1}return!0}_updateProperties(t,e,i,s){for(let n in i){if(e[n]==null)continue;let o=e[n],a=i[n],h=Array.isArray(t[n]),l=Array.isArray(a);!h&&l?this._reversed?t[n]=this._interpolationFunction(a.concat([o]),s):t[n]=this._interpolationFunction([o].concat(a),s):typeof a=="object"&&a?this._updateProperties(t[n],o,a,s):(a=this._handleRelativeValue(o,a),typeof a=="number"&&(typeof o=="number"||typeof o=="string")&&(t[n]=Number(o)+(a-Number(o))*s,typeof o=="string"&&(t[n]=String(t[n]))))}}_handleRelativeValue(t,e){return typeof e!="string"?e:e.charAt(0)=="+"||e.charAt(0)=="-"?t+Number(e):Number(e)}_swapEndStartRepeatValues(t,e){for(let i in t){let s=!Array.isArray(t[i])&&Array.isArray(e[i]);if(typeof t[i]=="object")this._swapEndStartRepeatValues(t[i],e[i]);else{let n=t[i];if(typeof e[i]=="string")t[i]=Number(t[i])+Number(e[i]),e[i]=n;else if(s){let o=e[i].slice().reverse();t[i]=o[0],e[i]=o}else t[i]=e[i],e[i]=n}}}_moveForwardStartRepeatValues(t,e){for(let i in t)typeof e[i]=="object"?this._moveForwardStartRepeatValues(t[i],e[i]):typeof e[i]=="string"&&(t[i]=Number(t[i])+Number(e[i]))}};var ci=class r extends E{constructor(t,e=!0){super(t[0]instanceof x?t[0]:t[0].texture),this._textures=null,this._durations=null,this._autoUpdate=e,this._isConnectedToTicker=!1,this.animationSpeed=1,this.loop=!0,this.updateAnchor=!1,this.onComplete=null,this.onFrameChange=null,this.onLoop=null,this._currentTime=0,this._playing=!1,this._previousFrame=null,this.textures=t}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(lt.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(lt.shared.add(this.update,this,Le.HIGH),this._isConnectedToTicker=!0))}gotoAndStop(t){this.stop(),this.currentFrame=t}gotoAndPlay(t){this.currentFrame=t,this.play()}update(t){if(!this._playing)return;let e=this.animationSpeed*t,i=this.currentFrame;if(this._durations!==null){let s=this._currentTime%1*this._durations[this.currentFrame];for(s+=e/60*1e3;s<0;)this._currentTime--,s+=this._durations[this.currentFrame];let n=Math.sign(this.animationSpeed*t);for(this._currentTime=Math.floor(this._currentTime);s>=this._durations[this.currentFrame];)s-=this._durations[this.currentFrame]*n,this._currentTime+=n;this._currentTime+=s/this._durations[this.currentFrame]}else this._currentTime+=e;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):i!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<i||this.animationSpeed<0&&this.currentFrame>i)&&this.onLoop(),this.updateTexture())}updateTexture(){let t=this.currentFrame;this._previousFrame!==t&&(this._previousFrame=t,this._texture=this._textures[t],this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this.uvs=this._texture._uvs.uvsFloat32,this.updateAnchor&&this._anchor.copyFrom(this._texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))}destroy(t){this.stop(),super.destroy(t),this.onComplete=null,this.onFrameChange=null,this.onLoop=null}static fromFrames(t){let e=[];for(let i=0;i<t.length;++i)e.push(x.from(t[i]));return new r(e)}static fromImages(t){let e=[];for(let i=0;i<t.length;++i)e.push(x.from(t[i]));return new r(e)}get totalFrames(){return this._textures.length}get textures(){return this._textures}set textures(t){if(t[0]instanceof x)this._textures=t,this._durations=null;else{this._textures=[],this._durations=[];for(let e=0;e<t.length;e++)this._textures.push(t[e].texture),this._durations.push(t[e].time)}this._previousFrame=null,this.gotoAndStop(0),this.updateTexture()}get currentFrame(){let t=Math.floor(this._currentTime)%this._textures.length;return t<0&&(t+=this._textures.length),t}set currentFrame(t){if(t<0||t>this.totalFrames-1)throw new Error(`[AnimatedSprite]: Invalid frame index value ${t}, expected to be between 0 and totalFrames ${this.totalFrames}.`);let e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this.updateTexture()}get playing(){return this._playing}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(lt.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(lt.shared.add(this.update,this),this._isConnectedToTicker=!0))}};var ux={scale:1,speed:1,alpha:1,loop:!1},va=class extends ci{config;constructor(t,e){super(le.get(t).animations.main),this.config=Object.assign({},ux,e),this.anchor.set(.5),this.scale.set(this.config.scale),this.alpha=this.config.alpha,this.animationSpeed=this.config.speed,this.loop=this.config.loop,this.play()}static getSheetData(t,e,i,s,n){let o={frames:{},animations:{main:[]},meta:{image:`${t}.png`,format:"RGBA8888",size:{w:e,h:i},scale:"1"}},a=0,h=0,l=Math.floor(o.meta.size.w/s),c=Math.floor(o.meta.size.h/n);for(let u=0;u<n;u++)for(let d=0;d<s;d++){a=d*l,h=u*c;let p=`frame_${d+u*s}`;o.frames[p]={frame:{x:a,y:h,w:l,h:c}},o.animations.main.push(p)}return o}};var Br=class extends A{halfWidth=.5;roadX=0;lane;body;health=100;constructor(){super(),this.scale.set(.8)}};var Lt=class{inactiveInstances=[];activeInstances=[];createFunction;resetFunction;destroyFunction;constructor(t,e,i){this.createFunction=t,this.resetFunction=e,this.destroyFunction=i}getInstance(){let t=this.inactiveInstances.pop()||this.createFunction();return this.activeInstances.push(t),this.resetFunction(t),t}release(t){t.parent&&t.parent.removeChild(t),this.activeInstances=this.activeInstances.filter(e=>e!=t),this.inactiveInstances.push(t)}destroy(){[...this.activeInstances,...this.inactiveInstances].forEach(t=>this.destroyFunction(t))}};var dx={firePeriodMS:300,projectileSpeed:1},ce=class{lastFiredMS;config;onFire=new Se;projectiles;body;flashes;flashTween;canFire=!1;constructor(t,e){this.config=Object.assign({},dx,t||{}),this.body=new E,this.projectiles=e,this.flashes=new A,this.lastFiredMS=this.config.firePeriodMS,this.flashTween=new st(this.flashes),this.flashes.alpha=0}update(t){this.canFire&&(this.lastFiredMS+=t,this.lastFiredMS>this.config.firePeriodMS&&(this.lastFiredMS-=this.config.firePeriodMS,this.fire())),this.projectiles.activeInstances.forEach(e=>{this.updateProjectile(e,t)})}fire(){this.flashes.alpha=1,this.flashTween.to({alpha:0},200).easing(it.Sinusoidal.Out).start()}updateProjectile(t,e){t.y+=this.config.projectileSpeed*Math.sin(t.rotation-Math.PI/2)*e,t.x+=this.config.projectileSpeed*Math.cos(t.rotation-Math.PI/2)*e,(t.y>C.height||t.y<t.height)&&this.projectiles.release(t)}addMuzzleFlash(t,e){let i=new E(t);i.anchor.set(.5),this.flashes.addChild(i),i.position.copyFrom(e)}getProjectileDamage(){return 10}static resetProjectile(t){t.rotation=0}static destroyProjectile(t){t.destroy()}};var Ye=[{gun:"Weapon-1-Yellow",flash:"Fire-Exit-1-Yellow",projectile:"Fire-1-Yellow",projectileCount:1},{gun:"Weapon-1-Green",flash:"Fire-Exit-1-Green",projectile:"Fire-1-Green",projectileCount:1},{gun:"Weapon-1-Blue",flash:"Fire-Exit-1-Blue",projectile:"Fire-1-Blue",projectileCount:1},{gun:"Weapon-2-Yellow",flash:"Fire-Exit-1-Yellow",projectile:"Fire-1-Yellow",projectileCount:2},{gun:"Weapon-2-Green",flash:"Fire-Exit-1-Green",projectile:"Fire-1-Green",projectileCount:2},{gun:"Weapon-2-Blue",flash:"Fire-Exit-1-Blue",projectile:"Fire-1-Blue",projectileCount:2},{gun:"Weapon-2-Pink",flash:"Fire-Exit-1-Pink",projectile:"Fire-1-Pink",projectileCount:2},{gun:"Weapon-3-Standart",flash:"Fire-Exit-3-Yellow",projectile:"Fire-1-Yellow",projectileCount:3},{gun:"Weapon-3-Standart",flash:"Fire-Exit-3-Green",projectile:"Fire-1-Green",projectileCount:3},{gun:"Weapon-3-Standart",flash:"Fire-Exit-3-Blue",projectile:"Fire-1-Blue",projectileCount:3},{gun:"Weapon-3-Standart",flash:"Fire-Exit-3-Pink",projectile:"Fire-1-Pink",projectileCount:3}],ms=class r extends ce{level;constructor(t,e=1){super(t||{},new Lt(()=>r.createProjectile(e),ce.resetProjectile,ce.destroyProjectile)),this.level=e,this.body.texture=x.from(Ye[this.level].gun),this.body.anchor.set(.5,.85),this.body.scale.set(.5),this.upgrade(this.level)}fire(){if(super.fire(),this.level<3){let t=this.projectiles.getInstance();t.position.set(0,-65),this.onFire.dispatch([t])}else if(this.level<7){let t=this.projectiles.getInstance(),e=this.projectiles.getInstance();t.position.set(-14,-65),e.position.set(14,-65),this.onFire.dispatch([t,e])}else{let t=this.projectiles.getInstance(),e=this.projectiles.getInstance(),i=this.projectiles.getInstance();t.position.set(-14,-60),e.position.set(0,-65),i.position.set(14,-60),this.onFire.dispatch([t,e,i])}}setupMuzzleFlash(t){this.flashes.removeChildren(),t<3?this.addMuzzleFlash(x.from(Ye[t].flash),{x:0,y:-125}):t<7?(this.addMuzzleFlash(x.from(Ye[t].flash),{x:-16,y:-120}),this.addMuzzleFlash(x.from(Ye[t].flash),{x:16,y:-120})):this.addMuzzleFlash(x.from(Ye[t].flash),{x:1,y:-110})}upgrade(t){this.body.texture=x.from(Ye[t].gun),this.setupMuzzleFlash(t)}getProjectileDamage(){return(this.level*2+20)/Ye[this.level].projectileCount}static createProjectile(t){let e=new E(x.from(Ye[t].projectile));return e.anchor.set(.5),e}};var Un=class extends ce{side;level;constructor(t,e,i){super(t,new Lt(()=>{let s=new E(x.from(Ye[i].projectile));return s.anchor.set(.5),s},ce.resetProjectile,ce.destroyProjectile)),this.level=i,this.side=e,this.body.texture=x.from("Weapon-Side"),this.body.anchor.set(.5),this.body.scale.set(.5),e=="Right"&&(this.body.scale.x*=-1),this.body.visible=this.level!=0,this.setupMuzzleFlash(this.level)}setupMuzzleFlash(t){if(this.flashes.removeChildren(),t>0){let e=["Yellow","Green","Blue","Pink"][t%4];this.addMuzzleFlash(x.from(`Fire-Exit-1-${e}`),{x:this.side=="Left"?-102:102,y:-72})}}fire(){if(this.level==0)return;super.fire();let t=this.projectiles.getInstance();t.position.set(this.side=="Left"?18:-18,-20),this.onFire.dispatch([t])}getProjectileDamage(){return(this.level*2+5)/2}upgrade(t){this.level=t,this.body.visible=this.level!=0}};var px={maxHealth:100,baseHealth:45},gs=class extends Br{leftGun;mainGun;rightGun;magnetEffect;guns=[];constructor(t,e){super(),console.log(`Car ${t}, upgrades`,e);let i=`Player-Car-${t+1}`;this.body=new E(x.from(i)),this.body.anchor.set(.5),this.mainGun=new ms({firePeriodMS:150},e.damage),this.guns.push(this.mainGun),this.resetHP(e.armor),this.addChild(this.body),this.addChild(this.mainGun.flashes),this.addChild(this.mainGun.body),this.addSideGuns(e.guns),this.magnetEffect=new va("shield_loop",{scale:2,speed:.2,loop:!0}),this.magnetEffect.tint=3386111,this.addChild(this.magnetEffect),this.magnetEffect.visible=!1,new st(this.magnetEffect).from({alpha:.5}).to({alpha:.8},300).repeat(1/0).yoyo().easing(it.Sinusoidal.InOut).start()}addSideGuns(t){this.leftGun=new Un({},"Left",t),this.rightGun=new Un({},"Right",t),this.leftGun.body.x=-this.body.width/2,this.rightGun.body.x=this.body.width/2,this.guns.push(this.leftGun),this.guns.push(this.rightGun),this.addChild(this.leftGun.flashes),this.addChild(this.leftGun.body),this.addChild(this.rightGun.flashes),this.addChild(this.rightGun.body)}resetHP(t){this.health=this.getMaxHealth(t)}getMaxHealth(t){return px.baseHealth+t*4}updateGuns(t){this.guns.forEach(e=>e.update(t))}setFiringPermission(t){this.guns.forEach(e=>e.canFire=t)}};var mc={en:{Race:"Race",Rank:"Rank",Name:"Name",Rep:"Rep","Rep:":"Rep:",Upgrade:"Upgrade","More games":"More games",Settings:"Settings",Music:"Music",Sounds:"Sounds",Armor:"Armor","Main gun":"Main gun","Extra guns":"Extra guns",Max:"Max","Tap to play":`Tap and hold
to play`,Restart:"Restart",Home:"Home",Boss:"Boss!","Boss defeated":"Boss Defeated!",Bounty:"Bounty",Reward:"Reward",Continue:"Continue","Continue?":"Continue?",Yes:"Yes",Victory:"Victory!",Defeat:"Defeat!"},ru:{Race:"\u0413\u043E\u043D\u043A\u0430",Rank:"\u041C\u0435\u0441\u0442\u043E",Name:"\u0418\u043C\u044F",Rep:"\u0421\u0447\u0451\u0442","Rep:":"\u0421\u0447\u0451\u0442:",Upgrade:"\u0423\u043B\u0443\u0447\u0448\u0435\u043D\u0438\u044F","More games":"\u0411\u043E\u043B\u044C\u0448\u0435 \u0438\u0433\u0440",Settings:"\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438",Music:"\u041C\u0443\u0437\u044B\u043A\u0430",Sounds:"\u0417\u0432\u0443\u043A\u0438",Armor:"\u0411\u0440\u043E\u043D\u044F","Main gun":"\u041E\u0440\u0443\u0436\u0438\u0435","Extra guns":"\u0414\u043E\u043F. \u043F\u0443\u0448\u043A\u0438",Max:"\u041C\u0430\u043A\u0441.","Tap to play":`\u0423\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0439 \u0442\u0430\u043F,
\u0447\u0442\u043E\u0431\u044B \u0435\u0445\u0430\u0442\u044C`,Restart:"\u0417\u0430\u043D\u043E\u0432\u043E",Home:"\u041C\u0435\u043D\u044E",Boss:"\u0411\u043E\u0441\u0441!","Boss defeated":"\u0411\u043E\u0441\u0441 \u043F\u043E\u0431\u0435\u0436\u0434\u0451\u043D!",Bounty:"\u041D\u0430\u0433\u0440\u0430\u0434\u0430",Reward:"\u041D\u0430\u0433\u0440\u0430\u0434\u0430",Continue:"\u0414\u0430\u043B\u0435\u0435","Continue?":"\u041F\u0440\u043E\u0434\u043E\u043B\u0436\u0438\u0442\u044C?",Yes:"\u0414\u0430",Victory:"\u041F\u043E\u0431\u0435\u0434\u0430!",Defeat:"\u041F\u043E\u0440\u0430\u0436\u0435\u043D\u0438\u0435!"}};var R=class r{static locale="en";static font="rajdhani";static setLocale(t){Object.keys(mc).includes(t)&&(r.locale=t),r.locale=="ru"&&(r.font="rubik")}static getText(t){return mc[r.locale][t]||t}};var ys=(r=>(r[r.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",r[r.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",r))(ys||{});var wa={willReadFrequently:!0},qe=class N{static get experimentalLetterSpacingSupported(){let t=N._experimentalLetterSpacingSupported;if(t!==void 0){let e=S.ADAPTER.getCanvasRenderingContext2D().prototype;t=N._experimentalLetterSpacingSupported="letterSpacing"in e||"textLetterSpacing"in e}return t}constructor(t,e,i,s,n,o,a,h,l){this.text=t,this.style=e,this.width=i,this.height=s,this.lines=n,this.lineWidths=o,this.lineHeight=a,this.maxLineWidth=h,this.fontProperties=l}static measureText(t,e,i,s=N._canvas){i=i??e.wordWrap;let n=e.toFontString(),o=N.measureFont(n);o.fontSize===0&&(o.fontSize=e.fontSize,o.ascent=e.fontSize);let a=s.getContext("2d",wa);a.font=n;let h=(i?N.wordWrap(t,e,s):t).split(/(?:\r\n|\r|\n)/),l=new Array(h.length),c=0;for(let f=0;f<h.length;f++){let m=N._measureText(h[f],e.letterSpacing,a);l[f]=m,c=Math.max(c,m)}let u=c+e.strokeThickness;e.dropShadow&&(u+=e.dropShadowDistance);let d=e.lineHeight||o.fontSize+e.strokeThickness,p=Math.max(d,o.fontSize+e.strokeThickness*2)+e.leading+(h.length-1)*(d+e.leading);return e.dropShadow&&(p+=e.dropShadowDistance),new N(t,e,u,p,h,l,d+e.leading,c,o)}static _measureText(t,e,i){let s=!1;N.experimentalLetterSpacingSupported&&(N.experimentalLetterSpacing?(i.letterSpacing=`${e}px`,i.textLetterSpacing=`${e}px`,s=!0):(i.letterSpacing="0px",i.textLetterSpacing="0px"));let n=i.measureText(t).width;return n>0&&(s?n-=e:n+=(N.graphemeSegmenter(t).length-1)*e),n}static wordWrap(t,e,i=N._canvas){let s=i.getContext("2d",wa),n=0,o="",a="",h=Object.create(null),{letterSpacing:l,whiteSpace:c}=e,u=N.collapseSpaces(c),d=N.collapseNewlines(c),p=!u,f=e.wordWrapWidth+l,m=N.tokenize(t);for(let b=0;b<m.length;b++){let y=m[b];if(N.isNewline(y)){if(!d){a+=N.addLine(o),p=!u,o="",n=0;continue}y=" "}if(u){let g=N.isBreakingSpace(y),_=N.isBreakingSpace(o[o.length-1]);if(g&&_)continue}let v=N.getFromCache(y,l,h,s);if(v>f)if(o!==""&&(a+=N.addLine(o),o="",n=0),N.canBreakWords(y,e.breakWords)){let g=N.wordWrapSplit(y);for(let _=0;_<g.length;_++){let L=g[_],G=L,F=1;for(;g[_+F];){let $=g[_+F];if(!N.canBreakChars(G,$,y,_,e.breakWords))L+=$;else break;G=$,F++}_+=F-1;let B=N.getFromCache(L,l,h,s);B+n>f&&(a+=N.addLine(o),p=!1,o="",n=0),o+=L,n+=B}}else{o.length>0&&(a+=N.addLine(o),o="",n=0);let g=b===m.length-1;a+=N.addLine(y,!g),p=!1,o="",n=0}else v+n>f&&(p=!1,a+=N.addLine(o),o="",n=0),(o.length>0||!N.isBreakingSpace(y)||p)&&(o+=y,n+=v)}return a+=N.addLine(o,!1),a}static addLine(t,e=!0){return t=N.trimRight(t),t=e?`${t}
`:t,t}static getFromCache(t,e,i,s){let n=i[t];return typeof n!="number"&&(n=N._measureText(t,e,s)+e,i[t]=n),n}static collapseSpaces(t){return t==="normal"||t==="pre-line"}static collapseNewlines(t){return t==="normal"}static trimRight(t){if(typeof t!="string")return"";for(let e=t.length-1;e>=0;e--){let i=t[e];if(!N.isBreakingSpace(i))break;t=t.slice(0,-1)}return t}static isNewline(t){return typeof t!="string"?!1:N._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,e){return typeof t!="string"?!1:N._breakingSpaces.includes(t.charCodeAt(0))}static tokenize(t){let e=[],i="";if(typeof t!="string")return e;for(let s=0;s<t.length;s++){let n=t[s],o=t[s+1];if(N.isBreakingSpace(n,o)||N.isNewline(n)){i!==""&&(e.push(i),i=""),e.push(n);continue}i+=n}return i!==""&&e.push(i),e}static canBreakWords(t,e){return e}static canBreakChars(t,e,i,s,n){return!0}static wordWrapSplit(t){return N.graphemeSegmenter(t)}static measureFont(t){if(N._fonts[t])return N._fonts[t];let e={ascent:0,descent:0,fontSize:0},i=N._canvas,s=N._context;s.font=t;let n=N.METRICS_STRING+N.BASELINE_SYMBOL,o=Math.ceil(s.measureText(n).width),a=Math.ceil(s.measureText(N.BASELINE_SYMBOL).width),h=Math.ceil(N.HEIGHT_MULTIPLIER*a);if(a=a*N.BASELINE_MULTIPLIER|0,o===0||h===0)return N._fonts[t]=e,e;i.width=o,i.height=h,s.fillStyle="#f00",s.fillRect(0,0,o,h),s.font=t,s.textBaseline="alphabetic",s.fillStyle="#000",s.fillText(n,0,a);let l=s.getImageData(0,0,o,h).data,c=l.length,u=o*4,d=0,p=0,f=!1;for(d=0;d<a;++d){for(let m=0;m<u;m+=4)if(l[p+m]!==255){f=!0;break}if(!f)p+=u;else break}for(e.ascent=a-d,p=c-u,f=!1,d=h;d>a;--d){for(let m=0;m<u;m+=4)if(l[p+m]!==255){f=!0;break}if(!f)p-=u;else break}return e.descent=d-a,e.fontSize=e.ascent+e.descent,N._fonts[t]=e,e}static clearMetrics(t=""){t?delete N._fonts[t]:N._fonts={}}static get _canvas(){if(!N.__canvas){let t;try{let e=new OffscreenCanvas(0,0);if(e.getContext("2d",wa)?.measureText)return N.__canvas=e,e;t=S.ADAPTER.createCanvas()}catch{t=S.ADAPTER.createCanvas()}t.width=t.height=10,N.__canvas=t}return N.__canvas}static get _context(){return N.__context||(N.__context=N._canvas.getContext("2d",wa)),N.__context}};qe.METRICS_STRING="|\xC9q\xC5",qe.BASELINE_SYMBOL="M",qe.BASELINE_MULTIPLIER=1.4,qe.HEIGHT_MULTIPLIER=2,qe.graphemeSegmenter=(()=>{if(typeof Intl?.Segmenter=="function"){let r=new Intl.Segmenter;return t=>[...r.segment(t)].map(e=>e.segment)}return r=>[...r]})(),qe.experimentalLetterSpacing=!1,qe._fonts={},qe._newlines=[10,13],qe._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];var Lr=qe;var mx=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],Qf=class Gn{constructor(t){this.styleID=0,this.reset(),yc(this,t,t)}clone(){let t={};return yc(t,this,Gn.defaultStyle),new Gn(t)}reset(){yc(this,Gn.defaultStyle,Gn.defaultStyle)}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(t){let e=gc(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)}get fill(){return this._fill}set fill(t){let e=gc(t);this._fill!==e&&(this._fill=e,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(t){gx(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)}get leading(){return this._leading}set leading(t){this._leading!==t&&(this._leading=t,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)}get padding(){return this._padding}set padding(t){this._padding!==t&&(this._padding=t,this.styleID++)}get stroke(){return this._stroke}set stroke(t){let e=gc(t);this._stroke!==e&&(this._stroke=e,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)}get trim(){return this._trim}set trim(t){this._trim!==t&&(this._trim=t,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)}toFontString(){let t=typeof this.fontSize=="number"?`${this.fontSize}px`:this.fontSize,e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(let i=e.length-1;i>=0;i--){let s=e[i].trim();!/([\"\'])[^\'\"]+\1/.test(s)&&!mx.includes(s)&&(s=`"${s}"`),e[i]=s}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${t} ${e.join(",")}`}};Qf.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:ys.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};var Ta=Qf;function gc(r){let t=J.shared,e=i=>{let s=t.setValue(i);return s.alpha===1?s.toHex():s.toRgbaString()};return Array.isArray(r)?r.map(e):e(r)}function gx(r,t){if(!Array.isArray(r)||!Array.isArray(t)||r.length!==t.length)return!1;for(let e=0;e<r.length;++e)if(r[e]!==t[e])return!1;return!0}function yc(r,t,e){for(let i in e)Array.isArray(t[i])?r[i]=t[i].slice():r[i]=t[i]}var yx={texture:!0,children:!1,baseTexture:!0},Jf=class bc extends E{constructor(t,e,i){let s=!1;i||(i=S.ADAPTER.createCanvas(),s=!0),i.width=3,i.height=3;let n=x.from(i);n.orig=new H,n.trim=new H,super(n),this._ownCanvas=s,this.canvas=i,this.context=i.getContext("2d",{willReadFrequently:!0}),this._resolution=bc.defaultResolution??S.RESOLUTION,this._autoResolution=bc.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=t,this.style=e,this.localStyleID=-1}static get experimentalLetterSpacing(){return Lr.experimentalLetterSpacing}static set experimentalLetterSpacing(t){M.deprecation("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),Lr.experimentalLetterSpacing=t}updateText(t){let e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;this._font=this._style.toFontString();let i=this.context,s=Lr.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),n=s.width,o=s.height,a=s.lines,h=s.lineHeight,l=s.lineWidths,c=s.maxLineWidth,u=s.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,n)+e.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,o)+e.padding*2)*this._resolution),i.scale(this._resolution,this._resolution),i.clearRect(0,0,this.canvas.width,this.canvas.height),i.font=this._font,i.lineWidth=e.strokeThickness,i.textBaseline=e.textBaseline,i.lineJoin=e.lineJoin,i.miterLimit=e.miterLimit;let d,p,f=e.dropShadow?2:1;for(let m=0;m<f;++m){let b=e.dropShadow&&m===0,y=b?Math.ceil(Math.max(1,o)+e.padding*2):0,v=y*this._resolution;if(b){i.fillStyle="black",i.strokeStyle="black";let _=e.dropShadowColor,L=e.dropShadowBlur*this._resolution,G=e.dropShadowDistance*this._resolution;i.shadowColor=J.shared.setValue(_).setAlpha(e.dropShadowAlpha).toRgbaString(),i.shadowBlur=L,i.shadowOffsetX=Math.cos(e.dropShadowAngle)*G,i.shadowOffsetY=Math.sin(e.dropShadowAngle)*G+v}else i.fillStyle=this._generateFillStyle(e,a,s),i.strokeStyle=e.stroke,i.shadowColor="black",i.shadowBlur=0,i.shadowOffsetX=0,i.shadowOffsetY=0;let g=(h-u.fontSize)/2;h-u.fontSize<0&&(g=0);for(let _=0;_<a.length;_++)d=e.strokeThickness/2,p=e.strokeThickness/2+_*h+u.ascent+g,e.align==="right"?d+=c-l[_]:e.align==="center"&&(d+=(c-l[_])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(a[_],d+e.padding,p+e.padding-y,!0),e.fill&&this.drawLetterSpacing(a[_],d+e.padding,p+e.padding-y)}this.updateTexture()}drawLetterSpacing(t,e,i,s=!1){let n=this._style.letterSpacing,o=!1;if(Lr.experimentalLetterSpacingSupported&&(Lr.experimentalLetterSpacing?(this.context.letterSpacing=`${n}px`,this.context.textLetterSpacing=`${n}px`,o=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),n===0||o){s?this.context.strokeText(t,e,i):this.context.fillText(t,e,i);return}let a=e,h=Lr.graphemeSegmenter(t),l=this.context.measureText(t).width,c=0;for(let u=0;u<h.length;++u){let d=h[u];s?this.context.strokeText(d,a,i):this.context.fillText(d,a,i);let p="";for(let f=u+1;f<h.length;++f)p+=h[f];c=this.context.measureText(p).width,a+=l-c+n,l=c}}updateTexture(){let t=this.canvas;if(this._style.trim){let o=M.trimCanvas(t);o.data&&(t.width=o.width,t.height=o.height,this.context.putImageData(o.data,0,0))}let e=this._texture,i=this._style,s=i.trim?0:i.padding,n=e.baseTexture;e.trim.width=e._frame.width=t.width/this._resolution,e.trim.height=e._frame.height=t.height/this._resolution,e.trim.x=-s,e.trim.y=-s,e.orig.width=e._frame.width-s*2,e.orig.height=e._frame.height-s*2,this._onTextureUpdate(),n.setRealSize(t.width,t.height,this._resolution),e.updateUvs(),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(t,e){return this.updateText(!0),this._textureID===-1&&(t=!1),super.getBounds(t,e)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds.call(this,t)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(t,e,i){let s=t.fill;if(Array.isArray(s)){if(s.length===1)return s[0]}else return s;let n,o=t.dropShadow?t.dropShadowDistance:0,a=t.padding||0,h=this.canvas.width/this._resolution-o-a*2,l=this.canvas.height/this._resolution-o-a*2,c=s.slice(),u=t.fillGradientStops.slice();if(!u.length){let d=c.length+1;for(let p=1;p<d;++p)u.push(p/d)}if(c.unshift(s[0]),u.unshift(0),c.push(s[s.length-1]),u.push(1),t.fillGradientType===ys.LINEAR_VERTICAL){n=this.context.createLinearGradient(h/2,a,h/2,l+a);let d=i.fontProperties.fontSize+t.strokeThickness;for(let p=0;p<e.length;p++){let f=i.lineHeight*(p-1)+d,m=i.lineHeight*p,b=m;p>0&&f>m&&(b=(m+f)/2);let y=m+d,v=i.lineHeight*(p+1),g=y;p+1<e.length&&v<y&&(g=(y+v)/2);let _=(g-b)/l;for(let L=0;L<c.length;L++){let G=0;typeof u[L]=="number"?G=u[L]:G=L/c.length;let F=Math.min(1,Math.max(0,b/l+G*_));F=Number(F.toFixed(5)),n.addColorStop(F,c[L])}}}else{n=this.context.createLinearGradient(a,l/2,h+a,l/2);let d=c.length+1,p=1;for(let f=0;f<c.length;f++){let m;typeof u[f]=="number"?m=u[f]:m=p/d,n.addColorStop(m,c[f]),p++}}return n}destroy(t){typeof t=="boolean"&&(t={children:t}),t=Object.assign({},yx,t),super.destroy(t),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(t){this.updateText(!0);let e=M.sign(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(t){this.updateText(!0);let e=M.sign(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get style(){return this._style}set style(t){t=t||{},t instanceof Ta?this._style=t:this._style=new Ta(t),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(t){t=String(t??""),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}};Jf.defaultAutoResolution=!0;var K=Jf;var mt=class extends A{bg;text;constructor(t,e,i){super(),this.bg=new E(e||x.WHITE),this.bg.anchor.set(.5),this.eventMode="static",this.on("pointerdown",()=>et.emit("BUTTON_PRESS")),this.text=new K(t,i),this.text.style.align="center",this.text.anchor.set(.5),this.addChild(this.bg),this.addChild(this.text)}};var Dt=class extends A{type;text;constructor(t){super(),this.type=t;let e=new E(x.from("panel-currency")),i=new E(this.getIconTexture(this.type));this.text=new K("0",{fontFamily:R.font,fontSize:42,fill:16777215}),this.text.y=-1,i.position.set(-e.width/2,-3),[e,i,this.text].forEach(s=>{s.anchor.set(.5)}),this.addChild(e),this.addChild(i),this.addChild(this.text)}updateValue(t){this.text.text=t.toString()}getIconTexture(t){switch(t){case"Money":return x.from("icon-money")}}};var bs=class extends E{constructor(t){super(x.from(t,{scaleMode:ne.NEAREST})),this.anchor.set(.5,0),this.scale.set(C.width/this.texture.width+4,1)}};var bx=10,Ea=class extends A{bg;marks;constructor(t){super(),this.bg=new E(x.from("panel-upgrade")),this.bg.anchor.set(.5),this.addChild(this.bg),this.marks=[];let e=this.bg.getBounds().left+5;for(let i=0;i<bx;i++){let s=new E(x.from("upgrade-mark"));s.anchor.set(.5),s.x=e+s.width/2+i*(s.width+8),this.marks.push(s),this.addChild(s)}this.setLevel(t)}setLevel(t){this.marks.forEach((e,i)=>{e.visible=i<t})}};var tm=["armor","damage","guns"],Sa={armor:{color:"blue",basePrice:[50,70,90,110,160,180,230,290,360,550],priceWeight:1},damage:{color:"orange",basePrice:[80,120,150,170,250,290,370,460,580,870],priceWeight:1.6},guns:{color:"purple",basePrice:[60,90,120,140,190,230,290,360,450,680],priceWeight:1.25}},_c={total:[0,7800,29200],coefs:[.07,.15,.25,.38,.54,.75,1,1.3,1.7,2.3]},Aa=class extends A{kind;level;state;bg;label;button;icon;progressBar;maxedText;price;onPress;constructor(t,e,i){super(),this.state="default",this.kind=e,this.level=i;let s=Sa[e];this.onPress=new Se,this.bg=new E(x.from(`box-${s.color}`)),this.bg.anchor.set(.5),this.label=new K(this.getUpgradeName(e).toUpperCase(),{fontFamily:R.font,fontSize:40,fill:16777215}),this.label.anchor.set(.5),this.label.y=-205,this.icon=new E(x.from(`icon-${e}`)),this.icon.anchor.set(.5),this.icon.y=-50,this.progressBar=new Ea(this.level),this.progressBar.y=100,this.button=new mt("",x.from("btn-orange-2")),this.price=new Dt("Money"),this.price.text.style.fontSize=48,this.price.x+=10,this.button.addChild(this.price),this.setupButtonAction(t),this.maxedText=new K(R.getText("Max"),{fontFamily:R.font,fill:16777215,fontSize:54}),this.maxedText.anchor.set(.5),this.button.addChild(this.maxedText),this.maxedText.visible=!1,this.button.y=190,this.setLevel(t,this.level),this.addChild(this.bg),this.addChild(this.label),this.addChild(this.icon),this.addChild(this.progressBar),this.addChild(this.button)}getUpgradeName(t){switch(t){case"armor":return R.getText("Armor");case"damage":return R.getText("Main gun");case"guns":return R.getText("Extra guns")}}increaseLevel(t){this.setLevel(t,++this.level)}setLevel(t,e){this.level=e;let i=Sa[this.kind].basePrice.length;this.level<i?(this.state=="maxed"&&(this.button.bg.visible=!0,this.state="default",this.button.addChild(this.price),this.maxedText.visible=!1,this.setupButtonAction(t)),this.price.updateValue(this.getPrice(t,this.level))):this.state!="maxed"&&(this.button.removeAllListeners(),this.button.removeChild(this.price),this.button.bg.visible=!1,this.maxedText.visible=!0,this.state="maxed"),this.progressBar.setLevel(e)}setupButtonAction(t){this.button.on("pointerdown",()=>{this.onPress.dispatch({kind:this.kind,price:this.getPrice(t,this.level)})})}getPrice(t,e){let i=Sa[this.kind];if(t==0)return i.basePrice[e];let s=_c.total[t],n=Math.round(s*_c.coefs[e]/100)*100;e>0&&(n-=s*_c.coefs[e-1]),n=Math.round(n/100)*100;let o=Object.values(Sa).map(h=>h.priceWeight).reduce((h,l)=>h+l);return Math.round(n*i.priceWeight/o/10)*10}};function Ca(){return new mt(R.getText("Race").toUpperCase(),x.from("btn-orange"),{fontFamily:R.font,fontSize:96,fill:8928518})}var xc=class{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(t){this.removeTickerListener(),this.events=t,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(t){this._pauseUpdate=t}addTickerListener(){this.tickerAdded||!this.domElement||(lt.system.add(this.tickerUpdate,this,Le.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(lt.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove){this._didMove=!1;return}let t=this.events.rootPointerEvent;this.events.supportsTouchEvents&&t.pointerType==="touch"||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:t.clientX,clientY:t.clientY}))}tickerUpdate(t){this._deltaTime+=t,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())}},Ke=new xc;var ui=class r{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=r.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new X,this.page=new X,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,e,i){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,e,i,s,n){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}};var Ze=class extends ui{constructor(){super(...arguments),this.client=new X,this.movement=new X,this.offset=new X,this.global=new X,this.screen=new X}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(t,e,i){return t.worldTransform.applyInverse(i||this.global,e)}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,i,s,n,o,a,h,l,c,u,d,p,f,m){throw new Error("Method not implemented.")}};var Wt=class extends Ze{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}};var Ne=class extends Ze{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}};Ne.DOM_DELTA_PIXEL=0,Ne.DOM_DELTA_LINE=1,Ne.DOM_DELTA_PAGE=2;var _x=2048,xx=new X,vc=new X,Hn=class{constructor(t){this.dispatch=new M.EventEmitter,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort((i,s)=>i.priority-s.priority)}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){if(!this.rootTarget)return;let e=this.mappingTable[t.type];if(e)for(let i=0,s=e.length;i<s;i++)e[i].fn(t);else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,e){Ke.pauseUpdate=!0;let i=this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive",s=this[i](this.rootTarget,this.rootTarget.eventMode,xx.set(t,e),this.hitTestFn,this.hitPruneFn);return s&&s[0]}propagate(t,e){if(!t.target)return;let i=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let s=0,n=i.length-1;s<n;s++)if(t.currentTarget=i[s],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!(t.propagationStopped||t.propagationImmediatelyStopped)){t.eventPhase=t.BUBBLING_PHASE;for(let s=i.length-2;s>=0;s--)if(t.currentTarget=i[s],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,e,i=this._allInteractiveElements){if(i.length===0)return;t.eventPhase=t.BUBBLING_PHASE;let s=Array.isArray(e)?e:[e];for(let n=i.length-1;n>=0;n--)s.forEach(o=>{t.currentTarget=i[n],this.notifyTarget(t,o)})}propagationPath(t){let e=[t];for(let i=0;i<_x&&t!==this.rootTarget;i++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}hitTestMoveRecursive(t,e,i,s,n,o=!1){let a=!1;if(this._interactivePrune(t))return null;if((t.eventMode==="dynamic"||e==="dynamic")&&(Ke.pauseUpdate=!1),t.interactiveChildren&&t.children){let c=t.children;for(let u=c.length-1;u>=0;u--){let d=c[u],p=this.hitTestMoveRecursive(d,this._isInteractive(e)?e:d.eventMode,i,s,n,o||n(t,i));if(p){if(p.length>0&&!p[p.length-1].parent)continue;let f=t.isInteractive();(p.length>0||f)&&(f&&this._allInteractiveElements.push(t),p.push(t)),this._hitElements.length===0&&(this._hitElements=p),a=!0}}}let h=this._isInteractive(e),l=t.isInteractive();return h&&l&&this._allInteractiveElements.push(t),o||this._hitElements.length>0?null:a?this._hitElements:h&&!n(t,i)&&s(t,i)?l?[t]:[]:null}hitTestRecursive(t,e,i,s,n){if(this._interactivePrune(t)||n(t,i))return null;if((t.eventMode==="dynamic"||e==="dynamic")&&(Ke.pauseUpdate=!1),t.interactiveChildren&&t.children){let h=t.children;for(let l=h.length-1;l>=0;l--){let c=h[l],u=this.hitTestRecursive(c,this._isInteractive(e)?e:c.eventMode,i,s,n);if(u){if(u.length>0&&!u[u.length-1].parent)continue;let d=t.isInteractive();return(u.length>0||d)&&u.push(t),u}}}let o=this._isInteractive(e),a=t.isInteractive();return o&&s(t,i)?a?[t]:[]:null}_isInteractive(t){return t==="static"||t==="dynamic"}_interactivePrune(t){return!!(!t||t.isMask||!t.visible||!t.renderable||t.eventMode==="none"||t.eventMode==="passive"&&!t.interactiveChildren||t.isMask)}hitPruneFn(t,e){if(t.hitArea&&(t.worldTransform.applyInverse(e,vc),!t.hitArea.contains(vc.x,vc.y)))return!0;if(t._mask){let i=t._mask.isMaskData?t._mask.maskObject:t._mask;if(i&&!i.containsPoint?.(e))return!0}return!1}hitTestFn(t,e){return t.eventMode==="passive"?!1:t.hitArea?!0:t.containsPoint?t.containsPoint(e):!1}notifyTarget(t,e){e=e??t.type;let i=`on${e}`;t.currentTarget[i]?.(t);let s=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this.notifyListeners(t,s),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}mapPointerDown(t){if(!(t instanceof Wt)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}let e=this.createPointerEvent(t);if(this.dispatchEvent(e,"pointerdown"),e.pointerType==="touch")this.dispatchEvent(e,"touchstart");else if(e.pointerType==="mouse"||e.pointerType==="pen"){let s=e.button===2;this.dispatchEvent(e,s?"rightdown":"mousedown")}let i=this.trackingData(t.pointerId);i.pressTargetsByButton[t.button]=e.composedPath(),this.freeEvent(e)}mapPointerMove(t){if(!(t instanceof Wt)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;let e=this.createPointerEvent(t);this._isPointerMoveEvent=!1;let i=e.pointerType==="mouse"||e.pointerType==="pen",s=this.trackingData(t.pointerId),n=this.findMountedTarget(s.overTargets);if(s.overTargets?.length>0&&n!==e.target){let h=t.type==="mousemove"?"mouseout":"pointerout",l=this.createPointerEvent(t,h,n);if(this.dispatchEvent(l,"pointerout"),i&&this.dispatchEvent(l,"mouseout"),!e.composedPath().includes(n)){let c=this.createPointerEvent(t,"pointerleave",n);for(c.eventPhase=c.AT_TARGET;c.target&&!e.composedPath().includes(c.target);)c.currentTarget=c.target,this.notifyTarget(c),i&&this.notifyTarget(c,"mouseleave"),c.target=c.target.parent;this.freeEvent(c)}this.freeEvent(l)}if(n!==e.target){let h=t.type==="mousemove"?"mouseover":"pointerover",l=this.clonePointerEvent(e,h);this.dispatchEvent(l,"pointerover"),i&&this.dispatchEvent(l,"mouseover");let c=n?.parent;for(;c&&c!==this.rootTarget.parent&&c!==e.target;)c=c.parent;if(!c||c===this.rootTarget.parent){let u=this.clonePointerEvent(e,"pointerenter");for(u.eventPhase=u.AT_TARGET;u.target&&u.target!==n&&u.target!==this.rootTarget.parent;)u.currentTarget=u.target,this.notifyTarget(u),i&&this.notifyTarget(u,"mouseenter"),u.target=u.target.parent;this.freeEvent(u)}this.freeEvent(l)}let o=[],a=this.enableGlobalMoveEvents??!0;this.moveOnAll?o.push("pointermove"):this.dispatchEvent(e,"pointermove"),a&&o.push("globalpointermove"),e.pointerType==="touch"&&(this.moveOnAll?o.splice(1,0,"touchmove"):this.dispatchEvent(e,"touchmove"),a&&o.push("globaltouchmove")),i&&(this.moveOnAll?o.splice(1,0,"mousemove"):this.dispatchEvent(e,"mousemove"),a&&o.push("globalmousemove"),this.cursor=e.target?.cursor),o.length>0&&this.all(e,o),this._allInteractiveElements.length=0,this._hitElements.length=0,s.overTargets=e.composedPath(),this.freeEvent(e)}mapPointerOver(t){if(!(t instanceof Wt)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}let e=this.trackingData(t.pointerId),i=this.createPointerEvent(t),s=i.pointerType==="mouse"||i.pointerType==="pen";this.dispatchEvent(i,"pointerover"),s&&this.dispatchEvent(i,"mouseover"),i.pointerType==="mouse"&&(this.cursor=i.target?.cursor);let n=this.clonePointerEvent(i,"pointerenter");for(n.eventPhase=n.AT_TARGET;n.target&&n.target!==this.rootTarget.parent;)n.currentTarget=n.target,this.notifyTarget(n),s&&this.notifyTarget(n,"mouseenter"),n.target=n.target.parent;e.overTargets=i.composedPath(),this.freeEvent(i),this.freeEvent(n)}mapPointerOut(t){if(!(t instanceof Wt)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}let e=this.trackingData(t.pointerId);if(e.overTargets){let i=t.pointerType==="mouse"||t.pointerType==="pen",s=this.findMountedTarget(e.overTargets),n=this.createPointerEvent(t,"pointerout",s);this.dispatchEvent(n),i&&this.dispatchEvent(n,"mouseout");let o=this.createPointerEvent(t,"pointerleave",s);for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==this.rootTarget.parent;)o.currentTarget=o.target,this.notifyTarget(o),i&&this.notifyTarget(o,"mouseleave"),o.target=o.target.parent;e.overTargets=null,this.freeEvent(n),this.freeEvent(o)}this.cursor=null}mapPointerUp(t){if(!(t instanceof Wt)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}let e=performance.now(),i=this.createPointerEvent(t);if(this.dispatchEvent(i,"pointerup"),i.pointerType==="touch")this.dispatchEvent(i,"touchend");else if(i.pointerType==="mouse"||i.pointerType==="pen"){let a=i.button===2;this.dispatchEvent(i,a?"rightup":"mouseup")}let s=this.trackingData(t.pointerId),n=this.findMountedTarget(s.pressTargetsByButton[t.button]),o=n;if(n&&!i.composedPath().includes(n)){let a=n;for(;a&&!i.composedPath().includes(a);){if(i.currentTarget=a,this.notifyTarget(i,"pointerupoutside"),i.pointerType==="touch")this.notifyTarget(i,"touchendoutside");else if(i.pointerType==="mouse"||i.pointerType==="pen"){let h=i.button===2;this.notifyTarget(i,h?"rightupoutside":"mouseupoutside")}a=a.parent}delete s.pressTargetsByButton[t.button],o=a}if(o){let a=this.clonePointerEvent(i,"click");a.target=o,a.path=null,s.clicksByButton[t.button]||(s.clicksByButton[t.button]={clickCount:0,target:a.target,timeStamp:e});let h=s.clicksByButton[t.button];if(h.target===a.target&&e-h.timeStamp<200?++h.clickCount:h.clickCount=1,h.target=a.target,h.timeStamp=e,a.detail=h.clickCount,a.pointerType==="mouse"){let l=a.button===2;this.dispatchEvent(a,l?"rightclick":"click")}else a.pointerType==="touch"&&this.dispatchEvent(a,"tap");this.dispatchEvent(a,"pointertap"),this.freeEvent(a)}this.freeEvent(i)}mapPointerUpOutside(t){if(!(t instanceof Wt)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}let e=this.trackingData(t.pointerId),i=this.findMountedTarget(e.pressTargetsByButton[t.button]),s=this.createPointerEvent(t);if(i){let n=i;for(;n;)s.currentTarget=n,this.notifyTarget(s,"pointerupoutside"),s.pointerType==="touch"?this.notifyTarget(s,"touchendoutside"):(s.pointerType==="mouse"||s.pointerType==="pen")&&this.notifyTarget(s,s.button===2?"rightupoutside":"mouseupoutside"),n=n.parent;delete e.pressTargetsByButton[t.button]}this.freeEvent(s)}mapWheel(t){if(!(t instanceof Ne)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}let e=this.createWheelEvent(t);this.dispatchEvent(e),this.freeEvent(e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let i=1;i<t.length&&t[i].parent===e;i++)e=t[i];return e}createPointerEvent(t,e,i){let s=this.allocateEvent(Wt);return this.copyPointerData(t,s),this.copyMouseData(t,s),this.copyData(t,s),s.nativeEvent=t.nativeEvent,s.originalEvent=t,s.target=i??this.hitTest(s.global.x,s.global.y)??this._hitElements[0],typeof e=="string"&&(s.type=e),s}createWheelEvent(t){let e=this.allocateEvent(Ne);return this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.hitTest(e.global.x,e.global.y),e}clonePointerEvent(t,e){let i=this.allocateEvent(Wt);return i.nativeEvent=t.nativeEvent,i.originalEvent=t.originalEvent,this.copyPointerData(t,i),this.copyMouseData(t,i),this.copyData(t,i),i.target=t.target,i.path=t.composedPath().slice(),i.type=e??i.type,i}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof Wt&&e instanceof Wt&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof Ze&&e instanceof Ze&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.copyFrom(t.client),e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.copyFrom(t.movement),e.screen.copyFrom(t.screen),e.shiftKey=t.shiftKey,e.global.copyFrom(t.global))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.copyFrom(t.layer),e.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);let e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.path=null,e.target=null,e}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");let e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t)}notifyListeners(t,e){let i=t.currentTarget._events[e];if(i&&t.currentTarget.isInteractive())if("fn"in i)i.once&&t.currentTarget.removeListener(e,i.fn,void 0,!0),i.fn.call(i.context,t);else for(let s=0,n=i.length;s<n&&!t.propagationImmediatelyStopped;s++)i[s].once&&t.currentTarget.removeListener(e,i[s].fn,void 0,!0),i[s].fn.call(i[s].context,t)}};var vx=1,wx={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},wc=class Tc{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new Hn(null),Ke.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new Wt(null),this.rootWheelEvent=new Ne(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...Tc.defaultEventFeatures},{set:(e,i,s)=>(i==="globalMove"&&(this.rootBoundary.enableGlobalMoveEvents=s),e[i]=s,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(t){let{view:e,resolution:i}=this.renderer;this.setTargetElement(e),this.resolution=i,Tc._defaultEventMode=t.eventMode??"auto",Object.assign(this.features,t.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(t){t=t||"default";let e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this.currentCursor===t)return;this.currentCursor=t;let i=this.cursorStyles[t];if(i)switch(typeof i){case"string":e&&(this.domElement.style.cursor=i);break;case"function":i(t);break;case"object":e&&Object.assign(this.domElement.style,i);break}else e&&typeof t=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}get pointer(){return this.rootPointerEvent}onPointerDown(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let i=0,s=e.length;i<s;i++){let n=e[i],o=this.bootstrapEvent(this.rootPointerEvent,n);this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(t){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,Ke.pointerMoved();let e=this.normalizeToPointerData(t);for(let i=0,s=e.length;i<s;i++){let n=this.bootstrapEvent(this.rootPointerEvent,e[i]);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let e=t.target;t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]);let i=e!==this.domElement?"outside":"",s=this.normalizeToPointerData(t);for(let n=0,o=s.length;n<o;n++){let a=this.bootstrapEvent(this.rootPointerEvent,s[n]);a.type+=i,this.rootBoundary.mapEvent(a)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let e=this.normalizeToPointerData(t);for(let i=0,s=e.length;i<s;i++){let n=this.bootstrapEvent(this.rootPointerEvent,e[i]);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){if(!this.features.wheel)return;let e=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e)}setTargetElement(t){this.removeEvents(),this.domElement=t,Ke.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;Ke.addTickerListener();let t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0))),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;Ke.removeTickerListener();let t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0))),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(t,e,i){let s=this.domElement.isConnected?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0},n=1/this.resolution;t.x=(e-s.left)*(this.domElement.width/s.width)*n,t.y=(i-s.top)*(this.domElement.height/s.height)*n}normalizeToPointerData(t){let e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let i=0,s=t.changedTouches.length;i<s;i++){let n=t.changedTouches[i];typeof n.button>"u"&&(n.button=0),typeof n.buttons>"u"&&(n.buttons=1),typeof n.isPrimary>"u"&&(n.isPrimary=t.touches.length===1&&t.type==="touchstart"),typeof n.width>"u"&&(n.width=n.radiusX||1),typeof n.height>"u"&&(n.height=n.radiusY||1),typeof n.tiltX>"u"&&(n.tiltX=0),typeof n.tiltY>"u"&&(n.tiltY=0),typeof n.pointerType>"u"&&(n.pointerType="touch"),typeof n.pointerId>"u"&&(n.pointerId=n.identifier||0),typeof n.pressure>"u"&&(n.pressure=n.force||.5),typeof n.twist>"u"&&(n.twist=0),typeof n.tangentialPressure>"u"&&(n.tangentialPressure=0),typeof n.layerX>"u"&&(n.layerX=n.offsetX=n.clientX),typeof n.layerY>"u"&&(n.layerY=n.offsetY=n.clientY),n.isNormalized=!0,n.type=t.type,e.push(n)}else if(!globalThis.MouseEvent||t instanceof MouseEvent&&(!this.supportsPointerEvents||!(t instanceof globalThis.PointerEvent))){let i=t;typeof i.isPrimary>"u"&&(i.isPrimary=!0),typeof i.width>"u"&&(i.width=1),typeof i.height>"u"&&(i.height=1),typeof i.tiltX>"u"&&(i.tiltX=0),typeof i.tiltY>"u"&&(i.tiltY=0),typeof i.pointerType>"u"&&(i.pointerType="mouse"),typeof i.pointerId>"u"&&(i.pointerId=vx),typeof i.pressure>"u"&&(i.pressure=.5),typeof i.twist>"u"&&(i.twist=0),typeof i.tangentialPressure>"u"&&(i.tangentialPressure=0),i.isNormalized=!0,e.push(i)}else e.push(t);return e}normalizeWheelEvent(t){let e=this.rootWheelEvent;return this.transferMouseData(e,t),e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ,e.deltaMode=t.deltaMode,this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){return t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e),this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=e.isTrusted,t.type==="pointerleave"&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=wx[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null,t.shiftKey=e.shiftKey}};wc.extension={name:"events",type:[w.RendererSystem,w.CanvasRendererSystem]},wc.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};var Vn=wc;T.add(Vn);function em(r){return r==="dynamic"||r==="static"}var rm={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){return this._internalInteractive??em(Vn.defaultEventMode)},set interactive(r){M.deprecation("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=r,this.eventMode=r?"static":"auto"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??Vn.defaultEventMode},set eventMode(r){this._internalInteractive=em(r),this._internalEventMode=r},isInteractive(){return this.eventMode==="static"||this.eventMode==="dynamic"},interactiveChildren:!0,hitArea:null,addEventListener(r,t,e){let i=typeof e=="boolean"&&e||typeof e=="object"&&e.capture,s=typeof t=="function"?void 0:t;r=i?`${r}capture`:r,t=typeof t=="function"?t:t.handleEvent,this.on(r,t,s)},removeEventListener(r,t,e){let i=typeof e=="boolean"&&e||typeof e=="object"&&e.capture,s=typeof t=="function"?void 0:t;r=i?`${r}capture`:r,t=typeof t=="function"?t:t.handleEvent,this.off(r,t,s)},dispatchEvent(r){if(!(r instanceof ui))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return r.defaultPrevented=!1,r.path=null,r.target=this,r.manager.dispatchEvent(r),!r.defaultPrevented}};Xe.mixin(rm);var jn={carSkins:["Player-Car-1","Player-Car-2","Player-Car-3"],carPrices:[0,1e4,3e4]},Ia=class extends A{game;progress;bg;bottomShadow;playerCar;selectedCarId;btnBack;moneyCounter;btnNextCar;btnPrevCar;btnSelectCar;upgrades;btnPurchaseCar;carPurchasePrice;btnStartRace;constructor(t,e){super(),this.game=t,this.progress=e,this.bg=new E(x.from("garage")),this.bg.scale.set(C.height/this.bg.height),this.bg.anchor.x=.5,this.bg.x=C.width/2,this.bottomShadow=new bs("shadow-blue"),this.selectedCarId=e.data.selectedCar,this.playerCar=new gs(this.selectedCarId,this.progress.getCarUpgrades(this.selectedCarId)),this.playerCar.scale.set(2),this.btnBack=new mt("",x.from("btn-back")),this.btnBack.on("pointerdown",()=>{this.progress.data.cars.find(i=>i.id==this.selectedCarId)?.unlocked&&(this.progress.data.selectedCar=this.selectedCarId,this.progress.saveLocal()),this.game.audio.playSound("ui_menu_whoosh"),et.emit("START_MENU")}),this.moneyCounter=new Dt("Money"),this.moneyCounter.updateValue(e.data.money),this.btnPrevCar=new mt("",x.from("btn-arrow")),this.btnPrevCar.scale.x=-1,this.btnPrevCar.on("pointerdown",()=>{this.selectedCarId>0&&(this.selectedCarId--,this.game.audio.playSound("ui_menu_whoosh"),this.reloadPlayerCar(this.selectedCarId),this.updateGarageUI(this.selectedCarId))}),this.btnNextCar=new mt("",x.from("btn-arrow")),this.btnNextCar.on("pointerdown",()=>{this.selectedCarId<jn.carSkins.length-1&&(this.selectedCarId++,this.game.audio.playSound("ui_menu_whoosh"),this.reloadPlayerCar(this.selectedCarId),this.updateGarageUI(this.selectedCarId))}),this.btnSelectCar=new mt("Select",x.from("btn-green"),{fontFamily:R.font,fill:16777215,fontSize:48}),this.btnSelectCar.on("pointerdown",()=>{this.progress.data.selectedCar=this.selectedCarId,this.progress.saveLocal()}),this.upgrades=new A,this.addUpgradeButtons(),this.btnPurchaseCar=new mt("",x.from("btn-orange"),{fontFamily:R.font,fill:16777215,fontSize:48}),this.carPurchasePrice=new Dt("Money"),this.carPurchasePrice.scale.set(1.5),this.carPurchasePrice.updateValue(jn.carPrices[this.selectedCarId]),this.btnPurchaseCar.addChild(this.carPurchasePrice),this.carPurchasePrice.x=10,this.btnPurchaseCar.on("pointerdown",()=>{let i=jn.carPrices[this.selectedCarId];i<=this.progress.data.money&&(this.progress.data.cars[this.selectedCarId].unlocked=!0,this.progress.data.money-=i,this.moneyCounter.updateValue(this.progress.data.money),this.progress.saveLocal(),this.updateGarageUI(this.selectedCarId))}),this.btnStartRace=Ca(),this.btnStartRace.on("pointerdown",()=>{et.emit("START_RACE")}),this.updateGarageUI(this.selectedCarId),this.addChild(this.bg),this.addChild(this.bottomShadow),this.addChild(this.btnBack),this.addChild(this.moneyCounter),this.addChild(this.playerCar),this.addChild(this.btnPrevCar),this.addChild(this.btnNextCar),this.addChild(this.upgrades),this.addChild(this.btnPurchaseCar),this.positionElements()}positionElements(){this.bottomShadow.position.set(C.width/2,C.height-this.bottomShadow.height),this.moneyCounter.position.set(C.width/2+400,80),this.playerCar.position.set(C.width/2,this.height/2-200),this.btnPrevCar.position.set(C.width/2-380,this.playerCar.y),this.btnNextCar.position.set(C.width/2+380,this.playerCar.y),this.btnBack.position.set(100,80),this.btnStartRace.position.set(C.width/2,this.height-this.btnSelectCar.height),this.btnSelectCar.position.set(C.width/2,this.btnStartRace.y-this.btnStartRace.height),this.btnPurchaseCar.position.set(C.width/2,this.playerCar.y+800),this.upgrades.position.set(C.width/2,this.playerCar.y+700)}reloadPlayerCar(t){this.playerCar.body.texture=x.from(jn.carSkins[t])}addUpgradeButtons(){[...tm].forEach((t,e)=>{let i=new Aa(this.selectedCarId,t,this.progress.getCarUpgrade(t,this.selectedCarId));i.onPress.add(s=>{(s.price<this.progress.data.money||mr.freeUpgrades)&&(this.game.audio.playSound("upgrade_3"),this.progress.upgradeCar(this.selectedCarId,s.kind),this.progress.data.money-=mr.freeUpgrades?0:s.price,this.progress.saveLocal(),this.moneyCounter.updateValue(this.progress.data.money),i.increaseLevel(this.selectedCarId),s.kind=="guns"&&(this.playerCar.leftGun.upgrade(this.progress.getCarUpgrade("guns",this.selectedCarId)),this.playerCar.rightGun.upgrade(this.progress.getCarUpgrade("guns",this.selectedCarId))),s.kind=="damage"&&this.playerCar.mainGun.upgrade(this.progress.getCarUpgrade("damage",this.selectedCarId)))}),i.position.x=(e-1)*320,this.upgrades.addChild(i)})}updateGarageUI(t){let e=this.progress.data.cars[t].unlocked;this.upgrades.visible=e,this.btnPurchaseCar.visible=!e,this.playerCar.mainGun.upgrade(this.progress.getCarUpgrade("damage",this.selectedCarId)),this.playerCar.leftGun.upgrade(this.progress.getCarUpgrade("guns",this.selectedCarId)),this.playerCar.rightGun.upgrade(this.progress.getCarUpgrade("guns",this.selectedCarId)),e?this.upgrades.children.forEach(i=>{i.setLevel(t,this.progress.getCarUpgrade(i.kind,t))}):this.carPurchasePrice.updateValue(jn.carPrices[t])}};var Ec={evenRowColor:1323346,oddRowColor:1787253,playerRowColor:16774656},Pa=class extends A{bg;rankText;nameText;repIcon;repCountText;formatter;constructor(t){super(),this.bg=new E(x.from("panel-lb-entry")),this.bg.tint=this.getColor(t,!1),this.formatter=Intl.NumberFormat("en",{notation:"compact"});let e={fontFamily:R.font,fill:16777215,fontSize:54};this.rankText=new K(t.toString(),e),this.nameText=new K("",e),this.repIcon=new E(x.from("icon-rep")),this.repCountText=new K("",e),this.bg.anchor.set(.5),this.rankText.anchor.set(.5,.5),this.nameText.anchor.set(0,.5),this.repIcon.anchor.set(.5,.5),this.repCountText.anchor.set(0,.5);let i=this.bg.getBounds().left,s=this.bg.getBounds().right;this.rankText.x=i+70,this.nameText.x=i+150,this.repCountText.x=s-200,this.repIcon.x=this.repCountText.x-80,this.addChild(this.bg),this.addChild(this.rankText),this.addChild(this.nameText),this.addChild(this.repIcon),this.addChild(this.repCountText)}fillData(t,e,i,s=!1){this.bg.tint=this.getColor(t,s),this.rankText.text=t.toString(),this.rankText.style.fill=s?65793:16777215,this.nameText.text=e.toString(),this.nameText.style.fill=s?65793:16777215,this.repCountText.text=this.formatter.format(i),this.repCountText.style.fill=s?65793:16777215}getColor(t,e){return e?Ec.playerRowColor:t%2==1?Ec.oddRowColor:Ec.evenRowColor}};var Ra=class extends A{bg;rankLabel;nameLabel;repLabel;constructor(){super(),this.bg=new E(x.from("panel-lb-entry")),this.bg.scale.y=.8,this.bg.tint=926265;let t={fontFamily:R.font,fill:16777215,fontSize:40};this.rankLabel=new K(R.getText("Rank").toUpperCase(),t),this.nameLabel=new K(R.getText("Name").toUpperCase(),t),this.repLabel=new K(R.getText("Rep").toUpperCase(),t),this.bg.anchor.set(.5),this.rankLabel.anchor.set(.5,.5),this.nameLabel.anchor.set(0,.5),this.repLabel.anchor.set(0,.5);let e=this.bg.getBounds().left,i=this.bg.getBounds().right;this.rankLabel.x=e+70,this.nameLabel.x=e+150,this.repLabel.x=i-200,this.addChild(this.bg),this.addChild(this.rankLabel),this.addChild(this.nameLabel),this.addChild(this.repLabel)}};var Qe={name:"Reputation",rows:5,maxNameLength:15};var Ma=class extends A{header;entries;constructor(){super(),this.header=new Ra,this.addChild(this.header),this.createEntries()}createEntries(){this.entries=[];for(let t=0;t<Qe.rows;t++){let e=new Pa(t+1);e.y=this.header.getBounds().bottom+e.height/2+e.height*t,this.entries.push(e),this.addChild(e),e.visible=!1}}displayEntries(t,e){let i=e-1>4?4:e-1;console.log(`user entry index ${i}`);for(let s=0;s<Math.min(Qe.rows,t.length);s++){let n=s==i,o=n?e:s+1;console.log("rank",o),this.entries[s].fillData(o,this.formatDisplayName(t[s].player.publicName),t[s].score,n),this.entries[s].visible=!0}}formatDisplayName(t){let e=0,i="";for(let s of t.split(" ")){if(e+=s.length+1,e>Qe.maxNameLength)return i+=" "+s.substring(0,1)+".",i;i+=" "+s}return i}};var Sc=["MoneyBill","MoneyStack","Health","Magnet","MoneyX2"],Ba={MoneyBill:{textureKey:"MoneyBill"},MoneyStack:{textureKey:"MoneyStack"},Health:{textureKey:"Heal"},Magnet:{textureKey:"Magnet",durationMS:5e3},MoneyX2:{textureKey:"X2",durationMS:3e3}},Je={maxVerticalVelocity:2,maxHorizVelocity:.6,spinVelocity:.1,gravity:.005,magnetPower:2},Fa=class extends E{kind;velocity;constructor(t){super(),this.velocity=new X,this.anchor.set(.5),this.reset(t)}reset(t){this.kind=t,this.texture=x.from(Ba[t].textureKey),this.velocity.set(Math.random()*Je.maxHorizVelocity*2-Je.maxHorizVelocity,-Math.random()*.5)}applyGravity(t){this.velocity.y=Math.min(Je.maxVerticalVelocity,this.velocity.y+Je.gravity*t)}applyMagnet(t,e){let i=t.x-this.x,s=t.y-this.y,n=i*i+s*s,o=Je.magnetPower/Math.sqrt(n);Math.abs(i)>50?this.velocity.x+=o*Math.sign(i)*e:this.velocity.x*=.95,this.velocity.x<-Je.maxHorizVelocity&&(this.velocity.x=-Je.maxHorizVelocity),this.velocity.x>Je.maxHorizVelocity&&(this.velocity.x=Je.maxHorizVelocity)}move(t){this.y+=this.velocity.y*t,this.x+=this.velocity.x*t}spin(t){this.angle+=Je.spinVelocity*t*Math.sign(this.velocity.x)}bounceOffRoadBorders(t,e){e.left<t.left&&(this.velocity.x=-this.velocity.x,this.x+=t.left-e.left),e.right>t.right&&(this.velocity.x=-this.velocity.x,this.x-=e.right-t.right)}};function Ut(r,t){let e=t.reduce((s,n)=>s+n),i=Math.floor(Math.random()*e);for(let s=0;s<t.length;s++){if(i-t[s]<0)return r[s];i-=t[s]}}var La=class r{static recentChoice=0;pickups=new Lt(()=>{let t=r.getNextKind([...Sc]);return new Fa(t)},t=>{let e=r.getNextKind([...Sc]);t.reset(e)},t=>{t.destroy()});constructor(){}getFromEnemy(t){let e=this.pickups.getInstance();if(t.extraLoot&&Math.random()<t.extraLoot.chance){let i=Ut(t.extraLoot.drop,Array(t.extraLoot.drop.length).fill(1));return e.reset(i),e}if(t.regularLoot){let i=Ut(Object.keys(t.regularLoot),Object.values(t.regularLoot));return e.reset(i),e}}static getNextKind(t){return t[r.recentChoice++%t.length]}};var ka=class{target;_active=!1;initialTargetCoord;initialPointerCoord;leftBound;rightBound;factor=.02;constructor(t){this.target=t}start(t){this.initialPointerCoord=t.x,this.initialTargetCoord=this.target.roadX,this._active=!0}stop(){this._active=!1}update(t){if(!this.active)return;let e=t.x-this.initialPointerCoord,i=this.initialTargetCoord+e*this.factor;this.target.roadX=Math.min(this.rightBound,Math.max(this.leftBound,i))}setBounds(t,e){this.leftBound=t,this.rightBound=e}get active(){return this._active}};var _s=class extends A{bg;fill;tween;constructor(){super(),this.bg=new E(x.from("enemy-progress-bar-back")),this.bg.anchor.set(.5),this.fill=new E(x.from("enemy-progress-bar-full")),this.fill.anchor.set(.5);let t=new E(x.from("enemy-progress-bar-mask"));t.anchor.set(.5),this.fill.mask=t,this.tween=new st(this.fill).easing(it.Cubic.InOut).duration(300),this.fill.x,this.addChild(this.bg),this.addChild(this.fill),this.addChild(t),this.scale.set(.5)}updateValue(t){this.fill.x=-this.bg.width*(1-t)}};var gr={minDamage:10,maxDamage:45,minRadius:300,maxRadius:800},Oa=["regular","fuel","taxi","hpvan","moneyvan","mystery"],$n={regular:{gfx:"Enemy-Car",hp:60,rep:1,regularLoot:{MoneyBill:.8,MoneyStack:.2},extraLoot:{chance:.05,drop:["Health","Magnet","MoneyX2"]}},fuel:{gfx:"Gas-Car",hp:90,rep:5,regularLoot:{MoneyBill:.6,MoneyStack:.4},extraLoot:{chance:.1,drop:["Health","Magnet","MoneyX2"]}},taxi:{gfx:"Taxi-Car",hp:120,rep:5,regularLoot:{MoneyBill:.6,MoneyStack:.4},extraLoot:{chance:.1,drop:["Health","Magnet","MoneyX2"]}},hpvan:{gfx:"Heal-Car",hp:120,rep:5,extraLoot:{chance:1,drop:["Health"]}},moneyvan:{gfx:"Money-Car",hp:120,rep:5,extraLoot:{chance:1,drop:["MoneyStack"]}},mystery:{gfx:"Mystery-Car",hp:480,rep:5,extraLoot:{chance:1,drop:["Health","Magnet","MoneyX2"]}}},xs=class extends Br{kind;dead;maxHealth;healthBar;constructor(){super(),this.healthBar=new _s,this.addChild(this.healthBar)}takeDamage(t){this.health-=t,this.healthBar.visible=!0,this.healthBar.updateValue(this.health/this.maxHealth)}static getFuelExplosionDamage(t){return Math.min(gr.maxDamage,gr.minDamage+(gr.maxRadius-t)/(gr.maxRadius-gr.minRadius)*(gr.maxDamage-gr.minDamage))}};function tr(r,t){return r=Math.ceil(r),t=Math.floor(t),Math.floor(Math.random()*(t-r+1))+r}var Tx={spawnPeriodMS:1e3},vs=class r{static lastid=0;config;lastSpawnedMS;cars=new Lt(()=>{let t=new xs,e=new E;return e.anchor.set(.5),t.body=e,t.addChild(t.body),t},t=>{t.dead=!1,t.healthBar.visible=!1},t=>{t.destroy({children:!0})});onSpawn=new Se;constructor(t){this.config=Object.assign({},Tx,t||{}),this.lastSpawnedMS=0}spawn(){this.onSpawn.dispatch()}update(t){this.lastSpawnedMS+=t,this.lastSpawnedMS>this.config.spawnPeriodMS&&(this.lastSpawnedMS-=this.config.spawnPeriodMS,this.spawn())}resetTimer(){this.lastSpawnedMS=this.config.spawnPeriodMS}static randomizeCar(t){let e=Ut([...Oa],[0,1,0,0,0]);r.changeCarKind(t,e)}static changeCarKind(t,e){let i=$n[e];t.kind=e,t.body.texture=x.from(i.gfx),t.maxHealth=i.hp,t.health=i.hp,t.healthBar.y=t.body.height/2+t.healthBar.height/2+10,t.healthBar.updateValue(1)}static loadNextCar(t){let e=Oa[r.lastid++%Oa.length];t.kind=e,this.changeCarKind(t,e)}};var di={build(r){let t=r.points,e,i,s,n,o,a;if(r.type===ht.CIRC){let f=r.shape;e=f.x,i=f.y,o=a=f.radius,s=n=0}else if(r.type===ht.ELIP){let f=r.shape;e=f.x,i=f.y,o=f.width,a=f.height,s=n=0}else{let f=r.shape,m=f.width/2,b=f.height/2;e=f.x+m,i=f.y+b,o=a=Math.max(0,Math.min(f.radius,Math.min(m,b))),s=m-o,n=b-a}if(!(o>=0&&a>=0&&s>=0&&n>=0)){t.length=0;return}let h=Math.ceil(2.3*Math.sqrt(o+a)),l=h*8+(s?4:0)+(n?4:0);if(t.length=l,l===0)return;if(h===0){t.length=8,t[0]=t[6]=e+s,t[1]=t[3]=i+n,t[2]=t[4]=e-s,t[5]=t[7]=i-n;return}let c=0,u=h*4+(s?2:0)+2,d=u,p=l;{let f=s+o,m=n,b=e+f,y=e-f,v=i+m;if(t[c++]=b,t[c++]=v,t[--u]=v,t[--u]=y,n){let g=i-m;t[d++]=y,t[d++]=g,t[--p]=g,t[--p]=b}}for(let f=1;f<h;f++){let m=Math.PI/2*(f/h),b=s+Math.cos(m)*o,y=n+Math.sin(m)*a,v=e+b,g=e-b,_=i+y,L=i-y;t[c++]=v,t[c++]=_,t[--u]=_,t[--u]=g,t[d++]=g,t[d++]=L,t[--p]=L,t[--p]=v}{let f=s,m=n+a,b=e+f,y=e-f,v=i+m,g=i-m;t[c++]=b,t[c++]=v,t[--p]=g,t[--p]=b,s&&(t[c++]=y,t[c++]=v,t[--p]=g,t[--p]=y)}},triangulate(r,t){let e=r.points,i=t.points,s=t.indices;if(e.length===0)return;let n=i.length/2,o=n,a,h;if(r.type!==ht.RREC){let c=r.shape;a=c.x,h=c.y}else{let c=r.shape;a=c.x+c.width/2,h=c.y+c.height/2}let l=r.matrix;i.push(r.matrix?l.a*a+l.c*h+l.tx:a,r.matrix?l.b*a+l.d*h+l.ty:h),n++,i.push(e[0],e[1]);for(let c=2;c<e.length;c+=2)i.push(e[c],e[c+1]),s.push(n++,o,n);s.push(o+1,o,n)}};function im(r,t=!1){let e=r.length;if(e<6)return;let i=0;for(let s=0,n=r[e-2],o=r[e-1];s<e;s+=2){let a=r[s],h=r[s+1];i+=(a-n)*(h+o),n=a,o=h}if(!t&&i>0||t&&i<=0){let s=e/2;for(let n=s+s%2;n<e;n+=2){let o=e-n-2,a=e-n-1,h=n,l=n+1;[r[o],r[h]]=[r[h],r[o]],[r[a],r[l]]=[r[l],r[a]]}}}var zn={build(r){r.points=r.shape.points.slice()},triangulate(r,t){let e=r.points,i=r.holes,s=t.points,n=t.indices;if(e.length>=6){im(e,!1);let o=[];for(let l=0;l<i.length;l++){let c=i[l];im(c.points,!0),o.push(e.length/2),e=e.concat(c.points)}let a=M.earcut(e,o,2);if(!a)return;let h=s.length/2;for(let l=0;l<a.length;l+=3)n.push(a[l]+h),n.push(a[l+1]+h),n.push(a[l+2]+h);for(let l=0;l<e.length;l++)s.push(e[l])}}};var Ac={build(r){let t=r.shape,e=t.x,i=t.y,s=t.width,n=t.height,o=r.points;o.length=0,s>=0&&n>=0&&o.push(e,i,e+s,i,e+s,i+n,e,i+n)},triangulate(r,t){let e=r.points,i=t.points;if(e.length===0)return;let s=i.length/2;i.push(e[0],e[1],e[2],e[3],e[6],e[7],e[4],e[5]),t.indices.push(s,s+1,s+2,s+1,s+2,s+3)}};var Cc={build(r){di.build(r)},triangulate(r,t){di.triangulate(r,t)}};var Xt=(r=>(r.MITER="miter",r.BEVEL="bevel",r.ROUND="round",r))(Xt||{}),Ae=(r=>(r.BUTT="butt",r.ROUND="round",r.SQUARE="square",r))(Ae||{}),Ce={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(r,t=20){if(!this.adaptive||!r||isNaN(r))return t;let e=Math.ceil(r/this.maxLength);return e<this.minSegments?e=this.minSegments:e>this.maxSegments&&(e=this.maxSegments),e}};var pi=class{static curveTo(t,e,i,s,n,o){let a=o[o.length-2],h=o[o.length-1]-e,l=a-t,c=s-e,u=i-t,d=Math.abs(h*u-l*c);if(d<1e-8||n===0)return(o[o.length-2]!==t||o[o.length-1]!==e)&&o.push(t,e),null;let p=h*h+l*l,f=c*c+u*u,m=h*c+l*u,b=n*Math.sqrt(p)/d,y=n*Math.sqrt(f)/d,v=b*m/p,g=y*m/f,_=b*u+y*l,L=b*c+y*h,G=l*(y+v),F=h*(y+v),B=u*(b+g),$=c*(b+g),q=Math.atan2(F-L,G-_),ut=Math.atan2($-L,B-_);return{cx:_+t,cy:L+e,radius:n,startAngle:q,endAngle:ut,anticlockwise:l*c>u*h}}static arc(t,e,i,s,n,o,a,h,l){let c=a-o,u=Ce._segmentsCount(Math.abs(c)*n,Math.ceil(Math.abs(c)/Cr)*40),d=c/(u*2),p=d*2,f=Math.cos(d),m=Math.sin(d),b=u-1,y=b%1/b;for(let v=0;v<=b;++v){let g=v+y*v,_=d+o+p*g,L=Math.cos(_),G=-Math.sin(_);l.push((f*L+m*G)*n+i,(f*-G+m*L)*n+s)}}};var ws=class{constructor(){this.reset()}begin(t,e,i){this.reset(),this.style=t,this.start=e,this.attribStart=i}end(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}};var Ts=class r{static curveLength(t,e,i,s,n,o,a,h){let l=0,c=0,u=0,d=0,p=0,f=0,m=0,b=0,y=0,v=0,g=0,_=t,L=e;for(let G=1;G<=10;++G)c=G/10,u=c*c,d=u*c,p=1-c,f=p*p,m=f*p,b=m*t+3*f*c*i+3*p*u*n+d*a,y=m*e+3*f*c*s+3*p*u*o+d*h,v=_-b,g=L-y,_=b,L=y,l+=Math.sqrt(v*v+g*g);return l}static curveTo(t,e,i,s,n,o,a){let h=a[a.length-2],l=a[a.length-1];a.length-=2;let c=Ce._segmentsCount(r.curveLength(h,l,t,e,i,s,n,o)),u=0,d=0,p=0,f=0,m=0;a.push(h,l);for(let b=1,y=0;b<=c;++b)y=b/c,u=1-y,d=u*u,p=d*u,f=y*y,m=f*y,a.push(p*h+3*d*y*t+3*u*f*i+m*n,p*l+3*d*y*e+3*u*f*s+m*o)}};function sm(r,t,e,i,s,n,o,a){let h=r-e*s,l=t-i*s,c=r+e*n,u=t+i*n,d,p;o?(d=i,p=-e):(d=-i,p=e);let f=h+d,m=l+p,b=c+d,y=u+p;return a.push(f,m,b,y),2}function fi(r,t,e,i,s,n,o,a){let h=e-r,l=i-t,c=Math.atan2(h,l),u=Math.atan2(s-r,n-t);a&&c<u?c+=Math.PI*2:!a&&c>u&&(u+=Math.PI*2);let d=c,p=u-c,f=Math.abs(p),m=Math.sqrt(h*h+l*l),b=(15*f*Math.sqrt(m)/Math.PI>>0)+1,y=p/b;if(d+=y,a){o.push(r,t,e,i);for(let v=1,g=d;v<b;v++,g+=y)o.push(r,t,r+Math.sin(g)*m,t+Math.cos(g)*m);o.push(r,t,s,n)}else{o.push(e,i,r,t);for(let v=1,g=d;v<b;v++,g+=y)o.push(r+Math.sin(g)*m,t+Math.cos(g)*m,r,t);o.push(s,n,r,t)}return b*2}function Ex(r,t){let e=r.shape,i=r.points||e.points.slice(),s=t.closePointEps;if(i.length===0)return;let n=r.lineStyle,o=new X(i[0],i[1]),a=new X(i[i.length-2],i[i.length-1]),h=e.type!==ht.POLY||e.closeStroke,l=Math.abs(o.x-a.x)<s&&Math.abs(o.y-a.y)<s;if(h){i=i.slice(),l&&(i.pop(),i.pop(),a.set(i[i.length-2],i[i.length-1]));let at=(o.x+a.x)*.5,O=(a.y+o.y)*.5;i.unshift(at,O),i.push(at,O)}let c=t.points,u=i.length/2,d=i.length,p=c.length/2,f=n.width/2,m=f*f,b=n.miterLimit*n.miterLimit,y=i[0],v=i[1],g=i[2],_=i[3],L=0,G=0,F=-(v-_),B=y-g,$=0,q=0,ut=Math.sqrt(F*F+B*B);F/=ut,B/=ut,F*=f,B*=f;let St=n.alignment,k=(1-St)*2,U=St*2;h||(n.cap===Ae.ROUND?d+=fi(y-F*(k-U)*.5,v-B*(k-U)*.5,y-F*k,v-B*k,y+F*U,v+B*U,c,!0)+2:n.cap===Ae.SQUARE&&(d+=sm(y,v,F,B,k,U,!0,c))),c.push(y-F*k,v-B*k,y+F*U,v+B*U);for(let at=1;at<u-1;++at){y=i[(at-1)*2],v=i[(at-1)*2+1],g=i[at*2],_=i[at*2+1],L=i[(at+1)*2],G=i[(at+1)*2+1],F=-(v-_),B=y-g,ut=Math.sqrt(F*F+B*B),F/=ut,B/=ut,F*=f,B*=f,$=-(_-G),q=g-L,ut=Math.sqrt($*$+q*q),$/=ut,q/=ut,$*=f,q*=f;let O=g-y,z=v-_,Z=g-L,nt=G-_,ft=O*Z+z*nt,wt=z*Z-nt*O,yt=wt<0;if(Math.abs(wt)<.001*Math.abs(ft)){c.push(g-F*k,_-B*k,g+F*U,_+B*U),ft>=0&&(n.join===Xt.ROUND?d+=fi(g,_,g-F*k,_-B*k,g-$*k,_-q*k,c,!1)+4:d+=2,c.push(g-$*U,_-q*U,g+$*k,_+q*k));continue}let Ht=(-F+y)*(-B+_)-(-F+g)*(-B+v),ie=(-$+L)*(-q+_)-(-$+g)*(-q+G),Kt=(O*ie-Z*Ht)/wt,se=(nt*Ht-z*ie)/wt,At=(Kt-g)*(Kt-g)+(se-_)*(se-_),Tt=g+(Kt-g)*k,Ct=_+(se-_)*k,Vt=g-(Kt-g)*U,Zt=_-(se-_)*U,Bs=Math.min(O*O+z*z,Z*Z+nt*nt),Cu=yt?k:U,_g=Bs+Cu*Cu*m,xg=At<=_g,ao=n.join;if(ao===Xt.MITER&&At/m>b&&(ao=Xt.BEVEL),xg)switch(ao){case Xt.MITER:{c.push(Tt,Ct,Vt,Zt);break}case Xt.BEVEL:{yt?c.push(Tt,Ct,g+F*U,_+B*U,Tt,Ct,g+$*U,_+q*U):c.push(g-F*k,_-B*k,Vt,Zt,g-$*k,_-q*k,Vt,Zt),d+=2;break}case Xt.ROUND:{yt?(c.push(Tt,Ct,g+F*U,_+B*U),d+=fi(g,_,g+F*U,_+B*U,g+$*U,_+q*U,c,!0)+4,c.push(Tt,Ct,g+$*U,_+q*U)):(c.push(g-F*k,_-B*k,Vt,Zt),d+=fi(g,_,g-F*k,_-B*k,g-$*k,_-q*k,c,!1)+4,c.push(g-$*k,_-q*k,Vt,Zt));break}}else{switch(c.push(g-F*k,_-B*k,g+F*U,_+B*U),ao){case Xt.MITER:{yt?c.push(Vt,Zt,Vt,Zt):c.push(Tt,Ct,Tt,Ct),d+=2;break}case Xt.ROUND:{yt?d+=fi(g,_,g+F*U,_+B*U,g+$*U,_+q*U,c,!0)+2:d+=fi(g,_,g-F*k,_-B*k,g-$*k,_-q*k,c,!1)+2;break}}c.push(g-$*k,_-q*k,g+$*U,_+q*U),d+=2}}y=i[(u-2)*2],v=i[(u-2)*2+1],g=i[(u-1)*2],_=i[(u-1)*2+1],F=-(v-_),B=y-g,ut=Math.sqrt(F*F+B*B),F/=ut,B/=ut,F*=f,B*=f,c.push(g-F*k,_-B*k,g+F*U,_+B*U),h||(n.cap===Ae.ROUND?d+=fi(g-F*(k-U)*.5,_-B*(k-U)*.5,g-F*k,_-B*k,g+F*U,_+B*U,c,!1)+2:n.cap===Ae.SQUARE&&(d+=sm(g,_,F,B,k,U,!1,c)));let pe=t.indices,qt=Ce.epsilon*Ce.epsilon;for(let at=p;at<d+p-2;++at)y=c[at*2],v=c[at*2+1],g=c[(at+1)*2],_=c[(at+1)*2+1],L=c[(at+2)*2],G=c[(at+2)*2+1],!(Math.abs(y*(_-G)+g*(G-v)+L*(v-_))<qt)&&pe.push(at,at+1,at+2)}function Sx(r,t){let e=0,i=r.shape,s=r.points||i.points,n=i.type!==ht.POLY||i.closeStroke;if(s.length===0)return;let o=t.points,a=t.indices,h=s.length/2,l=o.length/2,c=l;for(o.push(s[0],s[1]),e=1;e<h;e++)o.push(s[e*2],s[e*2+1]),a.push(c,c+1),c++;n&&a.push(c,l)}function Wn(r,t){r.lineStyle.native?Sx(r,t):Ex(r,t)}var Es=class r{static curveLength(t,e,i,s,n,o){let a=t-2*i+n,h=e-2*s+o,l=2*i-2*t,c=2*s-2*e,u=4*(a*a+h*h),d=4*(a*l+h*c),p=l*l+c*c,f=2*Math.sqrt(u+d+p),m=Math.sqrt(u),b=2*u*m,y=2*Math.sqrt(p),v=d/m;return(b*f+m*d*(f-y)+(4*p*u-d*d)*Math.log((2*m+v+f)/(v+y)))/(4*b)}static curveTo(t,e,i,s,n){let o=n[n.length-2],a=n[n.length-1],h=Ce._segmentsCount(r.curveLength(o,a,t,e,i,s)),l=0,c=0;for(let u=1;u<=h;++u){let d=u/h;l=o+(t-o)*d,c=a+(e-a)*d,n.push(l+(t+(i-t)*d-l)*d,c+(e+(s-e)*d-c)*d)}}};var Xn={[ht.POLY]:zn,[ht.CIRC]:di,[ht.ELIP]:di,[ht.RECT]:Ac,[ht.RREC]:Cc},Na=[],Ss=[];var As=class r{constructor(t,e=null,i=null,s=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=i,this.fillStyle=e,this.matrix=s,this.type=t.type}clone(){return new r(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}};var Cs=new X,nm=class om extends Xr{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new We,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),Ss.push(this.drawCalls[t]);this.drawCalls.length=0;for(let t=0;t<this.batches.length;t++){let e=this.batches[t];e.reset(),Na.push(e)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(t,e=null,i=null,s=null){let n=new As(t,e,i,s);return this.graphicsData.push(n),this.dirty++,this}drawHole(t,e=null){if(!this.graphicsData.length)return null;let i=new As(t,null,null,e),s=this.graphicsData[this.graphicsData.length-1];return i.lineStyle=s.lineStyle,s.holes.push(i),this.dirty++,this}destroy(){super.destroy();for(let t=0;t<this.graphicsData.length;++t)this.graphicsData[t].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(t){let e=this.graphicsData;for(let i=0;i<e.length;++i){let s=e[i];if(s.fillStyle.visible&&s.shape&&(s.matrix?s.matrix.applyInverse(t,Cs):Cs.copyFrom(t),s.shape.contains(Cs.x,Cs.y))){let n=!1;if(s.holes){for(let o=0;o<s.holes.length;o++)if(s.holes[o].shape.contains(Cs.x,Cs.y)){n=!0;break}}if(!n)return!0}}return!1}updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return}if(!this.validateBatching())return;this.cacheDirty=this.dirty;let t=this.uvs,e=this.graphicsData,i=null,s=null;this.batches.length>0&&(i=this.batches[this.batches.length-1],s=i.style);for(let h=this.shapeIndex;h<e.length;h++){this.shapeIndex++;let l=e[h],c=l.fillStyle,u=l.lineStyle;Xn[l.type].build(l),l.matrix&&this.transformPoints(l.points,l.matrix),(c.visible||u.visible)&&this.processHoles(l.holes);for(let d=0;d<2;d++){let p=d===0?c:u;if(!p.visible)continue;let f=p.texture.baseTexture,m=this.indices.length,b=this.points.length/2;f.wrapMode=br.REPEAT,d===0?this.processFill(l):this.processLine(l);let y=this.points.length/2-b;y!==0&&(i&&!this._compareStyles(s,p)&&(i.end(m,b),i=null),i||(i=Na.pop()||new ws,i.begin(p,m,b),this.batches.push(i),s=p),this.addUvs(this.points,t,p.texture,b,y,p.matrix))}}let n=this.indices.length,o=this.points.length/2;if(i&&i.end(n,o),this.batches.length===0){this.batchable=!0;return}let a=o>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&a===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=a?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(t,e){return!(!t||!e||t.texture.baseTexture!==e.texture.baseTexture||t.color+t.alpha!==e.color+e.alpha||!!t.native!=!!e.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let t=0,e=this.graphicsData.length;t<e;t++){let i=this.graphicsData[t],s=i.fillStyle,n=i.lineStyle;if(s&&!s.texture.baseTexture.valid||n&&!n.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);let t=this.batches;for(let e=0,i=t.length;e<i;e++){let s=t[e];for(let n=0;n<s.size;n++){let o=s.start+n;this.indicesUint16[o]=this.indicesUint16[o]-s.attribStart}}}isBatchable(){if(this.points.length>65535*2)return!1;let t=this.batches;for(let e=0;e<t.length;e++)if(t[e].style.native)return!1;return this.points.length<om.BATCHABLE_SIZE*2}buildDrawCalls(){let t=++j._globalBatch;for(let u=0;u<this.drawCalls.length;u++)this.drawCalls[u].texArray.clear(),Ss.push(this.drawCalls[u]);this.drawCalls.length=0;let e=this.colors,i=this.textureIds,s=Ss.pop();s||(s=new Ar,s.texArray=new Pr),s.texArray.count=0,s.start=0,s.size=0,s.type=Ie.TRIANGLES;let n=0,o=null,a=0,h=!1,l=Ie.TRIANGLES,c=0;this.drawCalls.push(s);for(let u=0;u<this.batches.length;u++){let d=this.batches[u],p=8,f=d.style,m=f.texture.baseTexture;h!==!!f.native&&(h=!!f.native,l=h?Ie.LINES:Ie.TRIANGLES,o=null,n=p,t++),o!==m&&(o=m,m._batchEnabled!==t&&(n===p&&(t++,n=0,s.size>0&&(s=Ss.pop(),s||(s=new Ar,s.texArray=new Pr),this.drawCalls.push(s)),s.start=c,s.size=0,s.texArray.count=0,s.type=l),m.touched=1,m._batchEnabled=t,m._batchLocation=n,m.wrapMode=br.REPEAT,s.texArray.elements[s.texArray.count++]=m,n++)),s.size+=d.size,c+=d.size,a=m._batchLocation,this.addColors(e,f.color,f.alpha,d.attribSize,d.attribStart),this.addTextureIds(i,a,d.attribSize,d.attribStart)}j._globalBatch=t,this.packAttributes()}packAttributes(){let t=this.points,e=this.uvs,i=this.colors,s=this.textureIds,n=new ArrayBuffer(t.length*3*4),o=new Float32Array(n),a=new Uint32Array(n),h=0;for(let l=0;l<t.length/2;l++)o[h++]=t[l*2],o[h++]=t[l*2+1],o[h++]=e[l*2],o[h++]=e[l*2+1],a[h++]=i[l],o[h++]=s[l];this._buffer.update(n),this._indexBuffer.update(this.indicesUint16)}processFill(t){t.holes.length?zn.triangulate(t,this):Xn[t.type].triangulate(t,this)}processLine(t){Wn(t,this);for(let e=0;e<t.holes.length;e++)Wn(t.holes[e],this)}processHoles(t){for(let e=0;e<t.length;e++){let i=t[e];Xn[i.type].build(i),i.matrix&&this.transformPoints(i.points,i.matrix)}}calculateBounds(){let t=this._bounds;t.clear(),t.addVertexData(this.points,0,this.points.length),t.pad(this.boundsPadding,this.boundsPadding)}transformPoints(t,e){for(let i=0;i<t.length/2;i++){let s=t[i*2],n=t[i*2+1];t[i*2]=e.a*s+e.c*n+e.tx,t[i*2+1]=e.b*s+e.d*n+e.ty}}addColors(t,e,i,s,n=0){let o=J.shared.setValue(e).toLittleEndianNumber(),a=J.shared.setValue(o).toPremultiplied(i);t.length=Math.max(t.length,n+s);for(let h=0;h<s;h++)t[n+h]=a}addTextureIds(t,e,i,s=0){t.length=Math.max(t.length,s+i);for(let n=0;n<i;n++)t[s+n]=e}addUvs(t,e,i,s,n,o=null){let a=0,h=e.length,l=i.frame;for(;a<n;){let u=t[(s+a)*2],d=t[(s+a)*2+1];if(o){let p=o.a*u+o.c*d+o.tx;d=o.b*u+o.d*d+o.ty,u=p}a++,e.push(u/l.width,d/l.height)}let c=i.baseTexture;(l.width<c.width||l.height<c.height)&&this.adjustUvs(e,i,h,n)}adjustUvs(t,e,i,s){let n=e.baseTexture,o=1e-6,a=i+s*2,h=e.frame,l=h.width/n.width,c=h.height/n.height,u=h.x/h.width,d=h.y/h.height,p=Math.floor(t[i]+o),f=Math.floor(t[i+1]+o);for(let m=i+2;m<a;m+=2)p=Math.min(p,Math.floor(t[m]+o)),f=Math.min(f,Math.floor(t[m+1]+o));u-=p,d-=f;for(let m=i;m<a;m+=2)t[m]=(t[m]+u)*l,t[m+1]=(t[m+1]+d)*c}};nm.BATCHABLE_SIZE=100;var Ic=nm;var mi=class r{constructor(){this.color=16777215,this.alpha=1,this.texture=x.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){let t=new r;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=x.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}};var Yn=class r extends mi{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=Ae.BUTT,this.join=Xt.MITER,this.miterLimit=10}clone(){let t=new r;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1,this.cap=Ae.BUTT,this.join=Xt.MITER,this.miterLimit=10}};var Pc={},Rc=class Da extends A{constructor(t=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new mi,this._lineStyle=new Yn,this._matrix=null,this._holeMode=!1,this.state=ve.for2d(),this._geometry=t||new Ic,this._geometry.refCount++,this._transformID=-1,this._tintColor=new J(16777215),this.blendMode=D.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new Da(this._geometry)}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(t=null,e=0,i,s=.5,n=!1){return typeof t=="number"&&(t={width:t,color:e,alpha:i,alignment:s,native:n}),this.lineTextureStyle(t)}lineTextureStyle(t){let e={width:0,texture:x.WHITE,color:t?.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:Ae.BUTT,join:Xt.MITER,miterLimit:10};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();let i=t.width>0&&t.alpha>0;return i?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:i},t)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){let t=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new Ir,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[e-2],t[e-1]))}else this.currentPath=new Ir,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(t,e){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=e,this}lineTo(t,e){this.currentPath||this.moveTo(0,0);let i=this.currentPath.points,s=i[i.length-2],n=i[i.length-1];return(s!==t||n!==e)&&i.push(t,e),this}_initCurve(t=0,e=0){this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[t,e]):this.moveTo(t,e)}quadraticCurveTo(t,e,i,s){this._initCurve();let n=this.currentPath.points;return n.length===0&&this.moveTo(0,0),Es.curveTo(t,e,i,s,n),this}bezierCurveTo(t,e,i,s,n,o){return this._initCurve(),Ts.curveTo(t,e,i,s,n,o,this.currentPath.points),this}arcTo(t,e,i,s,n){this._initCurve(t,e);let o=this.currentPath.points,a=pi.curveTo(t,e,i,s,n,o);if(a){let{cx:h,cy:l,radius:c,startAngle:u,endAngle:d,anticlockwise:p}=a;this.arc(h,l,c,u,d,p)}return this}arc(t,e,i,s,n,o=!1){if(s===n)return this;if(!o&&n<=s?n+=Cr:o&&s<=n&&(s+=Cr),n-s===0)return this;let a=t+Math.cos(s)*i,h=e+Math.sin(s)*i,l=this._geometry.closePointEps,c=this.currentPath?this.currentPath.points:null;if(c){let u=Math.abs(c[c.length-2]-a),d=Math.abs(c[c.length-1]-h);u<l&&d<l||c.push(a,h)}else this.moveTo(a,h),c=this.currentPath.points;return pi.arc(a,h,t,e,i,s,n,o,c),this}beginFill(t=0,e){return this.beginTextureFill({texture:x.WHITE,color:t,alpha:e})}normalizeColor(t){let e=J.shared.setValue(t.color??0);t.color=e.toNumber(),t.alpha??(t.alpha=e.alpha)}beginTextureFill(t){let e={texture:x.WHITE,color:16777215,matrix:null};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();let i=t.alpha>0;return i?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:i},t)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(t,e,i,s){return this.drawShape(new H(t,e,i,s))}drawRoundedRect(t,e,i,s,n){return this.drawShape(new zi(t,e,i,s,n))}drawCircle(t,e,i){return this.drawShape(new ji(t,e,i))}drawEllipse(t,e,i,s){return this.drawShape(new $i(t,e,i,s))}drawPolygon(...t){let e,i=!0,s=t[0];s.points?(i=s.closeStroke,e=s.points):Array.isArray(t[0])?e=t[0]:e=t;let n=new Ir(e);return n.closeStroke=i,this.drawShape(n),this}drawShape(t){return this._holeMode?this._geometry.drawHole(t,this._matrix):this._geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){let t=this._geometry.graphicsData;return t.length===1&&t[0].shape.type===ht.RECT&&!t[0].matrix&&!t[0].holes.length&&!(t[0].lineStyle.visible&&t[0].lineStyle.width)}_render(t){this.finishPoly();let e=this._geometry;e.updateBatches(),e.batchable?(this.batchDirty!==e.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))}_populateBatches(){let t=this._geometry,e=this.blendMode,i=t.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.batches.length=i,this.vertexData=new Float32Array(t.points);for(let s=0;s<i;s++){let n=t.batches[s],o=n.style.color,a=new Float32Array(this.vertexData.buffer,n.attribStart*4*2,n.attribSize*2),h=new Float32Array(t.uvsFloat32.buffer,n.attribStart*4*2,n.attribSize*2),l=new Uint16Array(t.indicesUint16.buffer,n.start*2,n.size),c={vertexData:a,blendMode:e,indices:l,uvs:h,_batchRGB:J.shared.setValue(o).toRgbArray(),_tintRGB:o,_texture:n.style.texture,alpha:n.style.alpha,worldAlpha:1};this.batches[s]=c}}_renderBatched(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let e=0,i=this.batches.length;e<i;e++){let s=this.batches[e];s.worldAlpha=this.worldAlpha*s.alpha,t.plugins[this.pluginName].render(s)}}}_renderDirect(t){let e=this._resolveDirectShader(t),i=this._geometry,s=this.worldAlpha,n=e.uniforms,o=i.drawCalls;n.translationMatrix=this.transform.worldTransform,J.shared.setValue(this._tintColor).premultiply(s).toArray(n.tint),t.shader.bind(e),t.geometry.bind(i,e),t.state.set(this.state);for(let a=0,h=o.length;a<h;a++)this._renderDrawCallDirect(t,i.drawCalls[a])}_renderDrawCallDirect(t,e){let{texArray:i,type:s,size:n,start:o}=e,a=i.count;for(let h=0;h<a;h++)t.texture.bind(i.elements[h],h);t.geometry.draw(s,n,o)}_resolveDirectShader(t){let e=this.shader,i=this.pluginName;if(!e){if(!Pc[i]){let{maxTextures:s}=t.plugins[i],n=new Int32Array(s);for(let h=0;h<s;h++)n[h]=h;let o={tint:new Float32Array([1,1,1,1]),translationMatrix:new tt,default:ee.from({uSamplers:n},!0)},a=t.plugins[i]._shader.program;Pc[i]=new ar(a,o)}e=Pc[i]}return e}_calculateBounds(){this.finishPoly();let t=this._geometry;if(!t.graphicsData.length)return;let{minX:e,minY:i,maxX:s,maxY:n}=t.bounds;this._bounds.addFrame(this.transform,e,i,s,n)}containsPoint(t){return this.worldTransform.applyInverse(t,Da._TEMP_POINT),this._geometry.containsPoint(Da._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let t=0;t<this.batches.length;t++){let e=this.batches[t];e._tintRGB=J.shared.setValue(this._tintColor).multiply(e._batchRGB).toLittleEndianNumber()}}}calculateVertices(){let t=this.transform._worldID;if(this._transformID===t)return;this._transformID=t;let e=this.transform.worldTransform,i=e.a,s=e.b,n=e.c,o=e.d,a=e.tx,h=e.ty,l=this._geometry.points,c=this.vertexData,u=0;for(let d=0;d<l.length;d+=2){let p=l[d],f=l[d+1];c[u++]=i*p+n*f+a,c[u++]=o*f+s*p+h}}closePath(){let t=this.currentPath;return t&&(t.closeStroke=!0,this.finishPoly()),this}setMatrix(t){return this._matrix=t,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(t){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(t)}};Rc.curves=Ce,Rc._TEMP_POINT=new X;var qn=Rc;var Ax=[1,2,4],Ua={hitboxPadding:40},Is=class r extends A{hitbox;roadMark;items;lane;constructor(){super(),this.roadMark=new E(x.from("Obs-11")),this.roadMark.anchor.set(.5,0),this.items=new A,this.hitbox=new qn,this.scale.set(.5),this.addChild(this.roadMark),this.addChild(this.hitbox),this.addChild(this.items)}static create(){let t=new r;return r.reset(t),t}static reset(t){let e=r.getRandomId(),i=Math.floor(Math.random()*3)+4;t.items.removeChildren();let s=0,n=0;for(let o=0;o<i;o++){let a=new E(x.from(`Obs-${e}`));a.position.set(s,n),s+=a.width,s>t.roadMark.width-2*Ua.hitboxPadding&&(s=0,n+=a.width),t.items.addChild(a)}t.items.pivot.x=t.items.width/2,t.hitbox.clear(),t.hitbox.beginFill(16777215,.5),t.hitbox.drawRect(-t.items.width/2+Ua.hitboxPadding,Ua.hitboxPadding,t.items.width-Ua.hitboxPadding*2,t.items.height*.9),t.hitbox.endFill(),t.hitbox.visible=!1}static destroyObstacle(t){t.destroy({children:!0})}static getRandomId(){return Ut([...Ax],[1,1,1])}};var Cx={spawnPeriodMS:5e3},Ga=class{config;lastSpawnedMS;obstacles=new Lt(Is.create,Is.reset,Is.destroyObstacle);onSpawn=new Se;constructor(t){this.config=Object.assign({},Cx,t||{}),this.lastSpawnedMS=0}spawn(){return this.obstacles.getInstance()}update(t){this.lastSpawnedMS+=t,this.lastSpawnedMS>this.config.spawnPeriodMS&&(this.lastSpawnedMS-=this.config.spawnPeriodMS,this.spawn())}};var Ha=160,Mc=[[{lane:0,possibleEnemies:["regular","taxi","obstacle"],offsetRange:[0,0]},{lane:1,possibleEnemies:["fuel","regular","taxi","obstacle"],offsetRange:[0,Ha]}],[{lane:0,possibleEnemies:["regular","taxi"],offsetRange:[0,Ha]},{lane:2,possibleEnemies:["regular"],offsetRange:[0,0]}],[{lane:0,possibleEnemies:["regular","taxi"],offsetRange:[0,Ha]},{lane:2,possibleEnemies:["fuel","moneyvan","hpvan","obstacle"],offsetRange:[0,Ha]},{lane:4,possibleEnemies:["regular","obstacle"],offsetRange:[0,0]}]],Va=class{laneData;constructor(t,e=0,i=!1){this.laneData=t.map(s=>({lane:this.pickLane(s.lane,e,i),enemy:this.pickEnemyKind(s.possibleEnemies),offset:this.pickEnemyOffset(s.offsetRange)}))}pickLane(t,e,i){return(t+e)%Yt.laneCount}pickEnemyKind(t){return Ut(t,Array(t.length).fill(1))}pickEnemyOffset(t){return tr(t[0],t[1])}};var ja=class{road;enemySpawner;obstacleSpawner;container;enemyContainer;obstacleContainer;timeToMysteryCarMS;timeToBossMS;bossMode;constructor(t){this.road=t,this.timeToBossMS=gt.timeToBossMS,this.bossMode=!1,this.enemySpawner=new vs,this.obstacleSpawner=new Ga,this.container=new A,this.enemyContainer=new A,this.obstacleContainer=new A,this.container.addChild(this.obstacleContainer),this.container.addChild(this.enemyContainer),this.enemySpawner.onSpawn.add(()=>{this.bossMode||this.spawnThreats()}),this.timeToMysteryCarMS=gt.mysteryCarPeriodMS}spawnThreats(){let t=Ut(Mc,Array(Mc.length).fill(1));new Va(t,tr(0,Yt.laneCount-1)).laneData.forEach(i=>{if(this.road.lanes[i.lane]<1){let s,n;i.enemy!="obstacle"?(s=this.enemySpawner.cars.getInstance(),n=this.enemyContainer,vs.changeCarKind(s,i.enemy)):(s=this.obstacleSpawner.obstacles.getInstance(),n=this.obstacleContainer),this.addThreatToLane(s,n,i.lane,i.offset)}})}addThreatToLane(t,e,i,s=0){t.lane=i,e.addChild(t),t.position.set(this.road.getLaneX(i),-t.height-s),this.road.increaseLaneOccupancy(i)}update(t){this.bossMode||(this.timeToBossMS-=t,this.checkMysteryCarSpawn(t),this.enemySpawner.update(t),this.timeToBossMS<=0&&this.spawnBoss())}spawnBoss(){this.bossMode=!0,et.emit("BOSS_APPEAR")}disableBossMode(){this.bossMode=!1,this.timeToBossMS=gt.timeToBossMS}clearThreats(){this.enemySpawner.cars.activeInstances.forEach(t=>this.enemySpawner.cars.release(t)),this.obstacleSpawner.obstacles.activeInstances.forEach(t=>this.obstacleSpawner.obstacles.release(t)),this.road.clearLanes()}resetTimers(){this.enemySpawner.resetTimer()}checkMysteryCarSpawn(t){if(this.timeToMysteryCarMS-=t,this.timeToMysteryCarMS<0){let e=this.road.getFreeLane();if(e!==void 0){let i=this.enemySpawner.cars.getInstance();vs.changeCarKind(i,"mystery"),this.addThreatToLane(i,this.enemyContainer,e,0),this.timeToMysteryCarMS=gt.mysteryCarPeriodMS}}}releaseEnemy(t){this.road.decreaseLaneOccupancy(t.lane),this.enemySpawner.cars.release(t)}releaseObstacle(t){this.road.decreaseLaneOccupancy(t.lane),this.obstacleSpawner.obstacles.release(t)}get enemies(){return this.enemySpawner.cars}get activeEnemies(){return this.enemySpawner.cars.activeInstances}get obstacles(){return this.obstacleSpawner.obstacles}get activeObstacles(){return this.obstacleSpawner.obstacles.activeInstances}clearSignals(){this.enemySpawner.onSpawn.removeAll(),this.obstacleSpawner.onSpawn.removeAll()}};var $a={projectileOffsetX:30,projectileOffsetY:-120},za=class extends ce{rotation=0;body;constructor(t){super(t||{},new Lt(()=>ms.createProjectile(2),ce.resetProjectile,ce.destroyProjectile)),this.lastFiredMS=0,this.body=new E(x.from("Boss_Weapon_Front")),this.body.scale.set(.5),this.body.anchor.set(.5,.7)}aim(t){this.rotation=Math.atan2(t.y-this.body.parent.y,t.x-this.body.parent.x),this.body.rotation=this.rotation+Math.PI/2}fire(){let t=this.projectiles.getInstance();t.rotation=this.rotation+Math.PI/2,this.body.addChild(t),t.position.set(-$a.projectileOffsetX,$a.projectileOffsetY),this.onFire.dispatch([t]);let e=this.projectiles.getInstance();e.rotation=this.rotation+Math.PI/2,this.body.addChild(e),e.position.set($a.projectileOffsetX,$a.projectileOffsetY),this.onFire.dispatch([e])}};function am(r){return r<.5?2*r*r:1-Math.pow(-2*r+2,2)/2}var Ix={threshold:.2,moveTime:1e3,checkPeriodMS:2e3},Wa=class{config;checkTime;steeredCar;targetCar;oldX;targetX;movementTime;constructor(t,e,i){this.config=Object.assign({},Ix,t),this.steeredCar=e,this.targetCar=i,this.oldX=this.steeredCar.roadX,this.targetX=this.targetCar.roadX,this.checkTime=0}update(t){this.checkTime+=t,this.checkTime>=this.config.checkPeriodMS&&Math.abs(this.steeredCar.roadX-this.targetCar.roadX)>this.config.threshold&&(this.checkTime-=this.config.checkPeriodMS,this.startMoving(this.targetCar.roadX)),this.movementTime<this.config.moveTime&&this.adjustPosition(t)}startMoving(t){this.oldX=this.steeredCar.roadX,this.targetX=t,this.movementTime=0}adjustPosition(t){this.movementTime+=t,this.steeredCar.roadX=this.oldX+(this.targetX-this.oldX)*am(this.movementTime/this.config.moveTime)}};var Xa=class extends Br{target;steering;healthBar;level;gun;constructor(t){super(),this.level=t,this.body=new E(x.from("Boss-Car")),this.body.anchor.set(.5),this.body.scale.set(.75),this.gun=new za({firePeriodMS:1e3,projectileSpeed:.7}),this.addChild(this.body),this.addChild(this.gun.body),this.scale.set(1.5),this.healthBar=new _s,this.healthBar.y=this.body.height/2+this.healthBar.height/2,this.healthBar.scale.set(.25),this.addChild(this.healthBar),this.resetHealth(t)}setTarget(t){this.target=t,this.steering=new Wa({},this,this.target)}update(t){this.gun.aim(this.target.position),this.steering&&this.steering.update(t)}takeDamage(t){this.health-=t,this.healthBar.visible=!0,this.healthBar.updateValue(this.health/this.getHealthForLevel(this.level))}resetHealth(t){this.healthBar.visible=!1,this.health=this.getHealthForLevel(t),this.healthBar.updateValue(1)}getHealthForLevel(t){return 1800+t*300}getRewardForLevel(t){return Math.round((130+t*(10+t))/10)*10}};var Ya=class extends A{icon;bg;fill;fillMask;tween;constructor(){super(),this.icon=new E(x.from("icon-health")),this.bg=new E(x.from("health-progress-back")),this.fill=new E(x.from("health-progress-full")),[this.bg,this.fill,this.icon].forEach(t=>t.anchor.set(.5)),this.icon.position.x-=this.bg.width/2,this.tween=new st(this.fill).easing(it.Cubic.InOut).duration(300),this.updateValue(1),this.fillMask=new qn,this.fillMask.beginFill(16777215),this.fillMask.drawRect(-this.bg.width/2+4,-this.bg.height/2,this.bg.width,this.bg.height),this.fill.mask=this.fillMask,this.addChild(this.fillMask),this.addChild(this.bg),this.addChild(this.fill),this.addChild(this.icon)}updateValue(t){this.tween.dynamicTo({x:-this.bg.width*(1-t)}).restart()}};var Ps=class extends A{text;constructor(){super();let t=new E(x.from("panel-profile")),e=new E(x.from("icon-rep")),i=new E(x.from("icon-profile")),s=new K("0",{fontFamily:R.font,fontSize:48,fill:16777215});[t,i,e].forEach(n=>{n.anchor.set(.5)}),s.anchor.set(0,.5),i.position.set(-145,-15),e.position.set(-30,0),s.position.set(20,0),this.addChild(t),this.addChild(i),this.addChild(e),this.text=this.addChild(s)}updateValue(t){this.text.text=t.toString()}};var Gt={width:300,height:30},qa=class extends A{start;finish;fullBar;currentProgress;currentMarker;duration;g;progressValue=0;constructor(){super(),this.fullBar=new E(x.WHITE),this.fullBar.scale.set(Gt.width/16,Gt.height/16),this.fullBar.alpha=.5,this.fullBar.anchor.set(.5),this.currentProgress=new E(x.WHITE),this.currentProgress.scale.set(Gt.width/16*this.progressValue,Gt.height/16),this.currentProgress.anchor.set(0,.5),this.currentProgress.x=-Gt.width/2,this.currentProgress.tint=2017783,this.start=new E(x.from("progress-meter-start")),this.finish=new E(x.from("progress-meter-finish")),this.currentMarker=new E(x.from("icon-car")),[this.start,this.finish,this.currentMarker].forEach(t=>t.anchor.set(.5)),this.start.x=-Gt.width/2,this.currentMarker.position.set(this.start.x,-35),this.finish.x=Gt.width/2,this.addChild(this.fullBar),this.addChild(this.currentProgress),this.addChild(this.currentMarker),this.addChild(this.start),this.addChild(this.finish)}drawBar(){this.g.clear(),this.g.beginFill(J.shared.setValue({r:255,g:255,b:255,a:.5})),this.g.drawRect(-Gt.width/2,-Gt.height/2,Gt.width,Gt.height),this.g.endFill(),this.g.beginFill(2217723),this.g.drawRect(-Gt.width/2,-Gt.height/2,Gt.width*this.progressValue,Gt.height)}updateValue(t){this.progressValue=t,this.currentMarker.x=Gt.width*(t-.5),this.currentProgress.scale.x=Gt.width/16*this.progressValue}};var Ka=class extends A{playerHealth;progress;money;reputation;constructor(){super(),this.money=new Dt("Money"),this.reputation=new Ps,this.progress=new qa,this.playerHealth=new Ya,this.addChild(this.progress),this.addChild(this.money),this.addChild(this.reputation),this.addChild(this.playerHealth),this.positionElements()}setMoney(t){this.money.updateValue(t)}setReputation(t){this.reputation.updateValue(t)}setProgress(t){this.progress.updateValue(t)}setHealth(t){this.playerHealth.updateValue(t)}positionElements(){this.reputation.position.set(C.width/2-300,80),this.progress.position.set(C.width/2+40,80),this.money.position.set(C.width/2+400,80),this.playerHealth.position.set(this.reputation.position.x-20,this.reputation.getBounds().bottom+5)}};function Px(r,t){let e=t.x-r.x,i=t.y-r.y;return e*e+i*i}function hm(r,t){return Math.sqrt(Px(r,t))}var Za=class extends A{title;titleBg;titleLabel;rewards;mainBg;rewardLabel;reward;constructor(t){super(),this.title=new A,this.titleBg=new E(x.from("panel-boss-title")),this.mainBg=new E(x.from("panel-boss-appear")),this.titleLabel=new K(R.getText("Boss").toUpperCase(),{fontFamily:R.font,fill:2108255,fontSize:54}),this.rewards=new A,this.rewardLabel=new K(R.getText("Bounty").toUpperCase(),{fontFamily:R.font,fill:16777215,fontSize:54}),this.reward=new Dt("Money"),this.reward.updateValue(t),[this.titleBg,this.mainBg,this.titleLabel,this.rewardLabel].forEach(e=>e.anchor.set(.5)),this.title.addChild(this.titleBg),this.title.addChild(this.titleLabel),this.rewards.addChild(this.rewardLabel),this.rewards.addChild(this.reward),this.addChild(this.mainBg),this.addChild(this.title),this.addChild(this.rewards),this.positionElements()}positionElements(){this.title.position.set(10,-100),this.mainBg.position.set(0,-30),this.rewards.position.set(-15,10),this.rewardLabel.position.set(-150,0),this.reward.position.set(150,0)}};var Qa=class extends A{title;titleBg;titleLabel;rewards;mainBg;rewardLabel;reward;constructor(t){super(),this.title=new A,this.titleBg=new E(x.from("panel-boss-title")),this.mainBg=new E(x.from("panel-boss-complete")),this.titleLabel=new K(R.getText("Boss defeated").toUpperCase(),{fontFamily:R.font,fill:2108255,fontSize:54}),this.rewards=new A,this.rewardLabel=new K(R.getText("Reward").toUpperCase(),{fontFamily:R.font,fill:16777215,fontSize:54}),this.reward=new Dt("Money"),this.reward.updateValue(t),[this.titleBg,this.mainBg,this.titleLabel,this.rewardLabel].forEach(e=>e.anchor.set(.5)),this.title.addChild(this.titleBg),this.title.addChild(this.titleLabel),this.rewards.addChild(this.rewardLabel),this.rewards.addChild(this.reward),this.addChild(this.mainBg),this.addChild(this.title),this.addChild(this.rewards),this.positionElements()}positionElements(){this.title.position.set(10,-100),this.mainBg.position.set(0,-30),this.rewards.position.set(-15,10),this.rewardLabel.position.set(-150,0),this.reward.position.set(150,0)}};var Ja=class extends A{dimmer;text;tween;constructor(){super(),this.tween=new st(this).from({alpha:0}).to({alpha:1},300).easing(it.Quadratic.InOut),this.dimmer=new E(x.WHITE),this.dimmer.scale.set(C.width/this.dimmer.texture.width,C.height/this.dimmer.texture.height),this.dimmer.tint=0,this.dimmer.alpha=.7,this.text=new K(R.getText("Tap to play"),{fontFamily:R.font,fontSize:108,fill:16777215,align:"center"}),this.text.anchor.set(.5),this.text.position.set(C.width/2,C.height*.7),this.alpha=0,this.addChild(this.dimmer),this.addChild(this.text)}tweenShow(){this.tween.start()}};var th=class extends A{text;constructor(){super();let t=new E(x.from("panel-end-rep")),e=new E(x.from("icon-rep"));e.scale.set(1.5);let i=new K(R.getText("Rep:"),{fontFamily:R.font,fontSize:64,fill:16777215}),s=new K("0",{fontFamily:R.font,fontSize:64,fill:16777215});[t].forEach(n=>{n.anchor.set(.5)}),[i,e,s].forEach(n=>{n.anchor.set(0,.5)}),i.position.set(-t.width/2+40,0),e.position.set(i.getBounds().right+40,0),s.position.set(e.getBounds().right+40,0),this.addChild(t),this.addChild(i),this.addChild(e),this.text=this.addChild(s)}updateValue(t){this.text.text=t.toString()}};var Rx=Object.defineProperty,Mx=(r,t,e)=>t in r?Rx(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,vt=(r,t,e)=>(Mx(r,typeof t!="symbol"?t+"":t,e),e);var Fm=function(r){let t=[],e=0;for(let i=0;i<r.length;i++){let s=r.charCodeAt(i);s<128?t[e++]=s:s<2048?(t[e++]=s>>6|192,t[e++]=s&63|128):(s&64512)===55296&&i+1<r.length&&(r.charCodeAt(i+1)&64512)===56320?(s=65536+((s&1023)<<10)+(r.charCodeAt(++i)&1023),t[e++]=s>>18|240,t[e++]=s>>12&63|128,t[e++]=s>>6&63|128,t[e++]=s&63|128):(t[e++]=s>>12|224,t[e++]=s>>6&63|128,t[e++]=s&63|128)}return t},Fx=function(r){let t=[],e=0,i=0;for(;e<r.length;){let s=r[e++];if(s<128)t[i++]=String.fromCharCode(s);else if(s>191&&s<224){let n=r[e++];t[i++]=String.fromCharCode((s&31)<<6|n&63)}else if(s>239&&s<365){let n=r[e++],o=r[e++],a=r[e++],h=((s&7)<<18|(n&63)<<12|(o&63)<<6|a&63)-65536;t[i++]=String.fromCharCode(55296+(h>>10)),t[i++]=String.fromCharCode(56320+(h&1023))}else{let n=r[e++],o=r[e++];t[i++]=String.fromCharCode((s&15)<<12|(n&63)<<6|o&63)}}return t.join("")},Bm={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(r,t){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();let e=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let s=0;s<r.length;s+=3){let n=r[s],o=s+1<r.length,a=o?r[s+1]:0,h=s+2<r.length,l=h?r[s+2]:0,c=n>>2,u=(n&3)<<4|a>>4,d=(a&15)<<2|l>>6,p=l&63;h||(p=64,o||(d=64)),i.push(e[c],e[u],e[d],e[p])}return i.join("")},encodeString(r,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(r):this.encodeByteArray(Fm(r),t)},decodeString(r,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(r):Fx(this.decodeStringToByteArray(r,t))},decodeStringToByteArray(r,t){this.init_();let e=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let s=0;s<r.length;){let n=e[r.charAt(s++)],o=s<r.length?e[r.charAt(s)]:0;++s;let a=s<r.length?e[r.charAt(s)]:64;++s;let h=s<r.length?e[r.charAt(s)]:64;if(++s,n==null||o==null||a==null||h==null)throw new jc;let l=n<<2|o>>4;if(i.push(l),a!==64){let c=o<<4&240|a>>2;if(i.push(c),h!==64){let u=a<<6&192|h;i.push(u)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let r=0;r<this.ENCODED_VALS.length;r++)this.byteToCharMap_[r]=this.ENCODED_VALS.charAt(r),this.charToByteMap_[this.byteToCharMap_[r]]=r,this.byteToCharMapWebSafe_[r]=this.ENCODED_VALS_WEBSAFE.charAt(r),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[r]]=r,r>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(r)]=r,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(r)]=r)}}},jc=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},Bx=function(r){let t=Fm(r);return Bm.encodeByteArray(t,!0)},Lm=function(r){return Bx(r).replace(/\./g,"")},Lx=function(r){try{return Bm.decodeString(r,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function kx(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var Ox=()=>kx().__FIREBASE_DEFAULTS__,Nx=()=>{if(typeof process>"u"||typeof process.env>"u")return;let r=process.env.__FIREBASE_DEFAULTS__;if(r)return JSON.parse(r)},Dx=()=>{if(typeof document>"u")return;let r;try{r=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let t=r&&Lx(r[1]);return t&&JSON.parse(t)},Ux=()=>{try{return Ox()||Nx()||Dx()}catch(r){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${r}`);return}},km=()=>{var r;return(r=Ux())===null||r===void 0?void 0:r.config};var $c=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,i)=>{e?this.reject(e):this.resolve(i),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(e):t(e,i))}}};function Gx(){let r=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof r=="object"&&r.id!==void 0}function yu(){try{return typeof indexedDB=="object"}catch{return!1}}function Om(){return new Promise((r,t)=>{try{let e=!0,i="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(i);s.onsuccess=()=>{s.result.close(),e||self.indexedDB.deleteDatabase(i),r(!0)},s.onupgradeneeded=()=>{e=!1},s.onerror=()=>{var n;t(((n=s.error)===null||n===void 0?void 0:n.message)||"")}}catch(e){t(e)}})}function Hx(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}var Vx="FirebaseError",yr=class r extends Error{constructor(t,e,i){super(e),this.code=t,this.customData=i,this.name=Vx,Object.setPrototypeOf(this,r.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,_i.prototype.create)}},_i=class{constructor(t,e,i){this.service=t,this.serviceName=e,this.errors=i}create(t,...e){let i=e[0]||{},s=`${this.service}/${t}`,n=this.errors[t],o=n?jx(n,i):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new yr(s,a,i)}};function jx(r,t){return r.replace($x,(e,i)=>{let s=t[i];return s!=null?String(s):`<${i}?>`})}var $x=/\{\$([^}]+)}/g;function ih(r,t){if(r===t)return!0;let e=Object.keys(r),i=Object.keys(t);for(let s of e){if(!i.includes(s))return!1;let n=r[s],o=t[s];if(lm(n)&&lm(o)){if(!ih(n,o))return!1}else if(n!==o)return!1}for(let s of i)if(!e.includes(s))return!1;return!0}function lm(r){return r!==null&&typeof r=="object"}var zx=1e3,Wx=2,Xx=4*60*60*1e3,Yx=.5;function zc(r,t=zx,e=Wx){let i=t*Math.pow(e,r),s=Math.round(Yx*i*(Math.random()-.5)*2);return Math.min(Xx,i+s)}function Ur(r){return r&&r._delegate?r._delegate:r}var De=class{constructor(t,e,i){this.name=t,this.instanceFactory=e,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}};var gi="[DEFAULT]";var Wc=class{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){let e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){let i=new $c;if(this.instancesDeferred.set(e,i),this.isInitialized(e)||this.shouldAutoInitialize())try{let s=this.getOrInitializeService({instanceIdentifier:e});s&&i.resolve(s)}catch{}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;let i=this.normalizeInstanceIdentifier(t?.identifier),s=(e=t?.optional)!==null&&e!==void 0?e:!1;if(this.isInitialized(i)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:i})}catch(n){if(s)return null;throw n}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(Kx(t))try{this.getOrInitializeService({instanceIdentifier:gi})}catch{}for(let[e,i]of this.instancesDeferred.entries()){let s=this.normalizeInstanceIdentifier(e);try{let n=this.getOrInitializeService({instanceIdentifier:s});i.resolve(n)}catch{}}}}clearInstance(t=gi){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){let t=Array.from(this.instances.values());await Promise.all([...t.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...t.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=gi){return this.instances.has(t)}getOptions(t=gi){return this.instancesOptions.get(t)||{}}initialize(t={}){let{options:e={}}=t,i=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let s=this.getOrInitializeService({instanceIdentifier:i,options:e});for(let[n,o]of this.instancesDeferred.entries()){let a=this.normalizeInstanceIdentifier(n);i===a&&o.resolve(s)}return s}onInit(t,e){var i;let s=this.normalizeInstanceIdentifier(e),n=(i=this.onInitCallbacks.get(s))!==null&&i!==void 0?i:new Set;n.add(t),this.onInitCallbacks.set(s,n);let o=this.instances.get(s);return o&&t(o,s),()=>{n.delete(t)}}invokeOnInitCallbacks(t,e){let i=this.onInitCallbacks.get(e);if(i)for(let s of i)try{s(t,e)}catch{}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let i=this.instances.get(t);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:qx(t),options:e}),this.instances.set(t,i),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(i,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,i)}catch{}return i||null}normalizeInstanceIdentifier(t=gi){return this.component?this.component.multipleInstances?t:gi:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function qx(r){return r===gi?void 0:r}function Kx(r){return r.instantiationMode==="EAGER"}var Xc=class{constructor(t){this.name=t,this.providers=new Map}addComponent(t){let e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);let e=new Wc(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}};var ct;(function(r){r[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT"})(ct||(ct={}));var Zx={debug:ct.DEBUG,verbose:ct.VERBOSE,info:ct.INFO,warn:ct.WARN,error:ct.ERROR,silent:ct.SILENT},Qx=ct.INFO,Jx={[ct.DEBUG]:"log",[ct.VERBOSE]:"log",[ct.INFO]:"info",[ct.WARN]:"warn",[ct.ERROR]:"error"},t0=(r,t,...e)=>{if(t<r.logLevel)return;let i=new Date().toISOString(),s=Jx[t];if(s)console[s](`[${i}]  ${r.name}:`,...e);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)},Jn=class{constructor(t){this.name=t,this._logLevel=Qx,this._logHandler=t0,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in ct))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?Zx[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,ct.DEBUG,...t),this._logHandler(this,ct.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,ct.VERBOSE,...t),this._logHandler(this,ct.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,ct.INFO,...t),this._logHandler(this,ct.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,ct.WARN,...t),this._logHandler(this,ct.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,ct.ERROR,...t),this._logHandler(this,ct.ERROR,...t)}},e0=(r,t)=>t.some(e=>r instanceof e),cm,um;function r0(){return cm||(cm=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function i0(){return um||(um=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var Nm=new WeakMap,Yc=new WeakMap,Dm=new WeakMap,Fc=new WeakMap,bu=new WeakMap;function s0(r){let t=new Promise((e,i)=>{let s=()=>{r.removeEventListener("success",n),r.removeEventListener("error",o)},n=()=>{e(kr(r.result)),s()},o=()=>{i(r.error),s()};r.addEventListener("success",n),r.addEventListener("error",o)});return t.then(e=>{e instanceof IDBCursor&&Nm.set(e,r)}).catch(()=>{}),bu.set(t,r),t}function n0(r){if(Yc.has(r))return;let t=new Promise((e,i)=>{let s=()=>{r.removeEventListener("complete",n),r.removeEventListener("error",o),r.removeEventListener("abort",o)},n=()=>{e(),s()},o=()=>{i(r.error||new DOMException("AbortError","AbortError")),s()};r.addEventListener("complete",n),r.addEventListener("error",o),r.addEventListener("abort",o)});Yc.set(r,t)}var qc={get(r,t,e){if(r instanceof IDBTransaction){if(t==="done")return Yc.get(r);if(t==="objectStoreNames")return r.objectStoreNames||Dm.get(r);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return kr(r[t])},set(r,t,e){return r[t]=e,!0},has(r,t){return r instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in r}};function o0(r){qc=r(qc)}function a0(r){return r===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...e){let i=r.call(Bc(this),t,...e);return Dm.set(i,t.sort?t.sort():[t]),kr(i)}:i0().includes(r)?function(...t){return r.apply(Bc(this),t),kr(Nm.get(this))}:function(...t){return kr(r.apply(Bc(this),t))}}function h0(r){return typeof r=="function"?a0(r):(r instanceof IDBTransaction&&n0(r),e0(r,r0())?new Proxy(r,qc):r)}function kr(r){if(r instanceof IDBRequest)return s0(r);if(Fc.has(r))return Fc.get(r);let t=h0(r);return t!==r&&(Fc.set(r,t),bu.set(t,r)),t}var Bc=r=>bu.get(r);function l0(r,t,{blocked:e,upgrade:i,blocking:s,terminated:n}={}){let o=indexedDB.open(r,t),a=kr(o);return i&&o.addEventListener("upgradeneeded",h=>{i(kr(o.result),h.oldVersion,h.newVersion,kr(o.transaction),h)}),e&&o.addEventListener("blocked",h=>e(h.oldVersion,h.newVersion,h)),a.then(h=>{n&&h.addEventListener("close",()=>n()),s&&h.addEventListener("versionchange",l=>s(l.oldVersion,l.newVersion,l))}).catch(()=>{}),a}var c0=["get","getKey","getAll","getAllKeys","count"],u0=["put","add","delete","clear"],Lc=new Map;function dm(r,t){if(!(r instanceof IDBDatabase&&!(t in r)&&typeof t=="string"))return;if(Lc.get(t))return Lc.get(t);let e=t.replace(/FromIndex$/,""),i=t!==e,s=u0.includes(e);if(!(e in(i?IDBIndex:IDBObjectStore).prototype)||!(s||c0.includes(e)))return;let n=async function(o,...a){let h=this.transaction(o,s?"readwrite":"readonly"),l=h.store;return i&&(l=l.index(a.shift())),(await Promise.all([l[e](...a),s&&h.done]))[0]};return Lc.set(t,n),n}o0(r=>({...r,get:(t,e,i)=>dm(t,e)||r.get(t,e,i),has:(t,e)=>!!dm(t,e)||r.has(t,e)}));var Kc=class{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(d0(t)){let e=t.getImmediate();return`${e.library}/${e.version}`}else return null}).filter(t=>t).join(" ")}};function d0(r){let t=r.getComponent();return t?.type==="VERSION"}var Zc="@firebase/app",pm="0.9.25";var xi=new Jn("@firebase/app"),p0="@firebase/app-compat",f0="@firebase/analytics-compat",m0="@firebase/analytics",g0="@firebase/app-check-compat",y0="@firebase/app-check",b0="@firebase/auth",_0="@firebase/auth-compat",x0="@firebase/database",v0="@firebase/database-compat",w0="@firebase/functions",T0="@firebase/functions-compat",E0="@firebase/installations",S0="@firebase/installations-compat",A0="@firebase/messaging",C0="@firebase/messaging-compat",I0="@firebase/performance",P0="@firebase/performance-compat",R0="@firebase/remote-config",M0="@firebase/remote-config-compat",F0="@firebase/storage",B0="@firebase/storage-compat",L0="@firebase/firestore",k0="@firebase/firestore-compat",O0="firebase",N0="10.7.1";var Qc="[DEFAULT]",D0={[Zc]:"fire-core",[p0]:"fire-core-compat",[m0]:"fire-analytics",[f0]:"fire-analytics-compat",[y0]:"fire-app-check",[g0]:"fire-app-check-compat",[b0]:"fire-auth",[_0]:"fire-auth-compat",[x0]:"fire-rtdb",[v0]:"fire-rtdb-compat",[w0]:"fire-fn",[T0]:"fire-fn-compat",[E0]:"fire-iid",[S0]:"fire-iid-compat",[A0]:"fire-fcm",[C0]:"fire-fcm-compat",[I0]:"fire-perf",[P0]:"fire-perf-compat",[R0]:"fire-rc",[M0]:"fire-rc-compat",[F0]:"fire-gcs",[B0]:"fire-gcs-compat",[L0]:"fire-fst",[k0]:"fire-fst-compat","fire-js":"fire-js",[O0]:"fire-js-all"};var sh=new Map,Jc=new Map;function U0(r,t){try{r.container.addComponent(t)}catch(e){xi.debug(`Component ${t.name} failed to register with FirebaseApp ${r.name}`,e)}}function Dr(r){let t=r.name;if(Jc.has(t))return xi.debug(`There were multiple attempts to register component ${t}.`),!1;Jc.set(t,r);for(let e of sh.values())U0(e,r);return!0}function eo(r,t){let e=r.container.getProvider("heartbeat").getImmediate({optional:!0});return e&&e.triggerHeartbeat(),r.container.getProvider(t)}var G0={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},Or=new _i("app","Firebase",G0);var tu=class{constructor(t,e,i){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new De("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw Or.create("app-deleted",{appName:this._name})}};var H0=N0;function Um(r,t={}){let e=r;typeof t!="object"&&(t={name:t});let i=Object.assign({name:Qc,automaticDataCollectionEnabled:!1},t),s=i.name;if(typeof s!="string"||!s)throw Or.create("bad-app-name",{appName:String(s)});if(e||(e=km()),!e)throw Or.create("no-options");let n=sh.get(s);if(n){if(ih(e,n.options)&&ih(i,n.config))return n;throw Or.create("duplicate-app",{appName:s})}let o=new Xc(s);for(let h of Jc.values())o.addComponent(h);let a=new tu(e,i,o);return sh.set(s,a),a}function Gm(r=Qc){let t=sh.get(r);if(!t&&r===Qc&&km())return Um();if(!t)throw Or.create("no-app",{appName:r});return t}function er(r,t,e){var i;let s=(i=D0[r])!==null&&i!==void 0?i:r;e&&(s+=`-${e}`);let n=s.match(/\s|\//),o=t.match(/\s|\//);if(n||o){let a=[`Unable to register library "${s}" with version "${t}":`];n&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),n&&o&&a.push("and"),o&&a.push(`version name "${t}" contains illegal characters (whitespace or "/")`),xi.warn(a.join(" "));return}Dr(new De(`${s}-version`,()=>({library:s,version:t}),"VERSION"))}var V0="firebase-heartbeat-database",j0=1,to="firebase-heartbeat-store",kc=null;function Hm(){return kc||(kc=l0(V0,j0,{upgrade:(r,t)=>{switch(t){case 0:r.createObjectStore(to)}}}).catch(r=>{throw Or.create("idb-open",{originalErrorMessage:r.message})})),kc}async function $0(r){try{return await(await Hm()).transaction(to).objectStore(to).get(Vm(r))}catch(t){if(t instanceof yr)xi.warn(t.message);else{let e=Or.create("idb-get",{originalErrorMessage:t?.message});xi.warn(e.message)}}}async function fm(r,t){try{let e=(await Hm()).transaction(to,"readwrite");await e.objectStore(to).put(t,Vm(r)),await e.done}catch(e){if(e instanceof yr)xi.warn(e.message);else{let i=Or.create("idb-set",{originalErrorMessage:e?.message});xi.warn(i.message)}}}function Vm(r){return`${r.name}!${r.options.appId}`}var z0=1024,W0=30*24*60*60*1e3,eu=class{constructor(t){this.container=t,this._heartbeatsCache=null;let e=this.container.getProvider("app").getImmediate();this._storage=new ru(e),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}async triggerHeartbeat(){var t,e;let i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=mm();if(!(((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null))&&!(this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(n=>n.date===s)))return this._heartbeatsCache.heartbeats.push({date:s,agent:i}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(n=>{let o=new Date(n.date).valueOf();return Date.now()-o<=W0}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){var t;if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";let e=mm(),{heartbeatsToSend:i,unsentEntries:s}=X0(this._heartbeatsCache.heartbeats),n=Lm(JSON.stringify({version:2,heartbeats:i}));return this._heartbeatsCache.lastSentHeartbeatDate=e,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),n}};function mm(){return new Date().toISOString().substring(0,10)}function X0(r,t=z0){let e=[],i=r.slice();for(let s of r){let n=e.find(o=>o.agent===s.agent);if(n){if(n.dates.push(s.date),gm(e)>t){n.dates.pop();break}}else if(e.push({agent:s.agent,dates:[s.date]}),gm(e)>t){e.pop();break}i=i.slice(1)}return{heartbeatsToSend:e,unsentEntries:i}}var ru=class{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return yu()?Om().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){let t=await $0(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){let i=await this.read();return fm(this.app,{lastSentHeartbeatDate:(e=t.lastSentHeartbeatDate)!==null&&e!==void 0?e:i.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){var e;if(await this._canUseIndexedDBPromise){let i=await this.read();return fm(this.app,{lastSentHeartbeatDate:(e=t.lastSentHeartbeatDate)!==null&&e!==void 0?e:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...t.heartbeats]})}else return}};function gm(r){return Lm(JSON.stringify({version:2,heartbeats:r})).length}function Y0(r){Dr(new De("platform-logger",t=>new Kc(t),"PRIVATE")),Dr(new De("heartbeat",t=>new eu(t),"PRIVATE")),er(Zc,pm,r),er(Zc,pm,"esm2017"),er("fire-js","")}Y0("");var q0="firebase",K0="10.7.1";er(q0,K0,"app");var Z0=(r,t)=>t.some(e=>r instanceof e),ym,bm;function Q0(){return ym||(ym=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function J0(){return bm||(bm=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var jm=new WeakMap,iu=new WeakMap,$m=new WeakMap,Oc=new WeakMap,_u=new WeakMap;function tv(r){let t=new Promise((e,i)=>{let s=()=>{r.removeEventListener("success",n),r.removeEventListener("error",o)},n=()=>{e(Nr(r.result)),s()},o=()=>{i(r.error),s()};r.addEventListener("success",n),r.addEventListener("error",o)});return t.then(e=>{e instanceof IDBCursor&&jm.set(e,r)}).catch(()=>{}),_u.set(t,r),t}function ev(r){if(iu.has(r))return;let t=new Promise((e,i)=>{let s=()=>{r.removeEventListener("complete",n),r.removeEventListener("error",o),r.removeEventListener("abort",o)},n=()=>{e(),s()},o=()=>{i(r.error||new DOMException("AbortError","AbortError")),s()};r.addEventListener("complete",n),r.addEventListener("error",o),r.addEventListener("abort",o)});iu.set(r,t)}var su={get(r,t,e){if(r instanceof IDBTransaction){if(t==="done")return iu.get(r);if(t==="objectStoreNames")return r.objectStoreNames||$m.get(r);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return Nr(r[t])},set(r,t,e){return r[t]=e,!0},has(r,t){return r instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in r}};function rv(r){su=r(su)}function iv(r){return r===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...e){let i=r.call(Nc(this),t,...e);return $m.set(i,t.sort?t.sort():[t]),Nr(i)}:J0().includes(r)?function(...t){return r.apply(Nc(this),t),Nr(jm.get(this))}:function(...t){return Nr(r.apply(Nc(this),t))}}function sv(r){return typeof r=="function"?iv(r):(r instanceof IDBTransaction&&ev(r),Z0(r,Q0())?new Proxy(r,su):r)}function Nr(r){if(r instanceof IDBRequest)return tv(r);if(Oc.has(r))return Oc.get(r);let t=sv(r);return t!==r&&(Oc.set(r,t),_u.set(t,r)),t}var Nc=r=>_u.get(r);function nv(r,t,{blocked:e,upgrade:i,blocking:s,terminated:n}={}){let o=indexedDB.open(r,t),a=Nr(o);return i&&o.addEventListener("upgradeneeded",h=>{i(Nr(o.result),h.oldVersion,h.newVersion,Nr(o.transaction))}),e&&o.addEventListener("blocked",()=>e()),a.then(h=>{n&&h.addEventListener("close",()=>n()),s&&h.addEventListener("versionchange",()=>s())}).catch(()=>{}),a}var ov=["get","getKey","getAll","getAllKeys","count"],av=["put","add","delete","clear"],Dc=new Map;function _m(r,t){if(!(r instanceof IDBDatabase&&!(t in r)&&typeof t=="string"))return;if(Dc.get(t))return Dc.get(t);let e=t.replace(/FromIndex$/,""),i=t!==e,s=av.includes(e);if(!(e in(i?IDBIndex:IDBObjectStore).prototype)||!(s||ov.includes(e)))return;let n=async function(o,...a){let h=this.transaction(o,s?"readwrite":"readonly"),l=h.store;return i&&(l=l.index(a.shift())),(await Promise.all([l[e](...a),s&&h.done]))[0]};return Dc.set(t,n),n}rv(r=>({...r,get:(t,e,i)=>_m(t,e)||r.get(t,e,i),has:(t,e)=>!!_m(t,e)||r.has(t,e)}));var zm="@firebase/installations",xu="0.6.4";var Wm=1e4,Xm=`w:${xu}`,Ym="FIS_v2",hv="https://firebaseinstallations.googleapis.com/v1",lv=60*60*1e3,cv="installations",uv="Installations";var dv={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},vi=new _i(cv,uv,dv);function qm(r){return r instanceof yr&&r.code.includes("request-failed")}function Km({projectId:r}){return`${hv}/projects/${r}/installations`}function Zm(r){return{token:r.token,requestStatus:2,expiresIn:fv(r.expiresIn),creationTime:Date.now()}}async function Qm(r,t){let e=(await t.json()).error;return vi.create("request-failed",{requestName:r,serverCode:e.code,serverMessage:e.message,serverStatus:e.status})}function Jm({apiKey:r}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":r})}function pv(r,{refreshToken:t}){let e=Jm(r);return e.append("Authorization",mv(t)),e}async function tg(r){let t=await r();return t.status>=500&&t.status<600?r():t}function fv(r){return Number(r.replace("s","000"))}function mv(r){return`${Ym} ${r}`}async function gv({appConfig:r,heartbeatServiceProvider:t},{fid:e}){let i=Km(r),s=Jm(r),n=t.getImmediate({optional:!0});if(n){let l=await n.getHeartbeatsHeader();l&&s.append("x-firebase-client",l)}let o={fid:e,authVersion:Ym,appId:r.appId,sdkVersion:Xm},a={method:"POST",headers:s,body:JSON.stringify(o)},h=await tg(()=>fetch(i,a));if(h.ok){let l=await h.json();return{fid:l.fid||e,registrationStatus:2,refreshToken:l.refreshToken,authToken:Zm(l.authToken)}}else throw await Qm("Create Installation",h)}function eg(r){return new Promise(t=>{setTimeout(t,r)})}function yv(r){return btoa(String.fromCharCode(...r)).replace(/\+/g,"-").replace(/\//g,"_")}var bv=/^[cdef][\w-]{21}$/,nu="";function _v(){try{let r=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(r),r[0]=112+r[0]%16;let t=xv(r);return bv.test(t)?t:nu}catch{return nu}}function xv(r){return yv(r).substr(0,22)}function hh(r){return`${r.appName}!${r.appId}`}var rg=new Map;function ig(r,t){let e=hh(r);sg(e,t),vv(e,t)}function sg(r,t){let e=rg.get(r);if(e)for(let i of e)i(t)}function vv(r,t){let e=wv();e&&e.postMessage({key:r,fid:t}),Tv()}var bi=null;function wv(){return!bi&&"BroadcastChannel"in self&&(bi=new BroadcastChannel("[Firebase] FID Change"),bi.onmessage=r=>{sg(r.data.key,r.data.fid)}),bi}function Tv(){rg.size===0&&bi&&(bi.close(),bi=null)}var Ev="firebase-installations-database",Sv=1,wi="firebase-installations-store",Uc=null;function vu(){return Uc||(Uc=nv(Ev,Sv,{upgrade:(r,t)=>{switch(t){case 0:r.createObjectStore(wi)}}})),Uc}async function nh(r,t){let e=hh(r),i=(await vu()).transaction(wi,"readwrite"),s=i.objectStore(wi),n=await s.get(e);return await s.put(t,e),await i.done,(!n||n.fid!==t.fid)&&ig(r,t.fid),t}async function ng(r){let t=hh(r),e=(await vu()).transaction(wi,"readwrite");await e.objectStore(wi).delete(t),await e.done}async function lh(r,t){let e=hh(r),i=(await vu()).transaction(wi,"readwrite"),s=i.objectStore(wi),n=await s.get(e),o=t(n);return o===void 0?await s.delete(e):await s.put(o,e),await i.done,o&&(!n||n.fid!==o.fid)&&ig(r,o.fid),o}async function wu(r){let t,e=await lh(r.appConfig,i=>{let s=Av(i),n=Cv(r,s);return t=n.registrationPromise,n.installationEntry});return e.fid===nu?{installationEntry:await t}:{installationEntry:e,registrationPromise:t}}function Av(r){let t=r||{fid:_v(),registrationStatus:0};return og(t)}function Cv(r,t){if(t.registrationStatus===0){if(!navigator.onLine){let s=Promise.reject(vi.create("app-offline"));return{installationEntry:t,registrationPromise:s}}let e={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},i=Iv(r,e);return{installationEntry:e,registrationPromise:i}}else return t.registrationStatus===1?{installationEntry:t,registrationPromise:Pv(r)}:{installationEntry:t}}async function Iv(r,t){try{let e=await gv(r,t);return nh(r.appConfig,e)}catch(e){throw qm(e)&&e.customData.serverCode===409?await ng(r.appConfig):await nh(r.appConfig,{fid:t.fid,registrationStatus:0}),e}}async function Pv(r){let t=await xm(r.appConfig);for(;t.registrationStatus===1;)await eg(100),t=await xm(r.appConfig);if(t.registrationStatus===0){let{installationEntry:e,registrationPromise:i}=await wu(r);return i||e}return t}function xm(r){return lh(r,t=>{if(!t)throw vi.create("installation-not-found");return og(t)})}function og(r){return Rv(r)?{fid:r.fid,registrationStatus:0}:r}function Rv(r){return r.registrationStatus===1&&r.registrationTime+Wm<Date.now()}async function Mv({appConfig:r,heartbeatServiceProvider:t},e){let i=Fv(r,e),s=pv(r,e),n=t.getImmediate({optional:!0});if(n){let l=await n.getHeartbeatsHeader();l&&s.append("x-firebase-client",l)}let o={installation:{sdkVersion:Xm,appId:r.appId}},a={method:"POST",headers:s,body:JSON.stringify(o)},h=await tg(()=>fetch(i,a));if(h.ok){let l=await h.json();return Zm(l)}else throw await Qm("Generate Auth Token",h)}function Fv(r,{fid:t}){return`${Km(r)}/${t}/authTokens:generate`}async function Tu(r,t=!1){let e,i=await lh(r.appConfig,s=>{if(!ag(s))throw vi.create("not-registered");let n=s.authToken;if(!t&&kv(n))return s;if(n.requestStatus===1)return e=Bv(r,t),s;{if(!navigator.onLine)throw vi.create("app-offline");let o=Nv(s);return e=Lv(r,o),o}});return e?await e:i.authToken}async function Bv(r,t){let e=await vm(r.appConfig);for(;e.authToken.requestStatus===1;)await eg(100),e=await vm(r.appConfig);let i=e.authToken;return i.requestStatus===0?Tu(r,t):i}function vm(r){return lh(r,t=>{if(!ag(t))throw vi.create("not-registered");let e=t.authToken;return Dv(e)?Object.assign(Object.assign({},t),{authToken:{requestStatus:0}}):t})}async function Lv(r,t){try{let e=await Mv(r,t),i=Object.assign(Object.assign({},t),{authToken:e});return await nh(r.appConfig,i),e}catch(e){if(qm(e)&&(e.customData.serverCode===401||e.customData.serverCode===404))await ng(r.appConfig);else{let i=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}});await nh(r.appConfig,i)}throw e}}function ag(r){return r!==void 0&&r.registrationStatus===2}function kv(r){return r.requestStatus===2&&!Ov(r)}function Ov(r){let t=Date.now();return t<r.creationTime||r.creationTime+r.expiresIn<t+lv}function Nv(r){let t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},r),{authToken:t})}function Dv(r){return r.requestStatus===1&&r.requestTime+Wm<Date.now()}async function Uv(r){let t=r,{installationEntry:e,registrationPromise:i}=await wu(t);return i?i.catch(console.error):Tu(t).catch(console.error),e.fid}async function Gv(r,t=!1){let e=r;return await Hv(e),(await Tu(e,t)).token}async function Hv(r){let{registrationPromise:t}=await wu(r);t&&await t}function Vv(r){if(!r||!r.options)throw Gc("App Configuration");if(!r.name)throw Gc("App Name");let t=["projectId","apiKey","appId"];for(let e of t)if(!r.options[e])throw Gc(e);return{appName:r.name,projectId:r.options.projectId,apiKey:r.options.apiKey,appId:r.options.appId}}function Gc(r){return vi.create("missing-app-config-values",{valueName:r})}var hg="installations",jv="installations-internal",$v=r=>{let t=r.getProvider("app").getImmediate(),e=Vv(t),i=eo(t,"heartbeat");return{app:t,appConfig:e,heartbeatServiceProvider:i,_delete:()=>Promise.resolve()}},zv=r=>{let t=r.getProvider("app").getImmediate(),e=eo(t,hg).getImmediate();return{getId:()=>Uv(e),getToken:i=>Gv(e,i)}};function Wv(){Dr(new De(hg,$v,"PUBLIC")),Dr(new De(jv,zv,"PRIVATE"))}Wv();er(zm,xu);er(zm,xu,"esm2017");var Hc="@firebase/remote-config",wm="0.4.4";var ou=class{constructor(){this.listeners=[]}addEventListener(t){this.listeners.push(t)}abort(){this.listeners.forEach(t=>t())}};var lg="remote-config";var Xv={"registration-window":"Undefined window object. This SDK only supports usage in a browser environment.","registration-project-id":"Undefined project identifier. Check Firebase app initialization.","registration-api-key":"Undefined API key. Check Firebase app initialization.","registration-app-id":"Undefined app identifier. Check Firebase app initialization.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","storage-delete":"Error thrown when deleting from storage. Original error: {$originalErrorMessage}.","fetch-client-network":"Fetch client failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-timeout":'The config fetch request timed out.  Configure timeout using "fetchTimeoutMillis" SDK setting.',"fetch-throttle":'The config fetch request timed out while in an exponential backoff state. Configure timeout using "fetchTimeoutMillis" SDK setting. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.',"fetch-client-parse":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","indexed-db-unavailable":"Indexed DB is not supported by current browser"},ue=new _i("remoteconfig","Remote Config",Xv);function Yv(r,t){return r instanceof yr&&r.code.indexOf(t)!==-1}var qv=!1,Kv="",Tm=0,Zv=["1","true","t","yes","y","on"],Zn=class{constructor(t,e=Kv){this._source=t,this._value=e}asString(){return this._value}asBoolean(){return this._source==="static"?qv:Zv.indexOf(this._value.toLowerCase())>=0}asNumber(){if(this._source==="static")return Tm;let t=Number(this._value);return isNaN(t)&&(t=Tm),t}getSource(){return this._source}};function Qv(r=Gm()){return r=Ur(r),eo(r,lg).getImmediate()}async function Jv(r){let t=Ur(r),[e,i]=await Promise.all([t._storage.getLastSuccessfulFetchResponse(),t._storage.getActiveConfigEtag()]);return!e||!e.config||!e.eTag||e.eTag===i?!1:(await Promise.all([t._storageCache.setActiveConfig(e.config),t._storage.setActiveConfigEtag(e.eTag)]),!0)}function tw(r){let t=Ur(r);return t._initializePromise||(t._initializePromise=t._storageCache.loadFromStorage().then(()=>{t._isInitializationComplete=!0})),t._initializePromise}async function ew(r){let t=Ur(r),e=new ou;setTimeout(async()=>{e.abort()},t.settings.fetchTimeoutMillis);try{await t._client.fetch({cacheMaxAgeMillis:t.settings.minimumFetchIntervalMillis,signal:e}),await t._storageCache.setLastFetchStatus("success")}catch(i){let s=Yv(i,"fetch-throttle")?"throttle":"failure";throw await t._storageCache.setLastFetchStatus(s),i}}function Em(r,t){let e=Ur(r);e._isInitializationComplete||e._logger.debug(`A value was requested for key "${t}" before SDK initialization completed. Await on ensureInitialized if the intent was to get a previously activated value.`);let i=e._storageCache.getActiveConfig();return i&&i[t]!==void 0?new Zn("remote",i[t]):e.defaultConfig&&e.defaultConfig[t]!==void 0?new Zn("default",String(e.defaultConfig[t])):(e._logger.debug(`Returning static value for key "${t}". Define a default or remote value if this is unintentional.`),new Zn("static"))}var au=class{constructor(t,e,i,s){this.client=t,this.storage=e,this.storageCache=i,this.logger=s}isCachedDataFresh(t,e){if(!e)return this.logger.debug("Config fetch cache check. Cache unpopulated."),!1;let i=Date.now()-e,s=i<=t;return this.logger.debug(`Config fetch cache check. Cache age millis: ${i}. Cache max age millis (minimumFetchIntervalMillis setting): ${t}. Is cache hit: ${s}.`),s}async fetch(t){let[e,i]=await Promise.all([this.storage.getLastSuccessfulFetchTimestampMillis(),this.storage.getLastSuccessfulFetchResponse()]);if(i&&this.isCachedDataFresh(t.cacheMaxAgeMillis,e))return i;t.eTag=i&&i.eTag;let s=await this.client.fetch(t),n=[this.storageCache.setLastSuccessfulFetchTimestampMillis(Date.now())];return s.status===200&&n.push(this.storage.setLastSuccessfulFetchResponse(s)),await Promise.all(n),s}};function rw(r=navigator){return r.languages&&r.languages[0]||r.language}var hu=class{constructor(t,e,i,s,n,o){this.firebaseInstallations=t,this.sdkVersion=e,this.namespace=i,this.projectId=s,this.apiKey=n,this.appId=o}async fetch(t){let[e,i]=await Promise.all([this.firebaseInstallations.getId(),this.firebaseInstallations.getToken()]),s=`${window.FIREBASE_REMOTE_CONFIG_URL_BASE||"https://firebaseremoteconfig.googleapis.com"}/v1/projects/${this.projectId}/namespaces/${this.namespace}:fetch?key=${this.apiKey}`,n={"Content-Type":"application/json","Content-Encoding":"gzip","If-None-Match":t.eTag||"*"},o={sdk_version:this.sdkVersion,app_instance_id:e,app_instance_id_token:i,app_id:this.appId,language_code:rw()},a={method:"POST",headers:n,body:JSON.stringify(o)},h=fetch(s,a),l=new Promise((m,b)=>{t.signal.addEventListener(()=>{let y=new Error("The operation was aborted.");y.name="AbortError",b(y)})}),c;try{await Promise.race([h,l]),c=await h}catch(m){let b="fetch-client-network";throw m?.name==="AbortError"&&(b="fetch-timeout"),ue.create(b,{originalErrorMessage:m?.message})}let u=c.status,d=c.headers.get("ETag")||void 0,p,f;if(c.status===200){let m;try{m=await c.json()}catch(b){throw ue.create("fetch-client-parse",{originalErrorMessage:b?.message})}p=m.entries,f=m.state}if(f==="INSTANCE_STATE_UNSPECIFIED"?u=500:f==="NO_CHANGE"?u=304:(f==="NO_TEMPLATE"||f==="EMPTY_CONFIG")&&(p={}),u!==304&&u!==200)throw ue.create("fetch-status",{httpStatus:u});return{status:u,eTag:d,config:p}}};function iw(r,t){return new Promise((e,i)=>{let s=Math.max(t-Date.now(),0),n=setTimeout(e,s);r.addEventListener(()=>{clearTimeout(n),i(ue.create("fetch-throttle",{throttleEndTimeMillis:t}))})})}function sw(r){if(!(r instanceof yr)||!r.customData)return!1;let t=Number(r.customData.httpStatus);return t===429||t===500||t===503||t===504}var lu=class{constructor(t,e){this.client=t,this.storage=e}async fetch(t){let e=await this.storage.getThrottleMetadata()||{backoffCount:0,throttleEndTimeMillis:Date.now()};return this.attemptFetch(t,e)}async attemptFetch(t,{throttleEndTimeMillis:e,backoffCount:i}){await iw(t.signal,e);try{let s=await this.client.fetch(t);return await this.storage.deleteThrottleMetadata(),s}catch(s){if(!sw(s))throw s;let n={throttleEndTimeMillis:Date.now()+zc(i),backoffCount:i+1};return await this.storage.setThrottleMetadata(n),this.attemptFetch(t,n)}}};var nw=60*1e3,ow=12*60*60*1e3,cu=class{constructor(t,e,i,s,n){this.app=t,this._client=e,this._storageCache=i,this._storage=s,this._logger=n,this._isInitializationComplete=!1,this.settings={fetchTimeoutMillis:nw,minimumFetchIntervalMillis:ow},this.defaultConfig={}}get fetchTimeMillis(){return this._storageCache.getLastSuccessfulFetchTimestampMillis()||-1}get lastFetchStatus(){return this._storageCache.getLastFetchStatus()||"no-fetch-yet"}};function eh(r,t){let e=r.target.error||void 0;return ue.create(t,{originalErrorMessage:e&&e?.message})}var yi="app_namespace_store",aw="firebase_remote_config",hw=1;function lw(){return new Promise((r,t)=>{try{let e=indexedDB.open(aw,hw);e.onerror=i=>{t(eh(i,"storage-open"))},e.onsuccess=i=>{r(i.target.result)},e.onupgradeneeded=i=>{let s=i.target.result;switch(i.oldVersion){case 0:s.createObjectStore(yi,{keyPath:"compositeKey"})}}}catch(e){t(ue.create("storage-open",{originalErrorMessage:e?.message}))}})}var uu=class{constructor(t,e,i,s=lw()){this.appId=t,this.appName=e,this.namespace=i,this.openDbPromise=s}getLastFetchStatus(){return this.get("last_fetch_status")}setLastFetchStatus(t){return this.set("last_fetch_status",t)}getLastSuccessfulFetchTimestampMillis(){return this.get("last_successful_fetch_timestamp_millis")}setLastSuccessfulFetchTimestampMillis(t){return this.set("last_successful_fetch_timestamp_millis",t)}getLastSuccessfulFetchResponse(){return this.get("last_successful_fetch_response")}setLastSuccessfulFetchResponse(t){return this.set("last_successful_fetch_response",t)}getActiveConfig(){return this.get("active_config")}setActiveConfig(t){return this.set("active_config",t)}getActiveConfigEtag(){return this.get("active_config_etag")}setActiveConfigEtag(t){return this.set("active_config_etag",t)}getThrottleMetadata(){return this.get("throttle_metadata")}setThrottleMetadata(t){return this.set("throttle_metadata",t)}deleteThrottleMetadata(){return this.delete("throttle_metadata")}async get(t){let e=await this.openDbPromise;return new Promise((i,s)=>{let n=e.transaction([yi],"readonly").objectStore(yi),o=this.createCompositeKey(t);try{let a=n.get(o);a.onerror=h=>{s(eh(h,"storage-get"))},a.onsuccess=h=>{let l=h.target.result;i(l?l.value:void 0)}}catch(a){s(ue.create("storage-get",{originalErrorMessage:a?.message}))}})}async set(t,e){let i=await this.openDbPromise;return new Promise((s,n)=>{let o=i.transaction([yi],"readwrite").objectStore(yi),a=this.createCompositeKey(t);try{let h=o.put({compositeKey:a,value:e});h.onerror=l=>{n(eh(l,"storage-set"))},h.onsuccess=()=>{s()}}catch(h){n(ue.create("storage-set",{originalErrorMessage:h?.message}))}})}async delete(t){let e=await this.openDbPromise;return new Promise((i,s)=>{let n=e.transaction([yi],"readwrite").objectStore(yi),o=this.createCompositeKey(t);try{let a=n.delete(o);a.onerror=h=>{s(eh(h,"storage-delete"))},a.onsuccess=()=>{i()}}catch(a){s(ue.create("storage-delete",{originalErrorMessage:a?.message}))}})}createCompositeKey(t){return[this.appId,this.appName,this.namespace,t].join()}};var du=class{constructor(t){this.storage=t}getLastFetchStatus(){return this.lastFetchStatus}getLastSuccessfulFetchTimestampMillis(){return this.lastSuccessfulFetchTimestampMillis}getActiveConfig(){return this.activeConfig}async loadFromStorage(){let t=this.storage.getLastFetchStatus(),e=this.storage.getLastSuccessfulFetchTimestampMillis(),i=this.storage.getActiveConfig(),s=await t;s&&(this.lastFetchStatus=s);let n=await e;n&&(this.lastSuccessfulFetchTimestampMillis=n);let o=await i;o&&(this.activeConfig=o)}setLastFetchStatus(t){return this.lastFetchStatus=t,this.storage.setLastFetchStatus(t)}setLastSuccessfulFetchTimestampMillis(t){return this.lastSuccessfulFetchTimestampMillis=t,this.storage.setLastSuccessfulFetchTimestampMillis(t)}setActiveConfig(t){return this.activeConfig=t,this.storage.setActiveConfig(t)}};function cw(){Dr(new De(lg,r,"PUBLIC").setMultipleInstances(!0)),er(Hc,wm),er(Hc,wm,"esm2017");function r(t,{instanceIdentifier:e}){let i=t.getProvider("app").getImmediate(),s=t.getProvider("installations-internal").getImmediate();if(typeof window>"u")throw ue.create("registration-window");if(!yu())throw ue.create("indexed-db-unavailable");let{projectId:n,apiKey:o,appId:a}=i.options;if(!n)throw ue.create("registration-project-id");if(!o)throw ue.create("registration-api-key");if(!a)throw ue.create("registration-app-id");e=e||"firebase";let h=new uu(a,i.name,e),l=new du(h),c=new Jn(Hc);c.logLevel=ct.ERROR;let u=new hu(s,H0,e,n,o,a),d=new lu(u,h),p=new au(d,h,l,c),f=new cu(i,p,l,h,c);return tw(f),f}}async function uw(r){return r=Ur(r),await ew(r),Jv(r)}cw();var oh="analytics",dw="firebase_id",pw="origin",fw=60*1e3,mw="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",Eu="https://www.googletagmanager.com/gtag/js";var de=new Jn("@firebase/analytics");var gw={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},ye=new _i("analytics","Analytics",gw);function yw(r){if(!r.startsWith(Eu)){let t=ye.create("invalid-gtag-resource",{gtagURL:r});return de.warn(t.message),""}return r}function cg(r){return Promise.all(r.map(t=>t.catch(e=>e)))}function bw(r,t){let e;return window.trustedTypes&&(e=window.trustedTypes.createPolicy(r,t)),e}function _w(r,t){let e=bw("firebase-js-sdk-policy",{createScriptURL:yw}),i=document.createElement("script"),s=`${Eu}?l=${r}&id=${t}`;i.src=e?e?.createScriptURL(s):s,i.async=!0,document.head.appendChild(i)}function xw(r){let t=[];return Array.isArray(window[r])?t=window[r]:window[r]=t,t}async function vw(r,t,e,i,s,n){let o=i[s];try{if(o)await t[o];else{let a=(await cg(e)).find(h=>h.measurementId===s);a&&await t[a.appId]}}catch(a){de.error(a)}r("config",s,n)}async function ww(r,t,e,i,s){try{let n=[];if(s&&s.send_to){let o=s.send_to;Array.isArray(o)||(o=[o]);let a=await cg(e);for(let h of o){let l=a.find(u=>u.measurementId===h),c=l&&t[l.appId];if(c)n.push(c);else{n=[];break}}}n.length===0&&(n=Object.values(t)),await Promise.all(n),r("event",i,s||{})}catch(n){de.error(n)}}function Tw(r,t,e,i){async function s(n,...o){try{if(n==="event"){let[a,h]=o;await ww(r,t,e,a,h)}else if(n==="config"){let[a,h]=o;await vw(r,t,e,i,a,h)}else if(n==="consent"){let[a]=o;r("consent","update",a)}else if(n==="get"){let[a,h,l]=o;r("get",a,h,l)}else if(n==="set"){let[a]=o;r("set",a)}else r(n,...o)}catch(a){de.error(a)}}return s}function Ew(r,t,e,i,s){let n=function(...o){window[i].push(arguments)};return window[s]&&typeof window[s]=="function"&&(n=window[s]),window[s]=Tw(n,r,t,e),{gtagCore:n,wrappedGtag:window[s]}}function Sw(r){let t=window.document.getElementsByTagName("script");for(let e of Object.values(t))if(e.src&&e.src.includes(Eu)&&e.src.includes(r))return e;return null}var Aw=30,Cw=1e3,pu=class{constructor(t={},e=Cw){this.throttleMetadata=t,this.intervalMillis=e}getThrottleMetadata(t){return this.throttleMetadata[t]}setThrottleMetadata(t,e){this.throttleMetadata[t]=e}deleteThrottleMetadata(t){delete this.throttleMetadata[t]}},ug=new pu;function Iw(r){return new Headers({Accept:"application/json","x-goog-api-key":r})}async function Pw(r){var t;let{appId:e,apiKey:i}=r,s={method:"GET",headers:Iw(i)},n=mw.replace("{app-id}",e),o=await fetch(n,s);if(o.status!==200&&o.status!==304){let a="";try{let h=await o.json();!((t=h.error)===null||t===void 0)&&t.message&&(a=h.error.message)}catch{}throw ye.create("config-fetch-failed",{httpStatus:o.status,responseMessage:a})}return o.json()}async function Rw(r,t=ug,e){let{appId:i,apiKey:s,measurementId:n}=r.options;if(!i)throw ye.create("no-app-id");if(!s){if(n)return{measurementId:n,appId:i};throw ye.create("no-api-key")}let o=t.getThrottleMetadata(i)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new fu;return setTimeout(async()=>{a.abort()},e!==void 0?e:fw),dg({appId:i,apiKey:s,measurementId:n},o,a,t)}async function dg(r,{throttleEndTimeMillis:t,backoffCount:e},i,s=ug){var n;let{appId:o,measurementId:a}=r;try{await Mw(i,t)}catch(h){if(a)return de.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${h?.message}]`),{appId:o,measurementId:a};throw h}try{let h=await Pw(r);return s.deleteThrottleMetadata(o),h}catch(h){let l=h;if(!Fw(l)){if(s.deleteThrottleMetadata(o),a)return de.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${l?.message}]`),{appId:o,measurementId:a};throw h}let c=Number((n=l?.customData)===null||n===void 0?void 0:n.httpStatus)===503?zc(e,s.intervalMillis,Aw):zc(e,s.intervalMillis),u={throttleEndTimeMillis:Date.now()+c,backoffCount:e+1};return s.setThrottleMetadata(o,u),de.debug(`Calling attemptFetch again in ${c} millis`),dg(r,u,i,s)}}function Mw(r,t){return new Promise((e,i)=>{let s=Math.max(t-Date.now(),0),n=setTimeout(e,s);r.addEventListener(()=>{clearTimeout(n),i(ye.create("fetch-throttle",{throttleEndTimeMillis:t}))})})}function Fw(r){if(!(r instanceof yr)||!r.customData)return!1;let t=Number(r.customData.httpStatus);return t===429||t===500||t===503||t===504}var fu=class{constructor(){this.listeners=[]}addEventListener(t){this.listeners.push(t)}abort(){this.listeners.forEach(t=>t())}};async function Bw(r,t,e,i,s){if(s&&s.global){r("event",e,i);return}else{let n=await t,o=Object.assign(Object.assign({},i),{send_to:n});r("event",e,o)}}async function Lw(){if(yu())try{await Om()}catch(r){return de.warn(ye.create("indexeddb-unavailable",{errorInfo:r?.toString()}).message),!1}else return de.warn(ye.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function kw(r,t,e,i,s,n,o){var a;let h=Rw(r);h.then(p=>{e[p.measurementId]=p.appId,r.options.measurementId&&p.measurementId!==r.options.measurementId&&de.warn(`The measurement ID in the local Firebase config (${r.options.measurementId}) does not match the measurement ID fetched from the server (${p.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(p=>de.error(p)),t.push(h);let l=Lw().then(p=>{if(p)return i.getId()}),[c,u]=await Promise.all([h,l]);Sw(n)||_w(n,c.measurementId),s("js",new Date);let d=(a=o?.config)!==null&&a!==void 0?a:{};return d[pw]="firebase",d.update=!0,u!=null&&(d[dw]=u),s("config",c.measurementId,d),c.measurementId}var mu=class{constructor(t){this.app=t}_delete(){return delete Qn[this.app.options.appId],Promise.resolve()}},Qn={},Sm=[],Am={},Vc="dataLayer",Ow="gtag",Cm,pg,Im=!1;function Nw(){let r=[];if(Gx()&&r.push("This is a browser extension environment."),Hx()||r.push("Cookies are not available."),r.length>0){let t=r.map((i,s)=>`(${s+1}) ${i}`).join(" "),e=ye.create("invalid-analytics-context",{errorInfo:t});de.warn(e.message)}}function Dw(r,t,e){Nw();let i=r.options.appId;if(!i)throw ye.create("no-app-id");if(!r.options.apiKey)if(r.options.measurementId)de.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${r.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw ye.create("no-api-key");if(Qn[i]!=null)throw ye.create("already-exists",{id:i});if(!Im){xw(Vc);let{wrappedGtag:s,gtagCore:n}=Ew(Qn,Sm,Am,Vc,Ow);pg=s,Cm=n,Im=!0}return Qn[i]=kw(r,Sm,Am,t,Cm,Vc,e),new mu(r)}function Uw(r=Gm()){r=Ur(r);let t=eo(r,oh);return t.isInitialized()?t.getImmediate():Gw(r)}function Gw(r,t={}){let e=eo(r,oh);if(e.isInitialized()){let i=e.getImmediate();if(ih(t,e.getOptions()))return i;throw ye.create("already-initialized")}return e.initialize({options:t})}function Kn(r,t,e,i){r=Ur(r),Bw(pg,Qn[r.app.options.appId],t,e,i).catch(s=>de.error(s))}var Pm="@firebase/analytics",Rm="0.10.0";function Hw(){Dr(new De(oh,(t,{options:e})=>{let i=t.getProvider("app").getImmediate(),s=t.getProvider("installations-internal").getImmediate();return Dw(i,s,e)},"PUBLIC")),Dr(new De("analytics-internal",r,"PRIVATE")),er(Pm,Rm),er(Pm,Rm,"esm2017");function r(t){try{let e=t.getProvider(oh).getImmediate();return{logEvent:(i,s,n)=>Kn(e,i,s,n)}}catch(e){throw ye.create("interop-component-reg-failed",{reason:e})}}}Hw();var Vw='[{"id":"bs2d-6","show":"BubbleShooter2d","when":"onLevelEnd","levels":[10,30]},{"id":"bs2d-dog-1","from":"BubbleShooter2d","show":"DogEscape","when":"onLevelEnd","levels":[5,20,50]}]',jw=`[
  {
    "id": "BubbleShooter2d",
    "title": "Glossy Bubble Challenge",
    "url": "https://yandex.ru/games/app/268294",
    "icon": "bubble-icon.png",
    "cover": "buble-cover.jpg"
  },
  {
    "id": "DogEscape",
    "title": "Dog Escape",
    "url": "https://yandex.com/games/app/255645",
    "icon": "dogescape-icon.png",
    "cover": "dogescape-cover.jpg"
  },
  {
    "id": "WeaponWars",
    "title": "Weapon Wars",
    "url": "https://yandex.com/games/app/268058",
    "icon": "weaponwars-icon.png",
    "cover": "weaponwars-cover.jpg"
  }
]`,$w={single:Vw,all:jw},ah=class{constructor(){vt(this,"container"),vt(this,"content")}};function zw(r,t,e,i,s){let n=document.createElement("div");n.setAttribute("class","item");let o=document.createElement("img");o.setAttribute("src",e+"img/cover/"+r.cover);let a=document.createElement("button");a.setAttribute("class","play-btn"),a.innerHTML=s.localize("play"),a.onclick=()=>{window.open(s.resolveDomain(r.url),"_blank"),i(r.id)},n.appendChild(o),n.appendChild(a),t.appendChild(n)}var rh=class Rs{constructor(){vt(this,"lang"),vt(this,"domain")}setContext(t){console.log(t),this.lang=t.i18n.lang,this.domain=t.i18n.tld,console.log("GameFuse Lang:"+this.lang),console.log("GameFuse Domain:"+this.domain)}localize(t){let e=Rs.Words[t+"-"+this.lang];return console.log(t+this.lang+" :"+e),e==null&&(e=Rs.Words[t+"-"+Rs.defaultLang],console.log(t+Rs.defaultLang+" :"+e)),e}resolveDomain(t){let e=this.domain!=null?this.domain:Rs.defaultDomain;return t.replace("yandex.com","yandex."+e)}};vt(rh,"Words",{"play-en":"Play","play-ru":"\u0418\u0433\u0440\u0430\u0442\u044C","more-en":"More Games","more-ru":"\u0411\u043E\u043B\u044C\u0448\u0435 \u0438\u0433\u0440"}),vt(rh,"defaultLang","en"),vt(rh,"defaultDomain","com");var Ww=rh,Mm={apiKey:"AIzaSyDDLHPj-rb7QtuQVNNH43zZomBRh9945eI",authDomain:"game-fuse-e54ee.firebaseapp.com",projectId:"game-fuse-e54ee",storageBucket:"game-fuse-e54ee.appspot.com",messagingSenderId:"944870108663",appId:"1:944870108663:web:40e3cf0562dc7811dcd2f2",measurementId:"G-6C21JSMX0K"},Xw="modal-all",Yw="modal-single",gu=class{constructor(){vt(this,"analytics"),vt(this,"remoteConfig"),vt(this,"popupAll",new ah),vt(this,"popupSingle",new ah),vt(this,"host"),vt(this,"currentGame"),vt(this,"allEntries"),vt(this,"singleEntries"),vt(this,"currentSingle"),vt(this,"showCallback"),vt(this,"isSetup",!1),vt(this,"retryTime",5e3),vt(this,"retryCount",0),vt(this,"localization",new Ww)}setup(t){if(this.isSetup)return;this.isSetup=!0,this.currentGame=t;let e=Um(Mm),i=Uw(e);this.analytics=i;let s=Qv(e);this.remoteConfig=s,s.settings.minimumFetchIntervalMillis=36e5,s.defaultConfig=$w,this.setConfigValues(),this.fetchConfig();let n="https://"+Mm.projectId+".web.app/";this.host=n;let o=n+"gamefuse.css";this.injectCSS(o);let a=document.createElement("div");a.setAttribute("id","gf-ui"),this.popupAll.container=a.appendChild(this.createModal(this.popupAll,Xw)),this.popupSingle.container=a.appendChild(this.createModal(this.popupSingle,Yw,!0)),document.body.append(a)}setConfigValues(){this.allEntries=JSON.parse(Em(this.remoteConfig,"all").asString()),this.singleEntries=JSON.parse(Em(this.remoteConfig,"single").asString())}fetchConfig(){try{uw(this.remoteConfig).then(()=>{this.setConfigValues()}).catch(()=>{this.fetchRetry()})}catch{this.fetchRetry()}}fetchRetry(){this.retryCount++,setTimeout(this.fetchConfig.bind(this),this.retryCount*this.retryTime)}onListItemClick(t){Kn(this.analytics,"open_link",{from:this.currentGame,to:t,via:"MoreGames"})}onSingleItemClick(){this.currentSingle&&Kn(this.analytics,"open_link",{from:this.currentGame,to:this.currentSingle.show,via:"Popup"})}onAllCloseClick(){this.popupAll.container.classList.remove("active"),Kn(this.analytics,"close_more_games",{from:this.currentGame})}onSingleCloseClick(){this.currentSingle=void 0,this.popupSingle.container.classList.remove("active"),Kn(this.analytics,"close_single",{from:this.currentGame}),this.showCallback()}showAll(){if(!this.isSetup)return;let t=this.allEntries,e=this.popupAll.content;for(;e.firstChild;)e.removeChild(e.firstChild);let i=document.createElement("div");i.setAttribute("class","close-btn"),i.onclick=()=>{this.onAllCloseClick()};let s=document.createElement("h2");s.innerText=this.localization.localize("more"),e.appendChild(i),e.appendChild(s);let n=document.createElement("div");n.setAttribute("class","list"),t.forEach(o=>{o.id.trim()!=this.currentGame.trim()&&zw(o,n,this.host,this.onListItemClick.bind(this),this.localization)}),e.appendChild(n),this.popupAll.container.classList.add("active")}showPopup(t,e,i){if(!this.isSetup){i();return}this.showCallback=i;let s=this.singleEntries.filter(f=>f.when==t.trim()),n=-1;for(let f=0;f<s.length;f++){let m=s[f];if(!(m.show.trim()==this.currentGame.trim()||!(m.from==null||m.from.trim()==this.currentGame.trim()))){if(m.levels!=null)for(let b=0;b<m.levels.length;b++){if(e<m.levels[b])continue;let y=m.id+m.levels[b].toString();if(localStorage.getItem(y)==null){n=f,localStorage.setItem(y,"true");break}}else if(localStorage.getItem(m.id)==null){localStorage.setItem(m.id,"true"),n=f;break}if(n>=0)break}}if(n<0){this.showCallback();return}let o=s[n];this.currentSingle=o;let a=this.popupSingle.content;for(;a.firstChild;)a.removeChild(a.firstChild);let h=document.createElement("div");h.setAttribute("class","close-btn"),h.onclick=()=>{this.onSingleCloseClick()};let l=document.createElement("img");l.setAttribute("class","cover"),a.appendChild(h),a.appendChild(l);let c=document.createElement("div");c.setAttribute("class","cover-info");let u=document.createElement("img");u.setAttribute("class","icon");let d=document.createElement("h3"),p=this.allEntries.find(f=>f.id.trim()==o.show.trim());if(a.appendChild(c),c.appendChild(u),c.appendChild(d),p){l.setAttribute("src",this.host+"img/cover/"+p.cover),u.setAttribute("src",this.host+"img/icon/"+p.icon),d.innerText=p.title;let f=document.createElement("button");f.setAttribute("class","play-btn"),f.innerHTML=this.localization.localize("play"),f.onclick=()=>{window.open(this.localization.resolveDomain(p.url),"_blank"),this.onSingleItemClick()},c.appendChild(f)}this.popupSingle.container.classList.add("active")}setLocalization(t){this.localization.setContext(t)}injectCSS(t){let e=document.createElement("link");e.rel="stylesheet",e.type="text/css",e.href=t,document.head.appendChild(e)}createModal(t,e,i=!1){let s=document.createElement("section");s.setAttribute("id",e),s.setAttribute("class","modal"+(i?" single":""));let n=document.createElement("div");return n.setAttribute("class","popup"),t.content=s.appendChild(n),s}},ch=new gu;var Su=class{level=0;gameLevelKey="cars-n-guns-level-key";setup(t){console.log("promo setup");let e=localStorage.getItem(this.gameLevelKey);e?this.level=Number.parseInt(e):this.processLevel(),ch.setup(t)}processLevel(){this.level++,localStorage.setItem(this.gameLevelKey,this.level.toString())}showMoreGames(){ch.showAll()}showPopup(t,e){t=="onLevelStart"&&this.processLevel(),ch.showPopup(t,this.level,e)}},qw=new Su,Gr=qw;var uh=class extends A{titleContainer;titleBg;titleText;repCounter;moneyCounter;continueButton;constructor(t,e,i){super(),this.titleContainer=new A,this.titleBg=new E(x.from("panel-end")),this.titleBg.anchor.set(.5,0),this.titleText=new K(R.getText(t?"Victory":"Defeat").toUpperCase(),{fontFamily:R.font,fontSize:144,fill:16777215,align:"center",strokeThickness:4,stroke:4134513}),this.titleText.anchor.set(.5),this.titleText.y=this.titleBg.height/2,this.repCounter=new th,this.repCounter.updateValue(i.data.reputation),this.moneyCounter=new Dt("Money"),this.moneyCounter.scale.set(1.5),this.moneyCounter.updateValue(i.data.money),this.continueButton=new mt(R.getText("Continue").toUpperCase(),x.from("btn-green"),{fontFamily:R.font,fontSize:72,fill:84798,align:"center"}),this.continueButton.on("pointerdown",()=>{e.adsManager.showInterstitial(),et.emit("START_MENU"),Gr.showPopup("onLevelEnd",()=>{})}),this.titleContainer.addChild(this.titleBg),this.titleContainer.addChild(this.titleText),this.addChild(this.repCounter),this.addChild(this.moneyCounter),this.addChild(this.titleContainer),this.addChild(this.continueButton),this.positionElements()}positionElements(){this.titleContainer.position.set(C.width/2,0),this.repCounter.position.set(C.width/2,C.height/2),this.moneyCounter.position.set(C.width/2,C.height-550),this.continueButton.position.set(C.width/2,C.height-250)}};var Ms=class extends E{constructor(){super(x.WHITE),new E,this.scale.set(C.width/this.texture.width,C.height/this.texture.height),this.tint=0,this.alpha=.8,this.anchor.set(.5),this.eventMode="static",this.on("pointerdown",t=>t.stopImmediatePropagation())}};var dh=class extends A{overlay;info;bg;title;countdownText;countdownValue=5;countdown;button;onTimeUp;onContinue;constructor(t,e){super(),this.onContinue=t,this.onTimeUp=e,this.overlay=new Ms,this.info=new A,this.bg=new E(x.from("panel-continue")),this.bg.anchor.set(.5),this.title=new K(R.getText("Continue?"),{fontFamily:R.font,fill:16777215,fontSize:144,stroke:1386821,strokeThickness:16}),this.title.anchor.set(.5),this.countdownText=new K(this.countdownValue.toString(),{fontFamily:R.font,dropShadow:!0,dropShadowAngle:90,dropShadowColor:"#16306d",dropShadowDistance:10,fill:["#ecf2ff","#b8ccff"],fillGradientStops:[.4],fontSize:144*3,stroke:"#3967d0"}),this.countdownText.anchor.set(.5),this.button=new mt(R.getText("Yes").toUpperCase(),x.from("btn-orange"),{fontFamily:R.font,fontSize:72}),this.button.on("pointerdown",()=>{this.countdown.stop(),this.onContinue()}),this.addChild(this.overlay),this.addChild(this.info),this.info.addChild(this.bg),this.info.addChild(this.title),this.info.addChild(this.countdownText),this.addChild(this.button),this.positionElements(),this.startCounting(4)}startCounting(t){this.countdown=new st(this.countdownText).from({alpha:1}).to({alpha:0},1e3).start().repeat(t).easing(it.Quadratic.In).onRepeat(()=>{this.countdownText.text=(--this.countdownValue).toString()}).onComplete(()=>this.onTimeUp())}positionElements(){this.info.position.set(0,-170),this.title.position.set(0,-this.bg.height/2+10),this.countdownText.position.set(0,10),this.button.position.set(0,350)}};var gt={roadWidth:5,timeDilation:8,enemySpeed:.1,scrollSpeed:1,repToBoss:50,timeToBossMS:6e4,collisionDamageToPlayer:10,projectileDamageToPlayer:15,mysteryCarPeriodMS:14e3},ph=class extends A{game;slowed=!0;paused=!0;race;road;projectiles;explosions;pickups;threatSpawner;pickupSpawner;bossCar;playerCar;steering;globalMousePos;progress;ui;pauseScreen;level=1;isOver=!1;stopped=!1;bossReady=!1;revivedOnce=!1;moneyMultiplier=1;moneyMultiplierRemainingTimeMS=0;magnetRemainingTimeMS=0;constructor(t,e,i){super(),this.game=t,this.progress=e,this.game.audio.playSound(`engine_start_${tr(1,3)}`),this.race=new A,this.projectiles=new A,this.explosions=new A,this.pickups=new A,this.road=i||new Fs,this.playerCar=new gs(e.data.selectedCar,e.getCarUpgrades()),this.threatSpawner=new ja(this.road),this.pickupSpawner=new La,this.bossCar=new Xa(this.level),this.bossCar.setTarget(this.playerCar),this.bossCar.visible=!1,this.ui=new Ka,this.ui.setMoney(this.progress.data.money),this.ui.setReputation(this.progress.data.reputation),this.pauseScreen=new Ja,gt.scrollSpeed=1,this.playerCar.guns.forEach(s=>s.onFire.add(n=>{this.game.audio.playSound("projectile"),n.forEach(o=>{let a=this.toLocal({x:this.playerCar.position.x+s.body.x+o.x,y:this.playerCar.position.y+s.body.y+o.y});this.projectiles.addChild(o),o.position.set(a.x*this.scale.x,a.y*this.scale.y)})})),this.bossCar.gun.onFire.add(s=>{s.forEach(n=>{n.position.copyFrom(this.toLocal(this.position,n)),this.projectiles.addChild(n)})}),this.addChild(this.race),this.race.addChild(this.road),this.race.addChild(this.threatSpawner.container),this.race.addChild(this.playerCar),this.race.addChild(this.bossCar),this.race.addChild(this.explosions),this.race.addChild(this.pickups),this.race.addChild(this.projectiles),this.addChild(this.ui),this.steering=new ka(this.playerCar),this.steering.setBounds(-2,2),this.eventMode="static",et.on("BOSS_APPEAR",()=>this.spawnBoss()),this.on("pointerdown",s=>{s.preventDefault(),this.globalMousePos=s.global,this.steering.start(s.global),this.unpause(),this.playerCar.setFiringPermission(!mr.disablePlayerGun)}),this.on("pointermove",s=>{s.preventDefault(),this.globalMousePos=s.global}),this.on("pointerup",s=>{s.preventDefault(),this.steering.stop(),this.pause(),this.playerCar.setFiringPermission(!1)}),this.on("pointerupoutside",s=>{s.preventDefault(),this.steering.stop(),this.pause(),this.playerCar.setFiringPermission(!1)}),t.ticker.add(this.update,this),mr.manualRaceEnd&&document.addEventListener("keydown",this.debugControls.bind(this)),new st(this.playerCar).from({y:C.height+this.playerCar.height}).to({y:this.getPlayerCarDefaultY()},600).easing(it.Quadratic.Out).onComplete(()=>{this.pause(!0)}).start()}debugControls(t){switch(t.key){case"o":this.gameOver();break}}resize(){this.pickups.position.x=this.road.x,this.explosions.position.x=this.road.x,this.threatSpawner.container.x=this.road.x}pause(t=!1){(!this.stopped&&!this.paused||t)&&(this.paused=!0,this.slowed=!0,this.pauseScreen.tweenShow(),this.addChild(this.pauseScreen))}unpause(){!this.stopped&&this.paused&&(this.paused=!1,this.slowed=!1,this.removeChild(this.pauseScreen))}update(){if(li.shared.update(this.game.ticker.deltaMS),this.stopped)return;this.steering.active&&this.steering.update(this.globalMousePos);let t=this.slowed?this.game.ticker.deltaMS/gt.timeDilation:this.game.ticker.deltaMS;this.threatSpawner.bossMode||(gt.scrollSpeed+=t*1e-5),this.ui.setProgress((gt.timeToBossMS-this.threatSpawner.timeToBossMS)/gt.timeToBossMS),this.threatSpawner.update(t),this.moneyMultiplier!=1&&(this.moneyMultiplierRemainingTimeMS-=t,this.moneyMultiplierRemainingTimeMS<=0&&(this.moneyMultiplier=1)),this.magnetRemainingTimeMS>0?(this.playerCar.magnetEffect.visible=!0,this.magnetRemainingTimeMS-=t):this.playerCar.magnetEffect.visible=!1,this.isOver||(this.road.update(t),this.explosions.children.forEach(i=>{i.y+=gt.scrollSpeed*t})),this.threatSpawner.activeObstacles.forEach(i=>{if(i.y+=gt.scrollSpeed*t,i.getBounds().top>C.height){this.threatSpawner.releaseObstacle(i);return}this.isOver||this.detectOverlap(i.hitbox.getBounds(),this.playerCar.body.getBounds())&&this.setPlayerHealth(0)}),this.bossReady&&(this.bossCar.update(t),this.playerCar.guns.forEach(i=>i.projectiles.activeInstances.forEach(s=>{this.detectOverlap(s.getBounds(),this.bossCar.getBounds())&&(i.projectiles.release(s),this.bossCar.takeDamage(i.getProjectileDamage()),this.bossCar.health<=0&&this.defeatBoss())})),this.updateBossCarPosition()),this.bossCar.gun.update(t),this.bossCar.gun.projectiles.activeInstances.forEach(i=>{this.detectOverlap(i.getBounds(),this.playerCar.body.getBounds())&&(this.bossCar.gun.projectiles.release(i),this.setPlayerHealth(this.playerCar.health-gt.projectileDamageToPlayer))}),this.threatSpawner.activeEnemies.forEach(i=>{if(i.position.y+=(gt.scrollSpeed-gt.enemySpeed)*t,i.position.y>C.height+i.height){this.threatSpawner.releaseEnemy(i);return}this.playerCar.guns.forEach(s=>s.projectiles.activeInstances.forEach(n=>{this.detectOverlap(n.getBounds(),i.getBounds())&&(s.projectiles.release(n),i.takeDamage(s.getProjectileDamage()),i.health<=0&&this.onPlayerKillEnemy(i))})),this.isOver||this.detectOverlap(i.getBounds(),this.playerCar.body.getBounds())&&(this.onPlayerKillEnemy(i),this.setPlayerHealth(this.playerCar.health-gt.collisionDamageToPlayer))});let e=this.road.getDriveableBounds();this.pickupSpawner.pickups.activeInstances.forEach(i=>{i.applyGravity(t),this.magnetRemainingTimeMS>0&&i.applyMagnet(this.playerCar,t),i.move(t);let s=i.getBounds();if(i.bounceOffRoadBorders(e,s),s.top>C.height&&this.pickupSpawner.pickups.release(i),this.detectOverlap(this.playerCar.body.getBounds(),s)){switch(i.kind){case"MoneyBill":this.collectMoney(1*this.moneyMultiplier);break;case"MoneyStack":this.collectMoney(10*this.moneyMultiplier);break;case"Health":this.game.audio.playSound("power_up_4"),this.playerCar.resetHP(this.progress.getCarUpgrade("armor")),this.onPlayerHealthUpdate();break;case"Magnet":this.game.audio.playSound("power_up_5"),this.magnetRemainingTimeMS=Ba.Magnet.durationMS;break;case"MoneyX2":this.game.audio.playSound("power_up_4"),this.moneyMultiplier=2,this.moneyMultiplierRemainingTimeMS=Ba.MoneyX2.durationMS;break}this.pickupSpawner.pickups.release(i)}}),this.playerCar.updateGuns(t),this.isOver||this.updatePlayerCarPosition()}detectOverlap(t,e){let i=t.right>=e.left&&e.right>=t.left,s=t.bottom>=e.top&&e.bottom>=t.top;return i&&s}onPlayerKillEnemy(t){if(t.dead)return;t.dead=!0;let e=this.pickupSpawner.getFromEnemy($n[t.kind]);e&&(e.position.copyFrom(t.position),this.pickups.addChild(e)),this.game.audio.playSound(`explosion_${tr(1,4)}`),t.kind=="fuel"?(this.showExplosion(t.position,2),this.explodeFuelTank(t)):this.showExplosion(t.position),this.increaseReputation($n[t.kind].rep),this.threatSpawner.releaseEnemy(t)}explodeFuelTank(t){this.threatSpawner.activeEnemies.forEach(e=>{if(t!=e){let i=hm(t.position,e.position);if(i<gr.maxRadius){let s=xs.getFuelExplosionDamage(i);e.takeDamage(s),e.health<=0&&this.onPlayerKillEnemy(e)}}})}setPlayerHealth(t){this.playerCar.health=Math.max(0,t),this.onPlayerHealthUpdate()}onPlayerHealthUpdate(){this.ui.setHealth(this.playerCar.health/this.playerCar.getMaxHealth(this.progress.getCarUpgrade("armor"))),this.playerCar.health<=0&&(this.game.audio.playSound("player_car_crash"),this.gameOver())}collectMoney(t){this.game.audio.playSound(`money_collect_${tr(2,4)}`),this.progress.data.money+=t,this.progress.saveLocal(),this.ui.setMoney(this.progress.data.money)}increaseReputation(t){this.progress.data.reputation+=t,this.progress.saveLocal(),this.ui.setReputation(this.progress.data.reputation)}spawnBoss(){this.bossCar.resetHealth(this.level),this.bossCar.visible=!0,this.bossCar.roadX=0,this.bossCar.position.set(C.width/2,-this.bossCar.height);let t=new Za(this.bossCar.getRewardForLevel(this.level));t.alpha=0,t.position.set(-t.width,C.height/2),this.addChild(t);let e=new st(t).to({alpha:1},300).easing(it.Quadratic.InOut),i=new st(t).from({x:-t.width}).to({x:C.width/2},400).easing(it.Back.Out),s=new st(t).to({x:C.width+t.width},400).easing(it.Back.In).onComplete(()=>{this.removeChild(t),t.destroy({children:!0})}),n=new st(this.bossCar.position).to({y:this.bossCar.height/2+100},1e3).onStart(()=>{this.game.audio.playSound(`engine_start_${tr(1,3)}`)}).onComplete(()=>{this.bossReady=!0,this.bossCar.gun.canFire=!0});this.game.audio.playSound("ui_menu_whoosh"),e.start(),i.start().onComplete(()=>{s.start(1e3),n.start()})}defeatBoss(){let t=new Qa(this.bossCar.getRewardForLevel(this.level)),e=new st(t).to({alpha:1},300).easing(it.Quadratic.InOut),i=new st(t).from({x:-t.width}).to({x:C.width/2},400).easing(it.Back.Out),s=new st(t).to({x:C.width+t.width},400).easing(it.Back.In).onComplete(()=>{this.removeChild(t),t.destroy({children:!0})});e.start(),i.start().onComplete(()=>{s.start(1e3)}),t.alpha=0,t.position.set(-t.width,C.height/2),this.addChild(t),this.collectMoney(this.bossCar.getRewardForLevel(this.level)),this.level++,this.threatSpawner.bossMode=!1,this.game.audio.playSound(`explosion_${tr(1,4)}`),this.showExplosion(this.bossCar.position,2.5),this.bossCar.visible=!1,this.bossCar.gun.canFire=!1,this.bossReady=!1,this.threatSpawner.disableBossMode()}updatePlayerCarPosition(){let t=C.width/2+this.playerCar.roadX*this.getRoadPxPerUnit();this.playerCar.position.x=t}getPlayerCarDefaultY(){return C.height-this.playerCar.height/2-50}updateBossCarPosition(){let t=C.width/2+this.bossCar.roadX*this.getRoadPxPerUnit(),e=this.bossCar.height/2+100;this.bossCar.position.set(t,e)}getRoadPxPerUnit(){return this.road.width*.75/gt.roadWidth}getExplosionAnim(t,e,i,s,n){let o=le.get(t),a=new ci(o.animations[e]);return a.anchor.set(.5),a.scale.set(s),a.alpha=i,a.position.copyFrom(n),a.loop=!1,a.animationSpeed=.5,a.play(),a.onComplete=()=>{a.parent.removeChild(a)},a}showExplosion(t,e=1.5,i){let s=i||this.explosions,n=this.getExplosionAnim("mc","explosion",1,e,t);n.rotation=Math.random()*Math.PI;let o=this.getExplosionAnim("explosion","explosion",1,e,t);o.blendMode=D.SCREEN,s.addChild(n),s.addChild(o)}gameOver(){if(this.stopped=!0,this.removeChild(this.pauseScreen),this.revivedOnce)this.trueGameOver();else{let t=!1,e=new dh(()=>{this.game.adsManager.showRewarded(()=>{t?(console.log("Continue"),this.removeChild(e),this.revivedOnce=!0,this.threatSpawner.clearThreats(),this.threatSpawner.resetTimers(),this.stopped=!1,this.setPlayerHealth(this.playerCar.getMaxHealth(this.progress.getCarUpgrade("armor")))):(console.log("End"),this.removeChild(e),this.trueGameOver())},()=>{console.log("rewarded"),t=!0})},()=>{console.log("End"),this.removeChild(e),this.trueGameOver()});e.position.set(C.width/2,C.height/2),this.addChild(e)}}trueGameOver(){this.isOver=!0,this.playerCar.visible=!1,this.showExplosion(this.playerCar.position,1.5),this.removeChild(this.ui),this.removeListeners(),this.removeChild(this.pauseScreen);let t=C.width/2,e=C.height/2;this.steering.stop(),this.race.pivot.set(t,e),this.race.position.set(this.race.position.x+t,this.race.position.y+e),new st(this.race.scale).to({x:this.race.scale.x*2,y:this.race.scale.y*2},600).start(),new st(this.race).to({angle:-30},600).easing(it.Sinusoidal.InOut).onComplete(()=>{this.game.ticker.remove(this.update,this),this.game.audio.stopMusic(),this.game.leaderboardsManager&&this.game.leaderboardsManager.setPlayerEntry(Qe.name,this.progress.data.reputation,!0).then(i=>{console.log(i)}).catch(i=>{console.error("Error when setting player lb data",i)}),this.addChild(new uh(!1,this.game,this.progress))}).start()}destroy(t){this.game.ticker.remove(this.update,this),this.removeListeners(),this.playerCar.guns.forEach(e=>e.onFire.removeAll()),this.bossCar.gun.onFire.removeAll(),this.threatSpawner.clearSignals(),super.destroy(t)}removeListeners(){this.off("pointerdown"),this.off("pointerup"),this.off("pointermove"),this.off("pointeroutside"),document.removeEventListener("keydown",this.debugControls)}};var Kw=["Crack-Left","Crack-Right","Crack-Center"],ro=class r extends E{type;constructor(){super()}static create(){let t=new r;return t.anchor.set(.5),r.reset(t),t}static reset(t){switch(t.type=r.getRandomType(),t.texture=x.from(t.type),t.type){case"Crack-Left":t.x=-320;break;case"Crack-Right":t.x=320;break;case"Crack-Center":{t.x=Math.random()*500-500/2;break}}t.y=0}static getRandomType(){return Ut([...Kw],[30,30,40])}};var Zw=[1,2,3,4,9,10],io=class r extends E{constructor(){super()}static create(){let t=new r;return t.anchor.set(.5),t.scale.set(.5),r.reset(t),t}static reset(t){let e=r.getRandomId();r.resetGraphics(t,e),r.resetPosition(t,e)}static resetGraphics(t,e){t.texture=x.from(`Obs-${e}`)}static resetPosition(t,e){Math.random()>.5?(t.x=-475,e==10&&(t.scale.x=-Math.abs(t.scale.x),t.x+=25)):(t.x=475,e==10&&(t.x-=25)),t.y=-t.height}static getRandomId(){return Ut([...Zw],[1,1,1,1,1,1])}};var Yt={laneCount:5,heightOffset:10,minCrackPeriod:2e3,maxCrackPeriod:4e3,linePeriod:350,driveable:.75},Fs=class extends A{lanes;bgPt1;bgPt2;crackTimer=0;lineTimer=0;timeTillCrack=Yt.minCrackPeriod;cracks=new Lt(ro.create,ro.reset,t=>{});lines=new Lt(()=>{let t=new E(x.from("Road-Lines"));return t.anchor.set(.5,0),t.position.set(0,-t.height),t.alpha=Math.random()*.8+.1,t},t=>{t.position.set(0,-t.height),t.alpha=Math.random()*.6+.2},t=>{t.destroy()});obstacles=new Lt(io.create,io.reset,t=>{});roadTiles;constructor(){super(),this.clearLanes(),this.roadTiles=[new E(x.from("road")),new E(x.from("road")),new E(x.from("road"))],this.roadTiles.forEach((t,e)=>{t.anchor.set(.5,0),t.y=t.height*e,this.addChild(t)}),this.addChild(this.cracks.getInstance());for(let t=0;t<6;t++){let e=this.lines.getInstance();e.position.y+=t*400,this.addChild(e)}}listObstacles(){let t=0,e=0,i=0;for(let s=1;s<=11;s++){let n=new E(x.from(`Obs-${s}`));n.scale.set(.5),n.position.set(t,e),n.height>i&&(i=n.height),t+=n.width,t>500&&(t=0,e+=i,i=0),this.addChild(n)}}clearLanes(){this.lanes=new Array(Yt.laneCount).fill(0)}scrollRoadTile(t,e,i,s){t.y>C.height&&(t.y=this.roadTiles[(this.roadTiles.length+(e-1))%this.roadTiles.length].y-t.texture.height+Yt.heightOffset),t.y+=gt.scrollSpeed*i}update(t){let e=fg().height;this.roadTiles.forEach((i,s)=>{this.scrollRoadTile(i,s,t,e)}),this.crackTimer+=t,this.crackTimer>this.timeTillCrack&&(this.crackTimer-=this.timeTillCrack,this.timeTillCrack=Math.random()*(Yt.maxCrackPeriod-Yt.minCrackPeriod)+Yt.minCrackPeriod,this.addChild(this.cracks.getInstance()),this.addChild(this.obstacles.getInstance())),this.lineTimer+=t,this.lineTimer>Yt.linePeriod&&(this.lineTimer-=Yt.linePeriod,this.addChild(this.lines.getInstance())),this.lines.activeInstances.forEach(i=>{i.y+=gt.scrollSpeed*t}),this.obstacles.activeInstances.forEach(i=>{i.y+=gt.scrollSpeed*t,i.getBounds().top>e&&this.obstacles.release(i)}),this.cracks.activeInstances.forEach(i=>{i.y+=gt.scrollSpeed*t,i.getBounds().top>e&&this.cracks.release(i)})}decreaseLaneOccupancy(t){this.lanes[t]--}increaseLaneOccupancy(t){this.lanes[t]++}getFreeLane(){let t=this.lanes.map((s,n)=>n),e=this.lanes.map(s=>s>0?0:1);return Ut(t,e)}getRandomLane(){return Math.floor(Math.random()*Yt.laneCount)}getLaneX(t){t=t??this.getRandomLane();let e=C.width*Yt.driveable,i=(C.width-e)/2,s=e/Yt.laneCount;return i+t*s+s/2}getDriveableBounds(){let t=this.getBounds(!1,new H),e=t.width;return t.width*=Yt.driveable,t.x+=(e-t.width)/2,t}};var Qw={fontSize:36,fill:16777215,stroke:1849961,strokeThickness:8};function Au(r,t){let e=Object.assign({fontFamily:R.font},Qw),i=new mt(t,x.from("btn-blue"),e);i.text.position.set(-5,40);let s=new E(x.from(r));return s.anchor.set(.5),s.y=-60,i.addChild(s),i}var Jw={bg:{on:"btn-green-2",off:"btn-blue-disabled"}},so=class extends A{bg;icon;_toggledOn=!0;textures;constructor(t,e){super(),this.textures=Object.assign({},Jw,t),this.bg=new E,this.bg.anchor.set(.5),this.icon=new E,this.icon.anchor.set(.5),this.eventMode="static",this.on("pointerdown",()=>{et.emit("BUTTON_PRESS"),this.setState(!this.toggledOn),et.emit(e,this.toggledOn),console.log("tap on toggle")}),this.addChild(this.bg),this.addChild(this.icon),this.setState(!0)}setState(t){this._toggledOn=t,this.updateTextures(this._toggledOn),this.icon.tint=this._toggledOn?84798:2576510}updateTextures(t){this.bg.texture=x.from(t?this.textures.bg.on:this.textures.bg.off),this.icon.texture=x.from(t?this.textures.icon.on:this.textures.icon.off)}get toggledOn(){return this._toggledOn}};var fh=class extends A{overlay;bg;title;labelMusic;toggleMusic;labelSounds;toggleSounds;btnClose;btnRestart;btnHome;constructor(t,e){super(),this.overlay=new Ms,this.bg=new E(x.from("panel-settings")),this.bg.anchor.set(.5),this.title=new K(R.getText("Settings").toUpperCase(),{fontFamily:R.font,fontSize:54,fill:16777215}),this.title.anchor.set(.5),this.labelMusic=new K(R.getText("Music").toUpperCase(),{fontFamily:R.font,fontSize:48,fill:16777215}),this.labelMusic.anchor.set(.5),this.labelSounds=new K(R.getText("Sounds").toUpperCase(),{fontFamily:R.font,fontSize:48,fill:16777215}),this.labelSounds.anchor.set(.5),this.toggleMusic=new so({icon:{on:"icon-music",off:"icon-music"}},"MUSIC_TOGGLE"),this.toggleMusic.setState(t.music),this.toggleSounds=new so({icon:{on:"icon-sounds",off:"icon-sounds"}},"SOUNDS_TOGGLE"),this.toggleSounds.setState(t.sounds),this.btnClose=new mt("",x.from("icon-close")),this.btnClose.on("pointerdown",()=>{this.parent.removeChild(this)}),this.btnRestart=new mt(R.getText("Restart").toUpperCase(),x.from("btn-orange-3"),{fontFamily:R.font,fontSize:54,fill:7483392}),this.btnHome=new mt(R.getText("Home").toUpperCase(),x.from("btn-orange"),{fontFamily:R.font,fontSize:54,fill:65792}),this.positionElements(e),this.addChild(this.overlay),this.addChild(this.bg),this.addChild(this.title),this.addChild(this.labelMusic),this.addChild(this.toggleMusic),this.addChild(this.labelSounds),this.addChild(this.toggleSounds),this.addChild(this.btnClose),this.addChild(this.btnRestart),this.addChild(this.btnHome)}positionElements(t){this.title.position.set(0,-270),this.btnClose.position.set(280,-300),this.labelMusic.position.set(-140,t?-150:-50),this.labelSounds.position.set(140,t?-150:-50),this.toggleMusic.position.set(-140,t?0:130),this.toggleSounds.position.set(140,t?0:130),this.btnRestart.visible=t,this.btnHome.visible=t,this.btnRestart.position.set(0,220),this.btnHome.position.set(0,500)}};var no=class extends A{game;road;header;leaderboard;bottomShadow;repCounter;moneyCounter;settingsButton;raceButton;garageButton;moreGamesButton;constructor(t,e){super(),this.game=t,this.header=new E(x.from("panel-header")),this.header.anchor.set(.5,0),this.leaderboard=new Ma,this.leaderboard.visible=!1,this.game.leaderboardsManager&&this.game.leaderboardsManager.getLeaderboardEntries(Qe.name,Qe.rows).then(i=>{this.leaderboard.visible=!0;let s=[];i.userRank>Qe.rows?(s=i.entries.slice(0,Qe.rows),s.push(i.entries.find(n=>n.rank==i.userRank))):s=i.entries,this.leaderboard.displayEntries(s,i.userRank)}).catch(i=>{console.error("Error when fetching lb entries",i)}),this.repCounter=new Ps,this.repCounter.updateValue(e.data.reputation),this.moneyCounter=new Dt("Money"),this.moneyCounter.updateValue(e.data.money),this.settingsButton=new mt("",x.from("btn-settings")),this.settingsButton.on("pointerdown",()=>{let i=new fh(e.data,!1);i.position.set(C.width/2,C.height/2),this.addChild(i)}),this.road=new Fs,this.raceButton=Ca(),this.raceButton.on("pointerdown",()=>{new st(this.raceButton).to({y:-this.raceButton.height},300).easing(it.Back.In).start(),new st(this.garageButton).to({y:C.height+this.garageButton.height},300).easing(it.Back.In).start(),new st(this.moreGamesButton).to({y:C.height+this.garageButton.height},300).easing(it.Back.In).start(),new st(this.bottomShadow).to({alpha:0},300).easing(it.Quadratic.In).onComplete(()=>{et.emit("START_RACE",this.road)}).start()}),this.garageButton=Au("icon-upgrade",R.getText("Upgrade")),this.garageButton.on("pointerdown",()=>{this.game.audio.playSound("ui_menu_whoosh"),et.emit("START_GARAGE")}),this.moreGamesButton=Au("icon-more-games",R.getText("More games")),this.moreGamesButton.on("pointerdown",()=>{this.game.audio.playSound("ui_menu_whoosh"),Gr.showMoreGames()}),this.bottomShadow=new bs("shadow"),this.addChild(this.road),this.addChild(this.bottomShadow),this.addChild(this.header),this.addChild(this.repCounter),this.addChild(this.moneyCounter),this.addChild(this.settingsButton),this.addChild(this.leaderboard),this.addChild(this.raceButton),this.addChild(this.garageButton),this.addChild(this.moreGamesButton),this.positionElements(),this.game.ticker.add(this.update,this)}positionElements(){this.header.position.set(C.width/2,0),this.settingsButton.position.set(C.width-this.settingsButton.width-20,this.header.height/2),this.repCounter.position.set(250,this.header.height/2),this.moneyCounter.position.set(C.width/2+200,this.header.height/2),this.road.pivot.x=-this.road.width/2,this.bottomShadow.position.set(C.width/2,C.height-this.bottomShadow.height),this.leaderboard.position.set(C.width/2,400),this.leaderboard.scale.set(this.leaderboard.width/this.road.width),this.raceButton.position.set(C.width/2,1300),this.garageButton.position.set(C.width/2-170,1700),this.moreGamesButton.position.set(C.width/2+170,1700)}update(){li.shared.update(this.game.ticker.deltaMS),this.road.update(this.game.ticker.deltaMS/gt.timeDilation)}destroy(t){this.game.ticker.remove(this.update,this),super.destroy(t)}};var mr={exposePIXI:!0,disablePlayerGun:!1,manualRaceEnd:!1,cheats:!0,freeUpgrades:!1},C={width:1080,height:1920},mh=class extends sa{scene;progress;audio;leaderboardsManager;adsManager;isInitialised=!1;constructor(){super({view:document.getElementById("pixi-canvas"),resolution:window.devicePixelRatio||1,width:C.width,height:C.height,autoDensity:!0,backgroundColor:0})}init(){this.isInitialised||(this.progress=new ba,console.log(`music on: ${this.progress.data.music}, sound on: ${this.progress.data.sounds}`),this.audio=new ga,this.audio.init(this.progress.data.sounds,this.progress.data.music),window.addEventListener("blur",()=>{this.audio.setMusicEnabled(!1,"AppPaused"),this.audio.setSoundEnabled(!1,"AppPaused")}),window.addEventListener("focus",()=>{this.audio.setMusicEnabled(!0,"AppPaused"),this.audio.setSoundEnabled(!0,"AppPaused")}),et.on("BUTTON_PRESS",()=>{this.audio.playSound("ui_click_1")}),et.on("MUSIC_TOGGLE",t=>{this.audio.setMusicEnabled(t,"UserAction"),this.progress.data.music=t,this.progress.saveLocal()}),et.on("SOUNDS_TOGGLE",t=>{this.audio.setSoundEnabled(t,"UserAction"),this.progress.data.sounds=t,this.progress.saveLocal()}),et.on("AD_STARTED",()=>{this.audio.setMusicEnabled(!1,"AdPlaying"),this.audio.setSoundEnabled(!1,"AdPlaying")}),et.on("AD_FINISHED",()=>{this.audio.setMusicEnabled(!0,"AdPlaying"),this.audio.setSoundEnabled(!0,"AdPlaying")}),mr.cheats&&document.addEventListener("keydown",this.cheats.bind(this)),this.switchScene(new no(this,this.progress)),this.audio.playMusic("calm"),et.on("START_RACE",t=>{Gr.showPopup("onLevelStart",()=>{this.switchScene(new ph(this,this.progress,t)),this.audio.setMusicContext("active")})}),et.on("START_GARAGE",()=>{this.switchScene(new Ia(this,this.progress)),this.audio.setMusicContext("calm")}),et.on("START_MENU",()=>{this.switchScene(new no(this,this.progress)),this.audio.setMusicContext("calm")}),this.isInitialised=!0)}switchScene(t){this.stage.removeChildren(),this.scene&&this.scene.destroy({children:!0}),this.scene=t,this.onresize(),this.stage.addChild(t)}cheats(t){switch(t.key){case"r":this.progress.reset(),console.log("Game progress dropped",this.progress.data);break;case"m":this.progress.data.money+=1e4,this.progress.saveLocal,console.log(`Free money! ${this.progress.data.money}`);break}}initLeaderboards(t){this.leaderboardsManager=new ya(t)}initAds(t){this.adsManager=new na(t)}onresize(){let t=this.getGameScale();this.renderer.resize(C.width*t,C.height*t),this.scene.scale.set(t)}getGameScale(){let t=window.innerHeight/C.height,e=window.innerWidth/C.width;return Math.min(e,t)}};var mg=class oo{constructor(t,e,i=null){this.linkedSheets=[],this._texture=t instanceof x?t:null,this.baseTexture=t instanceof j?t:this._texture.baseTexture,this.textures={},this.animations={},this.data=e;let s=this.baseTexture.resource;this.resolution=this._updateResolution(i||(s?s.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(t=null){let{scale:e}=this.data.meta,i=M.getResolutionOfUrl(t,null);return i===null&&(i=parseFloat(e??"1")),i!==1&&this.baseTexture.setResolution(i),i}parse(){return new Promise(t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=oo.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(t){let e=t,i=oo.BATCH_SIZE;for(;e-t<i&&e<this._frameKeys.length;){let s=this._frameKeys[e],n=this._frames[s],o=n.frame;if(o){let a=null,h=null,l=n.trimmed!==!1&&n.sourceSize?n.sourceSize:n.frame,c=new H(0,0,Math.floor(l.w)/this.resolution,Math.floor(l.h)/this.resolution);n.rotated?a=new H(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.h)/this.resolution,Math.floor(o.w)/this.resolution):a=new H(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution),n.trimmed!==!1&&n.spriteSourceSize&&(h=new H(Math.floor(n.spriteSourceSize.x)/this.resolution,Math.floor(n.spriteSourceSize.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution)),this.textures[s]=new x(this.baseTexture,a,c,h,n.rotated?2:0,n.anchor,n.borders),x.addToCache(this.textures[s],s.toString())}e++}}_processAnimations(){let t=this.data.animations||{};for(let e in t){this.animations[e]=[];for(let i=0;i<t[e].length;i++){let s=t[e][i];this.animations[e].push(this.textures[s])}}}_parseComplete(){let t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*oo.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*oo.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(t=!1){for(let e in this.textures)this.textures[e].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&(this._texture?.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};mg.BATCH_SIZE=1e3;var gh=mg;var tT=["jpg","png","jpeg","avif","webp"];function gg(r,t,e){let i={};if(r.forEach(s=>{i[s]=t}),Object.keys(t.textures).forEach(s=>{i[s]=t.textures[s]}),!e){let s=M.path.dirname(r[0]);t.linkedSheets.forEach((n,o)=>{let a=gg([`${s}/${t.data.meta.related_multi_packs[o]}`],n,!0);Object.assign(i,a)})}return i}var yh={extension:w.Asset,cache:{test:r=>r instanceof gh,getCacheableAssets:(r,t)=>gg(r,t,!1)},resolver:{test:r=>{let t=r.split("?")[0].split("."),e=t.pop(),i=t.pop();return e==="json"&&tT.includes(i)},parse:r=>{let t=r.split(".");return{resolution:parseFloat(S.RETINA_PREFIX.exec(r)?.[1]??"1"),format:t[t.length-2],src:r}}},loader:{name:"spritesheetLoader",extension:{type:w.LoadParser,priority:It.Normal},async testParse(r,t){return M.path.extname(t.src).toLowerCase()===".json"&&!!r.frames},async parse(r,t,e){let i=M.path.dirname(t.src);i&&i.lastIndexOf("/")!==i.length-1&&(i+="/");let s=i+r.meta.image;s=kn(s,t.src);let n=(await e.load([s]))[s],o=new gh(n.baseTexture,r,t.src);await o.parse();let a=r?.meta?.related_multi_packs;if(Array.isArray(a)){let h=[];for(let c of a){if(typeof c!="string")continue;let u=i+c;t.data?.ignoreMultiPack||(u=kn(u,t.src),h.push(e.load({src:u,data:{ignoreMultiPack:!0}})))}let l=await Promise.all(h);o.linkedSheets=l,l.forEach(c=>{c.linkedSheets=[o].concat(o.linkedSheets.filter(u=>u!==c))})}return o},unload(r){r.destroy(!0)}}};T.add(yh);var yg={bundles:[{name:"main",assets:{cars:"./assets/atlases/cars.json",weapons:"./assets/atlases/weapons.json",projectiles:"./assets/atlases/projectiles.json",explosion:"./assets/atlases/explosion.json",pickups:"./assets/atlases/pickups.json",road:"./assets/road.jpg",garage:"./assets/garage.jpg",bg:"./assets/atlases/bg.json",obstacles:"./assets/atlases/obstacles.json",ui:"./assets/atlases/ui.json",rajdhani:"./assets/fonts/rajdhani.ttf",rubik:"./assets/fonts/rubik.ttf",mc:"./assets/atlases/mc.json",shield_loop:"./assets/atlases/shield_loop.json"}},{name:"audio",assets:{calm:"./assets/music/calm.mp3",sounds:"./assets/sounds/sounds.mp3",active:"./assets/music/active.mp3"}}]};async function bg(r){T.add(yh),await le.init({manifest:yg}),await le.loadBundle("main",r),await le.loadBundle("audio",r),console.log("assets loaded",le.cache)}var Hr;Gr.setup("CarsNGuns");bg(r=>{console.log(`Loading: ${Math.floor(r)}%`)}).then(()=>{Hr=new mh,YaGames.init().then(r=>{r.features.LoadingAPI?.ready(),R.setLocale(r.environment.i18n.lang),Hr.initLeaderboards(r),Hr.initAds(r),Hr.adsManager.showInterstitial()}).catch(r=>console.error(r)).finally(()=>{Hr.init(),window.addEventListener("resize",()=>{Hr.onresize()})}),mr.exposePIXI&&(globalThis.__PIXI_APP__=Hr)});function fg(){return Hr.screen}})();
/*! Bundled license information:

punycode/punycode.js:
  (*! https://mths.be/punycode v1.4.1 by @mathias *)

tweedle.js/dist/tweedle.es.js:
  (*!
   * tweedle.js - v2.1.0
   * Compiled Wed, 05 Apr 2023 15:21:25 UTC
   *
   * tweedle.js is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   * 
   * Copyright 2019-2021, Milton Candelero <miltoncandelero@gmail.com>, All Rights Reserved
   *)

gamefuse/dist/gamefuse.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2022 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2021 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
*/
